[
{"title": "django-admin and manage.py | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/django-admin/", "content": "django-admin and manage.py ¶ django-admin is Django’s command-line utility for administrative tasks.\nThis document outlines all it can do. In addition, manage.py is automatically created in each Django project. It\ndoes the same thing as django-admin but also sets the DJANGO_SETTINGS_MODULE environment variable so that it points to your\nproject’s settings.py file. The django-admin script should be on your system path if you installed\nDjango via pip . If it’s not in your path, ensure you have your virtual\nenvironment activated. Generally, when working on a single Django project, it’s easier to use manage.py than django-admin . If you need to switch between multiple\nDjango settings files, use django-admin with DJANGO_SETTINGS_MODULE or the --settings command line\noption. The command-line examples throughout this document use django-admin to\nbe consistent, but any example can use manage.py or python -m django just as well. Usage ¶ /  $ django-admin <command> [ options ] $ manage.py <command> [ options ] $ python -m django <command> [ options ] ...\\> django-admin < command > [options] ...\\> manage.py < command > [options] ...\\> py -m django < command > [options] command should be one of the commands listed in this document. options , which is optional, should be zero or more of the options available\nfor the given command. Getting runtime help ¶ django-admin help ¶ Run django-admin help to display usage information and a list of the\ncommands provided by each application. Run django-admin help --commands to display a list of all available\ncommands. Run django-admin help <command> to display a description of the given\ncommand and a list of its available options. App names ¶ Many commands take a list of “app names.” An “app name” is the basename of\nthe package containing your models. For example, if your INSTALLED_APPS contains the string 'mysite.blog' , the app name is blog . Determining the version ¶ django-admin version ¶ Run django-admin version to display the current Django version. The output follows the schema described in PEP 440 : 1.4.dev17026\n1.4a1\n1.4 Displaying debug output ¶ Use --verbosity , where it is supported, to specify the amount of\nnotification and debug information that django-admin prints to the console. Available commands ¶ check ¶ django-admin check [app_label [app_label ...]] ¶ Uses the system check framework to inspect the entire\nDjango project for common problems. By default, all apps will be checked. You can check a subset of apps by\nproviding a list of app labels as arguments: django-admin check auth admin myapp --tag TAGS , -t TAGS ¶ The system check framework performs many different types of checks that are categorized with tags . You can use these\ntags to restrict the checks performed to just those in a particular category.\nFor example, to perform only models and compatibility checks, run: django-admin check --tag models --tag compatibility --database DATABASE ¶ Specifies the database to run checks requiring database access: django-admin check --database default --database other By default, these checks will not be run. --list-tags ¶ Lists all available tags. --deploy ¶ Activates some additional checks that are only relevant in a deployment setting. You can use this option in your local development environment, but since your\nlocal development settings module may not have many of your production settings,\nyou will probably want to point the check command at a different settings\nmodule, either by setting the DJANGO_SETTINGS_MODULE environment\nvariable, or by passing the --settings option: django-admin check --deploy --settings=production_settings Or you could run it directly on a production or staging deployment to verify\nthat the correct settings are in use (omitting --settings ). You could even\nmake it part of your integration test suite. --fail-level {CRITICAL,ERROR,WARNING,INFO,DEBUG} ¶ Specifies the message level that will cause the command to exit with a non-zero\nstatus. Default is ERROR . compilemessages ¶ django-admin compilemessages ¶ Compiles .po files created by makemessages to .mo files for\nuse with the built-in gettext support. See Internationalization and localization . --locale LOCALE , -l LOCALE ¶ Specifies the locale(s) to process. If not provided, all locales are processed. --exclude EXCLUDE , -x EXCLUDE ¶ Specifies the locale(s) to exclude from processing. If not provided, no locales\nare excluded. --use-fuzzy , -f ¶ Includes fuzzy translations into compiled files. Example usage: django-admin compilemessages --locale=pt_BR django-admin compilemessages --locale=pt_BR --locale=fr -f django-admin compilemessages -l pt_BR django-admin compilemessages -l pt_BR -l fr --use-fuzzy django-admin compilemessages --exclude=pt_BR django-admin compilemessages --exclude=pt_BR --exclude=fr django-admin compilemessages -x pt_BR django-admin compilemessages -x pt_BR -x fr --ignore PATTERN , -i PATTERN ¶ Ignores directories matching the given glob -style pattern. Use\nmultiple times to ignore more. Example usage: django-admin compilemessages --ignore=cache --ignore=outdated/*/locale createcachetable ¶ django-admin createcachetable ¶ Creates the cache tables for use with the database cache backend using the\ninformation from your settings file. See Django’s cache framework for more\ninformation. --database DATABASE ¶ Specifies the database in which the cache table(s) will be created. Defaults to default . --dry-run ¶ Prints the SQL that would be run without actually running it, so you can\ncustomize it or use the migrations framework. dbshell ¶ django-admin dbshell ¶ Runs the command-line client for the database engine specified in your ENGINE setting, with the connection parameters\nspecified in your USER , PASSWORD , etc., settings. For PostgreSQL, this runs the psql command-line client. For MySQL, this runs the mysql command-line client. For SQLite, this runs the sqlite3 command-line client. For Oracle, this runs the sqlplus command-line client. This command assumes the programs are on your PATH so that a call to\nthe program name ( psql , mysql , sqlite3 , sqlplus ) will find the\nprogram in the right place. There’s no way to specify the location of the\nprogram manually. --database DATABASE ¶ Specifies the database onto which to open a shell. Defaults to default . -- ARGUMENTS ¶ Any arguments following a -- divider will be passed on to the underlying\ncommand-line client. For example, with PostgreSQL you can use the psql command’s -c flag to execute a raw SQL query directly: /  $ django-admin dbshell -- -c 'select current_user' current_user -------------- postgres (1 row) ...\\> django-admin dbshell -- -c 'select current_user' current_user -------------- postgres (1 row) On MySQL/MariaDB, you can do this with the mysql command’s -e flag: /  $ django-admin dbshell -- -e \"select user()\" +----------------------+ | user()               | +----------------------+ | djangonaut@localhost | +----------------------+ ...\\> django-admin dbshell -- -e \"select user()\" +----------------------+ | user()               | +----------------------+ | djangonaut@localhost | +----------------------+ Note Be aware that not all options set in the OPTIONS part of your\ndatabase configuration in DATABASES are passed to the\ncommand-line client, e.g. 'isolation_level' . diffsettings ¶ django-admin diffsettings ¶ Displays differences between the current settings file and Django’s default\nsettings (or another settings file specified by --default ). Settings that don’t appear in the defaults are followed by \"###\" . For\nexample, the default settings don’t define ROOT_URLCONF , so ROOT_URLCONF is followed by \"###\" in the output of diffsettings . --all ¶ Displays all settings, even if they have Django’s default value. Such settings\nare prefixed by \"###\" . --default MODULE ¶ The settings module to compare the current settings against. Leave empty to\ncompare against Django’s default settings. --output {hash,unified} ¶ Specifies the output format. Available values are hash and unified . hash is the default mode that displays the output that’s described above. unified displays the output similar to diff -u . Default settings are\nprefixed with a minus sign, followed by the changed setting prefixed with a\nplus sign. dumpdata ¶ django-admin dumpdata [app_label[.ModelName] [app_label[.ModelName] ...]] ¶ Outputs to standard output all data in the database associated with the named\napplication(s). If no application name is provided, all installed applications will be dumped. The output of dumpdata can be used as input for loaddata . When result of dumpdata is saved as a file, it can serve as a fixture for tests or as an initial data . Note that dumpdata uses the default manager on the model for selecting the\nrecords to dump. If you’re using a custom manager as\nthe default manager and it filters some of the available records, not all of the\nobjects will be dumped. --all , -a ¶ Uses Django’s base manager, dumping records which might otherwise be filtered\nor modified by a custom manager. --format FORMAT ¶ Specifies the serialization format of the output. Defaults to JSON. Supported\nformats are listed in Serialization formats . --indent INDENT ¶ Specifies the number of indentation spaces to use in the output. Defaults to None which displays all data on single line. --exclude EXCLUDE , -e EXCLUDE ¶ Prevents specific applications or models (specified in the form of app_label.ModelName ) from being dumped. If you specify a model name, then\nonly that model will be excluded, rather than the entire application. You can\nalso mix application names and model names. If you want to exclude multiple applications, pass --exclude more than\nonce: django-admin dumpdata --exclude=auth --exclude=contenttypes --database DATABASE ¶ Specifies the database from which data will be dumped. Defaults to default . --natural-foreign ¶ Uses the natural_key() model method to serialize any foreign key and\nmany-to-many relationship to objects of the type that defines the method. If\nyou’re dumping contrib.auth Permission objects or contrib.contenttypes ContentType objects, you should probably use this\nflag. See the natural keys documentation for more details on this and the next option. --natural-primary ¶ Omits the primary key in the serialized data of this object since it can be\ncalculated during deserialization. --pks PRIMARY_KEYS ¶ Outputs only the objects specified by a comma separated list of primary keys.\nThis is only available when dumping one model. By default, all the records of\nthe model are output. --output OUTPUT , -o OUTPUT ¶ Specifies a file to write the serialized data to. By default, the data goes to\nstandard output. When this option is set and --verbosity is greater than 0 (the default), a\nprogress bar is shown in the terminal. Fixtures compression ¶ The output file can be compressed with one of the bz2 , gz , lzma , or xz formats by ending the filename with the corresponding extension.\nFor example, to output the data as a compressed JSON file: django-admin dumpdata -o mydata.json.gz flush ¶ django-admin flush ¶ Removes all data from the database and re-executes any post-synchronization\nhandlers. The table of which migrations have been applied is not cleared. If you would rather start from an empty database and rerun all migrations, you\nshould drop and recreate the database and then run migrate instead. --noinput , --no-input ¶ Suppresses all user prompts. --database DATABASE ¶ Specifies the database to flush. Defaults to default . inspectdb ¶ django-admin inspectdb [table [table ...]] ¶ Introspects the database tables in the database pointed-to by the NAME setting and outputs a Django model module (a models.py file) to standard output. You may choose what tables or views to inspect by passing their names as\narguments. If no arguments are provided, models are created for views only if\nthe --include-views option is used. Models for partition tables are\ncreated on PostgreSQL if the --include-partitions option is used. Use this if you have a legacy database with which you’d like to use Django.\nThe script will inspect the database and create a model for each table within\nit. As you might expect, the created models will have an attribute for every field\nin the table. Note that inspectdb has a few special cases in its field-name\noutput: If inspectdb cannot map a column’s type to a model field type, it’ll\nuse TextField and will insert the Python comment 'This field type is a guess.' next to the field in the generated\nmodel. The recognized fields may depend on apps listed in INSTALLED_APPS . For example, django.contrib.postgres adds\nrecognition for several PostgreSQL-specific field types. If the database column name is a Python reserved word (such as 'pass' , 'class' or 'for' ), inspectdb will append '_field' to the attribute name. For example, if a table has a column 'for' , the generated model will have a field 'for_field' , with\nthe db_column attribute set to 'for' . inspectdb will insert\nthe Python comment 'Field renamed because it was a Python reserved word.' next to the\nfield. This feature is meant as a shortcut, not as definitive model generation. After\nyou run it, you’ll want to look over the generated models yourself to make\ncustomizations. In particular, you’ll need to rearrange models’ order, so that\nmodels that refer to other models are ordered properly. Django doesn’t create database defaults when a default is specified on a model field.\nSimilarly, database defaults aren’t translated to model field defaults or\ndetected in any fashion by inspectdb . By default, inspectdb creates unmanaged models. That is, managed = False in the model’s Meta class tells Django not to manage each table’s creation,\nmodification, and deletion. If you do want to allow Django to manage the\ntable’s lifecycle, you’ll need to change the managed option to True (or remove\nit because True is its default value). Database-specific notes ¶ Oracle ¶ Models are created for materialized views if --include-views is\nused. PostgreSQL ¶ Models are created for foreign tables. Models are created for materialized views if --include-views is used. Models are created for partition tables if --include-partitions is used. --database DATABASE ¶ Specifies the database to introspect. Defaults to default . --include-partitions ¶ If this option is provided, models are also created for partitions. Only support for PostgreSQL is implemented. --include-views ¶ If this option is provided, models are also created for database views. loaddata ¶ django-admin loaddata fixture [fixture ...] ¶ Searches for and loads the contents of the named fixture into the database. --database DATABASE ¶ Specifies the database into which the data will be loaded. Defaults to default . --ignorenonexistent , -i ¶ Ignores fields and models that may have been removed since the fixture was\noriginally generated. --app APP_LABEL ¶ Specifies a single app to look for fixtures in rather than looking in all apps. --format FORMAT ¶ Specifies the serialization format (e.g., json or xml ) for fixtures read from stdin . --exclude EXCLUDE , -e EXCLUDE ¶ Excludes loading the fixtures from the given applications and/or models (in the\nform of app_label or app_label.ModelName ). Use the option multiple\ntimes to exclude more than one app or model. Loading fixtures from stdin ¶ You can use a dash as the fixture name to load input from sys.stdin . For\nexample: django-admin loaddata --format=json - When reading from stdin , the --format option\nis required to specify the serialization format of the input (e.g., json or xml ). Loading from stdin is useful with standard input and output redirections.\nFor example: django-admin dumpdata --format=json --database=test app_label.ModelName | django-admin loaddata --format=json --database=prod - The dumpdata command can be used to generate input for loaddata . See also For more detail about fixtures see the Fixtures topic. makemessages ¶ django-admin makemessages ¶ Runs over the entire source tree of the current directory and pulls out all\nstrings marked for translation. It creates (or updates) a message file in the\nconf/locale (in the Django tree) or locale (for project and application)\ndirectory. After making changes to the messages files you need to compile them\nwith compilemessages for use with the builtin gettext support. See\nthe i18n documentation for details. This command doesn’t require configured settings. However, when settings aren’t\nconfigured, the command can’t ignore the MEDIA_ROOT and STATIC_ROOT directories or include LOCALE_PATHS . --all , -a ¶ Updates the message files for all available languages. --extension EXTENSIONS , -e EXTENSIONS ¶ Specifies a list of file extensions to examine (default: html , txt , py or js if --domain is djangojs ). Example usage: django-admin makemessages --locale=de --extension xhtml Separate multiple extensions with commas or use -e or --extension multiple times: django-admin makemessages --locale=de --extension=html,txt --extension xml --locale LOCALE , -l LOCALE ¶ Specifies the locale(s) to process. --exclude EXCLUDE , -x EXCLUDE ¶ Specifies the locale(s) to exclude from processing. If not provided, no locales\nare excluded. Example usage: django-admin makemessages --locale=pt_BR django-admin makemessages --locale=pt_BR --locale=fr django-admin makemessages -l pt_BR django-admin makemessages -l pt_BR -l fr django-admin makemessages --exclude=pt_BR django-admin makemessages --exclude=pt_BR --exclude=fr django-admin makemessages -x pt_BR django-admin makemessages -x pt_BR -x fr --domain DOMAIN , -d DOMAIN ¶ Specifies the domain of the messages files. Supported options are: django for all *.py , *.html and *.txt files (default) djangojs for *.js files --symlinks , -s ¶ Follows symlinks to directories when looking for new translation strings. Example usage: django-admin makemessages --locale=de --symlinks --ignore PATTERN , -i PATTERN ¶ Ignores files or directories matching the given glob -style pattern. Use\nmultiple times to ignore more. These patterns are used by default: 'CVS' , '.*' , '*~' , '*.pyc' . Example usage: django-admin makemessages --locale=en_US --ignore=apps/* --ignore=secret/*.html --no-default-ignore ¶ Disables the default values of --ignore . --no-wrap ¶ Disables breaking long message lines into several lines in language files. --no-location ¶ Suppresses writing ‘ #: filename:line ’ comment lines in language files.\nUsing this option makes it harder for technically skilled translators to\nunderstand each message’s context. --add-location [{full,file,never}] ¶ Controls #: filename:line comment lines in language files. If the option\nis: full (the default if not given): the lines include both file name and\nline number. file : the line number is omitted. never : the lines are suppressed (same as --no-location ). Requires gettext 0.19 or newer. --no-obsolete ¶ Removes obsolete message strings from the .po files. --keep-pot ¶ Prevents deleting the temporary .pot files generated before creating the .po file. This is useful for debugging errors which may prevent the final\nlanguage files from being created. See also See Customizing the makemessages command for instructions on how to customize\nthe keywords that makemessages passes to xgettext . makemigrations ¶ django-admin makemigrations [app_label [app_label ...]] ¶ Creates new migrations based on the changes detected to your models.\nMigrations, their relationship with apps and more are covered in depth in the migrations documentation . Providing one or more app names as arguments will limit the migrations created\nto the app(s) specified and any dependencies needed (the table at the other end\nof a ForeignKey , for example). To add migrations to an app that doesn’t have a migrations directory, run makemigrations with the app’s app_label . --noinput , --no-input ¶ Suppresses all user prompts. If a suppressed prompt cannot be resolved\nautomatically, the command will exit with error code 3. --empty ¶ Outputs an empty migration for the specified apps, for manual editing. This is\nfor advanced users and should not be used unless you are familiar with the\nmigration format, migration operations, and the dependencies between your\nmigrations. --dry-run ¶ Shows what migrations would be made without actually writing any migrations\nfiles to disk. Using this option along with --verbosity 3 will also show\nthe complete migrations files that would be written. --merge ¶ Enables fixing of migration conflicts. --name NAME , -n NAME ¶ Allows naming the generated migration(s) instead of using a generated name. The\nname must be a valid Python identifier . --no-header ¶ Generate migration files without Django version and timestamp header. --check ¶ Makes makemigrations exit with a non-zero status when model changes without\nmigrations are detected. Implies --dry-run . --scriptable ¶ Diverts log output and input prompts to stderr , writing only paths of\ngenerated migration files to stdout . --update ¶ Merges model changes into the latest migration and optimize the resulting\noperations. The updated migration will have a generated name. In order to preserve the\nprevious name, set it using --name . migrate ¶ django-admin migrate [app_label] [migration_name] ¶ Synchronizes the database state with the current set of models and migrations.\nMigrations, their relationship with apps and more are covered in depth in the migrations documentation . The behavior of this command changes depending on the arguments provided: No arguments: All apps have all of their migrations run. <app_label> : The specified app has its migrations run, up to the most\nrecent migration. This may involve running other apps’ migrations too, due\nto dependencies. <app_label> <migrationname> : Brings the database schema to a state where\nthe named migration is applied, but no later migrations in the same app are\napplied. This may involve unapplying migrations if you have previously\nmigrated past the named migration. You can use a prefix of the migration\nname, e.g. 0001 , as long as it’s unique for the given app name. Use the\nname zero to migrate all the way back i.e. to revert all applied\nmigrations for an app. Warning When unapplying migrations, all dependent migrations will also be\nunapplied, regardless of <app_label> . You can use --plan to check\nwhich migrations will be unapplied. --database DATABASE ¶ Specifies the database to migrate. Defaults to default . --fake ¶ Marks the migrations up to the target one (following the rules above) as\napplied, but without actually running the SQL to change your database schema. This is intended for advanced users to manipulate the\ncurrent migration state directly if they’re manually applying changes;\nbe warned that using --fake runs the risk of putting the migration state\ntable into a state where manual recovery will be needed to make migrations\nrun correctly. --fake-initial ¶ Allows Django to skip an app’s initial migration if all database tables with\nthe names of all models created by all CreateModel operations in that\nmigration already exist. This option is intended for use when first running\nmigrations against a database that preexisted the use of migrations. This\noption does not, however, check for matching database schema beyond matching\ntable names and so is only safe to use if you are confident that your existing\nschema matches what is recorded in your initial migration. --plan ¶ Shows the migration operations that will be performed for the given migrate command. --run-syncdb ¶ Allows creating tables for apps without migrations. While this isn’t\nrecommended, the migrations framework is sometimes too slow on large projects\nwith hundreds of models. --noinput , --no-input ¶ Suppresses all user prompts. An example prompt is asking about removing stale\ncontent types. --check ¶ Makes migrate exit with a non-zero status when unapplied migrations are\ndetected. --prune ¶ Deletes nonexistent migrations from the django_migrations table. This is\nuseful when migration files replaced by a squashed migration have been removed.\nSee Squashing migrations for more details. optimizemigration ¶ django-admin optimizemigration app_label migration_name ¶ Optimizes the operations for the named migration and overrides the existing\nfile. If the migration contains functions that must be manually copied, the\ncommand creates a new migration file suffixed with _optimized that is meant\nto replace the named migration. --check ¶ Makes optimizemigration exit with a non-zero status when a migration can be\noptimized. runserver ¶ django-admin runserver [addrport] ¶ Starts a lightweight development web server on the local machine. By default,\nthe server runs on port 8000 on the IP address 127.0.0.1 . You can pass in an\nIP address and port number explicitly. If you run this script as a user with normal privileges (recommended), you\nmight not have access to start a port on a low port number. Low port numbers\nare reserved for the superuser (root). This server uses the WSGI application object specified by the WSGI_APPLICATION setting. Warning DO NOT USE THIS SERVER IN A PRODUCTION SETTING. This lightweight development server has not gone through security audits or\nperformance tests, hence is unsuitable for production. Making this server\nable to handle a production environment is outside the scope of Django. The development server automatically reloads Python code for each request, as\nneeded. You don’t need to restart the server for code changes to take effect.\nHowever, some actions like adding files don’t trigger a restart, so you’ll\nhave to restart the server in these cases. If you’re using Linux or MacOS and install both pywatchman and the Watchman service, kernel signals will be used to autoreload the server\n(rather than polling file modification timestamps each second). This offers\nbetter performance on large projects, reduced response time after code changes,\nmore robust change detection, and a reduction in power usage. Django supports pywatchman 1.2.0 and higher. Large directories with many files may cause performance issues When using Watchman with a project that includes large non-Python\ndirectories like node_modules , it’s advisable to ignore this directory\nfor optimal performance. See the watchman documentation for information\non how to do this. Watchman timeout DJANGO_WATCHMAN_TIMEOUT ¶ The default timeout of Watchman client is 5 seconds. You can change it\nby setting the DJANGO_WATCHMAN_TIMEOUT environment variable. When you start the server, and each time you change Python code while the\nserver is running, the system check framework will check your entire Django\nproject for some common errors (see the check command). If any\nerrors are found, they will be printed to standard output. You can use the --skip-checks option to skip running system checks. You can run as many concurrent servers as you want, as long as they’re on\nseparate ports by executing django-admin runserver more than once. Note that the default IP address, 127.0.0.1 , is not accessible from other\nmachines on your network. To make your development server viewable to other\nmachines on the network, use its own IP address (e.g. 192.168.2.1 ), 0 (shortcut for 0.0.0.0 ), 0.0.0.0 , or :: (with IPv6 enabled). You can provide an IPv6 address surrounded by brackets\n(e.g. [200a::1]:8000 ). This will automatically enable IPv6 support. A hostname containing ASCII-only characters can also be used. If the staticfiles contrib app is enabled\n(default in new projects) the runserver command will be overridden\nwith its own runserver command. Logging of each request and response of the server is sent to the django.server logger. --noreload ¶ Disables the auto-reloader. This means any Python code changes you make while\nthe server is running will not take effect if the particular Python modules\nhave already been loaded into memory. --nothreading ¶ Disables use of threading in the development server. The server is\nmultithreaded by default. --ipv6 , -6 ¶ Uses IPv6 for the development server. This changes the default IP address from 127.0.0.1 to ::1 . Examples of using different ports and addresses ¶ Port 8000 on IP address 127.0.0.1 : django-admin runserver Port 8000 on IP address 1.2.3.4 : django-admin runserver 1.2.3.4:8000 Port 7000 on IP address 127.0.0.1 : django-admin runserver 7000 Port 7000 on IP address 1.2.3.4 : django-admin runserver 1.2.3.4:7000 Port 8000 on IPv6 address ::1 : django-admin runserver -6 Port 7000 on IPv6 address ::1 : django-admin runserver -6 7000 Port 7000 on IPv6 address 2001:0db8:1234:5678::9 : django-admin runserver [2001:0db8:1234:5678::9]:7000 Port 8000 on IPv4 address of host localhost : django-admin runserver localhost:8000 Port 8000 on IPv6 address of host localhost : django-admin runserver -6 localhost:8000 Serving static files with the development server ¶ By default, the development server doesn’t serve any static files for your site\n(such as CSS files, images, things under MEDIA_URL and so forth). If\nyou want to configure Django to serve static media, read How to manage static files (e.g. images, JavaScript, CSS) . Serving with ASGI in development ¶ Django’s runserver command provides a WSGI server. In order to run under\nASGI you will need to use an ASGI server .\nThe Django Daphne project provides Integration with runserver that you can use. sendtestemail ¶ django-admin sendtestemail [email [email ...]] ¶ Sends a test email (to confirm email sending through Django is working) to the\nrecipient(s) specified. For example: django-admin sendtestemail foo@example.com bar@example.com There are a couple of options, and you may use any combination of them\ntogether: --managers ¶ Mails the email addresses specified in MANAGERS using mail_managers() . --admins ¶ Mails the email addresses specified in ADMINS using mail_admins() . shell ¶ django-admin shell ¶ Starts the Python interactive interpreter. --interface {ipython,bpython,python} , -i {ipython,bpython,python} ¶ Specifies the shell to use. By default, Django will use IPython or bpython if\neither is installed. If both are installed, specify which one you want like so: IPython: django-admin shell -i ipython bpython: django-admin shell -i bpython If you have a “rich” shell installed but want to force use of the “plain”\nPython interpreter, use python as the interface name, like so: django-admin shell -i python --no-startup ¶ Disables reading the startup script for the “plain” Python interpreter. By\ndefault, the script pointed to by the PYTHONSTARTUP environment\nvariable or the ~/.pythonrc.py script is read. --command COMMAND , -c COMMAND ¶ Lets you pass a command as a string to execute it as Django, like so: django-admin shell --command=\"import django; print(django.__version__)\" You can also pass code in on standard input to execute it. For example: $ django-admin shell <<EOF > import django > print(django.__version__) > EOF On Windows, the REPL is output due to implementation limits of select.select() on that platform. showmigrations ¶ django-admin showmigrations [app_label [app_label ...]] ¶ Shows all migrations in a project. You can choose from one of two formats: --list , -l ¶ Lists all of the apps Django knows about, the migrations available for each\napp, and whether or not each migration is applied (marked by an [X] next to\nthe migration name). For a --verbosity of 2 and above, the applied\ndatetimes are also shown. Apps without migrations are also listed, but have (no migrations) printed\nunder them. This is the default output format. --plan , -p ¶ Shows the migration plan Django will follow to apply migrations. Like --list , applied migrations are marked by an [X] . For a --verbosity of 2 and above, all dependencies of a migration will also be shown. app_label s arguments limit the output, however, dependencies of provided\napps may also be included. --database DATABASE ¶ Specifies the database to examine. Defaults to default . sqlflush ¶ django-admin sqlflush ¶ Prints the SQL statements that would be executed for the flush command. --database DATABASE ¶ Specifies the database for which to print the SQL. Defaults to default . sqlmigrate ¶ django-admin sqlmigrate app_label migration_name ¶ Prints the SQL for the named migration. This requires an active database\nconnection, which it will use to resolve constraint names; this means you must\ngenerate the SQL against a copy of the database you wish to later apply it on. Note that sqlmigrate doesn’t colorize its output. --backwards ¶ Generates the SQL for unapplying the migration. By default, the SQL created is\nfor running the migration in the forwards direction. --database DATABASE ¶ Specifies the database for which to generate the SQL. Defaults to default . sqlsequencereset ¶ django-admin sqlsequencereset app_label [app_label ...] ¶ Prints the SQL statements for resetting sequences for the given app name(s). Sequences are indexes used by some database engines to track the next available\nnumber for automatically incremented fields. Use this command to generate SQL which will fix cases where a sequence is out\nof sync with its automatically incremented field data. --database DATABASE ¶ Specifies the database for which to print the SQL. Defaults to default . squashmigrations ¶ django-admin squashmigrations app_label [start_migration_name] migration_name ¶ Squashes the migrations for app_label up to and including migration_name down into fewer migrations, if possible. The resulting squashed migrations\ncan live alongside the unsquashed ones safely. For more information,\nplease read Squashing migrations . When start_migration_name is given, Django will only include migrations\nstarting from and including this migration. This helps to mitigate the\nsquashing limitation of RunPython and django.db.migrations.operations.RunSQL migration operations. --no-optimize ¶ Disables the optimizer when generating a squashed migration. By default, Django\nwill try to optimize the operations in your migrations to reduce the size of\nthe resulting file. Use this option if this process is failing or creating\nincorrect migrations, though please also file a Django bug report about the\nbehavior, as optimization is meant to be safe. --noinput , --no-input ¶ Suppresses all user prompts. --squashed-name SQUASHED_NAME ¶ Sets the name of the squashed migration. When omitted, the name is based on the\nfirst and last migration, with _squashed_ in between. --no-header ¶ Generate squashed migration file without Django version and timestamp header. startapp ¶ django-admin startapp name [directory] ¶ Creates a Django app directory structure for the given app name in the current\ndirectory or the given destination. By default, the new directory contains a models.py file and other app template files. If only the app name is given,\nthe app directory will be created in the current working directory. If the optional destination is provided, Django will use that existing\ndirectory rather than creating a new one. You can use ‘.’ to denote the current\nworking directory. For example: django-admin startapp myapp /Users/jezdez/Code/myapp --template TEMPLATE ¶ Provides the path to a directory with a custom app template file, or a path to\nan uncompressed archive ( .tar ) or a compressed archive ( .tar.gz , .tar.bz2 , .tar.xz , .tar.lzma , .tgz , .tbz2 , .txz , .tlz , .zip ) containing the app template files. For example, this would look for an app template in the given directory when\ncreating the myapp app: django-admin startapp --template=/Users/jezdez/Code/my_app_template myapp Django will also accept URLs ( http , https , ftp ) to compressed\narchives with the app template files, downloading and extracting them on the\nfly. For example, taking advantage of GitHub’s feature to expose repositories as\nzip files, you can use a URL like: django-admin startapp --template=https://github.com/githubuser/django-app-template/archive/main.zip myapp --extension EXTENSIONS , -e EXTENSIONS ¶ Specifies which file extensions in the app template should be rendered with the\ntemplate engine. Defaults to py . --name FILES , -n FILES ¶ Specifies which files in the app template (in addition to those matching --extension ) should be rendered with the template engine. Defaults to an\nempty list. --exclude DIRECTORIES , -x DIRECTORIES ¶ Specifies which directories in the app template should be excluded, in addition\nto .git and __pycache__ . If this option is not provided, directories\nnamed __pycache__ or starting with . will be excluded. The template context used for all matching\nfiles is: Any option passed to the startapp command (among the command’s supported\noptions) app_name – the app name as passed to the command app_directory – the full path of the newly created app camel_case_app_name – the app name in camel case format docs_version – the version of the documentation: 'dev' or '1.x' django_version – the version of Django, e.g. '2.0.3' Warning When the app template files are rendered with the Django template\nengine (by default all *.py files), Django will also replace all\nstray template variables contained. For example, if one of the Python files\ncontains a docstring explaining a particular feature related\nto template rendering, it might result in an incorrect example. To work around this problem, you can use the templatetag template tag to “escape” the various parts of the template syntax. In addition, to allow Python template files that contain Django template\nlanguage syntax while also preventing packaging systems from trying to\nbyte-compile invalid *.py files, template files ending with .py-tpl will be renamed to .py . Warning The contents of custom app (or project) templates should always be\naudited before use: Such templates define code that will become\npart of your project, and this means that such code will be trusted\nas much as any app you install, or code you write yourself.\nFurther, even rendering the templates is, effectively, executing\ncode that was provided as input to the management command. The\nDjango template language may provide wide access into the system,\nso make sure any custom template you use is worthy of your trust. startproject ¶ django-admin startproject name [directory] ¶ Creates a Django project directory structure for the given project name in\nthe current directory or the given destination. By default, the new directory contains manage.py and a project package (containing a settings.py and other\nfiles). If only the project name is given, both the project directory and project\npackage will be named <projectname> and the project directory\nwill be created in the current working directory. If the optional destination is provided, Django will use that existing\ndirectory as the project directory, and create manage.py and the project\npackage within it. Use ‘.’ to denote the current working directory. For example: django-admin startproject myproject /Users/jezdez/Code/myproject_repo --template TEMPLATE ¶ Specifies a directory, file path, or URL of a custom project template. See the startapp --template documentation for examples and usage. --extension EXTENSIONS , -e EXTENSIONS ¶ Specifies which file extensions in the project template should be rendered with\nthe template engine. Defaults to py . --name FILES , -n FILES ¶ Specifies which files in the project template (in addition to those matching --extension ) should be rendered with the template engine. Defaults to an\nempty list. --exclude DIRECTORIES , -x DIRECTORIES ¶ Specifies which directories in the project template should be excluded, in\naddition to .git and __pycache__ . If this option is not provided,\ndirectories named __pycache__ or starting with . will be excluded. The template context used is: Any option passed to the startproject command (among the command’s\nsupported options) project_name – the project name as passed to the command project_directory – the full path of the newly created project secret_key – a random key for the SECRET_KEY setting docs_version – the version of the documentation: 'dev' or '1.x' django_version – the version of Django, e.g. '2.0.3' Please also see the rendering warning and trusted code warning as mentioned for startapp . test ¶ django-admin test [test_label [test_label ...]] ¶ Runs tests for all installed apps. See Testing in Django for more\ninformation. --failfast ¶ Stops running tests and reports the failure immediately after a test fails. --testrunner TESTRUNNER ¶ Controls the test runner class that is used to execute tests. This value\noverrides the value provided by the TEST_RUNNER setting. --noinput , --no-input ¶ Suppresses all user prompts. A typical prompt is a warning about deleting an\nexisting test database. Test runner options ¶ The test command receives options on behalf of the specified --testrunner . These are the options of the default test runner: DiscoverRunner . --keepdb ¶ Preserves the test database between test runs. This has the advantage of\nskipping both the create and destroy actions which can greatly decrease the\ntime to run tests, especially those in a large test suite. If the test database\ndoes not exist, it will be created on the first run and then preserved for each\nsubsequent run. Unless the MIGRATE test setting is False , any unapplied migrations will also be applied to the test database\nbefore running the test suite. --shuffle [SEED] ¶ Randomizes the order of tests before running them. This can help detect tests\nthat aren’t properly isolated. The test order generated by this option is a\ndeterministic function of the integer seed given. When no seed is passed, a\nseed is chosen randomly and printed to the console. To repeat a particular test\norder, pass a seed. The test orders generated by this option preserve Django’s guarantees on test order . They also keep tests grouped\nby test case class. The shuffled orderings also have a special consistency property useful when\nnarrowing down isolation issues. Namely, for a given seed and when running a\nsubset of tests, the new order will be the original shuffling restricted to the\nsmaller set. Similarly, when adding tests while keeping the seed the same, the\norder of the original tests will be the same in the new order. --reverse , -r ¶ Sorts test cases in the opposite execution order. This may help in debugging\nthe side effects of tests that aren’t properly isolated. Grouping by test\nclass is preserved when using this option. This can be used\nin conjunction with --shuffle to reverse the order for a particular seed. --debug-mode ¶ Sets the DEBUG setting to True prior to running tests. This may\nhelp troubleshoot test failures. --debug-sql , -d ¶ Enables SQL logging for failing tests. If --verbosity is 2 , then queries in passing tests are also output. --parallel [N] ¶ DJANGO_TEST_PROCESSES ¶ Runs tests in separate parallel processes. Since modern processors have\nmultiple cores, this allows running tests significantly faster. Using --parallel without a value, or with the value auto , runs one test\nprocess per core according to multiprocessing.cpu_count() . You can\noverride this by passing the desired number of processes, e.g. --parallel 4 , or by setting the DJANGO_TEST_PROCESSES environment\nvariable. Django distributes test cases — unittest.TestCase subclasses — to\nsubprocesses. If there are fewer test case classes than configured processes,\nDjango will reduce the number of processes accordingly. Each process gets its own database. You must ensure that different test case\nclasses don’t access the same resources. For instance, test case classes that\ntouch the filesystem should create a temporary directory for their own use. Note If you have test classes that cannot be run in parallel, you can use SerializeMixin to run them sequentially. See Enforce running test\nclasses sequentially . This option requires the third-party tblib package to display tracebacks\ncorrectly: $ python -m pip install tblib This feature isn’t available on Windows. It doesn’t work with the Oracle\ndatabase backend either. If you want to use pdb while debugging tests, you must disable parallel\nexecution ( --parallel=1 ). You’ll see something like bdb.BdbQuit if you\ndon’t. Warning When test parallelization is enabled and a test fails, Django may be\nunable to display the exception traceback. This can make debugging\ndifficult. If you encounter this problem, run the affected test without\nparallelization to see the traceback of the failure. This is a known limitation. It arises from the need to serialize objects\nin order to exchange them between processes. See What can be pickled and unpickled? for details. --tag TAGS ¶ Runs only tests marked with the specified tags .\nMay be specified multiple times and combined with test --exclude-tag . Tests that fail to load are always considered matching. --exclude-tag EXCLUDE_TAGS ¶ Excludes tests marked with the specified tags .\nMay be specified multiple times and combined with test --tag . -k TEST_NAME_PATTERNS ¶ Runs test methods and classes matching test name patterns, in the same way as unittest's -k option . Can be specified multiple times. --pdb ¶ Spawns a pdb debugger at each test error or failure. If you have it\ninstalled, ipdb is used instead. --buffer , -b ¶ Discards output ( stdout and stderr ) for passing tests, in the same way\nas unittest's --buffer option . --no-faulthandler ¶ Django automatically calls faulthandler.enable() when starting the\ntests, which allows it to print a traceback if the interpreter crashes. Pass --no-faulthandler to disable this behavior. --timing ¶ Outputs timings, including database setup and total run time. --durations N ¶ New in Django 5.0. Shows the N slowest test cases (N=0 for all). Python 3.12 and later This feature is only available for Python 3.12 and later. testserver ¶ django-admin testserver [fixture [fixture ...]] ¶ Runs a Django development server (as in runserver ) using data from\nthe given fixture(s). For example, this command: django-admin testserver mydata.json …would perform the following steps: Create a test database, as described in The test database . Populate the test database with fixture data from the given fixtures.\n(For more on fixtures, see the documentation for loaddata above.) Runs the Django development server (as in runserver ), pointed at\nthis newly created test database instead of your production database. This is useful in a number of ways: When you’re writing unit tests of how your views\nact with certain fixture data, you can use testserver to interact with\nthe views in a web browser, manually. Let’s say you’re developing your Django application and have a “pristine”\ncopy of a database that you’d like to interact with. You can dump your\ndatabase to a fixture (using the dumpdata command, explained above), then use testserver to run\nyour web application with that data.  With this arrangement, you have the\nflexibility of messing up your data in any way, knowing that whatever data\nchanges you’re making are only being made to a test database. Note that this server does not automatically detect changes to your Python\nsource code (as runserver does). It does, however, detect changes to\ntemplates. --addrport ADDRPORT ¶ Specifies a different port, or IP address and port, from the default of 127.0.0.1:8000 . This value follows exactly the same format and serves\nexactly the same function as the argument to the runserver command. Examples: To run the test server on port 7000 with fixture1 and fixture2 : django-admin testserver --addrport 7000 fixture1 fixture2 django-admin testserver fixture1 fixture2 --addrport 7000 (The above statements are equivalent. We include both of them to demonstrate\nthat it doesn’t matter whether the options come before or after the fixture\narguments.) To run on 1.2.3.4:7000 with a test fixture: django-admin testserver --addrport 1.2.3.4:7000 test --noinput , --no-input ¶ Suppresses all user prompts. A typical prompt is a warning about deleting an\nexisting test database. Commands provided by applications ¶ Some commands are only available when the django.contrib application that implements them has been enabled . This section describes them grouped by\ntheir application. django.contrib.auth ¶ changepassword ¶ django-admin changepassword [<username>] ¶ This command is only available if Django’s authentication system ( django.contrib.auth ) is installed. Allows changing a user’s password. It prompts you to enter a new password twice\nfor the given user. If the entries are identical, this immediately becomes the\nnew password. If you do not supply a user, the command will attempt to change\nthe password whose username matches the current user. --database DATABASE ¶ Specifies the database to query for the user. Defaults to default . Example usage: django-admin changepassword ringo createsuperuser ¶ django-admin createsuperuser ¶ DJANGO_SUPERUSER_PASSWORD ¶ This command is only available if Django’s authentication system ( django.contrib.auth ) is installed. Creates a superuser account (a user who has all permissions). This is\nuseful if you need to create an initial superuser account or if you need to\nprogrammatically generate superuser accounts for your site(s). When run interactively, this command will prompt for a password for\nthe new superuser account. When run non-interactively, you can provide\na password by setting the DJANGO_SUPERUSER_PASSWORD environment\nvariable. Otherwise, no password will be set, and the superuser account will\nnot be able to log in until a password has been manually set for it. In non-interactive mode, the USERNAME_FIELD and required\nfields (listed in REQUIRED_FIELDS ) fall back to DJANGO_SUPERUSER_<uppercase_field_name> environment variables, unless they\nare overridden by a command line argument. For example, to provide an email field, you can use DJANGO_SUPERUSER_EMAIL environment variable. --noinput , --no-input ¶ Suppresses all user prompts. If a suppressed prompt cannot be resolved\nautomatically, the command will exit with error code 1. --username USERNAME ¶ --email EMAIL ¶ The username and email address for the new account can be supplied by\nusing the --username and --email arguments on the command\nline. If either of those is not supplied, createsuperuser will prompt for\nit when running interactively. --database DATABASE ¶ Specifies the database into which the superuser object will be saved. You can subclass the management command and override get_input_data() if you\nwant to customize data input and validation. Consult the source code for\ndetails on the existing implementation and the method’s parameters. For example,\nit could be useful if you have a ForeignKey in REQUIRED_FIELDS and want to\nallow creating an instance instead of entering the primary key of an existing\ninstance. django.contrib.contenttypes ¶ remove_stale_contenttypes ¶ django-admin remove_stale_contenttypes ¶ This command is only available if Django’s contenttypes app ( django.contrib.contenttypes ) is installed. Deletes stale content types (from deleted models) in your database. Any objects\nthat depend on the deleted content types will also be deleted. A list of\ndeleted objects will be displayed before you confirm it’s okay to proceed with\nthe deletion. --database DATABASE ¶ Specifies the database to use. Defaults to default . --include-stale-apps ¶ Deletes stale content types including ones from previously installed apps that\nhave been removed from INSTALLED_APPS . Defaults to False . django.contrib.gis ¶ ogrinspect ¶ This command is only available if GeoDjango ( django.contrib.gis ) is installed. Please refer to its description in the GeoDjango\ndocumentation. django.contrib.sessions ¶ clearsessions ¶ django-admin clearsessions ¶ Can be run as a cron job or directly to clean out expired sessions. django.contrib.staticfiles ¶ collectstatic ¶ This command is only available if the static files application ( django.contrib.staticfiles ) is installed. Please refer to its description in the staticfiles documentation. findstatic ¶ This command is only available if the static files application ( django.contrib.staticfiles ) is installed. Please refer to its description in the staticfiles documentation. Default options ¶ Although some commands may allow their own custom options, every command\nallows for the following options by default: --pythonpath PYTHONPATH ¶ Adds the given filesystem path to the Python sys.path module\nattribute. If this isn’t provided, django-admin will use the PYTHONPATH environment variable. This option is unnecessary in manage.py , because it takes care of setting\nthe Python path for you. Example usage: django-admin migrate --pythonpath='/home/djangoprojects/myproject' --settings SETTINGS ¶ Specifies the settings module to use. The settings module should be in Python\npackage syntax, e.g. mysite.settings . If this isn’t provided, django-admin will use the DJANGO_SETTINGS_MODULE environment\nvariable. This option is unnecessary in manage.py , because it uses settings.py from the current project by default. Example usage: django-admin migrate --settings=mysite.settings --traceback ¶ Displays a full stack trace when a CommandError is raised. By default, django-admin will show an error message when a CommandError occurs and a full stack trace for any other exception. This option is ignored by runserver . Example usage: django-admin migrate --traceback --verbosity {0,1,2,3} , -v {0,1,2,3} ¶ Specifies the amount of notification and debug information that a command\nshould print to the console. 0 means no output. 1 means normal output (default). 2 means verbose output. 3 means very verbose output. This option is ignored by runserver . Example usage: django-admin migrate --verbosity 2 --no-color ¶ Disables colorized command output.  Some commands format their output to be\ncolorized. For example, errors will be printed to the console in red and SQL\nstatements will be syntax highlighted. Example usage: django-admin runserver --no-color --force-color ¶ Forces colorization of the command output if it would otherwise be disabled\nas discussed in Syntax coloring . For example, you may want to pipe\ncolored output to another command. --skip-checks ¶ Skips running system checks prior to running the command. This option is only\navailable if the requires_system_checks command\nattribute is not an empty list or tuple. Example usage: django-admin migrate --skip-checks Extra niceties ¶ Syntax coloring ¶ DJANGO_COLORS ¶ The django-admin / manage.py commands will use pretty\ncolor-coded output if your terminal supports ANSI-colored output. It\nwon’t use the color codes if you’re piping the command’s output to\nanother program unless the --force-color option is used. Windows support ¶ On Windows 10, the Windows Terminal application, VS Code , and PowerShell\n(where virtual terminal processing is enabled) allow colored output, and are\nsupported by default. Under Windows, the legacy cmd.exe native console doesn’t support ANSI\nescape sequences so by default there is no color output. In this case either of\ntwo third-party libraries are needed: Install colorama , a Python package that translates ANSI color codes\ninto Windows API calls. Django commands will detect its presence and will\nmake use of its services to color output just like on Unix-based platforms. colorama can be installed via pip: ...\\> py -m pip install \"colorama >= 0.4.6\" Install ANSICON , a third-party tool that allows cmd.exe to process\nANSI color codes. Django commands will detect its presence and will make use\nof its services to color output just like on Unix-based platforms. Other modern terminal environments on Windows, that support terminal colors,\nbut which are not automatically detected as supported by Django, may “fake” the\ninstallation of ANSICON by setting the appropriate environmental variable, ANSICON=\"on\" . Custom colors ¶ The colors used for syntax highlighting can be customized. Django\nships with three color palettes: dark , suited to terminals that show white text on a black\nbackground. This is the default palette. light , suited to terminals that show black text on a white\nbackground. nocolor , which disables syntax highlighting. You select a palette by setting a DJANGO_COLORS environment\nvariable to specify the palette you want to use. For example, to\nspecify the light palette under a Unix or OS/X BASH shell, you\nwould run the following at a command prompt: export DJANGO_COLORS = \"light\" You can also customize the colors that are used. Django specifies a\nnumber of roles in which color is used: error - A major error. notice - A minor error. success - A success. warning - A warning. sql_field - The name of a model field in SQL. sql_coltype - The type of a model field in SQL. sql_keyword - An SQL keyword. sql_table - The name of a model in SQL. http_info - A 1XX HTTP Informational server response. http_success - A 2XX HTTP Success server response. http_not_modified - A 304 HTTP Not Modified server response. http_redirect - A 3XX HTTP Redirect server response other than 304. http_not_found - A 404 HTTP Not Found server response. http_bad_request - A 4XX HTTP Bad Request server response other than 404. http_server_error - A 5XX HTTP Server Error response. migrate_heading - A heading in a migrations management command. migrate_label - A migration name. Each of these roles can be assigned a specific foreground and\nbackground color, from the following list: black red green yellow blue magenta cyan white Each of these colors can then be modified by using the following\ndisplay options: bold underscore blink reverse conceal A color specification follows one of the following patterns: role=fg role=fg/bg role=fg,option,option role=fg/bg,option,option where role is the name of a valid color role, fg is the\nforeground color, bg is the background color and each option is one of the color modifying options. Multiple color specifications\nare then separated by a semicolon. For example: export DJANGO_COLORS = \"error=yellow/blue,blink;notice=magenta\" would specify that errors be displayed using blinking yellow on blue,\nand notices displayed using magenta. All other color roles would be\nleft uncolored. Colors can also be specified by extending a base palette. If you put\na palette name in a color specification, all the colors implied by that\npalette will be loaded. So: export DJANGO_COLORS = \"light;error=yellow/blue,blink;notice=magenta\" would specify the use of all the colors in the light color palette, except for the colors for errors and notices which would be\noverridden as specified. Bash completion ¶ If you use the Bash shell, consider installing the Django bash completion\nscript, which lives in extras/django_bash_completion in the Django source\ndistribution. It enables tab-completion of django-admin and manage.py commands, so you can, for instance… Type django-admin . Press [TAB] to see all available options. Type sql , then [TAB], to see all available options whose names start\nwith sql . See How to create custom django-admin commands for how to add customized actions. Black formatting ¶ The Python files created by startproject , startapp , optimizemigration , makemigrations , and squashmigrations are formatted using the black command if it is\npresent on your PATH . If you have black globally installed, but do not wish it used for the\ncurrent project, you can set the PATH explicitly: PATH = path/to/venv/bin django-admin makemigrations For commands using stdout you can pipe the output to black if needed: django-admin inspectdb | black - Running management commands from your code ¶ django.core.management. call_command ( name , * args , ** options ) ¶ To call a management command from code use call_command() . name the name of the command to call or a command object. Passing the name is\npreferred unless the object is required for testing. *args a list of arguments accepted by the command. Arguments are passed to the\nargument parser, so you can use the same style as you would on the command\nline. For example, call_command('flush', '--verbosity=0') . **options named options accepted on the command-line. Options are passed to the command\nwithout triggering the argument parser, which means you’ll need to pass the\ncorrect type. For example, call_command('flush', verbosity=0) (zero must\nbe an integer rather than a string). Examples: from django.core import management from django.core.management.commands import loaddata management . call_command ( \"flush\" , verbosity = 0 , interactive = False ) management . call_command ( \"loaddata\" , \"test_data\" , verbosity = 0 ) management . call_command ( loaddata . Command (), \"test_data\" , verbosity = 0 ) Note that command options that take no arguments are passed as keywords\nwith True or False , as you can see with the interactive option above. Named arguments can be passed by using either one of the following syntaxes: # Similar to the command line management . call_command ( \"dumpdata\" , \"--natural-foreign\" ) # Named argument similar to the command line minus the initial dashes and # with internal dashes replaced by underscores management . call_command ( \"dumpdata\" , natural_foreign = True ) # `use_natural_foreign_keys` is the option destination variable management . call_command ( \"dumpdata\" , use_natural_foreign_keys = True ) Some command options have different names when using call_command() instead\nof django-admin or manage.py . For example, django-admin createsuperuser --no-input translates to call_command('createsuperuser', interactive=False) . To find what keyword argument name to use for call_command() , check the command’s source code for the dest argument\npassed to parser.add_argument() . Command options which take multiple options are passed a list: management . call_command ( \"dumpdata\" , exclude = [ \"contenttypes\" , \"auth\" ]) The return value of the call_command() function is the same as the return\nvalue of the handle() method of the command. Output redirection ¶ Note that you can redirect standard output and error streams as all commands\nsupport the stdout and stderr options. For example, you could write: with open ( \"/path/to/command_output\" , \"w\" ) as f : management . call_command ( \"dumpdata\" , stdout = f )", "keywords": ["users", "accounts", "streams", "feature", "--tag", "commanderror", "pattern", "underscores", "startup", "searches", "messages", "secret/*.html", "background", "--addrport", "platforms", "guess", "nocolor", "field", "#", "allows", "faulthandler", "prints", "runner", "table(s", "serialization", "ansicon", "migrations", "terminal", "bar@example.com", "venv", "text", "+", "django_settings_module", "numbers", "psql", "/users", "host", "lines", "resetting", "subset", ".tgz", "http_server_error", "cache", "compatibility", "clearsessions", "serializemixin", "platform", "django.db.migrations.operations", "pycache", "username_field", "tool", "change", "https", "vs", "ports", "suite", "presence", "destination", "hash", "http", "=", "changes", "sqlmigrate", "engine", "message", "installation", "relationship", "n", "shell", "call_command", "pdb", "setup", "tables", "tag", "filesystem", "postgres", "sorts", "spawns", "pip", "--debug", "diverts", "ansi", "process", "debug", "migration(s", "mysite.settings", "topic", "multiple", "compression", "following", "type", "processing", "ringo", "bdb", "calls", "custom", "objects", "documentation", "hundreds", ".po", "-x", "optimization", "--ipv6", "discoverrunner", "file", "root_urlconf", "partition", "constraint", "modules", "user", ".tar.bz2", "processors", "cases", "--no", "--fake", "js", "attribute", "args", "django.contrib.gis", "start_migration_name", "txt", "warning", "size", "time", "tags", "-p", ":1", "install", "risk", "enforce", ".tar.lzma", "setting", "startapp", "account", "app_label", "restart", "service", "things", "tracebacks", "password", "orderings", "stray", "ignore", "name", "makemigrations", "interpreter", "test_runner", "execution", "project_name", "web", "django.contrib.auth", "foreground", "problems", "--add", "192.168.2.1", "modification", "http_not_modified", "notification", "xgettext", "manager", "github", "mysite.blog", "partitions", "uses", "addresses", "return", "reverse", "deletion", "applications", "handlers", "http_not_found", "memory", "site(s", "environments", "isolation", "recipient(s", "textfield", "blog", "commas", "colorization", "examples", "failure", "django.contrib.staticfiles", "category", "username", "status", ".txt", "extras", "tree", "plan", "url", "guarantees", "error", "timeout", "module", "collectstatic", "code", "--database", "django_test_processes", "auth", "subprocesses", "createmodel", "info", "behavior", "false", "access", "manage.py", "class", "migration", ".zip", "display", "style", "redirection", "archive", "----------------------+", "green", "names", "javascript", "x", "templatetag", "--shuffle", "palette", "request", "formatting", "current_user", "database", "flag", "output", "input", "privileges", "myproject_repo", "*", "app_directory", "query", "test", "commands", "postgresql", "migrate", "django_version", "types", "sqlplus", "locales", "strings", "threading", "-l", "py", "wsgi_application", "admin", "creation", "daphne", "direction", "usage", "sequences", "djangoprojects", "xml", "wsgi", "configuration", "ascii", "yellow", "script", "role", "validation", "1.x", "flexibility", "create", "get_input_data", "pt_br", "foreign", "section", "/", "source", "specification", "sequence", "ipdb", "underscore", "css", "testserver", "use", "call_command('flush", "dbshell", "environment", "eof", "static_root", "a", "gettext", "engines", "project_directory", "performance", "--list", "extensions", "core", "pass", "call_command('createsuperuser", "order", "default", "specifications", "bug", "comment", "form", "pywatchman", "signals", "prefix", "dash", "option", "troubleshoot", "format", "comma", "help", "tests", "django_watchman_timeout", "characters", "classes", "sys.stdin", "reduction", "localhost:8000", "mail_admins", "ipython", "fixture", "black", "advantage", "sql_keyword", "f", "-6", "contrib.auth", "bz2", "media_root", "combination", "createsuperuser", "timestamps", "limitation", "indentation", "--exclude", "marks", "template", "sys.path", "header", "schema", "traceback", "natural_foreign", "way", "django.contrib.postgres", "console", "formats", "checks", "servers", ".py", "generate", "customizations", "fr", "macos", ".txz", "party", "symlinks", "completion", "integer", "requires_system_checks", "notices", "¶", "command", "internationalization", "spaces", ".pyc", "parameters", "ansicon=\"on", "kernel", "services", "glob", "linux", "property", "node_modules", "--output", "exclude_tags", "content", "primary", "remove_stale_contenttypes", "terminals", "keywords", "function", "views", "mydata.json", "testing", "result", "color", "django.contrib.sessions", "run", "indexes", "number", "cyan", "permissions", "fashion", "datetimes", "test_data", "0.0.0.0", "values", "staticfiles", "lzma", "repl", "deserialization", "enables", ".git", "failures", "tblib", "directories", "django.contrib", "palettes", "string", "discards", "program", "_", "debugger", "windows", "django.core", "unix", "prod", "-r", "thing", "bash", "auto", "databases", "timestamp", "shuffling", "timings", "managers", "unit", "exclude", "location", "table", "libraries", "language", "models", "suppresses", "copy", "exit", "ipv6", "version", "ways", "level", "json", "loading", "contents", "my_app_template", "machine", "syntaxes", "dashes", "labels", "hostname", "divider", "githubuser", "parser", "django", "-c", "foo@example.com", "myapp", "n’t", "filename", "brackets", "fields", "xz", "ip", "dumpdata", "excludes", "languages", "set", "development", "for_field", "power", "os", "tab", "redirections", "colors", "value", "media", "legacy", "sync", "cores", "line", "codes", "conceal", "contenttype", "pep", "data", "implementation", "orders", "reloader", "browser", "production_settings", "prompts", "scope", "outdated/*/locale", "-a", "modelname", "mails", "base", "resources", "backend", "w", "machines", "projectname", "runsql", "identifier", "prevents", "disables", "omitting", "security", "updates", "shortcut", "--include", "coloring", "paths", "need", "outputs", "instance", "diffsettings", "effects", "localization", "select.select", "powershell", "makemessages", "sqlflush", "http_redirect", "extension", "interface", "django.server", "|", "report", "pot", "trace", "polling", "cron", "niceties", "byte", "issues", "obsolete", "jezdez", "superuser", "docstring", "lifecycle", "structure", "stdout", "--pythonpath='/home", "sql_field", "part", "fixtures", "migrate_label", "merges", "object", "basename", "camel_case_app_name", "deployment", "domain", "couple", ".tlz", "colorama", "cmd.exe", "magenta", "contrib.contenttypes", "diff", "response", "management", "mail_managers", "utility", "sql", "instructions", "syncdb", "locale", "application(s", "fly", "compilemessages", "red", "--symlinks", "rendering", "keyword", "sqlsequencereset", "logger", "parallelization", "fg", "working", "notice", "rules", "variables", "optimizemigration", "integration", "root", "1.2.3.4:8000", "notes", "debugging", "controls", "redirect", "--default", "optimizer", "runpython", "effect", "staging", "detail", "system", "apps", "port", "address", "django.contrib.contenttypes", "conf", "watchman", "dependencies", "blue", "archives", "django_bash_completion", "use_natural_foreign_keys", "bpython", "loaddata", "production", "escape", "programs", "--skip", "verbosity=0", "processes", "target", "check", "djangojs", "site", "sqlite3", "behalf", "consistency", "packaging", "roles", "addition", "lists", "example", "care", "django.core.management", "app", "progress", "fixture1", "i18n", "parallel", "column", "list", "informational", "locale_paths", ".tar.xz", "seconds", "--traceback", "detection", "runserver", ".pot", "django_superuser_password", "locale(s", "recovery", "arrangement", "export", "--settings", "displays", "ogrinspect", "email", "steps", "stack", "re", "app(s", "-u", "randomizes", "variable", "model", "--ignore", "word", "place", "~/.pythonrc.py", "systems", "findstatic", "application", "--extension", "bin", "actions", "conflicts", "multiprocessing.cpu_count", "media_url", "editing", "testcase", "stdin", "fixture(s", "differences", "http_bad_request", "localhost", "asgi", "audits", "cvs", "optimizes", "dev", "squashing", "seed", "testrunner", "translation", "syntax", "modifying", "critical", ".js", "camel", "ones", "keys", "name(s", "case", ".mo", "recognition", "authentication", "conjunction", "runtime", "isolation_level", "network", "html", "errors", "job", "showmigrations", "tuple", "server", "arguments", "package", "light", "one", "translations", "generation", "removes", "end", ".tbz2", "entries", "records", "wrap", "sqlite", "contrib", "-s", "bdbquit", "startproject", "matching", "ftp", "django_superuser_<uppercase_field_name", "verbosity", ".html", "tpl", "secret_key", "amount", "bar", "1.2.0", "path", "contenttypes", "depth", "functions", "--fail", "key", "operations", "stops", "success", "handle", "inspectdb", "none", "0.4.6", "distribution", "problem", "highlighting", "sign", "specifies", "meta", "--template=/users", "patterns", "fixture2", "to", "prompt", "framework", "-style", "sql_coltype", "new", "changepassword", "semicolon", "true", "--format", "\\", "urls", "api", "sessions", "support", "description", "django.core.management.commands", "mode", "db_column", "document", "projects", "skips", "-", "connection", "--app", "context", "runs", "permission", "limits", "--force", "files", "import", "squashmigrations", "optimize", "migrationname", "admins", "migration_name", "repositories", "compiles", "mysql", "directory", "defaults", "statements", "call", "compile", "heading", "foreignkey", "--email", "docs_version", "information", "row", "images", "python", "pythonpath", "translators", "trust", "methods", "command_output", "options", "times", "exception", "client", "-i", "details", "method", "geodjango", "forces", "settings", "ships", "argument", "blink;notice", "note", "pythonstartup", "state", "tasks", "addrport", "oracle", "/path", "templates", "sendtestemail", "zip", "project", "parts"], "type": "documentation"},
{"title": "The staticfiles app | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/staticfiles/", "content": "The staticfiles app ¶ django.contrib.staticfiles collects static files from each of your\napplications (and any other places you specify) into a single location that\ncan easily be served in production. See also For an introduction to the static files app and some usage examples, see How to manage static files (e.g. images, JavaScript, CSS) . For guidelines on deploying static files,\nsee How to deploy static files . Settings ¶ See staticfiles settings for details on the\nfollowing settings: STORAGES STATIC_ROOT STATIC_URL STATICFILES_DIRS STATICFILES_FINDERS Management Commands ¶ django.contrib.staticfiles exposes three management commands. collectstatic ¶ django-admin collectstatic ¶ Collects the static files into STATIC_ROOT . Duplicate file names are by default resolved in a similar way to how template\nresolution works: the file that is first found in one of the specified\nlocations will be used. If you’re confused, the findstatic command\ncan help show you which files are found. On subsequent collectstatic runs (if STATIC_ROOT isn’t empty), files\nare copied only if they have a modified timestamp greater than the timestamp of\nthe file in STATIC_ROOT . Therefore if you remove an application from INSTALLED_APPS , it’s a good idea to use the collectstatic --clear option in order to remove stale static files. Files are searched by using the enabled finders . The default is to look in all locations defined in STATICFILES_DIRS and in the 'static' directory of apps\nspecified by the INSTALLED_APPS setting. The collectstatic management command calls the post_process() method of the staticfiles storage backend from STORAGES after\neach run and passes a list of paths that have been found by the management\ncommand. It also receives all command line options of collectstatic .\nThis is used by the ManifestStaticFilesStorage by\ndefault. By default, collected files receive permissions from FILE_UPLOAD_PERMISSIONS and collected directories receive permissions\nfrom FILE_UPLOAD_DIRECTORY_PERMISSIONS . If you would like different\npermissions for these files and/or directories, you can subclass either of the static files storage classes and specify the file_permissions_mode and/or directory_permissions_mode parameters,\nrespectively. For example: from django.contrib.staticfiles import storage class MyStaticFilesStorage ( storage . StaticFilesStorage ): def __init__ ( self , * args , ** kwargs ): kwargs [ \"file_permissions_mode\" ] = 0o640 kwargs [ \"directory_permissions_mode\" ] = 0o760 super () . __init__ ( * args , ** kwargs ) Then set the staticfiles storage backend in STORAGES setting to 'path.to.MyStaticFilesStorage' . Some commonly used options are: --noinput , --no-input ¶ Do NOT prompt the user for input of any kind. --ignore PATTERN , -i PATTERN ¶ Ignore files, directories, or paths matching this glob-style pattern. Use\nmultiple times to ignore more. When specifying a path, always use forward\nslashes, even on Windows. --dry-run , -n ¶ Do everything except modify the filesystem. --clear , -c ¶ Clear the existing files before trying to copy or link the original file. --link , -l ¶ Create a symbolic link to each file instead of copying. --no-post-process ¶ Don’t call the post_process() method of the configured staticfiles storage backend from STORAGES . --no-default-ignore ¶ Don’t ignore the common private glob-style patterns 'CVS' , '.*' and '*~' . For a full list of options, refer to the commands own help by running: /  $ python manage.py collectstatic --help ...\\> py manage.py collectstatic --help Customizing the ignored pattern list ¶ The default ignored pattern list, ['CVS', '.*', '*~'] , can be customized in\na more persistent way than providing the --ignore command option at each collectstatic invocation. Provide a custom AppConfig class, override the ignore_patterns attribute of this class and replace 'django.contrib.staticfiles' with that class path in your INSTALLED_APPS setting: from django.contrib.staticfiles.apps import StaticFilesConfig class MyStaticFilesConfig ( StaticFilesConfig ): ignore_patterns = [ ... ] # your custom ignore list findstatic ¶ django-admin findstatic staticfile [staticfile ...] ¶ Searches for one or more relative paths with the enabled finders. For example: /  $ python manage.py findstatic css/base.css admin/js/core.js Found 'css/base.css' here: /home/special.polls.com/core/static/css/base.css /home/polls.com/core/static/css/base.css Found 'admin/js/core.js' here: /home/polls.com/src/django/contrib/admin/media/js/core.js ...\\> py manage.py findstatic css\\base.css admin\\js\\core.js Found 'css/base.css' here: /home/special.polls.com/core/static/css/base.css /home/polls.com/core/static/css/base.css Found 'admin/js/core.js' here: /home/polls.com/src/django/contrib/admin/media/js/core.js findstatic --first ¶ By default, all matching locations are found. To only return the first match\nfor each relative path, use the --first option: /  $ python manage.py findstatic css/base.css --first Found 'css/base.css' here: /home/special.polls.com/core/static/css/base.css ...\\> py manage.py findstatic css\\base.css --first Found 'css/base.css' here: /home/special.polls.com/core/static/css/base.css This is a debugging aid; it’ll show you exactly which static file will be\ncollected for a given path. By setting the --verbosity flag to 0, you can suppress the extra output and\njust get the path names: /  $ python manage.py findstatic css/base.css --verbosity 0 /home/special.polls.com/core/static/css/base.css /home/polls.com/core/static/css/base.css ...\\> py manage.py findstatic css\\base.css --verbosity 0 /home/special.polls.com/core/static/css/base.css /home/polls.com/core/static/css/base.css On the other hand, by setting the --verbosity flag to 2, you can get all\nthe directories which were searched: /  $ python manage.py findstatic css/base.css --verbosity 2 Found 'css/base.css' here: /home/special.polls.com/core/static/css/base.css /home/polls.com/core/static/css/base.css Looking in the following locations: /home/special.polls.com/core/static /home/polls.com/core/static /some/other/path/static ...\\> py manage.py findstatic css\\base.css --verbosity 2 Found 'css/base.css' here: /home/special.polls.com/core/static/css/base.css /home/polls.com/core/static/css/base.css Looking in the following locations: /home/special.polls.com/core/static /home/polls.com/core/static /some/other/path/static runserver ¶ django-admin runserver [addrport] Overrides the core runserver command if the staticfiles app\nis installed and adds automatic serving of static\nfiles. File serving doesn’t run through MIDDLEWARE . The command adds these options: --nostatic ¶ Use the --nostatic option to disable serving of static files with the staticfiles app entirely. This option is\nonly available if the staticfiles app is\nin your project’s INSTALLED_APPS setting. Example usage: /  $ django-admin runserver --nostatic ...\\> django-admin runserver --nostatic --insecure ¶ Use the --insecure option to force serving of static files with the staticfiles app even if the DEBUG setting is False . By using this you acknowledge the fact that it’s grossly inefficient and probably insecure . This is only intended for\nlocal development, should never be used in production and is only\navailable if the staticfiles app is\nin your project’s INSTALLED_APPS setting. --insecure doesn’t work with ManifestStaticFilesStorage . Example usage: /  $ django-admin runserver --insecure ...\\> django-admin runserver --insecure Storages ¶ StaticFilesStorage ¶ class storage. StaticFilesStorage ¶ A subclass of the FileSystemStorage storage backend that uses the STATIC_ROOT setting as the base\nfile system location and the STATIC_URL setting respectively\nas the base URL. storage.StaticFilesStorage. post_process ( paths , ** options ) ¶ If this method is defined on a storage, it’s called by the collectstatic management command after each run and gets passed the\nlocal storages and paths of found files as a dictionary, as well as the command\nline options. It yields tuples of three values: original_path, processed_path, processed . The path values are strings and processed is a boolean indicating whether or not the value was\npost-processed, or an exception if post-processing failed. The ManifestStaticFilesStorage uses this behind the scenes to replace the paths with their hashed\ncounterparts and update the cache appropriately. ManifestStaticFilesStorage ¶ class storage. ManifestStaticFilesStorage ¶ A subclass of the StaticFilesStorage storage backend which stores the file names it handles by appending the MD5\nhash of the file’s content to the filename. For example, the file css/styles.css would also be saved as css/styles.55e7cbb9ba48.css . The purpose of this storage is to keep serving the old files in case some\npages still refer to those files, e.g. because they are cached by you or\na 3rd party proxy server. Additionally, it’s very helpful if you want to\napply far future Expires headers to the deployed files to speed up the\nload time for subsequent page visits. The storage backend automatically replaces the paths found in the saved\nfiles matching other saved files with the path of the cached copy (using\nthe post_process() method). The regular expressions used to find those paths\n( django.contrib.staticfiles.storage.HashedFilesMixin.patterns ) cover: The @import rule and url() statement of Cascading Style Sheets . Source map comments in CSS and JavaScript files. Subclass ManifestStaticFilesStorage and set the support_js_module_import_aggregation attribute to True , if you want to\nuse the experimental regular expressions to cover: The modules import in JavaScript. The modules aggregation in JavaScript. For example, the 'css/styles.css' file with this content: @ import url ( \"../admin/css/base.css\" ) ; …would be replaced by calling the url() method of the ManifestStaticFilesStorage storage backend, ultimately saving a 'css/styles.55e7cbb9ba48.css' file with the following content: @ import url ( \"../admin/css/base.27e20196a850.css\" ) ; Usage of the integrity HTML attribute with local files When using the optional integrity attribute within tags like <script> or <link> , its value should be calculated based on the\nfiles as they are served, not as stored in the filesystem. This is\nparticularly important because depending on how static files are collected,\ntheir checksum may have changed (for example when using collectstatic ). At the moment, there is no out-of-the-box\ntooling available for this. You can change the location of the manifest file by using a custom ManifestStaticFilesStorage subclass that sets the manifest_storage argument. For example: from django.conf import settings from django.contrib.staticfiles.storage import ( ManifestStaticFilesStorage , StaticFilesStorage , ) class MyManifestStaticFilesStorage ( ManifestStaticFilesStorage ): def __init__ ( self , * args , ** kwargs ): manifest_storage = StaticFilesStorage ( location = settings . BASE_DIR ) super () . __init__ ( * args , manifest_storage = manifest_storage , ** kwargs ) References in comments ManifestStaticFilesStorage doesn’t ignore paths in statements that are\ncommented out. This may crash on the nonexistent paths .\nYou should check and eventually strip comments. storage.ManifestStaticFilesStorage. manifest_hash ¶ This attribute provides a single hash that changes whenever a file in the\nmanifest changes. This can be useful to communicate to SPAs that the assets on\nthe server have changed (due to a new deployment). storage.ManifestStaticFilesStorage. max_post_process_passes ¶ Since static files might reference other static files that need to have their\npaths replaced, multiple passes of replacing paths may be needed until the file\nhashes converge. To prevent an infinite loop due to hashes not converging (for\nexample, if 'foo.css' references 'bar.css' which references 'foo.css' ) there is a maximum number of passes before post-processing is\nabandoned. In cases with a large number of references, a higher number of\npasses might be needed. Increase the maximum number of passes by subclassing ManifestStaticFilesStorage and setting the max_post_process_passes attribute. It defaults to 5. To enable the ManifestStaticFilesStorage you have to make sure the\nfollowing requirements are met: the staticfiles storage backend in STORAGES setting is set to 'django.contrib.staticfiles.storage.ManifestStaticFilesStorage' the DEBUG setting is set to False you’ve collected all your static files by using the collectstatic management command Since creating the MD5 hash can be a performance burden to your website\nduring runtime, staticfiles will automatically store the mapping with\nhashed names for all processed files in a file called staticfiles.json .\nThis happens once when you run the collectstatic management\ncommand. storage.ManifestStaticFilesStorage. manifest_strict ¶ If a file isn’t found in the staticfiles.json manifest at runtime, a ValueError is raised. This behavior can be disabled by subclassing ManifestStaticFilesStorage and setting the manifest_strict attribute to False – nonexistent paths will remain unchanged. Due to the requirement of running collectstatic , this storage\ntypically shouldn’t be used when running tests as collectstatic isn’t run\nas part of the normal test setup. During testing, ensure that staticfiles storage backend in the STORAGES setting is set to something else\nlike 'django.contrib.staticfiles.storage.StaticFilesStorage' (the default). storage.ManifestStaticFilesStorage. file_hash ( name , content = None ) ¶ The method that is used when creating the hashed name of a file.\nNeeds to return a hash for the given file name and content.\nBy default it calculates a MD5 hash from the content’s chunks as\nmentioned above. Feel free to override this method to use your own\nhashing algorithm. ManifestFilesMixin ¶ class storage. ManifestFilesMixin ¶ Use this mixin with a custom storage to append the MD5 hash of the file’s\ncontent to the filename as ManifestStaticFilesStorage does. Finders Module ¶ staticfiles finders has a searched_locations attribute which is a list\nof directory paths in which the finders searched. Example usage: from django.contrib.staticfiles import finders result = finders . find ( \"css/base.css\" ) searched_locations = finders . searched_locations Other Helpers ¶ There are a few other helpers outside of the staticfiles app to work with static\nfiles: The django.template.context_processors.static() context processor\nwhich adds STATIC_URL to every template context rendered\nwith RequestContext contexts. The builtin template tag static which takes a path and urljoins it\nwith the static prefix STATIC_URL . If django.contrib.staticfiles is installed, the tag uses the url() method of the staticfiles storage backend from STORAGES instead. The builtin template tag get_static_prefix which populates a\ntemplate variable with the static prefix STATIC_URL to be\nused as a variable or directly. The similar template tag get_media_prefix which works like get_static_prefix but uses MEDIA_URL . The staticfiles key in django.core.files.storage.storages contains a ready-to-use instance of the staticfiles storage backend. Static file development view ¶ The static files tools are mostly designed to help with getting static files\nsuccessfully deployed into production. This usually means a separate,\ndedicated static file server, which is a lot of overhead to mess with when\ndeveloping locally. Thus, the staticfiles app ships with a quick and dirty helper view that you can use to serve files locally in\ndevelopment. views. serve ( request , path ) ¶ This view function serves static files in development. Warning This view will only work if DEBUG is True . That’s because this view is grossly inefficient and probably insecure . This is only intended for local development, and should never be used in production . Note To guess the served files’ content types, this view relies on the mimetypes module from the Python standard library, which itself\nrelies on the underlying platform’s map files. If you find that this view\ndoesn’t return proper content types for certain files, it is most likely\nthat the platform’s map files are incorrect or need to be updated. This can\nbe achieved, for example, by installing or updating the mailcap package\non a Red Hat distribution, mime-support on a Debian distribution, or by\nediting the keys under HKEY_CLASSES_ROOT in the Windows registry. This view is automatically enabled by runserver (with a DEBUG setting set to True ). To use the view with a different\nlocal development server, add the following snippet to the end of your\nprimary URL configuration: from django.conf import settings from django.contrib.staticfiles import views from django.urls import re_path if settings . DEBUG : urlpatterns += [ re_path ( r \"^static/(?P<path>.*)$\" , views . serve ), ] Note, the beginning of the pattern ( r'^static/' ) should be your STATIC_URL setting. Since this is a bit finicky, there’s also a helper function that’ll do this for\nyou: urls. staticfiles_urlpatterns () ¶ This will return the proper URL pattern for serving static files to your\nalready defined pattern list. Use it like this: from django.contrib.staticfiles.urls import staticfiles_urlpatterns # ... the rest of your URLconf here ... urlpatterns += staticfiles_urlpatterns () This will inspect your STATIC_URL setting and wire up the view\nto serve static files accordingly. Don’t forget to set the STATICFILES_DIRS setting appropriately to let django.contrib.staticfiles know where to look for files in addition to\nfiles in app directories. Warning This helper function will only work if DEBUG is True and your STATIC_URL setting is neither empty nor a full\nURL such as http://static.example.com/ . That’s because this view is grossly inefficient and probably insecure . This is only intended for local development, and should never be used in production . Specialized test case to support ‘live testing’ ¶ class testing. StaticLiveServerTestCase ¶ This unittest TestCase subclass extends django.test.LiveServerTestCase . Just like its parent, you can use it to write tests that involve running the\ncode under test and consuming it with testing tools through HTTP (e.g. Selenium,\nPhantomJS, etc.), because of which it’s needed that the static assets are also\npublished. But given the fact that it makes use of the django.contrib.staticfiles.views.serve() view described above, it can\ntransparently overlay at test execution-time the assets provided by the staticfiles finders. This means you don’t need to run collectstatic before or as a part of your tests setup.", "keywords": ["box", "storage", "pattern", "searches", "library", "manifest_hash", "#", "+", "loop", "mess", "match", "wire", "cache", "platform", "tooling", "django.urls", "hash", "http", "=", "changes", "fact", "manifeststaticfilesstorage", "setup", "tag", "filesystem", "foo.css", "bar.css", "places", "debug", "cascading", "phantomjs", "file_permissions_mode", "processing", "custom", "kwargs", "django.contrib.staticfiles.urls", "file", "modules", "user", "cases", "--no", "js", "helper", "attribute", "args", "scenes", "--nostatic", "re_path", "time", "tags", "setting", "--insecure", "support_js_module_import_aggregation", "ignore", "name", "admin\\js\\core.js", "rule", "execution", "visits", "get_static_prefix", "clear", "staticfilesconfig", "static_url", "applications", "expressions", "parent", "requirement", "django.contrib.staticfiles", "examples", "manifest_storage", "mystaticfilesconfig", "proxy", "url", "guidelines", "collectstatic", "module", "code", "algorithm", "css\\base.css", "pages", "style", "false", "behavior", "link", "class", "manage.py", "django.contrib.staticfiles.views.serve", "names", "javascript", "snippet", "request", "flag", "output", "input", "*", "page", "test", "commands", "types", "strings", "-l", "py", "subclass", "burden", "admin", "usage", "mixin", "registry", "configuration", "script", "sheets", "/", "source", "django.core.files.storage.storages", "css", "use", "static_root", "performance", "core", "order", "core.js", "default", "@import", "file_upload_directory_permissions", "prefix", "option", "special.polls.com", "classes", "help", "tests", "styles.css", "get_media_prefix", "src", "template", "way", "staticliveservertestcase", "super", "comments", "party", "¶", "command", "parameters", "post", "hkey_classes_root", "content", "function", "views", "testing", "integrity", "view", "run", "number", "lot", "permissions", "def", "staticfiles", "values", "directories", "windows", "mapping", "passes", "searched_locations", "timestamp", "mime", "staticfiles_dirs", "hand", "location", "copy", "manifest", "processor", "mailcap", "path>.*)$", "django", "n’t", "filename", "set", "development", "urlpatterns", "value", "media", "line", "bit", "ignore_patterns", "base", "backend", "file_upload_permissions", "django.contrib.staticfiles.apps", "paths", "self", "instance", "aggregation", "base.css", "http://static.example.com/", "invocation", "assets", "statement", "installed_apps", "part", "filesystemstorage", "references", "processed_path", "load", "deployment", "valueerror", "slashes", "management", "website", "dictionary", "red", "resolution", "rest", "directory_permissions_mode", "system", "apps", "django.contrib.staticfiles.storage", "overhead", "production", "storages", "base.27e20196a850.css", "mystaticfilesstorage", "headers", "styles.55e7cbb9ba48.css", "addition", "example", "app", "requirements", "locations", "list", "staticfiles.json", "finders", "runserver", "post_process", "file_hash", "map", "mymanifeststaticfilesstorage", "md5", "variable", "hashes", "staticfiles_urlpatterns", "idea", "findstatic", "application", "media_url", "testcase", "urlconf", "cvs", "0o760", "manifest_strict", "contexts", "manifestfilesmixin", "keys", "case", "runtime", "html", "future", "server", "introduction", "r'^static/", "init", "static", "package", "middleware", "end", "contrib", "matching", "tuples", "kind", "helpers", "path", "key", "appconfig", "max_post_process_passes", "none", "distribution", "--verbosity", "django.contrib.staticfiles.storage.hashedfilesmixin.patterns", "patterns", "counterparts", "--first", "true", "\\", "urls", "spas", "support", "staticfilesstorage", "context", "runs", "files", "import", "statements", "directory", "chunks", "images", "python", "requestcontext", "checksum", "options", "times", "exception", "purpose", "-i", "details", "method", "settings", "ships", "argument", "hat", "tools", "mimetypes", "beginning", "moment", "selenium", "aid", "project", "base_dir"], "type": "documentation"},
{"title": "GeoDjango Management Commands | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/commands/", "content": "GeoDjango Management Commands ¶ inspectdb ¶ django-admin inspectdb When django.contrib.gis is in your INSTALLED_APPS , the inspectdb management command is overridden with one from GeoDjango.\nThe overridden command is spatially-aware, and places geometry fields in the\nauto-generated model definition, where appropriate. ogrinspect ¶ django-admin ogrinspect data_source model_name ¶ The ogrinspect management command will inspect the given OGR-compatible DataSource (e.g., a shapefile) and will\noutput a GeoDjango model with the given model name.  There’s a detailed example\nof using ogrinspect in the tutorial . --blank BLANK ¶ Use a comma separated list of OGR field names to add the blank=True keyword option to the field definition.  Set with true to apply\nto all applicable fields. --decimal DECIMAL ¶ Use a comma separated list of OGR float fields to generate DecimalField instead of the default FloatField . Set to true to apply to all\nOGR float fields. --geom-name GEOM_NAME ¶ Specifies the model attribute name to use for the geometry field.\nDefaults to 'geom' . --layer LAYER_KEY ¶ The key for specifying which layer in the OGR DataSource source to use.\nDefaults to 0 (the first layer). May be an integer or a string identifier\nfor the Layer . When inspecting databases, layer is generally the table name you want to inspect. --mapping ¶ Automatically generate a mapping dictionary for use with LayerMapping . --multi-geom ¶ When generating the geometry field, treat it as a geometry collection.\nFor example, if this setting is enabled then a MultiPolygonField will be placed\nin the generated model rather than PolygonField . --name-field NAME_FIELD ¶ Generates a __str__() method on the model that returns the given field\nname. --no-imports ¶ Suppresses the from django.contrib.gis.db import models import statement. --null NULL ¶ Use a comma separated list of OGR field names to add the null=True keyword option to the field definition.  Set with true to apply to\nall applicable fields. --srid SRID ¶ The SRID to use for the geometry field.  If not set, ogrinspect attempts\nto automatically determine of the SRID of the data source.", "keywords": ["layer_key", "str", "floatfield", "-", "model", "datasource", "float", "imports", "admin", "multipolygonfield", "import", "name", "management", "definition", "decimal", "--geom", "defaults", "dictionary", "django", "geometry", "=", "attempts", "layermapping", "decimalfield", "default", "fields", "keyword", "string", "example", "field", "key", "--no", "polygonfield", "attribute", "inspectdb", "compatible", "geodjango", "django.contrib.gis", "list", "option", "integer", "comma", "mapping", "method", "shapefile", "names", "¶", "specifies", "command", "auto", "databases", "model_name", "layer", "tutorial", "geom", "source", "data", "setting", "ogrinspect", "table", "django.contrib.gis.db", "statement", "null", "use", "models", "blank", "srid", "installed_apps", "commands", "suppresses", "collection", "ogr"], "type": "documentation"},
{"title": "The File object | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/files/file/", "content": "The File object ¶ The django.core.files module and its submodules contain built-in classes\nfor basic file handling in Django. The File class ¶ class File ( file_object , name = None ) [source] ¶ The File class is a thin wrapper around a Python file object with some Django-specific additions.\nInternally, Django uses this class when it needs to represent a file. File objects have the following attributes and methods: name ¶ The name of the file including the relative path from MEDIA_ROOT . size [source] ¶ The size of the file in bytes. file ¶ The underlying file object that this class wraps. Be careful with this attribute in subclasses. Some subclasses of File , including ContentFile and FieldFile , may replace this\nattribute with an object other than a Python file object .\nIn these cases, this attribute may itself be a File subclass (and not necessarily the same subclass). Whenever\npossible, use the attributes and methods of the subclass itself\nrather than the those of the subclass’s file attribute. mode ¶ The read/write mode for the file. open ( mode = None , * args , ** kwargs ) [source] ¶ Open or reopen the file (which also does File.seek(0) ).\nThe mode argument allows the same values\nas Python’s built-in open() . *args and **kwargs are passed after mode to Python’s built-in open() . When reopening a file, mode will override whatever mode the file\nwas originally opened with; None means to reopen with the original\nmode. It can be used as a context manager, e.g. with file.open() as f: . Changed in Django 5.0: Support for passing *args and **kwargs was added. __iter__ () [source] ¶ Iterate over the file yielding one line at a time. chunks ( chunk_size = None ) [source] ¶ Iterate over the file yielding “chunks” of a given size. chunk_size defaults to 64 KB. This is especially useful with very large files since it allows them to\nbe streamed off disk and avoids storing the whole file in memory. multiple_chunks ( chunk_size = None ) [source] ¶ Returns True if the file is large enough to require multiple chunks\nto access all of its content give some chunk_size . close () [source] ¶ Close the file. In addition to the listed methods, File exposes\nthe following attributes and methods of its file object: encoding , fileno , flush , isatty , newlines , read , readinto , readline , readlines , seek , tell , truncate , write , writelines , readable() , writable() ,\nand seekable() . The ContentFile class ¶ class ContentFile ( content , name = None ) [source] ¶ The ContentFile class inherits from File ,\nbut unlike File it operates on string content\n(bytes also supported), rather than an actual file. For example: from django.core.files.base import ContentFile f1 = ContentFile ( \"esta frase está en español\" ) f2 = ContentFile ( b \"these are bytes\" ) The ImageFile class ¶ class ImageFile ( file_object , name = None ) [source] ¶ Django provides a built-in class specifically for images. django.core.files.images.ImageFile inherits all the attributes\nand methods of File , and additionally\nprovides the following: width [source] ¶ Width of the image in pixels. height [source] ¶ Height of the image in pixels. Additional methods on files attached to objects ¶ Any File that is associated with an object (as with Car.photo ,\nbelow) will also have a couple of extra methods: File. save ( name , content , save = True ) ¶ Saves a new file with the file name and contents provided. This will not\nreplace the existing file, but will create a new file and update the object\nto point to it. If save is True , the model’s save() method will\nbe called once the file is saved. That is, these two lines: >>> car . photo . save ( \"myphoto.jpg\" , content , save = False ) >>> car . save () are equivalent to: >>> car . photo . save ( \"myphoto.jpg\" , content , save = True ) Note that the content argument must be an instance of either File or of a subclass of File , such as ContentFile . File. delete ( save = True ) ¶ Removes the file from the model instance and deletes the underlying file.\nIf save is True , the model’s save() method will be called once\nthe file is deleted.", "keywords": ["additions", "open", "wrapper", "f1", "module", "está", "values", "string", "addition", "class", "example", "car.photo", "returns", "readinto", "newlines", "contentfile", "*", "lines", "imagefile", "wraps", "read", "contents", "model", "subclass", "readline", "submodules", "width", "image", "encoding", "attributes", "django", "=", "multiple_chunks", "chunk_size", "file.open", "line", "source", "height", "fieldfile", "photo", "kb", "subclasses", "instance", "kwargs", "objects", "file", "frase", "handling", "español", "path", "cases", "pixels", "attribute", "none", "args", "classes", "size", "time", "save", "support", "f", "f2", "mode", "object", "couple", "media_root", "context", "fileno", "files", "name", "import", "defaults", "chunks", "images", "python", "methods", "manager", "readlines", "method", "argument", "¶", "bytes", "writelines", "disk", "memory", "django.core.files", "iterate", "car", "content"], "type": "documentation"},
{"title": "Django Utils | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/utils/", "content": "Django Utils ¶ This document covers all stable modules in django.utils . Most of the\nmodules in django.utils are designed for internal use and only the\nfollowing parts can be considered stable and thus backwards compatible as per\nthe internal release deprecation policy . django.utils.cache ¶ This module contains helper functions for controlling HTTP caching. It does so\nby managing the Vary header of responses. It includes functions to patch\nthe header of response objects directly and decorators that change functions to\ndo that header-patching themselves. For information on the Vary header, see RFC 9110 Section 12.5.5 . Essentially, the Vary HTTP header defines which headers a cache should take\ninto account when building its cache key. Requests with the same path but\ndifferent header content for headers named in Vary need to get different\ncache keys to prevent delivery of wrong content. For example, internationalization middleware would\nneed to distinguish caches by the Accept-language header. patch_cache_control ( response , ** kwargs ) [source] ¶ This function patches the Cache-Control header by adding all keyword\narguments to it. The transformation is as follows: All keyword parameter names are turned to lowercase, and underscores\nare converted to hyphens. If the value of a parameter is True (exactly True , not just a\ntrue value), only the parameter name is added to the header. All other parameters are added with their value, after applying str() to it. get_max_age ( response ) [source] ¶ Returns the max-age from the response Cache-Control header as an integer\n(or None if it wasn’t found or wasn’t an integer). patch_response_headers ( response , cache_timeout = None ) [source] ¶ Adds some useful headers to the given HttpResponse object: Expires Cache-Control Each header is only added if it isn’t already set. cache_timeout is in seconds. The CACHE_MIDDLEWARE_SECONDS setting is used by default. add_never_cache_headers ( response ) [source] ¶ Adds an Expires header to the current date/time. Adds a Cache-Control: max-age=0, no-cache, no-store, must-revalidate, private header to a response to indicate that a page should never be\ncached. Each header is only added if it isn’t already set. patch_vary_headers ( response , newheaders ) [source] ¶ Adds (or updates) the Vary header in the given HttpResponse object. newheaders is a list of header names that should be in Vary . If\nheaders contains an asterisk, then Vary header will consist of a single\nasterisk '*' , according to RFC 9110 Section 12.5.5 . Otherwise,\nexisting headers in Vary aren’t removed. get_cache_key ( request , key_prefix = None , method = 'GET' , cache = None ) [source] ¶ Returns a cache key based on the request path. It can be used in the\nrequest phase because it pulls the list of headers to take into account\nfrom the global path registry and uses those to build a cache key to\ncheck against. If there is no headerlist stored, the page needs to be rebuilt, so this\nfunction returns None . learn_cache_key ( request , response , cache_timeout = None , key_prefix = None , cache = None ) [source] ¶ Learns what headers to take into account for some request path from the\nresponse object. It stores those headers in a global path registry so that\nlater access to that path will know what headers to take into account\nwithout building the response object itself. The headers are named in\nthe Vary header of the response, but we want to prevent response\ngeneration. The list of headers to use for cache key generation is stored in the same\ncache as the pages themselves. If the cache ages some data out of the\ncache, this means that we have to build the response once to get at the\nVary header and so at the list of headers to use for the cache key. django.utils.dateparse ¶ The functions defined in this module share the following properties: They accept strings in ISO 8601 date/time formats (or some close\nalternatives) and return objects from the corresponding classes in Python’s datetime module. They raise ValueError if their input is well formatted but isn’t a\nvalid date or time. They return None if it isn’t well formatted at all. They accept up to picosecond resolution in input, but they truncate it to\nmicroseconds, since that’s what Python supports. parse_date ( value ) [source] ¶ Parses a string and returns a datetime.date . parse_time ( value ) [source] ¶ Parses a string and returns a datetime.time . UTC offsets aren’t supported; if value describes one, the result is None . parse_datetime ( value ) [source] ¶ Parses a string and returns a datetime.datetime . UTC offsets are supported; if value describes one, the result’s tzinfo attribute is a datetime.timezone instance. parse_duration ( value ) [source] ¶ Parses a string and returns a datetime.timedelta . Expects data in the format \"DD HH:MM:SS.uuuuuu\" , \"DD HH:MM:SS,uuuuuu\" ,  or as specified by ISO 8601 (e.g. P4DT1H15M20S which is equivalent to 4 1:15:20 ) or PostgreSQL’s\nday-time interval format (e.g. 3 days 04:05:06 ). django.utils.decorators ¶ method_decorator ( decorator , name = '' ) [source] ¶ Converts a function decorator into a method decorator. It can be used to\ndecorate methods or classes; in the latter case, name is the name\nof the method to be decorated and is required. decorator may also be a list or tuple of functions. They are wrapped\nin reverse order so that the call order is the order in which the functions\nappear in the list/tuple. See decorating class based views for\nexample usage. decorator_from_middleware ( middleware_class ) [source] ¶ Given a middleware class, returns a view decorator. This lets you use\nmiddleware functionality on a per-view basis. The middleware is created\nwith no params passed. It assumes middleware that’s compatible with the old style of Django 1.9\nand earlier (having methods like process_request() , process_exception() , and process_response() ). decorator_from_middleware_with_args ( middleware_class ) [source] ¶ Like decorator_from_middleware , but returns a function\nthat accepts the arguments to be passed to the middleware_class.\nFor example, the cache_page() decorator is created from the CacheMiddleware like this: cache_page = decorator_from_middleware_with_args ( CacheMiddleware ) @cache_page ( 3600 ) def my_view ( request ): pass sync_only_middleware ( middleware ) [source] ¶ Marks a middleware as synchronous-only . (The\ndefault in Django, but this allows you to future-proof if the default ever\nchanges in a future release.) async_only_middleware ( middleware ) [source] ¶ Marks a middleware as asynchronous-only . Django\nwill wrap it in an asynchronous event loop when it is called from the WSGI\nrequest path. sync_and_async_middleware ( middleware ) [source] ¶ Marks a middleware as sync and async compatible ,\nthis allows to avoid converting requests. You must implement detection of\nthe current request type to use this decorator. See asynchronous\nmiddleware documentation for details. django.utils.encoding ¶ smart_str ( s , encoding = 'utf-8' , strings_only = False , errors = 'strict' ) [source] ¶ Returns a str object representing arbitrary object s . Treats\nbytestrings using the encoding codec. If strings_only is True , don’t convert (some) non-string-like\nobjects. is_protected_type ( obj ) [source] ¶ Determine if the object instance is of a protected type. Objects of protected types are preserved as-is when passed to force_str(strings_only=True) . force_str ( s , encoding = 'utf-8' , strings_only = False , errors = 'strict' ) [source] ¶ Similar to smart_str() , except that lazy instances are resolved to\nstrings, rather than kept as lazy objects. If strings_only is True , don’t convert (some) non-string-like\nobjects. smart_bytes ( s , encoding = 'utf-8' , strings_only = False , errors = 'strict' ) [source] ¶ Returns a bytestring version of arbitrary object s , encoded as\nspecified in encoding . If strings_only is True , don’t convert (some) non-string-like\nobjects. force_bytes ( s , encoding = 'utf-8' , strings_only = False , errors = 'strict' ) [source] ¶ Similar to smart_bytes , except that lazy instances are resolved to\nbytestrings, rather than kept as lazy objects. If strings_only is True , don’t convert (some) non-string-like\nobjects. iri_to_uri ( iri ) [source] ¶ Convert an Internationalized Resource Identifier (IRI) portion to a URI\nportion that is suitable for inclusion in a URL. This is the algorithm from section 3.1 of RFC 3987 Section 3.1 , slightly\nsimplified since the input is assumed to be a string rather than an\narbitrary byte stream. Takes an IRI (string or UTF-8 bytes) and returns a string containing the\nencoded result. uri_to_iri ( uri ) [source] ¶ Converts a Uniform Resource Identifier into an Internationalized Resource\nIdentifier. This is an algorithm from section 3.2 of RFC 3987 Section 3.2 . Takes a URI in ASCII bytes and returns a string containing the encoded\nresult. filepath_to_uri ( path ) [source] ¶ Convert a file system path to a URI portion that is suitable for inclusion\nin a URL. The path is assumed to be either UTF-8 bytes, string, or a Path . This method will encode certain characters that would normally be\nrecognized as special characters for URIs.  Note that this method does not\nencode the ‘ character, as it is a valid character within URIs. See encodeURIComponent() JavaScript function for more details. Returns an ASCII string containing the encoded result. escape_uri_path ( path ) [source] ¶ Escapes the unsafe characters from the path portion of a Uniform Resource\nIdentifier (URI). django.utils.feedgenerator ¶ Sample usage: >>> from django.utils import feedgenerator >>> feed = feedgenerator . Rss201rev2Feed ( ... title = \"Poynter E-Media Tidbits\" , ... link = \"https://www.poynter.org/tag/e-media-tidbits/\" , ... description = \"A group blog by the sharpest minds in online media/journalism/publishing.\" , ... language = \"en\" , ... ) >>> feed . add_item ( ... title = \"Hello\" , ... link = \"https://www.holovaty.com/test/\" , ... description = \"Testing.\" , ... ) >>> with open ( \"test.rss\" , \"w\" ) as fp : ... feed . write ( fp , \"utf-8\" ) ... For simplifying the selection of a generator use feedgenerator.DefaultFeed which is currently Rss201rev2Feed For definitions of the different versions of RSS, see: https://web.archive.org/web/20110718035220/http://diveintomark.org/archives/2004/02/04/incompatible-rss get_tag_uri ( url , date ) [source] ¶ Creates a TagURI. See https://web.archive.org/web/20110514113830/http://diveintomark.org/archives/2004/05/28/howto-atom-id SyndicationFeed ¶ class SyndicationFeed [source] ¶ Base class for all syndication feeds. Subclasses should provide write() . __init__ ( title , link , description , language = None , author_email = None , author_name = None , author_link = None , subtitle = None , categories = None , feed_url = None , feed_copyright = None , feed_guid = None , ttl = None , ** kwargs ) [source] ¶ Initialize the feed with the given dictionary of metadata, which applies\nto the entire feed. Any extra keyword arguments you pass to __init__ will be stored in self.feed . All parameters should be strings, except categories , which should\nbe a sequence of strings. add_item ( title , link , description , author_email = None , author_name = None , author_link = None , pubdate = None , comments = None , unique_id = None , categories = () , item_copyright = None , ttl = None , updateddate = None , enclosures = None , ** kwargs ) [source] ¶ Adds an item to the feed. All args are expected to be strings except pubdate and updateddate , which are datetime.datetime objects, and enclosures , which is a list of Enclosure instances. num_items () [source] ¶ root_attributes () [source] ¶ Return extra attributes to place on the root (i.e. feed/channel)\nelement. Called from write() . add_root_elements ( handler ) [source] ¶ Add elements in the root (i.e. feed/channel) element.\nCalled from write() . item_attributes ( item ) [source] ¶ Return extra attributes to place on each item (i.e. item/entry)\nelement. add_item_elements ( handler , item ) [source] ¶ Add elements on each item (i.e. item/entry) element. write ( outfile , encoding ) [source] ¶ Outputs the feed in the given encoding to outfile , which is a\nfile-like object. Subclasses should override this. writeString ( encoding ) [source] ¶ Returns the feed in the given encoding as a string. latest_post_date () [source] ¶ Returns the latest pubdate or updateddate for all items in the\nfeed. If no items have either of these attributes this returns the\ncurrent UTC date/time. Enclosure ¶ class Enclosure [source] ¶ Represents an RSS enclosure RssFeed ¶ class RssFeed ( SyndicationFeed ) [source] ¶ Rss201rev2Feed ¶ class Rss201rev2Feed ( RssFeed ) [source] ¶ Spec: https://cyber.harvard.edu/rss/rss.html RssUserland091Feed ¶ class RssUserland091Feed ( RssFeed ) [source] ¶ Spec: http://backend.userland.com/rss091 Atom1Feed ¶ class Atom1Feed ( SyndicationFeed ) [source] ¶ Spec: RFC 4287 django.utils.functional ¶ class cached_property ( func ) [source] ¶ The @cached_property decorator caches the result of a method with a\nsingle self argument as a property. The cached result will persist\nas long as the instance does, so if the instance is passed around and the\nfunction subsequently invoked, the cached result will be returned. Consider a typical case, where a view might need to call a model’s method\nto perform some computation, before placing the model instance into the\ncontext, where the template might invoke the method once more: # the model class Person ( models . Model ): def friends ( self ): # expensive computation ... return friends # in the view: if person . friends (): ... And in the template you would have: {% for friend in person.friends %} Here, friends() will be called twice. Since the instance person in\nthe view and the template are the same, decorating the friends() method\nwith @cached_property can avoid that: from django.utils.functional import cached_property class Person ( models . Model ): @cached_property def friends ( self ): ... Note that as the method is now a property, in Python code it will need to\nbe accessed appropriately: # in the view: if person . friends : ... The cached value can be treated like an ordinary attribute of the instance: # clear it, requiring re-computation next time it's called del person . friends # or delattr(person, \"friends\") # set a value manually, that will persist on the instance until cleared person . friends = [ \"Huckleberry Finn\" , \"Tom Sawyer\" ] Because of the way the descriptor protocol works, using del (or delattr ) on a cached_property that hasn’t been accessed raises AttributeError . As well as offering potential performance advantages, @cached_property can ensure that an attribute’s value does not change unexpectedly over the\nlife of an instance. This could occur with a method whose computation is\nbased on datetime.now() , or if a change were saved to the database by\nsome other process in the brief interval between subsequent invocations of\na method on the same instance. You can make cached properties of methods. For example, if you had an\nexpensive get_friends() method and wanted to allow calling it without\nretrieving the cached value, you could write: friends = cached_property ( get_friends ) While person.get_friends() will recompute the friends on each call, the\nvalue of the cached property will persist until you delete it as described\nabove: x = person . friends # calls first time y = person . get_friends () # calls again z = person . friends # does not call x is z # is True class classproperty ( method = None ) [source] ¶ Similar to @classmethod , the @classproperty decorator converts the result of a method with a single cls argument\ninto a property that can be accessed directly from the class. keep_lazy ( func , * resultclasses ) [source] ¶ Django offers many utility functions (particularly in django.utils )\nthat take a string as their first argument and do something to that string.\nThese functions are used by template filters as well as directly in other\ncode. If you write your own similar functions and deal with translations, you’ll\nface the problem of what to do when the first argument is a lazy\ntranslation object. You don’t want to convert it to a string immediately,\nbecause you might be using this function outside of a view (and hence the\ncurrent thread’s locale setting will not be correct). For cases like this, use the django.utils.functional.keep_lazy() decorator. It modifies the function so that if it’s called with a lazy\ntranslation as one of its arguments, the function evaluation is delayed\nuntil it needs to be converted to a string. For example: from django.utils.functional import keep_lazy , keep_lazy_text def fancy_utility_function ( s , * args , ** kwargs ): # Do some conversion on string 's' ... fancy_utility_function = keep_lazy ( str )( fancy_utility_function ) # Or more succinctly: @keep_lazy ( str ) def fancy_utility_function ( s , * args , ** kwargs ): ... The keep_lazy() decorator takes a number of extra arguments ( *args )\nspecifying the type(s) that the original function can return. A common\nuse case is to have functions that return text. For these, you can pass the str type to keep_lazy (or use the keep_lazy_text() decorator\ndescribed in the next section). Using this decorator means you can write your function and assume that the\ninput is a proper string, then add support for lazy translation objects at\nthe end. keep_lazy_text ( func ) [source] ¶ A shortcut for keep_lazy(str)(func) . If you have a function that returns text and you want to be able to take\nlazy arguments while delaying their evaluation, you can use this\ndecorator: from django.utils.functional import keep_lazy , keep_lazy_text # Our previous example was: @keep_lazy ( str ) def fancy_utility_function ( s , * args , ** kwargs ): ... # Which can be rewritten as: @keep_lazy_text def fancy_utility_function ( s , * args , ** kwargs ): ... django.utils.html ¶ Usually you should build up HTML using Django’s templates to make use of its\nautoescape mechanism, using the utilities in django.utils.safestring where appropriate. This module provides some additional low level utilities for\nescaping HTML. escape ( text ) [source] ¶ Returns the given text with ampersands, quotes and angle brackets encoded\nfor use in HTML. The input is first coerced to a string and the output has mark_safe() applied. conditional_escape ( text ) [source] ¶ Similar to escape() , except that it doesn’t operate on preescaped\nstrings, so it will not double escape. format_html ( format_string , * args , ** kwargs ) [source] ¶ This is similar to str.format() , except that it is appropriate for\nbuilding up HTML fragments. The first argument format_string is not\nescaped but all other args and kwargs are passed through conditional_escape() before being passed to str.format() .\nFinally, the output has mark_safe() applied. For the case of building up small HTML fragments, this function is to be\npreferred over string interpolation using % or str.format() directly, because it applies escaping to all arguments - just like the\ntemplate system applies escaping by default. So, instead of writing: mark_safe ( \" %s <b> %s </b> %s \" % ( some_html , escape ( some_text ), escape ( some_other_text ), ) ) You should instead use: format_html ( \" {} <b> {} </b> {} \" , mark_safe ( some_html ), some_text , some_other_text , ) This has the advantage that you don’t need to apply escape() to each\nargument and risk a bug and an XSS vulnerability if you forget one. Note that although this function uses str.format() to do the\ninterpolation, some of the formatting options provided by str.format() (e.g. number formatting) will not work, since all arguments are passed\nthrough conditional_escape() which (ultimately) calls force_str() on the values. Deprecated since version 5.0: Support for calling format_html() without passing args or kwargs is\ndeprecated. format_html_join ( sep , format_string , args_generator ) [source] ¶ A wrapper of format_html() , for the common case of a group of\narguments that need to be formatted using the same format string, and then\njoined using sep . sep is also passed through conditional_escape() . args_generator should be an iterator that returns the sequence of args that will be passed to format_html() . For example: format_html_join ( \" \\n \" , \"<li> {} {} </li>\" , (( u . first_name , u . last_name ) for u in users )) json_script ( value , element_id = None , encoder = None ) [source] ¶ Escapes all HTML/XML special characters with their Unicode escapes, so\nvalue is safe for use with JavaScript. Also wraps the escaped JSON in a <script> tag. If the element_id parameter is not None , the <script> tag is given the passed id. For example: >>> json_script ({ \"hello\" : \"world\" }, element_id = \"hello-data\" ) '<script id=\"hello-data\" type=\"application/json\">{\"hello\": \"world\"}</script>' The encoder , which defaults to django.core.serializers.json.DjangoJSONEncoder , will be used to\nserialize the data. See JSON serialization for more details about this serializer. strip_tags ( value ) [source] ¶ Tries to remove anything that looks like an HTML tag from the string, that\nis anything contained within <> . Absolutely NO guarantee is provided about the resulting string being\nHTML safe. So NEVER mark safe the result of a strip_tag call without\nescaping it first, for example with escape() . For example: strip_tags ( value ) If value is \"<b>Joel</b> <button>is</button> a <span>slug</span>\" the return value will be \"Joel is a slug\" . If you are looking for a more robust solution, consider using a third-party\nHTML sanitizing tool. html_safe () [source] ¶ The __html__() method on a class helps non-Django templates detect\nclasses whose output doesn’t require HTML escaping. This decorator defines the __html__() method on the decorated class\nby wrapping __str__() in mark_safe() .\nEnsure the __str__() method does indeed return text that doesn’t\nrequire HTML escaping. django.utils.http ¶ urlencode ( query , doseq = False ) [source] ¶ A version of Python’s urllib.parse.urlencode() function that can\noperate on MultiValueDict and non-string values. http_date ( epoch_seconds = None ) [source] ¶ Formats the time to match the RFC 1123 Section 5.2.14 date format as\nspecified by HTTP RFC 9110 Section 5.6.7 . Accepts a floating point number expressed in seconds since the epoch in\nUTC–such as that outputted by time.time() . If set to None ,\ndefaults to the current time. Outputs a string in the format Wdy, DD Mon YYYY HH:MM:SS GMT . content_disposition_header ( as_attachment , filename ) [source] ¶ Constructs a Content-Disposition HTTP header value from the given filename as specified by RFC 6266 . Returns None if as_attachment is False and filename is None , otherwise\nreturns a string suitable for the Content-Disposition HTTP header. base36_to_int ( s ) [source] ¶ Converts a base 36 string to an integer. int_to_base36 ( i ) [source] ¶ Converts a positive integer to a base 36 string. urlsafe_base64_encode ( s ) [source] ¶ Encodes a bytestring to a base64 string for use in URLs, stripping any\ntrailing equal signs. urlsafe_base64_decode ( s ) [source] ¶ Decodes a base64 encoded string, adding back any trailing equal signs that\nmight have been stripped. django.utils.module_loading ¶ Functions for working with Python modules. import_string ( dotted_path ) [source] ¶ Imports a dotted module path and returns the attribute/class designated by\nthe last name in the path. Raises ImportError if the import failed. For\nexample: from django.utils.module_loading import import_string ValidationError = import_string ( \"django.core.exceptions.ValidationError\" ) is equivalent to: from django.core.exceptions import ValidationError django.utils.safestring ¶ Functions and classes for working with “safe strings”: strings that can be\ndisplayed safely without further escaping in HTML. Marking something as a “safe\nstring” means that the producer of the string has already turned characters\nthat should not be interpreted by the HTML engine (e.g. ‘<’) into the\nappropriate entities. class SafeString [source] ¶ A str subclass that has been specifically marked as “safe” (requires no\nfurther escaping) for HTML output purposes. mark_safe ( s ) [source] ¶ Explicitly mark a string as safe for (HTML) output purposes. The returned\nobject can be used everywhere a string is appropriate. Can be called multiple times on a single string. Can also be used as a decorator. For building up fragments of HTML, you should normally be using django.utils.html.format_html() instead. String marked safe will become unsafe again if modified. For example: >>> mystr = \"<b>Hello World</b>   \" >>> mystr = mark_safe ( mystr ) >>> type ( mystr ) <class 'django.utils.safestring.SafeString'> >>> mystr = mystr . strip () # removing whitespace >>> type ( mystr ) <type 'str'> django.utils.text ¶ format_lazy ( format_string , * args , ** kwargs ) ¶ A version of str.format() for when format_string , args ,\nand/or kwargs contain lazy objects. The first argument is the string to\nbe formatted. For example: from django.utils.text import format_lazy from django.utils.translation import pgettext_lazy urlpatterns = [ path ( format_lazy ( \" {person} /<int:pk>/\" , person = pgettext_lazy ( \"URL\" , \"person\" )), PersonDetailView . as_view (), ), ] This example allows translators to translate part of the URL. If “person”\nis translated to “persona”, the regular expression will match persona/(?P<pk>\\d+)/$ , e.g. persona/5/ . slugify ( value , allow_unicode = False ) [source] ¶ Converts a string to a URL slug by: Converting to ASCII if allow_unicode is False (the default). Converting to lowercase. Removing characters that aren’t alphanumerics, underscores, hyphens, or\nwhitespace. Replacing any whitespace or repeated dashes with single dashes. Removing leading and trailing whitespace, dashes, and underscores. For example: >>> slugify ( \" Joel is a slug \" ) 'joel-is-a-slug' If you want to allow Unicode characters, pass allow_unicode=True . For\nexample: >>> slugify ( \"你好 World\" , allow_unicode = True ) '你好-world' django.utils.timezone ¶ get_fixed_timezone ( offset ) [source] ¶ Returns a tzinfo instance that represents a time zone\nwith a fixed offset from UTC. offset is a datetime.timedelta or an integer number of\nminutes. Use positive values for time zones east of UTC and negative\nvalues for west of UTC. get_default_timezone () [source] ¶ Returns a tzinfo instance that represents the default time zone . get_default_timezone_name () [source] ¶ Returns the name of the default time zone . get_current_timezone () [source] ¶ Returns a tzinfo instance that represents the current time zone . get_current_timezone_name () [source] ¶ Returns the name of the current time zone . activate ( timezone ) [source] ¶ Sets the current time zone . The timezone argument must be an instance of a tzinfo subclass or a time zone name. deactivate () [source] ¶ Unsets the current time zone . override ( timezone ) [source] ¶ This is a Python context manager that sets the current time zone on entry with activate() , and restores\nthe previously active time zone on exit. If the timezone argument is None , the current time zone is unset\non entry with deactivate() instead. override is also usable as a function decorator. localtime ( value = None , timezone = None ) [source] ¶ Converts an aware datetime to a different time zone,\nby default the current time zone . When value is omitted, it defaults to now() . This function doesn’t work on naive datetimes; use make_aware() instead. localdate ( value = None , timezone = None ) [source] ¶ Uses localtime() to convert an aware datetime to a date() in a different time zone, by default the current time zone . When value is omitted, it defaults to now() . This function doesn’t work on naive datetimes. now () [source] ¶ Returns a datetime that represents the\ncurrent point in time. Exactly what’s returned depends on the value of USE_TZ : If USE_TZ is False , this will be a naive datetime (i.e. a datetime\nwithout an associated timezone) that represents the current time\nin the system’s local timezone. If USE_TZ is True , this will be an aware datetime representing the\ncurrent time in UTC. Note that now() will always return\ntimes in UTC regardless of the value of TIME_ZONE ;\nyou can use localtime() to get the time in the current time zone. is_aware ( value ) [source] ¶ Returns True if value is aware, False if it is naive. This\nfunction assumes that value is a datetime . is_naive ( value ) [source] ¶ Returns True if value is naive, False if it is aware. This\nfunction assumes that value is a datetime . make_aware ( value , timezone = None ) [source] ¶ Returns an aware datetime that represents the same\npoint in time as value in timezone , value being a naive datetime . If timezone is set to None , it\ndefaults to the current time zone . make_naive ( value , timezone = None ) [source] ¶ Returns a naive datetime that represents in timezone the same point in time as value , value being an\naware datetime . If timezone is set to None , it\ndefaults to the current time zone . django.utils.translation ¶ For a complete discussion on the usage of the following see the translation documentation . gettext ( message ) [source] ¶ Translates message and returns it as a string. pgettext ( context , message ) [source] ¶ Translates message given the context and returns it as a string. For more information, see Contextual markers . gettext_lazy ( message ) ¶ pgettext_lazy ( context , message ) ¶ Same as the non-lazy versions above, but using lazy execution. See lazy translations documentation . gettext_noop ( message ) [source] ¶ Marks strings for translation but doesn’t translate them now. This can be\nused to store strings in global variables that should stay in the base\nlanguage (because they might be used externally) and will be translated\nlater. ngettext ( singular , plural , number ) [source] ¶ Translates singular and plural and returns the appropriate string\nbased on number . npgettext ( context , singular , plural , number ) [source] ¶ Translates singular and plural and returns the appropriate string\nbased on number and the context . ngettext_lazy ( singular , plural , number ) [source] ¶ npgettext_lazy ( context , singular , plural , number ) [source] ¶ Same as the non-lazy versions above, but using lazy execution. See lazy translations documentation . activate ( language ) [source] ¶ Fetches the translation object for a given language and activates it as\nthe current translation object for the current thread. deactivate () [source] ¶ Deactivates the currently active translation object so that further _ calls\nwill resolve against the default translation object, again. deactivate_all () [source] ¶ Makes the active translation object a NullTranslations() instance.\nThis is useful when we want delayed translations to appear as the original\nstring for some reason. override ( language , deactivate = False ) [source] ¶ A Python context manager that uses django.utils.translation.activate() to fetch the translation object\nfor a given language, activates it as the translation object for the\ncurrent thread and reactivates the previous active language on exit.\nOptionally, it can deactivate the temporary translation on exit with django.utils.translation.deactivate() if the deactivate argument\nis True . If you pass None as the language argument, a NullTranslations() instance is activated within the context. override is also usable as a function decorator. check_for_language ( lang_code ) [source] ¶ Checks whether there is a global language file for the given language\ncode (e.g. ‘fr’, ‘pt_BR’). This is used to decide whether a user-provided\nlanguage is available. get_language () [source] ¶ Returns the currently selected language code. Returns None if\ntranslations are temporarily deactivated (by deactivate_all() or\nwhen None is passed to override() ). get_language_bidi () [source] ¶ Returns selected language’s BiDi layout: False = left-to-right layout True = right-to-left layout get_language_from_request ( request , check_path = False ) [source] ¶ Analyzes the request to find what language the user wants the system to\nshow. Only languages listed in settings.LANGUAGES are taken into account.\nIf the user requests a sublanguage where we have a main language, we send\nout the main language. If check_path is True , the function first checks the requested URL\nfor whether its path begins with a language code listed in the LANGUAGES setting. get_supported_language_variant ( lang_code , strict = False ) [source] ¶ Returns lang_code if it’s in the LANGUAGES setting, possibly\nselecting a more generic variant. For example, 'es' is returned if lang_code is 'es-ar' and 'es' is in LANGUAGES but 'es-ar' isn’t. lang_code has a maximum accepted length of 500 characters. A LookupError is raised if lang_code exceeds this limit and strict is True , or if there is no generic variant and strict is False . If strict is False (the default), a country-specific variant may\nbe returned when neither the language code nor its generic variant is found.\nFor example, if only 'es-co' is in LANGUAGES , that’s\nreturned for lang_code s like 'es' and 'es-ar' . Those matches\naren’t returned if strict=True . Raises LookupError if nothing is found. Changed in Django 4.2.15: In older versions, lang_code values over 500 characters were\nprocessed without raising a LookupError . to_locale ( language ) [source] ¶ Turns a language name (en-us) into a locale name (en_US). templatize ( src ) [source] ¶ Turns a Django template into something that is understood by xgettext .\nIt does so by translating the Django translation tags into standard gettext function invocations.", "keywords": ["https://cyber.harvard.edu/rss/rss.html", "users", "feed", "underscores", "delattr(person", "selection", "type(s", "json_script", "middleware_class", "content_disposition_header", "force_bytes", "#", "friends", "type=\"application", "serialization", "pubdate", "django.utils.decorators", "metadata", "parse_date", "loop", "some_other_text", "keep_lazy(str)(func", "httpresponse", "cache", "element_id", "ngettext", "tool", "change", "http", "django.core.exceptions", "=", "changes", "interval", "django.utils.translation.activate", "engine", "stream", "message", "categories", "process_response", "es", "character", "tag", "patch_vary_headers", "button", "zones", "patch_response_headers", "@cache_page", "process", "datetime.datetime", "strip_tags", "first_name", "autoescape", "following", "type", "variant", "finn", "calls", "kwargs", "defines", "objects", "documentation", "generator", "write", "django.utils.text", "datetime.timedelta", "django.utils.translation.deactivate", "file", "guarantee", "layout", "modules", "disposition", "user", "li", "django.utils.translation", "rssfeed", "cases", "django.utils.html", "django.utils.safestring", "helper", "attribute", "args", "mechanism", "west", "time", "mm", "tags", "basis", "gmt", "date", "joel", "feed_copyright", "setting", "purposes", "responses", "account", "multivaluedict", "enclosures", "iterator", "uris", "name", "signs", "parameter", "feeds", "execution", "world", "as_view", "escaping", "age", "base36_to_int", "versions", "interpolation", "djangojsonencoder", "xgettext", "manager", "treats", "ss", "uses", "z", "return", "computation", "format_html", "parse_datetime", "use_tz", "django.utils.html.format_html", "blog", "datetime.date", "proof", "get_current_timezone", "store", "lookuperror", "wrapper", "@cached_property", "url", "module", "code", "algorithm", "pages", "style", "dotted_path", "false", "access", "class", "link", "hello", "i", "person.get_friends", "group", "sep", "add_never_cache_headers", "returns", "names", "'", "javascript", "x", "u", "你好", "str.format", "request", "database", "output", "importerror", "input", "https://web.archive.org/web/20110514113830/http://diveintomark.org/archives/2004/05/28/howto-atom-id", "*", "query", "page", "huckleberry", "postgresql", "urlencode", "types", "strings", "elements", "cache_middleware_seconds", "subclass", "persondetailview", "defaultfeed", "decodes", "usage", "gettext_noop", "registry", "xml", "wsgi", "ascii", "script", "limit", "thread", "writing", "entities", "taguri", "feed_url", "bytestrings", "e", "pt_br", "section", "source", "allow_unicode", "discussion", "converts", "sequence", "evaluation", "adds", "use", "filepath_to_uri", "atom1feed", "advantages", "nulltranslations", "fancy_utility_function", "add_root_elements", "get_fixed_timezone", "gettext", "solution", "subclasses", "performance", "urlsafe_base64_encode", "pass", "codec", "similar", "order", "params", "default", "cachemiddleware", "inclusion", "bug", "enclosure", "poynter", "properties", "format", "classes", "characters", "expression", "process_exception", "age=0", "day", "timezone", "advantage", "validationerror", "newheaders", "root_attributes", "invocations", "iri_to_uri", "tidbits", "some_html", "src", "template", "marks", "escape_uri_path", "rss", "header", "way", "formats", "utf-8", "checks", "@classproperty", "fr", "comments", "encodes", "accept", "syndication", "microseconds", "party", "integer", "¶", "bytes", "internationalization", "parameters", "encoder", "property", "get_friends", "content", "span", "function", "protocol", "views", "world\"}</script", "testing", "result", "view", "uuuuuu", "control", "cache_timeout", "zone", "number", "right", "def", "point", "datetimes", "mystr", "values", "string", "cls", "django.utils.functional.keep_lazy", "_", "world</b", "cached_property", "markers", "learns", "get_default_timezone", "hh", "event", "sync_only_middleware", "check_path", "language", "models", "exit", "version", "level", "json", "dashes", "hyphens", "get_tag_uri", "format_lazy", "escapes", "deprecation", "get_language", "portion", "django", "vulnerability", "urlsafe_base64_decode", "rfc", "n’t", "filename", "brackets", "localtime", "utilities", "https://www.poynter.org/tag/e-media-tidbits/", "entry", "alternatives", "languages", "lowercase", "override", "journalism", "num_items", "value", "get_supported_language_variant", "media", "rssuserland091feed", "sync", "django.utils.feedgenerator", "format_string", "http://backend.userland.com/rss091", "policy", "channel", "data", "safestring", "producer", "item", "handler", "datetime", "strip", "w", "base", "ar", "person", "author_name", "wdy", "expires", "identifier", "updates", "resultclasses", "self", "outputs", "instance", "uri", "delattr", "co", "functionality", "unicode", "decorator", "decorator_from_middleware", "gettext_lazy", "lang_code", "transformation", "same", "tom", "descriptor", "instances", "iso", "alphanumerics", "tzinfo", "part", "subtitle", "object", "ampersands", "author_link", "valueerror", "npgettext", "us", "response", "headerlist", "iri", "self.feed", "bidi", "dictionary", "utility", "whitespace", "requests", "locale", "get_max_age", "get_default_timezone_name", "keyword", "s", "is</button", "resolution", "max", "cache_page", "conversion", "matches", "unsets", "variables", "decorators", "root", "epoch_seconds", "life", "activate", "determine", "system", "sublanguage", "feed_guid", "async", "keep_lazy", "plural", "items", "escape", "serializer", "headers", "sawyer", "patch_cache_control", "person.friends", "some_text", "’s", "example", "func", "country", "list", "sample", "minutes", "check_for_language", "seconds", "utc", "detection", "epoch", "en", "utils", "outfile", "django.utils.timezone", "smart_str", "rss201rev2feed", "fragments", "re", "asterisk", "phase", "args_generator", "model", "force_str", "place", "id=\"hello", "element", "encoding", "smart_bytes", "5.2.14", "delivery", "attributes", "keep_lazy_text", "key_prefix", "vary", "slug</span", "title", "release", "mon", "add_item", "y", "encodeuricomponent", "as_attachment", "translation", "friend", "time.time", "spec", "d.", "keys", "classproperty", "case", "attributeerror", "length", "uniform", "ttl", "deactivate_all", "slug", "django.core.serializers.json", "django.utils.cache", "errors", "html", "deactivate", "tuple", "str", "arguments", "quotes", "init", "middleware", "xss", "fp", "converting", "translations", "generation", "decorator_from_middleware_with_args", "end", "get_current_timezone_name", "singular", "en_us", "json\">{\"hello", "last_name", "add_item_elements", "make_aware", "path", "functions", "key", "django.utils.dateparse", "convert", "my_view", "none", "filters", "int_to_base36", "problem", "method_decorator", "get", "feedgenerator", "definitions", "reason", "caches", "true", "dd", "urls", "publishing", "support", "description", "document", "yyyy", "-", "django.utils", "context", "conditional_escape", "syndicationfeed", "offset", "import", "unique_id", "%", ">", "call", "defaults", "https://web.archive.org/web/20110718035220/http://diveintomark.org/archives/2004/02/04/incompatible-rss", "pk>/", "information", "python", "translators", "methods", "options", "times", "resource", "@classmethod", "details", "method", "pk>\\d+)/$", "settings", "argument", "days", "internationalized", "del", "offsets", "doseq", "mark_safe", "templates", "minds", "text", "datetime.time", "parts"], "type": "documentation"},
{"title": "TemplateResponse and SimpleTemplateResponse | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/template-response/", "content": "TemplateResponse and SimpleTemplateResponse ¶ Standard HttpResponse objects are static structures.\nThey are provided with a block of pre-rendered content at time of\nconstruction, and while that content can be modified, it isn’t in a form that\nmakes it easy to perform modifications. However, it can sometimes be beneficial to allow decorators or\nmiddleware to modify a response after it has been constructed by the\nview. For example, you may want to change the template that is used,\nor put additional data into the context. TemplateResponse provides a way to do just that. Unlike basic HttpResponse objects, TemplateResponse objects retain\nthe details of the template and context that was provided by the view to\ncompute the response. The final output of the response is not computed until\nit is needed, later in the response process. SimpleTemplateResponse objects ¶ class SimpleTemplateResponse [source] ¶ Attributes ¶ SimpleTemplateResponse. template_name ¶ The name of the template to be rendered. Accepts a backend-dependent\ntemplate object (such as those returned by get_template() ), the name of a template,\nor a list of template names. Example: ['foo.html', 'path/to/bar.html'] SimpleTemplateResponse. context_data ¶ The context data to be used when rendering the template. It must be a dict . Example: {'foo': 123} SimpleTemplateResponse. rendered_content [source] ¶ The current rendered value of the response content, using the current\ntemplate and context data. SimpleTemplateResponse. is_rendered [source] ¶ A boolean indicating whether the response content has been rendered. Methods ¶ SimpleTemplateResponse. __init__ ( template , context = None , content_type = None , status = None , charset = None , using = None , headers = None ) [source] ¶ Instantiates a SimpleTemplateResponse object with the given template, context, content type, HTTP status, and\ncharset. template A backend-dependent template object (such as those returned by get_template() ), the name of a template,\nor a list of template names. context A dict of values to add to the template context. By default,\nthis is an empty dictionary. content_type The value included in the HTTP Content-Type header, including the\nMIME type specification and the character set encoding. If content_type is specified, then its value is used. Otherwise, 'text/html' is used. status The HTTP status code for the response. charset The charset in which the response will be encoded. If not given it will\nbe extracted from content_type , and if that is unsuccessful, the DEFAULT_CHARSET setting will be used. using The NAME of a template engine to use for\nloading the template. headers A dict of HTTP headers to add to the response. SimpleTemplateResponse. resolve_context ( context ) [source] ¶ Preprocesses context data that will be used for rendering a template.\nAccepts a dict of context data. By default, returns the same dict . Override this method in order to customize the context. SimpleTemplateResponse. resolve_template ( template ) [source] ¶ Resolves the template instance to use for rendering. Accepts a\nbackend-dependent template object (such as those returned by get_template() ), the name of a template,\nor a list of template names. Returns the backend-dependent template object instance to be rendered. Override this method in order to customize template loading. SimpleTemplateResponse. add_post_render_callback () [source] ¶ Add a callback that will be invoked after rendering has taken\nplace. This hook can be used to defer certain processing\noperations (such as caching) until after rendering has occurred. If the SimpleTemplateResponse has already been rendered, the callback will be invoked\nimmediately. When called, callbacks will be passed a single argument – the\nrendered SimpleTemplateResponse instance. If the callback returns a value that is not None , this will be\nused as the response instead of the original response object (and\nwill be passed to the next post rendering callback etc.) SimpleTemplateResponse. render () [source] ¶ Sets response.content to the result obtained by SimpleTemplateResponse.rendered_content , runs all post-rendering\ncallbacks, and returns the resulting response object. render() will only have an effect the first time it is called. On\nsubsequent calls, it will return the result obtained from the first call. TemplateResponse objects ¶ class TemplateResponse [source] ¶ TemplateResponse is a subclass of SimpleTemplateResponse that knows about\nthe current HttpRequest . Methods ¶ TemplateResponse. __init__ ( request , template , context = None , content_type = None , status = None , charset = None , using = None , headers = None ) [source] ¶ Instantiates a TemplateResponse object\nwith the given request, template, context, content type, HTTP status, and\ncharset. request An HttpRequest instance. template A backend-dependent template object (such as those returned by get_template() ), the name of a template,\nor a list of template names. context A dict of values to add to the template context. By default,\nthis is an empty dictionary. content_type The value included in the HTTP Content-Type header, including the\nMIME type specification and the character set encoding. If content_type is specified, then its value is used. Otherwise, 'text/html' is used. status The HTTP status code for the response. charset The charset in which the response will be encoded. If not given it will\nbe extracted from content_type , and if that is unsuccessful, the DEFAULT_CHARSET setting will be used. using The NAME of a template engine to use for\nloading the template. headers A dict of HTTP headers to add to the response. The rendering process ¶ Before a TemplateResponse instance can be\nreturned to the client, it must be rendered. The rendering process takes the\nintermediate representation of template and context, and turns it into the\nfinal byte stream that can be served to the client. There are three circumstances under which a TemplateResponse will be\nrendered: When the TemplateResponse instance is explicitly rendered, using\nthe SimpleTemplateResponse.render() method. When the content of the response is explicitly set by assigning response.content . After passing through template response middleware, but before\npassing through response middleware. A TemplateResponse can only be rendered once. The first call to SimpleTemplateResponse.render() sets the content of the response;\nsubsequent rendering calls do not change the response content. However, when response.content is explicitly assigned, the\nchange is always applied. If you want to force the content to be\nre-rendered, you can reevaluate the rendered content, and assign\nthe content of the response manually: # Set up a rendered TemplateResponse >>> from django.template.response import TemplateResponse >>> t = TemplateResponse ( request , \"original.html\" , {}) >>> t . render () >>> print ( t . content ) Original content # Re-rendering doesn't change content >>> t . template_name = \"new.html\" >>> t . render () >>> print ( t . content ) Original content # Assigning content does change, no render() call required >>> t . content = t . rendered_content >>> print ( t . content ) New content Post-render callbacks ¶ Some operations – such as caching – cannot be performed on an\nunrendered template. They must be performed on a fully complete and\nrendered response. If you’re using middleware, you can do that. Middleware provides\nmultiple opportunities to process a response on exit from a view. If\nyou put behavior in the response middleware, it’s guaranteed to execute\nafter template rendering has taken place. However, if you’re using a decorator, the same opportunities do not\nexist. Any behavior defined in a decorator is handled immediately. To compensate for this (and any other analogous use cases), TemplateResponse allows you to register callbacks that will\nbe invoked when rendering has completed. Using this callback, you can\ndefer critical processing until a point where you can guarantee that\nrendered content will be available. To define a post-render callback, define a function that takes\na single argument – response – and register that function with\nthe template response: from django.template.response import TemplateResponse def my_render_callback ( response ): # Do content-sensitive processing do_post_processing () def my_view ( request ): # Create a response response = TemplateResponse ( request , \"mytemplate.html\" , {}) # Register the callback response . add_post_render_callback ( my_render_callback ) # Return the response return response my_render_callback() will be invoked after the mytemplate.html has been rendered, and will be provided the fully rendered TemplateResponse instance as an argument. If the template has already been rendered, the callback will be\ninvoked immediately. Using TemplateResponse and SimpleTemplateResponse ¶ A TemplateResponse object can be used anywhere that a normal django.http.HttpResponse can be used. It can also be used as an\nalternative to calling render() . For example, the following view returns a TemplateResponse with a\ntemplate and a context containing a queryset: from django.template.response import TemplateResponse def blog_index ( request ): return TemplateResponse ( request , \"entry_list.html\" , { \"entries\" : Entry . objects . all ()} )", "keywords": ["function", "result", "view", "status", "headers", "def", "code", "point", "values", "default_charset", "mytemplate.html", "foo.html", "behavior", "class", "example", "django.http", "#", "construction", "list", "returns", "names", "mime", "request", "structures", "block", "output", "representation", "httpresponse", "exit", "context_data", "loading", "response.content", "subclass", "change", "place", "attributes", "hook", "http", "=", "n’t", "print", "engine", "stream", "entry", "character", "preprocesses", "circumstances", "value", "entry_list.html", "source", "content_type", "specification", "data", "process", "use", "html", "rendered_content", "charset", "type", "processing", "init", "middleware", "calls", "instance", "objects", "entries", "opportunities", "simpletemplateresponse", "order", "default", "standard", "instantiates", "get_template", "path", "cases", "modifications", "callbacks", "operations", "form", "my_view", "none", "my_render_callback", "callback", "decorator", "time", "render", "setting", "templateresponse", "dict", "object", "simpletemplateresponse.render", "-", "blog_index", "context", "alternative", "import", "name", "httprequest", "template", "response", "header", "dictionary", "call", "way", "rendering", "methods", "original.html", "t", "resolve_context", "client", "details", "method", "queryset", "decorators", "argument", "¶", "return", "post", "effect", "foo", "bar.html", "text", "content"], "type": "documentation"},
{"title": "The “sites” framework | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/sites/", "content": "The “sites” framework ¶ Django comes with an optional “sites” framework. It’s a hook for associating\nobjects and functionality to particular websites, and it’s a holding place for\nthe domain names and “verbose” names of your Django-powered sites. Use it if your single Django installation powers more than one site and you\nneed to differentiate between those sites in some way. The sites framework is mainly based on this model: class models. Site ¶ A model for storing the domain and name attributes of a website. domain ¶ The fully qualified domain name associated with the website.\nFor example, www.example.com . name ¶ A human-readable “verbose” name for the website. The SITE_ID setting specifies the database ID of the Site object associated with that\nparticular settings file. If the setting is omitted, the get_current_site() function will\ntry to get the current site by comparing the domain with the host name from\nthe request.get_host() method. How you use this is up to you, but Django uses it in a couple of ways\nautomatically via a couple of conventions. Example usage ¶ Why would you use sites? It’s best explained through examples. Associating content with multiple sites ¶ The LJWorld.com and Lawrence.com sites were operated by the same news\norganization – the Lawrence Journal-World newspaper in Lawrence, Kansas.\nLJWorld.com focused on news, while Lawrence.com focused on local entertainment.\nBut sometimes editors wanted to publish an article on both sites. The naive way of solving the problem would be to require site producers to\npublish the same story twice: once for LJWorld.com and again for Lawrence.com.\nBut that’s inefficient for site producers, and it’s redundant to store\nmultiple copies of the same story in the database. A better solution removes the content duplication: Both sites use the same\narticle database, and an article is associated with one or more sites. In\nDjango model terminology, that’s represented by a ManyToManyField in the Article model: from django.contrib.sites.models import Site from django.db import models class Article ( models . Model ): headline = models . CharField ( max_length = 200 ) # ... sites = models . ManyToManyField ( Site ) This accomplishes several things quite nicely: It lets the site producers edit all content – on both sites – in a\nsingle interface (the Django admin). It means the same story doesn’t have to be published twice in the\ndatabase; it only has a single record in the database. It lets the site developers use the same Django view code for both sites.\nThe view code that displays a given story checks to make sure the requested\nstory is on the current site. It looks something like this: from django.contrib.sites.shortcuts import get_current_site def article_detail ( request , article_id ): try : a = Article . objects . get ( id = article_id , sites__id = get_current_site ( request ) . id ) except Article . DoesNotExist : raise Http404 ( \"Article does not exist on this site\" ) # ... Associating content with a single site ¶ Similarly, you can associate a model to the Site model in a many-to-one relationship, using ForeignKey . For example, if an article is only allowed on a single site, you’d use a model\nlike this: from django.contrib.sites.models import Site from django.db import models class Article ( models . Model ): headline = models . CharField ( max_length = 200 ) # ... site = models . ForeignKey ( Site , on_delete = models . CASCADE ) This has the same benefits as described in the last section. Hooking into the current site from views ¶ You can use the sites framework in your Django views to do\nparticular things based on the site in which the view is being called.\nFor example: from django.conf import settings def my_view ( request ): if settings . SITE_ID == 3 : # Do something. pass else : # Do something else. pass It’s fragile to hard-code the site IDs like that, in case they change. The\ncleaner way of accomplishing the same thing is to check the current site’s\ndomain: from django.contrib.sites.shortcuts import get_current_site def my_view ( request ): current_site = get_current_site ( request ) if current_site . domain == \"foo.com\" : # Do something pass else : # Do something else. pass This has also the advantage of checking if the sites framework is installed,\nand return a RequestSite instance if\nit is not. If you don’t have access to the request object, you can use the get_current() method of the Site model’s manager. You should then ensure that your settings file does contain\nthe SITE_ID setting. This example is equivalent to the previous one: from django.contrib.sites.models import Site def my_function_without_request (): current_site = Site . objects . get_current () if current_site . domain == \"foo.com\" : # Do something pass else : # Do something else. pass Getting the current domain for display ¶ LJWorld.com and Lawrence.com both have email alert functionality, which lets\nreaders sign up to get notifications when news happens. It’s pretty basic: A\nreader signs up on a web form and immediately gets an email saying,\n“Thanks for your subscription.” It’d be inefficient and redundant to implement this sign up processing code\ntwice, so the sites use the same code behind the scenes. But the “thank you for\nsigning up” notice needs to be different for each site. By using Site objects, we can abstract the “thank you” notice to use the values of the\ncurrent site’s name and domain . Here’s an example of what the form-handling view looks like: from django.contrib.sites.shortcuts import get_current_site from django.core.mail import send_mail def register_for_newsletter ( request ): # Check form values, etc., and subscribe the user. # ... current_site = get_current_site ( request ) send_mail ( \"Thanks for subscribing to %s alerts\" % current_site . name , \"Thanks for your subscription. We appreciate it. \\n\\n -The %s team.\" % ( current_site . name ,), \"editor@ %s \" % current_site . domain , [ user . email ], ) # ... On Lawrence.com, this email has the subject line “Thanks for subscribing to\nlawrence.com alerts.” On LJWorld.com, the email has the subject “Thanks for\nsubscribing to LJWorld.com alerts.” Same goes for the email’s message body. Note that an even more flexible (but more heavyweight) way of doing this would\nbe to use Django’s template system. Assuming Lawrence.com and LJWorld.com have\ndifferent template directories ( DIRS ), you could\nfarm out to the template system like so: from django.core.mail import send_mail from django.template import loader def register_for_newsletter ( request ): # Check form values, etc., and subscribe the user. # ... subject = loader . get_template ( \"alerts/subject.txt\" ) . render ({}) message = loader . get_template ( \"alerts/message.txt\" ) . render ({}) send_mail ( subject , message , \"editor@ljworld.com\" , [ user . email ]) # ... In this case, you’d have to create subject.txt and message.txt template files for both the LJWorld.com and Lawrence.com template directories.\nThat gives you more flexibility, but it’s also more complex. It’s a good idea to exploit the Site objects as much as possible, to remove unneeded complexity and redundancy. Getting the current domain for full URLs ¶ Django’s get_absolute_url() convention is nice for getting your objects’\nURL without the domain name, but in some cases you might want to display the\nfull URL – with https:// and the domain and everything – for an object.\nTo do this, you can use the sites framework. An example: >>> from django.contrib.sites.models import Site >>> obj = MyModel . objects . get ( id = 3 ) >>> obj . get_absolute_url () '/mymodel/objects/3/' >>> Site . objects . get_current () . domain 'example.com' >>> \"https:// %s%s \" % ( Site . objects . get_current () . domain , obj . get_absolute_url ()) 'https://example.com/mymodel/objects/3/' Enabling the sites framework ¶ To enable the sites framework, follow these steps: Add 'django.contrib.sites' to your INSTALLED_APPS setting. Define a SITE_ID setting: SITE_ID = 1 Run migrate . django.contrib.sites registers a post_migrate signal handler which creates a\ndefault site named example.com with the domain example.com . This site\nwill also be created after Django creates the test database. To set the\ncorrect name and domain for your project, you can use a data migration . In order to serve different sites in production, you’d create a separate\nsettings file with each SITE_ID (perhaps importing from a common settings\nfile to avoid duplicating shared settings) and then specify the appropriate DJANGO_SETTINGS_MODULE for each site. Caching the current Site object ¶ As the current site is stored in the database, each call to Site.objects.get_current() could result in a database query. But Django is a\nlittle cleverer than that: on the first request, the current site is cached, and\nany subsequent call returns the cached data instead of hitting the database. If for any reason you want to force a database query, you can tell Django to\nclear the cache using Site.objects.clear_cache() : # First call; current site fetched from database. current_site = Site . objects . get_current () # ... # Second call; current site fetched from cache. current_site = Site . objects . get_current () # ... # Force a database query for the third call. Site . objects . clear_cache () current_site = Site . objects . get_current () The CurrentSiteManager ¶ class managers. CurrentSiteManager ¶ If Site plays a key role in your\napplication, consider using the helpful CurrentSiteManager in your\nmodel(s). It’s a model manager that\nautomatically filters its queries to include only objects associated\nwith the current Site . Mandatory SITE_ID The CurrentSiteManager is only usable when the SITE_ID setting is defined in your settings. Use CurrentSiteManager by adding it to\nyour model explicitly. For example: from django.contrib.sites.models import Site from django.contrib.sites.managers import CurrentSiteManager from django.db import models class Photo ( models . Model ): photo = models . FileField ( upload_to = \"photos\" ) photographer_name = models . CharField ( max_length = 100 ) pub_date = models . DateField () site = models . ForeignKey ( Site , on_delete = models . CASCADE ) objects = models . Manager () on_site = CurrentSiteManager () With this model, Photo.objects.all() will return all Photo objects in\nthe database, but Photo.on_site.all() will return only the Photo objects\nassociated with the current site, according to the SITE_ID setting. Put another way, these two statements are equivalent: Photo . objects . filter ( site = settings . SITE_ID ) Photo . on_site . all () How did CurrentSiteManager know which field of Photo was the Site ? By default, CurrentSiteManager looks for a\neither a ForeignKey called site or a ManyToManyField called sites to filter on. If you use a field named something other than site or sites to identify which Site objects your object is\nrelated to, then you need to explicitly pass the custom field name as\na parameter to CurrentSiteManager on your\nmodel. The following model, which has a field called publish_on ,\ndemonstrates this: from django.contrib.sites.models import Site from django.contrib.sites.managers import CurrentSiteManager from django.db import models class Photo ( models . Model ): photo = models . FileField ( upload_to = \"photos\" ) photographer_name = models . CharField ( max_length = 100 ) pub_date = models . DateField () publish_on = models . ForeignKey ( Site , on_delete = models . CASCADE ) objects = models . Manager () on_site = CurrentSiteManager ( \"publish_on\" ) If you attempt to use CurrentSiteManager and pass a field name that doesn’t exist, Django will raise a ValueError . Finally, note that you’ll probably want to keep a normal\n(non-site-specific) Manager on your model, even if you use CurrentSiteManager . As\nexplained in the manager documentation , if\nyou define a manager manually, then Django won’t create the automatic objects = models.Manager() manager for you. Also note that certain\nparts of Django – namely, the Django admin site and generic views –\nuse whichever manager is defined first in the model, so if you want\nyour admin site to have access to all objects (not just site-specific\nones), put objects = models.Manager() in your model, before you\ndefine CurrentSiteManager . Site middleware ¶ If you often use this pattern: from django.contrib.sites.models import Site def my_view ( request ): site = Site . objects . get_current () ... To avoid repetitions, add django.contrib.sites.middleware.CurrentSiteMiddleware to MIDDLEWARE . The middleware sets the site attribute on every\nrequest object, so you can use request.site to get the current site. How Django uses the sites framework ¶ Although it’s not required that you use the sites framework, it’s strongly\nencouraged, because Django takes advantage of it in a few places. Even if your\nDjango installation is powering only a single site, you should take the two\nseconds to create the site object with your domain and name , and point\nto its ID in your SITE_ID setting. Here’s how Django uses the sites framework: In the redirects framework , each\nredirect object is associated with a particular site. When Django searches\nfor a redirect, it takes into account the current site. In the flatpages framework , each\nflatpage is associated with a particular site. When a flatpage is created,\nyou specify its Site , and the FlatpageFallbackMiddleware checks the current site in retrieving flatpages to display. In the syndication framework , the\ntemplates for title and description automatically have access to a\nvariable {{ site }} , which is the Site object representing the current\nsite. Also, the hook for providing item URLs will use the domain from\nthe current Site object if you don’t\nspecify a fully-qualified domain. In the authentication framework , django.contrib.auth.views.LoginView passes the current Site name to the template as {{ site_name }} . The shortcut view ( django.contrib.contenttypes.views.shortcut )\nuses the domain of the current Site object when calculating\nan object’s URL. In the admin framework, the “view on site” link uses the current Site to work out the domain for the\nsite that it will redirect to. RequestSite objects ¶ Some django.contrib applications take advantage of\nthe sites framework but are architected in a way that doesn’t require the\nsites framework to be installed in your database. (Some people don’t want to,\nor just aren’t able to install the extra database table that the sites\nframework requires.) For those cases, the framework provides a django.contrib.sites.requests.RequestSite class, which can be used as\na fallback when the database-backed sites framework is not available. class requests. RequestSite ¶ A class that shares the primary interface of Site (i.e., it has domain and name attributes) but gets its data from a Django HttpRequest object rather than from a database. __init__ ( request ) ¶ Sets the name and domain attributes to the value of get_host() . A RequestSite object has a similar\ninterface to a normal Site object,\nexcept its __init__() method takes an HttpRequest object. It’s able to deduce\nthe domain and name by looking at the request’s domain. It has save() and delete() methods to match the interface of Site , but the methods raise NotImplementedError . get_current_site shortcut ¶ Finally, to avoid repetitive fallback code, the framework provides a django.contrib.sites.shortcuts.get_current_site() function. shortcuts. get_current_site ( request ) ¶ A function that checks if django.contrib.sites is installed and\nreturns either the current Site object or a RequestSite object\nbased on the request. It looks up the current site based on request.get_host() if the SITE_ID setting is not defined. Both a domain and a port may be returned by request.get_host() when the Host header has a port\nexplicitly specified, e.g. example.com:80 . In such cases, if the\nlookup fails because the host does not match a record in the database,\nthe port is stripped and the lookup is retried with the domain part\nonly. This does not apply to RequestSite which will always\nuse the unmodified host.", "keywords": ["function", "mymodel", "views", "examples", "django.core.mail", "repetitions", "view", "websites", "subscribing", "django.contrib.sites.models", "production", "request.get_host", "verbose", "article_detail", "subscription", "dirs", "pattern", "url", "def", "django.contrib.sites.shortcuts", "check", "code", "point", "site", "kansas", "values", "django.contrib.sites.middleware", "directories", "django.contrib", "filter", "i", "class", "example", "access", "#", "display", "migration", "field", "flatpages", "link", "record", "thing", "names", "seconds", "objects/3/", "request", "django_settings_module", "managers", "photo.on_site.all", "database", "host", "table", "subject", "email", "steps", "models", "signal", "query", "test", "photos", "photographer_name", "cache", "human", "ways", "migrate", "datefield", "model", "https://example.com/mymodel/objects/3/", "variable", "idea", "publish_on", "place", "admin", "organization", "article", "application", "benefits", "ids", "http404", "reader", "usage", "attributes", "hook", "django", "=", "title", "n’t", "currentsitemanager", "max_length", "producers", "register_for_newsletter", "get_absolute_url", "redirects", "alert", "article_id", "message", "role", "installation", "relationship", "editors", "django.contrib.sites", "upload_to", "flexibility", "notifications", "request.site", "redundancy", "value", "section", "journal", "line", "foo.com", "ones", "photo.objects.all", "send_mail", "case", "flatpage", "data", "terminology", "places", "authentication", "fallback", "lookup", "handler", "item", "lawrence", "get_current", "notimplementederror", "alerts", "conventions", "cleverer", "photo", "on_site", "processing", "init", "solution", "filefield", "middleware", "shortcut", "people", "instance", "custom", "objects", "documentation", "flatpagefallbackmiddleware", "newspaper", "pub_date", "file", "django.contrib.sites.requests", "handling", "order", "interface", "default", "user", "get_template", "loginview", "loader", "cases", "lawrence.com", "functionality", "current_site", "team", "requestsite", "duplication", "form", "attribute", "my_view", "shortcuts", "scenes", "problem", "readers", "developers", "sign", "sites__id", "doesnotexist", "convention", "reason", "framework", "thanks", "setting", "story", "django.template", "urls", "account", "advantage", "ljworld.com", "installed_apps", "description", "part", "complexity", "django.contrib.contenttypes.views.shortcut", "object", "things", "couple", "domain", "valueerror", "https://", "import", "name", "files", "charfield", "d", "template", "httprequest", "manytomanyfield", "parameter", "powers", "django.contrib.sites.managers", "website", "%", "statements", "header", "call", "site_id", "world", "foreignkey", "way", "site.objects.clear_cache", "requests", "copies", "get_host", "django.contrib.auth.views", "web", "checks", "methods", "\\n\\n", "queries", "get_current_site", "currentsitemiddleware", "syndication", "manager", "force", "notice", "method", "django.db", "settings", "¶", "obj", "news", "redirect", "id", "applications", "sites", "body", "entertainment", "model(s", "system", "headline", "port", "site_name", "templates", "content", "project", "parts"], "type": "documentation"},
{"title": "GDAL API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/gdal/", "content": "GDAL API ¶ GDAL stands for Geospatial Data Abstraction Library ,\nand is a veritable “Swiss army knife” of GIS data functionality.  A subset\nof GDAL is the OGR Simple Features Library, which specializes\nin reading and writing vector geographic data in a variety of standard\nformats. GeoDjango provides a high-level Python interface for some of the\ncapabilities of OGR, including the reading and coordinate transformation\nof vector spatial data and minimal support for GDAL’s features with respect\nto raster (image) data. Note Although the module is named gdal , GeoDjango only supports some of the\ncapabilities of OGR and GDAL’s raster features at this time. Overview ¶ Sample Data ¶ The GDAL/OGR tools described here are designed to help you read in\nyour geospatial data, in order for most of them to be useful you have\nto have some data to work with.  If you’re starting out and don’t yet\nhave any data of your own to use, GeoDjango tests contain a number of\ndata sets that you can use for testing. You can download them here: $ wget https://raw.githubusercontent.com/django/django/main/tests/gis_tests/data/cities/cities. { shp,prj,shx,dbf } $ wget https://raw.githubusercontent.com/django/django/main/tests/gis_tests/data/rasters/raster.tif Vector Data Source Objects ¶ DataSource ¶ DataSource is a wrapper for the OGR data source object that\nsupports reading data from a variety of OGR-supported geospatial file\nformats and data sources using a consistent interface.  Each\ndata source is represented by a DataSource object which contains\none or more layers of data.  Each layer, represented by a Layer object, contains some number of geographic features ( Feature ),\ninformation about the type of features contained in that layer (e.g.\npoints, polygons, etc.), as well as the names and types of any\nadditional fields ( Field ) of data that may be associated with\neach feature in that layer. class DataSource ( ds_input , encoding = 'utf-8' ) [source] ¶ The constructor for DataSource only requires one parameter: the path of\nthe file you want to read. However, OGR also supports a variety of more\ncomplex data sources, including databases, that may be accessed by passing\na special name string instead of a path. For more information, see the OGR Vector Formats documentation. The name property of a DataSource instance gives the OGR name of the underlying data source\nthat it is using. The optional encoding parameter allows you to specify a non-standard\nencoding of the strings in the source. This is typically useful when you\nobtain DjangoUnicodeDecodeError exceptions while reading field values. Once you’ve created your DataSource , you can find out how many layers\nof data it contains by accessing the layer_count property, or\n(equivalently) by using the len() function. For information on\naccessing the layers of data themselves, see the next section: >>> from django.contrib.gis.gdal import DataSource >>> ds = DataSource ( \"/path/to/your/cities.shp\" ) >>> ds . name '/path/to/your/cities.shp' >>> ds . layer_count # This file only contains one layer 1 layer_count [source] ¶ Returns the number of layers in the data source. name [source] ¶ Returns the name of the data source. Layer ¶ class Layer ¶ Layer is a wrapper for a layer of data in a DataSource object. You\nnever create a Layer object directly. Instead, you retrieve them from\na DataSource object, which is essentially a standard Python\ncontainer of Layer objects. For example, you can access a specific\nlayer by its index (e.g. ds[0] to access the first layer), or you can\niterate over all the layers in the container in a for loop. The Layer itself acts as a container for geometric features. Typically, all the features in a given layer have the same geometry type.\nThe geom_type property of a layer is an OGRGeomType that\nidentifies the feature type. We can use it to print out some basic\ninformation about each layer in a DataSource : >>> for layer in ds : ... print ( 'Layer \" %s \": %i %s s' % ( layer . name , len ( layer ), layer . geom_type . name )) ... Layer \"cities\": 3 Points The example output is from the cities data source, loaded above, which\nevidently contains one layer, called \"cities\" , which contains three\npoint features. For simplicity, the examples below assume that you’ve\nstored that layer in the variable layer : >>> layer = ds [ 0 ] name ¶ Returns the name of this layer in the data source. >>> layer . name 'cities' num_feat ¶ Returns the number of features in the layer. Same as len(layer) : >>> layer . num_feat 3 geom_type ¶ Returns the geometry type of the layer, as an OGRGeomType object: >>> layer . geom_type . name 'Point' num_fields ¶ Returns the number of fields in the layer, i.e the number of fields of\ndata associated with each feature in the layer: >>> layer . num_fields 4 fields ¶ Returns a list of the names of each of the fields in this layer: >>> layer . fields ['Name', 'Population', 'Density', 'Created'] Returns a list of the data types of each of the fields in this layer. These\nare subclasses of Field , discussed below: >>> [ ft . __name__ for ft in layer . field_types ] ['OFTString', 'OFTReal', 'OFTReal', 'OFTDate'] field_widths ¶ Returns a list of the maximum field widths for each of the fields in this\nlayer: >>> layer . field_widths [80, 11, 24, 10] field_precisions ¶ Returns a list of the numeric precisions for each of the fields in this\nlayer. This is meaningless (and set to zero) for non-numeric fields: >>> layer . field_precisions [0, 0, 15, 0] extent ¶ Returns the spatial extent of this layer, as an Envelope object: >>> layer . extent . tuple (-104.609252, 29.763374, -95.23506, 38.971823) srs ¶ Property that returns the SpatialReference associated with this\nlayer: >>> print ( layer . srs ) GEOGCS[\"GCS_WGS_1984\", DATUM[\"WGS_1984\", SPHEROID[\"WGS_1984\",6378137,298.257223563]], PRIMEM[\"Greenwich\",0], UNIT[\"Degree\",0.017453292519943295]] If the Layer has no spatial reference information associated\nwith it, None is returned. spatial_filter ¶ Property that may be used to retrieve or set a spatial filter for this\nlayer. A spatial filter can only be set with an OGRGeometry instance, a 4-tuple extent, or None . When set with something other than None , only features that intersect the filter will be returned when\niterating over the layer: >>> print ( layer . spatial_filter ) None >>> print ( len ( layer )) 3 >>> [ feat . get ( \"Name\" ) for feat in layer ] ['Pueblo', 'Lawrence', 'Houston'] >>> ks_extent = ( - 102.051 , 36.99 , - 94.59 , 40.00 ) # Extent for state of Kansas >>> layer . spatial_filter = ks_extent >>> len ( layer ) 1 >>> [ feat . get ( \"Name\" ) for feat in layer ] ['Lawrence'] >>> layer . spatial_filter = None >>> len ( layer ) 3 get_fields () ¶ A method that returns a list of the values of a given field for each\nfeature in the layer: >>> layer . get_fields ( \"Name\" ) ['Pueblo', 'Lawrence', 'Houston'] get_geoms ( geos = False ) ¶ A method that returns a list containing the geometry of each feature in the\nlayer. If the optional argument geos is set to True then the\ngeometries are converted to GEOSGeometry objects. Otherwise, they are returned as OGRGeometry objects: >>> [ pt . tuple for pt in layer . get_geoms ()] [(-104.609252, 38.255001), (-95.23506, 38.971823), (-95.363151, 29.763374)] test_capability ( capability ) ¶ Returns a boolean indicating whether this layer supports the given\ncapability (a string).  Examples of valid capability strings include: 'RandomRead' , 'SequentialWrite' , 'RandomWrite' , 'FastSpatialFilter' , 'FastFeatureCount' , 'FastGetExtent' , 'CreateField' , 'Transactions' , 'DeleteFeature' , and 'FastSetNextByIndex' . Feature ¶ class Feature ¶ Feature wraps an OGR feature. You never create a Feature object\ndirectly. Instead, you retrieve them from a Layer object. Each\nfeature consists of a geometry and a set of fields containing additional\nproperties. The geometry of a field is accessible via its geom property,\nwhich returns an OGRGeometry object. A Feature behaves like a\nstandard Python container for its fields, which it returns as Field objects: you can access a field directly by its index or name, or you can\niterate over a feature’s fields, e.g. in a for loop. geom ¶ Returns the geometry for this feature, as an OGRGeometry object: >>> city . geom . tuple (-104.609252, 38.255001) get ¶ A method that returns the value of the given field (specified by name)\nfor this feature, not a Field wrapper object: >>> city . get ( \"Population\" ) 102121 geom_type ¶ Returns the type of geometry for this feature, as an OGRGeomType object. This will be the same for all features in a given layer and is\nequivalent to the Layer.geom_type property of the Layer object the feature came from. num_fields ¶ Returns the number of fields of data associated with the feature. This will\nbe the same for all features in a given layer and is equivalent to the Layer.num_fields property of the Layer object the feature\ncame from. fields ¶ Returns a list of the names of the fields of data associated with the\nfeature. This will be the same for all features in a given layer and is\nequivalent to the Layer.fields property of the Layer object the feature came from. fid ¶ Returns the feature identifier within the layer: >>> city . fid 0 layer_name ¶ Returns the name of the Layer that the feature came from. This\nwill be the same for all features in a given layer: >>> city . layer_name 'cities' index ¶ A method that returns the index of the given field name. This will be the\nsame for all features in a given layer: >>> city . index ( \"Population\" ) 1 Field ¶ class Field ¶ name ¶ Returns the name of this field: >>> city [ \"Name\" ] . name 'Name' type ¶ Returns the OGR type of this field, as an integer. The FIELD_CLASSES dictionary maps these values onto subclasses of Field : >>> city [ \"Density\" ] . type 2 type_name ¶ Returns a string with the name of the data type of this field: >>> city [ \"Name\" ] . type_name 'String' value ¶ Returns the value of this field. The Field class itself returns the\nvalue as a string, but each subclass returns the value in the most\nappropriate form: >>> city [ \"Population\" ] . value 102121 width ¶ Returns the width of this field: >>> city [ \"Name\" ] . width 80 precision ¶ Returns the numeric precision of this field. This is meaningless (and set\nto zero) for non-numeric fields: >>> city [ \"Density\" ] . precision 15 as_double () ¶ Returns the value of the field as a double (float): >>> city [ \"Density\" ] . as_double () 874.7 as_int () ¶ Returns the value of the field as an integer: >>> city [ \"Population\" ] . as_int () 102121 as_string () ¶ Returns the value of the field as a string: >>> city [ \"Name\" ] . as_string () 'Pueblo' as_datetime () ¶ Returns the value of the field as a tuple of date and time components: >>> city [ \"Created\" ] . as_datetime () (c_long(1999), c_long(5), c_long(23), c_long(0), c_long(0), c_long(0), c_long(0)) Driver ¶ class Driver ( dr_input ) [source] ¶ The Driver class is used internally to wrap an OGR DataSource driver. driver_count [source] ¶ Returns the number of OGR vector drivers currently registered. OGR Geometries ¶ OGRGeometry ¶ OGRGeometry objects share similar functionality with GEOSGeometry objects and are thin wrappers\naround OGR’s internal geometry representation. Thus, they allow for more\nefficient access to data when using DataSource . Unlike its GEOS\ncounterpart, OGRGeometry supports spatial reference systems and\ncoordinate transformation: >>> from django.contrib.gis.gdal import OGRGeometry >>> polygon = OGRGeometry ( \"POLYGON((0 0, 5 0, 5 5, 0 5))\" ) class OGRGeometry ( geom_input , srs = None ) [source] ¶ This object is a wrapper for the OGR Geometry class. These objects are\ninstantiated directly from the given geom_input parameter, which may be\na string containing WKT, HEX, GeoJSON, a buffer containing WKB data, or\nan OGRGeomType object. These objects are also returned from the Feature.geom attribute, when reading vector data from Layer (which is in turn a part of a DataSource ). classmethod from_gml ( gml_string ) [source] ¶ Constructs an OGRGeometry from the given GML string. classmethod from_bbox ( bbox ) [source] ¶ Constructs a Polygon from the given bounding-box (a 4-tuple). __len__ () ¶ Returns the number of points in a LineString , the number of rings\nin a Polygon , or the number of geometries in a GeometryCollection . Not applicable to other geometry types. __iter__ () ¶ Iterates over the points in a LineString , the rings in a Polygon , or the geometries in a GeometryCollection .\nNot applicable to other geometry types. __getitem__ () ¶ Returns the point at the specified index for a LineString , the\ninterior ring at the specified index for a Polygon , or the geometry\nat the specified index in a GeometryCollection . Not applicable to\nother geometry types. dimension [source] ¶ Returns the number of coordinated dimensions of the geometry, i.e. 0\nfor points, 1 for lines, and so forth: >>> polygon . dimension 2 coord_dim [source] ¶ Returns the coordinate dimension of this geometry. For example, the value\nwould be 2 for two-dimensional geometries. Deprecated since version 5.1: The coord_dim setter is deprecated. Use set_3d() instead. is_3d [source] ¶ New in Django 5.1. A boolean indicating if this geometry has Z coordinates. set_3d ( value ) [source] ¶ New in Django 5.1. A method that adds or removes the Z coordinate dimension. >>> p = OGRGeometry ( \"POINT (1 2 3)\" ) >>> p . is_3d True >>> p . set_3d ( False ) >>> p . wkt \"POINT (1 2)\" is_measured [source] ¶ New in Django 5.1. A boolean indicating if this geometry has M coordinates. set_measured ( value ) [source] ¶ New in Django 5.1. A method to add or remove the M coordinate dimension. >>> p = OGRGeometry ( \"POINT (1 2)\" ) >>> p . is_measured False >>> p . set_measured ( True ) >>> p . wkt \"POINT M (1 2 0)\" geom_count [source] ¶ Returns the number of elements in this geometry: >>> polygon . geom_count 1 point_count [source] ¶ Returns the number of points used to describe this geometry: >>> polygon . point_count 4 num_points [source] ¶ Alias for point_count . num_coords [source] ¶ Alias for point_count . geom_type [source] ¶ Returns the type of this geometry, as an OGRGeomType object. geom_name [source] ¶ Returns the name of the type of this geometry: >>> polygon . geom_name 'POLYGON' area [source] ¶ Returns the area of this geometry, or 0 for geometries that do not contain\nan area: >>> polygon . area 25.0 envelope [source] ¶ Returns the envelope of this geometry, as an Envelope object. extent [source] ¶ Returns the envelope of this geometry as a 4-tuple, instead of as an Envelope object: >>> point . extent (0.0, 0.0, 5.0, 5.0) srs ¶ This property controls the spatial reference for this geometry, or None if no spatial reference system has been assigned to it.\nIf assigned, accessing this property returns a SpatialReference object.  It may be set with another SpatialReference object,\nor any input that SpatialReference accepts. Example: >>> city . geom . srs . name 'GCS_WGS_1984' srid ¶ Returns or sets the spatial reference identifier corresponding to SpatialReference of this geometry.  Returns None if\nthere is no spatial reference information associated with this\ngeometry, or if an SRID cannot be determined. geos [source] ¶ Returns a GEOSGeometry object\ncorresponding to this geometry. gml [source] ¶ Returns a string representation of this geometry in GML format: >>> OGRGeometry ( \"POINT(1 2)\" ) . gml '<gml:Point><gml:coordinates>1,2</gml:coordinates></gml:Point>' hex [source] ¶ Returns a string representation of this geometry in HEX WKB format: >>> OGRGeometry ( \"POINT(1 2)\" ) . hex '0101000000000000000000F03F0000000000000040' json [source] ¶ Returns a string representation of this geometry in JSON format: >>> OGRGeometry ( \"POINT(1 2)\" ) . json '{ \"type\": \"Point\", \"coordinates\": [ 1.000000, 2.000000 ] }' kml [source] ¶ Returns a string representation of this geometry in KML format. wkb_size [source] ¶ Returns the size of the WKB buffer needed to hold a WKB representation\nof this geometry: >>> OGRGeometry ( \"POINT(1 2)\" ) . wkb_size 21 wkb [source] ¶ Returns a buffer containing a WKB representation of this geometry. wkt [source] ¶ Returns a string representation of this geometry in WKT format. ewkt [source] ¶ Returns the EWKT representation of this geometry. clone () [source] ¶ Returns a new OGRGeometry clone of this geometry object. close_rings () [source] ¶ If there are any rings within this geometry that have not been closed,\nthis routine will do so by adding the starting point to the end: >>> triangle = OGRGeometry ( \"LINEARRING (0 0,0 1,1 0)\" ) >>> triangle . close_rings () >>> triangle . wkt 'LINEARRING (0 0,0 1,1 0,0 0)' transform ( coord_trans , clone = False ) [source] ¶ Transforms this geometry to a different spatial reference system. May take\na CoordTransform object, a SpatialReference object, or\nany other input accepted by SpatialReference (including spatial\nreference WKT and PROJ strings, or an integer SRID). By default nothing is returned and the geometry is transformed in-place.\nHowever, if the clone keyword is set to True then a transformed\nclone of this geometry is returned instead. intersects ( other ) [source] ¶ Returns True if this geometry intersects the other, otherwise returns False . equals ( other ) [source] ¶ Returns True if this geometry is equivalent to the other, otherwise\nreturns False . disjoint ( other ) [source] ¶ Returns True if this geometry is spatially disjoint to (i.e. does\nnot intersect) the other, otherwise returns False . touches ( other ) [source] ¶ Returns True if this geometry touches the other, otherwise returns False . crosses ( other ) [source] ¶ Returns True if this geometry crosses the other, otherwise returns False . within ( other ) [source] ¶ Returns True if this geometry is contained within the other, otherwise\nreturns False . contains ( other ) [source] ¶ Returns True if this geometry contains the other, otherwise returns False . overlaps ( other ) [source] ¶ Returns True if this geometry overlaps the other, otherwise returns False . boundary () [source] ¶ The boundary of this geometry, as a new OGRGeometry object. convex_hull [source] ¶ The smallest convex polygon that contains this geometry, as a new OGRGeometry object. difference () [source] ¶ Returns the region consisting of the difference of this geometry and\nthe other, as a new OGRGeometry object. intersection () [source] ¶ Returns the region consisting of the intersection of this geometry and\nthe other, as a new OGRGeometry object. sym_difference () [source] ¶ Returns the region consisting of the symmetric difference of this\ngeometry and the other, as a new OGRGeometry object. union () [source] ¶ Returns the region consisting of the union of this geometry and\nthe other, as a new OGRGeometry object. centroid [source] ¶ Returns a Point representing the centroid of this geometry. Changed in Django 5.1: centroid was promoted from a Polygon only attribute to\nbeing available on all geometry types. tuple ¶ Returns the coordinates of a point geometry as a tuple, the\ncoordinates of a line geometry as a tuple of tuples, and so forth: >>> OGRGeometry ( \"POINT (1 2)\" ) . tuple (1.0, 2.0) >>> OGRGeometry ( \"LINESTRING (1 2,3 4)\" ) . tuple ((1.0, 2.0), (3.0, 4.0)) coords ¶ An alias for tuple . class Point ¶ x ¶ Returns the X coordinate of this point: >>> OGRGeometry ( \"POINT (1 2)\" ) . x 1.0 y ¶ Returns the Y coordinate of this point: >>> OGRGeometry ( \"POINT (1 2)\" ) . y 2.0 z ¶ Returns the Z coordinate of this point, or None if the point does not\nhave a Z coordinate: >>> OGRGeometry ( \"POINT (1 2 3)\" ) . z 3.0 m ¶ New in Django 5.1. Returns the M coordinate of this point, or None if the Point does not\nhave an M coordinate: >>> OGRGeometry ( \"POINT ZM (1 2 3 4)\" ) . m 4.0 class LineString ¶ x ¶ Returns a list of X coordinates in this line: >>> OGRGeometry ( \"LINESTRING (1 2,3 4)\" ) . x [1.0, 3.0] y ¶ Returns a list of Y coordinates in this line: >>> OGRGeometry ( \"LINESTRING (1 2,3 4)\" ) . y [2.0, 4.0] z ¶ Returns a list of Z coordinates in this line, or None if the line does\nnot have Z coordinates: >>> OGRGeometry ( \"LINESTRING (1 2 3,4 5 6)\" ) . z [3.0, 6.0] m ¶ New in Django 5.1. Returns a list of M coordinates in this line or None if the line does\nnot have M coordinates: >>> OGRGeometry ( \"LINESTRING(0 1 2 10, 1 2 3 11, 2 3 4 12)\" ) . m [10.0, 11.0, 12.0] class Polygon ¶ shell ¶ Returns the shell or exterior ring of this polygon, as a LinearRing geometry. exterior_ring ¶ An alias for shell . class GeometryCollection ¶ add ( geom ) ¶ Adds a geometry to this geometry collection. Not applicable to other\ngeometry types. OGRGeomType ¶ class OGRGeomType ( type_input ) [source] ¶ This class allows for the representation of an OGR geometry type\nin any of several ways: >>> from django.contrib.gis.gdal import OGRGeomType >>> gt1 = OGRGeomType ( 3 ) # Using an integer for the type >>> gt2 = OGRGeomType ( \"Polygon\" ) # Using a string >>> gt3 = OGRGeomType ( \"POLYGON\" ) # It's case-insensitive >>> print ( gt1 == 3 , gt1 == \"Polygon\" ) # Equivalence works w/non-OGRGeomType objects True True name [source] ¶ Returns a short-hand string form of the OGR Geometry type: >>> gt1 . name 'Polygon' num ¶ Returns the number corresponding to the OGR geometry type: >>> gt1 . num 3 django [source] ¶ Returns the Django field type (a subclass of GeometryField) to use for\nstoring this OGR type, or None if there is no appropriate Django type: >>> gt1 . django 'PolygonField' Envelope ¶ class Envelope ( * args ) [source] ¶ Represents an OGR Envelope structure that contains the minimum and maximum\nX, Y coordinates for a rectangle bounding box. The naming of the variables\nis compatible with the OGR Envelope C structure. min_x [source] ¶ The value of the minimum X coordinate. min_y [source] ¶ The value of the maximum X coordinate. max_x [source] ¶ The value of the minimum Y coordinate. max_y [source] ¶ The value of the maximum Y coordinate. ur [source] ¶ The upper-right coordinate, as a tuple. ll [source] ¶ The lower-left coordinate, as a tuple. tuple [source] ¶ A tuple representing the envelope. wkt [source] ¶ A string representing this envelope as a polygon in WKT format. expand_to_include ( * args ) [source] ¶ Coordinate System Objects ¶ SpatialReference ¶ class SpatialReference ( srs_input ) [source] ¶ Spatial reference objects are initialized on the given srs_input ,\nwhich may be one of the following: OGC Well Known Text (WKT) (a string) EPSG code (integer or string) PROJ string A shorthand string for well-known standards ( 'WGS84' , 'WGS72' , 'NAD27' , 'NAD83' ) Example: >>> wgs84 = SpatialReference ( \"WGS84\" ) # shorthand string >>> wgs84 = SpatialReference ( 4326 ) # EPSG code >>> wgs84 = SpatialReference ( \"EPSG:4326\" ) # EPSG string >>> proj = \"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs \" >>> wgs84 = SpatialReference ( proj ) # PROJ string >>> wgs84 = SpatialReference ( ... \"\"\"GEOGCS[\"WGS 84\", ... DATUM[\"WGS_1984\", ... SPHEROID[\"WGS 84\",6378137,298.257223563, ... AUTHORITY[\"EPSG\",\"7030\"]], ... AUTHORITY[\"EPSG\",\"6326\"]], ... PRIMEM[\"Greenwich\",0, ... AUTHORITY[\"EPSG\",\"8901\"]], ... UNIT[\"degree\",0.01745329251994328, ... AUTHORITY[\"EPSG\",\"9122\"]], ... AUTHORITY[\"EPSG\",\"4326\"]]\"\"\" ... ) # OGC WKT __getitem__ ( target ) [source] ¶ Returns the value of the given string attribute node, None if the node\ndoesn’t exist. Can also take a tuple as a parameter, (target, child), where\nchild is the index of the attribute in the WKT. For example: >>> wkt = 'GEOGCS[\"WGS 84\", DATUM[\"WGS_1984, ... AUTHORITY[\"EPSG\",\"4326\"]]' >>> srs = SpatialReference ( wkt ) # could also use 'WGS84', or 4326 >>> print ( srs [ \"GEOGCS\" ]) WGS 84 >>> print ( srs [ \"DATUM\" ]) WGS_1984 >>> print ( srs [ \"AUTHORITY\" ]) EPSG >>> print ( srs [ \"AUTHORITY\" , 1 ]) # The authority value 4326 >>> print ( srs [ \"TOWGS84\" , 4 ]) # the fourth value in this wkt 0 >>> print ( srs [ \"UNIT|AUTHORITY\" ]) # For the units authority, have to use the pipe symbol. EPSG >>> print ( srs [ \"UNIT|AUTHORITY\" , 1 ]) # The authority value for the units 9122 attr_value ( target , index = 0 ) [source] ¶ The attribute value for the given target node (e.g. 'PROJCS' ).\nThe index keyword specifies an index of the child node to return. auth_name ( target ) [source] ¶ Returns the authority name for the given string target node. auth_code ( target ) [source] ¶ Returns the authority code for the given string target node. clone () [source] ¶ Returns a clone of this spatial reference object. identify_epsg () [source] ¶ This method inspects the WKT of this SpatialReference and will add EPSG\nauthority nodes where an EPSG identifier is applicable. from_esri () [source] ¶ Morphs this SpatialReference from ESRI’s format to EPSG to_esri () [source] ¶ Morphs this SpatialReference to ESRI’s format. validate () [source] ¶ Checks to see if the given spatial reference is valid, if not\nan exception will be raised. import_epsg ( epsg ) [source] ¶ Import spatial reference from EPSG code. import_proj ( proj ) [source] ¶ Import spatial reference from PROJ string. import_user_input ( user_input ) [source] ¶ import_wkt ( wkt ) [source] ¶ Import spatial reference from WKT. import_xml ( xml ) [source] ¶ Import spatial reference from XML. name [source] ¶ Returns the name of this Spatial Reference. srid [source] ¶ Returns the SRID of top-level authority, or None if undefined. linear_name [source] ¶ Returns the name of the linear units. linear_units [source] ¶ Returns the value of the linear units. angular_name [source] ¶ Returns the name of the angular units.” angular_units [source] ¶ Returns the value of the angular units. units [source] ¶ Returns a 2-tuple of the units value and the units name and will\nautomatically determines whether to return the linear or angular units. ellipsoid [source] ¶ Returns a tuple of the ellipsoid parameters for this spatial reference:\n(semimajor axis, semiminor axis, and inverse flattening). semi_major [source] ¶ Returns the semi major axis of the ellipsoid for this spatial reference. semi_minor [source] ¶ Returns the semi minor axis of the ellipsoid for this spatial reference. inverse_flattening [source] ¶ Returns the inverse flattening of the ellipsoid for this spatial reference. geographic [source] ¶ Returns True if this spatial reference is geographic (root node is GEOGCS ). local [source] ¶ Returns True if this spatial reference is local (root node is LOCAL_CS ). projected [source] ¶ Returns True if this spatial reference is a projected coordinate system\n(root node is PROJCS ). wkt [source] ¶ Returns the WKT representation of this spatial reference. pretty_wkt [source] ¶ Returns the ‘pretty’ representation of the WKT. proj [source] ¶ Returns the PROJ representation for this spatial reference. proj4 [source] ¶ Alias for SpatialReference.proj . xml [source] ¶ Returns the XML representation of this spatial reference. CoordTransform ¶ class CoordTransform ( source , target ) [source] ¶ Represents a coordinate system transform. It is initialized with two SpatialReference , representing the source and target coordinate\nsystems, respectively. These objects should be used when performing the same\ncoordinate transformation repeatedly on different geometries: >>> ct = CoordTransform ( SpatialReference ( \"WGS84\" ), SpatialReference ( \"NAD83\" )) >>> for feat in layer : ... geom = feat . geom # getting clone of feature geometry ... geom . transform ( ct ) # transforming ... Raster Data Objects ¶ GDALRaster ¶ GDALRaster is a wrapper for the GDAL raster source object that\nsupports reading data from a variety of GDAL-supported geospatial file\nformats and data sources using a consistent interface.  Each\ndata source is represented by a GDALRaster object which contains\none or more layers of data named bands.  Each band, represented by a GDALBand object, contains georeferenced image data. For example, an RGB\nimage is represented as three bands: one for red, one for green, and one for\nblue. Note For raster data there is no difference between a raster instance and its\ndata source. Unlike for the Geometry objects, GDALRaster objects are\nalways a data source. Temporary rasters can be instantiated in memory\nusing the corresponding driver, but they will be of the same class as file-based\nraster sources. class GDALRaster ( ds_input , write = False ) [source] ¶ The constructor for GDALRaster accepts two parameters. The first\nparameter defines the raster source, and the second parameter defines if a\nraster should be opened in write mode. For newly-created rasters, the second\nparameter is ignored and the new raster is always created in write mode. The first parameter can take three forms: a string or Path representing a file path (filesystem or GDAL virtual\nfilesystem), a dictionary with values defining a new raster, or a bytes\nobject representing a raster file. If the input is a file path, the raster is opened from there. If the input\nis raw data in a dictionary, the parameters width , height , and srid are required. If the input is a bytes object, it will be opened\nusing a GDAL virtual filesystem. For a detailed description of how to create rasters using dictionary input,\nsee Creating rasters from data . For a detailed description of how to\ncreate rasters in the virtual filesystem, see Using GDAL’s Virtual Filesystem . The following example shows how rasters can be created from different input\nsources (using the sample data from the GeoDjango tests; see also the Sample Data section). >>> from django.contrib.gis.gdal import GDALRaster >>> rst = GDALRaster ( \"/path/to/your/raster.tif\" , write = False ) >>> rst . name '/path/to/your/raster.tif' >>> rst . width , rst . height # This file has 163 x 174 pixels (163, 174) >>> rst = GDALRaster ( ... { # Creates an in-memory raster ... \"srid\" : 4326 , ... \"width\" : 4 , ... \"height\" : 4 , ... \"datatype\" : 1 , ... \"bands\" : [ ... { ... \"data\" : ( 2 , 3 ), ... \"offset\" : ( 1 , 1 ), ... \"size\" : ( 2 , 2 ), ... \"shape\" : ( 2 , 1 ), ... \"nodata_value\" : 5 , ... } ... ], ... } ... ) >>> rst . srs . srid 4326 >>> rst . width , rst . height (4, 4) >>> rst . bands [ 0 ] . data () array([[5, 5, 5, 5], [5, 2, 3, 5], [5, 2, 3, 5], [5, 5, 5, 5]], dtype=uint8) >>> rst_file = open ( \"/path/to/your/raster.tif\" , \"rb\" ) >>> rst_bytes = rst_file . read () >>> rst = GDALRaster ( rst_bytes ) >>> rst . is_vsi_based True >>> rst . name # Stored in a random path in the vsimem filesystem. '/vsimem/da300bdb-129d-49a8-b336-e410a9428dad' name [source] ¶ The name of the source which is equivalent to the input file path or the name\nprovided upon instantiation. >>> GDALRaster ({ \"width\" : 10 , \"height\" : 10 , \"name\" : \"myraster\" , \"srid\" : 4326 }) . name 'myraster' driver [source] ¶ The name of the GDAL driver used to handle the input file. For GDALRaster s created\nfrom a file, the driver type is detected automatically. The creation of rasters from\nscratch is an in-memory raster by default ( 'MEM' ), but can be\naltered as needed. For instance, use GTiff for a GeoTiff file.\nFor a list of file types, see also the GDAL Raster Formats list. An in-memory raster is created through the following example: >>> GDALRaster ({ \"width\" : 10 , \"height\" : 10 , \"srid\" : 4326 }) . driver . name 'MEM' A file based GeoTiff raster is created through the following example: >>> import tempfile >>> rstfile = tempfile . NamedTemporaryFile ( suffix = \".tif\" ) >>> rst = GDALRaster ( ... { ... \"driver\" : \"GTiff\" , ... \"name\" : rstfile . name , ... \"srid\" : 4326 , ... \"width\" : 255 , ... \"height\" : 255 , ... \"nr_of_bands\" : 1 , ... } ... ) >>> rst . name '/tmp/tmp7x9H4J.tif'           # The exact filename will be different on your computer >>> rst . driver . name 'GTiff' width [source] ¶ The width of the source in pixels (X-axis). >>> GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) . width 10 height [source] ¶ The height of the source in pixels (Y-axis). >>> GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) . height 20 srs [source] ¶ The spatial reference system of the raster, as a SpatialReference instance. The SRS can be changed by\nsetting it to an other SpatialReference or providing any input\nthat is accepted by the SpatialReference constructor. >>> rst = GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) >>> rst . srs . srid 4326 >>> rst . srs = 3086 >>> rst . srs . srid 3086 srid [source] ¶ The Spatial Reference System Identifier (SRID) of the raster. This\nproperty is a shortcut to getting or setting the SRID through the srs attribute. >>> rst = GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) >>> rst . srid 4326 >>> rst . srid = 3086 >>> rst . srid 3086 >>> rst . srs . srid # This is equivalent 3086 geotransform [source] ¶ The affine transformation matrix used to georeference the source, as a\ntuple of six coefficients which map pixel/line coordinates into\ngeoreferenced space using the following relationship: Xgeo = GT ( 0 ) + Xpixel * GT ( 1 ) + Yline * GT ( 2 ) Ygeo = GT ( 3 ) + Xpixel * GT ( 4 ) + Yline * GT ( 5 ) The same values can be retrieved by accessing the origin (indices 0 and 3), scale (indices 1 and 5) and skew (indices 2 and 4) properties. The default is [0.0, 1.0, 0.0, 0.0, 0.0, -1.0] . >>> rst = GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) >>> rst . geotransform [0.0, 1.0, 0.0, 0.0, 0.0, -1.0] origin [source] ¶ Coordinates of the top left origin of the raster in the spatial\nreference system of the source, as a point object with x and y members. >>> rst = GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) >>> rst . origin [0.0, 0.0] >>> rst . origin . x = 1 >>> rst . origin [1.0, 0.0] scale [source] ¶ Pixel width and height used for georeferencing the raster, as a point\nobject with x and y members. See geotransform for more\ninformation. >>> rst = GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) >>> rst . scale [1.0, -1.0] >>> rst . scale . x = 2 >>> rst . scale [2.0, -1.0] skew [source] ¶ Skew coefficients used to georeference the raster, as a point object\nwith x and y members. In case of north up images, these\ncoefficients are both 0 . >>> rst = GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) >>> rst . skew [0.0, 0.0] >>> rst . skew . x = 3 >>> rst . skew [3.0, 0.0] extent [source] ¶ Extent (boundary values) of the raster source, as a 4-tuple (xmin, ymin, xmax, ymax) in the spatial reference system of the\nsource. >>> rst = GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) >>> rst . extent (0.0, -20.0, 10.0, 0.0) >>> rst . origin . x = 100 >>> rst . extent (100.0, -20.0, 110.0, 0.0) bands [source] ¶ List of all bands of the source, as GDALBand instances. >>> rst = GDALRaster ( ... { ... \"width\" : 1 , ... \"height\" : 2 , ... \"srid\" : 4326 , ... \"bands\" : [{ \"data\" : [ 0 , 1 ]}, { \"data\" : [ 2 , 3 ]}], ... } ... ) >>> len ( rst . bands ) 2 >>> rst . bands [ 1 ] . data () array([[ 2.,  3.]], dtype=float32) warp ( ds_input , resampling = 'NearestNeighbour' , max_error = 0.0 ) [source] ¶ Returns a warped version of this raster. The warping parameters can be specified through the ds_input argument. The use of ds_input is analogous to the corresponding\nargument of the class constructor. It is a dictionary with the\ncharacteristics of the target raster. Allowed dictionary key values are\nwidth, height, SRID, origin, scale, skew, datatype, driver, and name\n(filename). By default, the warp functions keeps most parameters equal to the\nvalues of the original source raster, so only parameters that should be\nchanged need to be specified. Note that this includes the driver, so\nfor file-based rasters the warp function will create a new raster on\ndisk. The only parameter that is set differently from the source raster is the\nname. The default value of the raster name is the name of the source\nraster appended with '_copy' + source_driver_name . For file-based\nrasters it is recommended to provide the file path of the target raster. The resampling algorithm used for warping can be specified with the resampling argument. The default is NearestNeighbor , and the\nother allowed values are Bilinear , Cubic , CubicSpline , Lanczos , Average , and Mode . The max_error argument can be used to specify the maximum error\nmeasured in input pixels that is allowed in approximating the\ntransformation. The default is 0.0 for exact calculations. For users familiar with GDAL , this function has a similar\nfunctionality to the gdalwarp command-line utility. For example, the warp function can be used for aggregating a raster to\nthe double of its original pixel scale: >>> rst = GDALRaster ( ... { ... \"width\" : 6 , ... \"height\" : 6 , ... \"srid\" : 3086 , ... \"origin\" : [ 500000 , 400000 ], ... \"scale\" : [ 100 , - 100 ], ... \"bands\" : [{ \"data\" : range ( 36 ), \"nodata_value\" : 99 }], ... } ... ) >>> target = rst . warp ({ \"scale\" : [ 200 , - 200 ], \"width\" : 3 , \"height\" : 3 }) >>> target . bands [ 0 ] . data () array([[  7.,   9.,  11.], [ 19.,  21.,  23.], [ 31.,  33.,  35.]], dtype=float32) transform ( srs , driver = None , name = None , resampling = 'NearestNeighbour' , max_error = 0.0 ) [source] ¶ Transforms this raster to a different spatial reference system\n( srs ), which may be a SpatialReference object, or any\nother input accepted by SpatialReference (including spatial\nreference WKT and PROJ strings, or an integer SRID). It calculates the bounds and scale of the current raster in the new\nspatial reference system and warps the raster using the warp function. By default, the driver of the source raster is used and the name of the\nraster is the original name appended with '_copy' + source_driver_name . A different driver or name can be\nspecified with the driver and name arguments. The default resampling algorithm is NearestNeighbour but can be\nchanged using the resampling argument. The default maximum allowed\nerror for resampling is 0.0 and can be changed using the max_error argument. Consult the warp documentation for detail\non those arguments. >>> rst = GDALRaster ( ... { ... \"width\" : 6 , ... \"height\" : 6 , ... \"srid\" : 3086 , ... \"origin\" : [ 500000 , 400000 ], ... \"scale\" : [ 100 , - 100 ], ... \"bands\" : [{ \"data\" : range ( 36 ), \"nodata_value\" : 99 }], ... } ... ) >>> target_srs = SpatialReference ( 4326 ) >>> target = rst . transform ( target_srs ) >>> target . origin [-82.98492744885776, 27.601924753080144] info [source] ¶ Returns a string with a summary of the raster. This is equivalent to\nthe gdalinfo command line utility. metadata ¶ The metadata of this raster, represented as a nested dictionary. The\nfirst-level key is the metadata domain. The second-level contains the\nmetadata item names and values from each domain. To set or update a metadata item, pass the corresponding metadata item\nto the method using the nested structure described above. Only keys\nthat are in the specified dictionary are updated; the rest of the\nmetadata remains unchanged. To remove a metadata item, use None as the metadata value. >>> rst = GDALRaster ({ \"width\" : 10 , \"height\" : 20 , \"srid\" : 4326 }) >>> rst . metadata {} >>> rst . metadata = { \"DEFAULT\" : { \"OWNER\" : \"Django\" , \"VERSION\" : \"1.0\" }} >>> rst . metadata {'DEFAULT': {'OWNER': 'Django', 'VERSION': '1.0'}} >>> rst . metadata = { \"DEFAULT\" : { \"OWNER\" : None , \"VERSION\" : \"2.0\" }} >>> rst . metadata {'DEFAULT': {'VERSION': '2.0'}} vsi_buffer [source] ¶ A bytes representation of this raster. Returns None for rasters\nthat are not stored in GDAL’s virtual filesystem. is_vsi_based [source] ¶ A boolean indicating if this raster is stored in GDAL’s virtual\nfilesystem. GDALBand ¶ class GDALBand ¶ GDALBand instances are not created explicitly, but rather obtained\nfrom a GDALRaster object, through its bands attribute. The GDALBands contain the actual pixel values of the raster. description ¶ The name or description of the band, if any. width ¶ The width of the band in pixels (X-axis). height ¶ The height of the band in pixels (Y-axis). pixel_count ¶ The total number of pixels in this band. Is equal to width * height . statistics ( refresh = False , approximate = False ) ¶ Compute statistics on the pixel values of this band. The return value\nis a tuple with the following structure: (minimum, maximum, mean, standard deviation) . If the approximate argument is set to True , the statistics may\nbe computed based on overviews or a subset of image tiles. If the refresh argument is set to True , the statistics will be\ncomputed from the data directly, and the cache will be updated with the\nresult. If a persistent cache value is found, that value is returned. For\nraster formats using Persistent Auxiliary Metadata (PAM) services, the\nstatistics might be cached in an auxiliary file. In some cases this\nmetadata might be out of sync with the pixel values or cause values\nfrom a previous call to be returned which don’t reflect the value of\nthe approximate argument. In such cases, use the refresh argument to get updated values and store them in the cache. For empty bands (where all pixel values are “no data”), all statistics\nare returned as None . The statistics can also be retrieved directly by accessing the min , max , mean , and std properties. min ¶ The minimum pixel value of the band (excluding the “no data” value). max ¶ The maximum pixel value of the band (excluding the “no data” value). mean ¶ The mean of all pixel values of the band (excluding the “no data”\nvalue). std ¶ The standard deviation of all pixel values of the band (excluding the\n“no data” value). nodata_value ¶ The “no data” value for a band is generally a special marker value used\nto mark pixels that are not valid data. Such pixels should generally not\nbe displayed, nor contribute to analysis operations. To delete an existing “no data” value, set this property to None . datatype ( as_string = False ) ¶ The data type contained in the band, as an integer constant between 0\n(Unknown) and 14. If as_string is True , the data type is\nreturned as a string. Check out the “GDAL Pixel Type” column in the datatype value table for possible values. color_interp ( as_string = False ) ¶ The color interpretation for the band, as an integer between 0and 16.\nIf as_string is True , the data type is returned as a string\nwith the following possible values: GCI_Undefined , GCI_GrayIndex , GCI_PaletteIndex , GCI_RedBand , GCI_GreenBand , GCI_BlueBand , GCI_AlphaBand , GCI_HueBand , GCI_SaturationBand , GCI_LightnessBand , GCI_CyanBand , GCI_MagentaBand , GCI_YellowBand , GCI_BlackBand , GCI_YCbCr_YBand , GCI_YCbCr_CbBand , and GCI_YCbCr_CrBand . GCI_YCbCr_CrBand also represents GCI_Max because both correspond to the integer 16, but only GCI_YCbCr_CrBand is returned as a string. data ( data = None , offset = None , size = None , shape = None ) ¶ The accessor to the pixel values of the GDALBand . Returns the complete\ndata array if no parameters are provided. A subset of the pixel array can\nbe requested by specifying an offset and block size as tuples. If NumPy is available, the data is returned as NumPy array. For performance\nreasons, it is highly recommended to use NumPy. Data is written to the GDALBand if the data parameter is provided.\nThe input can be of one of the following types - packed string, buffer, list,\narray, and NumPy array. The number of items in the input should normally\ncorrespond to the total number of pixels in the band, or to the number\nof pixels for a specific block of pixel values if the offset and size parameters are provided. If the number of items in the input is different from the target pixel\nblock, the shape parameter must be specified. The shape is a tuple\nthat specifies the width and height of the input data in pixels. The\ndata is then replicated to update the pixel values of the selected\nblock. This is useful to fill an entire band with a single value, for\ninstance. For example: >>> rst = GDALRaster ( ... { \"width\" : 4 , \"height\" : 4 , \"srid\" : 4326 , \"datatype\" : 1 , \"nr_of_bands\" : 1 } ... ) >>> bnd = rst . bands [ 0 ] >>> bnd . data ( range ( 16 )) >>> bnd . data () array([[ 0,  1,  2,  3], [ 4,  5,  6,  7], [ 8,  9, 10, 11], [12, 13, 14, 15]], dtype=int8) >>> bnd . data ( offset = ( 1 , 1 ), size = ( 2 , 2 )) array([[ 5,  6], [ 9, 10]], dtype=int8) >>> bnd . data ( data = [ - 1 , - 2 , - 3 , - 4 ], offset = ( 1 , 1 ), size = ( 2 , 2 )) >>> bnd . data () array([[ 0,  1,  2,  3], [ 4, -1, -2,  7], [ 8, -3, -4, 11], [12, 13, 14, 15]], dtype=int8) >>> bnd . data ( data = \" \\x9d\\xa8\\xb3\\xbe \" , offset = ( 1 , 1 ), size = ( 2 , 2 )) >>> bnd . data () array([[  0,   1,   2,   3], [  4, -99, -88,   7], [  8, -77, -66,  11], [ 12,  13,  14,  15]], dtype=int8) >>> bnd . data ([ 1 ], shape = ( 1 , 1 )) >>> bnd . data () array([[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]], dtype=uint8) >>> bnd . data ( range ( 4 ), shape = ( 1 , 4 )) array([[0, 0, 0, 0], [1, 1, 1, 1], [2, 2, 2, 2], [3, 3, 3, 3]], dtype=uint8) metadata ¶ The metadata of this band. The functionality is identical to GDALRaster.metadata . Creating rasters from data ¶ This section describes how to create rasters from scratch using the ds_input parameter. A new raster is created when a dict is passed to the GDALRaster constructor. The dictionary contains defining parameters of the new raster,\nsuch as the origin, size, or spatial reference system. The dictionary can also\ncontain pixel data and information about the format of the new raster. The\nresulting raster can therefore be file-based or memory-based, depending on the\ndriver specified. There’s no standard for describing raster data in a dictionary or JSON flavor.\nThe definition of the dictionary input to the GDALRaster class is\ntherefore specific to Django. It’s inspired by the geojson format, but the geojson standard is currently limited to vector formats. Examples of using the different keys when creating rasters can be found in the\ndocumentation of the corresponding attributes and methods of the GDALRaster and GDALBand classes. The ds_input dictionary ¶ Only a few keys are required in the ds_input dictionary to create a raster: width , height , and srid . All other parameters have default values\n(see the table below). The list of keys that can be passed in the ds_input dictionary is closely related but not identical to the GDALRaster properties. Many of the parameters are mapped directly to those properties;\nthe others are described below. The following table describes all keys that can be set in the ds_input dictionary. Key Default Usage srid required Mapped to the srid attribute width required Mapped to the width attribute height required Mapped to the height attribute driver MEM Mapped to the driver attribute name '' See below origin 0 Mapped to the origin attribute scale 0 Mapped to the scale attribute skew 0 Mapped to the width attribute bands [] See below nr_of_bands 0 See below datatype 6 See below papsz_options {} See below name String representing the name of the raster. When creating a file-based\nraster, this parameter must be the file path for the new raster. If the\nname starts with /vsimem/ , the raster is created in GDAL’s virtual\nfilesystem. datatype Integer representing the data type for all the bands. Defaults to 6 (Float32). All bands of a new raster are required to have the same datatype.\nThe value mapping is: Value GDAL Pixel Type Description 1 GDT_Byte 8 bit unsigned integer 2 GDT_UInt16 16 bit unsigned integer 3 GDT_Int16 16 bit signed integer 4 GDT_UInt32 32 bit unsigned integer 5 GDT_Int32 32 bit signed integer 6 GDT_Float32 32 bit floating point 7 GDT_Float64 64 bit floating point 12 GDT_UInt64 64 bit unsigned integer (GDAL 3.5+) 13 GDT_Int64 64 bit signed integer (GDAL 3.5+) 14 GDT_Int8 8 bit signed integer (GDAL 3.7+) nr_of_bands Integer representing the number of bands of the raster. A raster can be\ncreated without passing band data upon creation. If the number of bands\nisn’t specified, it’s automatically calculated from the length of the bands input. The number of bands can’t be changed after creation. bands A list of band_input dictionaries with band input data. The resulting\nband indices are the same as in the list provided. The definition of the\nband input dictionary is given below. If band data isn’t provided, the\nraster bands values are instantiated as an array of zeros and the “no\ndata” value is set to None . papsz_options A dictionary with raster creation options. The key-value pairs of the\ninput dictionary are passed to the driver on creation of the raster. The available options are driver-specific and are described in the\ndocumentation of each driver. The values in the dictionary are not case-sensitive and are automatically\nconverted to the correct string format upon creation. The following example uses some of the options available for the GTiff driver . The result is a compressed raster with an internal tiling\nscheme. The internal tiles have a block size of 23 by 23: >>> GDALRaster ( ... { ... \"driver\" : \"GTiff\" , ... \"name\" : \"/path/to/new/file.tif\" , ... \"srid\" : 4326 , ... \"width\" : 255 , ... \"height\" : 255 , ... \"nr_of_bands\" : 1 , ... \"papsz_options\" : { ... \"compress\" : \"packbits\" , ... \"tiled\" : \"yes\" , ... \"blockxsize\" : 23 , ... \"blockysize\" : 23 , ... }, ... } ... ) The band_input dictionary ¶ The bands key in the ds_input dictionary is a list of band_input dictionaries. Each band_input dictionary can contain pixel values and the\n“no data” value to be set on the bands of the new raster. The data array can\nhave the full size of the new raster or be smaller. For arrays that are smaller\nthan the full raster, the size , shape , and offset keys  control the\npixel values. The corresponding keys are passed to the data() method. Their functionality is the same as setting the band data with that\nmethod. The following table describes the keys that can be used. Key Default Usage nodata_value None Mapped to the nodata_value attribute data Same as nodata_value or 0 Passed to the data() method size (with, height) of raster Passed to the data() method shape Same as size Passed to the data() method offset (0, 0) Passed to the data() method Using GDAL’s Virtual Filesystem ¶ GDAL can access files stored in the filesystem, but also supports virtual\nfilesystems to abstract accessing other kind of files, such as compressed,\nencrypted, or remote files. Using memory-based Virtual Filesystem ¶ GDAL has an internal memory-based filesystem, which allows treating blocks of\nmemory as files. It can be used to read and write GDALRaster objects\nto and from binary file buffers. This is useful in web contexts where rasters might be obtained as a buffer\nfrom a remote storage or returned from a view without being written to disk. GDALRaster objects are created in the virtual filesystem when a bytes object is provided as input, or when the file path starts with /vsimem/ . Input provided as bytes has to be a full binary representation of a file.\nFor instance: # Read a raster as a file object from a remote source. >>> from urllib.request import urlopen >>> dat = urlopen ( \"https://example.com/raster.tif\" ) . read () # Instantiate a raster from the bytes object. >>> rst = GDALRaster ( dat ) # The name starts with /vsimem/, indicating that the raster lives in the # virtual filesystem. >>> rst . name '/vsimem/da300bdb-129d-49a8-b336-e410a9428dad' To create a new virtual file-based raster from scratch, use the ds_input dictionary representation and provide a name argument that starts with /vsimem/ (for detail of the dictionary representation, see Creating rasters from data ). For virtual file-based rasters, the vsi_buffer attribute returns the bytes representation\nof the raster. Here’s how to create a raster and return it as a file in an HttpResponse : >>> from django.http import HttpResponse >>> rst = GDALRaster ( ... { ... \"name\" : \"/vsimem/temporarymemfile\" , ... \"driver\" : \"tif\" , ... \"width\" : 6 , ... \"height\" : 6 , ... \"srid\" : 3086 , ... \"origin\" : [ 500000 , 400000 ], ... \"scale\" : [ 100 , - 100 ], ... \"bands\" : [{ \"data\" : range ( 36 ), \"nodata_value\" : 99 }], ... } ... ) >>> HttpResponse ( rast . vsi_buffer , \"image/tiff\" ) Using other Virtual Filesystems ¶ Depending on the local build of GDAL other virtual filesystems may be\nsupported. You can use them by prepending the provided path with the\nappropriate /vsi*/ prefix. See the GDAL Virtual Filesystems\ndocumentation for more details. Compressed rasters ¶ Instead decompressing the file and instantiating the resulting raster, GDAL can\ndirectly access compressed files using the /vsizip/ , /vsigzip/ , or /vsitar/ virtual filesystems: >>> from django.contrib.gis.gdal import GDALRaster >>> rst = GDALRaster ( \"/vsizip/path/to/your/file.zip/path/to/raster.tif\" ) >>> rst = GDALRaster ( \"/vsigzip/path/to/your/file.gz\" ) >>> rst = GDALRaster ( \"/vsitar/path/to/your/file.tar/path/to/raster.tif\" ) Network rasters ¶ GDAL can support online resources and storage providers transparently. As long\nas it’s built with such capabilities. To access a public raster file with no authentication, you can use /vsicurl/ : >>> from django.contrib.gis.gdal import GDALRaster >>> rst = GDALRaster ( \"/vsicurl/https://example.com/raster.tif\" ) >>> rst . name '/vsicurl/https://example.com/raster.tif' For commercial storage providers (e.g. /vsis3/ ) the system should be\npreviously configured for authentication and possibly other settings (see the GDAL Virtual Filesystems documentation for available options). Settings ¶ GDAL_LIBRARY_PATH ¶ A string specifying the location of the GDAL library.  Typically,\nthis setting is only used if the GDAL library is in a non-standard\nlocation (e.g., /home/john/lib/libgdal.so ). Exceptions ¶ exception GDALException [source] ¶ The base GDAL exception, indicating a GDAL-related error. exception SRSException [source] ¶ An exception raised when an error occurs when constructing or using a\nspatial reference system object.", "keywords": ["users", "box", "mem", "axis", "feature", "gml", "population", "storage", "zeros", "point(1", "library", "nad83", "analysis", "field", "#", "dimensions", "m", "raster", "linear_units", "spatialreference", "ewkt", "metadata", "get_geoms", "datatype", "+", "layer.num_fields", "loop", "srs", "representation", "range", "lines", "httpresponse", "subset", "geogcs[\"wgs", "cache", "datasource", "field_types", "coordinate", "bounds", "https://raw.githubusercontent.com/django/django/main/tests/gis_tests/data/cities/cities", "geom_type", "as_int", "indicating", "=", "xmin", "cities", "ring", "min", "relationship", "array([[5", "symbol", "gci_yellowband", "shell", "epsg", "filesystem", "geogcs", "wrappers", "sets", "height", "proj", "crosses", "authority[\"epsg\",\"7030", "geom_input", "gci_cyanband", "rgb", "collection", "gdal_library_path", "john", "0101000000000000000000f03f0000000000000040", "following", "type", "scale", "wgs72", "objects", "documentation", "file", "da300bdb-129d-49a8", "gdalraster", "gci_blueband", "packbits", "as_string", "pixel_count", "knife", "geotransform", "color_interp", "c_long(23", "vsimem", "numpy", "deletefeature", "cases", "band_input", "layers", "polygonfield", "attribute", "semiminor", "args", "maximum", "size", "setter", "kml", "time", "capability", "scratch", "date", "file.tif", "setting", "components", "simplicity", "shp", "ogrgeomtype", "providers", "rings", "transform", "name", "bnd", "parameter", "characteristics", "reference", "gci_magentaband", "web", "blockysize", "centroid", "gdalinfo", "gci_redband", "filesystems", "disjoint", "pt", "createfield", "srsexception", "affine", "z", "behaves", "return", "gci_alphaband", "transforming", "primem[\"greenwich\",0", "memory", "gt2", "coord_trans", "widths", "srid", "lib", "get_fields", "examples", "rectangle", "as_double", "int8", "https://example.com/raster.tif", "wrapper", "space", "gci_ycbcr_yband", "gci_grayindex", "error", "geometry", "module", "0and", "classmethod", "code", "tiling", "algorithm", "gdalband", "gdt_uint16", "iterates", "/vsimem/", "filter", "false", "spheroid[\"wgs", "reading", "access", "class", "c", "array", "info", "c_long(0", "/vsicurl/", "field_widths", "returns", "names", "'", "rast", "x", "fastsetnextbyindex", "-1.0", "wkb", "temporarymemfile", "block", "output", "input", "rst_file", "gci_greenband", "is_vsi_based", "types", "nr_of_bands", "strings", "elements", "subclass", "accessor", "creation", "point><gml", "/vsizip/", "/vsigzip/", "usage", "xml", "standards", "precisions", "instantiation", "/vsitar", "section", "authority", "gdt_int64", "linearring", "suffix", "source", "warp", "use", "gci_lightnessband", "sources", "point_count", "test_capability", "origin", "ds", "gdt_float32", "ds[0", "bbox", "shorthand", "subclasses", "pam", "performance", "import_user_input", "statistics", "gci_hueband", "polygon((0", "region", "order", "/vsimem", "default", "layer_name", "shape", "array([[1", "coefficients", "type_name", "ur", "unit[\"degree\",0.01745329251994328", "ellipsoid", "alias", "form", "https://raw.githubusercontent.com/django/django/main/tests/gis_tests/data/rasters/raster.tif", "sym_difference", "prefix", "properties", "format", "nearestneighbor", "classes", "tests", "coord_dim", "esri", "computer", "average", "tempfile", "myraster", "area", "persistent", "nearestneighbour", "scheme", "len", "-95.23506", "triangle", "max_error", "target_srs", "ellps", "formats", "utf-8", "gdal", "intersects", "checks", "namedtemporaryfile", "xpixel", "gci_max", "dimension", "index", "validate", "dr_input", "integer", "identify_epsg", "¶", "bytes", "command", "parameters", "rst_bytes", "disk", "services", "/vsi*/", "geogcs[\"gcs_wgs_1984", "precision", "projcs", "property", "density", "num_fields", "indices", "deviation", "wget", "polygon", "gdalbands", "function", "testing", "result", "view", "float", "color", "layer.geom_type", "xmax", "max_y", "simple", "local_cs", "cubicspline", "extent", "number", "right", "buffers", "gdalraster.metadata", "point", "getitem", "gdt_int32", "values", "gci_paletteindex", "army", "warping", "string", "_", "geom_count", "import_wkt", "pixel", "unit|authority", "city", "overview", "geojson", "mapping", "linear_name", "urlopen", "databases", "zm", "wgs", "from_esri", "hand", "table", "gci_saturationband", "location", "drivers", "coords", "copy", "blocks", "version", "ways", "level", "json", "ymax", "authority[\"epsg\",\"8901", "routine", "wgs84", "gis", "bounding", "width", "counterpart", "image", "owner", "django", "n’t", "filename", "gt", "randomread", "fields", "print", "summary", "mean", "set", "geometrycollection", "p", "gt1", "value", "compress", "sync", "wkt", "line", "nodes", "bit", "dat", "data", "wgs_1984", "gcs_wgs_1984", "resources", "item", "container", "w", "envelope", "base", "node", "layer", "identifier", "authority[\"epsg\",\"9122", "shortcut", "towgs84", "need", "instance", "from_bbox", "members", "buffer", "pueblo", "-88", "geometries", "see", "interface", "constant", "respect", "functionality", "gci_ycbcr_crband", "arrays", "compute", "ogc", "ct", "transformation", "layer.fields", "constructor", "spatial", "instances", "structure", "virtual", "num_points", "fid", "geospatial", "part", "rst", "object", "e410a9428dad", "nodata_value", "domain", "north", "84\",6378137,298.257223563", "epsg:4326", "gdt_int16", "geotiff", "interpretation", "dictionary", "utility", "points", "overviews", "red", "pairs", "keyword", "s", "naming", "child", "auxiliary", "max", "others", "variables", "root", "rest", "turn", "intersection", "datum[\"wgs_1984", "detail", "ogrgeometry", "system", "uint8", "vsi_buffer", "tiff", "ogr", "min_y", "items", "authority[\"epsg\",\"6326", "fastgetextent", "datum", "definition", "expand_to_include", "mapped", "target", "difference", "features", "kansas", "forms", "rstfile", "example", "houston", "geosgeometry", "column", "list", "sample", "ymin", "from_gml", "skew", "bilinear", "gtiff", "user_input", "bands", "starting", "inverse", "vector", "reasons", "place", "systems", "dbf", "encoding", "close_rings", "dictionaries", "boundary", "attributes", "spheroid[\"wgs_1984\",6378137,298.257223563", "hex", "0,0", "pipe", "-104.609252", "gt3", "y", "authority[\"epsg\",\"4326", "oftdate", "variety", "geos", "capabilities", "coordinates", "keys", "coordinates></gml", "case", "attr_value", "boolean", "length", "authentication", "b336", "tiles", "gci_ycbcr_cbband", "min_x", "gdt_float64", "network", "lawrence", "tuple", "coordtransform", "morphs", "arguments", "array([[0", "shx", "feat", "driver", "papsz_options", "end", "set_3d", "num_feat", "is_3d", "tuples", "nad27", "standard", "sequentialwrite", "kind", "ft", "path", "srs_input", "functions", "no_defs", "pixels", "abstraction", "key", "field_precisions", "operations", "build", "none", "flattening", "c_long(1999", "geom", "feature.geom", "new", "gdalexception", "true", "wkb_size", "dict", "rasters", "api", "geometryfield", "equivalence", "ds_input", "support", "description", "djangounicodedecodeerror", "ks_extent", "mode", "xgeo", "linestring", "transactions", "source_driver_name", "-", "units", "driver_count", "offset", "import", "files", "ygeo", "calculations", "%", ">", "union", "call", "defaults", "polygons", "longlat", "information", "images", "python", "linestring(0", "methods", "randomwrite", "yline", "-20.0", "options", "exception", "layer_count", "details", "geodjango", "method", "matrix", "num", "settings", "argument", "clone", "state", "tmp7x9h4j.tif", "lanczos", "known", "flavor", "marker", "tools", "spatialreference.proj", "as_datetime", "band", "/path", "text", "gdt_uint64", "exceptions"], "type": "documentation"},
{"title": "Measurement Objects | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/measure/", "content": "Measurement Objects ¶ The django.contrib.gis.measure module contains objects that allow\nfor convenient representation of distance and area units of measure. [ 1 ] Specifically, it implements two objects, Distance and Area – both of which may be accessed via the D and A convenience aliases, respectively. Example ¶ Distance objects may be instantiated using a keyword argument indicating the\ncontext of the units.  In the example below, two different distance objects are\ninstantiated in units of kilometers ( km ) and miles ( mi ): >>> from django.contrib.gis.measure import D , Distance >>> d1 = Distance ( km = 5 ) >>> print ( d1 ) 5.0 km >>> d2 = D ( mi = 5 ) # `D` is an alias for `Distance` >>> print ( d2 ) 5.0 mi For conversions, access the preferred unit attribute to get a converted\ndistance quantity: >>> print ( d1 . mi ) # Converting 5 kilometers to miles 3.10685596119 >>> print ( d2 . km ) # Converting 5 miles to kilometers 8.04672 Moreover, arithmetic operations may be performed between the distance\nobjects: >>> print ( d1 + d2 ) # Adding 5 miles to 5 kilometers 13.04672 km >>> print ( d2 - d1 ) # Subtracting 5 kilometers from 5 miles 1.89314403881 mi Two Distance objects multiplied together will yield an Area object, which uses squared units of measure: >>> a = d1 * d2 # Returns an Area object. >>> print ( a ) 40.2336 sq_km To determine what the attribute abbreviation of a unit is, the unit_attname class method may be used: >>> print ( Distance . unit_attname ( \"US Survey Foot\" )) survey_ft >>> print ( Distance . unit_attname ( \"centimeter\" )) cm Supported units ¶ Unit Attribute Full name or alias(es) km Kilometre, Kilometer mi Mile m Meter, Metre yd Yard ft Foot, Foot (International) survey_ft U.S. Foot, US survey foot inch Inches cm Centimeter mm Millimetre, Millimeter um Micrometer, Micrometre british_ft British foot (Sears 1922) british_yd British yard (Sears 1922) british_chain_sears British chain (Sears 1922) indian_yd Indian yard, Yard (Indian) sears_yd Yard (Sears) clarke_ft Clarke’s Foot chain Chain chain_benoit Chain (Benoit) chain_sears Chain (Sears) british_chain_benoit British chain (Benoit 1895 B) british_chain_sears_truncated British chain (Sears 1922 truncated) gold_coast_ft Gold Coast foot link Link link_benoit Link (Benoit) link_sears Link (Sears) clarke_link Clarke’s link fathom Fathom rod Rod furlong Furlong, Furrow Long nm Nautical Mile nm_uk Nautical Mile (UK) german_m German legal metre Note Area attributes are the same as Distance attributes,\nexcept they are prefixed with sq_ (area units are square in nature).\nFor example, Area(sq_m=2) creates an Area object\nrepresenting two square meters. In addition to unit with the sq_ prefix, the following units are also\nsupported on Area : Unit Attribute Full name or alias(es) ha Hectare Changed in Django 5.1: Support for the ha unit was added. Measurement API ¶ Distance ¶ class Distance ( ** kwargs ) [source] ¶ To initialize a distance object, pass in a keyword corresponding to the\ndesired unit attribute name set with desired\nvalue. For example, the following creates a distance object representing 5\nmiles: >>> dist = Distance ( mi = 5 ) __getattr__ ( unit_att ) ¶ Returns the distance value in units corresponding to the given unit\nattribute. For example: >>> print ( dist . km ) 8.04672 classmethod unit_attname ( unit_name ) ¶ Returns the distance unit attribute name for the given full unit name. For\nexample: >>> Distance . unit_attname ( \"Mile\" ) 'mi' class D ¶ Alias for Distance class. Area ¶ class Area ( ** kwargs ) [source] ¶ To initialize an area object, pass in a keyword corresponding to the\ndesired unit attribute name set with desired\nvalue. For example, the following creates an area object representing 5\nsquare miles: >>> a = Area ( sq_mi = 5 ) __getattr__ ( unit_att ) ¶ Returns the area value in units corresponding to the given unit attribute.\nFor example: >>> print ( a . sq_km ) 12.949940551680001 classmethod unit_attname ( unit_name ) ¶ Returns the area unit attribute name for the given full unit name. For\nexample: >>> Area . unit_attname ( \"Kilometer\" ) 'sq_km' class A ¶ Alias for Area class. Footnotes [ 1 ] Robert Coup is the initial author of the measure objects,\nand was inspired by Brian Beck’s work in geopy and Geoff Biggs’ PhD work on dimensioned units for robotics.", "keywords": ["centimeter", "kilometers", "mi", "survey", "django.contrib.gis.measure", "aliases", "brian", "measure", "nature", "module", "b", "sq", "abbreviation", "classmethod", "sears", "clarke_ft", "robert", "link", "class", "example", "_", "#", "addition", "hectare", "miles", "m", "returns", "survey_ft", "uk", "unit", "metre", "millimetre", "representation", "indian_yd", "*", "unit_name", "chain_sears", "fathom", "geopy", "robotics", "millimeter", "attributes", "u.s.", "django", "=", "sq_mi", "print", "conversions", "beck", "nautical", "clarke", "value", "british_yd", "source", "km", "unit_att", "d2", "inches", "sears_yd", "clarke_link", "mile", "following", "coup", "a", "author", "kwargs", "objects", "inch", "dist", "sq_km", "work", "d1", "micrometer", "yard", "measurement", "ft", "alias", "operations", "gold", "attribute", "prefix", "):", "mm", "cm", "unit_attname", "meters", "kilometer", "kilometre", "nm_uk", "area", "api", "convenience", "support", "biggs", "object", "chain", "units", "context", "us", "quantity", "rod", "ha", "import", "name", "d", "micrometre", "link_sears", "furlong", "benoit", "geoff", "alias(es", "keyword", "furrow", "coast", "phd", "footnotes", "link_benoit", "foot", "method", "international", "argument", "¶", "indian", "meter", "british_chain_benoit", "long", "note", "area(sq_m=2", "distance", "yd"], "type": "documentation"},
{"title": "Model instance reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/instances/", "content": "Model instance reference ¶ This document describes the details of the Model API. It builds on the\nmaterial presented in the model and database\nquery guides, so you’ll probably want to read and\nunderstand those documents before reading this one. Throughout this reference we’ll use the example blog models presented in the database query guide . Creating objects ¶ To create a new instance of a model, instantiate it like any other Python\nclass: class Model ( ** kwargs ) [source] ¶ The keyword arguments are the names of the fields you’ve defined on your model.\nNote that instantiating a model in no way touches your database; for that, you\nneed to save() . Note You may be tempted to customize the model by overriding the __init__ method. If you do so, however, take care not to change the calling\nsignature as any change may prevent the model instance from being saved.\nAdditionally, referring to model fields within __init__ may potentially\nresult in infinite recursion errors in some circumstances.  Rather than\noverriding __init__ , try using one of these approaches: Add a classmethod on the model class: from django.db import models class Book ( models . Model ): title = models . CharField ( max_length = 100 ) @classmethod def create ( cls , title ): book = cls ( title = title ) # do something with the book return book book = Book . create ( \"Pride and Prejudice\" ) Add a method on a custom manager (usually preferred): class BookManager ( models . Manager ): def create_book ( self , title ): book = self . create ( title = title ) # do something with the book return book class Book ( models . Model ): title = models . CharField ( max_length = 100 ) objects = BookManager () book = Book . objects . create_book ( \"Pride and Prejudice\" ) Customizing model loading ¶ classmethod Model. from_db ( db , field_names , values ) [source] ¶ The from_db() method can be used to customize model instance creation\nwhen loading from the database. The db argument contains the database alias for the database the model\nis loaded from, field_names contains the names of all loaded fields, and values contains the loaded values for each field in field_names . The field_names are in the same order as the values . If all of the model’s\nfields are present, then values are guaranteed to be in the order __init__() expects them. That is, the instance can be created by cls(*values) . If any fields are deferred, they won’t appear in field_names . In that case, assign a value of django.db.models.DEFERRED to each of the missing fields. In addition to creating the new model, the from_db() method must set the adding and db flags in the new instance’s _state attribute. Below is an example showing how to record the initial values of fields that\nare loaded from the database: from django.db.models import DEFERRED @classmethod def from_db ( cls , db , field_names , values ): # Default implementation of from_db() (subject to change and could # be replaced with super()). if len ( values ) != len ( cls . _meta . concrete_fields ): values = list ( values ) values . reverse () values = [ values . pop () if f . attname in field_names else DEFERRED for f in cls . _meta . concrete_fields ] instance = cls ( * values ) instance . _state . adding = False instance . _state . db = db # customization to store the original field values on the instance instance . _loaded_values = dict ( zip ( field_names , ( value for value in values if value is not DEFERRED )) ) return instance def save ( self , ** kwargs ): # Check how the current values differ from ._loaded_values. For example, # prevent changing the creator_id of the model. (This example doesn't # support cases where 'creator_id' is deferred). if not self . _state . adding and ( self . creator_id != self . _loaded_values [ \"creator_id\" ] ): raise ValueError ( \"Updating the value of creator isn't allowed\" ) super () . save ( ** kwargs ) The example above shows a full from_db() implementation to clarify how that\nis done. In this case it would be possible to use a super() call in the from_db() method. Refreshing objects from database ¶ If you delete a field from a model instance, accessing it again reloads the\nvalue from the database: >>> obj = MyModel . objects . first () >>> del obj . field >>> obj . field # Loads the field from the database Model. refresh_from_db ( using = None , fields = None , from_queryset = None ) [source] ¶ Model. arefresh_from_db ( using = None , fields = None , from_queryset = None ) ¶ Asynchronous version : arefresh_from_db() If you need to reload a model’s values from the database, you can use the refresh_from_db() method. When this method is called without arguments the\nfollowing is done: All non-deferred fields of the model are updated to the values currently\npresent in the database. Any cached relations are cleared from the reloaded instance. Only fields of the model are reloaded from the database. Other\ndatabase-dependent values such as annotations aren’t reloaded. Any @cached_property attributes\naren’t cleared either. The reloading happens from the database the instance was loaded from, or from\nthe default database if the instance wasn’t loaded from the database. The using argument can be used to force the database used for reloading. It is possible to force the set of fields to be loaded by using the fields argument. For example, to test that an update() call resulted in the expected\nupdate, you could write a test similar to this: def test_update_result ( self ): obj = MyModel . objects . create ( val = 1 ) MyModel . objects . filter ( pk = obj . pk ) . update ( val = F ( \"val\" ) + 1 ) # At this point obj.val is still 1, but the value in the database # was updated to 2. The object's updated value needs to be reloaded # from the database. obj . refresh_from_db () self . assertEqual ( obj . val , 2 ) Note that when deferred fields are accessed, the loading of the deferred\nfield’s value happens through this method. Thus it is possible to customize\nthe way deferred loading happens. The example below shows how one can reload\nall of the instance’s fields when a deferred field is reloaded: class ExampleModel ( models . Model ): def refresh_from_db ( self , using = None , fields = None , ** kwargs ): # fields contains the name of the deferred field to be # loaded. if fields is not None : fields = set ( fields ) deferred_fields = self . get_deferred_fields () # If any deferred field is going to be loaded if fields . intersection ( deferred_fields ): # then load all of them fields = fields . union ( deferred_fields ) super () . refresh_from_db ( using , fields , ** kwargs ) The from_queryset argument allows using a different queryset than the one\ncreated from _base_manager . It gives you more\ncontrol over how the model is reloaded. For example, when your model uses soft\ndeletion you can make refresh_from_db() to take this into account: obj . refresh_from_db ( from_queryset = MyModel . active_objects . all ()) You can cache related objects that otherwise would be cleared from the reloaded\ninstance: obj . refresh_from_db ( from_queryset = MyModel . objects . select_related ( \"related_field\" )) You can lock the row until the end of transaction before reloading a model’s\nvalues: obj . refresh_from_db ( from_queryset = MyModel . objects . select_for_update ()) Changed in Django 5.1: The from_queryset argument was added. Model. get_deferred_fields () [source] ¶ A helper method that returns a set containing the attribute names of all those\nfields that are currently deferred for this model. Validating objects ¶ There are four steps involved in validating a model: Validate the model fields - Model.clean_fields() Validate the model as a whole - Model.clean() Validate the field uniqueness - Model.validate_unique() Validate the constraints - Model.validate_constraints() All four steps are performed when you call a model’s full_clean() method. When you use a ModelForm , the call to is_valid() will perform these validation steps for\nall the fields that are included on the form. See the ModelForm\ndocumentation for more information. You should only\nneed to call a model’s full_clean() method if you plan to handle\nvalidation errors yourself, or if you have excluded fields from the ModelForm that require validation. Model. full_clean ( exclude = None , validate_unique = True , validate_constraints = True ) [source] ¶ This method calls Model.clean_fields() , Model.clean() , Model.validate_unique() (if validate_unique is True ),  and Model.validate_constraints() (if validate_constraints is True )\nin that order and raises a ValidationError that\nhas a message_dict attribute containing errors from all four stages. The optional exclude argument can be used to provide a set of field\nnames that can be excluded from validation and cleaning. ModelForm uses this argument to exclude fields that\naren’t present on your form from being validated since any errors raised could\nnot be corrected by the user. Note that full_clean() will not be called automatically when you call\nyour model’s save() method. You’ll need to call it manually\nwhen you want to run one-step model validation for your own manually created\nmodels. For example: from django.core.exceptions import ValidationError try : article . full_clean () except ValidationError as e : # Do something based on the errors contained in e.message_dict. # Display them to a user, or handle them programmatically. pass The first step full_clean() performs is to clean each individual field. Model. clean_fields ( exclude = None ) [source] ¶ This method will validate all fields on your model. The optional exclude argument lets you provide a set of field names to exclude from validation.\nIt will raise a ValidationError if any fields\nfail validation. The second step full_clean() performs is to call Model.clean() .\nThis method should be overridden to perform custom validation on your model. Model. clean () [source] ¶ This method should be used to provide custom model validation, and to modify\nattributes on your model if desired. For instance, you could use it to\nautomatically provide a value for a field, or to do validation that requires\naccess to more than a single field: import datetime from django.core.exceptions import ValidationError from django.db import models from django.utils.translation import gettext_lazy as _ class Article ( models . Model ): ... def clean ( self ): # Don't allow draft entries to have a pub_date. if self . status == \"draft\" and self . pub_date is not None : raise ValidationError ( _ ( \"Draft entries may not have a publication date.\" )) # Set the pub_date for published items if it hasn't been set already. if self . status == \"published\" and self . pub_date is None : self . pub_date = datetime . date . today () Note, however, that like Model.full_clean() , a model’s clean() method is not invoked when you call your model’s save() method. In the above example, the ValidationError exception raised by Model.clean() was instantiated with a string, so it\nwill be stored in a special error dictionary key, NON_FIELD_ERRORS . This key is used for errors\nthat are tied to the entire model instead of to a specific field: from django.core.exceptions import NON_FIELD_ERRORS , ValidationError try : article . full_clean () except ValidationError as e : non_field_errors = e . message_dict [ NON_FIELD_ERRORS ] To assign exceptions to a specific field, instantiate the ValidationError with a dictionary, where the\nkeys are the field names. We could update the previous example to assign the\nerror to the pub_date field: class Article ( models . Model ): ... def clean ( self ): # Don't allow draft entries to have a pub_date. if self . status == \"draft\" and self . pub_date is not None : raise ValidationError ( { \"pub_date\" : _ ( \"Draft entries may not have a publication date.\" )} ) ... If you detect errors in multiple fields during Model.clean() , you can also\npass a dictionary mapping field names to errors: raise ValidationError ( { \"title\" : ValidationError ( _ ( \"Missing title.\" ), code = \"required\" ), \"pub_date\" : ValidationError ( _ ( \"Invalid date.\" ), code = \"invalid\" ), } ) Then, full_clean() will check unique constraints on your model. How to raise field-specific validation errors if those fields don’t appear in a ModelForm You can’t raise validation errors in Model.clean() for fields that\ndon’t appear in a model form (a form may limit its fields using Meta.fields or Meta.exclude ). Doing so will raise a ValueError because the validation error won’t be able to be associated with the\nexcluded field. To work around this dilemma, instead override Model.clean_fields() as it receives the list of fields\nthat are excluded from validation. For example: class Article ( models . Model ): ... def clean_fields ( self , exclude = None ): super () . clean_fields ( exclude = exclude ) if self . status == \"draft\" and self . pub_date is not None : if exclude and \"status\" in exclude : raise ValidationError ( _ ( \"Draft entries may not have a publication date.\" ) ) else : raise ValidationError ( { \"status\" : _ ( \"Set status to draft if there is not a publication date.\" ), } ) Model. validate_unique ( exclude = None ) [source] ¶ This method is similar to clean_fields() , but validates\nuniqueness constraints defined via Field.unique , Field.unique_for_date , Field.unique_for_month , Field.unique_for_year , or Meta.unique_together on your model instead of individual\nfield values. The optional exclude argument allows you to provide a set of field names to exclude from validation. It will raise a ValidationError if any fields fail validation. UniqueConstraint s defined in the Meta.constraints are validated\nby Model.validate_constraints() . Note that if you provide an exclude argument to validate_unique() , any unique_together constraint involving one of\nthe fields you provided will not be checked. Finally, full_clean() will check any other constraints on your model. Model. validate_constraints ( exclude = None ) [source] ¶ This method validates all constraints defined in Meta.constraints . The\noptional exclude argument allows you to provide a set of field names to\nexclude from validation. It will raise a ValidationError if any constraints fail\nvalidation. Saving objects ¶ To save an object back to the database, call save() : Model. save ( * , force_insert = False , force_update = False , using = DEFAULT_DB_ALIAS , update_fields = None ) [source] ¶ Model. asave ( * , force_insert = False , force_update = False , using = DEFAULT_DB_ALIAS , update_fields = None ) ¶ Asynchronous version : asave() For details on using the force_insert and force_update arguments, see Forcing an INSERT or UPDATE . Details about the update_fields argument\ncan be found in the Specifying which fields to save section. If you want customized saving behavior, you can override this save() method. See Overriding predefined model methods for more details. The model save process also has some subtleties; see the sections below. Deprecated since version 5.1: Support for positional arguments is deprecated. Auto-incrementing primary keys ¶ If a model has an AutoField — an auto-incrementing\nprimary key — then that auto-incremented value will be calculated and saved as\nan attribute on your object the first time you call save() : >>> b2 = Blog ( name = \"Cheddar Talk\" , tagline = \"Thoughts on cheese.\" ) >>> b2 . id # Returns None, because b2 doesn't have an ID yet. >>> b2 . save () >>> b2 . id # Returns the ID of your new object. There’s no way to tell what the value of an ID will be before you call save() , because that value is calculated by your database, not by Django. For convenience, each model has an AutoField named id by default unless you explicitly specify primary_key=True on a field\nin your model. See the documentation for AutoField for more details. The pk property ¶ Model. pk ¶ Regardless of whether you define a primary key field yourself, or let Django\nsupply one for you, each model will have a property called pk . It behaves\nlike a normal attribute on the model, but is actually an alias for whichever\nattribute is the primary key field for the model. You can read and set this\nvalue, just as you would for any other attribute, and it will update the\ncorrect field in the model. Explicitly specifying auto-primary-key values ¶ If a model has an AutoField but you want to define a\nnew object’s ID explicitly when saving, define it explicitly before saving,\nrather than relying on the auto-assignment of the ID: >>> b3 = Blog ( id = 3 , name = \"Cheddar Talk\" , tagline = \"Thoughts on cheese.\" ) >>> b3 . id # Returns 3. >>> b3 . save () >>> b3 . id # Returns 3. If you assign auto-primary-key values manually, make sure not to use an\nalready-existing primary-key value! If you create a new object with an explicit\nprimary-key value that already exists in the database, Django will assume you’re\nchanging the existing record rather than creating a new one. Given the above 'Cheddar Talk' blog example, this example would override the\nprevious record in the database: b4 = Blog ( id = 3 , name = \"Not Cheddar\" , tagline = \"Anything but cheese.\" ) b4 . save () # Overrides the previous blog with ID=3! See How Django knows to UPDATE vs. INSERT , below, for the reason this\nhappens. Explicitly specifying auto-primary-key values is mostly useful for bulk-saving\nobjects, when you’re confident you won’t have primary-key collision. If you’re using PostgreSQL, the sequence associated with the primary key might\nneed to be updated; see Manually-specifying values of auto-incrementing primary keys . What happens when you save? ¶ When you save an object, Django performs the following steps: Emit a pre-save signal. The pre_save signal is sent, allowing any functions listening for that signal to do\nsomething. Preprocess the data. Each field’s pre_save() method is called to perform any\nautomated data modification that’s needed. For example, the date/time fields\noverride pre_save() to implement auto_now_add and auto_now . Prepare the data for the database. Each field’s get_db_prep_save() method is asked to provide\nits current value in a data type that can be written to the database. Most fields don’t require data preparation. Simple data types, such as\nintegers and strings, are ‘ready to write’ as a Python object. However, more\ncomplex data types often require some modification. For example, DateField fields use a Python datetime object to store data. Databases don’t store datetime objects, so the field value must be converted into an ISO-compliant date\nstring for insertion into the database. Insert the data into the database. The preprocessed, prepared data is\ncomposed into an SQL statement for insertion into the database. Emit a post-save signal. The post_save signal is sent, allowing any functions listening for that signal to do\nsomething. How Django knows to UPDATE vs. INSERT ¶ You may have noticed Django database objects use the same save() method\nfor creating and changing objects. Django abstracts the need to use INSERT or UPDATE SQL statements. Specifically, when you call save() and the\nobject’s primary key attribute does not define a default or db_default , Django follows this algorithm: If the object’s primary key attribute is set to a value that evaluates to True (i.e., a value other than None or the empty string), Django\nexecutes an UPDATE . If the object’s primary key attribute is not set or if the UPDATE didn’t update anything (e.g. if primary key is set to a value that doesn’t\nexist in the database), Django executes an INSERT . If the object’s primary key attribute defines a default or db_default then Django executes an UPDATE if it is an existing model instance and primary key is set to a value that\nexists in the database. Otherwise, Django executes an INSERT . The one gotcha here is that you should be careful not to specify a primary-key\nvalue explicitly when saving new objects, if you cannot guarantee the\nprimary-key value is unused. For more on this nuance, see Explicitly specifying\nauto-primary-key values above and Forcing an INSERT or UPDATE below. In Django 1.5 and earlier, Django did a SELECT when the primary key\nattribute was set. If the SELECT found a row, then Django did an UPDATE ,\notherwise it did an INSERT . The old algorithm results in one more query in\nthe UPDATE case. There are some rare cases where the database doesn’t\nreport that a row was updated even if the database contains a row for the\nobject’s primary key value. An example is the PostgreSQL ON UPDATE trigger\nwhich returns NULL . In such cases it is possible to revert to the old\nalgorithm by setting the select_on_save option to True . Changed in Django 5.0: The Field.db_default parameter was added. Forcing an INSERT or UPDATE ¶ In some rare circumstances, it’s necessary to be able to force the save() method to perform an SQL INSERT and not fall back to\ndoing an UPDATE . Or vice-versa: update, if possible, but not insert a new\nrow. In these cases you can pass the force_insert=True or force_update=True parameters to the save() method.\nPassing both parameters is an error: you cannot both insert and update at the\nsame time! When using multi-table inheritance , it’s also\npossible to provide a tuple of parent classes to force_insert in order to\nforce INSERT statements for each base. For example: Restaurant ( pk = 1 , name = \"Bob's Cafe\" ) . save ( force_insert = ( Place ,)) Restaurant ( pk = 1 , name = \"Bob's Cafe\" , rating = 4 ) . save ( force_insert = ( Place , Rating )) You can pass force_insert=(models.Model,) to force an INSERT statement\nfor all parents. By default, force_insert=True only forces the insertion of\na new row for the current model. It should be very rare that you’ll need to use these parameters. Django will\nalmost always do the right thing and trying to override that will lead to\nerrors that are difficult to track down. This feature is for advanced use\nonly. Using update_fields will force an update similarly to force_update . Changed in Django 5.0: Support for passing a tuple of parent classes to force_insert was\nadded. Updating attributes based on existing fields ¶ Sometimes you’ll need to perform a simple arithmetic task on a field, such\nas incrementing or decrementing the current value. One way of achieving this is\ndoing the arithmetic in Python like: >>> product = Product . objects . get ( name = \"Venezuelan Beaver Cheese\" ) >>> product . number_sold += 1 >>> product . save () If the old number_sold value retrieved from the database was 10, then\nthe value of 11 will be written back to the database. The process can be made robust, avoiding a race condition , as well as slightly faster by expressing\nthe update relative to the original field value, rather than as an explicit\nassignment of a new value. Django provides F expressions for performing this kind of relative update. Using F expressions , the previous example is expressed\nas: >>> from django.db.models import F >>> product = Product . objects . get ( name = \"Venezuelan Beaver Cheese\" ) >>> product . number_sold = F ( \"number_sold\" ) + 1 >>> product . save () For more details, see the documentation on F expressions and their use in update queries . Specifying which fields to save ¶ If save() is passed a list of field names in keyword argument update_fields , only the fields named in that list will be updated.\nThis may be desirable if you want to update just one or a few fields on\nan object. There will be a slight performance benefit from preventing\nall of the model fields from being updated in the database. For example: product . name = \"Name changed again\" product . save ( update_fields = [ \"name\" ]) The update_fields argument can be any iterable containing strings. An\nempty update_fields iterable will skip the save. A value of None will\nperform an update on all fields. Specifying update_fields will force an update. When saving a model fetched through deferred model loading\n( only() or defer() ) only the fields loaded\nfrom the DB will get updated. In effect there is an automatic update_fields in this case. If you assign or change any deferred field\nvalue, the field will be added to the updated fields. Field.pre_save() and update_fields If update_fields is passed in, only the pre_save() methods of the update_fields are called. For example, this means that date/time fields with auto_now=True will not be updated unless they are included in the update_fields . Deleting objects ¶ Model. delete ( using = DEFAULT_DB_ALIAS , keep_parents = False ) [source] ¶ Model. adelete ( using = DEFAULT_DB_ALIAS , keep_parents = False ) ¶ Asynchronous version : adelete() Issues an SQL DELETE for the object. This only deletes the object in the\ndatabase; the Python instance will still exist and will still have data in\nits fields, except for the primary key set to None . This method returns the\nnumber of objects deleted and a dictionary with the number of deletions per\nobject type. For more details, including how to delete objects in bulk, see Deleting objects . If you want customized deletion behavior, you can override the delete() method. See Overriding predefined model methods for more details. Sometimes with multi-table inheritance you may\nwant to delete only a child model’s data. Specifying keep_parents=True will\nkeep the parent model’s data. Pickling objects ¶ When you pickle a model, its current state is pickled. When you unpickle\nit, it’ll contain the model instance at the moment it was pickled, rather than\nthe data that’s currently in the database. You can’t share pickles between versions Pickles of models are only valid for the version of Django that\nwas used to generate them. If you generate a pickle using Django\nversion N, there is no guarantee that pickle will be readable with\nDjango version N+1. Pickles should not be used as part of a long-term\narchival strategy. Since pickle compatibility errors can be difficult to diagnose, such as\nsilently corrupted objects, a RuntimeWarning is raised when you try to\nunpickle a model in a Django version that is different than the one in\nwhich it was pickled. Other model instance methods ¶ A few object methods have special purposes. __str__() ¶ Model. __str__ () [source] ¶ The __str__() method is called whenever you call str() on an object.\nDjango uses str(obj) in a number of places. Most notably, to display an\nobject in the Django admin site and as the value inserted into a template when\nit displays an object. Thus, you should always return a nice, human-readable\nrepresentation of the model from the __str__() method. For example: from django.db import models class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) last_name = models . CharField ( max_length = 50 ) def __str__ ( self ): return f \" { self . first_name } { self . last_name } \" __eq__() ¶ Model. __eq__ () [source] ¶ The equality method is defined such that instances with the same primary\nkey value and the same concrete class are considered equal, except that\ninstances with a primary key value of None aren’t equal to anything except\nthemselves. For proxy models, concrete class is defined as the model’s first\nnon-proxy parent; for all other models it’s simply the model’s class. For example: from django.db import models class MyModel ( models . Model ): id = models . AutoField ( primary_key = True ) class MyProxyModel ( MyModel ): class Meta : proxy = True class MultitableInherited ( MyModel ): pass # Primary keys compared MyModel ( id = 1 ) == MyModel ( id = 1 ) MyModel ( id = 1 ) != MyModel ( id = 2 ) # Primary keys are None MyModel ( id = None ) != MyModel ( id = None ) # Same instance instance = MyModel ( id = None ) instance == instance # Proxy model MyModel ( id = 1 ) == MyProxyModel ( id = 1 ) # Multi-table inheritance MyModel ( id = 1 ) != MultitableInherited ( id = 1 ) __hash__() ¶ Model. __hash__ () [source] ¶ The __hash__() method is based on the instance’s primary key value. It\nis effectively hash(obj.pk) . If the instance doesn’t have a primary key\nvalue then a TypeError will be raised (otherwise the __hash__() method would return different values before and after the instance is\nsaved, but changing the __hash__() value of an instance is\nforbidden in Python. get_absolute_url() ¶ Model. get_absolute_url () ¶ Define a get_absolute_url() method to tell Django how to calculate the\ncanonical URL for an object. To callers, this method should appear to return a\nstring that can be used to refer to the object over HTTP. For example: def get_absolute_url ( self ): return \"/people/ %i /\" % self . id While this code is correct and simple, it may not be the most portable way to\nto write this kind of method. The reverse() function is\nusually the best approach. For example: def get_absolute_url ( self ): from django.urls import reverse return reverse ( \"people-detail\" , kwargs = { \"pk\" : self . pk }) One place Django uses get_absolute_url() is in the admin app. If an object\ndefines this method, the object-editing page will have a “View on site” link\nthat will jump you directly to the object’s public view, as given by get_absolute_url() . Similarly, a couple of other bits of Django, such as the syndication feed\nframework , use get_absolute_url() when it is\ndefined. If it makes sense for your model’s instances to each have a unique\nURL, you should define get_absolute_url() . Warning You should avoid building the URL from unvalidated user input, in order to\nreduce possibilities of link or redirect poisoning: def get_absolute_url ( self ): return \"/ %s /\" % self . name If self.name is '/example.com' this returns '//example.com/' which, in turn, is a valid schema relative URL but not the expected '/%2Fexample.com/' . It’s good practice to use get_absolute_url() in templates, instead of\nhard-coding your objects’ URLs. For example, this template code is bad: <!-- BAD template code. Avoid! --> < a href = \"/people/ {{ object.id }} /\" > {{ object.name }} </ a > This template code is much better: < a href = \" {{ object.get_absolute_url }} \" > {{ object.name }} </ a > The logic here is that if you change the URL structure of your objects, even\nfor something small like correcting a spelling error, you don’t want to have to\ntrack down every place that the URL might be created. Specify it once, in get_absolute_url() and have all your other code call that one place. Note The string you return from get_absolute_url() must contain only\nASCII characters (required by the URI specification, RFC 3986 Section 2 )\nand be URL-encoded, if necessary. Code and templates calling get_absolute_url() should be able to use the\nresult directly without any further processing. You may wish to use the django.utils.encoding.iri_to_uri() function to help with this if you\nare using strings containing characters outside the ASCII range. Extra instance methods ¶ In addition to save() , delete() , a model object\nmight have some of the following methods: Model. get_FOO_display () ¶ For every field that has choices set, the\nobject will have a get_FOO_display() method, where FOO is the name of\nthe field. This method returns the “human-readable” value of the field. For example: from django.db import models class Person ( models . Model ): SHIRT_SIZES = { \"S\" : \"Small\" , \"M\" : \"Medium\" , \"L\" : \"Large\" , } name = models . CharField ( max_length = 60 ) shirt_size = models . CharField ( max_length = 2 , choices = SHIRT_SIZES ) >>> p = Person ( name = \"Fred Flintstone\" , shirt_size = \"L\" ) >>> p . save () >>> p . shirt_size 'L' >>> p . get_shirt_size_display () 'Large' Model. get_next_by_FOO ( ** kwargs ) ¶ Model. get_previous_by_FOO ( ** kwargs ) ¶ For every DateField and DateTimeField that does not have null=True , the object will have get_next_by_FOO() and get_previous_by_FOO() methods, where FOO is the name of the field. This\nreturns the next and previous object with respect to the date field, raising\na DoesNotExist exception when appropriate. Both of these methods will perform their queries using the default\nmanager for the model. If you need to emulate filtering used by a\ncustom manager, or want to perform one-off custom filtering, both\nmethods also accept optional keyword arguments, which should be in the\nformat described in Field lookups . Note that in the case of identical date values, these methods will use the\nprimary key as a tie-breaker. This guarantees that no records are skipped or\nduplicated. That also means you cannot use those methods on unsaved objects. Overriding extra instance methods In most cases overriding or inheriting get_FOO_display() , get_next_by_FOO() , and get_previous_by_FOO() should work as\nexpected. Since they are added by the metaclass however, it is not\npractical to account for all possible inheritance structures. In more\ncomplex cases you should override Field.contribute_to_class() to set\nthe methods you need. Other attributes ¶ _state ¶ Model. _state ¶ The _state attribute refers to a ModelState object that tracks\nthe lifecycle of the model instance. The ModelState object has two attributes: adding , a flag which is True if the model has not been saved to the database yet, and db ,\na string referring to the database alias the instance was loaded from or\nsaved to. Newly instantiated instances have adding=True and db=None ,\nsince they are yet to be saved. Instances fetched from a QuerySet will have adding=False and db set to the alias of the associated\ndatabase.", "keywords": ["feed", "feature", "field.db_default", "field", "#", "m", "record", "unique_together", "field.unique", "bits", "+", "l", "representation", "range", "django.db.models", "datefield", "compatibility", "parents", "b2", "change", "nuance", "django.urls", "creator", "django.core.exceptions", "http", "=", "bookmanager", "get_absolute_url", "n", "href", "force_insert", "self.name", "n+1", "process", "places", "number_sold", "first_name", "uniqueness", "possibilities", "following", "type", "processing", "talk", "people", "custom", "kwargs", "defines", "objects", "documentation", "lookups", "str(obj", "customization", "constraint", "guarantee", "strategy", "user", "django.utils.translation", "cases", "model.clean", "annotations", "attribute", "deferred_fields", "helper", "incrementing", "pickle", "constraints", "runtimewarning", "time", "save", "date", "venezuelan", "purposes", "account", "id=3", "concrete_fields", "logic", "auto_now", "name", "parameter", "get_foo_display", "flags", "reference", "clean_fields", "._loaded_values", "versions", "modification", "queries", "manager", "select_for_update", "creator_id", "return", "field.unique_for_month", "reverse", "deletion", "guides", "expressions", "foo", "define", "parent", "validate_unique", "shirt_size", "collision", "blog", "datetimefield", "mymodel", "status", "test_update_result", "@cached_property", "proxy", "url", "model.validate_unique", "error", "publication", "classmethod", "code", "algorithm", "bulk", "filter", "false", "behavior", "access", "class", "i", "link", "customizing", "returns", "names", "recursion", "database", "flag", "b3", "input", "signal", "*", "query", "page", "test", "metaclass", "postgresql", "types", "strings", "admin", "adelete", "creation", ".", "insert", "step", "max_length", "manually", "validation", "create", "e", "section", "source", "specification", "sequence", "poisoning", "use", "non_field_errors", "b4", "cafe", "performance", "django.utils.encoding.iri_to_uri", "e.message_dict", "get_deferred_fields", "specifying", "pass", "product", "order", "signature", "default", "model.validate_constraints", "choices", "prejudice", "alias", "spelling", "form", "fred", "option", "avoid", "format", "classes", "characters", "equality", "cleaning", "object.name", "validationerror", "convenience", "f", "archival", "material", "race", "len", "field.unique_for_year", "stages", "adding", "template", "schema", "way", "breaker", "super", "syndication", "validate", "queryset", "¶", "id", "parameters", "val", "integers", "modelstate", "property", "base_manager", "primary", "validate_constraints", "function", "field.unique_for_date", "dilemma", "result", "pre_save", "view", "control", "number", "meta.exclude", "relations", "create_book", "modelform", "def", "point", "values", "string", "_", "cls", "mapping", "thing", "select_on_save", "auto", "databases", "structures", "exclude", "table", "models", "version", "loading", "article", "condition", "on", "django", "active_objects", "rfc", "n’t", "fields", "set", "override", "p", "book", "db", "practice", "value", "deletions", "rating", "implementation", "data", "datetime", "base", "guide", "task", "person", "beaver", "insertion", "self", "need", "instance", "typeerror", "uri", "pub_date", "today", "primary_key", "field.pre_save", "report", "respect", "get_previous_by_foo", "get_next_by_foo", "approaches", "callers", "gettext_lazy", "reloading", "lifecycle", "gotcha", "instances", "field.contribute_to_class", "iso", "structure", "statement", "inheriting", "part", "object", "couple", "valueerror", "related_field", "charfield", "dictionary", "sql", "update_fields", "pride", "keyword", "cls(*values", "s", "child", "from_db", "obj", "cheddar", "turn", "intersection", "effect", "detail", "inheritance", "restaurant", "/people/", "examplemodel", "filtering", "refresh_from_db", "items", "keep_parents", "field_names", "bob", "autofield", "site", "obj.val", "addition", "example", "care", "app", "list", "cheese", "model.clean_fields", "steps", "draft", "model.full_clean", "preparation", "model", "sections", "place", "attributes", "approach", "editing", "title", "relative", "sense", "meta.unique_together", "circumstances", "select", "uniqueconstraint", "benefit", "keys", "case", "subtleties", "assignment", "full_clean", "null", "clean", "errors", "tuple", "force_insert=(models", "str", "arguments", "multitableinherited", "init", "loaded_values", "thoughts", "db_default", "one", "deferred", "end", "entries", "records", "delete", "last_name", "object.get_absolute_url", "kind", "is_valid", "functions", "key", "term", "update", "none", "meta", "arithmetic", "pickles", "reason", "framework", "true", "urls", "api", "support", "document", "documents", "import", "d", "statements", "union", "%", "call", "pk", "meta.fields", "default_db_alias", "information", "row", "python", "methods", "trigger", "flintstone", "meta.constraints", "exception", "@classmethod", "details", "tie", "method", "django.db", "transaction", "argument", "del", "note", "state", "templates", "moment", "zip", "exceptions"], "type": "documentation"},
{"title": "Request and response objects | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/request-response/", "content": "Request and response objects ¶ Quick overview ¶ Django uses request and response objects to pass state through the system. When a page is requested, Django creates an HttpRequest object that\ncontains metadata about the request. Then Django loads the appropriate view,\npassing the HttpRequest as the first argument to the view function.\nEach view is responsible for returning an HttpResponse object. This document explains the APIs for HttpRequest and HttpResponse objects, which are defined in the django.http module. HttpRequest objects ¶ class HttpRequest [source] ¶ Attributes ¶ All attributes should be considered read-only, unless stated otherwise. HttpRequest. scheme [source] ¶ A string representing the scheme of the request ( http or https usually). HttpRequest. body [source] ¶ The raw HTTP request body as a bytestring. This is useful for processing\ndata in different ways than conventional HTML forms: binary images,\nXML payload etc. For processing conventional form data, use HttpRequest.POST . You can also read from an HttpRequest using a file-like interface with HttpRequest.read() or HttpRequest.readline() . Accessing\nthe body attribute after reading the request with either of these I/O\nstream methods will produce a RawPostDataException . HttpRequest. path ¶ A string representing the full path to the requested page, not including\nthe scheme, domain, or query string. Example: \"/music/bands/the_beatles/\" HttpRequest. path_info ¶ Under some web server configurations, the portion of the URL after the\nhost name is split up into a script prefix portion and a path info\nportion. The path_info attribute always contains the path info portion\nof the path, no matter what web server is being used. Using this instead\nof path can make your code easier to move between\ntest and deployment servers. For example, if the WSGIScriptAlias for your application is set to \"/minfo\" , then path might be \"/minfo/music/bands/the_beatles/\" and path_info would be \"/music/bands/the_beatles/\" . HttpRequest. method ¶ A string representing the HTTP method used in the request. This is\nguaranteed to be uppercase. For example: if request . method == \"GET\" : do_something () elif request . method == \"POST\" : do_something_else () HttpRequest. encoding [source] ¶ A string representing the current encoding used to decode form submission\ndata (or None , which means the DEFAULT_CHARSET setting is\nused). You can write to this attribute to change the encoding used when\naccessing the form data. Any subsequent attribute accesses (such as reading\nfrom GET or POST ) will use the new encoding value.\nUseful if you know the form data is not in the DEFAULT_CHARSET encoding. HttpRequest. content_type ¶ A string representing the MIME type of the request, parsed from the CONTENT_TYPE header. HttpRequest. content_params ¶ A dictionary of key/value parameters included in the CONTENT_TYPE header. HttpRequest. GET ¶ A dictionary-like object containing all given HTTP GET parameters. See the QueryDict documentation below. HttpRequest. POST ¶ A dictionary-like object containing all given HTTP POST parameters,\nproviding that the request contains form data. See the QueryDict documentation below. If you need to access raw or\nnon-form data posted in the request, access this through the HttpRequest.body attribute instead. It’s possible that a request can come in via POST with an empty POST dictionary – if, say, a form is requested via the POST HTTP method but\ndoes not include form data. Therefore, you shouldn’t use if request.POST to check for use of the POST method; instead, use if request.method == \"POST\" (see HttpRequest.method ). POST does not include file-upload information. See FILES . HttpRequest. COOKIES ¶ A dictionary containing all cookies. Keys and values are strings. HttpRequest. FILES ¶ A dictionary-like object containing all uploaded files. Each key in FILES is the name from the <input type=\"file\" name=\"\"> . Each\nvalue in FILES is an UploadedFile . See Managing files for more information. FILES will only contain data if the request method was POST and the <form> that posted to the request had enctype=\"multipart/form-data\" .\nOtherwise, FILES will be a blank dictionary-like object. HttpRequest. META ¶ A dictionary containing all available HTTP headers. Available headers\ndepend on the client and server, but here are some examples: CONTENT_LENGTH – The length of the request body (as a string). CONTENT_TYPE – The MIME type of the request body. HTTP_ACCEPT – Acceptable content types for the response. HTTP_ACCEPT_ENCODING – Acceptable encodings for the response. HTTP_ACCEPT_LANGUAGE – Acceptable languages for the response. HTTP_HOST – The HTTP Host header sent by the client. HTTP_REFERER – The referring page, if any. HTTP_USER_AGENT – The client’s user-agent string. QUERY_STRING – The query string, as a single (unparsed) string. REMOTE_ADDR – The IP address of the client. REMOTE_HOST – The hostname of the client. REMOTE_USER – The user authenticated by the web server, if any. REQUEST_METHOD – A string such as \"GET\" or \"POST\" . SERVER_NAME – The hostname of the server. SERVER_PORT – The port of the server (as a string). With the exception of CONTENT_LENGTH and CONTENT_TYPE , as given\nabove, any HTTP headers in the request are converted to META keys by\nconverting all characters to uppercase, replacing any hyphens with\nunderscores and adding an HTTP_ prefix to the name. So, for example, a\nheader called X-Bender would be mapped to the META key HTTP_X_BENDER . Note that runserver strips all headers with underscores in the\nname, so you won’t see them in META . This prevents header-spoofing\nbased on ambiguity between underscores and dashes both being normalizing to\nunderscores in WSGI environment variables. It matches the behavior of\nweb servers like Nginx and Apache 2.4+. HttpRequest.headers is a simpler way to access all HTTP-prefixed\nheaders, plus CONTENT_LENGTH and CONTENT_TYPE . HttpRequest. headers [source] ¶ A case insensitive, dict-like object that provides access to all\nHTTP-prefixed headers (plus Content-Length and Content-Type ) from\nthe request. The name of each header is stylized with title-casing (e.g. User-Agent )\nwhen it’s displayed. You can access headers case-insensitively: >>> request . headers {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6', ...} >>> \"User-Agent\" in request . headers True >>> \"user-agent\" in request . headers True >>> request . headers [ \"User-Agent\" ] Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) >>> request . headers [ \"user-agent\" ] Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) >>> request . headers . get ( \"User-Agent\" ) Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) >>> request . headers . get ( \"user-agent\" ) Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) For use in, for example, Django templates, headers can also be looked up\nusing underscores in place of hyphens: {{ request.headers.user_agent }} HttpRequest. resolver_match ¶ An instance of ResolverMatch representing the\nresolved URL. This attribute is only set after URL resolving took place,\nwhich means it’s available in all views but not in middleware which are\nexecuted before URL resolving takes place (you can use it in process_view() though). Attributes set by application code ¶ Django doesn’t set these attributes itself but makes use of them if set by your\napplication. HttpRequest. current_app ¶ The url template tag will use its value as the current_app argument to reverse() . HttpRequest. urlconf ¶ This will be used as the root URLconf for the current request, overriding\nthe ROOT_URLCONF setting. See How Django processes a request for details. urlconf can be set to None to revert any changes made by previous\nmiddleware and return to using the ROOT_URLCONF . HttpRequest. exception_reporter_filter ¶ This will be used instead of DEFAULT_EXCEPTION_REPORTER_FILTER for the current request. See Custom error reports for details. HttpRequest. exception_reporter_class ¶ This will be used instead of DEFAULT_EXCEPTION_REPORTER for the\ncurrent request. See Custom error reports for details. Attributes set by middleware ¶ Some of the middleware included in Django’s contrib apps set attributes on the\nrequest. If you don’t see the attribute on a request, be sure the appropriate\nmiddleware class is listed in MIDDLEWARE . HttpRequest. session ¶ From the SessionMiddleware : A\nreadable and writable, dictionary-like object that represents the current\nsession. HttpRequest. site ¶ From the CurrentSiteMiddleware :\nAn instance of Site or RequestSite as returned by get_current_site() representing the current site. HttpRequest. user ¶ From the AuthenticationMiddleware :\nAn instance of AUTH_USER_MODEL representing the currently\nlogged-in user. If the user isn’t currently logged in, user will be set\nto an instance of AnonymousUser . You\ncan tell them apart with is_authenticated , like so: if request . user . is_authenticated : ... # Do something for logged-in users. else : ... # Do something for anonymous users. The auser() method does the same thing but can be used from async\ncontexts. Methods ¶ HttpRequest. auser () ¶ New in Django 5.0. From the AuthenticationMiddleware :\nCoroutine. Returns an instance of AUTH_USER_MODEL representing\nthe currently logged-in user. If the user isn’t currently logged in, auser will return an instance of AnonymousUser . This is similar to the user attribute but it works in async contexts. HttpRequest. get_host () [source] ¶ Returns the originating host of the request using information from the HTTP_X_FORWARDED_HOST (if USE_X_FORWARDED_HOST is enabled)\nand HTTP_HOST headers, in that order. If they don’t provide a value,\nthe method uses a combination of SERVER_NAME and SERVER_PORT as\ndetailed in PEP 3333 . Example: \"127.0.0.1:8000\" Raises django.core.exceptions.DisallowedHost if the host is not in ALLOWED_HOSTS or the domain name is invalid according to RFC 1034 / 1035 . Note The get_host() method fails when the host is\nbehind multiple proxies. One solution is to use middleware to rewrite\nthe proxy headers, as in the following example: class MultipleProxyMiddleware : FORWARDED_FOR_FIELDS = [ \"HTTP_X_FORWARDED_FOR\" , \"HTTP_X_FORWARDED_HOST\" , \"HTTP_X_FORWARDED_SERVER\" , ] def __init__ ( self , get_response ): self . get_response = get_response def __call__ ( self , request ): \"\"\" Rewrites the proxy headers so that only the most recent proxy is used. \"\"\" for field in self . FORWARDED_FOR_FIELDS : if field in request . META : if \",\" in request . META [ field ]: parts = request . META [ field ] . split ( \",\" ) request . META [ field ] = parts [ - 1 ] . strip () return self . get_response ( request ) This middleware should be positioned before any other middleware that\nrelies on the value of get_host() – for instance, CommonMiddleware or CsrfViewMiddleware . HttpRequest. get_port () [source] ¶ Returns the originating port of the request using information from the HTTP_X_FORWARDED_PORT (if USE_X_FORWARDED_PORT is enabled)\nand SERVER_PORT META variables, in that order. HttpRequest. get_full_path () [source] ¶ Returns the path , plus an appended query string, if applicable. Example: \"/music/bands/the_beatles/?print=true\" HttpRequest. get_full_path_info () [source] ¶ Like get_full_path() , but uses path_info instead of path . Example: \"/minfo/music/bands/the_beatles/?print=true\" HttpRequest. build_absolute_uri ( location = None ) [source] ¶ Returns the absolute URI form of location . If no location is provided,\nthe location will be set to request.get_full_path() . If the location is already an absolute URI, it will not be altered.\nOtherwise the absolute URI is built using the server variables available in\nthis request. For example: >>> request . build_absolute_uri () 'https://example.com/music/bands/the_beatles/?print=true' >>> request . build_absolute_uri ( \"/bands/\" ) 'https://example.com/bands/' >>> request . build_absolute_uri ( \"https://example2.com/bands/\" ) 'https://example2.com/bands/' Note Mixing HTTP and HTTPS on the same site is discouraged, therefore build_absolute_uri() will always generate an\nabsolute URI with the same scheme the current request has. If you need\nto redirect users to HTTPS, it’s best to let your web server redirect\nall HTTP traffic to HTTPS. HttpRequest. get_signed_cookie ( key , default = RAISE_ERROR , salt = '' , max_age = None ) [source] ¶ Returns a cookie value for a signed cookie, or raises a django.core.signing.BadSignature exception if the signature is\nno longer valid. If you provide the default argument the exception\nwill be suppressed and that default value will be returned instead. The optional salt argument can be used to provide extra protection\nagainst brute force attacks on your secret key. If supplied, the max_age argument will be checked against the signed timestamp\nattached to the cookie value to ensure the cookie is not older than max_age seconds. For example: >>> request . get_signed_cookie ( \"name\" ) 'Tony' >>> request . get_signed_cookie ( \"name\" , salt = \"name-salt\" ) 'Tony' # assuming cookie was set using the same salt >>> request . get_signed_cookie ( \"nonexistent-cookie\" ) KeyError: 'nonexistent-cookie' >>> request . get_signed_cookie ( \"nonexistent-cookie\" , False ) False >>> request . get_signed_cookie ( \"cookie-that-was-tampered-with\" ) BadSignature: ... >>> request . get_signed_cookie ( \"name\" , max_age = 60 ) SignatureExpired: Signature age 1677.3839159 > 60 seconds >>> request . get_signed_cookie ( \"name\" , False , max_age = 60 ) False See cryptographic signing for more information. HttpRequest. is_secure () [source] ¶ Returns True if the request is secure; that is, if it was made with\nHTTPS. HttpRequest. accepts ( mime_type ) [source] ¶ Returns True if the request Accept header matches the mime_type argument: >>> request . accepts ( \"text/html\" ) True Most browsers send Accept: */* by default, so this would return True for all content types. Setting an explicit Accept header in\nAPI requests can be useful for returning a different content type for those\nconsumers only. See Content negotiation example of using accepts() to return different content to API consumers. If a response varies depending on the content of the Accept header and\nyou are using some form of caching like Django’s cache middleware , you should decorate the view with vary_on_headers('Accept') so that the responses are\nproperly cached. HttpRequest. read ( size = None ) [source] ¶ HttpRequest. readline () [source] ¶ HttpRequest. readlines () [source] ¶ HttpRequest. __iter__ () [source] ¶ Methods implementing a file-like interface for reading from an HttpRequest instance. This makes it possible to consume an incoming\nrequest in a streaming fashion. A common use-case would be to process a\nbig XML payload with an iterative parser without constructing a whole\nXML tree in memory. Given this standard interface, an HttpRequest instance can be\npassed directly to an XML parser such as ElementTree : import xml.etree.ElementTree as ET for element in ET . iterparse ( request ): process ( element ) QueryDict objects ¶ class QueryDict [source] ¶ In an HttpRequest object, the GET and POST attributes are instances of django.http.QueryDict ,\na dictionary-like class customized to deal with multiple values for the same\nkey. This is necessary because some HTML form elements, notably <select multiple> , pass multiple values for the same key. The QueryDict s at request.POST and request.GET will be immutable\nwhen accessed in a normal request/response cycle. To get a mutable version you\nneed to use QueryDict.copy() . Methods ¶ QueryDict implements all the standard dictionary methods because it’s\na subclass of dictionary. Exceptions are outlined here: QueryDict. __init__ ( query_string = None , mutable = False , encoding = None ) [source] ¶ Instantiates a QueryDict object based on query_string . >>> QueryDict ( \"a=1&a=2&c=3\" ) <QueryDict: {'a': ['1', '2'], 'c': ['3']}> If query_string is not passed in, the resulting QueryDict will be\nempty (it will have no keys or values). Most QueryDict s you encounter, and in particular those at request.POST and request.GET , will be immutable. If you are\ninstantiating one yourself, you can make it mutable by passing mutable=True to its __init__() . Strings for setting both keys and values will be converted from encoding to str . If encoding is not set, it defaults to DEFAULT_CHARSET . classmethod QueryDict. fromkeys ( iterable , value = '' , mutable = False , encoding = None ) [source] ¶ Creates a new QueryDict with keys from iterable and each value\nequal to value . For example: >>> QueryDict . fromkeys ([ \"a\" , \"a\" , \"b\" ], value = \"val\" ) <QueryDict: {'a': ['val', 'val'], 'b': ['val']}> QueryDict. __getitem__ ( key ) ¶ Returns the value for the given key. If the key has more than one value,\nit returns the last value. Raises django.utils.datastructures.MultiValueDictKeyError if the key does not\nexist. (This is a subclass of Python’s standard KeyError , so you can\nstick to catching KeyError .) QueryDict. __setitem__ ( key , value ) [source] ¶ Sets the given key to [value] (a list whose single element is value ). Note that this, as other dictionary functions that have side\neffects, can only be called on a mutable QueryDict (such as one that\nwas created via QueryDict.copy() ). QueryDict. __contains__ ( key ) ¶ Returns True if the given key is set. This lets you do, e.g., if \"foo\" in request.GET . QueryDict. get ( key , default = None ) ¶ Uses the same logic as __getitem__() , with a hook for returning a\ndefault value if the key doesn’t exist. QueryDict. setdefault ( key , default = None ) [source] ¶ Like dict.setdefault() , except it uses __setitem__() internally. QueryDict. update ( other_dict ) ¶ Takes either a QueryDict or a dictionary. Like dict.update() ,\nexcept it appends to the current dictionary items rather than replacing\nthem. For example: >>> q = QueryDict ( \"a=1\" , mutable = True ) >>> q . update ({ \"a\" : \"2\" }) >>> q . getlist ( \"a\" ) ['1', '2'] >>> q [ \"a\" ] # returns the last '2' QueryDict. items () ¶ Like dict.items() , except this uses the same last-value logic as __getitem__() and returns an iterator object instead of a view object.\nFor example: >>> q = QueryDict ( \"a=1&a=2&a=3\" ) >>> list ( q . items ()) [('a', '3')] QueryDict. values () ¶ Like dict.values() , except this uses the same last-value logic as __getitem__() and returns an iterator instead of a view object. For\nexample: >>> q = QueryDict ( \"a=1&a=2&a=3\" ) >>> list ( q . values ()) ['3'] In addition, QueryDict has the following methods: QueryDict. copy () [source] ¶ Returns a copy of the object using copy.deepcopy() . This copy will\nbe mutable even if the original was not. QueryDict. getlist ( key , default = None ) ¶ Returns a list of the data with the requested key. Returns an empty list if\nthe key doesn’t exist and default is None . It’s guaranteed to\nreturn a list unless the default value provided isn’t a list. QueryDict. setlist ( key , list_ ) [source] ¶ Sets the given key to list_ (unlike __setitem__() ). QueryDict. appendlist ( key , item ) [source] ¶ Appends an item to the internal list associated with key. QueryDict. setlistdefault ( key , default_list = None ) [source] ¶ Like setdefault() , except it takes a list of values instead of a\nsingle value. QueryDict. lists () ¶ Like items() , except it includes all values, as a list, for each\nmember of the dictionary. For example: >>> q = QueryDict ( \"a=1&a=2&a=3\" ) >>> q . lists () [('a', ['1', '2', '3'])] QueryDict. pop ( key ) [source] ¶ Returns a list of values for the given key and removes them from the\ndictionary. Raises KeyError if the key does not exist. For example: >>> q = QueryDict ( \"a=1&a=2&a=3\" , mutable = True ) >>> q . pop ( \"a\" ) ['1', '2', '3'] QueryDict. popitem () [source] ¶ Removes an arbitrary member of the dictionary (since there’s no concept\nof ordering), and returns a two value tuple containing the key and a list\nof all values for the key. Raises KeyError when called on an empty\ndictionary. For example: >>> q = QueryDict ( \"a=1&a=2&a=3\" , mutable = True ) >>> q . popitem () ('a', ['1', '2', '3']) QueryDict. dict () ¶ Returns a dict representation of QueryDict . For every (key, list)\npair in QueryDict , dict will have (key, item), where item is one\nelement of the list, using the same logic as QueryDict.__getitem__() : >>> q = QueryDict ( \"a=1&a=3&a=5\" ) >>> q . dict () {'a': '5'} QueryDict. urlencode ( safe = None ) [source] ¶ Returns a string of the data in query string format. For example: >>> q = QueryDict ( \"a=2&b=3&b=5\" ) >>> q . urlencode () 'a=2&b=3&b=5' Use the safe parameter to pass characters which don’t require encoding.\nFor example: >>> q = QueryDict ( mutable = True ) >>> q [ \"next\" ] = \"/a&b/\" >>> q . urlencode ( safe = \"/\" ) 'next=/a%26b/' HttpResponse objects ¶ class HttpResponse [source] ¶ In contrast to HttpRequest objects, which are created automatically by\nDjango, HttpResponse objects are your responsibility. Each view you\nwrite is responsible for instantiating, populating, and returning an HttpResponse . The HttpResponse class lives in the django.http module. Usage ¶ Passing strings ¶ Typical usage is to pass the contents of the page, as a string, bytestring,\nor memoryview , to the HttpResponse constructor: >>> from django.http import HttpResponse >>> response = HttpResponse ( \"Here's the text of the web page.\" ) >>> response = HttpResponse ( \"Text only, please.\" , content_type = \"text/plain\" ) >>> response = HttpResponse ( b \"Bytestrings are also accepted.\" ) >>> response = HttpResponse ( memoryview ( b \"Memoryview as well.\" )) But if you want to add content incrementally, you can use response as a\nfile-like object: >>> response = HttpResponse () >>> response . write ( \"<p>Here's the text of the web page.</p>\" ) >>> response . write ( \"<p>Here's another paragraph.</p>\" ) Passing iterators ¶ Finally, you can pass HttpResponse an iterator rather than strings. HttpResponse will consume the iterator immediately, store its content as a\nstring, and discard it. Objects with a close() method such as files and\ngenerators are immediately closed. If you need the response to be streamed from the iterator to the client, you\nmust use the StreamingHttpResponse class instead. Setting header fields ¶ To set or remove a header field in your response, use HttpResponse.headers : >>> response = HttpResponse () >>> response . headers [ \"Age\" ] = 120 >>> del response . headers [ \"Age\" ] You can also manipulate headers by treating your response like a dictionary: >>> response = HttpResponse () >>> response [ \"Age\" ] = 120 >>> del response [ \"Age\" ] This proxies to HttpResponse.headers , and is the original interface offered\nby HttpResponse . When using this interface, unlike a dictionary, del doesn’t raise KeyError if the header field doesn’t exist. You can also set headers on instantiation: >>> response = HttpResponse ( headers = { \"Age\" : 120 }) For setting the Cache-Control and Vary header fields, it is recommended\nto use the patch_cache_control() and patch_vary_headers() methods from django.utils.cache , since these fields can have multiple, comma-separated\nvalues. The “patch” methods ensure that other values, e.g. added by a\nmiddleware, are not removed. HTTP header fields cannot contain newlines. An attempt to set a header field\ncontaining a newline character (CR or LF) will raise BadHeaderError Telling the browser to treat the response as a file attachment ¶ To tell the browser to treat the response as a file attachment, set the Content-Type and Content-Disposition headers. For example, this is how\nyou might return a Microsoft Excel spreadsheet: >>> response = HttpResponse ( ... my_data , ... headers = { ... \"Content-Type\" : \"application/vnd.ms-excel\" , ... \"Content-Disposition\" : 'attachment; filename=\"foo.xls\"' , ... }, ... ) There’s nothing Django-specific about the Content-Disposition header, but\nit’s easy to forget the syntax, so we’ve included it here. Attributes ¶ HttpResponse. content [source] ¶ A bytestring representing the content, encoded from a string if necessary. HttpResponse. cookies ¶ A http.cookies.SimpleCookie object holding the cookies included\nin the response. HttpResponse. headers ¶ A case insensitive, dict-like object that provides an interface to all\nHTTP headers on the response, except a Set-Cookie header. See Setting header fields and HttpResponse.cookies . HttpResponse. charset ¶ A string denoting the charset in which the response will be encoded. If not\ngiven at HttpResponse instantiation time, it will be extracted from content_type and if that is unsuccessful, the DEFAULT_CHARSET setting will be used. HttpResponse. status_code ¶ The HTTP status code for the response. Unless reason_phrase is explicitly set, modifying the value of status_code outside the constructor will also modify the value of reason_phrase . HttpResponse. reason_phrase ¶ The HTTP reason phrase for the response. It uses the HTTP standard’s default reason phrases. Unless explicitly set, reason_phrase is determined by the value of status_code . HttpResponse. streaming ¶ This is always False . This attribute exists so middleware can treat streaming responses\ndifferently from regular responses. HttpResponse. closed ¶ True if the response has been closed. Methods ¶ HttpResponse. __init__ ( content = b'' , content_type = None , status = 200 , reason = None , charset = None , headers = None ) [source] ¶ Instantiates an HttpResponse object with the given page content,\ncontent type, and headers. content is most commonly an iterator, bytestring, memoryview ,\nor string. Other types will be converted to a bytestring by encoding their\nstring representation. Iterators should return strings or bytestrings and\nthose will be joined together to form the content of the response. content_type is the MIME type optionally completed by a character set\nencoding and is used to fill the HTTP Content-Type header. If not\nspecified, it is formed by 'text/html' and the DEFAULT_CHARSET settings, by default: \"text/html; charset=utf-8\" . status is the HTTP status code for the\nresponse. You can use Python’s http.HTTPStatus for meaningful\naliases, such as HTTPStatus.NO_CONTENT . reason is the HTTP response phrase. If not provided, a default phrase\nwill be used. charset is the charset in which the response will be encoded. If not\ngiven it will be extracted from content_type , and if that\nis unsuccessful, the DEFAULT_CHARSET setting will be used. headers is a dict of HTTP headers for the response. HttpResponse. __setitem__ ( header , value ) ¶ Sets the given header name to the given value. Both header and value should be strings. HttpResponse. __delitem__ ( header ) ¶ Deletes the header with the given name. Fails silently if the header\ndoesn’t exist. Case-insensitive. HttpResponse. __getitem__ ( header ) ¶ Returns the value for the given header name. Case-insensitive. HttpResponse. get ( header , alternate = None ) ¶ Returns the value for the given header, or an alternate if the header\ndoesn’t exist. HttpResponse. has_header ( header ) ¶ Returns True or False based on a case-insensitive check for a\nheader with the given name. HttpResponse. items () ¶ Acts like dict.items() for HTTP headers on the response. HttpResponse. setdefault ( header , value ) ¶ Sets a header unless it has already been set. HttpResponse. set_cookie ( key , value = '' , max_age = None , expires = None , path = '/' , domain = None , secure = False , httponly = False , samesite = None ) ¶ Sets a cookie. The parameters are the same as in the Morsel cookie object in the Python standard library. max_age should be a timedelta object, an integer\nnumber of seconds, or None (default) if the cookie should last only\nas long as the client’s browser session. If expires is not specified,\nit will be calculated. expires should either be a string in the format \"Wdy, DD-Mon-YY HH:MM:SS GMT\" or a datetime.datetime object\nin UTC. If expires is a datetime object, the max_age will be calculated. Use domain if you want to set a cross-domain cookie. For example, domain=\"example.com\" will set a cookie that is readable by the\ndomains www.example.com, blog.example.com, etc. Otherwise, a cookie will\nonly be readable by the domain that set it. Use secure=True if you want the cookie to be only sent to the server\nwhen a request is made with the https scheme. Use httponly=True if you want to prevent client-side\nJavaScript from having access to the cookie. HttpOnly is a flag included in a Set-Cookie HTTP response header. It’s\npart of the RFC 6265 standard for cookies\nand can be a useful way to mitigate the risk of a client-side script\naccessing the protected cookie data. Use samesite='Strict' or samesite='Lax' to tell the browser not\nto send this cookie when performing a cross-origin request. SameSite isn’t supported by all browsers, so it’s not a replacement for Django’s\nCSRF protection, but rather a defense in depth measure. Use samesite='None' (string) to explicitly state that this cookie is\nsent with all same-site and cross-site requests. Warning RFC 6265 states that user agents should\nsupport cookies of at least 4096 bytes. For many browsers this is also\nthe maximum size. Django will not raise an exception if there’s an\nattempt to store a cookie of more than 4096 bytes, but many browsers\nwill not set the cookie correctly. HttpResponse. set_signed_cookie ( key , value , salt = '' , max_age = None , expires = None , path = '/' , domain = None , secure = False , httponly = False , samesite = None ) ¶ Like set_cookie() , but cryptographic signing the cookie before setting\nit. Use in conjunction with HttpRequest.get_signed_cookie() .\nYou can use the optional salt argument for added key strength, but\nyou will need to remember to pass it to the corresponding HttpRequest.get_signed_cookie() call. HttpResponse. delete_cookie ( key , path = '/' , domain = None , samesite = None ) ¶ Deletes the cookie with the given key. Fails silently if the key doesn’t\nexist. Due to the way cookies work, path and domain should be the same\nvalues you used in set_cookie() – otherwise the cookie may not be\ndeleted. HttpResponse. close () ¶ This method is called at the end of the request directly by the WSGI\nserver. HttpResponse. write ( content ) [source] ¶ This method makes an HttpResponse instance a file-like object. HttpResponse. flush () ¶ This method makes an HttpResponse instance a file-like object. HttpResponse. tell () [source] ¶ This method makes an HttpResponse instance a file-like object. HttpResponse. getvalue () [source] ¶ Returns the value of HttpResponse.content . This method makes\nan HttpResponse instance a stream-like object. HttpResponse. readable () ¶ Always False . This method makes an HttpResponse instance a\nstream-like object. HttpResponse. seekable () ¶ Always False . This method makes an HttpResponse instance a\nstream-like object. HttpResponse. writable () [source] ¶ Always True . This method makes an HttpResponse instance a\nstream-like object. HttpResponse. writelines ( lines ) [source] ¶ Writes a list of lines to the response. Line separators are not added. This\nmethod makes an HttpResponse instance a stream-like object. HttpResponse subclasses ¶ Django includes a number of HttpResponse subclasses that handle different\ntypes of HTTP responses. Like HttpResponse , these subclasses live in django.http . class HttpResponseRedirect [source] ¶ The first argument to the constructor is required – the path to redirect\nto. This can be a fully qualified URL\n(e.g. 'https://www.yahoo.com/search/' ), an absolute path with no domain\n(e.g. '/search/' ), or even a relative path (e.g. 'search/' ). In that\nlast case, the client browser will reconstruct the full URL itself\naccording to the current path. See HttpResponse for other optional\nconstructor arguments. Note that this returns an HTTP status code 302. url ¶ This read-only attribute represents the URL the response will redirect\nto (equivalent to the Location response header). class HttpResponsePermanentRedirect [source] ¶ Like HttpResponseRedirect , but it returns a permanent redirect\n(HTTP status code 301) instead of a “found” redirect (status code 302). class HttpResponseNotModified [source] ¶ The constructor doesn’t take any arguments and no content should be added\nto this response. Use this to designate that a page hasn’t been modified\nsince the user’s last request (status code 304). class HttpResponseBadRequest [source] ¶ Acts just like HttpResponse but uses a 400 status code. class HttpResponseNotFound [source] ¶ Acts just like HttpResponse but uses a 404 status code. class HttpResponseForbidden [source] ¶ Acts just like HttpResponse but uses a 403 status code. class HttpResponseNotAllowed [source] ¶ Like HttpResponse , but uses a 405 status code. The first argument\nto the constructor is required: a list of permitted methods (e.g. ['GET', 'POST'] ). class HttpResponseGone [source] ¶ Acts just like HttpResponse but uses a 410 status code. class HttpResponseServerError [source] ¶ Acts just like HttpResponse but uses a 500 status code. Note If a custom subclass of HttpResponse implements a render method, Django will treat it as emulating a SimpleTemplateResponse , and the render method must itself return a valid response object. Custom response classes ¶ If you find yourself needing a response class that Django doesn’t provide, you\ncan create it with the help of http.HTTPStatus . For example: from http import HTTPStatus from django.http import HttpResponse class HttpResponseNoContent ( HttpResponse ): status_code = HTTPStatus . NO_CONTENT JsonResponse objects ¶ class JsonResponse ( data , encoder = DjangoJSONEncoder , safe = True , json_dumps_params = None , ** kwargs ) [source] ¶ An HttpResponse subclass that helps to create a JSON-encoded\nresponse. It inherits most behavior from its superclass with a couple\ndifferences: Its default Content-Type header is set to application/json . The first parameter, data , should be a dict instance. If the safe parameter is set to False (see below) it can be any\nJSON-serializable object. The encoder , which defaults to django.core.serializers.json.DjangoJSONEncoder , will be used to\nserialize the data. See JSON serialization for more details about this serializer. The safe boolean parameter defaults to True . If it’s set to False , any object can be passed for serialization (otherwise only dict instances are allowed). If safe is True and a non- dict object is passed as the first argument, a TypeError will be raised. The json_dumps_params parameter is a dictionary of keyword arguments\nto pass to the json.dumps() call used to generate the response. Usage ¶ Typical usage could look like: >>> from django.http import JsonResponse >>> response = JsonResponse ({ \"foo\" : \"bar\" }) >>> response . content b'{\"foo\": \"bar\"}' Serializing non-dictionary objects ¶ In order to serialize objects other than dict you must set the safe parameter to False : >>> response = JsonResponse ([ 1 , 2 , 3 ], safe = False ) Without passing safe=False , a TypeError will be raised. Note that an API based on dict objects is more extensible, flexible, and\nmakes it easier to maintain forwards compatibility. Therefore, you should avoid\nusing non-dict objects in JSON-encoded response. Warning Before the 5th edition of ECMAScript it was possible to\npoison the JavaScript Array constructor. For this reason, Django does\nnot allow passing non-dict objects to the JsonResponse constructor by default.  However, most\nmodern browsers implement ECMAScript 5 which removes this attack vector.\nTherefore it is possible to disable this security precaution. Changing the default JSON encoder ¶ If you need to use a different JSON encoder class you can pass the encoder parameter to the constructor method: >>> response = JsonResponse ( data , encoder = MyJSONEncoder ) StreamingHttpResponse objects ¶ class StreamingHttpResponse [source] ¶ The StreamingHttpResponse class is used to stream a response from\nDjango to the browser. Advanced usage StreamingHttpResponse is somewhat advanced, in that it is\nimportant to know whether you’ll be serving your application synchronously\nunder WSGI or asynchronously under ASGI, and adjust your usage\nappropriately. Please read these notes with care. An example usage of StreamingHttpResponse under WSGI is streaming\ncontent when generating the response would take too long or uses too much\nmemory. For instance, it’s useful for generating large CSV files . There are performance considerations when doing this, though. Django, under\nWSGI, is designed for short-lived requests. Streaming responses will tie a\nworker process for the entire duration of the response. This may result in poor\nperformance. Generally speaking, you would perform expensive tasks outside of the\nrequest-response cycle, rather than resorting to a streamed response. When serving under ASGI, however, a StreamingHttpResponse need not\nstop other requests from being served whilst waiting for I/O. This opens up\nthe possibility of long-lived requests for streaming content and implementing\npatterns such as long-polling, and server-sent events. Even under ASGI note, StreamingHttpResponse should only be used in\nsituations where it is absolutely required that the whole content isn’t\niterated before transferring the data to the client. Because the content can’t\nbe accessed, many middleware can’t function normally. For example the ETag and Content-Length headers can’t be generated for streaming responses. The StreamingHttpResponse is not a subclass of HttpResponse ,\nbecause it features a slightly different API. However, it is almost identical,\nwith the following notable differences: It should be given an iterator that yields bytestrings, memoryview ,\nor strings as content. When serving under WSGI, this should be a sync\niterator. When serving under ASGI, then it should be an async iterator. You cannot access its content, except by iterating the response object\nitself. This should only occur when the response is returned to the client:\nyou should not iterate the response yourself. Under WSGI the response will be iterated synchronously. Under ASGI the\nresponse will be iterated asynchronously. (This is why the iterator type must\nmatch the protocol you’re using.) To avoid a crash, an incorrect iterator type will be mapped to the correct\ntype during iteration, and a warning will be raised, but in order to do this\nthe iterator must be fully-consumed, which defeats the purpose of using a StreamingHttpResponse at all. It has no content attribute. Instead, it has a streaming_content attribute. This can be used\nin middleware to wrap the response iterable, but should not be consumed. You cannot use the file-like object tell() or write() methods.\nDoing so will raise an exception. The HttpResponseBase base class is common between HttpResponse and StreamingHttpResponse . Attributes ¶ StreamingHttpResponse. streaming_content [source] ¶ An iterator of the response content, bytestring encoded according to HttpResponse.charset . StreamingHttpResponse. status_code ¶ The HTTP status code for the response. Unless reason_phrase is explicitly set, modifying the value of status_code outside the constructor will also modify the value of reason_phrase . StreamingHttpResponse. reason_phrase ¶ The HTTP reason phrase for the response. It uses the HTTP standard’s default reason phrases. Unless explicitly set, reason_phrase is determined by the value of status_code . StreamingHttpResponse. streaming ¶ This is always True . StreamingHttpResponse. is_async ¶ Boolean indicating whether StreamingHttpResponse.streaming_content is an asynchronous iterator or not. This is useful for middleware needing to wrap StreamingHttpResponse.streaming_content . Handling disconnects ¶ New in Django 5.0. If the client disconnects during a streaming response, Django will cancel the\ncoroutine that is handling the response. If you want to clean up resources\nmanually, you can do so by catching the asyncio.CancelledError : async def streaming_response (): try : # Do some work here async for chunk in my_streaming_iterator (): yield chunk except asyncio . CancelledError : # Handle disconnect ... raise async def my_streaming_view ( request ): return StreamingHttpResponse ( streaming_response ()) This example only shows how to handle client disconnection while the response\nis streaming. If you perform long-running operations in your view before\nreturning the StreamingHttpResponse object, then you may also want to handle disconnections in the view itself. FileResponse objects ¶ class FileResponse ( open_file , as_attachment = False , filename = '' , ** kwargs ) [source] ¶ FileResponse is a subclass of StreamingHttpResponse optimized for binary files. It uses wsgi.file_wrapper if provided by the wsgi\nserver, otherwise it streams the file out in small chunks. If as_attachment=True , the Content-Disposition header is set to attachment , which asks the browser to offer the file to the user as a\ndownload. Otherwise, a Content-Disposition header with a value of inline (the browser default) will be set only if a filename is\navailable. If open_file doesn’t have a name or if the name of open_file isn’t\nappropriate, provide a custom file name using the filename parameter.\nNote that if you pass a file-like object like io.BytesIO , it’s your\ntask to seek() it before passing it to FileResponse . The Content-Length header is automatically set when it can be guessed\nfrom the content of open_file . The Content-Type header is automatically set when it can be guessed\nfrom the filename , or the name of open_file . FileResponse accepts any file-like object with binary content, for example\na file open in binary mode like so: >>> from django.http import FileResponse >>> response = FileResponse ( open ( \"myfile.png\" , \"rb\" )) The file will be closed automatically, so don’t open it with a context manager. Use under ASGI Python’s file API is synchronous. This means that the file must be fully\nconsumed in order to be served under ASGI. In order to stream a file asynchronously you need to use a third-party\npackage that provides an asynchronous file API, such as aiofiles . Methods ¶ FileResponse. set_headers ( open_file ) [source] ¶ This method is automatically called during the response initialization and\nset various headers ( Content-Length , Content-Type , and Content-Disposition ) depending on open_file . HttpResponseBase class ¶ class HttpResponseBase [source] ¶ The HttpResponseBase class is common to all Django responses.\nIt should not be used to create responses directly, but it can be\nuseful for type-checking.", "keywords": ["users", "underscores", "get_full_path", "lf", "https://example.com/bands/", "blog.example.com", "csv", "b", "default_charset", "content_params", "library", "field", "#", "www.example.com", "open_file", "serialization", "flush", "metadata", "has_header", "negotiation", "intel", "host", "copy.deepcopy", "representation", "getlist", "lines", "httpresponse", "member", "cache", "compatibility", "streaminghttpresponse.streaming_content", "dict.setdefault", "https", "payload", "httprequest.headers", "other_dict", "is_authenticated", "disconnect", "hook", "path_info", "use_x_forwarded_host", "http", "django.core.exceptions", "=", "changes", "disconnections", "download", "stream", "character", "tag", "patch_vary_headers", "httpresponsenotfound", "process", "microsoft", "httpresponseforbidden", "datetime.datetime", "mac", "multiple", "mime_type", "charset", "cancellederror", "type", "processing", "iterators", "custom", "et", "kwargs", "objects", "documentation", "server_port", "file", "root_urlconf", "work", "keyerror", "disposition", "user", "default_exception_reporter", "attribute", "yield", "states", "http_x_forwarded_for", "delitem", "size", "warning", "time", "mm", "the_beatles/?print", "streaming_content", "fromkeys", "httpstatus", "gmt", "risk", "render", "setting", "samesite='strict", "responses", "precaution", "http_accept_language", "proxies", "crash", "iterator", "logic", "simplecookie", "streaming_response", "name", "my_streaming_iterator", "httpresponsenotallowed", "parameter", "writable", "get_host", "vary_on_headers('accept", "web", "setitem", "age", "/search/", "djangojsonencoder", "get_current_site", "configurations", "excel", "manager", "readlines", "ss", "resolving", "writelines", "return", "use_x_forwarded_port", "memory", "foo", "duration", "reason_phrase", "a=2&b=3&b=5", "examples", "commonmiddleware", "sessionmiddleware", "aiofiles", "setdefault", "acts", "ecmascript", "status", "aliases", "json_dumps_params", "tree", "proxy", "url", "error", "module", "code", "classmethod", "resolvermatch", "badheadererror", "info", "behavior", "c", "i", "class", "access", "false", "django.http", "array", "default_exception_reporter_filter", "returns", "'", "javascript", "x", "attack", "request", "auser", "dict.items", "my_data", "tony", "flag", "input", "httpresponsenocontent", "*", "query", "page", "test", "urlencode", "types", "strings", "request.get_full_path", "elements", "/bands/", "subclass", "httprequest.read", "etag", ".", "http_x_bender", "pair", "usage", "querydict", "xml", "wsgi", "fileresponse", "auth_user_model", "script", "my_streaming_view", "superclass", "do_something_else", "httprequest.method", "instantiation", "mozilla/5.0", "bytestrings", "set_cookie", "with", "plain", "source", "o.", "rawpostdataexception", "pop", "salt", "encodings", "process_view", "use", "httpresponse.headers", "replacement", "environment", "casing", "chunk", "elementtree", "http_x_forwarded_server", "solution", "subclasses", "performance", "protection", "httpresponsebase", "httpresponse.charset", "nginx", "order", "multivaluedictkeyerror", "signature", "httprequest.body", "default", "original", "requestsite", "form", "samesite", "cr", "prefix", "format", "comma", "characters", "help", "current_app", "worker", "browsers", "considerations", "scheme", "domains", "attempt", "samesite='none", "combination", "csrfviewmiddleware", "template", "httpresponsegone", "header", "way", "phrase", "utf-8", "servers", "request.headers.user_agent", "quick", "10_12_6", "macintosh", "accept", "possibility", "concept", "party", "status_code", "integer", "streaminghttpresponse", "session", "o", "reports", "¶", "streaming", "bytes", "post", "parameters", "val", "encoder", "side", "content", "function", "protocol", "views", "ambiguity", "view", "control", "agent", "number", "measure", "fashion", "getitem", "values", "consumers", "spreadsheet", "string", "set_headers", "_", "httpresponse.cookies", "overview", "thing", "is_secure", "timestamp", "mime", "hh", "traffic", "defense", "location", "copy", "b'{\"foo", "version", "ways", "json", "anonymoususer", "contents", "dashes", "hyphens", "readline", "hostname", "attachment", "parser", "portion", "django", "raise_error", "rfc", "n’t", "appends", "filename", "fields", "ip", "separators", "languages", "set", "httprequest.readline", "os", "disconnection", "http_x_forwarded_host", "value", "events", "phrases", "jsonresponse", "sync", "a=1&a=2&c=3", "querydict.__getitem", "line", "querydict.copy", "pep", "data", "browser", "httpresponsepermanentredirect", "samesite='lax", "resources", "item", "strip", "build_absolute_uri", "base", "task", "patch", "wdy", "json.dumps", "get_response", "inline", "badsignature", "security", "self", "instance", "effects", "uri", "typeerror", "initialization", "handling", "simpletemplateresponse", "interface", "multipleproxymiddleware", "polling", "max_age", "timedelta", "httpresponsebadrequest", "bender", "appendlist", "wsgiscriptalias", "constructor", "asyncio", "instances", "checking", "authenticationmiddleware", "part", "agents", "object", "deployment", "domain", "couple", "myjsonencoder", "django.utils.datastructures", "httprequest", "response", "dictionary", "edition", "requests", "situations", "contrast", "keyword", "io", "csrf", "ordering", "currentsitemiddleware", "force", "variables", "the_beatles/", "root", "responsibility", "notes", "redirect", "morsel", "system", "address", "port", "apps", "setlist", "async", "signing", "items", "search/", "dict.update", "serializer", "headers", "enctype=\"multipart", "check", "tell", "patch_cache_control", "forms", "site", "bytestring", "apache", "addition", "lists", "example", "care", "paragraph.</p", "accessing", "list", "seconds", "utc", "query_string", "runserver", "newlines", "3", "default_list", "http_x_forwarded_port", "https://www.yahoo.com/search/", "strength", "bands", "vector", "read", "apis", "place", "memoryview", "element", "application", "encoding", "populating", "attributes", "vary", "title", "encounter", "differences", "mon", "asgi", "request.method", "urlconf", "contexts", "no_content", "as_attachment", "syntax", "accepts", "content_type", "httpresponse.content", "keys", "case", "boolean", "length", "popitem", "conjunction", "django.core.serializers.json", "get_port", "html", "django.utils.cache", "generators", "tuple", "server", "str", "submission", "arguments", "upload", "init", "package", "middleware", "one", "end", "is_async", "contrib", "instantiates", "standard", "bar", "setlistdefault", "next=/a%26b/", "path", "depth", "functions", "key", "handle", "music", "operations", "update", "none", "page.</p", "httpresponseredirect", "meta", "get", "patterns", "reason", "q", "alternate", "new", "dict.values", "true", "dict", "dd", "api", "parts", "get_signed_cookie", "cookies", "mode", "document", "-", "context", "cycle", "files", "import", "iteration", "defaults", "call", "chunks", "images", "information", "python", "django.core.signing", "http.cookies", "signatureexpired", "methods", "yy", "exception", "purpose", "client", "uploadedfile", "details", "wsgi.file_wrapper", "method", "server_name", "settings", "argument", "cookie", "note", "body", "state", "del", "getvalue", "tasks", "attacks", "coroutine", "text", "set_signed_cookie", "exceptions"], "type": "documentation"},
{"title": "How to use sessions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/http/sessions/", "content": "How to use sessions ¶ Django provides full support for anonymous sessions. The session framework\nlets you store and retrieve arbitrary data on a per-site-visitor basis. It\nstores data on the server side and abstracts the sending and receiving of\ncookies. Cookies contain a session ID – not the data itself (unless you’re\nusing the cookie based backend ). Enabling sessions ¶ Sessions are implemented via a piece of middleware . To enable session functionality, do the following: Edit the MIDDLEWARE setting and make sure it contains 'django.contrib.sessions.middleware.SessionMiddleware' . The default settings.py created by django-admin startproject has SessionMiddleware activated. If you don’t want to use sessions, you might as well remove the SessionMiddleware line from MIDDLEWARE and 'django.contrib.sessions' from your INSTALLED_APPS .\nIt’ll save you a small bit of overhead. Configuring the session engine ¶ By default, Django stores sessions in your database (using the model django.contrib.sessions.models.Session ). Though this is convenient, in\nsome setups it’s faster to store session data elsewhere, so Django can be\nconfigured to store session data on your filesystem or in your cache. Using database-backed sessions ¶ If you want to use a database-backed session, you need to add 'django.contrib.sessions' to your INSTALLED_APPS setting. Once you have configured your installation, run manage.py migrate to install the single database table that stores session data. Using cached sessions ¶ For better performance, you may want to use a cache-based session backend. To store session data using Django’s cache system, you’ll first need to make\nsure you’ve configured your cache; see the cache documentation for details. Warning You should only use cache-based sessions if you’re using the Memcached or\nRedis cache backend. The local-memory cache backend doesn’t retain data\nlong enough to be a good choice, and it’ll be faster to use file or\ndatabase sessions directly instead of sending everything through the file\nor database cache backends. Additionally, the local-memory cache backend is\nNOT multi-process safe, therefore probably not a good choice for production\nenvironments. If you have multiple caches defined in CACHES , Django will use the\ndefault cache. To use another cache, set SESSION_CACHE_ALIAS to the\nname of that cache. Once your cache is configured, you have to choose between a database-backed\ncache or a non-persistent cache. The cached database backend ( cached_db ) uses a write-through cache –\nsession writes are applied to both the database and cache, in that order. If\nwriting to the cache fails, the exception is handled and logged via the sessions logger , to avoid failing an\notherwise successful write operation. Changed in Django 5.1: Handling and logging of exceptions when writing to the cache was added. Session reads use the cache, or the database if the data has been evicted from\nthe cache. To use this backend, set SESSION_ENGINE to \"django.contrib.sessions.backends.cached_db\" , and follow the configuration\ninstructions for the using database-backed sessions . The cache backend ( cache ) stores session data only in your cache. This is\nfaster because it avoids database persistence, but you will have to consider\nwhat happens when cache data is evicted. Eviction can occur if the cache fills\nup or the cache server is restarted, and it will mean session data is lost,\nincluding logging out users. To use this backend, set SESSION_ENGINE to \"django.contrib.sessions.backends.cache\" . The cache backend can be made persistent by using a persistent cache, such as\nRedis with appropriate configuration. But unless your cache is definitely\nconfigured for sufficient persistence, opt for the cached database backend.\nThis avoids edge cases caused by unreliable data storage in production. Using file-based sessions ¶ To use file-based sessions, set the SESSION_ENGINE setting to \"django.contrib.sessions.backends.file\" . You might also want to set the SESSION_FILE_PATH setting (which\ndefaults to output from tempfile.gettempdir() , most likely /tmp ) to\ncontrol where Django stores session files. Be sure to check that your web\nserver has permissions to read and write to this location. Using cookie-based sessions ¶ To use cookies-based sessions, set the SESSION_ENGINE setting to \"django.contrib.sessions.backends.signed_cookies\" . The session data will be\nstored using Django’s tools for cryptographic signing and the SECRET_KEY setting. Note It’s recommended to leave the SESSION_COOKIE_HTTPONLY setting\non True to prevent access to the stored data from JavaScript. Warning The session data is signed but not encrypted When using the cookies backend the session data can be read by the client. A MAC (Message Authentication Code) is used to protect the data against\nchanges by the client, so that the session data will be invalidated when being\ntampered with. The same invalidation happens if the client storing the\ncookie (e.g. your user’s browser) can’t store all of the session cookie and\ndrops data. Even though Django compresses the data, it’s still entirely\npossible to exceed the common limit of 4096 bytes per cookie. No freshness guarantee Note also that while the MAC can guarantee the authenticity of the data\n(that it was generated by your site, and not someone else), and the\nintegrity of the data (that it is all there and correct), it cannot\nguarantee freshness i.e. that you are being sent back the last thing you\nsent to the client. This means that for some uses of session data, the\ncookie backend might open you up to replay attacks . Unlike other session\nbackends which keep a server-side record of each session and invalidate it\nwhen a user logs out, cookie-based sessions are not invalidated when a user\nlogs out. Thus if an attacker steals a user’s cookie, they can use that\ncookie to login as that user even if the user logs out. Cookies will only\nbe detected as ‘stale’ if they are older than your SESSION_COOKIE_AGE . Performance Finally, the size of a cookie can have an impact on the speed of your site. Using sessions in views ¶ When SessionMiddleware is activated, each HttpRequest object – the first argument to any Django view function – will have a session attribute, which is a dictionary-like object. You can read it and write to request.session at any point in your view.\nYou can edit it multiple times. class backends.base. SessionBase ¶ This is the base class for all session objects. It has the following\nstandard dictionary methods: __getitem__ ( key ) ¶ Example: fav_color = request.session['fav_color'] __setitem__ ( key , value ) ¶ Example: request.session['fav_color'] = 'blue' __delitem__ ( key ) ¶ Example: del request.session['fav_color'] . This raises KeyError if the given key isn’t already in the session. __contains__ ( key ) ¶ Example: 'fav_color' in request.session get ( key , default = None ) ¶ aget ( key , default = None ) ¶ Asynchronous version : aget() Example: fav_color = request.session.get('fav_color', 'red') Changed in Django 5.1: aget() function was added. aset ( key , value ) ¶ New in Django 5.1. Example: await request.session.aset('fav_color', 'red') update ( dict ) ¶ aupdate ( dict ) ¶ Asynchronous version : aupdate() Example: request.session.update({'fav_color': 'red'}) Changed in Django 5.1: aupdate() function was added. pop ( key , default = __not_given ) ¶ apop ( key , default = __not_given ) ¶ Asynchronous version : apop() Example: fav_color = request.session.pop('fav_color', 'blue') Changed in Django 5.1: apop() function was added. keys () ¶ akeys () ¶ Asynchronous version : akeys() Changed in Django 5.1: akeys() function was added. values () ¶ avalues () ¶ Asynchronous version : avalues() Changed in Django 5.1: avalues() function was added. has_key ( key ) ¶ ahas_key ( key ) ¶ Asynchronous version : ahas_key() Changed in Django 5.1: ahas_key() function was added. items () ¶ aitems () ¶ Asynchronous version : aitems() Changed in Django 5.1: aitems() function was added. setdefault () ¶ asetdefault () ¶ Asynchronous version : asetdefault() Changed in Django 5.1: asetdefault() function was added. clear () ¶ It also has these methods: flush () ¶ aflush () ¶ Asynchronous version : aflush() Deletes the current session data from the session and deletes the session\ncookie. This is used if you want to ensure that the previous session data\ncan’t be accessed again from the user’s browser (for example, the django.contrib.auth.logout() function calls it). Changed in Django 5.1: aflush() function was added. set_test_cookie () ¶ aset_test_cookie () ¶ Asynchronous version : aset_test_cookie() Sets a test cookie to determine whether the user’s browser supports\ncookies. Due to the way cookies work, you won’t be able to test this\nuntil the user’s next page request. See Setting test cookies below for\nmore information. Changed in Django 5.1: aset_test_cookie() function was added. test_cookie_worked () ¶ atest_cookie_worked () ¶ Asynchronous version : atest_cookie_worked() Returns either True or False , depending on whether the user’s\nbrowser accepted the test cookie. Due to the way cookies work, you’ll\nhave to call set_test_cookie() or aset_test_cookie() on a\nprevious, separate page request.\nSee Setting test cookies below for more information. Changed in Django 5.1: atest_cookie_worked() function was added. delete_test_cookie () ¶ adelete_test_cookie () ¶ Asynchronous version : adelete_test_cookie() Deletes the test cookie. Use this to clean up after yourself. Changed in Django 5.1: adelete_test_cookie() function was added. get_session_cookie_age () ¶ Returns the value of the setting SESSION_COOKIE_AGE . This can\nbe overridden in a custom session backend. set_expiry ( value ) ¶ aset_expiry ( value ) ¶ Asynchronous version : aset_expiry() Sets the expiration time for the session. You can pass a number of\ndifferent values: If value is an integer, the session will expire after that\nmany seconds of inactivity. For example, calling request.session.set_expiry(300) would make the session expire\nin 5 minutes. If value is a datetime or timedelta object, the session\nwill expire at that specific date/time. If value is 0 , the user’s session cookie will expire\nwhen the user’s web browser is closed. If value is None , the session reverts to using the global\nsession expiry policy. Reading a session is not considered activity for expiration\npurposes. Session expiration is computed from the last time the\nsession was modified . Changed in Django 5.1: aset_expiry() function was added. get_expiry_age () ¶ aget_expiry_age () ¶ Asynchronous version : aget_expiry_age() Returns the number of seconds until this session expires. For sessions\nwith no custom expiration (or those set to expire at browser close), this\nwill equal SESSION_COOKIE_AGE . This function accepts two optional keyword arguments: modification : last modification of the session, as a datetime object. Defaults to the current time. expiry : expiry information for the session, as a datetime object, an int (in seconds), or None . Defaults to the value stored in the session by set_expiry() / aset_expiry() , if there is one, or None . Note This method is used by session backends to determine the session expiry\nage in seconds when saving the session. It is not really intended for\nusage outside of that context. In particular, while it is possible to determine the remaining\nlifetime of a session just when you have the correct modification value and the expiry is set as a datetime object, where you do have the modification value, it is more\nstraight-forward to calculate the expiry by-hand: expires_at = modification + timedelta ( seconds = settings . SESSION_COOKIE_AGE ) Changed in Django 5.1: aget_expiry_age() function was added. get_expiry_date () ¶ aget_expiry_date () ¶ Asynchronous version : aget_expiry_date() Returns the date this session will expire. For sessions with no custom\nexpiration (or those set to expire at browser close), this will equal the\ndate SESSION_COOKIE_AGE seconds from now. This function accepts the same keyword arguments as get_expiry_age() , and similar notes on usage apply. Changed in Django 5.1: aget_expiry_date() function was added. get_expire_at_browser_close () ¶ aget_expire_at_browser_close () ¶ Asynchronous version : aget_expire_at_browser_close() Returns either True or False , depending on whether the user’s\nsession cookie will expire when the user’s web browser is closed. Changed in Django 5.1: aget_expire_at_browser_close() function was added. clear_expired () ¶ aclear_expired () ¶ Asynchronous version : aclear_expired() Removes expired sessions from the session store. This class method is\ncalled by clearsessions . Changed in Django 5.1: aclear_expired() function was added. cycle_key () ¶ acycle_key () ¶ Asynchronous version : acycle_key() Creates a new session key while retaining the current session data. django.contrib.auth.login() calls this method to mitigate against\nsession fixation. Changed in Django 5.1: acycle_key() function was added. Session serialization ¶ By default, Django serializes session data using JSON. You can use the SESSION_SERIALIZER setting to customize the session serialization\nformat. Even with the caveats described in Write your own serializer , we highly\nrecommend sticking with JSON serialization especially if you are using the\ncookie backend . For example, here’s an attack scenario if you use pickle to serialize\nsession data. If you’re using the signed cookie session backend and SECRET_KEY (or any key of SECRET_KEY_FALLBACKS ) is known by an attacker (there isn’t an\ninherent vulnerability in Django that would cause it to leak), the attacker\ncould insert a string into their session which, when unpickled, executes\narbitrary code on the server. The technique for doing so is simple and easily\navailable on the internet. Although the cookie session storage signs the\ncookie-stored data to prevent tampering, a SECRET_KEY leak\nimmediately escalates to a remote code execution vulnerability. Bundled serializers ¶ class serializers. JSONSerializer ¶ A wrapper around the JSON serializer from django.core.signing . Can\nonly serialize basic data types. In addition, as JSON supports only string keys, note that using non-string\nkeys in request.session won’t work as expected: >>> # initial assignment >>> request . session [ 0 ] = \"bar\" >>> # subsequent requests following serialization & deserialization >>> # of session data >>> request . session [ 0 ] # KeyError >>> request . session [ \"0\" ] 'bar' Similarly, data that can’t be encoded in JSON, such as non-UTF8 bytes like '\\xd9' (which raises UnicodeDecodeError ), can’t be stored. See the Write your own serializer section for more details on limitations\nof JSON serialization. Write your own serializer ¶ Note that the JSONSerializer cannot handle arbitrary Python data types. As is often the case, there is a\ntrade-off between convenience and security. If you wish to store more advanced\ndata types including datetime and Decimal in JSON backed sessions, you\nwill need to write a custom serializer (or convert such values to a JSON\nserializable object before storing them in request.session ). While\nserializing these values is often straightforward\n( DjangoJSONEncoder may be helpful),\nwriting a decoder that can reliably get back the same thing that you put in is\nmore fragile. For example, you run the risk of returning a datetime that\nwas actually a string that just happened to be in the same format chosen for datetime s). Your serializer class must implement two methods, dumps(self, obj) and loads(self, data) , to serialize and deserialize\nthe dictionary of session data, respectively. Session object guidelines ¶ Use normal Python strings as dictionary keys on request.session . This\nis more of a convention than a hard-and-fast rule. Session dictionary keys that begin with an underscore are reserved for\ninternal use by Django. Don’t override request.session with a new object, and don’t access or\nset its attributes. Use it like a Python dictionary. Examples ¶ This simplistic view sets a has_commented variable to True after a user\nposts a comment. It doesn’t let a user post a comment more than once: def post_comment ( request , new_comment ): if request . session . get ( \"has_commented\" , False ): return HttpResponse ( \"You've already commented.\" ) c = comments . Comment ( comment = new_comment ) c . save () request . session [ \"has_commented\" ] = True return HttpResponse ( \"Thanks for your comment!\" ) This simplistic view logs in a “member” of the site: def login ( request ): m = Member . objects . get ( username = request . POST [ \"username\" ]) if m . check_password ( request . POST [ \"password\" ]): request . session [ \"member_id\" ] = m . id return HttpResponse ( \"You're logged in.\" ) else : return HttpResponse ( \"Your username and password didn't match.\" ) …And this one logs a member out, according to login() above: def logout ( request ): try : del request . session [ \"member_id\" ] except KeyError : pass return HttpResponse ( \"You're logged out.\" ) The standard django.contrib.auth.logout() function actually does a bit\nmore than this to prevent inadvertent data leakage. It calls the flush() method of request.session .\nWe are using this example as a demonstration of how to work with session\nobjects, not as a full logout() implementation. Setting test cookies ¶ As a convenience, Django provides a way to test whether the user’s browser\naccepts cookies. Call the set_test_cookie() method of request.session in a view, and call test_cookie_worked() in a subsequent view –\nnot in the same view call. This awkward split between set_test_cookie() and test_cookie_worked() is necessary due to the way cookies work. When you set a cookie, you can’t\nactually tell whether a browser accepted it until the browser’s next request. It’s good practice to use delete_test_cookie() to clean up after\nyourself. Do this after you’ve verified that the test cookie worked. Here’s a typical usage example: from django.http import HttpResponse from django.shortcuts import render def login ( request ): if request . method == \"POST\" : if request . session . test_cookie_worked (): request . session . delete_test_cookie () return HttpResponse ( \"You're logged in.\" ) else : return HttpResponse ( \"Please enable cookies and try again.\" ) request . session . set_test_cookie () return render ( request , \"foo/login_form.html\" ) Changed in Django 5.1: Support for setting test cookies in asynchronous view functions was added. Using sessions out of views ¶ Note The examples in this section import the SessionStore object directly\nfrom the django.contrib.sessions.backends.db backend. In your own code,\nyou should consider importing SessionStore from the session engine\ndesignated by SESSION_ENGINE , as below: >>> from importlib import import_module >>> from django.conf import settings >>> SessionStore = import_module ( settings . SESSION_ENGINE ) . SessionStore An API is available to manipulate session data outside of a view: >>> from django.contrib.sessions.backends.db import SessionStore >>> s = SessionStore () >>> # stored as seconds since epoch since datetimes are not serializable in JSON. >>> s [ \"last_login\" ] = 1376587691 >>> s . create () >>> s . session_key '2b1189a188b44ad18c35e113ac6ceead' >>> s = SessionStore ( session_key = \"2b1189a188b44ad18c35e113ac6ceead\" ) >>> s [ \"last_login\" ] 1376587691 SessionStore.create() is designed to create a new session (i.e. one not\nloaded from the session store and with session_key=None ). save() is\ndesigned to save an existing session (i.e. one loaded from the session store).\nCalling save() on a new session may also work but has a small chance of\ngenerating a session_key that collides with an existing one. create() calls save() and loops until an unused session_key is generated. If you’re using the django.contrib.sessions.backends.db backend, each\nsession is a normal Django model. The Session model is defined in django/contrib/sessions/models.py . Because it’s a normal model, you can\naccess sessions using the normal Django database API: >>> from django.contrib.sessions.models import Session >>> s = Session . objects . get ( pk = \"2b1189a188b44ad18c35e113ac6ceead\" ) >>> s . expire_date datetime.datetime(2005, 8, 20, 13, 35, 12) Note that you’ll need to call get_decoded() to get the session\ndictionary. This is necessary because the dictionary is stored in an encoded\nformat: >>> s . session_data 'KGRwMQpTJ19hdXRoX3VzZXJfaWQnCnAyCkkxCnMuMTExY2ZjODI2Yj...' >>> s . get_decoded () {'user_id': 42} When sessions are saved ¶ By default, Django only saves to the session database when the session has been\nmodified – that is if any of its dictionary values have been assigned or\ndeleted: # Session is modified. request . session [ \"foo\" ] = \"bar\" # Session is modified. del request . session [ \"foo\" ] # Session is modified. request . session [ \"foo\" ] = {} # Gotcha: Session is NOT modified, because this alters # request.session['foo'] instead of request.session. request . session [ \"foo\" ][ \"bar\" ] = \"baz\" In the last case of the above example, we can tell the session object\nexplicitly that it has been modified by setting the modified attribute on\nthe session object: request . session . modified = True To change this default behavior, set the SESSION_SAVE_EVERY_REQUEST setting to True . When set to True , Django will save the session to the\ndatabase on every single request. Note that the session cookie is only sent when a session has been created or\nmodified. If SESSION_SAVE_EVERY_REQUEST is True , the session\ncookie will be sent on every request. Similarly, the expires part of a session cookie is updated each time the\nsession cookie is sent. The session is not saved if the response’s status code is 500. Browser-length sessions vs. persistent sessions ¶ You can control whether the session framework uses browser-length sessions vs.\npersistent sessions with the SESSION_EXPIRE_AT_BROWSER_CLOSE setting. By default, SESSION_EXPIRE_AT_BROWSER_CLOSE is set to False ,\nwhich means session cookies will be stored in users’ browsers for as long as SESSION_COOKIE_AGE . Use this if you don’t want people to have to\nlog in every time they open a browser. If SESSION_EXPIRE_AT_BROWSER_CLOSE is set to True , Django will\nuse browser-length cookies – cookies that expire as soon as the user closes\ntheir browser. Use this if you want people to have to log in every time they\nopen a browser. This setting is a global default and can be overwritten at a per-session level\nby explicitly calling the set_expiry() method\nof request.session as described above in using sessions in views . Note Some browsers (Chrome, for example) provide settings that allow users to\ncontinue browsing sessions after closing and reopening the browser. In\nsome cases, this can interfere with the SESSION_EXPIRE_AT_BROWSER_CLOSE setting and prevent sessions\nfrom expiring on browser close. Please be aware of this while testing\nDjango applications which have the SESSION_EXPIRE_AT_BROWSER_CLOSE setting enabled. Clearing the session store ¶ As users create new sessions on your website, session data can accumulate in\nyour session store. If you’re using the database backend, the django_session database table will grow. If you’re using the file backend,\nyour temporary directory will contain an increasing number of files. To understand this problem, consider what happens with the database backend.\nWhen a user logs in, Django adds a row to the django_session database\ntable. Django updates this row each time the session data changes. If the user\nlogs out manually, Django deletes the row. But if the user does not log out,\nthe row never gets deleted. A similar process happens with the file backend. Django does not provide automatic purging of expired sessions. Therefore,\nit’s your job to purge expired sessions on a regular basis. Django provides a\nclean-up management command for this purpose: clearsessions . It’s\nrecommended to call this command on a regular basis, for example as a daily\ncron job. Note that the cache backend isn’t vulnerable to this problem, because caches\nautomatically delete stale data. Neither is the cookie backend, because the\nsession data is stored by the users’ browsers. Settings ¶ A few Django settings give you control over session\nbehavior: SESSION_CACHE_ALIAS SESSION_COOKIE_AGE SESSION_COOKIE_DOMAIN SESSION_COOKIE_HTTPONLY SESSION_COOKIE_NAME SESSION_COOKIE_PATH SESSION_COOKIE_SAMESITE SESSION_COOKIE_SECURE SESSION_ENGINE SESSION_EXPIRE_AT_BROWSER_CLOSE SESSION_FILE_PATH SESSION_SAVE_EVERY_REQUEST SESSION_SERIALIZER Session security ¶ Subdomains within a site are able to set cookies on the client for the whole\ndomain. This makes session fixation possible if cookies are permitted from\nsubdomains not controlled by trusted users. For example, an attacker could log into good.example.com and get a valid\nsession for their account. If the attacker has control over bad.example.com ,\nthey can use it to send their session key to you since a subdomain is permitted\nto set cookies on *.example.com . When you visit good.example.com ,\nyou’ll be logged in as the attacker and might inadvertently enter your\nsensitive personal data (e.g. credit card info) into the attacker’s account. Another possible attack would be if good.example.com sets its SESSION_COOKIE_DOMAIN to \"example.com\" which would cause\nsession cookies from that site to be sent to bad.example.com . Technical details ¶ The session dictionary accepts any json serializable value when using JSONSerializer . Session data is stored in a database table named django_session . Django only sends a cookie if it needs to. If you don’t set any session\ndata, it won’t send a session cookie. The SessionStore object ¶ When working with sessions internally, Django uses a session store object from\nthe corresponding session engine. By convention, the session store object class\nis named SessionStore and is located in the module designated by SESSION_ENGINE . All SessionStore subclasses available in Django implement the following\ndata manipulation methods: exists() create() save() delete() load() clear_expired() An asynchronous interface for these methods is provided by wrapping them with sync_to_async() . They can be implemented directly if an async-native\nimplementation is available: aexists() acreate() asave() adelete() aload() aclear_expired() In order to build a custom session engine or to customize an existing one, you\nmay create a new class inheriting from SessionBase or\nany other existing SessionStore class. You can extend the session engines, but doing so with database-backed session\nengines generally requires some extra effort (see the next section for\ndetails). Changed in Django 5.1: aexists() , acreate() , asave() , adelete() , aload() , and aclear_expired() methods were added. Extending database-backed session engines ¶ Creating a custom database-backed session engine built upon those included in\nDjango (namely db and cached_db ) may be done by inheriting AbstractBaseSession and either SessionStore class. AbstractBaseSession and BaseSessionManager are importable from django.contrib.sessions.base_session so that they can be imported without\nincluding django.contrib.sessions in INSTALLED_APPS . class base_session. AbstractBaseSession ¶ The abstract base session model. session_key ¶ Primary key. The field itself may contain up to 40 characters. The\ncurrent implementation generates a 32-character string (a random\nsequence of digits and lowercase ASCII letters). session_data ¶ A string containing an encoded and serialized session dictionary. expire_date ¶ A datetime designating when the session expires. Expired sessions are not available to a user, however, they may still\nbe stored in the database until the clearsessions management\ncommand is run. classmethod get_session_store_class () ¶ Returns a session store class to be used with this session model. get_decoded () ¶ Returns decoded session data. Decoding is performed by the session store class. You can also customize the model manager by subclassing BaseSessionManager : class base_session. BaseSessionManager ¶ encode ( session_dict ) ¶ Returns the given session dictionary serialized and encoded as a string. Encoding is performed by the session store class tied to a model class. save ( session_key , session_dict , expire_date ) ¶ Saves session data for a provided session key, or deletes the session\nin case the data is empty. Customization of SessionStore classes is achieved by overriding methods\nand properties described below: class backends.db. SessionStore ¶ Implements database-backed session store. classmethod get_model_class () ¶ Override this method to return a custom session model if you need one. create_model_instance ( data ) ¶ Returns a new instance of the session model object, which represents\nthe current session state. Overriding this method provides the ability to modify session model\ndata before it’s saved to database. class backends.cached_db. SessionStore ¶ Implements cached database-backed session store. cache_key_prefix ¶ A prefix added to a session key to build a cache key string. Example ¶ The example below shows a custom database-backed session engine that includes\nan additional database column to store an account ID (thus providing an option\nto query the database for all active sessions for an account): from django.contrib.sessions.backends.db import SessionStore as DBStore from django.contrib.sessions.base_session import AbstractBaseSession from django.db import models class CustomSession ( AbstractBaseSession ): account_id = models . IntegerField ( null = True , db_index = True ) @classmethod def get_session_store_class ( cls ): return SessionStore class SessionStore ( DBStore ): @classmethod def get_model_class ( cls ): return CustomSession def create_model_instance ( self , data ): obj = super () . create_model_instance ( data ) try : account_id = int ( data . get ( \"_auth_user_id\" )) except ( ValueError , TypeError ): account_id = None obj . account_id = account_id return obj If you are migrating from the Django’s built-in cached_db session store to\na custom one based on cached_db , you should override the cache key prefix\nin order to prevent a namespace clash: class SessionStore ( CachedDBStore ): cache_key_prefix = \"mysessions.custom_cached_db_backend\" # ... Session IDs in URLs ¶ The Django sessions framework is entirely, and solely, cookie-based. It does\nnot fall back to putting session IDs in URLs as a last resort, as PHP does.\nThis is an intentional design decision. Not only does that behavior make URLs\nugly, it makes your site vulnerable to session-ID theft via the “Referer”\nheader.", "keywords": ["users", "basesessionmanager", "django.contrib.sessions.backends.cached_db", "integerfield", "storage", "login", "demonstration", "aset_expiry", "abstractbasesession", "activity", "field", "#", "receiving", "m", "record", "serialization", "flush", "setups", "stores", "httpresponse", "member", "cache", "clearsessions", "cached_db", "loads(self", "session_file_path", "get_session_store_class", "django.contrib.sessions.backends.db", "ids", "decoder", "theft", "changes", "=", "engine", "kgrwmqptj19hdxrox3vzzxjfawqncnayckkxcnmumtexy2zjodi2yj", "message", "installation", "session_serializer", "character", "letters", "session_key", "filesystem", "jsonserializer", "php", "mysessions.custom_cached_db_backend", "process", "memcached", "choice", "mac", "session_cookie_domain", "django.contrib.sessions.base_session", "atest_cookie_worked", "serializers", "calls", "custom", "people", "objects", "documentation", "write", "file", "customization", "guarantee", "keyerror", "user", "sending", "cases", "attribute", "acycle_key", "pickle", "test_cookie_worked", "delitem", "size", "expire_date", "resort", "time", "expiration", "basis", "risk", "date", "save", "thanks", "render", "setting", ".example.com", "purposes", "account", "aload", "request.session", "password", "post_comment", "name", "trade", "session_cookie_name", "rule", "execution", "leak", "impact", "backends", "setitem", "web", "age", "aitems", "modification", "djangojsonencoder", "manager", "visitor", "uses", "piece", "return", "encode", "applications", "memory", "eviction", "akeys", "foo", "environments", "get_model_class", "avalues", "edge", "session_dict", "examples", "/tmp", "store", "sessionmiddleware", "setdefault", "username", "status", "wrapper", "guidelines", "module", "code", "get_session_cookie_age", "subdomains", "classmethod", "invalidation", "false", "behavior", "c", "access", "class", "info", "returns", "javascript", "attack", "session_engine", "session_cookie_samesite", "request", "database", "close", "*", "page", "test", "migrate", "logout", "types", "strings", "adelete", "clash", "request.session.set_expiry(300", "usage", "configuration", "ascii", "limit", "effort", "aset", "django.contrib.auth.login", "expires_at", "limitations", "section", "sessionstore.create", "aget_expiry_date", "set_expiry", "sequence", "pop", "card", "underscore", "aget", "use", "manipulation", "engines", "django.contrib.sessions.middleware", "performance", "django.contrib.sessions.backends.signed_cookies", "django.contrib.auth.logout", "aupdate", "operation", "order", "default", "tempfile.gettempdir", "comment", "prefix", "option", "properties", "format", "classes", "characters", "2b1189a188b44ad18c35e113ac6ceead", "django.contrib.sessions.backends.cache", "convention", "account_id", "browsers", "convenience", "set_test_cookie", "request.session.pop('fav_color", "last_login", "caveats", "django_session", "authenticity", "header", "way", "session_expire_at_browser_close", "internet", "comments", "user_id", "fav_color", "credit", "good.example.com", "integer", "session", "¶", "bytes", "command", "id", "post", "int", "side", "inactivity", "primary", "function", "dbstore", "views", "integrity", "view", "fixation", "django.contrib.sessions", "control", "number", "permissions", "expiry", "def", "point", "getitem", "datetimes", "designating", "values", "backends.base", "secret_key_fallbacks", "deserialization", "session_cookie_age", "string", "loops", "_", "cls", "split", "thing", "hand", "table", "location", "subdomain", "models", "version", "scenario", "level", "json", "get_expiry_date", "session_data", "delete_test_cookie", "namespace", "django", "session_cookie_httponly", "vulnerability", "n’t", "sessionbase", "import_module", "purging", "override", "apop", "db", "practice", "value", "line", "bit", "django.shortcuts", "policy", "data", "browser", "implementation", "datetime", "lifetime", "base", "backend", "\\xd9", "tampering", "security", "db_index", "self", "get_expire_at_browser_close", "instance", "acreate", "typeerror", "speed", "aexists", "interface", "cron", "functionality", "redis", "timedelta", "digits", "writes", "gotcha", "request.session['foo", "customsession", "inheriting", "installed_apps", "part", "object", "load", "domain", "valueerror", "httprequest", "response", "management", "off", "website", "instructions", "dictionary", "requests", "chance", "keyword", "s", "base_session", "django.contrib.sessions.models", "notes", "obj", "attacker", "system", "overhead", "sessionstore", "signing", "items", "production", "serializer", "decimal", "session_cookie_path", "site", "sync_to_async", "referer", "addition", "example", "cache_key_prefix", "column", "request.session.update({'fav_color", "freshness", "minutes", "seconds", "epoch", "session_save_every_request", "request.session.aset('fav_color", "model", "variable", "ahas_key", "encoding", "request.session['fav_color", "attributes", "aget_expiry_age", "cacheddbstore", "ability", "member_id", "keys", "case", "length", "authentication", "assignment", "null", "technique", "unicodedecodeerror", "job", "implements", "server", "apply", "arguments", "asetdefault", "session_cache_alias", "middleware", "one", "removes", "new_comment", "contrib", "importlib", "startproject", "secret_key", "decision", "bar", "request.session.get('fav_color", "functions", "key", "chrome", "update", "none", "problem", "datetime.datetime(2005", "):", "get", "session_cookie_secure", "logging", "framework", "leakage", "caches", "new", "true", "urls", "api", "sessions", "support", "cookies", "replay", "context", "create_model_instance", "files", "import", "d", "backends.cached_db", "directory", "defaults", "call", "pk", "aflush", "information", "row", "python", "django.core.signing", "methods", "aset_test_cookie", "times", "exception", "get_expiry_age", "purpose", "client", "@classmethod", "details", "method", "persistence", "settings", "argument", "cookie", "note", "del", "state", "attacks", "tools", "adelete_test_cookie", "design", "exceptions"], "type": "documentation"},
{"title": "Admin actions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/admin/actions/", "content": "Admin actions ¶ The basic workflow of Django’s admin is, in a nutshell, “select an object,\nthen change it.” This works well for a majority of use cases. However, if you\nneed to make the same change to many objects at once, this workflow can be\nquite tedious. In these cases, Django’s admin lets you write and register “actions” –\nfunctions that get called with a list of objects selected on the change list\npage. If you look at any change list in the admin, you’ll see this feature in\naction; Django ships with a “delete selected objects” action available to all\nmodels. For example, here’s the user module from Django’s built-in django.contrib.auth app: Warning The “delete selected objects” action uses QuerySet.delete() for efficiency reasons, which\nhas an important caveat: your model’s delete() method will not be\ncalled. If you wish to override this behavior, you can override ModelAdmin.delete_queryset() or write a custom action which does\ndeletion in your preferred manner – for example, by calling Model.delete() for each of the selected items. For more background on bulk deletion, see the documentation on object\ndeletion . Read on to find out how to add your own actions to this list. Writing actions ¶ The easiest way to explain actions is by example, so let’s dive in. A common use case for admin actions is the bulk updating of a model. Imagine a\nnews application with an Article model: from django.db import models STATUS_CHOICES = { \"d\" : \"Draft\" , \"p\" : \"Published\" , \"w\" : \"Withdrawn\" , } class Article ( models . Model ): title = models . CharField ( max_length = 100 ) body = models . TextField () status = models . CharField ( max_length = 1 , choices = STATUS_CHOICES ) def __str__ ( self ): return self . title A common task we might perform with a model like this is to update an\narticle’s status from “draft” to “published”. We could easily do this in the\nadmin one article at a time, but if we wanted to bulk-publish a group of\narticles, it’d be tedious. So, let’s write an action that lets us change an\narticle’s status to “published.” Writing action functions ¶ First, we’ll need to write a function that gets called when the action is\ntriggered from the admin. Action functions are regular functions that take\nthree arguments: The current ModelAdmin An HttpRequest representing the current request, A QuerySet containing the set of\nobjects selected by the user. Our publish-these-articles function won’t need the ModelAdmin or the\nrequest object, but we will use the queryset: def make_published ( modeladmin , request , queryset ): queryset . update ( status = \"p\" ) Note For the best performance, we’re using the queryset’s update method . Other types of actions might need to deal\nwith each object individually; in these cases we’d iterate over the\nqueryset: for obj in queryset : do_something_with ( obj ) That’s actually all there is to writing an action! However, we’ll take one\nmore optional-but-useful step and give the action a “nice” title in the admin.\nBy default, this action would appear in the action list as “Make published” –\nthe function name, with underscores replaced by spaces. That’s fine, but we\ncan provide a better, more human-friendly name by using the action() decorator on the make_published function: from django.contrib import admin ... @admin . action ( description = \"Mark selected stories as published\" ) def make_published ( modeladmin , request , queryset ): queryset . update ( status = \"p\" ) Note This might look familiar; the admin’s list_display option uses a similar\ntechnique with the display() decorator to\nprovide human-readable descriptions for callback functions registered\nthere, too. Adding actions to the ModelAdmin ¶ Next, we’ll need to inform our ModelAdmin of the action. This works\njust like any other configuration option. So, the complete admin.py with\nthe action and its registration would look like: from django.contrib import admin from myapp.models import Article @admin . action ( description = \"Mark selected stories as published\" ) def make_published ( modeladmin , request , queryset ): queryset . update ( status = \"p\" ) class ArticleAdmin ( admin . ModelAdmin ): list_display = [ \"title\" , \"status\" ] ordering = [ \"title\" ] actions = [ make_published ] admin . site . register ( Article , ArticleAdmin ) That code will give us an admin change list that looks something like this: That’s really all there is to it! If you’re itching to write your own actions,\nyou now know enough to get started. The rest of this document covers more\nadvanced techniques. Handling errors in actions ¶ If there are foreseeable error conditions that may occur while running your\naction, you should gracefully inform the user of the problem. This means\nhandling exceptions and using django.contrib.admin.ModelAdmin.message_user() to display a user friendly\ndescription of the problem in the response. Advanced action techniques ¶ There’s a couple of extra options and possibilities you can exploit for more\nadvanced options. Actions as ModelAdmin methods ¶ The example above shows the make_published action defined as a function.\nThat’s perfectly fine, but it’s not perfect from a code design point of view:\nsince the action is tightly coupled to the Article object, it makes sense\nto hook the action to the ArticleAdmin object itself. You can do it like this: class ArticleAdmin ( admin . ModelAdmin ): ... actions = [ \"make_published\" ] @admin . action ( description = \"Mark selected stories as published\" ) def make_published ( self , request , queryset ): queryset . update ( status = \"p\" ) Notice first that we’ve moved make_published into a method and renamed the modeladmin parameter to self , and second that we’ve now put the string 'make_published' in actions instead of a direct function reference. This\ntells the ModelAdmin to look up the action as a method. Defining actions as methods gives the action more idiomatic access to the ModelAdmin itself, allowing the action to call any of the methods\nprovided by the admin. For example, we can use self to flash a message to the user informing them\nthat the action was successful: from django.contrib import messages from django.utils.translation import ngettext class ArticleAdmin ( admin . ModelAdmin ): ... def make_published ( self , request , queryset ): updated = queryset . update ( status = \"p\" ) self . message_user ( request , ngettext ( \" %d story was successfully marked as published.\" , \" %d stories were successfully marked as published.\" , updated , ) % updated , messages . SUCCESS , ) This make the action match what the admin itself does after successfully\nperforming an action: Actions that provide intermediate pages ¶ By default, after an action is performed the user is redirected back to the\noriginal change list page. However, some actions, especially more complex ones,\nwill need to return intermediate pages. For example, the built-in delete action\nasks for confirmation before deleting the selected objects. To provide an intermediary page, return an HttpResponse (or subclass) from your action. For example, you might write an export function\nthat uses Django’s serialization functions to\ndump some selected objects as JSON: from django.core import serializers from django.http import HttpResponse def export_as_json ( modeladmin , request , queryset ): response = HttpResponse ( content_type = \"application/json\" ) serializers . serialize ( \"json\" , queryset , stream = response ) return response Generally, something like the above isn’t considered a great idea. Most of the\ntime, the best practice will be to return an HttpResponseRedirect and redirect the user to a view\nyou’ve written, passing the list of selected objects in the GET query string.\nThis allows you to provide complex interaction logic on the intermediary\npages. For example, if you wanted to provide a more complete export function,\nyou’d want to let the user choose a format, and possibly a list of fields to\ninclude in the export. The best thing to do would be to write a small action\nthat redirects to your custom export view: from django.contrib.contenttypes.models import ContentType from django.http import HttpResponseRedirect def export_selected_objects ( modeladmin , request , queryset ): selected = queryset . values_list ( \"pk\" , flat = True ) ct = ContentType . objects . get_for_model ( queryset . model ) return HttpResponseRedirect ( \"/export/?ct= %s &ids= %s \" % ( ct . pk , \",\" . join ( str ( pk ) for pk in selected ), ) ) As you can see, the action is rather short; all the complex logic would belong\nin your export view. This would need to deal with objects of any type, hence\nthe business with the ContentType . Writing this view is left as an exercise to the reader. Making actions available site-wide ¶ AdminSite. add_action ( action , name = None ) [source] ¶ Some actions are best if they’re made available to any object in the admin\nsite – the export action defined above would be a good candidate. You can\nmake an action globally available using AdminSite.add_action() . For\nexample: from django.contrib import admin admin . site . add_action ( export_selected_objects ) This makes the export_selected_objects action globally available as an\naction named “export_selected_objects”. You can explicitly give the action\na name – good if you later want to programmatically remove the action – by passing a second argument to AdminSite.add_action() : admin . site . add_action ( export_selected_objects , \"export_selected\" ) Disabling actions ¶ Sometimes you need to disable certain actions – especially those registered site-wide – for particular objects.\nThere’s a few ways you can disable actions: Disabling a site-wide action ¶ AdminSite. disable_action ( name ) [source] ¶ If you need to disable a site-wide action you can\ncall AdminSite.disable_action() . For example, you can use this method to remove the built-in “delete selected\nobjects” action: admin . site . disable_action ( \"delete_selected\" ) Once you’ve done the above, that action will no longer be available\nsite-wide. If, however, you need to reenable a globally-disabled action for one\nparticular model, list it explicitly in your ModelAdmin.actions list: # Globally disable delete selected admin . site . disable_action ( \"delete_selected\" ) # This ModelAdmin will not have delete_selected available class SomeModelAdmin ( admin . ModelAdmin ): actions = [ \"some_other_action\" ] ... # This one will class AnotherModelAdmin ( admin . ModelAdmin ): actions = [ \"delete_selected\" , \"a_third_action\" ] ... Disabling all actions for a particular ModelAdmin ¶ If you want no bulk actions available for a given ModelAdmin , set ModelAdmin.actions to None : class MyModelAdmin ( admin . ModelAdmin ): actions = None This tells the ModelAdmin to not display or allow any actions,\nincluding any site-wide actions . Conditionally enabling or disabling actions ¶ ModelAdmin. get_actions ( request ) [source] ¶ Finally, you can conditionally enable or disable actions on a per-request\n(and hence per-user basis) by overriding ModelAdmin.get_actions() . This returns a dictionary of actions allowed. The keys are action names, and\nthe values are (function, name, short_description) tuples. For example, if you only want users whose names begin with ‘J’ to be able\nto delete objects in bulk: class MyModelAdmin ( admin . ModelAdmin ): ... def get_actions ( self , request ): actions = super () . get_actions ( request ) if request . user . username [ 0 ] . upper () != \"J\" : if \"delete_selected\" in actions : del actions [ \"delete_selected\" ] return actions Setting permissions for actions ¶ Actions may limit their availability to users with specific permissions by\nwrapping the action function with the action() decorator and passing the permissions argument: @admin . action ( permissions = [ \"change\" ]) def make_published ( modeladmin , request , queryset ): queryset . update ( status = \"p\" ) The make_published() action will only be available to users that pass the ModelAdmin.has_change_permission() check. If permissions has more than one permission, the action will be available\nas long as the user passes at least one of the checks. Available values for permissions and the corresponding method checks are: 'add' : ModelAdmin.has_add_permission() 'change' : ModelAdmin.has_change_permission() 'delete' : ModelAdmin.has_delete_permission() 'view' : ModelAdmin.has_view_permission() You can specify any other value as long as you implement a corresponding has_<value>_permission(self, request) method on the ModelAdmin . For example: from django.contrib import admin from django.contrib.auth import get_permission_codename class ArticleAdmin ( admin . ModelAdmin ): actions = [ \"make_published\" ] @admin . action ( permissions = [ \"publish\" ]) def make_published ( self , request , queryset ): queryset . update ( status = \"p\" ) def has_publish_permission ( self , request ): \"\"\"Does the user have the publish permission?\"\"\" opts = self . opts codename = get_permission_codename ( \"publish\" , opts ) return request . user . has_perm ( \" %s . %s \" % ( opts . app_label , codename )) The action decorator ¶ action ( * , permissions = None , description = None ) [source] ¶ This decorator can be used for setting specific attributes on custom action\nfunctions that can be used with actions : @admin . action ( permissions = [ \"publish\" ], description = \"Mark selected stories as published\" , ) def make_published ( self , request , queryset ): queryset . update ( status = \"p\" ) This is equivalent to setting some attributes (with the original, longer\nnames) on the function directly: def make_published ( self , request , queryset ): queryset . update ( status = \"p\" ) make_published . allowed_permissions = [ \"publish\" ] make_published . short_description = \"Mark selected stories as published\" Use of this decorator is not compulsory to make an action function, but it\ncan be useful to use it without arguments as a marker in your source to\nidentify the purpose of the function: @admin . action def make_inactive ( self , request , queryset ): queryset . update ( is_active = False ) In this case it will add no attributes to the function. Action descriptions are %-formatted and may contain '%(verbose_name)s' and '%(verbose_name_plural)s' placeholders, which are replaced,\nrespectively, by the model’s verbose_name and verbose_name_plural .", "keywords": ["function", "users", "items", "view", "feature", "username", "export_selected_objects", "status", "underscores", "modeladmin.actions", "per", "join", "messages", "efficiency", "error", "def", "module", "background", "code", "conditions", "point", "disable_action", "site", "values", "check", "’s", "bulk", "a_third_action", "opts", "django.contrib", "pages", "string", "behavior", "access", "class", "example", "display", "#", "placeholders", "app", "django.core", "verbose_name)s", "group", "serialization", "adminsite.add_action", "list", "modeladmin.delete_queryset", "model.delete", "export_as_json", "above", "intermediary", "thing", "availability", "names", "get_permission_codename", "request", "has_perm", "export", "verbose_name", "values_list", "action", "business", "some_other_action", "modeladmin.has_view_permission", "modeladmin.get_actions", "draft", "models", "query", "page", "httpresponse", "ways", "types", "ngettext", "json", "model", "/export/?ct=", "subclass", "change", "admin", "reasons", "techniques", "idea", "permissions", "article", ".", "application", "actions", "reader", "attributes", "django", "configuration", "=", "title", "django.contrib.contenttypes.models", "verbose_name_plural)s", "step", "max_length", "fields", "adminsite.disable_action", "stream", "message", "next", "exercise", "set", "ids=", "sense", "p", "modeladmin.has_add_permission", "practice", "value", "add_action", "modeladmin.has_change_permission", "ones", "content_type", "source", "contenttype", "keys", "case", "use", "w", "technique", "task", "errors", "codename", "str", "arguments", "queryset.delete", "possibilities", "list_display", "nutshell", "make_published", "type", "get_actions", "serializers", "self", "stories", "custom", "performance", "one", "objects", "documentation", "make_inactive", "tuples", "delete", "publish", "j", "adminsite", "default", "user", "mark", "descriptions", "caveat", "django.utils.translation", "choices", "cases", "modeladmin", "functions", "do_something_with", "anothermodeladmin", "success", "update", "none", "option", "format", "callback", "problem", "decorator", "httpresponseredirect", "ct", "has_publish_permission", "get", "time", "workflow", "basis", "story", "modeladmin.message_user", "description", "myapp.models", "object", "document", "confirmation", "couple", "get_for_model", "articleadmin", "logic", "short_description", "permission", "verbose_name_plural", "import", "name", "httprequest", "d", "charfield", "response", "parameter", "candidate", "%", "dictionary", "interaction", "pk", "way", "reference", "django.contrib.auth", "checks", "methods", "updating", "s", "options", "purpose", "majority", "notice", "method", "queryset", "registration", "django.contrib.admin", "django.db", "rest", "@admin", "argument", "status_choices", "¶", "articles", "news", "obj", "return", "deletion", "spaces", "body", "somemodeladmin", "del", "marker", "design", "manner", "iterate", "textfield", "modeladmin.has_delete_permission", "exceptions"], "type": "documentation"},
{"title": "django.contrib.auth | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/auth/", "content": "django.contrib.auth ¶ This document provides API reference material for the components of Django’s\nauthentication system. For more details on the usage of these components or\nhow to customize authentication and authorization see the authentication\ntopic guide . User model ¶ class models. User ¶ Fields ¶ class models. User User objects have the following\nfields: username ¶ Required. 150 characters or fewer. Usernames may contain alphanumeric, _ , @ , + , . and - characters. The max_length should be sufficient for many use cases. If you need\na longer length, please use a custom user model . If you use MySQL with the utf8mb4 encoding (recommended for proper Unicode support), specify at most max_length=191 because MySQL can only create unique indexes with\n191 characters in that case by default. first_name ¶ Optional ( blank=True ). 150\ncharacters or fewer. last_name ¶ Optional ( blank=True ). 150\ncharacters or fewer. email ¶ Optional ( blank=True ). Email\naddress. password ¶ Required. A hash of, and metadata about, the password. (Django doesn’t\nstore the raw password.) Raw passwords can be arbitrarily long and can\ncontain any character. The metadata in this field may mark the password\nas unusable. See the password documentation . groups ¶ Many-to-many relationship to Group user_permissions ¶ Many-to-many relationship to Permission is_staff ¶ Boolean. Allows this user to access the admin site. is_active ¶ Boolean. Marks this user account as active. We recommend that you set\nthis flag to False instead of deleting accounts. That way, if your\napplications have any foreign keys to users, the foreign keys won’t\nbreak. This doesn’t necessarily control whether or not the user can log in.\nAuthentication backends aren’t required to check for the is_active flag but the default backend\n( ModelBackend ) and the RemoteUserBackend do. You can\nuse AllowAllUsersModelBackend or AllowAllUsersRemoteUserBackend if you want to allow inactive users to login. In this case, you’ll also\nwant to customize the AuthenticationForm used by the LoginView as it rejects inactive\nusers. Be aware that the permission-checking methods such as has_perm() and the\nauthentication in the Django admin all return False for inactive\nusers. is_superuser ¶ Boolean. Treats this user as having all permissions without assigning\nany permission to it in particular. last_login ¶ A datetime of the user’s last login. date_joined ¶ The date/time when the account was created. Attributes ¶ class models. User is_authenticated ¶ Read-only attribute which is always True (as opposed to AnonymousUser.is_authenticated which is always False ). This is\na way to tell if the user has been authenticated. This does not imply\nany permissions and doesn’t check if the user is active or has a valid\nsession. Even though normally you will check this attribute on request.user to find out whether it has been populated by the AuthenticationMiddleware (representing the currently logged-in user), you should know this\nattribute is True for any User instance. is_anonymous ¶ Read-only attribute which is always False . This is a way of\ndifferentiating User and AnonymousUser objects. Generally, you should prefer using is_authenticated to this\nattribute. Methods ¶ class models. User get_username () ¶ Returns the username for the user. Since the User model can be\nswapped out, you should use this method instead of referencing the\nusername attribute directly. get_full_name () ¶ Returns the first_name plus\nthe last_name , with a space in\nbetween. get_short_name () ¶ Returns the first_name . set_password ( raw_password ) ¶ Sets the user’s password to the given raw string, taking care of the\npassword hashing. Doesn’t save the User object. When the raw_password is None , the password will be set to an\nunusable password, as if set_unusable_password() were used. check_password ( raw_password ) ¶ acheck_password ( raw_password ) ¶ Asynchronous version : acheck_password() Returns True if the given raw string is the correct password for\nthe user. (This takes care of the password hashing in making the\ncomparison.) Changed in Django 5.0: acheck_password() method was added. set_unusable_password () ¶ Marks the user as having no password set by updating the metadata in\nthe password field. This isn’t\nthe same as having a blank string for a password. check_password() for this user\nwill never return True . Doesn’t save the User object. You may need this if authentication for your application takes place\nagainst an existing external source such as an LDAP directory. Password reset restriction Users having an unusable password will not able to request a\npassword reset email via PasswordResetView . has_usable_password () ¶ Returns False if set_unusable_password() has\nbeen called for this user. get_user_permissions ( obj = None ) ¶ Returns a set of permission strings that the user has directly. If obj is passed in, only returns the user permissions for this\nspecific object. get_group_permissions ( obj = None ) ¶ Returns a set of permission strings that the user has, through their\ngroups. If obj is passed in, only returns the group permissions for\nthis specific object. get_all_permissions ( obj = None ) ¶ Returns a set of permission strings that the user has, both through\ngroup and user permissions. If obj is passed in, only returns the permissions for this\nspecific object. has_perm ( perm , obj = None ) ¶ Returns True if the user has the specified permission, where perm\nis in the format \"<app label>.<permission codename>\" . (see\ndocumentation on permissions ). If the user is\ninactive, this method will always return False . For an active\nsuperuser, this method will always return True . If obj is passed in, this method won’t check for a permission for\nthe model, but for this specific object. has_perms ( perm_list , obj = None ) ¶ Returns True if the user has each of the specified permissions,\nwhere each perm is in the format \"<app label>.<permission codename>\" . If the user is inactive,\nthis method will always return False . For an active superuser, this\nmethod will always return True . If obj is passed in, this method won’t check for permissions for\nthe model, but for the specific object. has_module_perms ( package_name ) ¶ Returns True if the user has any permissions in the given package\n(the Django app label). If the user is inactive, this method will\nalways return False . For an active superuser, this method will\nalways return True . email_user ( subject , message , from_email = None , ** kwargs ) ¶ Sends an email to the user. If from_email is None , Django uses\nthe DEFAULT_FROM_EMAIL . Any **kwargs are passed to the\nunderlying send_mail() call. Manager methods ¶ class models. UserManager ¶ The User model has a custom manager\nthat has the following helper methods (in addition to the methods provided\nby BaseUserManager ): create_user ( username , email = None , password = None , ** extra_fields ) ¶ Creates, saves and returns a User . The username and password are set as given. The\ndomain portion of email is\nautomatically converted to lowercase, and the returned User object will have is_active set to True . If no password is provided, set_unusable_password() will\nbe called. The extra_fields keyword arguments are passed through to the User ’s __init__ method to\nallow setting arbitrary fields on a custom user model . See Creating users for example usage. create_superuser ( username , email = None , password = None , ** extra_fields ) ¶ Same as create_user() , but sets is_staff and is_superuser to True . with_perm ( perm , is_active = True , include_superusers = True , backend = None , obj = None ) ¶ Returns users that have the given permission perm either in the \"<app label>.<permission codename>\" format or as a Permission instance. Returns an\nempty queryset if no users who have the perm found. If is_active is True (default), returns only active users, or\nif False , returns only inactive users. Use None to return all\nusers irrespective of active state. If include_superusers is True (default), the result will\ninclude superusers. If backend is passed in and it’s defined in AUTHENTICATION_BACKENDS , then this method will use it.\nOtherwise, it will use the backend in AUTHENTICATION_BACKENDS , if there is only one, or raise an\nexception. AnonymousUser object ¶ class models. AnonymousUser ¶ django.contrib.auth.models.AnonymousUser is a class that\nimplements the django.contrib.auth.models.User interface, with\nthese differences: id is always None . username is always the empty\nstring. get_username() always returns\nthe empty string. is_anonymous is True instead of False . is_authenticated is False instead of True . is_staff and is_superuser are always False . is_active is always False . groups and user_permissions are always\nempty. set_password() , check_password() , save() and delete() raise NotImplementedError . In practice, you probably won’t need to use AnonymousUser objects on your own, but\nthey’re used by web requests, as explained in the next section. Permission model ¶ class models. Permission ¶ Fields ¶ Permission objects have the following\nfields: class models. Permission name ¶ Required. 255 characters or fewer. Example: 'Can vote' . content_type ¶ Required. A reference to the django_content_type database table,\nwhich contains a record for each installed model. codename ¶ Required. 100 characters or fewer. Example: 'can_vote' . Methods ¶ Permission objects have the standard\ndata-access methods like any other Django model . Group model ¶ class models. Group ¶ Fields ¶ Group objects have the following fields: class models. Group name ¶ Required. 150 characters or fewer. Any characters are permitted.\nExample: 'Awesome Users' . permissions ¶ Many-to-many field to Permission : group . permissions . set ([ permission_list ]) group . permissions . add ( permission , permission , ... ) group . permissions . remove ( permission , permission , ... ) group . permissions . clear () Validators ¶ class validators. ASCIIUsernameValidator ¶ A field validator allowing only ASCII letters and numbers, in addition to @ , . , + , - , and _ . class validators. UnicodeUsernameValidator ¶ A field validator allowing Unicode characters, in addition to @ , . , + , - , and _ . The default validator for User.username . Login and logout signals ¶ The auth framework uses the following signals that\ncan be used for notification when a user logs in or out. user_logged_in ¶ Sent when a user logs in successfully. Arguments sent with this signal: sender The class of the user that just logged in. request The current HttpRequest instance. user The user instance that just logged in. user_logged_out ¶ Sent when the logout method is called. sender As above: the class of the user that just logged out or None if the user was not authenticated. request The current HttpRequest instance. user The user instance that just logged out or None if the\nuser was not authenticated. user_login_failed ¶ Sent when the user failed to login successfully sender The name of the module used for authentication. credentials A dictionary of keyword arguments containing the user credentials that were\npassed to authenticate() or your own custom\nauthentication backend. Credentials matching a set of ‘sensitive’ patterns,\n(including password) will not be sent in the clear as part of the signal. request The HttpRequest object, if one was provided to authenticate() . Authentication backends ¶ This section details the authentication backends that come with Django. For\ninformation on how to use them and how to write your own authentication\nbackends, see the Other authentication sources section of the User authentication guide . Available authentication backends ¶ The following backends are available in django.contrib.auth.backends : class BaseBackend [source] ¶ A base class that provides default implementations for all required\nmethods. By default, it will reject any user and provide no permissions. get_user_permissions ( user_obj , obj = None ) [source] ¶ Returns an empty set. get_group_permissions ( user_obj , obj = None ) [source] ¶ Returns an empty set. get_all_permissions ( user_obj , obj = None ) [source] ¶ Uses get_user_permissions() and get_group_permissions() to\nget the set of permission strings the user_obj has. has_perm ( user_obj , perm , obj = None ) [source] ¶ Uses get_all_permissions() to check if user_obj has the\npermission string perm . class ModelBackend [source] ¶ This is the default authentication backend used by Django.  It\nauthenticates using credentials consisting of a user identifier and\npassword.  For Django’s default user model, the user identifier is the\nusername, for custom user models it is the field specified by\nUSERNAME_FIELD (see Customizing Users and authentication ). It also handles the default permissions model as defined for User and PermissionsMixin . has_perm() , get_all_permissions() , get_user_permissions() ,\nand get_group_permissions() allow an object to be passed as a\nparameter for object-specific permissions, but this backend does not\nimplement them other than returning an empty set of permissions if obj is not None . with_perm() also allows an object to be passed as a parameter, but\nunlike others methods it returns an empty queryset if obj is not None . authenticate ( request , username = None , password = None , ** kwargs ) [source] ¶ Tries to authenticate username with password by calling User.check_password . If no username is provided, it tries to fetch a username from kwargs using the\nkey CustomUser.USERNAME_FIELD . Returns an\nauthenticated user or None . request is an HttpRequest and may be None if it wasn’t provided to authenticate() (which passes it on to the backend). get_user_permissions ( user_obj , obj = None ) [source] ¶ Returns the set of permission strings the user_obj has from their\nown user permissions. Returns an empty set if is_anonymous or is_active is False . get_group_permissions ( user_obj , obj = None ) [source] ¶ Returns the set of permission strings the user_obj has from the\npermissions of the groups they belong. Returns an empty set if is_anonymous or is_active is False . get_all_permissions ( user_obj , obj = None ) [source] ¶ Returns the set of permission strings the user_obj has, including both\nuser permissions and group permissions. Returns an empty set if is_anonymous or is_active is False . has_perm ( user_obj , perm , obj = None ) [source] ¶ Uses get_all_permissions() to check if user_obj has the\npermission string perm . Returns False if the user is not is_active . has_module_perms ( user_obj , app_label ) [source] ¶ Returns whether the user_obj has any permissions on the app app_label . user_can_authenticate () [source] ¶ Returns whether the user is allowed to authenticate. To match the\nbehavior of AuthenticationForm which prohibits inactive users from logging in ,\nthis method returns False for users with is_active=False . Custom user models that\ndon’t have an is_active field are allowed. with_perm ( perm , is_active = True , include_superusers = True , obj = None ) [source] ¶ Returns all active users who have the permission perm either in\nthe form of \"<app label>.<permission codename>\" or a Permission instance. Returns an\nempty queryset if no users who have the perm found. If is_active is True (default), returns only active users, or\nif False , returns only inactive users. Use None to return all\nusers irrespective of active state. If include_superusers is True (default), the result will\ninclude superusers. class AllowAllUsersModelBackend [source] ¶ Same as ModelBackend except that it doesn’t reject inactive users\nbecause user_can_authenticate() always returns True . When using this backend, you’ll likely want to customize the AuthenticationForm used by the LoginView by overriding the confirm_login_allowed() method as it rejects inactive users. class RemoteUserBackend [source] ¶ Use this backend to take advantage of external-to-Django-handled\nauthentication.  It authenticates using usernames passed in request.META['REMOTE_USER'] .  See\nthe Authenticating against REMOTE_USER documentation. If you need more control, you can create your own authentication backend\nthat inherits from this class and override these attributes or methods: create_unknown_user ¶ True or False . Determines whether or not a user object is\ncreated if not already in the database  Defaults to True . authenticate ( request , remote_user ) [source] ¶ The username passed as remote_user is considered trusted. This\nmethod returns the user object with the given username, creating a new\nuser object if create_unknown_user is True . Returns None if create_unknown_user is False and a User object with the given username is not found in\nthe database. request is an HttpRequest and may be None if it wasn’t provided to authenticate() (which passes it on to the backend). clean_username ( username ) [source] ¶ Performs any cleaning on the username (e.g. stripping LDAP DN\ninformation) prior to using it to get or create a user object. Returns\nthe cleaned username. configure_user ( request , user , created = True ) [source] ¶ Configures the user on each authentication attempt. This method is\ncalled immediately after fetching or creating the user being\nauthenticated, and can be used to perform custom setup actions, such as\nsetting the user’s groups based on attributes in an LDAP directory.\nReturns the user object. The setup can be performed either once when the user is created\n( created is True ) or on existing users ( created is False ) as a way of synchronizing attributes between the remote and\nthe local systems. request is an HttpRequest and may be None if it wasn’t provided to authenticate() (which passes it on to the backend). user_can_authenticate () ¶ Returns whether the user is allowed to authenticate. This method\nreturns False for users with is_active=False . Custom user models that\ndon’t have an is_active field are allowed. class AllowAllUsersRemoteUserBackend [source] ¶ Same as RemoteUserBackend except that it doesn’t reject inactive\nusers because user_can_authenticate always\nreturns True . Utility functions ¶ get_user ( request ) [source] ¶ aget_user ( request ) ¶ Asynchronous version : aget_user() Returns the user model instance associated with the given request ’s\nsession. It checks if the authentication backend stored in the session is present in AUTHENTICATION_BACKENDS . If so, it uses the backend’s get_user() method to retrieve the user model instance and then verifies\nthe session by calling the user model’s get_session_auth_hash() method. If the verification fails and SECRET_KEY_FALLBACKS are\nprovided, it verifies the session against each fallback key using get_session_auth_fallback_hash() . Returns an instance of AnonymousUser if the authentication backend stored in the session is no longer in AUTHENTICATION_BACKENDS , if a user isn’t returned by the\nbackend’s get_user() method, or if the session auth hash doesn’t\nvalidate. Changed in Django 5.0: aget_user() function was added.", "keywords": ["function", "users", "implementations", "accounts", "result", "with_perm", "control", "passwordresetview", "username", "indexes", "ldap", "create_user", "login", "usernames", "space", "permissions", "module", "site", "user.check_password", "auth", "superusers", "secret_key_fallbacks", "false", "string", "django.contrib.auth.backends", "user_permissions", "class", "_", "field", "care", "addition", "app", "creates", "example", "include_superusers", "group", "sender", "record", "acheck_password", "customizing", "returns", "metadata", "user_login_failed", "user_obj", "numbers", "has_perm", "request", "flag", "database", "table", "subject", "email", "*", "models", "user_logged_in", "signal", "get_all_permissions", "version", "logout", "anonymoususer", "read", "set_unusable_password", "strings", "model", "asciiusernamevalidator", "get_full_name", "admin", "create_unknown_user", "place", "systems", "application", "encoding", "django_content_type", "django.contrib.auth.models", "usage", "attributes", "label", "user_logged_out", "remote_user", "portion", "django", "actions", "hash", "=", "n’t", "differences", "max_length", "fields", "modelbackend", "message", "set", "relationship", "access", "character", "practice", "letters", "restriction", "setup", "section", "validator", "get_session_auth_hash", "source", "send_mail", "raw_password", "keys", "hashing", "case", "content_type", "boolean", "length", "data", "authentication", "user.username", "authorization", "fallback", "permissionsmixin", "datetime", "use", "base", "backend", "guide", "topic", "get_group_permissions", "notimplementederror", "codename", "has_perms", "permission_list", "arguments", "first_name", "credentials", "identifier", "passwords", "package", "init", "required", "get_user", "has_usable_password", "configure_user", "custom", "instance", "kwargs", "objects", "documentation", "check_password", "utility", "comparison", "delete", "last_name", "authenticating", "interface", "allowallusersremoteuserbackend", "utf8mb4", "default", "unicodeusernamevalidator", "clean_username", "validators", "user", "loginview", "dn", "cases", "awesome", "unicode", "functions", "key", "signals", "attribute", "helper", "authenticationform", "none", "form", "format", "characters", "superuser", "time", "set_password", "same", "patterns", "cleaning", "framework", "date", "get_user_permissions", "true", "get_session_auth_fallback_hash", "authenticationmiddleware", "components", "account", "get_username", "api", "app_label", "part", "support", "advantage", "material", "basebackend", "remoteuserbackend", "object", "document", "customuser", "attempt", "domain", "password", "groups", "perm", "permission", "name", "httprequest", "d", "user_can_authenticate", "marks", "from_email", "parameter", "mysql", "directory", "break", "dictionary", "call", "sent", "is_superuser", "requests", "way", "get_short_name", "reset", "backends", "reference", "information", "web", "django.contrib.auth", "has_module_perms", "defaults", "methods", "keyword", "baseusermanager", "optional", "notification", "exception", "i", "validate", "details", "treats", "manager", "method", "queryset", "others", "session", "verification", "uses", "¶", "obj", "confirm_login_allowed", "configures", "applications", "state", "request.user", "package_name", "system", "address", "extra_fields", "behavior", "usermanager"], "type": "documentation"},
{"title": "Customizing authentication in Django | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/auth/customizing/", "content": "Customizing authentication in Django ¶ The authentication that comes with Django is good enough for most common cases,\nbut you may have needs not met by the out-of-the-box defaults. Customizing\nauthentication in your projects requires understanding what points of the\nprovided system are extensible or replaceable. This document provides details\nabout how the auth system can be customized. Authentication backends provide an extensible\nsystem for when a username and password stored with the user model need to be\nauthenticated against a different service than Django’s default. You can give your models custom permissions that\ncan be checked through Django’s authorization system. You can extend the default User model, or substitute a completely customized model. Other authentication sources ¶ There may be times you have the need to hook into another authentication source\n– that is, another source of usernames and passwords or authentication\nmethods. For example, your company may already have an LDAP setup that stores a username\nand password for every employee. It’d be a hassle for both the network\nadministrator and the users themselves if users had separate accounts in LDAP\nand the Django-based applications. So, to handle situations like this, the Django authentication system lets you\nplug in other authentication sources. You can override Django’s default\ndatabase-based scheme, or you can use the default system in tandem with other\nsystems. See the authentication backend reference for information on the authentication\nbackends included with Django. Specifying authentication backends ¶ Behind the scenes, Django maintains a list of “authentication backends” that it\nchecks for authentication. When somebody calls django.contrib.auth.authenticate() – as described in How to log\na user in – Django tries authenticating across\nall of its authentication backends. If the first authentication method fails,\nDjango tries the second one, and so on, until all backends have been attempted. The list of authentication backends to use is specified in the AUTHENTICATION_BACKENDS setting. This should be a list of Python\npath names that point to Python classes that know how to authenticate. These\nclasses can be anywhere on your Python path. By default, AUTHENTICATION_BACKENDS is set to: [ \"django.contrib.auth.backends.ModelBackend\" ] That’s the basic authentication backend that checks the Django users database\nand queries the built-in permissions. It does not provide protection against\nbrute force attacks via any rate limiting mechanism. You may either implement\nyour own rate limiting mechanism in a custom auth backend, or use the\nmechanisms provided by most web servers. The order of AUTHENTICATION_BACKENDS matters, so if the same\nusername and password is valid in multiple backends, Django will stop\nprocessing at the first positive match. If a backend raises a PermissionDenied exception, authentication will immediately fail. Django won’t check the\nbackends that follow. Note Once a user has authenticated, Django stores which backend was used to\nauthenticate the user in the user’s session, and reuses the same backend\nfor the duration of that session whenever access to the currently\nauthenticated user is needed. This effectively means that authentication\nsources are cached on a per-session basis, so if you change AUTHENTICATION_BACKENDS , you’ll need to clear out session data if\nyou need to force users to re-authenticate using different methods. A\nsimple way to do that is to execute Session.objects.all().delete() . Writing an authentication backend ¶ An authentication backend is a class that implements two required methods: get_user(user_id) and authenticate(request, **credentials) , as well as\na set of optional permission related authorization methods . The get_user method takes a user_id – which could be a username,\ndatabase ID or whatever, but has to be the primary key of your user object –\nand returns a user object or None . The authenticate method takes a request argument and credentials as\nkeyword arguments. Most of the time, it’ll look like this: from django.contrib.auth.backends import BaseBackend class MyBackend ( BaseBackend ): def authenticate ( self , request , username = None , password = None ): # Check the username/password and return a user. ... But it could also authenticate a token, like so: from django.contrib.auth.backends import BaseBackend class MyBackend ( BaseBackend ): def authenticate ( self , request , token = None ): # Check the token and return a user. ... Either way, authenticate() should check the credentials it gets and return\na user object that matches those credentials if the credentials are valid. If\nthey’re not valid, it should return None . request is an HttpRequest and may be None if it\nwasn’t provided to authenticate() (which passes it\non to the backend). The Django admin is tightly coupled to the Django User object . For example, for a user to access the admin, User.is_staff and User.is_active must be True (see AdminSite.has_permission() for details). The best way to deal with this is to create a Django User object for each\nuser that exists for your backend (e.g., in your LDAP directory, your external\nSQL database, etc.). You can either write a script to do this in advance, or\nyour authenticate method can do it the first time a user logs in. Here’s an example backend that authenticates against a username and password\nvariable defined in your settings.py file and creates a Django User object the first time a user authenticates. In this example, the created Django User object is a superuser who will have full access to the admin: from django.conf import settings from django.contrib.auth.backends import BaseBackend from django.contrib.auth.hashers import check_password from django.contrib.auth.models import User class SettingsBackend ( BaseBackend ): \"\"\" Authenticate against the settings ADMIN_LOGIN and ADMIN_PASSWORD. Use the login name and a hash of the password. For example: ADMIN_LOGIN = 'admin' ADMIN_PASSWORD = 'pbkdf2_sha256$30000$Vo0VlMnkR4Bk$qEvtdyZRWTcOsCnI/oQ7fVOu1XAURIZYoOZ3iq8Dr4M=' \"\"\" def authenticate ( self , request , username = None , password = None ): login_valid = settings . ADMIN_LOGIN == username pwd_valid = check_password ( password , settings . ADMIN_PASSWORD ) if login_valid and pwd_valid : try : user = User . objects . get ( username = username ) except User . DoesNotExist : # Create a new user. There's no need to set a password # because only the password from settings.py is checked. user = User ( username = username ) # is_active defaults to True. user . is_staff = True user . is_superuser = True user . save () return user return None def get_user ( self , user_id ): try : return User . objects . get ( pk = user_id ) except User . DoesNotExist : return None Handling authorization in custom backends ¶ Custom auth backends can provide their own permissions. The user model and its manager will delegate permission lookup functions\n( get_user_permissions() , get_group_permissions() , get_all_permissions() , has_perm() , has_module_perms() , and with_perm() ) to any\nauthentication backend that implements these functions. The permissions given to the user will be the superset of all permissions\nreturned by all backends. That is, Django grants a permission to a user that\nany one backend grants. If a backend raises a PermissionDenied exception in has_perm() or has_module_perms() , the authorization\nwill immediately fail and Django won’t check the backends that follow. A backend could implement permissions for the magic admin like this: from django.contrib.auth.backends import BaseBackend class MagicAdminBackend ( BaseBackend ): def has_perm ( self , user_obj , perm , obj = None ): return user_obj . username == settings . ADMIN_LOGIN This gives full permissions to the user granted access in the above example.\nNotice that in addition to the same arguments given to the associated django.contrib.auth.models.User functions, the backend auth functions\nall take the user object, which may be an anonymous user, as an argument. A full authorization implementation can be found in the ModelBackend class\nin django/contrib/auth/backends.py , which is the default backend and\nqueries the auth_permission table most of the time. Authorization for anonymous users ¶ An anonymous user is one that is not authenticated i.e. they have provided no\nvalid authentication details. However, that does not necessarily mean they are\nnot authorized to do anything. At the most basic level, most websites\nauthorize anonymous users to browse most of the site, and many allow anonymous\nposting of comments etc. Django’s permission framework does not have a place to store permissions for\nanonymous users. However, the user object passed to an authentication backend\nmay be an django.contrib.auth.models.AnonymousUser object, allowing\nthe backend to specify custom authorization behavior for anonymous users. This\nis especially useful for the authors of reusable apps, who can delegate all\nquestions of authorization to the auth backend, rather than needing settings,\nfor example, to control anonymous access. Authorization for inactive users ¶ An inactive user is one that has its is_active field set to False . The ModelBackend and RemoteUserBackend authentication\nbackends prohibits these users from authenticating. If a custom user model\ndoesn’t have an is_active field,\nall users will be allowed to authenticate. You can use AllowAllUsersModelBackend or AllowAllUsersRemoteUserBackend if you\nwant to allow inactive users to authenticate. The support for anonymous users in the permission system allows for a scenario\nwhere anonymous users have permissions to do something while inactive\nauthenticated users do not. Do not forget to test for the is_active attribute of the user in your own\nbackend permission methods. Handling object permissions ¶ Django’s permission framework has a foundation for object permissions, though\nthere is no implementation for it in the core. That means that checking for\nobject permissions will always return False or an empty list (depending on\nthe check performed). An authentication backend will receive the keyword\nparameters obj and user_obj for each object related authorization\nmethod and can return the object level permission as appropriate. Custom permissions ¶ To create custom permissions for a given model object, use the permissions model Meta attribute . This example Task model creates two custom permissions, i.e., actions users\ncan or cannot do with Task instances, specific to your application: class Task ( models . Model ): ... class Meta : permissions = [ ( \"change_task_status\" , \"Can change the status of tasks\" ), ( \"close_task\" , \"Can remove a task by setting its status as closed\" ), ] The only thing this does is create those extra permissions when you run manage.py migrate (the function that creates permissions\nis connected to the post_migrate signal).\nYour code is in charge of checking the value of these permissions when a user\nis trying to access the functionality provided by the application (changing the\nstatus of tasks or closing tasks.) Continuing the above example, the following\nchecks if a user may close tasks: user . has_perm ( \"app.close_task\" ) Extending the existing User model ¶ There are two ways to extend the default User model without substituting your own\nmodel. If the changes you need are purely behavioral, and don’t require any\nchange to what is stored in the database, you can create a proxy model based on User . This\nallows for any of the features offered by proxy models including default\nordering, custom managers, or custom model methods. If you wish to store information related to User , you can use a OneToOneField to a model containing the fields for\nadditional information. This one-to-one model is often called a profile model,\nas it might store non-auth related information about a site user. For example\nyou might create an Employee model: from django.contrib.auth.models import User class Employee ( models . Model ): user = models . OneToOneField ( User , on_delete = models . CASCADE ) department = models . CharField ( max_length = 100 ) Assuming an existing Employee Fred Smith who has both a User and Employee\nmodel, you can access the related information using Django’s standard related\nmodel conventions: >>> u = User . objects . get ( username = \"fsmith\" ) >>> freds_department = u . employee . department To add a profile model’s fields to the user page in the admin, define an InlineModelAdmin (for this example, we’ll use a StackedInline ) in your app’s admin.py and\nadd it to a UserAdmin class which is registered with the User class: from django.contrib import admin from django.contrib.auth.admin import UserAdmin as BaseUserAdmin from django.contrib.auth.models import User from my_user_profile_app.models import Employee # Define an inline admin descriptor for Employee model # which acts a bit like a singleton class EmployeeInline ( admin . StackedInline ): model = Employee can_delete = False verbose_name_plural = \"employee\" # Define a new User admin class UserAdmin ( BaseUserAdmin ): inlines = [ EmployeeInline ] # Re-register UserAdmin admin . site . unregister ( User ) admin . site . register ( User , UserAdmin ) These profile models are not special in any way - they are just Django models\nthat happen to have a one-to-one link with a user model. As such, they aren’t\nauto created when a user is created, but\na django.db.models.signals.post_save could be used to create or update\nrelated models as appropriate. Using related models results in additional queries or joins to retrieve the\nrelated data. Depending on your needs, a custom user model that includes the\nrelated fields may be your better option, however, existing relations to the\ndefault user model within your project’s apps may justify the extra database\nload. Substituting a custom User model ¶ Some kinds of projects may have authentication requirements for which Django’s\nbuilt-in User model is not always\nappropriate. For instance, on some sites it makes more sense to use an email\naddress as your identification token instead of a username. Django allows you to override the default user model by providing a value for\nthe AUTH_USER_MODEL setting that references a custom model: AUTH_USER_MODEL = \"myapp.MyUser\" This dotted pair describes the label of the\nDjango app (which must be in your INSTALLED_APPS ), and the name of\nthe Django model that you wish to use as your user model. Using a custom user model when starting a project ¶ If you’re starting a new project, you can set up a custom user model that\nbehaves identically to the default user model by subclassing AbstractUser : from django.contrib.auth.models import AbstractUser class User ( AbstractUser ): pass Don’t forget to point AUTH_USER_MODEL to it. Do this before creating\nany migrations or running manage.py migrate for the first time. Also, register the model in the app’s admin.py : from django.contrib import admin from django.contrib.auth.admin import UserAdmin from .models import User admin . site . register ( User , UserAdmin ) Changing to a custom user model mid-project ¶ Changing AUTH_USER_MODEL after you’ve created database tables is\npossible, but can be complex, since it affects foreign keys and many-to-many\nrelationships, for example. This change can’t be done automatically and requires manually fixing your\nschema, moving your data from the old user table, and possibly manually\nreapplying some migrations. See #25313 for an outline of the steps. Due to limitations of Django’s dynamic dependency feature for swappable\nmodels, the model referenced by AUTH_USER_MODEL must be created in\nthe first migration of its app (usually called 0001_initial ); otherwise,\nyou’ll have dependency issues. In addition, you may run into a CircularDependencyError when running your\nmigrations as Django won’t be able to automatically break the dependency loop\ndue to the dynamic dependency. If you see this error, you should break the loop\nby moving the models depended on by your user model into a second migration.\n(You can try making two normal models that have a ForeignKey to each other\nand seeing how makemigrations resolves that circular dependency if you want\nto see how it’s usually done.) Reusable apps and AUTH_USER_MODEL ¶ Reusable apps shouldn’t implement a custom user model. A project may use many\napps, and two reusable apps that implemented a custom user model couldn’t be\nused together. If you need to store per user information in your app, use\na ForeignKey or OneToOneField to settings.AUTH_USER_MODEL as described below. Referencing the User model ¶ If you reference User directly (for\nexample, by referring to it in a foreign key), your code will not work in\nprojects where the AUTH_USER_MODEL setting has been changed to a\ndifferent user model. get_user_model () [source] ¶ Instead of referring to User directly,\nyou should reference the user model using django.contrib.auth.get_user_model() . This method will return the\ncurrently active user model – the custom user model if one is specified, or User otherwise. When you define a foreign key or many-to-many relations to the user model,\nyou should specify the custom model using the AUTH_USER_MODEL setting. For example: from django.conf import settings from django.db import models class Article ( models . Model ): author = models . ForeignKey ( settings . AUTH_USER_MODEL , on_delete = models . CASCADE , ) When connecting to signals sent by the user model, you should specify\nthe custom model using the AUTH_USER_MODEL setting. For example: from django.conf import settings from django.db.models.signals import post_save def post_save_receiver ( sender , instance , created , ** kwargs ): pass post_save . connect ( post_save_receiver , sender = settings . AUTH_USER_MODEL ) Generally speaking, it’s easiest to refer to the user model with the AUTH_USER_MODEL setting in code that’s executed at import time,\nhowever, it’s also possible to call get_user_model() while Django\nis importing models, so you could use models.ForeignKey(get_user_model(), ...) . If your app is tested with multiple user models, using @override_settings(AUTH_USER_MODEL=...) for example, and you cache the\nresult of get_user_model() in a module-level variable, you may need to\nlisten to the setting_changed signal to clear\nthe cache. For example: from django.apps import apps from django.contrib.auth import get_user_model from django.core.signals import setting_changed from django.dispatch import receiver @receiver ( setting_changed ) def user_model_swapped ( * , setting , ** kwargs ): if setting == \"AUTH_USER_MODEL\" : apps . clear_cache () from myapp import some_module some_module . UserModel = get_user_model () Specifying a custom user model ¶ When you start your project with a custom user model, stop to consider if this\nis the right choice for your project. Keeping all user related information in one model removes the need for\nadditional or more complex database queries to retrieve related models. On the\nother hand, it may be more suitable to store app-specific user information in a\nmodel that has a relation with your custom user model. That allows each app to\nspecify its own user data requirements without potentially conflicting or\nbreaking assumptions by other apps. It also means that you would keep your user\nmodel as simple as possible, focused on authentication, and following the\nminimum requirements Django expects custom user models to meet. If you use the default authentication backend, then your model must have a\nsingle unique field that can be used for identification purposes. This can\nbe a username, an email address, or any other unique attribute. A non-unique\nusername field is allowed if you use a custom authentication backend that\ncan support it. The easiest way to construct a compliant custom user model is to inherit from AbstractBaseUser . AbstractBaseUser provides the core\nimplementation of a user model, including hashed passwords and tokenized\npassword resets. You must then provide some key implementation details: class models. CustomUser ¶ USERNAME_FIELD ¶ A string describing the name of the field on the user model that is\nused as the unique identifier. This will usually be a username of some\nkind, but it can also be an email address, or any other unique\nidentifier. The field must be unique (e.g. have unique=True set\nin its definition), unless you use a custom authentication backend that\ncan support non-unique usernames. In the following example, the field identifier is used\nas the identifying field: class MyUser ( AbstractBaseUser ): identifier = models . CharField ( max_length = 40 , unique = True ) ... USERNAME_FIELD = \"identifier\" EMAIL_FIELD ¶ A string describing the name of the email field on the User model.\nThis value is returned by get_email_field_name() . REQUIRED_FIELDS ¶ A list of the field names that will be prompted for when creating a\nuser via the createsuperuser management command. The user\nwill be prompted to supply a value for each of these fields. It must\ninclude any field for which blank is False or undefined and may include additional fields you want\nprompted for when a user is created interactively. REQUIRED_FIELDS has no effect in other parts of Django, like\ncreating a user in the admin. For example, here is the partial definition for a user model that\ndefines two required fields - a date of birth and height: class MyUser ( AbstractBaseUser ): ... date_of_birth = models . DateField () height = models . FloatField () ... REQUIRED_FIELDS = [ \"date_of_birth\" , \"height\" ] Note REQUIRED_FIELDS must contain all required fields on your user\nmodel, but should not contain the USERNAME_FIELD or password as these fields will always be prompted for. is_active ¶ A boolean attribute that indicates whether the user is considered\n“active”.  This attribute is provided as an attribute on AbstractBaseUser defaulting to True . How you choose to\nimplement it will depend on the details of your chosen auth backends.\nSee the documentation of the is_active attribute on the built-in user model for details. get_full_name () ¶ Optional. A longer formal identifier for the user such as their full\nname. If implemented, this appears alongside the username in an\nobject’s history in django.contrib.admin . get_short_name () ¶ Optional. A short, informal identifier for the user such as their\nfirst name. If implemented, this replaces the username in the greeting\nto the user in the header of django.contrib.admin . Importing AbstractBaseUser AbstractBaseUser and BaseUserManager are importable from django.contrib.auth.base_user so that they can be imported without\nincluding django.contrib.auth in INSTALLED_APPS . The following attributes and methods are available on any subclass of AbstractBaseUser : class models. AbstractBaseUser ¶ get_username () ¶ Returns the value of the field nominated by USERNAME_FIELD . clean () ¶ Normalizes the username by calling normalize_username() . If you\noverride this method, be sure to call super() to retain the\nnormalization. classmethod get_email_field_name () ¶ Returns the name of the email field specified by the EMAIL_FIELD attribute. Defaults to 'email' if EMAIL_FIELD isn’t specified. classmethod normalize_username ( username ) ¶ Applies NFKC Unicode normalization to usernames so that visually\nidentical characters with different Unicode code points are considered\nidentical. is_authenticated ¶ Read-only attribute which is always True (as opposed to AnonymousUser.is_authenticated which is always False ).\nThis is a way to tell if the user has been authenticated. This does not\nimply any permissions and doesn’t check if the user is active or has\na valid session. Even though normally you will check this attribute on request.user to find out whether it has been populated by the AuthenticationMiddleware (representing the currently logged-in user), you should know this\nattribute is True for any User instance. is_anonymous ¶ Read-only attribute which is always False . This is a way of\ndifferentiating User and AnonymousUser objects. Generally, you should prefer using is_authenticated to this attribute. set_password ( raw_password ) ¶ Sets the user’s password to the given raw string, taking care of the\npassword hashing. Doesn’t save the AbstractBaseUser object. When the raw_password is None , the password will be set to an\nunusable password, as if set_unusable_password() were used. check_password ( raw_password ) ¶ acheck_password ( raw_password ) ¶ Asynchronous version : acheck_password() Returns True if the given raw string is the correct password for\nthe user. (This takes care of the password hashing in making the\ncomparison.) Changed in Django 5.0: acheck_password() method was added. set_unusable_password () ¶ Marks the user as having no password set.  This isn’t the same as\nhaving a blank string for a password. check_password() for this user\nwill never return True . Doesn’t save the AbstractBaseUser object. You may need this if authentication for your application takes place\nagainst an existing external source such as an LDAP directory. has_usable_password () ¶ Returns False if set_unusable_password() has\nbeen called for this user. get_session_auth_hash () ¶ Returns an HMAC of the password field. Used for Session invalidation on password change . get_session_auth_fallback_hash () ¶ Yields the HMAC of the password field using SECRET_KEY_FALLBACKS . Used by get_user() . AbstractUser subclasses AbstractBaseUser : class models. AbstractUser ¶ clean () ¶ Normalizes the email by calling BaseUserManager.normalize_email() . If you override this method,\nbe sure to call super() to retain the normalization. Writing a manager for a custom user model ¶ You should also define a custom manager for your user model. If your user model\ndefines username , email , is_staff , is_active , is_superuser , last_login , and date_joined fields the same as Django’s default user,\nyou can install Django’s UserManager ;\nhowever, if your user model defines different fields, you’ll need to define a\ncustom manager that extends BaseUserManager providing two additional methods: class models. CustomUserManager ¶ create_user ( username_field , password = None , ** other_fields ) ¶ The prototype of create_user() should accept the username field,\nplus all required fields as arguments. For example, if your user model\nuses email as the username field, and has date_of_birth as a\nrequired field, then create_user should be defined as: def create_user ( self , email , date_of_birth , password = None ): # create user here ... create_superuser ( username_field , password = None , ** other_fields ) ¶ The prototype of create_superuser() should accept the username\nfield, plus all required fields as arguments. For example, if your user\nmodel uses email as the username field, and has date_of_birth as a required field, then create_superuser should be defined as: def create_superuser ( self , email , date_of_birth , password = None ): # create superuser here ... For a ForeignKey in USERNAME_FIELD or REQUIRED_FIELDS , these methods receive the value of the to_field (the primary_key by default) of an existing instance. BaseUserManager provides the following\nutility methods: class models. BaseUserManager ¶ classmethod normalize_email ( email ) ¶ Normalizes email addresses by lowercasing the domain portion of the\nemail address. get_by_natural_key ( username ) ¶ Retrieves a user instance using the contents of the field\nnominated by USERNAME_FIELD . Extending Django’s default User ¶ If you’re entirely happy with Django’s User model, but you want to add some additional profile information, you could\nsubclass django.contrib.auth.models.AbstractUser and add your custom\nprofile fields, although we’d recommend a separate model as described in Specifying a custom user model . AbstractUser provides the full\nimplementation of the default User as an abstract model . Custom users and the built-in auth forms ¶ Django’s built-in forms and views make certain assumptions about the user model that they\nare working with. The following forms are compatible with any subclass of AbstractBaseUser : AuthenticationForm : Uses the username\nfield specified by USERNAME_FIELD . SetPasswordForm PasswordChangeForm AdminPasswordChangeForm The following forms make assumptions about the user model and can be used as-is\nif those assumptions are met: PasswordResetForm : Assumes that the user\nmodel has a field that stores the user’s email address with the name returned\nby get_email_field_name() ( email by\ndefault) that can be used to identify the user and a boolean field named is_active to prevent password resets for inactive users. Finally, the following forms are tied to User and need to be rewritten or extended\nto work with a custom user model: UserCreationForm UserChangeForm If your custom user model is a subclass of AbstractUser , then you can\nextend these forms in this manner: from django.contrib.auth.forms import UserCreationForm from myapp.models import CustomUser class CustomUserCreationForm ( UserCreationForm ): class Meta ( UserCreationForm . Meta ): model = CustomUser fields = UserCreationForm . Meta . fields + ( \"custom_field\" ,) Custom users and django.contrib.admin ¶ If you want your custom user model to also work with the admin, your user model\nmust define some additional attributes and methods. These methods allow the\nadmin to control access of the user to admin content: class models. CustomUser is_staff ¶ Returns True if the user is allowed to have access to the admin site. is_active ¶ Returns True if the user account is currently active. has_perm(perm, obj=None): Returns True if the user has the named permission. If obj is\nprovided, the permission needs to be checked against a specific object\ninstance. has_module_perms(app_label): Returns True if the user has permission to access models in\nthe given app. You will also need to register your custom user model with the admin. If\nyour custom user model extends django.contrib.auth.models.AbstractUser ,\nyou can use Django’s existing django.contrib.auth.admin.UserAdmin class. However, if your user model extends AbstractBaseUser , you’ll need to define\na custom ModelAdmin class. It may be possible to subclass the default django.contrib.auth.admin.UserAdmin ; however, you’ll need to\noverride any of the definitions that refer to fields on django.contrib.auth.models.AbstractUser that aren’t on your\ncustom user class. Note If you are using a custom ModelAdmin which is a subclass of django.contrib.auth.admin.UserAdmin , then you need to add your custom\nfields to fieldsets (for fields to be used in editing users) and to add_fieldsets (for fields to be used when creating a user). For\nexample: from django.contrib.auth.admin import UserAdmin class CustomUserAdmin ( UserAdmin ): ... fieldsets = UserAdmin . fieldsets + (( None , { \"fields\" : [ \"custom_field\" ]}),) add_fieldsets = UserAdmin . add_fieldsets + (( None , { \"fields\" : [ \"custom_field\" ]}),) See a full example for more\ndetails. Custom users and permissions ¶ To make it easy to include Django’s permission framework into your own user\nclass, Django provides PermissionsMixin .\nThis is an abstract model you can include in the class hierarchy for your user\nmodel, giving you all the methods and database fields necessary to support\nDjango’s permission model. PermissionsMixin provides the following\nmethods and attributes: class models. PermissionsMixin ¶ is_superuser ¶ Boolean. Designates that this user has all permissions without\nexplicitly assigning them. get_user_permissions ( obj = None ) ¶ Returns a set of permission strings that the user has directly. If obj is passed in, only returns the user permissions for this\nspecific object. get_group_permissions ( obj = None ) ¶ Returns a set of permission strings that the user has, through their\ngroups. If obj is passed in, only returns the group permissions for\nthis specific object. get_all_permissions ( obj = None ) ¶ Returns a set of permission strings that the user has, both through\ngroup and user permissions. If obj is passed in, only returns the permissions for this\nspecific object. has_perm ( perm , obj = None ) ¶ Returns True if the user has the specified permission, where perm is in the format \"<app label>.<permission codename>\" (see permissions ). If User.is_active and is_superuser are both True , this method always\nreturns True . If obj is passed in, this method won’t check for a permission for\nthe model, but for this specific object. has_perms ( perm_list , obj = None ) ¶ Returns True if the user has each of the specified permissions,\nwhere each perm is in the format \"<app label>.<permission codename>\" . If User.is_active and is_superuser are both True , this method always\nreturns True . If obj is passed in, this method won’t check for permissions for\nthe model, but for the specific object. has_module_perms ( package_name ) ¶ Returns True if the user has any permissions in the given package\n(the Django app label). If User.is_active and is_superuser are both True , this method always\nreturns True . PermissionsMixin and ModelBackend If you don’t include the PermissionsMixin , you must ensure you\ndon’t invoke the permissions methods on ModelBackend . ModelBackend assumes that certain fields are available on your user model. If your user\nmodel doesn’t provide  those fields, you’ll receive database errors when\nyou check permissions. Custom users and proxy models ¶ One limitation of custom user models is that installing a custom user model\nwill break any proxy model extending User .\nProxy models must be based on a concrete base class; by defining a custom user\nmodel, you remove the ability of Django to reliably identify the base class. If your project uses proxy models, you must either modify the proxy to extend\nthe user model that’s in use in your project, or merge your proxy’s behavior\ninto your User subclass. A full example ¶ Here is an example of an admin-compliant custom user app. This user model uses\nan email address as the username, and has a required date of birth; it\nprovides no permission checking beyond an admin flag on the user account.\nThis model would be compatible with all the built-in auth forms and views,\nexcept for the user creation forms. This example illustrates how most of the\ncomponents work together, but is not intended to be copied directly into\nprojects for production use. This code would all live in a models.py file for a custom\nauthentication app: from django.db import models from django.contrib.auth.models import BaseUserManager , AbstractBaseUser class MyUserManager ( BaseUserManager ): def create_user ( self , email , date_of_birth , password = None ): \"\"\" Creates and saves a User with the given email, date of birth and password. \"\"\" if not email : raise ValueError ( \"Users must have an email address\" ) user = self . model ( email = self . normalize_email ( email ), date_of_birth = date_of_birth , ) user . set_password ( password ) user . save ( using = self . _db ) return user def create_superuser ( self , email , date_of_birth , password = None ): \"\"\" Creates and saves a superuser with the given email, date of birth and password. \"\"\" user = self . create_user ( email , password = password , date_of_birth = date_of_birth , ) user . is_admin = True user . save ( using = self . _db ) return user class MyUser ( AbstractBaseUser ): email = models . EmailField ( verbose_name = \"email address\" , max_length = 255 , unique = True , ) date_of_birth = models . DateField () is_active = models . BooleanField ( default = True ) is_admin = models . BooleanField ( default = False ) objects = MyUserManager () USERNAME_FIELD = \"email\" REQUIRED_FIELDS = [ \"date_of_birth\" ] def __str__ ( self ): return self . email def has_perm ( self , perm , obj = None ): \"Does the user have a specific permission?\" # Simplest possible answer: Yes, always return True def has_module_perms ( self , app_label ): \"Does the user have permissions to view the app `app_label`?\" # Simplest possible answer: Yes, always return True @property def is_staff ( self ): \"Is the user a member of staff?\" # Simplest possible answer: All admins are staff return self . is_admin Then, to register this custom user model with Django’s admin, the following\ncode would be required in the app’s admin.py file: from django import forms from django.contrib import admin from django.contrib.auth.models import Group from django.contrib.auth.admin import UserAdmin as BaseUserAdmin from django.contrib.auth.forms import ReadOnlyPasswordHashField from django.core.exceptions import ValidationError from customauth.models import MyUser class UserCreationForm ( forms . ModelForm ): \"\"\"A form for creating new users. Includes all the required fields, plus a repeated password.\"\"\" password1 = forms . CharField ( label = \"Password\" , widget = forms . PasswordInput ) password2 = forms . CharField ( label = \"Password confirmation\" , widget = forms . PasswordInput ) class Meta : model = MyUser fields = [ \"email\" , \"date_of_birth\" ] def clean_password2 ( self ): # Check that the two password entries match password1 = self . cleaned_data . get ( \"password1\" ) password2 = self . cleaned_data . get ( \"password2\" ) if password1 and password2 and password1 != password2 : raise ValidationError ( \"Passwords don't match\" ) return password2 def save ( self , commit = True ): # Save the provided password in hashed format user = super () . save ( commit = False ) user . set_password ( self . cleaned_data [ \"password1\" ]) if commit : user . save () return user class UserChangeForm ( forms . ModelForm ): \"\"\"A form for updating users. Includes all the fields on the user, but replaces the password field with admin's disabled password hash display field. \"\"\" password = ReadOnlyPasswordHashField () class Meta : model = MyUser fields = [ \"email\" , \"password\" , \"date_of_birth\" , \"is_active\" , \"is_admin\" ] class UserAdmin ( BaseUserAdmin ): # The forms to add and change user instances form = UserChangeForm add_form = UserCreationForm # The fields to be used in displaying the User model. # These override the definitions on the base UserAdmin # that reference specific fields on auth.User. list_display = [ \"email\" , \"date_of_birth\" , \"is_admin\" ] list_filter = [ \"is_admin\" ] fieldsets = [ ( None , { \"fields\" : [ \"email\" , \"password\" ]}), ( \"Personal info\" , { \"fields\" : [ \"date_of_birth\" ]}), ( \"Permissions\" , { \"fields\" : [ \"is_admin\" ]}), ] # add_fieldsets is not a standard ModelAdmin attribute. UserAdmin # overrides get_fieldsets to use this attribute when creating a user. add_fieldsets = [ ( None , { \"classes\" : [ \"wide\" ], \"fields\" : [ \"email\" , \"date_of_birth\" , \"password1\" , \"password2\" ], }, ), ] search_fields = [ \"email\" ] ordering = [ \"email\" ] filter_horizontal = [] # Now register the new UserAdmin... admin . site . register ( MyUser , UserAdmin ) # ... and, since we're not using Django's built-in permissions, # unregister the Group model from admin. admin . site . unregister ( Group ) Finally, specify the custom model as the default user model for your project\nusing the AUTH_USER_MODEL setting in your settings.py : AUTH_USER_MODEL = \"customauth.MyUser\"", "keywords": ["users", "accounts", "box", "employee", "pbkdf2_sha256$30000$vo0vlmnkr4bk$qevtdyzrwtcoscni", "with_perm", "feature", "receiver", "ldap", "create_user", "login", "circulardependencyerror", "emailfield", "assumes", "search_fields", "sender", "field", "#", "relation", "migrations", "loop", "stores", "match", "change_task_status", "identification", "member", "abstractuser", "cache", "datefield", "set_unusable_password", "needs", "get_full_name", "username_field", "change", "pwd_valid", "is_authenticated", "label", "hash", "django.core.exceptions", "=", "changes", "permissiondenied", "setup", "tables", "raw_password", "grants", "hashing", "height", "adminsite.has_permission", "choice", "customusermanager", "codename", "staff", "processing", "has_usable_password", "custom", "kwargs", "defines", "objects", "documentation", "to_field", "check_password", "file", "nfkc", "add_fieldsets", "user", "cases", "@override_settings(auth_user_model=", "attribute", "create_superuser", "mechanism", "has_perm(perm", "scenes", "settingsbackend", "date_of_birth", "time", "doesnotexist", "basis", "save", "date", "inlinemodeladmin", "setting", "purposes", "get_username", "components", "account", "app_label", "service", "customuser", ".models", "password", "passwordresetform", "name", "makemigrations", "is_superuser", "django.core.signals", "backends", "reference", "web", "django.contrib.auth", "greeting", "queries", "is_staff", "manager", "django.contrib.admin", "some_module", "addresses", "return", "applications", "duration", "define", "kinds", "fieldsets", "normalize_email", "@receiver", "username", "status", "relationships", "proxy", "error", "adminpasswordchangeform", "module", "code", "classmethod", "auth", "post_save_receiver", "invalidation", "false", "behavior", "usermodel", "access", "class", "link", "migration", "display", "info", "group", "resets", "customizing", "widget", "returns", "names", "u", "request", "customuseradmin", "database", "flag", "foreignkey(get_user_model", "signal", "*", "superset", "page", "outline", "migrate", "baseuseradmin", "strings", "floatfield", "subclass", "admin", "creation", "pair", "get_by_natural_key", "foundation", "auth_user_model", "script", "max_length", "clean_password2", "limitations", "get_fieldsets", "cleaned_data", "source", "customusercreationform", "permissionsmixin", "use", "sources", "credentials", "admin_password", "author", "django.contrib.auth.base_user", "get_user", "protection", "backends.py", "core", "charge", "pass", "order", "default", "advance", "userchangeform", "signals", "form", "oq7fvou1xaurizyooz3iq8dr4m=", "fred", "option", "format", "classes", "characters", "set_password", "get_user_permissions", "get_session_auth_fallback_hash", "booleanfield", "validationerror", "get_user(user_id", "scheme", "last_login", "session.objects.all().delete", "required_fields", "confirmation", "perm", "rate", "company", "createsuperuser", "limitation", "marks", "header", "onetoonefield", "schema", "way", "useradmin", "get_short_name", "super", "has_module_perms", "checks", "servers", "comments", "user_id", "session", "has_module_perms(app_label", "¶", "command", "prototype", "id", "parameters", "package_name", "can_delete", "employeeinline", "content", "function", "views", "@property", "result", "websites", "app.close_task", "permissions", "relations", "modelform", "def", "secret_key_fallbacks", "django.contrib", "string", "is_active", "acheck_password", "thing", "auto", "get_email_field_name", "user_obj", "verbose_name", "managers", "hand", "table", "inlines", "models", "history", "customauth.models", "version", "scenario", "ways", "level", "anonymoususer", "contents", "article", "minimum", "portion", "django", "myapp", "profile", "n’t", "freds_department", "user.is_staff", "fields", "modelbackend", "set", "django.db.models.signals", "db", "value", "get_session_auth_hash", "bit", "hierarchy", "data", "implementation", "base", "backend", "auth_permission", "task", "close_task", "inline", "has_perms", "identifier", "list_display", "django.contrib.auth.get_user_model", "self", "need", "instance", "primary_key", "handling", "mechanisms", "modeladmin", "functionality", "unicode", "closing", "myuser", "issues", "superuser", "login_valid", "descriptor", "assumptions", "instances", "authenticationmiddleware", "django.contrib.auth.admin", "installed_apps", "dependency", "references", "object", "fsmith", "load", "domain", "limiting", "authenticate", "groups", "valueerror", "httprequest", "charfield", "management", "django.contrib.auth.hashers", "sql", "utility", "points", "authors", "situations", "keyword", "ordering", "abstractbaseuser", "force", "stackedinline", "obj", "questions", "effect", "request.user", "system", "apps", "address", "passwordinput", "manner", "usermanager", "matters", "mybackend", "production", "definition", "usernames", "check", "site", "features", "forms", "’s", "tandem", "addition", "example", "care", "add_form", "app", "requirements", "list", "unregister", "django.apps", "answer", "filter_horizontal", "usercreationform", "has_perm", "email", "steps", "re", "get_all_permissions", "read", "model", "variable", "mid", "place", "systems", "application", "get_user_model", "django.contrib.auth.models", "actions", "attributes", "ability", "sense", "myusermanager", "hassle", "keys", "boolean", "authentication", "lookup", "authorization", "clean", "network", "errors", "get_group_permissions", "str", "arguments", "conventions", "normalization", "birth", "passwords", "package", "hmac", "administrator", "entries", "contrib", "comparison", "user.is_active", "kind", "path", "functions", "key", "django.contrib.auth.forms", "authenticationform", "none", "posting", "meta", "readonlypasswordhashfield", "definitions", "customauth", "framework", "authenticates", "true", "authenticate(request", "support", "myapp.models", "normalize_username", "basebackend", "projects", "document", "-", "password2", "permission", "magicadminbackend", "import", "cascade", "baseusermanager.normalize_email", "admins", "is_admin", "directory", "defaults", "foreignkey", "information", "python", "methods", "baseusermanager", "department", "optional", "times", "exception", "details", "password1", "method", "singleton", "django.db", "settings", "my_user_profile_app.models", "argument", "list_filter", "note", "sites", "tasks", "django.db.models.signals.post_save", "attacks", "smith", "project", "parts"], "type": "documentation"},
{"title": "Password management in Django | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/auth/passwords/", "content": "Password management in Django ¶ Password management is something that should generally not be reinvented\nunnecessarily, and Django endeavors to provide a secure and flexible set of\ntools for managing user passwords. This document describes how Django stores\npasswords, how the storage hashing can be configured, and some utilities to\nwork with hashed passwords. See also Even though users may use strong passwords, attackers might be able to\neavesdrop on their connections. Use HTTPS to avoid sending passwords (or any other\nsensitive data) over plain HTTP connections because they will be vulnerable\nto password sniffing. How Django stores passwords ¶ Django provides a flexible password storage system and uses PBKDF2 by default. The password attribute of a User object is a string in this format: <algorithm>$<iterations>$<salt>$<hash> Those are the components used for storing a User’s password, separated by the\ndollar-sign character and consist of: the hashing algorithm, the number of\nalgorithm iterations (work factor), the random salt, and the resulting password\nhash.  The algorithm is one of a number of one-way hashing or password storage\nalgorithms Django can use; see below. Iterations describe the number of times\nthe algorithm is run over the hash. Salt is the random seed used and the hash\nis the result of the one-way function. By default, Django uses the PBKDF2 algorithm with a SHA256 hash, a\npassword stretching mechanism recommended by NIST . This should be\nsufficient for most users: it’s quite secure, requiring massive\namounts of computing time to break. However, depending on your requirements, you may choose a different\nalgorithm, or even use a custom algorithm to match your specific\nsecurity situation. Again, most users shouldn’t need to do this – if\nyou’re not sure, you probably don’t.  If you do, please read on: Django chooses the algorithm to use by consulting the PASSWORD_HASHERS setting. This is a list of hashing algorithm\nclasses that this Django installation supports. For storing passwords, Django will use the first hasher in PASSWORD_HASHERS . To store new passwords with a different algorithm,\nput your preferred algorithm first in PASSWORD_HASHERS . For verifying passwords, Django will find the hasher in the list that matches\nthe algorithm name in the stored password. If a stored password names an\nalgorithm not found in PASSWORD_HASHERS , trying to verify it will\nraise ValueError . The default for PASSWORD_HASHERS is: PASSWORD_HASHERS = [ \"django.contrib.auth.hashers.PBKDF2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher\" , \"django.contrib.auth.hashers.Argon2PasswordHasher\" , \"django.contrib.auth.hashers.BCryptSHA256PasswordHasher\" , \"django.contrib.auth.hashers.ScryptPasswordHasher\" , ] This means that Django will use PBKDF2 to store all passwords but will support\nchecking passwords stored with PBKDF2SHA1, argon2 , and bcrypt . The next few sections describe a couple of common ways advanced users may want\nto modify this setting. Using Argon2 with Django ¶ Argon2 is the winner of the 2015 Password Hashing Competition , a community\norganized open competition to select a next generation hashing algorithm. It’s\ndesigned not to be easier to compute on custom hardware than it is to compute\non an ordinary CPU. The default variant for the Argon2 password hasher is\nArgon2id. Argon2 is not the default for Django because it requires a third-party\nlibrary. The Password Hashing Competition panel, however, recommends immediate\nuse of Argon2 rather than the other algorithms supported by Django. To use Argon2id as your default storage algorithm, do the following: Install the argon2-cffi package. This can be done by running python -m pip install django[argon2] , which is equivalent to python -m pip install argon2-cffi (along with any version requirement\nfrom Django’s pyproject.toml ). Modify PASSWORD_HASHERS to list Argon2PasswordHasher first.\nThat is, in your settings file, you’d put: PASSWORD_HASHERS = [ \"django.contrib.auth.hashers.Argon2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher\" , \"django.contrib.auth.hashers.BCryptSHA256PasswordHasher\" , \"django.contrib.auth.hashers.ScryptPasswordHasher\" , ] Keep and/or add any entries in this list if you need Django to upgrade\npasswords . Using bcrypt with Django ¶ Bcrypt is a popular password storage algorithm that’s specifically designed\nfor long-term password storage. It’s not the default used by Django since it\nrequires the use of third-party libraries, but since many people may want to\nuse it Django supports bcrypt with minimal effort. To use Bcrypt as your default storage algorithm, do the following: Install the bcrypt package. This can be done by running python -m pip install django[bcrypt] , which is equivalent to python -m pip install bcrypt (along with any version requirement from\nDjango’s pyproject.toml ). Modify PASSWORD_HASHERS to list BCryptSHA256PasswordHasher first. That is, in your settings file, you’d put: PASSWORD_HASHERS = [ \"django.contrib.auth.hashers.BCryptSHA256PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher\" , \"django.contrib.auth.hashers.Argon2PasswordHasher\" , \"django.contrib.auth.hashers.ScryptPasswordHasher\" , ] Keep and/or add any entries in this list if you need Django to upgrade\npasswords . That’s it – now your Django install will use Bcrypt as the default storage\nalgorithm. Using scrypt with Django ¶ scrypt is similar to PBKDF2 and bcrypt in utilizing a set number of iterations\nto slow down brute-force attacks. However, because PBKDF2 and bcrypt do not\nrequire a lot of memory, attackers with sufficient resources can launch\nlarge-scale parallel attacks in order to speed up the attacking process. scrypt is specifically designed to use more memory compared to other\npassword-based key derivation functions in order to limit the amount of\nparallelism an attacker can use, see RFC 7914 for more details. To use scrypt as your default storage algorithm, do the following: Modify PASSWORD_HASHERS to list ScryptPasswordHasher first.\nThat is, in your settings file: PASSWORD_HASHERS = [ \"django.contrib.auth.hashers.ScryptPasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher\" , \"django.contrib.auth.hashers.Argon2PasswordHasher\" , \"django.contrib.auth.hashers.BCryptSHA256PasswordHasher\" , ] Keep and/or add any entries in this list if you need Django to upgrade\npasswords . Note scrypt requires OpenSSL 1.1+. Increasing the salt entropy ¶ Most password hashes include a salt along with their password hash in order to\nprotect against rainbow table attacks. The salt itself is a random value which\nincreases the size and thus the cost of the rainbow table and is currently set\nat 128 bits with the salt_entropy value in the BasePasswordHasher . As\ncomputing and storage costs decrease this value should be raised. When\nimplementing your own password hasher you are free to override this value in\norder to use a desired entropy level for your password hashes. salt_entropy is measured in bits. Implementation detail Due to the method in which salt values are stored the salt_entropy value is effectively a minimum value. For instance a value of 128 would\nprovide a salt which would actually contain 131 bits of entropy. Increasing the work factor ¶ PBKDF2 and bcrypt ¶ The PBKDF2 and bcrypt algorithms use a number of iterations or rounds of\nhashing. This deliberately slows down attackers, making attacks against hashed\npasswords harder. However, as computing power increases, the number of\niterations needs to be increased. We’ve chosen a reasonable default (and will\nincrease it with each release of Django), but you may wish to tune it up or\ndown, depending on your security needs and available processing power. To do so,\nyou’ll subclass the appropriate algorithm and override the iterations parameter (use the rounds parameter when subclassing a bcrypt hasher). For\nexample, to increase the number of iterations used by the default PBKDF2\nalgorithm: Create a subclass of django.contrib.auth.hashers.PBKDF2PasswordHasher from django.contrib.auth.hashers import PBKDF2PasswordHasher class MyPBKDF2PasswordHasher ( PBKDF2PasswordHasher ): \"\"\" A subclass of PBKDF2PasswordHasher that uses 100 times more iterations. \"\"\" iterations = PBKDF2PasswordHasher . iterations * 100 Save this somewhere in your project. For example, you might put this in\na file like myproject/hashers.py . Add your new hasher as the first entry in PASSWORD_HASHERS : PASSWORD_HASHERS = [ \"myproject.hashers.MyPBKDF2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher\" , \"django.contrib.auth.hashers.Argon2PasswordHasher\" , \"django.contrib.auth.hashers.BCryptSHA256PasswordHasher\" , \"django.contrib.auth.hashers.ScryptPasswordHasher\" , ] That’s it – now your Django install will use more iterations when it\nstores passwords using PBKDF2. Note bcrypt rounds is a logarithmic work factor, e.g. 12 rounds means 2 ** 12 iterations. Argon2 ¶ Argon2 has the following attributes that can be customized: time_cost controls the number of iterations within the hash. memory_cost controls the size of memory that must be used during the\ncomputation of the hash. parallelism controls how many CPUs the computation of the hash can be\nparallelized on. The default values of these attributes are probably fine for you. If you\ndetermine that the password hash is too fast or too slow, you can tweak it as\nfollows: Choose parallelism to be the number of threads you can\nspare computing the hash. Choose memory_cost to be the KiB of memory you can spare. Adjust time_cost and measure the time hashing a password takes.\nPick a time_cost that takes an acceptable time for you.\nIf time_cost set to 1 is unacceptably slow, lower memory_cost . memory_cost interpretation The argon2 command-line utility and some other libraries interpret the memory_cost parameter differently from the value that Django uses. The\nconversion is given by memory_cost == 2 ** memory_cost_commandline . scrypt ¶ scrypt has the following attributes that can be customized: work_factor controls the number of iterations within the hash. block_size parallelism controls how many threads will run in parallel. maxmem limits the maximum size of memory that can be used during the\ncomputation of the hash. Defaults to 0 , which means the default\nlimitation from the OpenSSL library. We’ve chosen reasonable defaults, but you may wish to tune it up or down,\ndepending on your security needs and available processing power. Estimating memory usage The minimum memory requirement of scrypt is: work_factor * 2 * block_size * 64 so you may need to tweak maxmem when changing the work_factor or block_size values. Password upgrading ¶ When users log in, if their passwords are stored with anything other than\nthe preferred algorithm, Django will automatically upgrade the algorithm\nto the preferred one. This means that old installs of Django will get\nautomatically more secure as users log in, and it also means that you\ncan switch to new (and better) storage algorithms as they get invented. However, Django can only upgrade passwords that use algorithms mentioned in PASSWORD_HASHERS , so as you upgrade to new systems you should make\nsure never to remove entries from this list. If you do, users using\nunmentioned algorithms won’t be able to upgrade. Hashed passwords will be\nupdated when increasing (or decreasing) the number of PBKDF2 iterations, bcrypt\nrounds, or argon2 attributes. Be aware that if all the passwords in your database aren’t encoded in the\ndefault hasher’s algorithm, you may be vulnerable to a user enumeration timing\nattack due to a difference between the duration of a login request for a user\nwith a password encoded in a non-default algorithm and the duration of a login\nrequest for a nonexistent user (which runs the default hasher). You may be able\nto mitigate this by upgrading older password hashes . Password upgrading without requiring a login ¶ If you have an existing database with an older, weak hash such as MD5, you\nmight want to upgrade those hashes yourself instead of waiting for the upgrade\nto happen when a user logs in (which may never happen if a user doesn’t return\nto your site). In this case, you can use a “wrapped” password hasher. For this example, we’ll migrate a collection of MD5 hashes to use\nPBKDF2(MD5(password)) and add the corresponding password hasher for checking\nif a user entered the correct password on login. We assume we’re using the\nbuilt-in User model and that our project has an accounts app. You can\nmodify the pattern to work with any algorithm or with a custom user model. First, we’ll add the custom hasher: accounts/hashers.py ¶ from django.contrib.auth.hashers import ( PBKDF2PasswordHasher , MD5PasswordHasher , ) class PBKDF2WrappedMD5PasswordHasher ( PBKDF2PasswordHasher ): algorithm = \"pbkdf2_wrapped_md5\" def encode_md5_hash ( self , md5_hash , salt , iterations = None ): return super () . encode ( md5_hash , salt , iterations ) def encode ( self , password , salt , iterations = None ): _ , _ , md5_hash = MD5PasswordHasher () . encode ( password , salt ) . split ( \"$\" , 2 ) return self . encode_md5_hash ( md5_hash , salt , iterations ) The data migration might look something like: accounts/migrations/0002_migrate_md5_passwords.py ¶ from django.db import migrations from ..hashers import PBKDF2WrappedMD5PasswordHasher def forwards_func ( apps , schema_editor ): User = apps . get_model ( \"auth\" , \"User\" ) users = User . objects . filter ( password__startswith = \"md5$\" ) hasher = PBKDF2WrappedMD5PasswordHasher () for user in users : algorithm , salt , md5_hash = user . password . split ( \"$\" , 2 ) user . password = hasher . encode_md5_hash ( md5_hash , salt ) user . save ( update_fields = [ \"password\" ]) class Migration ( migrations . Migration ): dependencies = [ ( \"accounts\" , \"0001_initial\" ), # replace this with the latest migration in contrib.auth ( \"auth\" , \"####_migration_name\" ), ] operations = [ migrations . RunPython ( forwards_func ), ] Be aware that this migration will take on the order of several minutes for\nseveral thousand users, depending on the speed of your hardware. Finally, we’ll add a PASSWORD_HASHERS setting: mysite/settings.py ¶ PASSWORD_HASHERS = [ \"django.contrib.auth.hashers.PBKDF2PasswordHasher\" , \"accounts.hashers.PBKDF2WrappedMD5PasswordHasher\" , ] Include any other hashers that your site uses in this list. Included hashers ¶ The full list of hashers included in Django is: [ \"django.contrib.auth.hashers.PBKDF2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher\" , \"django.contrib.auth.hashers.Argon2PasswordHasher\" , \"django.contrib.auth.hashers.BCryptSHA256PasswordHasher\" , \"django.contrib.auth.hashers.BCryptPasswordHasher\" , \"django.contrib.auth.hashers.ScryptPasswordHasher\" , \"django.contrib.auth.hashers.MD5PasswordHasher\" , ] The corresponding algorithm names are: pbkdf2_sha256 pbkdf2_sha1 argon2 bcrypt_sha256 bcrypt scrypt md5 Writing your own hasher ¶ If you write your own password hasher that contains a work factor such as a\nnumber of iterations, you should implement a harden_runtime(self, password, encoded) method to bridge the runtime gap\nbetween the work factor supplied in the encoded password and the default\nwork factor of the hasher. This prevents a user enumeration timing attack due\nto  difference between a login request for a user with a password encoded in an\nolder number of iterations and a nonexistent user (which runs the default\nhasher’s default number of iterations). Taking PBKDF2 as example, if encoded contains 20,000 iterations and the\nhasher’s default iterations is 30,000, the method should run password through another 10,000 iterations of PBKDF2. If your hasher doesn’t have a work factor, implement the method as a no-op\n( pass ). Manually managing a user’s password ¶ The django.contrib.auth.hashers module provides a set of functions\nto create and validate hashed passwords. You can use them independently\nfrom the User model. check_password ( password , encoded , setter = None , preferred = 'default' ) [source] ¶ acheck_password ( password , encoded , asetter = None , preferred = 'default' ) ¶ Asynchronous version : acheck_password() If you’d like to manually authenticate a user by comparing a plain-text\npassword to the hashed password in the database, use the convenience\nfunction check_password() . It takes two mandatory arguments: the\nplain-text password to check, and the full value of a user’s password field in the database to check against. It returns True if they match, False otherwise. Optionally, you can pass a callable setter that\ntakes the password and will be called when you need to regenerate it. You\ncan also pass preferred to change a hashing algorithm if you don’t want\nto use the default (first entry of PASSWORD_HASHERS setting). See Included hashers for the algorithm name of each hasher. Changed in Django 5.0: acheck_password() method was added. make_password ( password , salt = None , hasher = 'default' ) [source] ¶ Creates a hashed password in the format used by this application. It takes\none mandatory argument: the password in plain-text (string or bytes).\nOptionally, you can provide a salt and a hashing algorithm to use, if you\ndon’t want to use the defaults (first entry of PASSWORD_HASHERS setting). See Included hashers for the algorithm name of each\nhasher. If the password argument is None , an unusable password is\nreturned (one that will never be accepted by check_password() ). is_password_usable ( encoded_password ) [source] ¶ Returns False if the password is a result of User.set_unusable_password() . Password validation ¶ Users often choose poor passwords. To help mitigate this problem, Django\noffers pluggable password validation. You can configure multiple password\nvalidators at the same time. A few validators are included in Django, but you\ncan write your own as well. Each password validator must provide a help text to explain the requirements to\nthe user, validate a given password and return an error message if it does not\nmeet the requirements, and optionally define a callback to be notified when\nthe password for a user has been changed. Validators can also have optional\nsettings to fine tune their behavior. Validation is controlled by the AUTH_PASSWORD_VALIDATORS setting.\nThe default for the setting is an empty list, which means no validators are\napplied. In new projects created with the default startproject template, a set of validators is enabled by default. By default, validators are used in the forms to reset or change passwords and\nin the createsuperuser and changepassword management\ncommands. Validators aren’t applied at the model level, for example in User.objects.create_user() and create_superuser() , because we assume\nthat developers, not users, interact with Django at that level and also because\nmodel validation doesn’t automatically run as part of creating models. Note Password validation can prevent the use of many types of weak passwords.\nHowever, the fact that a password passes all the validators doesn’t\nguarantee that it is a strong password. There are many factors that can\nweaken a password that are not detectable by even the most advanced\npassword validators. Enabling password validation ¶ Password validation is configured in the AUTH_PASSWORD_VALIDATORS setting: AUTH_PASSWORD_VALIDATORS = [ { \"NAME\" : \"django.contrib.auth.password_validation.UserAttributeSimilarityValidator\" , }, { \"NAME\" : \"django.contrib.auth.password_validation.MinimumLengthValidator\" , \"OPTIONS\" : { \"min_length\" : 9 , }, }, { \"NAME\" : \"django.contrib.auth.password_validation.CommonPasswordValidator\" , }, { \"NAME\" : \"django.contrib.auth.password_validation.NumericPasswordValidator\" , }, ] This example enables all four included validators: UserAttributeSimilarityValidator , which checks the similarity between\nthe password and a set of attributes of the user. MinimumLengthValidator , which checks whether the password meets a minimum\nlength. This validator is configured with a custom option: it now requires\nthe minimum length to be nine characters, instead of the default eight. CommonPasswordValidator , which checks whether the password occurs in a\nlist of common passwords. By default, it compares to an included list of\n20,000 common passwords. NumericPasswordValidator , which checks whether the password isn’t\nentirely numeric. For UserAttributeSimilarityValidator and CommonPasswordValidator ,\nwe’re using the default settings in this example. NumericPasswordValidator has no settings. The help texts and any errors from password validators are always returned in\nthe order they are listed in AUTH_PASSWORD_VALIDATORS . Included validators ¶ Django includes four validators: class MinimumLengthValidator ( min_length = 8 ) [source] ¶ Validates that the password is of a minimum length.\nThe minimum length can be customized with the min_length parameter. class UserAttributeSimilarityValidator ( user_attributes = DEFAULT_USER_ATTRIBUTES , max_similarity = 0.7 ) [source] ¶ Validates that the password is sufficiently different from certain\nattributes of the user. The user_attributes parameter should be an iterable of names of user\nattributes to compare to. If this argument is not provided, the default\nis used: 'username', 'first_name', 'last_name', 'email' .\nAttributes that don’t exist are ignored. The maximum allowed similarity of passwords can be set on a scale of 0.1\nto 1.0 with the max_similarity parameter. This is compared to the\nresult of difflib.SequenceMatcher.quick_ratio() . A value of 0.1\nrejects passwords unless they are substantially different from the user_attributes , whereas a value of 1.0 rejects only passwords that are\nidentical to an attribute’s value. class CommonPasswordValidator ( password_list_path = DEFAULT_PASSWORD_LIST_PATH ) [source] ¶ Validates that the password is not a common password. This converts the\npassword to lowercase (to do a case-insensitive comparison) and checks it\nagainst a list of 20,000 common password created by Royce Williams . The password_list_path can be set to the path of a custom file of\ncommon passwords. This file should contain one lowercase password per line\nand may be plain text or gzipped. class NumericPasswordValidator [source] ¶ Validate that the password is not entirely numeric. Integrating validation ¶ There are a few functions in django.contrib.auth.password_validation that\nyou can call from your own forms or other code to integrate password\nvalidation. This can be useful if you use custom forms for password setting,\nor if you have API calls that allow passwords to be set, for example. validate_password ( password , user = None , password_validators = None ) [source] ¶ Validates a password. If all validators find the password valid, returns None . If one or more validators reject the password, raises a ValidationError with all the error messages\nfrom the validators. The user object is optional: if it’s not provided, some validators may\nnot be able to perform any validation and will accept any password. password_changed ( password , user = None , password_validators = None ) [source] ¶ Informs all validators that the password has been changed. This can be used\nby validators such as one that prevents password reuse. This should be\ncalled once the password has been successfully changed. For subclasses of AbstractBaseUser ,\nthe password field will be marked as “dirty” when calling set_password() which\ntriggers a call to password_changed() after the user is saved. password_validators_help_texts ( password_validators = None ) [source] ¶ Returns a list of the help texts of all validators. These explain the\npassword requirements to the user. password_validators_help_text_html ( password_validators = None ) ¶ Returns an HTML string with all help texts in an <ul> . This is\nhelpful when adding password validation to forms, as you can pass the\noutput directly to the help_text parameter of a form field. get_password_validators ( validator_config ) [source] ¶ Returns a set of validator objects based on the validator_config parameter. By default, all functions use the validators defined in AUTH_PASSWORD_VALIDATORS , but by calling this function with an\nalternate set of validators and then passing the result into the password_validators parameter of the other functions, your custom set\nof validators will be used instead. This is useful when you have a typical\nset of validators to use for most scenarios, but also have a special\nsituation that requires a custom set. If you always use the same set\nof validators, there is no need to use this function, as the configuration\nfrom AUTH_PASSWORD_VALIDATORS is used by default. The structure of validator_config is identical to the\nstructure of AUTH_PASSWORD_VALIDATORS . The return value of\nthis function can be passed into the password_validators parameter\nof the functions listed above. Note that where the password is passed to one of these functions, this should\nalways be the clear text password - not a hashed password. Writing your own validator ¶ If Django’s built-in validators are not sufficient, you can write your own\npassword validators. Validators have a fairly small interface. They must\nimplement two methods: validate(self, password, user=None) : validate a password. Return None if the password is valid, or raise a ValidationError with an error message if the\npassword is not valid. You must be able to deal with user being None - if that means your validator can’t run, return None for no\nerror. get_help_text() : provide a help text to explain the requirements to\nthe user. Any items in the OPTIONS in AUTH_PASSWORD_VALIDATORS for your\nvalidator will be passed to the constructor. All constructor arguments should\nhave a default value. Here’s a basic example of a validator, with one optional setting: from django.core.exceptions import ValidationError from django.utils.translation import gettext as _ class MinimumLengthValidator : def __init__ ( self , min_length = 8 ): self . min_length = min_length def validate ( self , password , user = None ): if len ( password ) < self . min_length : raise ValidationError ( _ ( \"This password must contain at least %(min_length)d characters.\" ), code = \"password_too_short\" , params = { \"min_length\" : self . min_length }, ) def get_help_text ( self ): return _ ( \"Your password must contain at least %(min_length)d characters.\" % { \"min_length\" : self . min_length } ) You can also implement password_changed(password, user=None ), which will\nbe called after a successful password change. That can be used to prevent\npassword reuse, for example. However, if you decide to store a user’s previous\npasswords, you should never do so in clear text.", "keywords": ["users", "accounts", "pbkdf2(md5(password", "verifying", "storage", "pattern", "login", "factors", "messages", "migrations/0002_migrate_md5_passwords.py", "password_too_short", "mypbkdf2passwordhasher", "django[argon2", "library", "validator_config", "field", "#", "encode_md5_hash", "migrations", "difflib", "bits", "stores", "pyproject.toml", "get_model", "needs", "change", "memory_cost_commandline", "https", "pbkdf2_sha256", "get_password_validators", "http", "hash", "cpu", "=", "django.core.exceptions", "williams", "message", "installation", "fact", "character", "pip", "hashing", "process", "reuse", "royce", "cost", "collection", "stretching", "scale", "processing", "variant", "validate_password", "people", "custom", "calls", "objects", "check_password", "file", "work", "user", "django.utils.translation", "attribute", "create_superuser", "mechanism", "maximum", "size", "developers", "setter", "time", "install", "cpus", "setting", "entropy", "components", "password", "userattributesimilarityvalidator", "name", "get_help_text", "parameter", "min_length", "upgrade", "min_length)d", "return", "encode", "memory", "computation", "situation", "timing", "duration", "maxmem", "requirement", "costs", "error", "module", "code", "algorithm", "informs", "auth", "filter", "false", "behavior", "class", "migration", "forwards_func", "returns", "names", "pbkdf2", "attack", "request", "database", "output", "amounts", "commands", "types", "subclass", "gap", "usage", "configuration", "effort", "validation", "texts", "validator", "source", "salt", "use", "cffi", "endeavors", "pbkdf2sha1", "django[bcrypt", "numericpasswordvalidator", "gettext", "subclasses", "enumeration", "order", "commonpasswordvalidator", "default", "password_validators_help_texts", "params", "attackers", "form", "option", "format", "callback", "classes", "help", "characters", "set_password", "pbkdf2_wrapped_md5", "bcrypt", "scrypt", "convenience", "validationerror", "contrib.auth", "len", "createsuperuser", "limitation", "template", "default_password_list_path", "password_changed(password", "mysite", "way", "validate(self", "harden_runtime(self", "validate", "op", "party", "rounds", "argon2id", "¶", "bytes", "command", "installs", "memory_cost", "asetter", "function", "result", "user.objects.create_user", "number", "lot", "def", "values", "pbkdf2passwordhasher", "string", "basepasswordhasher", "_", "acheck_password", "connections", "libraries", "table", "nist", "default_user_attributes", "models", "version", "ways", "level", "auth_password_validators", "sniffing", "django", "rfc", "n’t", "pbkdf2_sha1", "utilities", "entry", "password_hashers", "set", "hardware", "power", "lowercase", "value", "line", "tune", "data", "implementation", "resources", "sha256", "iterable", "security", "ul", "self", "need", "instance", "speed", "interface", "validators", "user.set_unusable_password", "constructor", "derivation", "structure", "checking", "dollar", "part", "myproject.hashers", "rejects", "object", "argon2", "couple", "valueerror", "management", "django.contrib.auth.hashers", "interpretation", "utility", "update_fields", "abstractbaseuser", "conversion", "force", "attacker", "parallelism", "runpython", "detail", "system", "apps", "settings.py", "dependencies", "items", "md5passwordhasher", "difference", "competition", "site", "forms", "’s", "algorithms", "rainbow", "example", "app", "requirements", "parallel", "validates", "list", "minutes", "minimumlengthvalidator", "md5_hash", "hasher", "community", "email", "scryptpasswordhasher", "md5", "model", "hashes", "sections", "systems", "application", "increases", "attributes", "argon2passwordhasher", "django.contrib.auth.password_validation", "release", "password_validators_help_text_html", "panel", "user_attributes", "seed", "case", "length", "attacking", "runtime", "errors", "html", "arguments", "passwords", "package", "init", "generation", "entries", "comparison", "startproject", "last_name", "amount", "accounts.hashers", "path", "functions", "hashers", "term", "operations", "none", "factor", "problem", "bcryptsha256passwordhasher", "sign", "time_cost", "similarity", "changepassword", "api", "work_factor", "projects", "document", "winner", "threads", "import", "password_list_path", "migration_name", "%", "defaults", "iterations", "max_similarity", "call", "pbkdf2wrappedmd5passwordhasher", "python", "password_validators", "methods", "options", "times", "upgrading", "details", "method", "computing", "settings", "argument", "note", "attacks", "tools", "openssl", "scenarios", "kib", "text", "project"], "type": "documentation"},
{"title": "Conditional View Processing | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/conditional-view-processing/", "content": "Conditional View Processing ¶ HTTP clients can send a number of headers to tell the server about copies of a\nresource that they have already seen. This is commonly used when retrieving a\nweb page (using an HTTP GET request) to avoid sending all the data for\nsomething the client has already retrieved. However, the same headers can be\nused for all HTTP methods ( POST , PUT , DELETE , etc.). For each page (response) that Django sends back from a view, it might provide\ntwo HTTP headers: the ETag header and the Last-Modified header. These\nheaders are optional on HTTP responses. They can be set by your view function,\nor you can rely on the ConditionalGetMiddleware middleware to set the ETag header. When the client next requests the same resource, it might send along a header\nsuch as either If-Modified-Since or If-Unmodified-Since , containing the date of the\nlast modification time it was sent, or either If-Match or If-None-Match ,\ncontaining the last ETag it was sent. If the current version of the page\nmatches the ETag sent by the client, or if the resource has not been\nmodified, a 304 status code can be sent back, instead of a full response,\ntelling the client that nothing has changed.  Depending on the header, if the\npage has been modified or does not match the ETag sent by the client, a 412\nstatus code (Precondition Failed) may be returned. When you need more fine-grained control you may use per-view conditional\nprocessing functions. The condition decorator ¶ Sometimes (in fact, quite often) you can create functions to rapidly compute\nthe ETag value or the last-modified time for a\nresource, without needing to do all the computations needed to construct\nthe full view. Django can then use these functions to provide an\n“early bailout” option for the view processing. Telling the client that the\ncontent has not been modified since the last request, perhaps. These two functions are passed as parameters to the django.views.decorators.http.condition decorator. This decorator uses\nthe two functions (you only need to supply one, if you can’t compute both\nquantities easily and quickly) to work out if the headers in the HTTP request\nmatch those on the resource. If they don’t match, a new copy of the resource\nmust be computed and your normal view is called. The condition decorator’s signature looks like this: condition ( etag_func = None , last_modified_func = None ) The two functions, to compute the ETag and the last modified time, will be\npassed the incoming request object and the same parameters, in the same\norder, as the view function they are helping to wrap. The function passed last_modified_func should return a standard datetime value specifying the\nlast time the resource was modified, or None if the resource doesn’t\nexist. The function passed to the etag decorator should return a string\nrepresenting the ETag for the resource, or None if it doesn’t exist. The decorator sets the ETag and Last-Modified headers on the response\nif they are not already set by the view and if the request’s method is safe\n( GET or HEAD ). Using this feature usefully is probably best explained with an example.\nSuppose you have this pair of models, representing a small blog system: import datetime from django.db import models class Blog ( models . Model ): ... class Entry ( models . Model ): blog = models . ForeignKey ( Blog , on_delete = models . CASCADE ) published = models . DateTimeField ( default = datetime . datetime . now ) ... If the front page, displaying the latest blog entries, only changes when you\nadd a new blog entry, you can compute the last modified time very quickly. You\nneed the latest published date for every entry associated with that blog.\nOne way to do this would be: def latest_entry ( request , blog_id ): return Entry . objects . filter ( blog = blog_id ) . latest ( \"published\" ) . published You can then use this function to provide early detection of an unchanged page\nfor your front page view: from django.views.decorators.http import condition @condition ( last_modified_func = latest_entry ) def front_page ( request , blog_id ): ... Be careful with the order of decorators When condition() returns a conditional response, any decorators below\nit will be skipped and won’t apply to the response. Therefore, any\ndecorators that need to apply to both the regular view response and a\nconditional response must be above condition() . In particular, vary_on_cookie() , vary_on_headers() , and cache_control() should come first\nbecause RFC 9110 requires that the headers\nthey set be present on 304 responses. Shortcuts for only computing one value ¶ As a general rule, if you can provide functions to compute both the ETag and\nthe last modified time, you should do so. You don’t know which headers any\ngiven HTTP client will send you, so be prepared to handle both. However,\nsometimes only one value is easy to compute and Django provides decorators\nthat handle only ETag or only last-modified computations. The django.views.decorators.http.etag and django.views.decorators.http.last_modified decorators are passed the same\ntype of functions as the condition decorator. Their signatures are: etag ( etag_func ) last_modified ( last_modified_func ) We could write the earlier example, which only uses a last-modified function,\nusing one of these decorators: @last_modified ( latest_entry ) def front_page ( request , blog_id ): ... …or: def front_page ( request , blog_id ): ... front_page = last_modified ( latest_entry )( front_page ) Use condition when testing both conditions ¶ It might look nicer to some people to try and chain the etag and last_modified decorators if you want to test both preconditions. However,\nthis would lead to incorrect behavior. # Bad code. Don't do this! @etag ( etag_func ) @last_modified ( last_modified_func ) def my_view ( request ): ... # End of bad code. The first decorator doesn’t know anything about the second and might\nanswer that the response is not modified even if the second decorators would\ndetermine otherwise. The condition decorator uses both callback functions\nsimultaneously to work out the right action to take. Using the decorators with other HTTP methods ¶ The condition decorator is useful for more than only GET and HEAD requests ( HEAD requests are the same as GET in this\nsituation). It can also be used to provide checking for POST , PUT and DELETE requests. In these situations, the idea isn’t to return\na “not modified” response, but to tell the client that the resource they are\ntrying to change has been altered in the meantime. For example, consider the following exchange between the client and server: Client requests /foo/ . Server responds with some content with an ETag of \"abcd1234\" . Client sends an HTTP PUT request to /foo/ to update the\nresource. It also sends an If-Match: \"abcd1234\" header to specify\nthe version it is trying to update. Server checks to see if the resource has changed, by computing the ETag\nthe same way it does for a GET request (using the same function).\nIf the resource has changed, it will return a 412 status code,\nmeaning “precondition failed”. Client sends a GET request to /foo/ , after receiving a 412\nresponse, to retrieve an updated version of the content before updating\nit. The important thing this example shows is that the same functions can be used\nto compute the ETag and last modification values in all situations. In fact,\nyou should use the same functions, so that the same values are returned\nevery time. Validator headers with non-safe request methods The condition decorator only sets validator headers ( ETag and Last-Modified ) for safe HTTP methods, i.e. GET and HEAD . If you\nwish to return them in other cases, set them in your view. See RFC 9110 Section 9.3.4 to learn about the distinction between setting a\nvalidator header in response to requests made with PUT versus POST . Comparison with middleware conditional processing ¶ Django provides conditional GET handling via django.middleware.http.ConditionalGetMiddleware . While being suitable\nfor many situations, the middleware has limitations for advanced usage: It’s applied globally to all views in your project. It doesn’t save you from generating the response, which may be expensive. It’s only appropriate for HTTP GET requests. You should choose the most appropriate tool for your particular problem here.\nIf you have a way to compute ETags and modification times quickly and if some\nview takes a while to generate the content, you should consider using the condition decorator described in this document. If everything already runs\nfairly quickly, stick to using the middleware and the amount of network\ntraffic sent back to the clients will still be reduced if the view hasn’t\nchanged.", "keywords": ["function", "views", "view", "feature", "control", "django.views.decorators.http", "distinction", "status", "number", "modified", "headers", "bailout", "def", "conditions", "code", "etag_func", "values", "filter", "string", "behavior", "class", "example", "preconditions", "#", "thing", "vary_on_cookie", "detection", "request", "while", "traffic", "precondition", "exchange", "action", "models", "match", "copy", "page", "version", "model", "if", "tool", "idea", "etag", "latest_entry", "pair", "usage", "condition", "django", "http", "django.views.decorators.http.etag", "=", "changes", "rfc", "n’t", "django.middleware.http", "blog_id", "head", "entry", "@etag", "fact", "clients", "limitations", "conditionalgetmiddleware", "value", "last_modified_func", "section", "validator", "data", "quantities", "datetime", "use", "since", "network", "failed", "server", "type", "processing", "middleware", "people", "end", "abcd1234", "entries", "comparison", "@condition", "delete", "order", "signature", "default", "amount", "django.views.decorators.http.condition", "cases", "functions", "shortcuts", "my_view", "none", "option", "callback", "problem", "decorator", "etags", "get", "time", "sometimes", "meantime", "vary_on_headers", "signatures", "date", "responses", "checking", "object", "document", "import", "computations", "put", "response", "rule", "header", "requests", "foreignkey", "way", "copies", "situations", "web", "checks", "methods", "modification", "times", "resource", "client", "front_page", "method", "decorators", "¶", "return", "post", "parameters", "situation", "system", "blog", "content", "project", "datetimefield"], "type": "documentation"},
{"title": "Django 3.1 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/3.1/", "content": "Django 3.1 release notes ¶ August 4, 2020 Welcome to Django 3.1! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 3.0 or earlier. We’ve dropped some features that have reached the end of\ntheir deprecation cycle, and we’ve begun the deprecation process for\nsome features . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Python compatibility ¶ Django 3.1 supports Python 3.6, 3.7, 3.8, and 3.9 (as of 3.1.3). We highly\nrecommend and only officially support the latest release of each series. What’s new in Django 3.1 ¶ Asynchronous views and middleware support ¶ Django now supports a fully asynchronous request path, including: Asynchronous views Asynchronous middleware Asynchronous tests and test client To get started with async views, you need to declare a view using async def : async def my_view ( request ): await asyncio . sleep ( 0.5 ) return HttpResponse ( \"Hello, async world!\" ) All asynchronous features are supported whether you are running under WSGI or\nASGI mode. However, there will be performance penalties using async code in\nWSGI mode. You can read more about the specifics in Asynchronous support documentation. You are free to mix async and sync views, middleware, and tests as much as you\nwant. Django will ensure that you always end up with the right execution\ncontext. We expect most projects will keep the majority of their views\nsynchronous, and only have a select few running in async mode - but it is\nentirely your choice. Django’s ORM, cache layer, and other pieces of code that do long-running\nnetwork calls do not yet support async access. We expect to add support for\nthem in upcoming releases. Async views are ideal, however, if you are doing a\nlot of API or HTTP calls inside your view, you can now natively do all those\nHTTP calls in parallel to considerably speed up your view’s execution. Asynchronous support should be entirely backwards-compatible and we have tried\nto ensure that it has no speed regressions for your existing, synchronous code.\nIt should have no noticeable effect on any existing Django projects. JSONField for all supported database backends ¶ Django now includes models.JSONField and forms.JSONField that can be used on all\nsupported database backends. Both fields support the use of custom JSON\nencoders and decoders. The model field supports the introspection, lookups, and transforms that were previously\nPostgreSQL-only: from django.db import models class ContactInfo ( models . Model ): data = models . JSONField () ContactInfo . objects . create ( data = { \"name\" : \"John\" , \"cities\" : [ \"London\" , \"Cambridge\" ], \"pets\" : { \"dogs\" : [ \"Rufus\" , \"Meg\" ]}, } ) ContactInfo . objects . filter ( data__name = \"John\" , data__pets__has_key = \"dogs\" , data__cities__contains = \"London\" , ) . delete () If your project uses django.contrib.postgres.fields.JSONField , plus the\nrelated form field and transforms, you should adjust to use the new fields,\nand generate and apply a database migration. For now, the old fields and\ntransforms are left as a reference to the new ones and are deprecated as\nof this release . DEFAULT_HASHING_ALGORITHM settings ¶ The new DEFAULT_HASHING_ALGORITHM transitional setting allows specifying\nthe default hashing algorithm to use for encoding cookies, password reset\ntokens in the admin site, user sessions, and signatures created by django.core.signing.Signer and django.core.signing.dumps() . Support for SHA-256 was added in Django 3.1. If you are upgrading multiple\ninstances of the same project to Django 3.1, you should set DEFAULT_HASHING_ALGORITHM to 'sha1' during the transition, in order to\nallow compatibility with the older versions of Django. Note that this requires\nDjango 3.1.1+. Once the transition to 3.1 is complete you can stop overriding DEFAULT_HASHING_ALGORITHM . This setting is deprecated as of this release, because support for tokens,\ncookies, sessions, and signatures that use SHA-1 algorithm will be removed in\nDjango 4.0. Minor features ¶ django.contrib.admin ¶ The new django.contrib.admin.EmptyFieldListFilter for ModelAdmin.list_filter allows filtering on empty values (empty\nstrings and nulls) in the admin changelist view. Filters in the right sidebar of the admin changelist view now contain a link\nto clear all filters. The admin now has a sidebar on larger screens for easier navigation. It is\nenabled by default but can be disabled by using a custom AdminSite and\nsetting AdminSite.enable_nav_sidebar to False . Rendering the sidebar requires access to the current request in order to set\nCSS and ARIA role affordances. This requires using 'django.template.context_processors.request' in the 'context_processors' option of OPTIONS . Initially empty extra inlines can now be removed, in the same way as\ndynamically created ones. XRegExp is upgraded from version 2.0.0 to 3.2.0. jQuery is upgraded from version 3.4.1 to 3.5.1. Select2 library is upgraded from version 4.0.7 to 4.0.13. django.contrib.auth ¶ The default iteration count for the PBKDF2 password hasher is increased from\n180,000 to 216,000. The new PASSWORD_RESET_TIMEOUT setting allows defining the number\nof seconds a password reset link is valid for. This is encouraged instead of\nthe deprecated PASSWORD_RESET_TIMEOUT_DAYS setting, which will be removed\nin Django 4.0. The password reset mechanism now uses the SHA-256 hashing algorithm. Support\nfor tokens that use the old hashing algorithm remains until Django 4.0. AbstractBaseUser.get_session_auth_hash() now uses the SHA-256 hashing\nalgorithm. Support for user sessions that use the old hashing algorithm\nremains until Django 4.0. django.contrib.contenttypes ¶ The new remove_stale_contenttypes --include-stale-apps option\nallows removing stale content types from previously installed apps that have\nbeen removed from INSTALLED_APPS . django.contrib.gis ¶ relate lookup is now supported on MariaDB. Added the LinearRing.is_counterclockwise property. AsGeoJSON is now supported\non Oracle. Added the AsWKB and AsWKT functions. Added support for PostGIS 3 and GDAL 3. django.contrib.humanize ¶ intword template filter now supports negative integers. django.contrib.postgres ¶ The new BloomIndex class allows\ncreating bloom indexes in the database. The new BloomExtension migration\noperation installs the bloom extension to add support for this index. get_FOO_display() now supports ArrayField and RangeField . The new rangefield.lower_inc , rangefield.lower_inf , rangefield.upper_inc , and rangefield.upper_inf lookups\nallow querying RangeField by a bound\ntype. rangefield.contained_by now supports SmallAutoField , AutoField , BigAutoField , SmallIntegerField , and DecimalField . SearchQuery now supports 'websearch' search type on PostgreSQL 11+. SearchQuery.value now\nsupports query expressions. The new SearchHeadline class allows\nhighlighting search results. search lookup now supports query expressions. The new cover_density parameter of SearchRank allows ranking by cover\ndensity. The new normalization parameter of SearchRank allows rank\nnormalization. The new ExclusionConstraint.deferrable attribute allows creating\ndeferrable exclusion constraints. django.contrib.sessions ¶ The SESSION_COOKIE_SAMESITE setting now allows 'None' (string)\nvalue to explicitly state that the cookie is sent with all same-site and\ncross-site requests. django.contrib.staticfiles ¶ The STATICFILES_DIRS setting now supports pathlib.Path . Cache ¶ The cache_control() decorator and patch_cache_control() method now support multiple\nfield names in the no-cache directive for the Cache-Control header,\naccording to RFC 7234 Section 5.2.2.2 . delete() now returns True if the key was\nsuccessfully deleted, False otherwise. CSRF ¶ The CSRF_COOKIE_SAMESITE setting now allows 'None' (string)\nvalue to explicitly state that the cookie is sent with all same-site and\ncross-site requests. Email ¶ The EMAIL_FILE_PATH setting, used by the file email backend , now supports pathlib.Path . Error Reporting ¶ django.views.debug.SafeExceptionReporterFilter now filters sensitive\nvalues from request.META in exception reports. The new SafeExceptionReporterFilter.cleansed_substitute and SafeExceptionReporterFilter.hidden_settings attributes allow\ncustomization of sensitive settings and request.META filtering in\nexception reports. The technical 404 debug view now respects DEFAULT_EXCEPTION_REPORTER_FILTER when applying settings\nfiltering. The new DEFAULT_EXCEPTION_REPORTER allows providing a django.views.debug.ExceptionReporter subclass to customize exception\nreport generation. See Custom error reports for details. File Storage ¶ FileSystemStorage.save() method now supports pathlib.Path . FileField and ImageField now accept a callable for storage .\nThis allows you to modify the used storage at runtime, selecting different\nstorages for different environments, for example. Forms ¶ ModelChoiceIterator , used by ModelChoiceField and ModelMultipleChoiceField , now uses ModelChoiceIteratorValue that can be used by widgets\nto access model instances. See Iterating relationship choices for\ndetails. django.forms.DateTimeField now accepts dates in a subset of ISO 8601\ndatetime formats, including optional timezone, e.g. 2019-10-10T06:47 , 2019-10-10T06:47:23+04:00 , or 2019-10-10T06:47:23Z . The timezone will\nalways be retained if provided, with timezone-aware datetimes being returned\neven when USE_TZ is False . Additionally, DateTimeField now uses DATE_INPUT_FORMATS in addition\nto DATETIME_INPUT_FORMATS when converting a field input to a datetime value. MultiWidget.widgets now accepts a dictionary which allows\ncustomizing subwidget name attributes. The new BoundField.widget_type property can be used to dynamically\nadjust form rendering based upon the widget type. Internationalization ¶ The LANGUAGE_COOKIE_SAMESITE setting now allows 'None' (string) value to explicitly state that the cookie is sent with all same-site\nand cross-site requests. Added support and translations for the Algerian Arabic, Igbo, Kyrgyz, Tajik,\nand Turkmen languages. Management Commands ¶ The new check --database option allows specifying database aliases\nfor running the database system checks. Previously these checks were\nenabled for all configured DATABASES by passing the database tag to the command. The new migrate --check option makes the command exit with a\nnon-zero status when unapplied migrations are detected. The new returncode argument for CommandError allows customizing the exit\nstatus for management commands. The new dbshell -- ARGUMENTS option allows passing\nextra arguments to the command-line client for the database. The flush and sqlflush commands now include SQL to\nreset sequences on SQLite. Models ¶ The new ExtractIsoWeekDay function\nextracts ISO-8601 week days from DateField and DateTimeField , and the new iso_week_day lookup allows querying by an ISO-8601 day of week. QuerySet.explain() now supports: TREE format on MySQL 8.0.16+, analyze option on MySQL 8.0.18+ and MariaDB. Added PositiveBigIntegerField which acts much like\na PositiveIntegerField except that it only allows\nvalues under a certain (database-dependent) limit. Values from 0 to 9223372036854775807 are safe in all databases supported by Django. The new RESTRICT option for on_delete argument of ForeignKey and OneToOneField emulates the behavior of the SQL constraint ON DELETE RESTRICT . CheckConstraint.check now supports boolean expressions. The RelatedManager.add() , create() , and set() methods now accept callables as values in the through_defaults argument. The new is_dst parameter of the QuerySet.datetimes() determines\nthe treatment of nonexistent and ambiguous datetimes. The new F expression bitxor() method allows bitwise XOR operation . QuerySet.bulk_create() now sets the primary key on objects when using\nMariaDB 10.5+. The DatabaseOperations.sql_flush() method now generates more efficient\nSQL on MySQL by using DELETE instead of TRUNCATE statements for\ntables which don’t require resetting sequences. SQLite functions are now marked as deterministic on Python 3.8+. This allows using them\nin check constraints and partial indexes. The new UniqueConstraint.deferrable attribute allows creating\ndeferrable unique constraints. Pagination ¶ Paginator can now be iterated over to yield\nits pages. Requests and Responses ¶ If ALLOWED_HOSTS is empty and DEBUG=True , subdomains of\nlocalhost are now allowed in the Host header, e.g. static.localhost . HttpResponse.set_cookie() and HttpResponse.set_signed_cookie() now allow using samesite='None' (string) to explicitly state that the\ncookie is sent with all same-site and cross-site requests. The new HttpRequest.accepts() method returns whether the request\naccepts the given MIME type according to the Accept HTTP header. Security ¶ The SECURE_REFERRER_POLICY setting now defaults to 'same-origin' . With this configured, SecurityMiddleware sets the Referrer Policy header to same-origin on all responses that do not\nalready have it. This prevents the Referer header being sent to other\norigins. If you need the previous behavior, explicitly set SECURE_REFERRER_POLICY to None . The default algorithm of django.core.signing.Signer , django.core.signing.loads() , and django.core.signing.dumps() is\nchanged to the SHA-256. Support for signatures made with the old SHA-1\nalgorithm remains until Django 4.0. Also, the new algorithm parameter of the Signer allows customizing the hashing\nalgorithm. Templates ¶ The renamed translate and blocktranslate template tags are\nintroduced for internationalization in template code. The older trans and blocktrans template tags aliases continue to work, and will be\nretained for the foreseeable future. The include template tag now accepts iterables of template names. Tests ¶ SimpleTestCase now implements the debug() method to\nallow running a test without collecting the result and catching exceptions.\nThis can be used to support running tests under a debugger. The new MIGRATE test database setting allows\ndisabling of migrations during a test database creation. DiscoverRunner can now discard output for\npassing tests using the test --buffer option. DiscoverRunner now skips running the system\nchecks on databases not referenced by tests . TransactionTestCase teardown is now faster on MySQL\ndue to flush command improvements. As a side effect the latter\ndoesn’t automatically reset sequences on teardown anymore. Enable TransactionTestCase.reset_sequences if your tests require this\nfeature. URLs ¶ Path converters can now raise ValueError in to_url() to indicate no match when reversing URLs. Utilities ¶ filepath_to_uri() now supports pathlib.Path . parse_duration() now supports comma separators\nfor decimal fractions in the ISO 8601 format. parse_datetime() , parse_duration() , and parse_time() now support comma separators for\nmilliseconds. Miscellaneous ¶ The SQLite backend now supports pathlib.Path for the NAME setting. The settings.py generated by the startproject command now uses pathlib.Path instead of os.path for building filesystem\npaths. The TIME_ZONE setting is now allowed on\ndatabases that support time zones. Backwards incompatible changes in 3.1 ¶ Database backend API ¶ This section describes changes that may be needed in third-party database\nbackends. DatabaseOperations.fetch_returned_insert_columns() now requires an\nadditional returning_params argument. connection.timezone property is now 'UTC' by default, or the TIME_ZONE when USE_TZ is True on databases that support time zones. Previously, it was None on\ndatabases that support time zones. connection._nodb_connection property is changed to the connection._nodb_cursor() method and now returns a context manager that\nyields a cursor and automatically closes the cursor and connection upon\nexiting the with statement. DatabaseClient.runshell() now requires an additional parameters argument as a list of extra arguments to pass on to the command-line client. The sequences positional argument of DatabaseOperations.sql_flush() is replaced by the boolean keyword-only argument reset_sequences . If True , the sequences of the truncated tables will be reset. The allow_cascade argument of DatabaseOperations.sql_flush() is now a\nkeyword-only argument. The using positional argument of DatabaseOperations.execute_sql_flush() is removed. The method now uses\nthe database of the called instance. Third-party database backends must implement support for JSONField or set DatabaseFeatures.supports_json_field to False . If storing primitives\nis not supported, set DatabaseFeatures.supports_primitives_in_json_field to False . If there is a true datatype for JSON, set DatabaseFeatures.has_native_json_field to True . If jsonfield.contains and jsonfield.contained_by are not\nsupported, set DatabaseFeatures.supports_json_field_contains to False . Third party database backends must implement introspection for JSONField or set can_introspect_json_field to False . Dropped support for MariaDB 10.1 ¶ Upstream support for MariaDB 10.1 ends in October 2020. Django 3.1 supports\nMariaDB 10.2 and higher. contrib.admin browser support ¶ The admin no longer supports the legacy Internet Explorer browser. See the admin FAQ for details on supported browsers. AbstractUser.first_name max_length increased to 150 ¶ A migration for django.contrib.auth.models.User.first_name is included.\nIf you have a custom user model inheriting from AbstractUser , you’ll need\nto generate and apply a database migration for your user model. If you want to preserve the 30 character limit for first names, use a custom\nform: from django import forms from django.contrib.auth.forms import UserChangeForm class MyUserChangeForm ( UserChangeForm ): first_name = forms . CharField ( max_length = 30 , required = False ) If you wish to keep this restriction in the admin when editing users, set UserAdmin.form to use this form: from django.contrib.auth.admin import UserAdmin from django.contrib.auth.models import User class MyUserAdmin ( UserAdmin ): form = MyUserChangeForm admin . site . unregister ( User ) admin . site . register ( User , MyUserAdmin ) Miscellaneous ¶ The cache keys used by cache and generated by make_template_fragment_key() are different\nfrom the keys generated by older versions of Django. After upgrading to\nDjango 3.1, the first request to any previously cached template fragment will\nbe a cache miss. The logic behind the decision to return a redirection fallback or a 204 HTTP\nresponse from the set_language() view is now based\non the Accept HTTP header instead of the X-Requested-With HTTP header\npresence. The compatibility imports of django.core.exceptions.EmptyResultSet in django.db.models.query , django.db.models.sql , and django.db.models.sql.datastructures are removed. The compatibility import of django.core.exceptions.FieldDoesNotExist in django.db.models.fields is removed. The compatibility imports of django.forms.utils.pretty_name() and django.forms.boundfield.BoundField in django.forms.forms are removed. The compatibility imports of Context , ContextPopException , and RequestContext in django.template.base are removed. The compatibility import of django.contrib.admin.helpers.ACTION_CHECKBOX_NAME in django.contrib.admin is removed. The STATIC_URL and MEDIA_URL settings set to relative\npaths are now prefixed by the server-provided value of SCRIPT_NAME (or / if not set). This change should not affect settings set to valid URLs\nor absolute paths. ConditionalGetMiddleware no longer adds the ETag header to responses with an empty content . django.utils.decorators.classproperty() decorator is made public and\nmoved to django.utils.functional.classproperty() . floatformat template filter now outputs (positive) 0 for\nnegative numbers which round to zero. Meta.ordering and Meta.unique_together options on models in django.contrib modules that were formerly tuples are\nnow lists. The admin calendar widget now handles two-digit years according to the Open\nGroup Specification, i.e. values between 69 and 99 are mapped to the previous\ncentury, and values between 0 and 68 are mapped to the current century. Date-only formats are removed from the default list for DATETIME_INPUT_FORMATS . The FileInput widget no longer renders with the required HTML attribute when initial data exists. The undocumented django.views.debug.ExceptionReporterFilter class is\nremoved. As per the Custom error reports documentation, classes to be\nused with DEFAULT_EXCEPTION_REPORTER_FILTER need to inherit from django.views.debug.SafeExceptionReporterFilter . The cache timeout set by cache_page() decorator now takes precedence over the max-age directive from the Cache-Control header. Providing a non-local remote field in the ForeignKey.to_field argument now raises FieldError . SECURE_REFERRER_POLICY now defaults to 'same-origin' . See the What’s New Security section above for more\ndetails. check management command now runs the database system checks\nonly for database aliases specified using check --database option. migrate management command now runs the database system checks\nonly for a database to migrate. The admin CSS classes row1 and row2 are removed in favor of :nth-child(odd) and :nth-child(even) pseudo-classes. The make_password() function now requires\nits argument to be a string or bytes. Other types should be explicitly cast\nto one of these. The undocumented version parameter to the AsKML function is removed. JSON and YAML serializers , used by dumpdata , now dump all data with Unicode by default. If you need\nthe previous behavior, pass ensure_ascii=True to JSON serializer, or allow_unicode=False to YAML serializer. The auto-reloader no longer monitors changes in built-in Django translation\nfiles. The minimum supported version of mysqlclient is increased from 1.3.13 to\n1.4.0. The undocumented django.contrib.postgres.forms.InvalidJSONInput and django.contrib.postgres.forms.JSONString are moved to django.forms.fields . The undocumented django.contrib.postgres.fields.jsonb.JsonAdapter class\nis removed. The {% localize off %} tag and unlocalize filter no longer respect DECIMAL_SEPARATOR setting. The minimum supported version of asgiref is increased from 3.2 to\n3.2.10. The Media class now renders <script> tags\nwithout the type attribute to follow WHATWG recommendations . ModelChoiceIterator , used by ModelChoiceField and ModelMultipleChoiceField , now yields 2-tuple choices\ncontaining ModelChoiceIteratorValue instances as the\nfirst value element in each choice. In most cases this proxies\ntransparently, but if you need the field value itself, use the ModelChoiceIteratorValue.value attribute instead. Features deprecated in 3.1 ¶ PostgreSQL JSONField ¶ django.contrib.postgres.fields.JSONField and django.contrib.postgres.forms.JSONField are deprecated in favor of models.JSONField and forms.JSONField . The undocumented django.contrib.postgres.fields.jsonb.KeyTransform and django.contrib.postgres.fields.jsonb.KeyTextTransform are also deprecated\nin favor of the transforms in django.db.models.fields.json . The new JSONField s, KeyTransform , and KeyTextTransform can be used\non all supported database backends. Miscellaneous ¶ PASSWORD_RESET_TIMEOUT_DAYS setting is deprecated in favor of PASSWORD_RESET_TIMEOUT . The undocumented usage of the isnull lookup with non-boolean values\nas the right-hand side is deprecated, use True or False instead. The barely documented django.db.models.query_utils.InvalidQuery exception\nclass is deprecated in favor of FieldDoesNotExist and FieldError . The django-admin.py entry point is deprecated in favor of django-admin . The HttpRequest.is_ajax() method is deprecated as it relied on a\njQuery-specific way of signifying AJAX calls, while current usage tends to\nuse the JavaScript Fetch API . Depending on\nyour use case, you can either write your own AJAX detection method, or use\nthe new HttpRequest.accepts() method if your code depends on the\nclient Accept HTTP header. If you are writing your own AJAX detection method, request.is_ajax() can\nbe reproduced exactly as request.headers.get('x-requested-with') == 'XMLHttpRequest' . Passing None as the first argument to django.utils.deprecation.MiddlewareMixin.__init__() is deprecated. The encoding format of cookies values used by CookieStorage is different\nfrom the format generated by older versions of Django. Support for the old\nformat remains until Django 4.0. The encoding format of sessions is different from the format generated by\nolder versions of Django. Support for the old format remains until Django\n4.0. The purely documentational providing_args argument for Signal is deprecated. If you rely on this\nargument as documentation, you can move the text to a code comment or\ndocstring. Calling django.utils.crypto.get_random_string() without a length argument is deprecated. The list message for ModelMultipleChoiceField is\ndeprecated in favor of invalid_list . Passing raw column aliases to QuerySet.order_by() is deprecated. The\nsame result can be achieved by passing aliases in a RawSQL instead beforehand. The NullBooleanField model field is deprecated in favor of BooleanField(null=True, blank=True) . django.conf.urls.url() alias of django.urls.re_path() is\ndeprecated. The {% ifequal %} and {% ifnotequal %} template tags are deprecated\nin favor of {% if %} . {% if %} covers all use cases, but if\nyou need to continue using these tags, they can be extracted from Django to a\nmodule and included as a built-in tag in the 'builtins' option in OPTIONS . DEFAULT_HASHING_ALGORITHM transitional setting is deprecated. Features removed in 3.1 ¶ These features have reached the end of their deprecation cycle and are removed\nin Django 3.1. See Features deprecated in 2.2 for details on these changes, including how\nto remove usage of these features. django.utils.timezone.FixedOffset is removed. django.core.paginator.QuerySetPaginator is removed. A model’s Meta.ordering doesn’t affect GROUP BY queries. django.contrib.postgres.fields.FloatRangeField and django.contrib.postgres.forms.FloatRangeField are removed. The FILE_CHARSET setting is removed. django.contrib.staticfiles.storage.CachedStaticFilesStorage is removed. The RemoteUserBackend.configure_user() method requires request as the\nfirst positional argument. Support for SimpleTestCase.allow_database_queries and TransactionTestCase.multi_db is removed.", "keywords": ["users", "keytexttransform", "feature", "storage", "commanderror", "contrib.admin", "django.utils.functional.classproperty", "iterables", "encoders", "django.db.models.query_utils", "data__name", "library", "safeexceptionreporterfilter", "3.2.10", "field", "fielderror", "data__pets__has_key", "django.forms", "migrations", "extractisoweekday", "user.first_name", "datatype", "+", "httprequest.accepts", "numbers", "host", "httprequest.is_ajax", "transforms", "resetting", "match", "httpresponse", "subset", "calendar", "cache", "compatibility", "sha1", "datefield", "abstractuser", "select2", "transactiontestcase.multi_db", "august", "sha-1", "modelmultiplechoicefield", "kyrgyz", "databasefeatures.has_native_json_field", "change", "iso_week_day", "tajik", "presence", "navigation", "http", "searchrank", "changes", "=", "django.core.exceptions", "results", "cities", "positivebigintegerfield", "jsonstring", "regressions", "message", "relationship", "character", "jsonadapter", "tables", "tag", "filesystem", "databasefeatures.supports_json_field_contains", "zones", "hashing", "reset_sequences", "process", "fallback", "debug", "choice", "django.db.models.sql", "john", "django.db.models.fields.json", "django.conf.urls.url", "type", "mysqlclient", "filefield", "serializers", "calls", "await", "custom", "objects", "documentation", "smallautofield", "lookups", "discoverrunner", "file", "customization", "constraint", "exclusion", "modules", "child(even", "user", "default_exception_reporter", "fragment", "cases", "django.contrib.postgres.fields.jsonb", "invalidquery", "attribute", "mechanism", "django.contrib.gis", "queryset.datetimes", "primitives", "constraints", "time", "tags", "signatures", "jquery", "date", "setting", "faq", "responses", "set_language", "proxies", "minor", "password", "logic", "name", "parameter", "get_foo_display", "execution", "modelchoiceiteratorvalue.value", "world", "backends", "reference", "django.contrib.auth", "age", "versions", "is_dst", "queries", "simpletestcase", "manager", "majority", "django.contrib.admin", "simpletestcase.allow_database_queries", "django.utils.decorators.classproperty", "return", "expressions", "environments", "use_tz", "search", "parse_datetime", "datetimefield", "bloomextension", "meta.ordering", "translate", "django.contrib.staticfiles", "callables", "django.core.signing.loads", "through_defaults", "status", "aliases", "tree", "error", "timeout", "module", "code", "subdomains", "--database", "algorithm", "decimalfield", "pages", "filter", "false", "behavior", "rank", "access", "class", "migration", "link", "milliseconds", "group", "redirection", "contactinfo", "widget", "default_exception_reporter_filter", "names", "javascript", "sidebar", "myuserchangeform", "pbkdf2", "years", "session_cookie_samesite", "request", "database", "output", "input", "databasefeatures.supports_primitives_in_json_field", "signal", "query", "test", "commands", "postgresql", "count", "migrate", "types", "strings", "subclass", "admin", "creation", "etag", ".", "returning_params", "usage", "sequences", "3.2.0", "transactiontestcase", "django.views.debug", "wsgi", "limit", "script", "jsonfield.contains", "modelchoiceiterator", "max_length", "fixedoffset", "by", "role", "decimal_separator", "section", "httpresponse.set_cookie", "allow_unicode", "specification", "django.core.paginator", "cachedstaticfilesstorage", "modelchoiceiteratorvalue", "css", "django.db.models.query", "use", "jsonfield.contained_by", "miss", "filepath_to_uri", "linearring.is_counterclockwise", "dbshell", "whatwg", "querysetpaginator", "aria", "origin", "queryset.order_by", "imports", "cookiestorage", "performance", "releases", "myuseradmin", "operation", "order", "date_input_formats", "default", "floatrangefield", "choices", "userchangeform", "alias", "rangefield.upper_inc", "comment", "form", "ensure_ascii", "option", "format", "expression", "tests", "comma", "classes", "default_hashing_algorithm", "bloomindex", "day", "digit", "action_checkbox_name", "csrf_cookie_samesite", "cover", "browsers", "timezone", "f", "supports", "8.0.16", "cursor", "nullbooleanfield", "samesite='none", "to_url", "template", "week", "igbo", "checkconstraint.check", "header", "onetoonefield", "8.0.18", "way", "useradmin", "internet", "data__cities__contains", "formats", "gdal", "exceptionreporter", "checks", "foreignkey.to_field", "origins", "django.db.models.sql.datastructures", "index", "builtins", "accept", "sha-256", "websearch", "party", "reports", "¶", "bytes", "command", "internationalization", "parameters", "modelchoicefield", "october", "disabling", "integers", "boundfield", "rufus", "property", "density", "side", "miscellaneous", "positiveintegerfield", "asgeojson", "content", "century", "function", "ends", "views", "arrayfield", "result", "view", "open", "django.contrib.sessions", "control", "aswkb", "indexes", "number", "lot", "email_file_path", "connection._nodb_cursor", "jsonfield", "invalidjsoninput", "def", "point", "datetimes", "values", "django.contrib", "string", "queryset.bulk_create", "debugger", "introspection", "bitxor", "row2", "favor", "databaseoperations.fetch_returned_insert_columns", "auto", "databases", "django.db.models.fields", "intword", "mime", "staticfiles_dirs", "django.forms.fields", "hand", "inlines", "models", "xregexp", "dates", "referrer", "exit", "nth", "arabic", "version", "invalid_list", "yaml", "json", "cache_control", "treatment", "deprecation", "transition", "databaseoperations.sql_flush", "minimum", "django", "series", "rfc", "securitymiddleware", "fields", "utilities", "separators", "dumpdata", "entry", "languages", "context_processors", "pseudo", "value", "media", "legacy", "sync", "line", "london", "policy", "data", "browser", "reloader", "django.utils.crypto.get_random_string", "relatedmanager.add", "backend", "guide", "databasefeatures.supports_json_field", "layer", "make_template_fragment_key", "security", "rangefield.lower_inc", "paths", "instance", "outputs", "xor", "reporting", "speed", "sqlflush", "filesystemstorage.save", "django.forms.utils.pretty_name", "extension", "report", "unicode", "django.forms.boundfield", "decorator", "row1", "docstring", "floatformat", "rangefield.contained_by", "asyncio", "instances", "project", "iso", "signer", "statement", "language_cookie_samesite", "inheriting", "screens", "asgiref", "--check", "valueerror", "can_introspect_json_field", "teardown", "charfield", "fetch", "management", "response", "precedence", "dictionary", "sql", "requests", "reset", "tokens", "django.core.signing.dumps", "queryset.explain", "keyword", "s", "csrf", "abstractuser.first_name", "max", "cache_page", "cover_density", "parse_duration", "fileinput", "notes", "django.contrib.postgres.fields", "effect", "django.contrib.contenttypes", "system", "apps", "django.contrib.staticfiles.storage", "password_reset_timeout", "django.contrib.admin.helpers", "changelist", "meg", "filtering", "async", "secure_referrer_policy", "welcome", "password_reset_timeout_days", "iso-8601", "fielddoesnotexist", "imagefield", "storages", "widgets", "serializer", "autofield", "check", "patch_cache_control", "features", "forms", "site", "django.template.base", "referer", "addition", "explorer", "example", "lists", "parallel", "remoteuserbackend.configure_user", "column", "list", "pieces", "unregister", "orm", "seconds", "utc", "detection", "upstream", "restrict", "django.utils.timezone", "hasher", "email", "paginator", "keytransform", "dogs", "model", "django.template.context_processors.request", "callable", "decoders", "file_charset", "element", "encoding", "django.contrib.auth.models", "attributes", "media_url", "sleep", "pagination", "release", "localhost", "asgi", "adminsite.enable_nav_sidebar", "os.path", "django-admin.py", "meta.unique_together", "django.forms.forms", "translation", "restriction", "django.contrib.postgres.forms", "ones", "turkmen", "converters", "keys", "case", "length", "recommendations", "lookup", "databaseoperations.execute_sql_flush", "contextpopexception", "django.utils.deprecation", "runtime", "network", "html", "future", "server", "tuple", "exceptionreporterfilter", "arguments", "normalization", "pets", "django.urls.re_path", "pathlib", "middleware", "rangefield.lower_inf", "rawsql", "directive", "end", "generation", "translations", "improvements", "sqlite", "tuples", "delete", "adminsite", "decision", "path", "affordances", "functions", "key", "trans", "django.contrib.auth.forms", "bitwise", "my_view", "none", "filters", "3.5.1", "meta", "specifics", "mariadb", "cambridge", "multiwidget.widgets", "new", "true", "searchheadline", "urls", "api", "sessions", "support", "cookies", "bloom", "mode", "projects", "connection", "-", "datetime_input_formats", "context", "cycle", "fractions", "penalties", "import", "blocktrans", "files", "iteration", "rangefield", "booleanfield(null", "mysql", "statements", "%", "foreignkey", "searchquery", "python", "django.core.signing", "bigautofield", "requestcontext", "methods", "options", "exception", "5.2.2.2", "client", "details", "aswkt", "method", "databaseclient.runshell", "django.db", "settings", "smallintegerfield", "argument", "days", "cookie", "oracle", "templates", "text", "nulls", "abstractbaseuser.get_session_auth_hash", "exceptions"], "type": "documentation"},
{"title": "Django 3.0 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/3.0/", "content": "Django 3.0 release notes ¶ December 2, 2019 Welcome to Django 3.0! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 2.2 or earlier. We’ve dropped some features that have reached the end of\ntheir deprecation cycle, and we’ve begun the deprecation process for\nsome features . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Python compatibility ¶ Django 3.0 supports Python 3.6, 3.7, 3.8, and 3.9 (as of 3.0.11). We highly\nrecommend and only officially support the latest release of each series. The Django 2.2.x series is the last to support Python 3.5. Third-party library support for older version of Django ¶ Following the release of Django 3.0, we suggest that third-party app authors\ndrop support for all versions of Django prior to 2.2. At that time, you should\nbe able to run your package’s tests using python -Wd so that deprecation\nwarnings appear. After making the deprecation warning fixes, your app should be\ncompatible with Django 3.0. What’s new in Django 3.0 ¶ MariaDB support ¶ Django now officially supports MariaDB 10.1 and\nhigher. See MariaDB notes for more details. ASGI support ¶ Django 3.0 begins our journey to making Django fully async-capable by providing\nsupport for running as an ASGI application. This is in addition to our existing WSGI support. Django intends to support\nboth for the foreseeable future. Async features will only be available to\napplications that run under ASGI, however. At this stage async support only applies to the outer ASGI application.\nInternally everything remains synchronous. Asynchronous middleware, views, etc.\nare not yet supported. You can, however, use ASGI middleware around Django’s\napplication, allowing you to combine Django with other ASGI frameworks. There is no need to switch your applications over unless you want to start\nexperimenting with asynchronous code, but we have documentation on deploying with ASGI if\nyou want to learn more. Note that as a side-effect of this change, Django is now aware of asynchronous\nevent loops and will block you calling code marked as “async unsafe” - such as\nORM operations - from an asynchronous context. If you were using Django from\nasync code before, this may trigger if you were doing it incorrectly. If you\nsee a SynchronousOnlyOperation error, then closely examine your code and\nmove any database operations to be in a synchronous child thread. Exclusion constraints on PostgreSQL ¶ The new ExclusionConstraint class\nenable adding exclusion constraints on PostgreSQL. Constraints are added to\nmodels using the Meta.constraints option. Filter expressions ¶ Expressions that output BooleanField may now be\nused directly in QuerySet filters, without having to first annotate and\nthen filter against the annotation. Enumerations for model field choices ¶ Custom enumeration types TextChoices , IntegerChoices , and Choices are now available as a way to define Field.choices . TextChoices and IntegerChoices types are provided for text and integer fields. The Choices class allows defining a compatible enumeration for other concrete\ndata types. These custom enumeration types support human-readable labels that\ncan be translated and accessed via a property on the enumeration or its\nmembers. See Enumeration types for more\ndetails and examples. Minor features ¶ django.contrib.admin ¶ Added support for the admin_order_field attribute on properties in ModelAdmin.list_display . The new ModelAdmin.get_inlines() method allows specifying the\ninlines based on the request or model instance. Select2 library is upgraded from version 4.0.3 to 4.0.7. jQuery is upgraded from version 3.3.1 to 3.4.1. django.contrib.auth ¶ The new reset_url_token attribute in PasswordResetConfirmView allows\nspecifying a token parameter displayed as a component of password reset\nURLs. Added BaseBackend class to ease\ncustomization of authentication backends. Added get_user_permissions() method\nto mirror the existing get_group_permissions() method. Added HTML autocomplete attribute to widgets of username, email, and\npassword fields in django.contrib.auth.forms for better interaction\nwith browser password managers. createsuperuser now falls back to environment variables for\npassword and required fields, when a corresponding command line argument\nisn’t provided in non-interactive mode. REQUIRED_FIELDS now supports ManyToManyField s. The new UserManager.with_perm() method returns users that have the\nspecified permission. The default iteration count for the PBKDF2 password hasher is increased from\n150,000 to 180,000. django.contrib.gis ¶ Allowed MySQL spatial lookup functions to operate on real geometries.\nPrevious support was limited to bounding boxes. Added the GeometryDistance function, supported on PostGIS. Added support for the furlong unit in Distance . The GEOIP_PATH setting now supports pathlib.Path . The GeoIP2 class now accepts pathlib.Path path . django.contrib.postgres ¶ The new RangeOperators helps to\navoid typos in SQL operators that can be used together with RangeField . The new RangeBoundary expression\nrepresents the range boundaries. The new AddIndexConcurrently and RemoveIndexConcurrently classes allow creating and dropping indexes CONCURRENTLY on PostgreSQL. django.contrib.sessions ¶ The new get_session_cookie_age() method allows dynamically specifying the session cookie age. django.contrib.syndication ¶ Added the language class attribute to the django.contrib.syndication.views.Feed to customize a feed language.\nThe default value is get_language() instead\nof LANGUAGE_CODE . Cache ¶ add_never_cache_headers() and never_cache() now add the private directive to Cache-Control headers. File Storage ¶ The new Storage.get_alternative_name() method allows customizing the\nalgorithm for generating filenames if a file with the uploaded name already\nexists. Forms ¶ Formsets may control the widget used when ordering forms via can_order by setting the ordering_widget attribute or\noverriding get_ordering_widget() . Internationalization ¶ Added the LANGUAGE_COOKIE_HTTPONLY , LANGUAGE_COOKIE_SAMESITE , and LANGUAGE_COOKIE_SECURE settings to set the HttpOnly , SameSite , and Secure flags on\nlanguage cookies. The default values of these settings preserve the previous\nbehavior. Added support and translations for the Uzbek language. Logging ¶ The new reporter_class parameter of AdminEmailHandler allows providing an django.views.debug.ExceptionReporter subclass to customize the traceback\ntext sent to site ADMINS when DEBUG is False . Management Commands ¶ The new compilemessages --ignore option allows ignoring specific\ndirectories when searching for .po files to compile. showmigrations --list now shows the applied datetimes when --verbosity is 2 and above. On PostgreSQL, dbshell now supports client-side TLS certificates. inspectdb now introspects OneToOneField when a foreign key has a unique or primary key constraint. The new --skip-checks option skips running system checks prior to\nrunning the command. The startapp --template and startproject --template options now support templates stored in XZ archives ( .tar.xz , .txz )\nand LZMA archives ( .tar.lzma , .tlz ). Models ¶ Added hash database functions MD5 , SHA1 , SHA224 , SHA256 , SHA384 , and SHA512 . Added the Sign database function. The new is_dst parameter of the Trunc database functions determines the\ntreatment of nonexistent and ambiguous datetimes. connection.queries now shows COPY … TO statements on PostgreSQL. FilePathField now accepts a callable for path . Allowed symmetrical intermediate table for self-referential ManyToManyField . The name attributes of CheckConstraint , UniqueConstraint , and Index now support app label and class\ninterpolation using the '%(app_label)s' and '%(class)s' placeholders. The new Field.descriptor_class attribute allows model fields to\ncustomize the get and set behavior by overriding their descriptors . Avg and Sum now support\nthe distinct argument. Added SmallAutoField which acts much like an AutoField except that it only allows values under\na certain (database-dependent) limit. Values from 1 to 32767 are safe\nin all databases supported by Django. AutoField , BigAutoField , and SmallAutoField now inherit from IntegerField , BigIntegerField and SmallIntegerField respectively.\nSystem checks and validators are now also properly inherited. FileField.upload_to now supports pathlib.Path . CheckConstraint is now supported on MySQL 8.0.16+. The new allows_group_by_selected_pks_on_model() method of django.db.backends.base.BaseDatabaseFeatures allows optimization of GROUP BY clauses to require only the selected models’ primary keys. By\ndefault, it’s supported only for managed models on PostgreSQL. To enable the GROUP BY primary key-only optimization for unmanaged\nmodels, you have to subclass the PostgreSQL database engine, overriding the\nfeatures class allows_group_by_selected_pks_on_model() method as you\nrequire. See Subclassing the built-in database backends for an example. Requests and Responses ¶ Allowed HttpResponse to be initialized with memoryview content. For use in, for example, Django templates, HttpRequest.headers now\nallows lookups using underscores (e.g. user_agent ) in place of hyphens. Security ¶ X_FRAME_OPTIONS now defaults to 'DENY' . In older versions, the X_FRAME_OPTIONS setting defaults to 'SAMEORIGIN' . If your site\nuses frames of itself, you will need to explicitly set X_FRAME_OPTIONS = 'SAMEORIGIN' for them to continue working. SECURE_CONTENT_TYPE_NOSNIFF now defaults to True . With this\nenabled, SecurityMiddleware sets the X-Content-Type-Options: nosniff header on all responses that do not already\nhave it. SecurityMiddleware can now send the Referrer-Policy header. Tests ¶ The new test Client argument raise_request_exception allows controlling whether or not exceptions\nraised during the request should also be raised in the test. The value\ndefaults to True for backwards compatibility. If it is False and an\nexception occurs, the test client will return a 500 response with the\nattribute exc_info , a tuple providing\ninformation of the exception that occurred. Tests and test cases to run can be selected by test name pattern using the\nnew test -k option. HTML comparison, as used by assertHTMLEqual() , now treats text, character\nreferences, and entity references that refer to the same character as\nequivalent. DiscoverRunner can now spawn a debugger at each\nerror or failure using the test --pdb option. Backwards incompatible changes in 3.0 ¶ Model.save() when providing a default for the primary key ¶ Model.save() no longer attempts to find a row when saving a new Model instance and a default value for the primary key is provided, and\nalways performs a single INSERT query. In older Django versions, Model.save() performed either an INSERT or an UPDATE based on\nwhether or not the row exists. This makes calling Model.save() while providing a default primary key value\nequivalent to passing force_insert=True to\nmodel’s save() . Attempts to use a new Model instance to update an\nexisting row will result in an IntegrityError . In order to update an existing model for a specific primary key value, use the update_or_create() method or QuerySet.filter(pk=…).update(…) instead. For example: >>> MyModel . objects . update_or_create ( pk = existing_pk , defaults = { \"name\" : \"new name\" }) >>> MyModel . objects . filter ( pk = existing_pk ) . update ( name = \"new name\" ) Database backend API ¶ This section describes changes that may be needed in third-party database\nbackends. The second argument of DatabaseIntrospection.get_geometry_type() is now\nthe row description instead of the column name. DatabaseIntrospection.get_field_type() may no longer return tuples. If the database can create foreign keys in the same SQL statement that adds a\nfield, add SchemaEditor.sql_create_column_inline_fk with the appropriate\nSQL; otherwise, set DatabaseFeatures.can_create_inline_fk = False . DatabaseFeatures.can_return_id_from_insert and can_return_ids_from_bulk_insert are renamed to can_return_columns_from_insert and can_return_rows_from_bulk_insert . Database functions now handle datetime.timezone formats when created\nusing datetime.timedelta instances (e.g. timezone(timedelta(hours=5)) , which would output 'UTC+05:00' ).\nThird-party backends should handle this format when preparing DateTimeField in datetime_cast_date_sql() , datetime_extract_sql() , etc. Entries for AutoField , BigAutoField , and SmallAutoField are added\nto DatabaseOperations.integer_field_ranges to support the integer range\nvalidators on these field types. Third-party backends may need to customize\nthe default entries. DatabaseOperations.fetch_returned_insert_id() is replaced by fetch_returned_insert_columns() which returns a list of values returned\nby the INSERT … RETURNING statement, instead of a single value. DatabaseOperations.return_insert_id() is replaced by return_insert_columns() that accepts a fields argument, which is an iterable of fields to be returned after insert. Usually\nthis is only the auto-generated primary key. django.contrib.admin ¶ Admin’s model history change messages now prefers more readable field labels\ninstead of field names. django.contrib.gis ¶ Support for PostGIS 2.1 is removed. Support for SpatiaLite 4.1 and 4.2 is removed. Support for GDAL 1.11 and GEOS 3.4 is removed. Dropped support for PostgreSQL 9.4 ¶ Upstream support for PostgreSQL 9.4 ends in December 2019. Django 3.0 supports\nPostgreSQL 9.5 and higher. Dropped support for Oracle 12.1 ¶ Upstream support for Oracle 12.1 ends in July 2021. Django 2.2 will be\nsupported until April 2022. Django 3.0 officially supports Oracle 12.2 and 18c. Removed private Python 2 compatibility APIs ¶ While Python 2 support was removed in Django 2.0, some private APIs weren’t\nremoved from Django so that third party apps could continue using them until\nthe Python 2 end-of-life. Since we expect apps to drop Python 2 compatibility when adding support for\nDjango 3.0, we’re removing these APIs at this time. django.test.utils.str_prefix() - Strings don’t have ‘u’ prefixes in\nPython 3. django.test.utils.patch_logger() - Use unittest.TestCase.assertLogs() instead. django.utils.lru_cache.lru_cache() - Alias of functools.lru_cache() . django.utils.decorators.available_attrs() - This function returns functools.WRAPPER_ASSIGNMENTS . django.utils.decorators.ContextDecorator - Alias of contextlib.ContextDecorator . django.utils._os.abspathu() - Alias of os.path.abspath() . django.utils._os.upath() and npath() - These functions do nothing on\nPython 3. django.utils.six - Remove usage of this vendored library or switch to six . django.utils.encoding.python_2_unicode_compatible() - Alias of six.python_2_unicode_compatible() . django.utils.functional.curry() - Use functools.partial() or functools.partialmethod . See 5b1c389603a353625ae1603ba345147356336afb . django.utils.safestring.SafeBytes - Unused since Django 2.0. New default value for the FILE_UPLOAD_PERMISSIONS setting ¶ In older versions, the FILE_UPLOAD_PERMISSIONS setting defaults to None . With the default FILE_UPLOAD_HANDLERS , this results in\nuploaded files having different permissions depending on their size and which\nupload handler is used. FILE_UPLOAD_PERMISSIONS now defaults to 0o644 to avoid this\ninconsistency. New default values for security settings ¶ To make Django projects more secure by default, some security settings now have\nmore secure default values: X_FRAME_OPTIONS now defaults to 'DENY' . SECURE_CONTENT_TYPE_NOSNIFF now defaults to True . See the What’s New Security section above for\nmore details on these changes. Miscellaneous ¶ ContentType.__str__() now includes the model’s app_label to\ndisambiguate models with the same name in different apps. Because accessing the language in the session rather than in the cookie is\ndeprecated, LocaleMiddleware no longer looks for the user’s language in\nthe session and django.contrib.auth.logout() no longer preserves the\nsession’s language after logout. django.utils.html.escape() now uses html.escape() to escape HTML.\nThis converts ' to &#x27; instead of the previous equivalent decimal\ncode &#39; . The django-admin test -k option now works as the unittest -k option rather than as a shortcut for --keepdb . Support for pywatchman < 1.2.0 is removed. urlencode() now encodes iterable values as they are\nwhen doseq=False , rather than iterating them, bringing it into line with\nthe standard library urllib.parse.urlencode() function. intword template filter now translates 1.0 as a singular phrase and\nall other numeric values as plural. This may be incorrect for some languages. Assigning a value to a model’s ForeignKey or OneToOneField '_id' attribute now unsets the\ncorresponding field. Accessing the field afterward will result in a query. patch_vary_headers() now handles an asterisk '*' according to RFC 7231 Section 7.1.4 , i.e. if a list of header\nfield names contains an asterisk, then the Vary header will consist of a\nsingle asterisk '*' . On MySQL 8.0.16+, PositiveIntegerField and PositiveSmallIntegerField now include a check constraint to prevent negative values in the database. alias=None is added to the signature of Expression.get_group_by_cols() . RegexPattern , used by re_path() , no longer returns\nkeyword arguments with None values to be passed to the view for the\noptional named groups that are missing. Features deprecated in 3.0 ¶ django.utils.encoding.force_text() and smart_text() ¶ The smart_text() and force_text() aliases (since Django 2.0) of smart_str() and force_str() are deprecated. Ignore this deprecation if\nyour code supports Python 2 as the behavior of smart_str() and force_str() is different there. Miscellaneous ¶ django.utils.http.urlquote() , urlquote_plus() , urlunquote() , and urlunquote_plus() are deprecated in favor of the functions that they’re\naliases for: urllib.parse.quote() , quote_plus() , unquote() , and unquote_plus() . django.utils.translation.ugettext() , ugettext_lazy() , ugettext_noop() , ungettext() , and ungettext_lazy() are deprecated\nin favor of the functions that they’re aliases for: django.utils.translation.gettext() , gettext_lazy() , gettext_noop() , ngettext() , and ngettext_lazy() . To limit creation of sessions and hence favor some caching strategies, django.views.i18n.set_language() will stop setting the user’s language\nin the session in Django 4.0. Since Django 2.1, the language is always stored\nin the LANGUAGE_COOKIE_NAME cookie. django.utils.text.unescape_entities() is deprecated in favor of html.unescape() . Note that unlike unescape_entities() , html.unescape() evaluates lazy strings immediately. To avoid possible confusion as to effective scope, the private internal\nutility is_safe_url() is renamed to url_has_allowed_host_and_scheme() . That a URL has an allowed host and\nscheme doesn’t in general imply that it’s “safe”. It may still be quoted\nincorrectly, for example. Ensure to also use iri_to_uri() on the path component of untrusted\nURLs. Features removed in 3.0 ¶ These features have reached the end of their deprecation cycle and are removed\nin Django 3.0. See Features deprecated in 2.0 for details on these changes, including how\nto remove usage of these features. The django.db.backends.postgresql_psycopg2 module is removed. django.shortcuts.render_to_response() is removed. The DEFAULT_CONTENT_TYPE setting is removed. HttpRequest.xreadlines() is removed. Support for the context argument of Field.from_db_value() and Expression.convert_value() is removed. The field_name keyword argument of QuerySet.earliest() and latest() is removed. See Features deprecated in 2.1 for details on these changes, including how\nto remove usage of these features. The ForceRHR GIS function is removed. django.utils.http.cookie_date() is removed. The staticfiles and admin_static template tag libraries are removed. django.contrib.staticfiles.templatetags.staticfiles.static() is removed.", "keywords": ["users", "feed", "bigintegerfield", "integerfield", "storage", "strategies", "underscores", "pattern", "2.2.x", "messages", "formsets", "functools.lru_cache", "library", "django.views.i18n.set_language", "field", "django.utils.decorators", "+", "geometrydistance", "host", "range", "stage", "httpresponse", "django.utils.http.cookie_date", "cache", "compatibility", "sha1", "ngettext", "forcerhr", "change", "httprequest.headers", "annotation", "filenames", "label", "hash", "changes", "=", "results", "connection.queries", "engine", "django.utils.lru_cache.lru_cache", "six.python_2_unicode_compatible", "positivesmallintegerfield", "force_insert", "character", "tag", "patch_vary_headers", "process", "debug", "nosniff", "type", "ordering_widget", "custom", "optimization", "documentation", "smallautofield", ".po", "lookups", "databasefeatures.can_return_id_from_insert", "datetime.timedelta", "discoverrunner", "file", "customization", "constraint", "exclusion", "get_ordering_widget", "user", "unused", "cases", "attribute", "django.contrib.gis", "re_path", "warning", "size", "constraints", "time", "checkconstraint", "save", "jquery", ".tar.lzma", "startapp", "setting", "safebytes", "operators", "responses", "app_label", "language_cookie_name", "third", "x27", "minor", "password", "django.test.utils.patch_logger", "name", "parameter", "flags", "backends", "django.contrib.auth", "age", "versions", "interpolation", "is_dst", "functools.partialmethod", "django.contrib.admin", "frames", "applications", "contextlib", "expressions", "december", "datetimefield", "mymodel", "examples", "failure", "testcase.assertlogs", "field.choices", "username", "aliases", "databaseoperations.return_insert_id", "model.save", "url", "error", "module", "code", "get_session_cookie_age", "algorithm", "httponly", "filter", "postgis", "behavior", "false", "update_or_create", "class", "i", "placeholders", "group", "warnings", "widget", "is_safe_url", "add_never_cache_headers", "names", "x", "u", "pbkdf2", "app_label)s", "request", "database", "*", "query", "test", "commands", "postgresql", "-k", "urlunquote", "urlencode", "count", "types", "strings", "subclass", "admin", "creation", "typos", "insert", "usage", "gettext_noop", "django.views.debug", "wsgi", "enumerations", "limit", "thread", "synchronousonlyoperation", "section", "filepathfield", "certificates", "converts", "component", "boundaries", "utc+05:00", "use", "dbshell", "environment", "uzbek", "sum", "adminemailhandler", "entity", "queryset.earliest", "secure_content_type_nosniff", "enumeration", "django.contrib.auth.logout", "order", "signature", "default", "urlquote_plus", "choices", "alias", "reset_url_token", "databaseintrospection.get_geometry_type", "samesite", "pywatchman", "modeladmin.list_display", "option", "properties", "format", "expression", "tests", "classes", "contenttype.__str", "get_user_permissions", "booleanfield", "existing_pk", "scheme", "iri_to_uri", "createsuperuser", "furlong", "template", "header", "onetoonefield", "interaction", "traceback", "way", "frameworks", "databasefeatures.can_create_inline_fk", "formats", "phrase", "exceptionreporter", "gdal", "checks", "boxes", "index", "ugettext_noop", "class)s", "party", "html.unescape", "queryset", "integer", "session", "¶", "command", "internationalization", "remove", "property", "side", "miscellaneous", "positiveintegerfield", "content", "function", "ends", "views", "contextdecorator", "view", "field.descriptor_class", "django.contrib.sessions", "control", "0o644", "indexes", "permissions", "datetimes", "values", "staticfiles", "lzma", "directories", "loops", "debugger", "favor", "auto", "databases", "intword", "managers", "unit", "event", "inlines", "language_cookie_httponly", "table", "libraries", "language", "models", "history", "copy", "referrer", "version", "prefixes", "allows_group_by_selected_pks_on_model", "hyphens", "gis", "expression.convert_value", "labels", "rangeoperators", "treatment", "deprecation", "get_language", "django", "series", "allowed", "rfc", "n’t", "securitymiddleware", "django.utils.text.unescape_entities", "fields", "xz", "languages", "fixes", "databaseintrospection.get_field_type", "smart_text", "usermanager.with_perm", "value", "journey", "line", "policy", "data", "browser", "april", "handler", "scope", "field.from_db_value", "backend", "guide", "sha256", "iterable", "file_upload_permissions", "security", "shortcut", "self", "need", "instance", "return_insert_columns", "members", "geometries", "trunc", "django.contrib.syndication", "validators", "quote_plus", "exc_info", "integerchoices", "datetime_cast_date_sql", "instances", "statement", "language_cookie_samesite", "inconsistency", "references", "groups", "localemiddleware", "manytomanyfield", "management", "response", "sql", "utility", "requests", "authors", "reset", "compilemessages", "keyword", "rangeboundary", "child", "file_upload_handlers", "queryset.filter(pk=", "django.utils.encoding.force_text", "modeladmin.get_inlines", "variables", "notes", "integrityerror", "life", "effect", "system", "apps", "tls", "never_cache", "clauses", "datetime.timezone", "async", "spatialite", "archives", "django.utils._os.upath", "concurrently", "welcome", "plural", "s.", "widgets", "can_return_ids_from_bulk_insert", "--skip", "headers", "3.4.1", "autofield", "check", "features", "forms", "site", "httprequest.xreadlines", "july", "addition", "example", "app", "sha512", "datetime_extract_sql", "column", "django.utils.decorators.available_attrs", "list", "django.utils.translation.gettext", "orm", ").update", "can_return_rows_from_bulk_insert", "upstream", "passwordresetconfirmview", "smart_str", "hasher", "html.escape", "language_cookie_secure", "email", "npath", "filefield.upload_to", "asterisk", "md5", "model", "--ignore", "sameorigin", "force_str", "apis", "callable", "descriptors", "memoryview", "place", "confusion", "application", "attributes", "regexpattern", "vary", "release", "asgi", "expression.get_group_by_cols", "geos", "fetch_returned_insert_columns", "unescape_entities", "force_text", "uniqueconstraint", "storage.get_alternative_name", "keys", "exclusionconstraint", "authentication", "lookup", "html", "get_group_permissions", "showmigrations", "future", "tuple", "arguments", "18c", "package", "pathlib", "middleware", "directive", "end", "translations", "entries", "comparison", "textchoices", "tuples", "can_return_columns_from_insert", "1.2.0", "path", "functions", "key", "operations", "django.contrib.auth.forms", "update", "inspectdb", "reporter_class", "django.contrib.syndication.views", "none", "filters", "sha384", "sign", "4.0.3", "get", "raise_request_exception", "url_has_allowed_host_and_scheme", "new", "true", "django.utils._os.abspathu", "urls", "api", "sessions", "support", "description", "cookies", "basebackend", "mode", "projects", "django.db.backends.postgresql_psycopg2", "django.db.backends.base", "field_name", "context", "cycle", "permission", "files", "d", "admins", "iteration", "rangefield", "statements", "mysql", "%", "defaults", "pk", "avg", "foreignkey", "attempts", "default_content_type", "information", "row", "x_frame_options", "python", "bigautofield", "schemaeditor.sql_create_column_inline_fk", "functools.partial", "basedatabasefeatures", "options", "exception", "client", "details", "method", "settings", "smallintegerfield", "argument", "cookie", "oracle", "asserthtmlequal", "django.test.utils.str_prefix", "deny", "ungettext", "distance", "templates", "admin_order_field", "text", "project", "exceptions"], "type": "documentation"},
{"title": "Django 3.2 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/3.2/", "content": "Django 3.2 release notes ¶ April 6, 2021 Welcome to Django 3.2! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 3.1 or earlier. We’ve begun the deprecation process for some features . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Django 3.2 is designated as a long-term support release . It will receive security updates for at least\nthree years after its release. Support for the previous LTS, Django 2.2, will\nend in April 2022. Python compatibility ¶ Django 3.2 supports Python 3.6, 3.7, 3.8, 3.9, and 3.10 (as of 3.2.9). We highly recommend and only officially support the latest release of each\nseries. What’s new in Django 3.2 ¶ Automatic AppConfig discovery ¶ Most pluggable applications define an AppConfig subclass\nin an apps.py submodule. Many define a default_app_config variable\npointing to this class in their __init__.py . When the apps.py submodule exists and defines a single AppConfig subclass, Django now uses that configuration\nautomatically, so you can remove default_app_config . default_app_config made it possible to declare only the application’s path\nin INSTALLED_APPS (e.g. 'django.contrib.admin' ) rather than the\napp config’s path (e.g. 'django.contrib.admin.apps.AdminConfig' ). It was\nintroduced for backwards-compatibility with the former style, with the intent\nto switch the ecosystem to the latter, but the switch didn’t happen. With automatic AppConfig discovery, default_app_config is no longer\nneeded. As a consequence, it’s deprecated. See Configuring applications for full details. Customizing type of auto-created primary keys ¶ When defining a model, if no field in a model is defined with primary_key=True an implicit\nprimary key is added. The type of this implicit primary key can now be\ncontrolled via the DEFAULT_AUTO_FIELD setting and AppConfig.default_auto_field attribute. No more needing to override primary keys in all models. Maintaining the historical behavior, the default value for DEFAULT_AUTO_FIELD is AutoField . Starting\nwith 3.2 new projects are generated with DEFAULT_AUTO_FIELD set to BigAutoField . Also, new apps are generated with AppConfig.default_auto_field set to BigAutoField . In a future Django release the\ndefault value of DEFAULT_AUTO_FIELD will be changed to BigAutoField . To avoid unwanted migrations in the future, either explicitly set DEFAULT_AUTO_FIELD to AutoField : DEFAULT_AUTO_FIELD = \"django.db.models.AutoField\" or configure it on a per-app basis: from django.apps import AppConfig class MyAppConfig ( AppConfig ): default_auto_field = \"django.db.models.AutoField\" name = \"my_app\" or on a per-model basis: from django.db import models class MyModel ( models . Model ): id = models . AutoField ( primary_key = True ) In anticipation of the changing default, a system check will provide a warning\nif you do not have an explicit setting for DEFAULT_AUTO_FIELD . When changing the value of DEFAULT_AUTO_FIELD , migrations for the\nprimary key of existing auto-created through tables cannot be generated\ncurrently. See the DEFAULT_AUTO_FIELD docs for details on migrating\nsuch tables. Functional indexes ¶ The new *expressions positional\nargument of Index() enables creating\nfunctional indexes on expressions and database functions. For example: from django.db import models from django.db.models import F , Index , Value from django.db.models.functions import Lower , Upper class MyModel ( models . Model ): first_name = models . CharField ( max_length = 255 ) last_name = models . CharField ( max_length = 255 ) height = models . IntegerField () weight = models . IntegerField () class Meta : indexes = [ Index ( Lower ( \"first_name\" ), Upper ( \"last_name\" ) . desc (), name = \"first_last_name_idx\" , ), Index ( F ( \"height\" ) / ( F ( \"weight\" ) + Value ( 5 )), name = \"calc_idx\" , ), ] Functional indexes are added to models using the Meta.indexes option. pymemcache support ¶ The new django.core.cache.backends.memcached.PyMemcacheCache cache backend\nallows using the pymemcache library for memcached. pymemcache 3.4.0\nor higher is required. For more details, see the documentation on caching\nin Django . New decorators for the admin site ¶ The new display() decorator allows for easily\nadding options to custom display functions that can be used with list_display or readonly_fields . Likewise, the new action() decorator allows for\neasily adding options to action functions that can be used with actions . Using the @display decorator has the advantage that it is now\npossible to use the @property decorator when needing to specify attributes\non the custom method. Prior to this it was necessary to use the property() function instead after assigning the required attributes to the method. Using decorators has the advantage that these options are more discoverable as\nthey can be suggested by completion utilities in code editors. They are merely\na convenience and still set the same attributes on the functions under the\nhood. Minor features ¶ django.contrib.admin ¶ ModelAdmin.search_fields now allows searching against quoted phrases\nwith spaces. Read-only related fields are now rendered as navigable links if target models\nare registered in the admin. The admin now supports theming, and includes a dark theme that is enabled\naccording to browser settings. See Theming support for more details. ModelAdmin.autocomplete_fields now respects ForeignKey.to_field and ForeignKey.limit_choices_to when searching a related\nmodel. The admin now installs a final catch-all view that redirects unauthenticated\nusers to the login page, regardless of whether the URL is otherwise valid.\nThis protects against a potential model enumeration privacy issue. Although not recommended, you may set the new AdminSite.final_catch_all_view to False to disable the\ncatch-all view. django.contrib.auth ¶ The default iteration count for the PBKDF2 password hasher is increased from\n216,000 to 260,000. The default variant for the Argon2 password hasher is changed to Argon2id. memory_cost and parallelism are increased to 102,400 and 8\nrespectively to match the argon2-cffi defaults. Increasing the memory_cost pushes the required memory from 512 KB to 100\nMB. This is still rather conservative but can lead to problems in memory\nconstrained environments. If this is the case, the existing hasher can be\nsubclassed to override the defaults. The default salt entropy for the Argon2, MD5, PBKDF2, SHA-1 password hashers\nis increased from 71 to 128 bits. django.contrib.contenttypes ¶ The new absolute_max argument for generic_inlineformset_factory() allows customizing the maximum number of forms that can be instantiated when\nsupplying POST data. See Limiting the maximum number of instantiated forms for more details. The new can_delete_extra argument for generic_inlineformset_factory() allows removal of the option to delete extra forms. See can_delete_extra for more information. django.contrib.gis ¶ The GDALRaster.transform() method now supports SpatialReference . The DataSource class now supports pathlib.Path . The LayerMapping class now supports pathlib.Path . django.contrib.postgres ¶ The new ExclusionConstraint.include attribute allows creating\ncovering exclusion constraints on PostgreSQL 12+. The new ExclusionConstraint.opclasses attribute allows setting PostgreSQL\noperator classes. The new JSONBAgg.ordering attribute determines the ordering of the\naggregated elements. The new JSONBAgg.distinct attribute determines if aggregated values\nwill be distinct. The CreateExtension operation\nnow checks that the extension already exists in the database and skips the\nmigration if so. The new CreateCollation and RemoveCollation operations\nallow creating and dropping collations on PostgreSQL. See Managing collations using migrations for more details. Lookups for ArrayField now allow\n(non-nested) arrays containing expressions as right-hand sides. The new OpClass() expression allows creating functional indexes on expressions with a custom\noperator class. See Functional indexes for more details. django.contrib.sitemaps ¶ The new Sitemap attributes alternates , languages and x_default allow\ngenerating sitemap alternates to localized versions of your pages. django.contrib.syndication ¶ The new item_comments hook allows specifying a comments URL per feed\nitem. Database backends ¶ Third-party database backends can now skip or mark as expected failures\ntests in Django’s test suite using the new DatabaseFeatures.django_test_skips and django_test_expected_failures attributes. Decorators ¶ The new no_append_slash() decorator\nallows individual views to be excluded from APPEND_SLASH URL\nnormalization. Error Reporting ¶ Custom ExceptionReporter subclasses can now\ndefine the html_template_path and text_template_path properties to override the templates used to render exception reports. File Uploads ¶ The new FileUploadHandler.upload_interrupted() callback allows handling interrupted uploads. Forms ¶ The new absolute_max argument for formset_factory() , inlineformset_factory() , and modelformset_factory() allows\ncustomizing the maximum number of forms that can be instantiated when\nsupplying POST data. See Limiting the maximum number of instantiated forms for more details. The new can_delete_extra argument for formset_factory() , inlineformset_factory() , and modelformset_factory() allows\nremoval of the option to delete extra forms. See can_delete_extra for more information. BaseFormSet now reports a user facing error,\nrather than raising an exception, when the management form is missing or has\nbeen tampered with. To customize this error message, pass the error_messages argument with the key 'missing_management_form' when\ninstantiating the formset. Generic Views ¶ The week_format attributes of WeekMixin and WeekArchiveView now support the '%V' ISO 8601 week format. Management Commands ¶ loaddata now supports fixtures stored in XZ archives ( .xz ) and\nLZMA archives ( .lzma ). dumpdata now can compress data in the bz2 , gz , lzma ,\nor xz formats. makemigrations can now be called without an active database\nconnection. In that case, check for a consistent migration history is\nskipped. BaseCommand.requires_system_checks now supports specifying a list of\ntags. System checks registered in the chosen tags will be checked for errors\nprior to executing the command. In previous versions, either all or none\nof the system checks were performed. Support for colored terminal output on Windows is updated. Various modern\nterminal environments are automatically detected, and the options for\nenabling support in other cases are improved. See Syntax coloring for\nmore details. Migrations ¶ The new Operation.migration_name_fragment property allows providing a\nfilename fragment that will be used to name a migration containing only that\noperation. Migrations now support serialization of pure and concrete path objects from pathlib , and os.PathLike instances. Models ¶ The new no_key parameter for QuerySet.select_for_update() ,\nsupported on PostgreSQL, allows acquiring weaker locks that don’t block the\ncreation of rows that reference locked rows through a foreign key. When() expression now allows\nusing the condition argument with lookups . The new Index.include and UniqueConstraint.include attributes allow creating covering indexes and covering unique constraints on\nPostgreSQL 11+. The new UniqueConstraint.opclasses attribute allows setting\nPostgreSQL operator classes. The QuerySet.update() method now respects the order_by() clause on\nMySQL and MariaDB. FilteredRelation() now supports\nnested relations. The of argument of QuerySet.select_for_update() is now allowed\non MySQL 8.0.1+. Value() expression now\nautomatically resolves its output_field to the appropriate Field subclass based on the type of\nits provided value for bool , bytes , float , int , str , datetime.date , datetime.datetime , datetime.time , datetime.timedelta , decimal.Decimal , and uuid.UUID instances. As a\nconsequence, resolving an output_field for database functions and\ncombined expressions may now crash with mixed types when using Value() .\nYou will need to explicitly set the output_field in such cases. The new QuerySet.alias() method allows creating reusable aliases for\nexpressions that don’t need to be selected but are used for filtering,\nordering, or as a part of complex expressions. The new Collate function allows\nfiltering and ordering by specified database collations. The field_name argument of QuerySet.in_bulk() now accepts\ndistinct fields if there’s only one field specified in QuerySet.distinct() . The new tzinfo parameter of the TruncDate and TruncTime database functions allows\ntruncating datetimes in a specific timezone. The new db_collation argument for CharField and TextField allows setting a\ndatabase collation for the field. Added the Random database function. Aggregation functions , F() , OuterRef() , and other expressions now\nallow using transforms. See Expressions can reference transforms for\ndetails. The new durable argument for atomic() guarantees that changes made in the atomic block will be committed if the\nblock exits without errors. A nested atomic block marked as durable will\nraise a RuntimeError . Added the JSONObject database function. Pagination ¶ The new django.core.paginator.Paginator.get_elided_page_range() method\nallows generating a page range with some of the values elided. If there are a\nlarge number of pages, this can be helpful for generating a reasonable number\nof page links in a template. Requests and Responses ¶ Response headers are now stored in HttpResponse.headers . This can be\nused instead of the original dict-like interface of HttpResponse objects.\nBoth interfaces will continue to be supported. See Setting header fields for details. The new headers parameter of HttpResponse , SimpleTemplateResponse , and TemplateResponse allows setting response headers on instantiation. Security ¶ The SECRET_KEY setting is now checked for a valid value upon first\naccess, rather than when settings are first loaded. This enables running\nmanagement commands that do not rely on the SECRET_KEY without needing to\nprovide a value. As a consequence of this, calling configure() without providing a valid SECRET_KEY , and then going on to access settings.SECRET_KEY will now\nraise an ImproperlyConfigured exception. The new Signer.sign_object() and Signer.unsign_object() methods allow\nsigning complex data structures. See Protecting complex data structures for more\ndetails. Also, signing.dumps() and loads() become shortcuts for TimestampSigner.sign_object() and unsign_object() . Serialization ¶ The new JSONL serializer allows using\nthe JSON Lines format with dumpdata and loaddata . This\ncan be useful for populating large databases because data is loaded line by\nline into memory, rather than being loaded all at once. Signals ¶ Signal.send_robust() now logs\nexceptions. Templates ¶ floatformat template filter now allows using the g suffix to\nforce grouping by the THOUSAND_SEPARATOR for the active locale. Templates cached with Cached template loaders are\nnow correctly reloaded in development. Tests ¶ Objects assigned to class attributes in TestCase.setUpTestData() are\nnow isolated for each test method. Such objects are now required to support\ncreating deep copies with copy.deepcopy() . Assigning objects which\ndon’t support deepcopy() is deprecated and will be removed in Django 4.1. DiscoverRunner now enables faulthandler by default. This can be disabled by using the test --no-faulthandler option. DiscoverRunner and the test management command can now track timings, including database\nsetup and total run time. This can be enabled by using the test --timing option. Client now preserves the request query string when\nfollowing 307 and 308 redirects. The new TestCase.captureOnCommitCallbacks() method captures callback\nfunctions passed to transaction.on_commit() in a list. This allows you to test such\ncallbacks without using the slower TransactionTestCase . TransactionTestCase.assertQuerysetEqual() now supports direct\ncomparison against another queryset rather than being restricted to\ncomparison against a list of string representations of objects when using the\ndefault value for the transform argument. Utilities ¶ The new depth parameter of django.utils.timesince.timesince() and django.utils.timesince.timeuntil() functions allows specifying the number\nof adjacent time units to return. Validators ¶ Built-in validators now include the provided value in the params argument\nof a raised ValidationError . This allows\ncustom error messages to use the %(value)s placeholder. The ValidationError equality operator now ignores messages and params ordering. Backwards incompatible changes in 3.2 ¶ Database backend API ¶ This section describes changes that may be needed in third-party database\nbackends. The new DatabaseFeatures.introspected_field_types property replaces these\nfeatures: can_introspect_autofield can_introspect_big_integer_field can_introspect_binary_field can_introspect_decimal_field can_introspect_duration_field can_introspect_ip_address_field can_introspect_positive_integer_field can_introspect_small_integer_field can_introspect_time_field introspected_big_auto_field_type introspected_small_auto_field_type introspected_boolean_field_type To enable support for covering indexes ( Index.include ) and covering\nunique constraints ( UniqueConstraint.include ), set DatabaseFeatures.supports_covering_indexes to True . Third-party database backends must implement support for column database\ncollations on CharField s and TextField s or set DatabaseFeatures.supports_collation_on_charfield and DatabaseFeatures.supports_collation_on_textfield to False . If\nnon-deterministic collations are not supported, set supports_non_deterministic_collations to False . DatabaseOperations.random_function_sql() is removed in favor of the new Random database function. DatabaseOperations.date_trunc_sql() and DatabaseOperations.time_trunc_sql() now take the optional tzname argument in order to truncate in a specific timezone. DatabaseClient.runshell() now gets arguments and an optional dictionary\nwith environment variables to the underlying command-line client from DatabaseClient.settings_to_cmd_args_env() method. Third-party database\nbackends must implement DatabaseClient.settings_to_cmd_args_env() or\noverride DatabaseClient.runshell() . Third-party database backends must implement support for functional indexes\n( Index.expressions ) or set DatabaseFeatures.supports_expression_indexes to False . If COLLATE is not a part of the CREATE INDEX statement, set DatabaseFeatures.collate_as_index_expression to True . django.contrib.admin ¶ Pagination links in the admin are now 1-indexed instead of 0-indexed, i.e.\nthe query string for the first page is ?p=1 instead of ?p=0 . The new admin catch-all view will break URL patterns routed after the admin\nURLs and matching the admin URL prefix. You can either adjust your URL\nordering or, if necessary, set AdminSite.final_catch_all_view to False ,\ndisabling the catch-all view. See What’s new in Django 3.2 for more details. Minified JavaScript files are no longer included with the admin. If you\nrequire these files to be minified, consider using a third party app or\nexternal build tool. The minified vendored JavaScript files packaged with the\nadmin (e.g. jquery.min.js ) are still included. ModelAdmin.prepopulated_fields no longer strips English stop words,\nsuch as 'a' or 'an' . django.contrib.gis ¶ Support for PostGIS 2.2 is removed. The Oracle backend now clones polygons (and geometry collections containing\npolygons) before reorienting them and saving them to the database. They are\nno longer mutated in place. You might notice this if you use the polygons\nafter a model is saved. Dropped support for PostgreSQL 9.5 ¶ Upstream support for PostgreSQL 9.5 ends in February 2021. Django 3.2 supports\nPostgreSQL 9.6 and higher. Dropped support for MySQL 5.6 ¶ The end of upstream support for MySQL 5.6 is April 2021. Django 3.2 supports\nMySQL 5.7 and higher. Miscellaneous ¶ Django now supports non- pytz time zones, such as Python 3.9+’s zoneinfo module and its backport. The undocumented SpatiaLiteOperations.proj4_version() method is renamed\nto proj_version() . slugify() now removes leading and trailing dashes\nand underscores. The intcomma and intword template filters no longer\ndepend on the USE_L10N setting. Support for argon2-cffi < 19.1.0 is removed. The cache keys no longer includes the language when internationalization is\ndisabled ( USE_I18N = False ) and localization is enabled\n( USE_L10N = True ). After upgrading to Django 3.2 in such configurations,\nthe first request to any previously cached value will be a cache miss. ForeignKey.validate() now uses _base_manager rather than _default_manager to check that related\ninstances exist. When an application defines an AppConfig subclass in\nan apps.py submodule, Django now uses this configuration automatically,\neven if it isn’t enabled with default_app_config . Set default = False in the AppConfig subclass if you need to prevent this\nbehavior. See What’s new in Django 3.2 for more details. Instantiating an abstract model now raises TypeError . Keyword arguments to setup_databases() are now\nkeyword-only. The undocumented django.utils.http.limited_parse_qsl() function is\nremoved. Please use urllib.parse.parse_qsl() instead. django.test.utils.TestContextDecorator now uses addCleanup() so that cleanups registered in the setUp() method are called before TestContextDecorator.disable() . SessionMiddleware now raises a SessionInterrupted exception\ninstead of SuspiciousOperation when a session\nis destroyed in a concurrent request. The django.db.models.Field equality operator now correctly\ndistinguishes inherited field instances across models. Additionally, the\nordering of such fields is now defined. The undocumented django.core.files.locks.lock() function now returns False if the file cannot be locked, instead of raising BlockingIOError . The password reset mechanism now invalidates tokens when the user email is\nchanged. makemessages command no longer processes invalid locales specified\nusing makemessages --locale option, when they contain hyphens\n( '-' ). The django.contrib.auth.forms.ReadOnlyPasswordHashField form field is now disabled by default. Therefore UserChangeForm.clean_password() is no longer required to return the\ninitial value. The cache.get_many() , get_or_set() , has_key() , incr() , decr() , incr_version() , and decr_version() cache operations now\ncorrectly handle None stored in the cache, in the same way as any other\nvalue, instead of behaving as though the key didn’t exist. Due to a python-memcached limitation, the previous behavior is kept for\nthe deprecated MemcachedCache backend. The minimum supported version of SQLite is increased from 3.8.3 to 3.9.0. CookieStorage now stores\nmessages in the RFC 6265 compliant format. Support for cookies that use\nthe old format remains until Django 4.1. The minimum supported version of asgiref is increased from 3.2.10 to\n3.3.2. Features deprecated in 3.2 ¶ Miscellaneous ¶ Assigning objects which don’t support creating deep copies with copy.deepcopy() to class attributes in TestCase.setUpTestData() is deprecated. Using a boolean value in BaseCommand.requires_system_checks is\ndeprecated. Use '__all__' instead of True , and [] (an empty list)\ninstead of False . The whitelist argument and domain_whitelist attribute of EmailValidator are deprecated. Use allowlist instead of whitelist , and domain_allowlist instead of domain_whitelist . You may need to rename whitelist in existing\nmigrations. The default_app_config application configuration variable is deprecated,\ndue to the now automatic AppConfig discovery. See What’s new in Django 3.2 for more details. Automatically calling repr() on a queryset in TransactionTestCase.assertQuerysetEqual() , when compared to string\nvalues, is deprecated. If you need the previous behavior, explicitly set transform to repr . The django.core.cache.backends.memcached.MemcachedCache backend is\ndeprecated as python-memcached has some problems and seems to be\nunmaintained. Use django.core.cache.backends.memcached.PyMemcacheCache or django.core.cache.backends.memcached.PyLibMCCache instead. The format of messages used by django.contrib.messages.storage.cookie.CookieStorage is different from\nthe format generated by older versions of Django. Support for the old format\nremains until Django 4.1.", "keywords": ["users", "appconfig.default_auto_field", "feed", "has_key", "rows", "databasefeatures.supports_expression_indexes", "integerfield", "underscores", "formset", "login", "assigning", "messages", "can_introspect_duration_field", "default_auto_field", "library", "field", "outerref", "faulthandler", "intcomma", "serialization", "spatialreference", "migrations", "non-", "bits", "+", "lts", "copy.deepcopy", "action", "range", "config", "transforms", "lines", "django.db.models", "httpresponse", "cache", "compatibility", "8.0.1", "sha-1", "words", "datasource", "tool", "jsonl", "emailvalidator", "links", "suite", "p=0", "hook", "mb", "modeladmin.prepopulated_fields", "django.core.cache.backends.memcached", "changes", "=", "message", "testcase.setuptestdata", "queryset.alias", "setup", "weight", "tables", "zones", "decr", "height", "process", "memcached", "datetime.datetime", "missing_management_form", "first_name", "minified", "type", "sessioninterrupted", "error_messages", "variant", "no_key", "custom", "objects", "documentation", "lookups", "absolute_max", "datetime.timedelta", "discoverrunner", "file", "databasefeatures.supports_collation_on_textfield", "exclusion", "user", "init__.py", "fragment", "cases", "callbacks", "sides", "attribute", "django.contrib.gis", "mechanism", "runtimeerror", "warning", "opclass", "constraints", "time", "tags", "basis", "setting", "entropy", "responses", "third", "transform", "jsonobject", "password", "can_introspect_decimal_field", "name", "hood", "makemigrations", "parameter", "backends", "reference", "copies", "django.contrib.auth", "issue", "testcase.captureoncommitcallbacks", "collations", "problems", "versions", "configurations", "domain_whitelist", "django.contrib.admin", "configuring", "applications", "operator", "memory", "expressions", "environments", "backport", "textfield", "uniqueconstraint.include", "text_template_path", "datetime.date", "mymodel", "pylibmccache", "sessionmiddleware", "django_test_expected_failures", "aliases", "filteredrelation", "february", "bool", "url", "error", "geometry", "module", "code", "uniqueconstraint.opclasses", "pages", "filter", "style", "behavior", "false", "i", "class", "display", "migration", "discovery", "clause", "access", "databaseoperations.random_function_sql", "customizing", "configure", "'", "desc", "javascript", "my_app", "years", "pbkdf2", "request", "database", "block", "output", "lower", "query", "page", "test", "commands", "postgresql", "suspiciousoperation", "use_l10n", "count", "types", "locales", "elements", "calc_idx", "subclass", "admin", "creation", "databaseclient.settings_to_cmd_args_env", "transactiontestcase", "configuration", "max_length", "generic_inlineformset_factory", "createcollation", "can_introspect_small_integer_field", "databaseoperations.time_trunc_sql", "instantiation", "databasefeatures.supports_covering_indexes", "pointing", "index.expressions", "collate", "section", "suffix", "representations", "django.core.paginator", "weekarchiveview", "pymemcache", "salt", "use", "miss", "placeholder", "cffi", "environment", "pathlike", "kb", "decr_version", "cookiestorage", "subclasses", "index.include", "queryset.in_bulk", "random", "enumeration", "timestampsigner.sign_object", "databasefeatures.supports_collation_on_charfield", "operation", "order", "params", "default", "baseformset", "upper", "submodule", "form", ".xz", "shortcuts", "signals", "prefix", "option", "properties", "format", "callback", "classes", "expression", "tests", "equality", "testcontextdecorator.disable", "timezone", "advantage", "convenience", "validationerror", "f", "bz2", "signer.sign_object", "adminconfig", "privacy", "limitation", "week", "template", "anticipation", "header", "tzname", "way", "formats", "operation.migration_name_fragment", "can_introspect_time_field", "exceptionreporter", "foreignkey.to_field", "checks", "interfaces", "meta.indexes", "comments", "index", "party", "completion", "queryset", "session", "argon2id", "reports", "¶", "bytes", "command", "can_introspect_binary_field", "internationalization", "spaces", "post", "deepcopy", "jquery.min.js", "no_append_slash", "int", "property", "createextension", "base_manager", "memory_cost", "miscellaneous", "jsonbagg.distinct", "function", "ends", "views", "arrayfield", "@property", "view", "float", "uuid", "run", "databasefeatures.collate_as_index_expression", "indexes", "number", "collections", "19.1.0", "relations", "adminsite.final_catch_all_view", "datetimes", "values", "lzma", "failures", "string", "order_by", "windows", "memcachedcache", "favor", "auto", "databases", "intword", "timings", "structures", "signal.send_robust", "hand", "paginator.get_elided_page_range", "setup_databases", "language", "jsonbagg.ordering", "models", "history", "version", "json", "distinguishes", "dashes", "hyphens", "deprecation", "testcontextdecorator", "condition", "minimum", "django", "series", "rfc", "n’t", "formset_factory", "fields", "xz", "utilities", "truncdate", "dumpdata", "languages", "intent", "editors", "development", "override", "exclusionconstraint.opclasses", "databasefeatures.django_test_skips", "value", "phrases", "line", "supports_non_deterministic_collations", "html_template_path", "improperlyconfigured", "data", "browser", "april", "item", "db_collation", "backend", "guide", "switch", "queryset.update", "trunctime", "list_display", "security", "updates", "locks", "removecollation", "typeerror", "reporting", "localization", "output_field", "aggregation", "makemessages", "theme", "django.contrib.syndication", "primary_key", "extension", "foreignkey.limit_choices_to", "simpletemplateresponse", "consequence", "interface", "validators", "modeladmin.search_fields", "arrays", "docs", "decorator", "foreignkey.validate", "floatformat", "instances", "iso", "statement", "modeladmin.autocomplete_fields", "tzinfo", "part", "fixtures", "argon2", "asgiref", "charfield", "management", "response", "loaders", "dictionary", "requests", "reset", "locale", "tokens", "layermapping", "keyword", "ordering", "cache.get_many", "domain_allowlist", "queryset.select_for_update", "variables", "decorators", "v", "notes", "parallelism", "django.contrib.contenttypes", "system", "apps", "filtering", "archives", "welcome", "introspected_boolean_field_type", "loaddata", "removal", "serializer", "decimal", "headers", "zoneinfo", "autofield", "item_comments", "target", "check", "features", "site", "forms", "queryset.distinct", "uploads", "example", "app", "column", "list", "collation", "django.apps", "upstream", "weekmixin", "databaseoperations.date_trunc_sql", "hasher", "alternates", "email", "3.3.2", "allowlist", "gdalraster.transform", "md5", "model", "variable", "basecommand.requires_system_checks", "place", "value)s", "django.db.models.functions", "cleanups", "application", "inlineformset_factory", "actions", "attributes", "pagination", "release", "redirects", "django.utils.timesince.timesince", "django.contrib.admin.apps", "urllib.parse.parse_qsl", "signing.dumps", "syntax", "default_app_config", "keys", "case", "introspected_big_auto_field_type", "addcleanup", "errors", "can_introspect_autofield", "@display", "future", "str", "arguments", "normalization", "pathlib", "end", "g", "sqlite", "comparison", "userchangeform.clean_password", "last_name", "secret_key", "mark", "path", "depth", "automatic", "functions", "key", "hashers", "term", "operations", "build", "appconfig", "spatialiteoperations.proj4_version", "django.contrib.auth.forms", "none", "filters", "transactiontestcase.assertquerysetequal", "meta", "unsign_object", "readonlypasswordhashfield", "patterns", "ecosystem", "django.test.utils", "true", "templateresponse", "sitemap", "urls", "api", "loads", "support", "cookies", "week_format", "apps.py", "projects", "connection", "field_name", "units", "import", "files", "d", "iteration", "mysql", "%", "defaults", "polygons", "thousand_separator", "information", "whitelist", "python", "databasefeatures.introspected_field_types", "bigautofield", "methods", "options", "exception", "client", "details", "method", "databaseclient.runshell", "django.db", "readonly_fields", "settings", "argument", "oracle", "catch", "django.utils.http.limited_parse_qsl", "templates", "can_introspect_positive_integer_field", "project", "incr_version", "exceptions"], "type": "documentation"},
{"title": "Django 1.9.10 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.9.10/", "content": "Django 1.9.10 release notes ¶ September 26, 2016 Django 1.9.10 fixes a security issue in 1.9.9. CSRF protection bypass on a site with Google Analytics ¶ An interaction between Google Analytics and Django’s cookie parsing could allow\nan attacker to set arbitrary cookies leading to a bypass of CSRF protection. The parser for request.COOKIES is simplified to better match the behavior\nof browsers and to mitigate this attack. request.COOKIES may now contain\ncookies that are invalid according to RFC 6265 but are possible to set via document.cookie .", "keywords": ["security", "protection", "parser", "django", "interaction", "site", "release", "rfc", "document.cookie", "issue", "bypass", "behavior", "csrf", "september", "analytics", "¶", "attacker", "cookie", "attack", "request", "parsing", "browsers", "google", "cookies"], "type": "documentation"},
{"title": "Django 1.8.15 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.8.15/", "content": "Django 1.8.15 release notes ¶ September 26, 2016 Django 1.8.15 fixes a security issue in 1.8.14. CSRF protection bypass on a site with Google Analytics ¶ An interaction between Google Analytics and Django’s cookie parsing could allow\nan attacker to set arbitrary cookies leading to a bypass of CSRF protection. The parser for request.COOKIES is simplified to better match the behavior\nof browsers and to mitigate this attack. request.COOKIES may now contain\ncookies that are invalid according to RFC 6265 but are possible to set via document.cookie .", "keywords": ["1.8.14", "security", "protection", "parser", "django", "interaction", "site", "release", "rfc", "document.cookie", "issue", "bypass", "behavior", "csrf", "september", "analytics", "¶", "attacker", "cookie", "attack", "request", "parsing", "1.8.15", "browsers", "google", "cookies"], "type": "documentation"},
{"title": "Unicode data | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/unicode/", "content": "Unicode data ¶ Django supports Unicode data everywhere. This document tells you what you need to know if you’re writing applications\nthat use data or templates that are encoded in something other than ASCII. Creating the database ¶ Make sure your database is configured to be able to store arbitrary string\ndata. Normally, this means giving it an encoding of UTF-8 or UTF-16. If you use\na more restrictive encoding – for example, latin1 (iso8859-1) – you won’t be\nable to store certain characters in the database, and information will be lost. MySQL users, refer to the MySQL manual for details on how to set or alter\nthe database character set encoding. PostgreSQL users, refer to the PostgreSQL manual for details on creating\ndatabases with the correct encoding. Oracle users, refer to the Oracle manual for details on how to set\n( section 2 ) or alter ( section 11 ) the database character set encoding. SQLite users, there is nothing you need to do. SQLite always uses UTF-8\nfor internal encoding. All of Django’s database backends automatically convert strings into\nthe appropriate encoding for talking to the database. They also automatically\nconvert strings retrieved from the database into strings. You don’t even need\nto tell Django what encoding your database uses: that is handled transparently. For more, see the section “The database API” below. General string handling ¶ Whenever you use strings with Django – e.g., in database lookups, template\nrendering or anywhere else – you have two choices for encoding those strings.\nYou can use normal strings or bytestrings (starting with a ‘b’). Warning A bytestring does not carry any information with it about its encoding.\nFor that reason, we have to make an assumption, and Django assumes that all\nbytestrings are in UTF-8. If you pass a string to Django that has been encoded in some other format,\nthings will go wrong in interesting ways. Usually, Django will raise a UnicodeDecodeError at some point. If your code only uses ASCII data, it’s safe to use your normal strings,\npassing them around at will, because ASCII is a subset of UTF-8. Don’t be fooled into thinking that if your DEFAULT_CHARSET setting is set\nto something other than 'utf-8' you can use that other encoding in your\nbytestrings! DEFAULT_CHARSET only applies to the strings generated as\nthe result of template rendering (and email). Django will always assume UTF-8\nencoding for internal bytestrings. The reason for this is that the DEFAULT_CHARSET setting is not actually under your control (if you are the\napplication developer). It’s under the control of the person installing and\nusing your application – and if that person chooses a different setting, your\ncode must still continue to work. Ergo, it cannot rely on that setting. In most cases when Django is dealing with strings, it will convert them to\nstrings before doing anything else. So, as a general rule, if you pass\nin a bytestring, be prepared to receive a string back in the result. Translated strings ¶ Aside from strings and bytestrings, there’s a third type of string-like\nobject you may encounter when using Django. The framework’s\ninternationalization features introduce the concept of a “lazy translation” –\na string that has been marked as translated but whose actual translation result\nisn’t determined until the object is used in a string. This feature is useful\nin cases where the translation locale is unknown until the string is used, even\nthough the string might have originally been created when the code was first\nimported. Normally, you won’t have to worry about lazy translations. Just be aware that\nif you examine an object and it claims to be a django.utils.functional.__proxy__ object, it is a lazy translation.\nCalling str() with the lazy translation as the argument will generate a\nstring in the current locale. For more details about lazy translation objects, refer to the internationalization documentation. Useful utility functions ¶ Because some string operations come up again and again, Django ships with a few\nuseful functions that should make working with string and bytestring objects\na bit easier. Conversion functions ¶ The django.utils.encoding module contains a few functions that are handy\nfor converting back and forth between strings and bytestrings. smart_str(s, encoding='utf-8', strings_only=False, errors='strict') converts its input to a string. The encoding parameter\nspecifies the input encoding. (For example, Django uses this internally\nwhen processing form input data, which might not be UTF-8 encoded.) The strings_only parameter, if set to True, will result in Python\nnumbers, booleans and None not being converted to a string (they keep\ntheir original types). The errors parameter takes any of the values\nthat are accepted by Python’s str() function for its error\nhandling. force_str(s, encoding='utf-8', strings_only=False, errors='strict') is\nidentical to smart_str() in almost all cases. The difference is when the\nfirst argument is a lazy translation instance.\nWhile smart_str() preserves lazy translations, force_str() forces\nthose objects to a string (causing the translation to occur). Normally,\nyou’ll want to use smart_str() . However, force_str() is useful in\ntemplate tags and filters that absolutely must have a string to work with,\nnot just something that can be converted to a string. smart_bytes(s, encoding='utf-8', strings_only=False, errors='strict') is essentially the opposite of smart_str() . It forces the first\nargument to a bytestring. The strings_only parameter has the same\nbehavior as for smart_str() and force_str() . This is\nslightly different semantics from Python’s builtin str() function,\nbut the difference is needed in a few places within Django’s internals. Normally, you’ll only need to use force_str() . Call it as early as\npossible on any input data that might be either a string or a bytestring, and\nfrom then on, you can treat the result as always being a string. URI and IRI handling ¶ Web frameworks have to deal with URLs (which are a type of IRI). One\nrequirement of URLs is that they are encoded using only ASCII characters.\nHowever, in an international environment, you might need to construct a\nURL from an IRI – very loosely speaking, a URI that can contain Unicode characters. Use these functions for quoting and\nconverting an IRI to a URI: The django.utils.encoding.iri_to_uri() function, which implements the\nconversion from IRI to URI as required by RFC 3987 Section 3.1 . The urllib.parse.quote() and urllib.parse.quote_plus() functions from Python’s standard library. These two groups of functions have slightly different purposes, and it’s\nimportant to keep them straight. Normally, you would use quote() on the\nindividual portions of the IRI or URI path so that any reserved characters\nsuch as ‘&’ or ‘%’ are correctly encoded. Then, you apply iri_to_uri() to\nthe full IRI and it converts any non-ASCII characters to the correct encoded\nvalues. Note Technically, it isn’t correct to say that iri_to_uri() implements the\nfull algorithm in the IRI specification. It doesn’t (yet) perform the\ninternational domain name encoding portion of the algorithm. The iri_to_uri() function will not change ASCII characters that are\notherwise permitted in a URL. So, for example, the character ‘%’ is not\nfurther encoded when passed to iri_to_uri() . This means you can pass a\nfull URL to this function and it will not mess up the query string or anything\nlike that. An example might clarify things here: >>> from urllib.parse import quote >>> from django.utils.encoding import iri_to_uri >>> quote ( \"Paris & Orléans\" ) 'Paris%20%26%20Orl%C3%A9ans' >>> iri_to_uri ( \"/favorites/François/ %s \" % quote ( \"Paris & Orléans\" )) '/favorites/Fran%C3%A7ois/Paris%20%26%20Orl%C3%A9ans' If you look carefully, you can see that the portion that was generated by quote() in the second example was not double-quoted when passed to iri_to_uri() . This is a very important and useful feature. It means that\nyou can construct your IRI without worrying about whether it contains\nnon-ASCII characters and then, right at the end, call iri_to_uri() on the\nresult. Similarly, Django provides django.utils.encoding.uri_to_iri() which\nimplements the conversion from URI to IRI as per RFC 3987 Section 3.2 . An example to demonstrate: >>> from django.utils.encoding import uri_to_iri >>> uri_to_iri ( \"/ %E 2 %99% A5 %E 2 %99% A5/?utf8= %E 2%9C%93\" ) '/♥♥/?utf8=✓' >>> uri_to_iri ( \"%A9hello %3F world\" ) '%A9hello%3Fworld' In the first example, the UTF-8 characters are unquoted. In the second, the\npercent-encodings remain unchanged because they lie outside the valid UTF-8\nrange or represent a reserved character. Both iri_to_uri() and uri_to_iri() functions are idempotent, which means the\nfollowing is always true: iri_to_uri ( iri_to_uri ( some_string )) == iri_to_uri ( some_string ) uri_to_iri ( uri_to_iri ( some_string )) == uri_to_iri ( some_string ) So you can safely call it multiple times on the same URI/IRI without risking\ndouble-quoting problems. Models ¶ Because all strings are returned from the database as str objects, model\nfields that are character based (CharField, TextField, URLField, etc.) will\ncontain Unicode values when Django retrieves data from the database. This\nis always the case, even if the data could fit into an ASCII bytestring. You can pass in bytestrings when creating a model or populating a field, and\nDjango will convert it to strings when it needs to. Taking care in get_absolute_url() ¶ URLs can only contain ASCII characters. If you’re constructing a URL from\npieces of data that might be non-ASCII, be careful to encode the results in a\nway that is suitable for a URL. The reverse() function\nhandles this for you automatically. If you’re constructing a URL manually (i.e., not using the reverse() function), you’ll need to take care of the encoding yourself. In this case,\nuse the iri_to_uri() and quote() functions that were documented above . For example: from urllib.parse import quote from django.utils.encoding import iri_to_uri def get_absolute_url ( self ): url = \"/person/ %s /?x=0&y=0\" % quote ( self . location ) return iri_to_uri ( url ) This function returns a correctly encoded URL even if self.location is\nsomething like “Jack visited Paris & Orléans”. (In fact, the iri_to_uri() call isn’t strictly necessary in the above example, because all the\nnon-ASCII characters would have been removed in quoting in the first line.) Templates ¶ Use strings when creating templates manually: from django.template import Template t2 = Template ( \"This is a string template.\" ) But the common case is to read templates from the filesystem. If your template\nfiles are not stored with a UTF-8 encoding, adjust the TEMPLATES setting. The built-in django backend\nprovides the 'file_charset' option to change the encoding used to read\nfiles from disk. The DEFAULT_CHARSET setting controls the encoding of rendered templates.\nThis is set to UTF-8 by default. Template tags and filters ¶ A couple of tips to remember when writing your own template tags and filters: Always return strings from a template tag’s render() method\nand from template filters. Use force_str() in preference to smart_str() in these\nplaces. Tag rendering and filter calls occur as the template is being\nrendered, so there is no advantage to postponing the conversion of lazy\ntranslation objects into strings. It’s easier to work solely with\nstrings at that point. Files ¶ If you intend to allow users to upload files, you must ensure that the\nenvironment used to run Django is configured to work with non-ASCII file names.\nIf your environment isn’t configured correctly, you’ll encounter UnicodeEncodeError exceptions when saving files with file names or content\nthat contains non-ASCII characters. Filesystem support for UTF-8 file names varies and might depend on the\nenvironment. Check your current configuration in an interactive Python shell by\nrunning: import sys sys . getfilesystemencoding () This should output “UTF-8”. The LANG environment variable is responsible for setting the expected\nencoding on Unix platforms. Consult the documentation for your operating system\nand application server for the appropriate syntax and location to set this\nvariable. See the How to use Django with Apache and mod_wsgi for examples. In your development environment, you might need to add a setting to your ~.bashrc analogous to: export LANG = \"en_US.UTF-8\" Form submission ¶ HTML form submission is a tricky area. There’s no guarantee that the\nsubmission will include encoding information, which means the framework might\nhave to guess at the encoding of submitted data. Django adopts a “lazy” approach to decoding form data. The data in an HttpRequest object is only decoded when you access it. In fact, most of\nthe data is not decoded at all. Only the HttpRequest.GET and HttpRequest.POST data structures have any decoding applied to them. Those\ntwo fields will return their members as Unicode data. All other attributes and\nmethods of HttpRequest return data exactly as it was submitted by the\nclient. By default, the DEFAULT_CHARSET setting is used as the assumed encoding\nfor form data. If you need to change this for a particular form, you can set\nthe encoding attribute on an HttpRequest instance. For example: def some_view ( request ): # We know that the data must be encoded as KOI8-R (for some reason). request . encoding = \"koi8-r\" ... You can even change the encoding after having accessed request.GET or request.POST , and all subsequent accesses will use the new encoding. Most developers won’t need to worry about changing form encoding, but this is\na useful feature for applications that talk to legacy systems whose encoding\nyou cannot control. Django does not decode the data of file uploads, because that data is normally\ntreated as collections of bytes, rather than strings. Any automatic decoding\nthere would alter the meaning of the stream of bytes.", "keywords": ["function", "users", "examples", "result", "django.utils.encoding", "feature", "control", "collections", "url", "error", "def", "b", "module", "point", "code", "difference", "features", "values", "algorithm", "bytestring", "default_charset", "platforms", "manual", "apache", "uploads", "library", "string", "behavior", "self.location", "filter", "_", "example", "field", "care", "#", "♥", "unix", "fran%c3%a7ois", "a5", "pieces", "names", "databases", "numbers", "structures", "export", "request", "meaning", "database", "opposite", "smart_str", "input", "errors='strict", "utf-16", "range", "location", "email", "semantics", "models", "query", "subset", "postgresql", "ways", "types", "strings", "paris", "model", "variable", "force_str", "systems", "file_charset", "application", "encoding", "✓", "urlfield", "attributes", "portion", "django", "approach", "accesses", "configuration", "=", "ascii", "rfc", "n’t", "uri_to_iri", "results", "fields", "get_absolute_url", "stream", "set", "development", "fact", "shell", "translation", "operating", "character", "syntax", "/?utf8=", "r", "bytestrings", "e", "a9hello%3fworld", "tag", "section", "filesystem", "legacy", "mod_wsgi", "line", "bit", "developer", "django.utils.encoding.uri_to_iri", "specification", "case", "data", "places", "encodings", "idempotent", "use", "unicodedecodeerror", "backend", "errors", "html", "person", "urllib.parse.quote_plus", "environment", "server", "technically", "str", "submission", "following", "type", "tips", "unicodeencodeerror", "self", "calls", "instance", "django.utils.encoding.iri_to_uri", "objects", "translations", "documentation", "lookups", "uri", "end", "members", "file", "sqlite", "guarantee", "handling", "default", "requirement", "a5/?utf8=", "path", "choices", "cases", "urllib.parse.quote", "unicode", "functions", "operations", "form", "attribute", "none", "option", "portions", "format", "filters", "characters", "specifies", "developers", "latin1", "will", "percent", "get", "a9hello", "tags", "reason", "framework", "render", "setting", "purposes", "lang", "urls", "area", "api", "advantage", "ergo", "support", "decoding", "object", "document", "assumption", "things", "thinking", "quote", "couple", "domain", "preference", "groups", "iri_to_uri", "import", "name", "files", "charfield", "httprequest", "template", "parameter", "iri", "t2", "internals", "sys", "mysql", "rule", "%", "utility", "getfilesystemencoding", "call", "world", "way", "3f", "locale", "backends", "information", "utf-8", "web", "python", "frameworks", "orléans", "paris%20%26%20orl%c3%a9ans", "booleans", "rendering", "problems", "methods", "smart_bytes(s", "times", "client", "concept", "conversion", "details", "some_string", "/?x=0&y=0", "jack", "method", "forces", "/person/", "ships", "argument", "¶", "bytes", "internationalization", "reverse", "applications", "disk", "post", "oracle", "system", "koi8", "françois/", "templates", "textfield", "content", "encoding='utf-8", "exceptions"], "type": "documentation"},
{"title": "Django 1.11 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.11/", "content": "Django 1.11 release notes ¶ April 4, 2017 Welcome to Django 1.11! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 1.10 or older versions. We’ve begun the deprecation process for some features . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Django 1.11 is designated as a long-term support release . It will receive security updates for at least\nthree years after its release. Support for the previous LTS, Django 1.8, will\nend in April 2018. Python compatibility ¶ Django 1.11 requires Python 2.7, 3.4, 3.5, 3.6, or 3.7 (as of 1.11.17). We highly recommend and only officially support the latest release of each\nseries. The Django 1.11.x series is the last to support Python 2. The next major\nrelease, Django 2.0, will only support Python 3.4+. Deprecating warnings are no longer loud by default ¶ Unlike older versions of Django, Django’s own deprecation warnings are no\nlonger displayed by default. This is consistent with Python’s default behavior. This change allows third-party apps to support both Django 1.11 LTS and Django\n1.8 LTS without having to add code to avoid deprecation warnings. Following the release of Django 2.0, we suggest that third-party app authors\ndrop support for all versions of Django prior to 1.11. At that time, you should\nbe able run your package’s tests using python -Wd so that deprecation\nwarnings do appear. After making the deprecation warning fixes, your app should\nbe compatible with Django 2.0. What’s new in Django 1.11 ¶ Class-based model indexes ¶ The new django.db.models.indexes module contains classes which ease\ncreating database indexes. Indexes are added to models using the Meta.indexes option. The Index class creates a b-tree index, as if you\nused db_index on the model field or index_together on the model Meta class. It can be subclassed to support\ndifferent index types, such as GinIndex . It also allows defining the\norder (ASC/DESC) for the columns of the index. Template-based widget rendering ¶ To ease customizing widgets, form widget rendering is now done using the\ntemplate system rather than in Python. See The form rendering API . You may need to adjust any custom widgets that you’ve written for a few backwards incompatible changes . Subquery expressions ¶ The new Subquery and Exists database expressions allow creating\nexplicit subqueries. Subqueries may refer to fields from the outer queryset\nusing the OuterRef class. Minor features ¶ django.contrib.admin ¶ ModelAdmin.date_hierarchy can now reference fields across relations. The new ModelAdmin.get_exclude() hook allows specifying the\nexclude fields based on the request or model instance. The popup_response.html template can now be overridden per app, per\nmodel, or by setting the ModelAdmin.popup_response_template attribute. django.contrib.auth ¶ The default iteration count for the PBKDF2 password hasher is increased by\n20%. The LoginView and LogoutView class-based views supersede the\ndeprecated login() and logout() function-based views. The PasswordChangeView , PasswordChangeDoneView , PasswordResetView , PasswordResetDoneView , PasswordResetConfirmView , and PasswordResetCompleteView class-based\nviews supersede the deprecated password_change() , password_change_done() , password_reset() , password_reset_done() , password_reset_confirm() , and password_reset_complete() function-based\nviews. The new post_reset_login attribute for PasswordResetConfirmView allows\nautomatically logging in a user after a successful password reset.\nIf you have multiple AUTHENTICATION_BACKENDS configured, use the post_reset_login_backend attribute to choose which one to use. To avoid the possibility of leaking a password reset token via the HTTP\nReferer header (for example, if the reset page includes a reference to CSS or\nJavaScript hosted on another domain), the PasswordResetConfirmView (but not the\ndeprecated password_reset_confirm() function-based view) stores the token\nin a session and redirects to itself to present the password change form to\nthe user without the token in the URL. update_session_auth_hash() now rotates the session\nkey to allow a password change to invalidate stolen session cookies. The new success_url_allowed_hosts attribute for LoginView and LogoutView allows specifying a set of\nhosts that are safe for redirecting after login and logout. Added password validators help_text to UserCreationForm . The HttpRequest is now passed to authenticate() which in turn passes it to the authentication backend if it accepts a request argument. The user_login_failed() signal now\nreceives a request argument. PasswordResetForm supports custom user\nmodels that use an email field named something other than 'email' .\nSet CustomUser.EMAIL_FIELD to the name of the field. get_user_model() can now be called at import time,\neven in modules that define models. django.contrib.contenttypes ¶ When stale content types are detected in the remove_stale_contenttypes command, there’s now a list of related\nobjects such as auth.Permission s that will also be deleted. Previously,\nonly the content types were listed (and this prompt was after migrate rather than in a separate command). django.contrib.gis ¶ The new GEOSGeometry.from_gml() and OGRGeometry.from_gml() methods allow creating geometries from GML. Added support for the dwithin lookup on SpatiaLite. The Area function, Distance function, and\ndistance lookups now work with geodetic coordinates on SpatiaLite. The OpenLayers-based form widgets now use OpenLayers.js from https://cdnjs.cloudflare.com which is more suitable for production use\nthan the old https://openlayers.org/ source. They are also updated to use\nOpenLayers 3. PostGIS migrations can now change field dimensions. Added the ability to pass the size , shape , and offset parameters\nwhen creating GDALRaster objects. Added SpatiaLite support for the IsValid function, MakeValid function, and isvalid lookup. Added Oracle support for the AsGML function, BoundingCircle function, IsValid function, and isvalid lookup. django.contrib.postgres ¶ The new distinct argument for StringAgg determines if\nconcatenated values will be distinct. The new GinIndex and BrinIndex classes allow\ncreating GIN and BRIN indexes in the database. django.contrib.postgres.fields.JSONField accepts a new encoder parameter to specify a custom class to encode data types not supported by the\nstandard encoder. The new CIText mixin and CITextExtension migration\noperation allow using PostgreSQL’s citext extension for case-insensitive\nlookups. Three fields are provided: CICharField , CIEmailField , and CITextField . The new JSONBAgg allows\naggregating values as a JSON array. The HStoreField (model field) and HStoreField (form field) allow\nstoring null values. Cache ¶ Memcached backends now pass the contents of OPTIONS as keyword arguments to the client constructors, allowing for more advanced\ncontrol of client behavior. See the cache arguments documentation for examples. Memcached backends now allow defining multiple servers as a comma-delimited\nstring in LOCATION , for convenience with\nthird-party services that use such strings in environment variables. CSRF ¶ Added the CSRF_USE_SESSIONS setting to allow storing the CSRF\ntoken in the user’s session rather than in a cookie. Database backends ¶ Added the skip_locked argument to QuerySet.select_for_update() on PostgreSQL 9.5+ and Oracle to execute queries with FOR UPDATE SKIP LOCKED . Added the TEST['TEMPLATE'] setting to let\nPostgreSQL users specify a template for creating the test database. QuerySet.iterator() now uses server-side cursors on PostgreSQL.\nThis feature transfers some of the worker memory load (used to hold query\nresults) to the database and might increase database memory usage. Added MySQL support for the 'isolation_level' option in OPTIONS to allow specifying the transaction isolation level . To avoid possible data loss, it’s recommended to\nswitch from MySQL’s default level, repeatable read, to read committed. Added support for cx_Oracle 5.3. Email ¶ Added the EMAIL_USE_LOCALTIME setting to allow sending SMTP date\nheaders in the local time zone rather than in UTC. EmailMessage.attach() and attach_file() now fall back to MIME type application/octet-stream when binary content that can’t be\ndecoded as UTF-8 is specified for a text/* attachment. File Storage ¶ To make it wrappable by io.TextIOWrapper , File now has the readable() , writable() ,\nand seekable() methods. Forms ¶ The new empty_value attribute on CharField , EmailField , RegexField , SlugField , and URLField allows\nspecifying the Python value to use to represent “empty”. The new Form.get_initial_for_field() method returns initial data for a\nform field. Internationalization ¶ Number formatting and the NUMBER_GROUPING setting support\nnon-uniform digit grouping. Management Commands ¶ The new loaddata --exclude option allows excluding models and apps\nwhile loading data from fixtures. The new diffsettings --default option allows specifying a settings\nmodule other than Django’s default settings to compare against. app_label s arguments now limit the showmigrations --plan output. Migrations ¶ Added support for serialization of uuid.UUID objects. Models ¶ Added support for callable values in the defaults argument of QuerySet.update_or_create() and get_or_create() . ImageField now has a default validate_image_file_extension validator.\n(This validator moved to the form field in Django 1.11.2 .) Added support for time truncation to Trunc functions. Added the ExtractWeek function to\nextract the week from DateField and DateTimeField and exposed it through the week lookup. Added the TruncTime function to truncate DateTimeField to its time component and exposed it\nthrough the time lookup. Added support for expressions in QuerySet.values() and values_list() . Added support for query expressions on lookups that take multiple arguments,\nsuch as range . You can now use the unique=True option with FileField . Added the nulls_first and nulls_last parameters to Expression.asc() and desc() to control\nthe ordering of null values. The new F expression bitleftshift() and bitrightshift() methods\nallow bitwise shift operations . Added QuerySet.union() , intersection() , and difference() . Requests and Responses ¶ Added QueryDict.fromkeys() . CommonMiddleware now sets the Content-Length response header for non-streaming responses. Added the SECURE_HSTS_PRELOAD setting to allow appending the preload directive to the Strict-Transport-Security header. ConditionalGetMiddleware now adds the ETag header to responses. Serialization ¶ The new django.core.serializers.base.Serializer.stream_class attribute\nallows subclasses to customize the default stream. The encoder used by the JSON serializer can now be customized by passing a cls keyword argument to the serializers.serialize() function. DjangoJSONEncoder now serializes timedelta objects (used by DurationField ). Templates ¶ mark_safe() can now be used as a decorator. The Jinja2 template backend now\nsupports context processors by setting the 'context_processors' option in OPTIONS . The regroup tag now returns namedtuple s instead of dictionaries\nso you can unpack the group object directly in a loop, e.g. {% for grouper, list in regrouped %} . Added a resetcycle template tag to allow resetting the sequence of\nthe cycle template tag. You can now specify specific directories for a particular filesystem.Loader . Tests ¶ Added DiscoverRunner.get_test_runner_kwargs() to allow customizing the\nkeyword arguments passed to the test runner. Added the test --debug-mode option to help troubleshoot test\nfailures by setting the DEBUG setting to True . The new django.test.utils.setup_databases() (moved from django.test.runner ) and teardown_databases() functions make it easier to build custom test runners. Added support for unittest.TestCase.subTest() ’s when using the test --parallel option. DiscoverRunner now runs the system checks at the start of a test run.\nOverride the DiscoverRunner.run_checks() method if you want to disable\nthat. Validators ¶ Added FileExtensionValidator to validate\nfile extensions and validate_image_file_extension to validate\nimage files. Backwards incompatible changes in 1.11 ¶ django.contrib.gis ¶ To simplify the codebase and because it’s easier to install than when contrib.gis was first released, GDAL is now a required\ndependency for GeoDjango. In older versions, it’s only required for SQLite. contrib.gis.maps is removed as it interfaces with a retired version of\nthe Google Maps API and seems to be unmaintained. If you’re using it, let us know . The GEOSGeometry equality operator now also compares SRID. The OpenLayers-based form widgets now use OpenLayers 3, and the gis/openlayers.html and gis/openlayers-osm.html templates have been\nupdated. Check your project if you subclass these widgets or extend the\ntemplates. Also, the new widgets work a bit differently than the old ones.\nInstead of using a toolbar in the widget, you click to draw, click and drag\nto move the map, and click and drag a point/vertex/corner to move it. Support for SpatiaLite < 4.0 is dropped. Support for GDAL 1.7 and 1.8 is dropped. The widgets in contrib.gis.forms.widgets and the admin’s OpenLayersWidget use the form rendering API rather than loader.render_to_string() . If you’re using a custom widget\ntemplate, you’ll need to be sure your form renderer can locate it. For\nexample, you could use the TemplatesSetting renderer. django.contrib.staticfiles ¶ collectstatic may now fail during post-processing when using a hashed\nstatic files storage if a reference loop exists (e.g. 'foo.css' references 'bar.css' which itself references 'foo.css' ) or if the\nchain of files referencing other files is too deep to resolve in several\npasses. In the latter case, increase the number of passes using ManifestStaticFilesStorage.max_post_process_passes . When using ManifestStaticFilesStorage , static files not found in the\nmanifest at runtime now raise a ValueError instead of returning an\nunchanged path. You can revert to the old behavior by setting ManifestStaticFilesStorage.manifest_strict to False . Database backend API ¶ This section describes changes that may be needed in third-party database\nbackends. The DatabaseOperations.time_trunc_sql() method is added to support TimeField truncation. It accepts a lookup_type and field_name arguments and returns the appropriate SQL to truncate the given time field field_name to a time object with only the given specificity. The lookup_type argument can be either 'hour' , 'minute' , or 'second' . The DatabaseOperations.datetime_cast_time_sql() method is added to\nsupport the time lookup. It accepts a field_name and tzname arguments and returns the SQL necessary to cast a datetime value to time value. To enable FOR UPDATE SKIP LOCKED support, set DatabaseFeatures.has_select_for_update_skip_locked = True . The new DatabaseFeatures.supports_index_column_ordering attribute\nspecifies if a database allows defining ordering for columns in indexes. The\ndefault value is True and the DatabaseIntrospection.get_constraints() method should include an 'orders' key in each of the returned\ndictionaries with a list of 'ASC' and/or 'DESC' values corresponding\nto the ordering of each column in the index. inspectdb no longer calls DatabaseIntrospection.get_indexes() which is deprecated. Custom database backends should ensure all types of\nindexes are returned by DatabaseIntrospection.get_constraints() . Renamed the ignores_quoted_identifier_case feature to ignores_table_name_case to more accurately reflect how it is used. The name keyword argument is added to the DatabaseWrapper.create_cursor(self, name=None) method to allow usage of\nserver-side cursors on backends that support it. Dropped support for PostgreSQL 9.2 and PostGIS 2.0 ¶ Upstream support for PostgreSQL 9.2 ends in September 2017. As a consequence,\nDjango 1.11 sets PostgreSQL 9.3 as the minimum version it officially supports. Support for PostGIS 2.0 is also removed as PostgreSQL 9.2 is the last version\nto support it. Also, the minimum supported version of psycopg2 is increased from 2.4.5 to\n2.5.4. LiveServerTestCase binds to port zero ¶ Rather than taking a port range and iterating to find a free port, LiveServerTestCase binds to port zero and relies on the operating system\nto assign a free port. The DJANGO_LIVE_TEST_SERVER_ADDRESS environment\nvariable is no longer used, and as it’s also no longer used, the manage.py test --liveserver option is removed. If you need to bind LiveServerTestCase to a specific port, use the port attribute added in Django 1.11.2. Protection against insecure redirects in django.contrib.auth and i18n views ¶ LoginView , LogoutView (and the deprecated function-based equivalents),\nand set_language() protect users from being redirected\nto non-HTTPS next URLs when the app is running over HTTPS. QuerySet.get_or_create() and update_or_create() validate arguments ¶ To prevent typos from passing silently, get_or_create() and update_or_create() check that their\narguments are model fields. This should be backwards-incompatible only in the\nfact that it might expose a bug in your project. pytz is a required dependency and support for settings.TIME_ZONE = None is removed ¶ To simplify Django’s timezone handling, pytz is now a required dependency.\nIt’s automatically installed along with Django. Support for settings.TIME_ZONE = None is removed as the behavior isn’t\ncommonly used and is questionably useful. If you want to automatically detect\nthe timezone based on the system timezone, you can use tzlocal : from tzlocal import get_localzone TIME_ZONE = get_localzone () . zone This works similar to settings.TIME_ZONE = None except that it also sets os.environ['TZ'] . Let us know if there’s a use case where you find you can’t adapt your code to set a TIME_ZONE . HTML changes in admin templates ¶ <p class=\"help\"> is replaced with a <div> tag to allow including lists\ninside help text. Read-only fields are wrapped in <div class=\"readonly\">...</div> instead of <p>...</p> to allow any kind of HTML as the field’s content. Changes due to the introduction of template-based widget rendering ¶ Some undocumented classes in django.forms.widgets are removed: SubWidget RendererMixin , ChoiceFieldRenderer , RadioFieldRenderer , CheckboxFieldRenderer ChoiceInput , RadioChoiceInput , CheckboxChoiceInput The undocumented Select.render_option() method is removed. The Widget.format_output() method is removed. Use a custom widget template\ninstead. Some widget values, such as <select> options, are now localized if settings.USE_L10N=True . You could revert to the old behavior with custom\nwidget templates that uses the localize template tag to turn off\nlocalization. django.template.backends.django.Template.render() prohibits non-dict context ¶ For compatibility with multiple template engines, django.template.backends.django.Template.render() (returned from high-level\ntemplate loader APIs such as loader.get_template() ) must receive a\ndictionary of context rather than Context or RequestContext . If you\nwere passing either of the two classes, pass a dictionary instead – doing so\nis backwards-compatible with older versions of Django. Model state changes in migration operations ¶ To improve the speed of applying migrations, rendering of related models is\ndelayed until an operation that needs them (e.g. RunPython ). If you have a\ncustom operation that works with model classes or model instances from the from_state argument in database_forwards() or database_backwards() ,\nyou must render model states using the clear_delayed_apps_cache() method as\ndescribed in writing your own migration operation . Server-side cursors on PostgreSQL ¶ The change to make QuerySet.iterator() use server-side cursors on\nPostgreSQL prevents running Django with PgBouncer in transaction pooling mode.\nTo reallow that, use the DISABLE_SERVER_SIDE_CURSORS setting (added in Django 1.11.1) in DATABASES . See Transaction pooling and server-side cursors for more discussion. Miscellaneous ¶ If no items in the feed have a pubdate or updateddate attribute, SyndicationFeed.latest_post_date() now returns\nthe current UTC date/time, instead of a datetime without any timezone\ninformation. CSRF failures are logged to the django.security.csrf logger instead of django.request . ALLOWED_HOSTS validation is no longer disabled when running tests.\nIf your application includes tests with custom host names, you must include\nthose host names in ALLOWED_HOSTS . See Tests and multiple host names . Using a foreign key’s id (e.g. 'field_id' ) in ModelAdmin.list_display displays the related object’s ID. Remove the _id suffix if you want the\nold behavior of the string representation of the object. In model forms, CharField with null=True now\nsaves NULL for blank values instead of empty strings. On Oracle, Model.validate_unique() no longer checks empty strings for\nuniqueness as the database interprets the value as NULL . If you subclass AbstractUser and override clean() , be sure it\ncalls super() . BaseUserManager.normalize_email() is called in a\nnew AbstractUser.clean() method so that normalization is applied in\ncases like model form validation. EmailField and URLField no longer accept the strip keyword\nargument. Remove it because it doesn’t have an effect in older versions of\nDjango as these fields always strip whitespace. The checked and selected attribute rendered by form widgets now uses\nHTML5 boolean syntax rather than XHTML’s checked='checked' and selected='selected' . RelatedManager.add() , remove() , clear() , and set() now\nclear the prefetch_related() cache. To prevent possible loss of saved settings, setup_test_environment() now raises an exception if\ncalled a second time before calling teardown_test_environment() . The undocumented DateTimeAwareJSONEncoder alias for DjangoJSONEncoder (renamed in Django\n1.0) is removed. The cached template loader is now enabled if OPTIONS['loaders'] isn’t\nspecified and OPTIONS['debug'] is False (the latter option defaults to the value of DEBUG ). This could\nbe backwards-incompatible if you have some template tags that aren’t\nthread safe . The prompt for stale content type deletion no longer occurs after running the migrate command. Use the new remove_stale_contenttypes command\ninstead. The admin’s widget for IntegerField uses type=\"number\" rather than type=\"text\" . Conditional HTTP headers are now parsed and compared according to the RFC 7232 Conditional Requests specification rather than the older RFC 2616 . patch_response_headers() no longer adds a Last-Modified header. According to the RFC 7234 Section 4.2.2 , this\nheader is useless alongside other caching headers that provide an explicit\nexpiration time, e.g. Expires or Cache-Control . UpdateCacheMiddleware and add_never_cache_headers() call patch_response_headers() and therefore are also affected by this change. In the admin templates, <p class=\"help\"> is replaced with a <div> tag\nto allow including lists inside help text. ConditionalGetMiddleware no longer sets the Date header as web servers set that header. It also no longer sets the Content-Length header as this is now done by CommonMiddleware . If you have a middleware that modifies a response’s content and appears\nbefore CommonMiddleware in the MIDDLEWARE or MIDDLEWARE_CLASSES settings, you must reorder your middleware so that responses aren’t modified\nafter Content-Length is set, or have the response modifying middleware\nreset the Content-Length header. get_model() and get_models() now raise AppRegistryNotReady if they’re called before\nmodels of all applications have been loaded. Previously they only required\nthe target application’s models to be loaded and thus could return models\nwithout all their relations set up. If you need the old behavior of get_model() , set the require_ready argument to False . The unused BaseCommand.can_import_settings attribute is removed. The undocumented django.utils.functional.lazy_property is removed. For consistency with non-multipart requests, MultiPartParser.parse() now\nleaves request.POST immutable. If you’re modifying that QueryDict ,\nyou must now first copy it, e.g. request.POST.copy() . Support for cx_Oracle < 5.2 is removed. Support for IPython < 1.0 is removed from the shell command. The signature of private API Widget.build_attrs() changed from extra_attrs=None, **kwargs to base_attrs, extra_attrs=None . File-like objects (e.g., StringIO and BytesIO )\nuploaded to an ImageField using the test client\nnow require a name attribute with a value that passes the validate_image_file_extension validator.\nSee the note in Client.post() . FileField now moves rather than copies the file\nit receives. With the default file upload settings, files larger than FILE_UPLOAD_MAX_MEMORY_SIZE now have the same permissions as\ntemporary files (often 0o600 ) rather than the system’s standard umask\n(often 0o6644 ). Set the FILE_UPLOAD_PERMISSIONS if you need\nthe same permission regardless of file size. Features deprecated in 1.11 ¶ models.permalink() decorator ¶ Use django.urls.reverse() instead. For example: from django.db import models class MyModel ( models . Model ): ... @models . permalink def url ( self ): return ( \"guitarist_detail\" , [ self . slug ]) becomes: from django.db import models from django.urls import reverse class MyModel ( models . Model ): ... def url ( self ): return reverse ( \"guitarist_detail\" , args = [ self . slug ]) Miscellaneous ¶ contrib.auth ’s login() and logout() function-based views are\ndeprecated in favor of new class-based views LoginView and LogoutView . The unused extra_context parameter of contrib.auth.views.logout_then_login() is deprecated. contrib.auth ’s password_change() , password_change_done() , password_reset() , password_reset_done() , password_reset_confirm() ,\nand password_reset_complete() function-based views are deprecated in favor\nof new class-based views PasswordChangeView , PasswordChangeDoneView , PasswordResetView , PasswordResetDoneView , PasswordResetConfirmView , and PasswordResetCompleteView . django.test.runner.setup_databases() is moved to django.test.utils.setup_databases() . The old location is deprecated. django.utils.translation.string_concat() is deprecated in\nfavor of django.utils.text.format_lazy() . string_concat(*strings) can be replaced by format_lazy('{}' * len(strings), *strings) . For the PyLibMCCache cache backend, passing pylibmc behavior settings\nas top-level attributes of OPTIONS is deprecated. Set them under a behaviors key within OPTIONS instead. The host parameter of django.utils.http.is_safe_url() is deprecated\nin favor of the new allowed_hosts parameter. Silencing exceptions raised while rendering the {% include %} template tag is deprecated as the behavior is\noften more confusing than helpful. In Django 2.1, the exception will be\nraised. DatabaseIntrospection.get_indexes() is deprecated in favor of DatabaseIntrospection.get_constraints() . authenticate() now passes a request argument\nto the authenticate() method of authentication backends. Support for\nmethods that don’t accept request as the first positional argument will\nbe removed in Django 2.1. The USE_ETAGS setting is deprecated in favor of ConditionalGetMiddleware which now adds the ETag header to responses regardless of the setting. CommonMiddleware and django.utils.cache.patch_response_headers() will no longer set ETags\nwhen the deprecation ends. Model._meta.has_auto_field is deprecated in favor of checking if Model._meta.auto_field is not None . Using regular expression groups with iLmsu# in url() is deprecated.\nThe only group that’s useful is (?i) for case-insensitive URLs, however,\ncase-insensitive URLs aren’t a good practice because they create multiple\nentries for search engines, for example. An alternative solution could be to\ncreate a handler404 that looks for uppercase\ncharacters in the URL and redirects to a lowercase equivalent. The renderer argument is added to the Widget.render() method. Methods that don’t accept that argument\nwill work through a deprecation period.", "keywords": ["citext", "users", "base_attrs", "feed", "feature", "gml", "integerfield", "storage", "datetimeawarejsonencoder", "login", "textiowrapper", "django_live_test_server_address", "emailfield", "b", "logoutview", "field", "dimensions", "outerref", "#", "runner", "serialization", "migrations", "passwordchangeview", "octet", "+", "asgml", "loop", "lts", "host", "representation", "extractweek", "range", "cache", "compatibility", "datefield", "abstractuser", "get_model", "models.permalink", "transport", "manifeststaticfilesstorage.max_post_process_passes", "type=\"text", "success_url_allowed_hosts", "change", "django.urls", "https", "modeladmin.date_hierarchy", "xhtml", "1.11.17", "constructors", "hook", "truncation", "http", "changes", "=", "contrib.gis.maps", "results", "stream", "subquery", "fact", "manifeststaticfilesstorage", "password_change", "select.render_option", "tag", "filesystem", "--debug", "patch_response_headers", "foo.css", "openlayers", "bar.css", "authentication_backends", "process", "debug", "memcached", "django.test.runner.setup_databases", "uniqueness", "serializer.stream_class", "type", "processing", "citextextension", "filefield", "custom", "kwargs", "objects", "documentation", "lookups", "checkboxfieldrenderer", "discoverrunner", "file", "gin", "choiceinput", "gdalraster", "modules", "user", "validate_image_file_extension", "processors", "cases", "handler404", "attribute", "states", "args", "django.contrib.gis", "warning", "size", "form.get_initial_for_field", "queryset.update_or_create", "time", "tags", "expiration", "date", "setting", "responses", "database_forwards", "app_label", "hour", "set_language", "customuser", "password", "citextfield", "passwordresetform", "name", "options['debug", "parameter", "bitleftshift", "backends", "reference", "codebase", "web", "django.contrib.auth", "copies", "versions", "widget.format_output", "djangojsonencoder", "queries", "queryset.union", "django.contrib.admin", "geosgeometry.from_gml", "behaviors", "return", "reverse", "deletion", "operator", "applications", "memory", "expressions", "cursors", "isolation", "search", "openlayers.html", "type=\"number", "srid", "datetimefield", "mymodel", "jsonbagg", "examples", "django.contrib.staticfiles", "commonmiddleware", "databaseoperations.datetime_cast_time_sql", "smtp", "pylibmccache", "django.core.serializers.base", "tree", "url", "collectstatic", "model.validate_unique", "module", "emailmessage.attach", "code", "radiofieldrenderer", "period", "auth", "asc", "localize", "false", "behavior", "array", "grouping", "class", "migration", "fileextensionvalidator", "update_or_create", "i", "exists", "group", "warnings", "widget", "customizing", "namedtuple", "add_never_cache_headers", "names", "javascript", "desc", "contrib.auth.views.logout_then_login", "pbkdf2", "years", "request", "formatting", "database", "output", "signal", "*", "query", "page", "hosts", "test", "postgresql", "commands", "count", "logout", "types", "migrate", "transfers", "strings", "empty_value", "databaseintrospection.get_indexes", "post_reset_login", "admin", "typos", "etag", ".", "class=\"help", "mixin", "usage", "querydict", "subwidget", "setup_test_environment", "added", "thread", "makevalid", "discoverrunner.get_test_runner_kwargs", "validation", "section", "validator", "suffix", "source", "discussion", "specification", "component", "sequence", "css", "use", "ginindex", "environment", "engines", "solution", "subclasses", "protection", "extensions", "index_together", "operation", "order", "signature", "default", "shape", "loader", "email_use_localtime", "alias", "bug", "form", "troubleshoot", "modeladmin.list_display", "option", "classes", "tests", "comma", "expression", "help", "etags", "characters", "equality", "digit", "equivalents", "bitrightshift", "worker", "ipython", "timezone", "psycopg2", "area", "convenience", "f", "get_models", "contrib.auth", "chain", "django.utils.cache.patch_response_headers", "corner", "template", "week", "modeladmin.popup_response_template", "databasefeatures.has_select_for_update_skip_locked", "header", "csrf_use_sessions", "cx_oracle", "utf-8", "gdal", "checks", "servers", "strict", "uppercase", "get_or_create", "meta.indexes", "index", "possibility", "party", "runners", "queryset", "september", "session", "querydict.fromkeys", "¶", "command", "id", "internationalization", "parameters", "post", "services", "encoder", "side", "miscellaneous", "queryset.iterator", "content", "remove_stale_contenttypes", "boundingcircle", "toolbar", "function", "ends", "views", "model._meta.auto_field", "view", "uuid", "openlayers.js", "django.db.models.indexes", "control", "zone", "run", "indexes", "number", "loader.render_to_string", "maps", "jsonfield", "relations", "permissions", "passwordchangedoneview", "point", "values", "failures", "directories", "string", "preload", "cls", "<", "token", "passes", "favor", "databases", "jinja2", "user_login_failed", "mime", "pgbouncer", "exclude", "location", "models", "version", "level", "json", "umask", "manifest", "contents", "appregistrynotready", "queryset.values", "gis", "clear_delayed_apps_cache", "image", "attachment", "deprecation", "extra_attrs", "minimum", "django", "series", "loader.get_template", "regexfield", "rfc", "n’t", "div", "fields", "fixes", "set", "lowercase", "context_processors", "p", "operating", "practice", "password_reset_complete", "value", "django.test.utils.setup_databases", "password_reset", "bit", "specificity", "columns", "data", "cicharfield", "april", "orders", "datetime", "strip", "relatedmanager.add", "backend", "guide", "database_backwards", "subqueries", "expires", "trunctime", "client.post", "file_upload_permissions", "security", "db_index", "updates", "self", "instance", "diffsettings", "localization", "speed", "geometries", "trunc", "extension", "handling", "consequence", "nulls_first", "validators", "options['loaders", "start", "timedelta", "decorator", "p>", "field_id", "basecommand.can_import_settings", "allowed_hosts", "...", "instances", "django.urls.reverse", "conditional", "get_localzone", "fixtures", "dependency", "references", "object", "load", "teardown_databases", "binds", "domain", "valueerror", "authenticate", "groups", "stringagg", "httprequest", "charfield", "management", "response", "sql", "dictionary", "whitespace", "requests", "authors", "reset", "django.utils.translation.string_concat", "django.utils.http.is_safe_url", "rendering", "keyword", "model._meta.has_auto_field", "minute", "io", "csrf", "ordering", "logger", "variables", "queryset.select_for_update", "django.forms.widgets", "databasewrapper.create_cursor(self", "notes", "turn", "runpython", "intersection", "ignores_quoted_identifier_case", "renderermixin", "effect", "django.contrib.contenttypes", "system", "apps", "port", "widget.render", "1.11.x", "spatialite", "grouper", "values_list", "contrib.gis.forms.widgets", "modeladmin.get_exclude", "items", "imagefield", "loaddata", "update_session_auth_hash", "production", "passwordresetview", "widgets", "serializer", "headers", "ilmsu", "target", "difference", "passwordresetcompleteview", "html5", "features", "forms", "’s", "consistency", "skip", "referer", "lists", "example", "resetcycle", "app", "geosgeometry", "i18n", "column", "pytz", "list", "brinindex", "loss", "utc", "stringio", "locked", "upstream", "passwordresetconfirmview", "hasher", "ogrgeometry.from_gml", "email", "google", "map", "read", "determines", "model", "variable", "use_etags", "password_reset_confirm", "apis", "application", "test['template", "dictionaries", "get_user_model", "urlfield", "attributes", "slugfield", "release", "ability", "insecure", "expression.asc", "redirects", "len(strings", "isvalid", "timefield", "syntax", "conditionalgetmiddleware", "number_grouping", "ones", "coordinates", "case", "discoverrunner.run_checks", "equivalent", "length", "authentication", "lookup", "django.template.backends.django.template.render", "null", "isolation_level", "runtime", "brin", "html", "clean", "showmigrations", "server", "databaseintrospection.get_constraints", "arguments", "normalization", "introduction", "upload", "package", "middleware", "manifeststaticfilesstorage.manifest_strict", "one", "directive", "disable_server_side_cursors", "widget.build_attrs", "entries", "sqlite", "loginview", "kind", "path", "abstractuser.clean", "functions", "key", "term", "operations", "renderer", "update", "bitwise", "inspectdb", "none", "specifies", "meta", "password_reset_done", "durationfield", "prompt", "secure_hsts_preload", "true", "urls", "hstorefield", "api", "support", "cookies", "django.utils.functional.lazy_property", "mode", "os.environ['tz", "field_name", "0o6644", "context", "cycle", "permission", "baseusermanager.normalize_email", "import", "files", "d", "iteration", "mysql", "%", "defaults", "require_ready", "information", "python", "updatecachemiddleware", "django.test.runner", "requestcontext", "methods", "attach_file", "options", "regroup", "exception", "client", "shift", "method", "geodjango", "django.db", "settings", "transaction", "argument", "cookie", "vertex", "note", "state", "oracle", "ciemailfield", "mark_safe", "distance", "syndicationfeed.latest_post_date", "templates", "templatessetting", "text", "project", "exceptions"], "type": "documentation"},
{"title": "Django 5.0 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/5.0/", "content": "Django 5.0 release notes ¶ December 4, 2023 Welcome to Django 5.0! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 4.2 or earlier. We’ve begun the deprecation process for some features . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Python compatibility ¶ Django 5.0 supports Python 3.10, 3.11, and 3.12. We highly recommend and\nonly officially support the latest release of each series. The Django 4.2.x series is the last to support Python 3.8 and 3.9. Third-party library support for older version of Django ¶ Following the release of Django 5.0, we suggest that third-party app authors\ndrop support for all versions of Django prior to 4.2. At that time, you should\nbe able to run your package’s tests using python -Wd so that deprecation\nwarnings appear. After making the deprecation warning fixes, your app should be\ncompatible with Django 5.0. What’s new in Django 5.0 ¶ Facet filters in the admin ¶ Facet counts are now shown for applied filters in the admin changelist when\ntoggled on via the UI. This behavior can be changed via the new ModelAdmin.show_facets attribute. For more information see Facets . Simplified templates for form field rendering ¶ Django 5.0 introduces the concept of a field group, and field group templates.\nThis simplifies rendering of the related elements of a Django form field such\nas its label, widget, help text, and errors. For example, the template below: < form > ... < div > {{ form.name.label_tag }} {% if form.name.help_text %} < div class = \"helptext\" id = \" {{ form.name.auto_id }} _helptext\" > {{ form.name.help_text | safe }} </ div > {% endif %} {{ form.name.errors }} {{ form.name }} < div class = \"row\" > < div class = \"col\" > {{ form.email.label_tag }} {% if form.email.help_text %} < div class = \"helptext\" id = \" {{ form.email.auto_id }} _helptext\" > {{ form.email.help_text | safe }} </ div > {% endif %} {{ form.email.errors }} {{ form.email }} </ div > < div class = \"col\" > {{ form.password.label_tag }} {% if form.password.help_text %} < div class = \"helptext\" id = \" {{ form.password.auto_id }} _helptext\" > {{ form.password.help_text | safe }} </ div > {% endif %} {{ form.password.errors }} {{ form.password }} </ div > </ div > </ div > ... </ form > Can now be simplified to: < form > ... < div > {{ form.name.as_field_group }} < div class = \"row\" > < div class = \"col\" > {{ form.email.as_field_group }} </ div > < div class = \"col\" > {{ form.password.as_field_group }} </ div > </ div > </ div > ... </ form > as_field_group() renders fields with the \"django/forms/field.html\" template by default and can be customized on a\nper-project, per-field, or per-request basis. See Reusable field group templates . Database-computed default values ¶ The new Field.db_default parameter\nsets a database-computed default value. For example: from django.db import models from django.db.models.functions import Now , Pi class MyModel ( models . Model ): age = models . IntegerField ( db_default = 18 ) created = models . DateTimeField ( db_default = Now ()) circumference = models . FloatField ( db_default = 2 * Pi ()) Database generated model field ¶ The new GeneratedField allows creation of database\ngenerated columns. This field can be used on all supported database backends\nto create a field that is always computed from other fields. For example: from django.db import models from django.db.models import F class Square ( models . Model ): side = models . IntegerField () area = models . GeneratedField ( expression = F ( \"side\" ) * F ( \"side\" ), output_field = models . BigIntegerField (), db_persist = True , ) More options for declaring field choices ¶ Field.choices (for model fields) and ChoiceField.choices (for form fields) allow for more flexibility when declaring their values. In\nprevious versions of Django, choices should either be a list of 2-tuples,\nor an Enumeration types subclass, but the latter required\naccessing the .choices attribute to provide the values in the expected\nform: from django.db import models Medal = models . TextChoices ( \"Medal\" , \"GOLD SILVER BRONZE\" ) SPORT_CHOICES = [ ( \"Martial Arts\" , [( \"judo\" , \"Judo\" ), ( \"karate\" , \"Karate\" )]), ( \"Racket\" , [( \"badminton\" , \"Badminton\" ), ( \"tennis\" , \"Tennis\" )]), ( \"unknown\" , \"Unknown\" ), ] class Winner ( models . Model ): name = models . CharField ( ... ) medal = models . CharField ( ... , choices = Medal . choices ) sport = models . CharField ( ... , choices = SPORT_CHOICES ) Django 5.0 adds support for accepting a mapping or a callable instead of an\niterable, and also no longer requires .choices to be used directly to\nexpand enumeration types : from django.db import models Medal = models . TextChoices ( \"Medal\" , \"GOLD SILVER BRONZE\" ) SPORT_CHOICES = { # Using a mapping instead of a list of 2-tuples. \"Martial Arts\" : { \"judo\" : \"Judo\" , \"karate\" : \"Karate\" }, \"Racket\" : { \"badminton\" : \"Badminton\" , \"tennis\" : \"Tennis\" }, \"unknown\" : \"Unknown\" , } def get_scores (): return [( i , str ( i )) for i in range ( 10 )] class Winner ( models . Model ): name = models . CharField ( ... ) medal = models . CharField ( ... , choices = Medal ) # Using `.choices` not required. sport = models . CharField ( ... , choices = SPORT_CHOICES ) score = models . IntegerField ( choices = get_scores ) # A callable is allowed. Under the hood the provided choices are normalized into a list of 2-tuples\nas the canonical form whenever the choices value is updated. For more\ninformation, please check the model field reference on choices . Minor features ¶ django.contrib.admin ¶ The new AdminSite.get_log_entries() method allows customizing the\nqueryset for the site’s listed log entries. The django.contrib.admin.AllValuesFieldListFilter , ChoicesFieldListFilter , RelatedFieldListFilter , and RelatedOnlyFieldListFilter admin filters now handle multi-valued query\nparameters. XRegExp is upgraded from version 3.2.0 to 5.1.1. The new AdminSite.get_model_admin() method returns an admin class for\nthe given model class. Properties in ModelAdmin.list_display now support boolean attribute. jQuery is upgraded from version 3.6.4 to 3.7.1. django.contrib.auth ¶ The default iteration count for the PBKDF2 password hasher is increased from\n600,000 to 720,000. The new asynchronous functions are now provided, using an a prefix: django.contrib.auth.aauthenticate() , aget_user() , alogin() , alogout() ,\nand aupdate_session_auth_hash() . AuthenticationMiddleware now adds an HttpRequest.auser() asynchronous method that returns the currently logged-in user. The new django.contrib.auth.hashers.acheck_password() asynchronous\nfunction and AbstractBaseUser.acheck_password() method allow\nasynchronous checking of user passwords. django.contrib.contenttypes ¶ QuerySet.prefetch_related() now supports prefetching GenericForeignKey with\nnon-homogeneous set of results. django.contrib.gis ¶ The new ClosestPoint() function returns a 2-dimensional point on the geometry that is closest to\nanother geometry. GIS aggregates now support the filter argument. Support for GDAL 3.7 and GEOS 3.12 is added. The new GEOSGeometry.equals_identical() method allows point-wise\nequivalence checking of geometries. django.contrib.messages ¶ The new MessagesTestMixin.assertMessages() assertion method allows\ntesting messages added to a response . django.contrib.postgres ¶ The new violation_error_code attribute of ExclusionConstraint allows\ncustomizing the code of ValidationError raised during model validation . Asynchronous views ¶ Under ASGI, http.disconnect events are now handled. This allows views to\nperform any necessary cleanup if a client disconnects before the response is\ngenerated. See Handling disconnects for more details. Decorators ¶ The following decorators now support wrapping asynchronous view functions: cache_control() never_cache() no_append_slash() csrf_exempt() csrf_protect() ensure_csrf_cookie() requires_csrf_token() sensitive_variables() sensitive_post_parameters() gzip_page() condition() conditional_page() etag() last_modified() require_http_methods() require_GET() require_POST() require_safe() vary_on_cookie() vary_on_headers() xframe_options_deny() xframe_options_sameorigin() xframe_options_exempt() Error Reporting ¶ sensitive_variables() and sensitive_post_parameters() can now be\nused with asynchronous functions. File Storage ¶ File.open() now passes all positional ( *args ) and keyword\narguments ( **kwargs ) to Python’s built-in open() . Forms ¶ The new assume_scheme argument for URLField allows specifying a default URL scheme. In order to improve accessibility, the following changes are made: Form fields now include the aria-describedby HTML attribute to enable\nscreen readers to associate form fields with their help text. Invalid form fields now include the aria-invalid=\"true\" HTML attribute. Internationalization ¶ Support and translations for the Uyghur language are now available. Migrations ¶ Serialization of functions decorated with functools.cache() or functools.lru_cache() is now supported without the need to write a\ncustom serializer. Models ¶ The new create_defaults argument of QuerySet.update_or_create() and QuerySet.aupdate_or_create() methods allows specifying a different\nfield values for the create operation. The new violation_error_code attribute of BaseConstraint , CheckConstraint , and UniqueConstraint allows customizing the code of ValidationError raised during model validation . The force_insert argument of Model.save() now allows specifying a tuple of parent classes that must\nbe forced to be inserted. QuerySet.bulk_create() and QuerySet.abulk_create() methods now\nset the primary key on each model instance when the update_conflicts parameter is enabled (if the database supports it). The new UniqueConstraint.nulls_distinct attribute allows customizing\nthe treatment of NULL values on PostgreSQL 15+. The new aget_object_or_404() and aget_list_or_404() asynchronous shortcuts allow\nasynchronous getting objects. The new aprefetch_related_objects() function allows\nasynchronous prefetching of model instances. QuerySet.aiterator() now supports previous calls to prefetch_related() . On MariaDB 10.7+, UUIDField is now created as UUID column rather than CHAR(32) column. See the migration guide above for more details on Migrating existing UUIDField on MariaDB 10.7+ . Django now supports oracledb version 1.3.2 or higher. Support for cx_Oracle is deprecated as of this release and will be removed in Django\n6.0. Pagination ¶ The new django.core.paginator.Paginator.error_messages argument\nallows customizing the error messages raised by Paginator.page() . Signals ¶ The new Signal.asend() and Signal.asend_robust() methods allow\nasynchronous signal dispatch. Signal receivers may be synchronous or\nasynchronous, and will be automatically adapted to the correct calling style. Templates ¶ The new escapeseq template filter applies escape to\neach element of a sequence. Tests ¶ Client and AsyncClient now\nprovide asynchronous methods, using an a prefix: asession() , alogin() , aforce_login() , and alogout() . AsyncClient now supports the follow parameter. DiscoverRunner now allows showing the duration\nof the slowest tests using the test --durations option (available\non Python 3.12+). Validators ¶ The new offset argument of StepValueValidator allows specifying an\noffset for valid values. Backwards incompatible changes in 5.0 ¶ Database backend API ¶ This section describes changes that may be needed in third-party database\nbackends. DatabaseFeatures.supports_expression_defaults should be set to False if the database doesn’t support using database functions as defaults. DatabaseFeatures.supports_default_keyword_in_insert should be set to False if the database doesn’t support the DEFAULT keyword in INSERT queries. DatabaseFeatures.supports_default_keyword_in_bulk_insert should be set to False if the database doesn’t support the DEFAULT keyword in bulk INSERT queries. django.contrib.gis ¶ Support for GDAL 2.2 and 2.3 is removed. Support for GEOS 3.6 and 3.7 is removed. django.contrib.sitemaps ¶ The django.contrib.sitemaps.ping_google() function and the ping_google management command are removed as the Google\nSitemaps ping endpoint is deprecated and will be removed in January 2024. The django.contrib.sitemaps.SitemapNotFound exception class is removed. Dropped support for MySQL < 8.0.11 ¶ Support for pre-releases of MySQL 8.0.x series is removed. Django 5.0 supports\nMySQL 8.0.11 and higher. Using create_defaults__exact may now be required with QuerySet.update_or_create() ¶ QuerySet.update_or_create() now supports the parameter create_defaults . As a consequence, any models that have a field named create_defaults that are used with an update_or_create() should specify\nthe field in the lookup with create_defaults__exact . Migrating existing UUIDField on MariaDB 10.7+ ¶ On MariaDB 10.7+, UUIDField is now created as UUID column rather than CHAR(32) column. As a consequence, any UUIDField created in\nDjango < 5.0 should be replaced with a UUIDField subclass backed by CHAR(32) : class Char32UUIDField ( models . UUIDField ): def db_type ( self , connection ): return \"char(32)\" def get_db_prep_value ( self , value , connection , prepared = False ): value = super () . get_db_prep_value ( value , connection , prepared ) if value is not None : value = value . hex return value For example: class MyModel ( models . Model ): uuid = models . UUIDField ( primary_key = True , default = uuid . uuid4 ) Should become: class Char32UUIDField ( models . UUIDField ): ... class MyModel ( models . Model ): uuid = Char32UUIDField ( primary_key = True , default = uuid . uuid4 ) Running the makemigrations command will generate a migration\ncontaining a no-op AlterField operation. Miscellaneous ¶ The instance argument of the undocumented BaseModelFormSet.save_existing() method is renamed to obj . The undocumented django.contrib.admin.helpers.checkbox is removed. Integer fields are now validated as 64-bit integers on SQLite to match the\nbehavior of sqlite3 . The undocumented Query.annotation_select_mask attribute is changed from a\nset of strings to an ordered list of strings. ImageField.update_dimension_fields() is no longer called on the post_init signal if width_field and height_field are not set. Now database function now uses LOCALTIMESTAMP instead of CURRENT_TIMESTAMP on Oracle. AdminSite.site_header is now rendered in a <div> tag instead of <h1> . Screen reader users rely on heading elements for navigation within\na page. Having two <h1> elements was confusing and the site header wasn’t\nhelpful as it is repeated on all pages. In order to improve accessibility, the admin’s main content area and header\ncontent area are now rendered in a <main> and <header> tag instead of <div> . On databases without native support for the SQL XOR operator, ^ as\nthe exclusive or ( XOR ) operator now returns rows that are matched by an\nodd number of operands rather than exactly one operand. This is consistent\nwith the behavior of MySQL, MariaDB, and Python. The minimum supported version of asgiref is increased from 3.6.0 to\n3.7.0. The minimum supported version of selenium is increased from 3.8.0 to\n4.8.0. The AlreadyRegistered and NotRegistered exceptions are moved from django.contrib.admin.sites to django.contrib.admin.exceptions . The minimum supported version of SQLite is increased from 3.21.0 to 3.27.0. Support for cx_Oracle < 8.3 is removed. Executing SQL queries before the app registry has been fully populated now\nraises RuntimeWarning . BadRequest is raised for non-UTF-8 encoded\nrequests with the application/x-www-form-urlencoded content type.\nSee RFC 1866 for more details. The minimum supported version of colorama is increased to 0.4.6. The minimum supported version of docutils is increased to 0.19. Filtering querysets against overflowing integer values now always returns an\nempty queryset. As a consequence, you may need to use ExpressionWrapper() to explicitly wrap arithmetic against\ninteger fields in such cases. Features deprecated in 5.0 ¶ Miscellaneous ¶ The DjangoDivFormRenderer and Jinja2DivFormRenderer transitional form\nrenderers are deprecated. Passing positional arguments name and violation_error_message to BaseConstraint is deprecated in favor of\nkeyword-only arguments. request is added to the signature of ModelAdmin.lookup_allowed() .\nSupport for ModelAdmin subclasses that do not accept this argument is\ndeprecated. The get_joining_columns() method of ForeignObject and ForeignObjectRel is deprecated. Starting with Django 6.0, django.db.models.sql.datastructures.Join will no longer fallback to get_joining_columns() . Subclasses should implement get_joining_fields() instead. The ForeignObject.get_reverse_joining_columns() method is deprecated. The default scheme for forms.URLField will change from \"http\" to \"https\" in Django 6.0. Set FORMS_URLFIELD_ASSUME_HTTPS transitional setting to True to opt into assuming \"https\" during the\nDjango 5.x release cycle. FORMS_URLFIELD_ASSUME_HTTPS transitional setting is deprecated. Support for calling format_html() without passing args or kwargs will be\nremoved. Support for cx_Oracle is deprecated in favor of oracledb 1.3.2+ Python\ndriver. DatabaseOperations.field_cast_sql() is deprecated in favor of DatabaseOperations.lookup_cast() . Starting with Django 6.0, BuiltinLookup.process_lhs() will no longer call field_cast_sql() .\nThird-party database backends should implement lookup_cast() instead. The django.db.models.enums.ChoicesMeta metaclass is renamed to ChoicesType . The Prefetch.get_current_queryset() method is deprecated. The get_prefetch_queryset() method of related managers and descriptors\nis deprecated. Starting with Django 6.0, get_prefetcher() and prefetch_related_objects() will no longer fallback to get_prefetch_queryset() . Subclasses should implement get_prefetch_querysets() instead. Features removed in 5.0 ¶ These features have reached the end of their deprecation cycle and are removed\nin Django 5.0. See Features deprecated in 4.0 for details on these changes, including how\nto remove usage of these features. The SERIALIZE test setting is removed. The undocumented django.utils.baseconv module is removed. The undocumented django.utils.datetime_safe module is removed. The default value of the USE_TZ setting is changed from False to True . The default sitemap protocol for sitemaps built outside the context of a\nrequest is changed from 'http' to 'https' . The extra_tests argument for DiscoverRunner.build_suite() and DiscoverRunner.run_tests() is removed. The django.contrib.postgres.aggregates.ArrayAgg , JSONBAgg , and StringAgg aggregates no longer return [] , [] , and '' ,\nrespectively, when there are no rows. The USE_L10N setting is removed. The USE_DEPRECATED_PYTZ transitional setting is removed. Support for pytz timezones is removed. The is_dst argument is removed from: QuerySet.datetimes() django.utils.timezone.make_aware() django.db.models.functions.Trunc() django.db.models.functions.TruncSecond() django.db.models.functions.TruncMinute() django.db.models.functions.TruncHour() django.db.models.functions.TruncDay() django.db.models.functions.TruncWeek() django.db.models.functions.TruncMonth() django.db.models.functions.TruncQuarter() django.db.models.functions.TruncYear() The django.contrib.gis.admin.GeoModelAdmin and OSMGeoAdmin classes\nare removed. The undocumented BaseForm._html_output() method is removed. The ability to return a str , rather than a SafeString , when rendering\nan ErrorDict and ErrorList is removed. See Features deprecated in 4.1 for details on these changes, including how\nto remove usage of these features. The SitemapIndexItem.__str__() method is removed. The CSRF_COOKIE_MASKED transitional setting is removed. The name argument of django.utils.functional.cached_property() is\nremoved. The opclasses argument of django.contrib.postgres.constraints.ExclusionConstraint is removed. The undocumented ability to pass errors=None to SimpleTestCase.assertFormError() and assertFormsetError() is removed. django.contrib.sessions.serializers.PickleSerializer is removed. The usage of QuerySet.iterator() on a queryset that prefetches related\nobjects without providing the chunk_size argument is no longer allowed. Passing unsaved model instances to related filters is no longer allowed. created=True is required in the signature of RemoteUserBackend.configure_user() subclasses. Support for logging out via GET requests in the django.contrib.auth.views.LogoutView and django.contrib.auth.views.logout_then_login() is removed. The django.utils.timezone.utc alias to datetime.timezone.utc is\nremoved. Passing a response object and a form/formset name to SimpleTestCase.assertFormError() and assertFormSetError() is no\nlonger allowed. The django.contrib.gis.admin.OpenLayersWidget is removed. The django.contrib.auth.hashers.CryptPasswordHasher is removed. The \"django/forms/default.html\" and \"django/forms/formsets/default.html\" templates are removed. The default form and formset rendering style is changed to the div-based. Passing nulls_first=False or nulls_last=False to Expression.asc() and Expression.desc() methods, and the OrderBy expression is no\nlonger allowed.", "keywords": ["users", "rows", "bigintegerfield", "integerfield", "storage", "uuidfield", "formset", "closestpoint", "cleanup", "pickleserializer", "endpoint", "basemodelformset.save_existing", "messages", "bronze", "logoutview", "formsets", "renderers", "require_http_methods", "functools.lru_cache", "library", "disconnects", "badrequest", "field.db_default", "field", "#", "databaseoperations.field_cast_sql", "form.email.errors", "serialization", "silver", "migrations", "truncyear", "form.name", "messagestestmixin.assertmessages", "foreignobject.get_reverse_joining_columns", "range", "relatedfieldlistfilter", "compatibility", "django.contrib.postgres.aggregates", "expression.desc", "receivers", "https", "pi", "geosgeometry.equals_identical", "ui", "^", "label", "sport", "navigation", "http", "changes", "=", "create_defaults", "results", "errorlist", "alreadyregistered", "tag", "db_type", "genericforeignkey", "process", "queryset.prefetch_related", "form.password", "conditional_page", "django.contrib.sitemaps.ping_google", "functools.cache", "type", "paginator.page", "asession", "django.contrib.admin.sites", "calls", "custom", "kwargs", "objects", "discoverrunner", "file", "default.html", "user", "adminsite.get_log_entries", "cases", "lookup_cast", "attribute", "require_safe", "args", "django.contrib.gis", "csrf_protect", "queryset.datetimes", "warning", "allvaluesfieldlistfilter", "runtimewarning", "queryset.update_or_create", "time", "checkconstraint", "basis", "jquery", "form.password.help_text", "setting", "char32uuidfield", "require_post", "db_persist", "adminsite.site_header", "password", "name", "hood", "makemigrations", "parameter", "backends", "reference", "january", "django.contrib.auth", "age", "baseconstraint", ".choices", "versions", "queries", "height_field", "char(32", "truncquarter", "django.contrib.admin", "oracledb", "django.contrib.admin.exceptions", "return", "ping_google", "operator", "get_joining_fields", "accessibility", "foreignobjectrel", "duration", "format_html", "use_tz", "parent", "december", "karate", "datetimefield", "mymodel", "jsonbagg", "field.choices", "field.html", "serialize", "baseform._html_output", "model.save", "url", "join", "error", "geometry", "module", "code", "choicesmeta", "pages", "filter", "style", "behavior", "false", "i", "class", "migration", "update_or_create", "group", "django.contrib.auth.views.logout_then_login", "warnings", "widget", "x", "geomodeladmin", "pbkdf2", "request", "gzip_page", "database", "score", "signal", "*", "query", "page", "test", "metaclass", "postgresql", "use_l10n", "count", "types", "strings", "elements", "floatfield", "subclass", "localtimestamp", "httprequest.auser", "admin", "creation", "etag", ".", "insert", "usage", "registry", "3.2.0", "truncsecond", "violation_error_message", "imagefield.update_dimension_fields", "form.name.help_text", "get_prefetch_querysets", "form.password.errors", "validation", "queryset.aiterator", "flexibility", "django.utils.timezone.make_aware", "section", "signal.asend", "follow", "modeladmin.lookup_allowed", "sequence", "django.core.paginator", "operand", "django.contrib.postgres.constraints", "aria", "subclasses", "releases", "enumeration", "sensitive_variables", "jinja2divformrenderer", "operation", "order", "signature", "default", "choices", "8.0.11", "aprefetch_related_objects", "django.contrib.sitemaps", "alias", "form", "shortcuts", "signals", "prefix", "option", "properties", "expression", "tests", "help", "classes", "prefetch.get_current_queryset", "judo", "area", "validationerror", "f", "scheme", "xframe_options_deny", "circumference", "template", "form.password.label_tag", "truncweek", "aggregates", "header", "choicefield.choices", "databaseoperations.lookup_cast", "cx_oracle", "xframe_options_sameorigin", "django.contrib.auth.views", "gdal", "aget_list_or_404", "databasefeatures.supports_default_keyword_in_bulk_insert", "concept", "op", "party", "queryset", "integer", "simplifies", "¶", "uyghur", "calling", "command", "internationalization", "parameters", "no_append_slash", "integers", "trunchour", "side", "miscellaneous", "queryset.iterator", "content", "function", "protocol", "views", "testing", "view", "paginator.error_messages", "facet", "open", "uuid", "relatedonlyfieldlistfilter", "number", "generatedfield", "def", "point", "values", "docutils", "queryset.abulk_create", "4.2.x", "mapping", "favor", "vary_on_cookie", "databases", "form.email.auto_id", "badminton", "managers", "django.utils.baseconv", "language", "models", "xregexp", "querysets", "version", "form.name.as_field_group", "cache_control", "gis", "cryptpasswordhasher", "treatment", "deprecation", "reader", "condition", "prefetching", "minimum", "django", "series", "3.7.0", "tennis", "rfc", "n’t", "div", "fields", "form.name.errors", "fixes", "set", "django.utils.timezone.utc", "aupdate_session_auth_hash", "value", "events", "truncminute", "assertion", "file.open", "bit", "django.utils.datetime_safe", "aforce_login", "openlayerswidget", "columns", "describedby", "safestring", "backend", "guide", "field_cast_sql", "errordict", "self", "need", "instance", "get_scores", "get_joining_columns", "signal.asend_robust", "django.contrib.auth.hashers.acheck_password", "xor", "reporting", "output_field", "geometries", "trunc", "primary_key", "handling", "consequence", "sitemaps", "django.contrib.admin.helpers.checkbox", "expressionwrapper", "validators", "modeladmin", "5.x", "form.email.help_text", "readers", "opclasses", "instances", "sensitive_post_parameters", "checking", "authenticationmiddleware", "object", "arts", "asgiref", "colorama", "stringagg", "abstractbaseuser.acheck_password", "counts", "charfield", "form.name.auto_id", "response", "management", "www", "django.contrib.auth.hashers", "sql", "aget_user", "truncmonth", "requests", "authors", "alogout", "rendering", "keyword", "alterfield", "square", "notregistered", "queryset.aupdate_or_create", "get_db_prep_value", "foreignobject", "decorators", "csrf_cookie_masked", "notes", "obj", "django.contrib.contenttypes", "escapeseq", "never_cache", "changelist", "migrating", "filtering", "sitemapnotfound", "welcome", "sitemapindexitem.__str", "adminsite.get_model_admin", "discoverrunner.build_suite", "escape", "asyncclient", "truncday", "serializer", "8.0.x", "features", "forms", "site", "sqlite3", "getting", "example", "simpletestcase.assertformerror", "app", "remoteuserbackend.configure_user", "column", "list", "medal", "form.password.as_field_group", "osmgeoadmin", "django.contrib.gis.admin", "assertformseterror", "hasher", "google", "model", "ping", "dispatch", "descriptors", "timezones", "django.db.models.functions", "element", "application", "urlfield", "choicesfieldlistfilter", "pagination", "hex", "release", "ability", "expression.asc", "asgi", "racket", "query.annotation_select_mask", "geos", "form.password.auto_id", "log", "prefetch_related_objects", "chunk_size", "uniqueconstraint", "exclusionconstraint", "h1", "get_prefetch_queryset", "lookup", "django.contrib.sessions.serializers", "null", "current_timestamp", "errors", "html", "screen", "arrayagg", "tuple", "str", "arguments", "martial", "passwords", "package", "violation_error_code", "driver", "db_default", "translations", "uuid4", "end", "entries", "sqlite", "textchoices", "tuples", "extra_tests", "functions", "key", "gold", "none", "filters", "requires_csrf_token", "get_prefetcher", "aget_object_or_404", "col", "mariadb", "get", "django.contrib.auth.aauthenticate", "stepvaluevalidator", "vary_on_headers", "create_defaults__exact", "true", "sitemap", "api", "equivalence", "support", "modeladmin.show_facets", "django.utils.functional.cached_property", "datetime.timezone.utc", "winner", "-", "connection", "context", "xframe_options_exempt", "cycle", "offset", "import", "d", "iteration", "mysql", "%", "defaults", "1.3.2", "builtinlookup.process_lhs", "information", "row", "python", "methods", "width_field", "options", "exception", "client", "details", "method", "django.db", "argument", "facets", "selenium", "operands", "databasefeatures.supports_expression_defaults", "discoverrunner.run_tests", "oracle", "choicestype", "templates", "django.db.models.enums", "text", "orderby", "project", "djangodivformrenderer", "exceptions"], "type": "documentation"},
{"title": "Django 1.9 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.9/", "content": "Django 1.9 release notes ¶ December 1, 2015 Welcome to Django 1.9! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 1.8 or older versions. We’ve dropped some features that have reached the end of\ntheir deprecation cycle, and we’ve begun the deprecation process for some\nfeatures . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Python compatibility ¶ Django 1.9 requires Python 2.7, 3.4, or 3.5. We highly recommend and only\nofficially support the latest release of each series. The Django 1.8 series is the last to support Python 3.2 and 3.3. What’s new in Django 1.9 ¶ Performing actions after a transaction commit ¶ The new on_commit() hook allows performing actions\nafter a database transaction is successfully committed. This is useful for\ntasks such as sending notification emails, creating queued tasks, or\ninvalidating caches. This functionality from the django-transaction-hooks package has been\nintegrated into Django. Password validation ¶ Django now offers password validation to help prevent the usage of weak\npasswords by users. The validation is integrated in the included password\nchange and reset forms and is simple to integrate in any other code.\nValidation is performed by one or more validators, configured in the new AUTH_PASSWORD_VALIDATORS setting. Four validators are included in Django, which can enforce a minimum length,\ncompare the password to the user’s attributes like their name, ensure\npasswords aren’t entirely numeric, or check against an included list of common\npasswords. You can combine multiple validators, and some validators have\ncustom configuration options. For example, you can choose to provide a custom\nlist of common passwords. Each validator provides a help text to explain its\nrequirements to the user. By default, no validation is performed and all passwords are accepted, so if\nyou don’t set AUTH_PASSWORD_VALIDATORS , you will not see any\nchange. In new projects created with the default startproject template, a simple set of validators is enabled. To enable basic validation in\nthe included auth forms for your project, you could set, for example: AUTH_PASSWORD_VALIDATORS = [ { \"NAME\" : \"django.contrib.auth.password_validation.UserAttributeSimilarityValidator\" , }, { \"NAME\" : \"django.contrib.auth.password_validation.MinimumLengthValidator\" , }, { \"NAME\" : \"django.contrib.auth.password_validation.CommonPasswordValidator\" , }, { \"NAME\" : \"django.contrib.auth.password_validation.NumericPasswordValidator\" , }, ] See Password validation for more details. Permission mixins for class-based views ¶ Django now ships with the mixins AccessMixin , LoginRequiredMixin , PermissionRequiredMixin , and UserPassesTestMixin to provide the\nfunctionality of the django.contrib.auth.decorators for class-based views.\nThese mixins have been taken from, or are at least inspired by, the django-braces project. There are a few differences between Django’s and django-braces '\nimplementation, though: The raise_exception attribute\ncan only be True or False . Custom exceptions or callables are not\nsupported. The handle_no_permission() method does not take a request argument. The current request is available\nin self.request . The custom test_func() of UserPassesTestMixin does not take a user argument. The current user is available in self.request.user . The permission_required attribute supports a string (defining one permission) or a list/tuple of\nstrings (defining multiple permissions) that need to be fulfilled to grant\naccess. The new permission_denied_message attribute allows passing a message to the PermissionDenied exception. New styling for contrib.admin ¶ The admin sports a modern, flat design with new SVG icons which look perfect\non HiDPI screens. It still provides a fully-functional experience to YUI’s\nA-grade browsers. Older browser may experience varying levels of graceful\ndegradation. Running tests in parallel ¶ The test command now supports a --parallel option to run a project’s tests in multiple processes in parallel. Each process gets its own database. You must ensure that different test cases\ndon’t access the same resources. For instance, test cases that touch the\nfilesystem should create a temporary directory for their own use. This option is enabled by default for Django’s own test suite provided: the OS supports it (all but Windows) the database backend supports it (all the built-in backends but Oracle) Minor features ¶ django.contrib.admin ¶ Admin views now have model_admin or admin_site attributes. The URL of the admin change view has been changed (was at /admin/<app>/<model>/<pk>/ by default and is now at /admin/<app>/<model>/<pk>/change/ ). This should not affect your\napplication unless you have hardcoded admin URLs. In that case, replace those\nlinks by reversing admin URLs instead. Note that\nthe old URL still redirects to the new one for backwards compatibility, but\nit may be removed in a future version. ModelAdmin.get_list_select_related() was added to allow\nchanging the select_related() values used in the admin’s changelist query\nbased on the request. The available_apps context variable, which lists the available\napplications for the current user, has been added to the AdminSite.each_context() method. AdminSite.empty_value_display and ModelAdmin.empty_value_display were added to override\nthe display of empty values in admin change list. You can also customize the\nvalue for each field. Added jQuery events when an inline form is added or removed on the change form page. The time picker widget includes a ‘6 p.m’ option for consistency of having\npredefined options every 6 hours. JavaScript slug generation now supports Romanian characters. django.contrib.admindocs ¶ The model section of the admindocs now also describes methods that take\narguments, rather than ignoring them. django.contrib.auth ¶ The default iteration count for the PBKDF2 password hasher has been increased\nby 20%. This backwards compatible change will not affect users who have\nsubclassed django.contrib.auth.hashers.PBKDF2PasswordHasher to change the\ndefault value. The BCryptSHA256PasswordHasher will now update passwords if its rounds attribute is changed. AbstractBaseUser and BaseUserManager were moved to a new django.contrib.auth.base_user module so that they can be imported without\nincluding django.contrib.auth in INSTALLED_APPS (doing so\nraised a deprecation warning in older versions and is no longer supported in\nDjango 1.9). The permission argument of permission_required() accepts all\nkinds of iterables, not only list and tuples. The new PersistentRemoteUserMiddleware makes it possible to use REMOTE_USER for setups where the header is only\npopulated on login pages instead of every request in the session. The django.contrib.auth.views.password_reset() view accepts an extra_email_context parameter. django.contrib.contenttypes ¶ It’s now possible to use order_with_respect_to with a GenericForeignKey . django.contrib.gis ¶ All GeoQuerySet methods have been deprecated and replaced by equivalent database functions . As soon\nas the legacy methods have been replaced in your code, you should even be\nable to remove the special GeoManager from your GIS-enabled classes. The GDAL interface now supports instantiating file-based and in-memory GDALRaster objects from raw data.\nSetters for raster properties such as projection or pixel values have\nbeen added. For PostGIS users, the new RasterField allows storing GDALRaster objects .\nIt supports automatic spatial index creation and reprojection when saving a\nmodel. It does not yet support spatial querying. The new GDALRaster.warp() method allows warping a raster by specifying target raster properties such as\norigin, width, height, or pixel size (among others). The new GDALRaster.transform() method allows transforming a\nraster into a different spatial reference system by specifying a target srid . The new GeoIP2 class allows using\nMaxMind’s GeoLite2 databases which includes support for IPv6 addresses. The default OpenLayers library version included in widgets has been updated\nfrom 2.13 to 2.13.1. django.contrib.postgres ¶ Added support for the rangefield.contained_by lookup for some built\nin fields which correspond to the range fields. Added django.contrib.postgres.fields.JSONField . Added PostgreSQL specific aggregation functions . Added the TransactionNow database\nfunction. django.contrib.sessions ¶ The session model and SessionStore classes for the db and cached_db backends are refactored to allow a custom database session\nbackend to build upon them. See Extending database-backed session engines for more details. django.contrib.sites ¶ get_current_site() now handles the case\nwhere request.get_host() returns domain:port , e.g. example.com:80 . If the lookup fails because the host does not match a\nrecord in the database and the host has a port, the port is stripped and the\nlookup is retried with the domain part only. django.contrib.syndication ¶ Support for multiple enclosures per feed item has been added. If multiple\nenclosures are defined on a RSS feed, an exception is raised as RSS feeds,\nunlike Atom feeds, do not support multiple enclosures per feed item. Cache ¶ django.core.cache.backends.base.BaseCache now has a get_or_set() method. django.views.decorators.cache.never_cache() now sends more persuasive\nheaders (added no-cache, no-store, must-revalidate to Cache-Control )\nto better prevent caching. This was also added in Django 1.8.8. CSRF ¶ The request header’s name used for CSRF authentication can be customized\nwith CSRF_HEADER_NAME . The CSRF referer header is now validated against the CSRF_COOKIE_DOMAIN setting if set. See How it works for\ndetails. The new CSRF_TRUSTED_ORIGINS setting provides a way to allow\ncross-origin unsafe requests (e.g. POST ) over HTTPS. Database backends ¶ The PostgreSQL backend ( django.db.backends.postgresql_psycopg2 ) is also\navailable as django.db.backends.postgresql . The old name will continue to\nbe available for backwards compatibility. File Storage ¶ Storage.get_valid_name() is now called when\nthe upload_to is a callable. File now has the seekable() method when using\nPython 3. Forms ¶ ModelForm accepts the new Meta option field_classes to customize the type of the fields. See Overriding the default fields for details. You can now specify the order in which form fields are rendered with the field_order attribute, the field_order constructor argument , or the order_fields() method. A form prefix can be specified inside a form class, not only when\ninstantiating a form. See Prefixes for forms for details. You can now specify keyword arguments that you want to pass to the constructor of forms in a formset. SlugField now accepts an allow_unicode argument to allow Unicode\ncharacters in slugs. CharField now accepts a strip argument to strip input data of leading\nand trailing whitespace.  As this defaults to True this is different\nbehavior from previous releases. Form fields now support the disabled argument,\nallowing the field widget to be displayed disabled by browsers. It’s now possible to customize bound fields by overriding a field’s get_bound_field() method. Generic Views ¶ Class-based views generated using as_view() now have view_class and view_initkwargs attributes. method_decorator() can now be used with a list\nor tuple of decorators. It can also be used to decorate classes instead\nof methods . Internationalization ¶ The django.views.i18n.set_language() view now properly redirects to translated URLs , when available. The django.views.i18n.javascript_catalog() view now works correctly\nif used multiple times with different configurations on the same page. The django.utils.timezone.make_aware() function gained an is_dst argument to help resolve ambiguous times during DST transitions. You can now use locale variants supported by gettext. These are usually used\nfor languages which can be written in different scripts, for example Latin\nand Cyrillic (e.g. be@latin ). Added the django.views.i18n.json_catalog() view to help build a custom\nclient-side i18n library upon Django translations. It returns a JSON object\ncontaining a translations catalog, formatting settings, and a plural rule. Added the name_translated attribute to the object returned by the get_language_info template tag. Also added a corresponding template\nfilter: language_name_translated . You can now run compilemessages from the root directory of your\nproject and it will find all the app message files that were created by makemessages . makemessages now calls xgettext once per locale directory\nrather than once per translatable file. This speeds up localization builds. blocktrans supports assigning its output to a variable using asvar . Two new languages are available: Colombian Spanish and Scottish Gaelic. Management Commands ¶ The new sendtestemail command lets you send a test email to\neasily confirm that email sending through Django is working. To increase the readability of the SQL code generated by sqlmigrate , the SQL code generated for each migration operation is\npreceded by the operation’s description. The dumpdata command output is now deterministically ordered.\nMoreover, when the --output option is specified, it also shows a progress\nbar in the terminal. The createcachetable command now has a --dry-run flag to\nprint out the SQL rather than execute it. The startapp command creates an apps.py file. Since it doesn’t\nuse default_app_config ( a discouraged API ), you must specify the app config’s path,\ne.g. 'polls.apps.PollsConfig' , in INSTALLED_APPS for it to be\nused (instead of just 'polls' ). When using the PostgreSQL backend, the dbshell command can connect\nto the database using the password from your settings file (instead of\nrequiring it to be manually entered). The django package may be run as a script, i.e. python -m django ,\nwhich will behave the same as django-admin . Management commands that have the --noinput option now also take --no-input as an alias for that option. Migrations ¶ Initial migrations are now marked with an initial = True class attribute which allows migrate --fake-initial to more easily detect initial migrations. Added support for serialization of functools.partial and LazyObject instances. When supplying None as a value in MIGRATION_MODULES , Django\nwill consider the app an app without migrations. When applying migrations, the “Rendering model states” step that’s displayed\nwhen running migrate with verbosity 2 or higher now computes only the states\nfor the migrations that have already been applied. The model states for\nmigrations being applied are generated on demand, drastically reducing the\namount of required memory. However, this improvement is not available when unapplying migrations and\ntherefore still requires the precomputation and storage of the intermediate\nmigration states. This improvement also requires that Django no longer supports mixed migration\nplans. Mixed plans consist of a list of migrations where some are being\napplied and others are being unapplied. This was never officially supported\nand never had a public API that supports this behavior. The squashmigrations command now supports specifying the starting\nmigration from which migrations will be squashed. Models ¶ QuerySet.bulk_create() now works on proxy models. Database configuration gained a TIME_ZONE option for interacting with databases that store datetimes in local time and\ndon’t support time zones when USE_TZ is True . Added the RelatedManager.set() method to the related\nmanagers created by ForeignKey , GenericForeignKey , and ManyToManyField . The add() method on\na reverse foreign key now has a bulk parameter to allow executing one\nquery regardless of the number of objects being added rather than one query\nper object. Added the keep_parents parameter to Model.delete() to allow deleting only a child’s data in a\nmodel that uses multi-table inheritance. Model.delete() and QuerySet.delete() return\nthe number of objects deleted. Added a system check to prevent defining both Meta.ordering and order_with_respect_to on the same model. Date and time lookups can be chained with other lookups\n(such as exact , gt , lt , etc.). For example: Entry.objects.filter(pub_date__month__gt=6) . Time lookups (hour, minute, second) are now supported by TimeField for all database backends. Support for\nbackends other than SQLite was added but undocumented in Django 1.7. You can specify the output_field parameter of the Avg aggregate in order to aggregate over\nnon-numeric columns, such as DurationField . Added the date lookup to DateTimeField to allow querying the field by only the date portion. Added the Greatest and Least database functions. Added the Now database function, which\nreturns the current date and time. Transform is now a subclass of Func() which allows Transform s to be used on\nthe right hand side of an expression, just like regular Func s. This\nallows registering some database functions like Length , Lower , and Upper as transforms. SlugField now accepts an allow_unicode argument to allow Unicode\ncharacters in slugs. Added support for referencing annotations in QuerySet.distinct() . connection.queries shows queries with substituted parameters on SQLite. Query expressions can now be used when\ncreating new model instances using save() , create() , and bulk_create() . Requests and Responses ¶ Unless HttpResponse.reason_phrase is explicitly set, it now is\ndetermined by the current value of HttpResponse.status_code . Modifying the value of status_code outside of the constructor will also modify the value of reason_phrase . The debug view now shows details of chained exceptions on Python 3. The default 40x error views now accept a second positional parameter, the\nexception that triggered the view. View error handlers now support TemplateResponse , commonly used with\nclass-based views. Exceptions raised by the render() method are now passed to the process_exception() method of each middleware. Request middleware can now set HttpRequest.urlconf to None to revert any changes made\nby previous middleware and return to using the ROOT_URLCONF . The DISALLOWED_USER_AGENTS check in CommonMiddleware now raises a PermissionDenied exception as opposed to\nreturning an HttpResponseForbidden so that handler403 is invoked. Added HttpRequest.get_port() to\nfetch the originating port of the request. Added the json_dumps_params parameter to JsonResponse to allow passing keyword arguments to the json.dumps() call used to generate the response. The BrokenLinkEmailsMiddleware now\nignores 404s when the referer is equal to the requested URL. To circumvent\nthe empty referer check already implemented, some web bots set the referer to\nthe requested URL. Templates ¶ Template tags created with the simple_tag() helper can now store results in a template variable by using the as argument. Added a Context.setdefault() method. The django.template logger was added and\nincludes the following messages: A DEBUG level message for missing context variables. A WARNING level message for uncaught exceptions raised\nduring the rendering of an {% include %} when debug mode is off\n(helpful since {% include %} silences the exception and returns an\nempty string). The firstof template tag supports storing the output in a variable\nusing ‘as’. Context.update() can now be used as\na context manager. Django template loaders can now extend templates recursively. The debug page template postmortem now include output from each engine that\nis installed. Debug page integration for custom\ntemplate engines was added. The DjangoTemplates backend gained\nthe ability to register libraries and builtins explicitly through the\ntemplate OPTIONS . The timesince and timeuntil filters were improved to deal with leap\nyears when given large time spans. The include tag now caches parsed templates objects during template\nrendering, speeding up reuse in places such as for loops. Tests ¶ Added the json() method to test client\nresponses to give access to the response body as JSON. Added the force_login() method to the test\nclient. Use this method to simulate the effect of a user logging into the\nsite while skipping the authentication and verification steps of login() . URLs ¶ Regular expression lookaround assertions are now allowed in URL patterns. The application namespace can now be set using an app_name attribute\non the included module or object. It can also be set by passing a 2-tuple\nof (<list of patterns>, <application namespace>) as the first argument to include() . System checks have been added for common URL pattern mistakes. Validators ¶ Added django.core.validators.int_list_validator() to generate\nvalidators of strings containing integers separated with a custom character. EmailValidator now limits the length of\ndomain name labels to 63 characters per RFC 1034 . Added validate_unicode_slug() to validate slugs\nthat may contain Unicode characters. Backwards incompatible changes in 1.9 ¶ Warning In addition to the changes outlined in this section, be sure to review the Features removed in 1.9 for the features that have reached the end of\ntheir deprecation cycle and therefore been removed. If you haven’t updated\nyour code within the deprecation timeline for a given feature, its removal\nmay appear as a backwards incompatible change. Database backend API ¶ A couple of new tests rely on the ability of the backend to introspect column\ndefaults (returning the result as Field.default ). You can set the can_introspect_default database feature to False if your backend\ndoesn’t implement this. You may want to review the implementation on the\nbackends that Django includes for reference ( #24245 ). Registering a global adapter or converter at the level of the DB-API module\nto handle time zone information of datetime values passed\nas query parameters or returned as query results on databases that don’t\nsupport time zones is discouraged. It can conflict with other libraries. The recommended way to add a time zone to datetime values\nfetched from the database is to register a converter for DateTimeField in DatabaseOperations.get_db_converters() . The needs_datetime_string_cast database feature was removed. Database\nbackends that set it must register a converter instead, as explained above. The DatabaseOperations.value_to_db_<type>() methods were renamed to adapt_<type>field_value() to mirror the convert_<type>field_value() methods. To use the new date lookup, third-party database backends may need to\nimplement the DatabaseOperations.datetime_cast_date_sql() method. The DatabaseOperations.time_extract_sql() method was added. It calls the\nexisting date_extract_sql() method. This method is overridden by the\nSQLite backend to add time lookups (hour, minute, second) to TimeField , and may be needed by third-party\ndatabase backends. The DatabaseOperations.datetime_cast_sql() method (not to be confused\nwith DatabaseOperations.datetime_cast_date_sql() mentioned above)\nhas been removed. This method served to format dates on Oracle long\nbefore 1.0, but hasn’t been overridden by any core backend in years\nand hasn’t been called anywhere in Django’s code or tests. In order to support test parallelization, you must implement the DatabaseCreation._clone_test_db() method and set DatabaseFeatures.can_clone_databases = True . You may have to adjust DatabaseCreation.get_test_db_clone_settings() . Default settings that were tuples are now lists ¶ The default settings in django.conf.global_settings were a combination of\nlists and tuples. All settings that were formerly tuples are now lists. is_usable attribute on template loaders is removed ¶ Django template loaders previously required an is_usable attribute to be\ndefined. If a loader was configured in the template settings and this attribute\nwas False , the loader would be silently ignored. In practice, this was only\nused by the egg loader to detect if setuptools was installed. The is_usable attribute is now removed and the egg loader instead fails at\nruntime if setuptools is not installed. Related set direct assignment ¶ Direct assignment of related objects in the ORM used to perform a clear() followed by a call to add() . This caused needlessly large data changes and\nprevented using the m2m_changed signal to\ntrack individual changes in many-to-many relations. Direct assignment now relies on the new set() method on related\nmanagers which by default only processes changes between the existing related\nset and the one that’s newly assigned. The previous behavior can be restored by\nreplacing direct assignment by a call to set() with the keyword argument clear=True . ModelForm , and therefore ModelAdmin , internally rely on direct\nassignment for many-to-many relations and as a consequence now use the new\nbehavior. Filesystem-based template loaders catch more specific exceptions ¶ When using the filesystem.Loader or app_directories.Loader template loaders, earlier versions of Django raised a TemplateDoesNotExist error if a template source existed\nbut was unreadable. This could happen under many circumstances, such as if\nDjango didn’t have permissions to open the file, or if the template source was\na directory. Now, Django only silences the exception if the template source\ndoes not exist. All other situations result in the original IOError being\nraised. HTTP redirects no longer forced to absolute URIs ¶ Relative redirects are no longer converted to absolute URIs. RFC 2616 required the Location header in redirect responses to be an absolute URI,\nbut it has been superseded by RFC 7231 which allows relative URIs in Location , recognizing the actual practice of user agents, almost all of\nwhich support them. Consequently, the expected URLs passed to assertRedirects should generally\nno longer include the scheme and domain part of the URLs. For example, self.assertRedirects(response, 'http://testserver/some-url/') should be\nreplaced by self.assertRedirects(response, '/some-url/') (unless the\nredirection specifically contained an absolute URL). In the rare case that you need the old behavior (discovered with an ancient\nversion of Apache with mod_scgi that interprets a relative redirect as an\n“internal redirect”), you can restore it by writing a custom middleware: class LocationHeaderFix ( object ): def process_response ( self , request , response ): if \"Location\" in response : response [ \"Location\" ] = request . build_absolute_uri ( response [ \"Location\" ]) return response Dropped support for PostgreSQL 9.0 ¶ Upstream support for PostgreSQL 9.0 ended in September 2015. As a consequence,\nDjango 1.9 sets 9.1 as the minimum PostgreSQL version it officially supports. Dropped support for Oracle 11.1 ¶ Upstream support for Oracle 11.1 ended in August 2015. As a consequence, Django\n1.9 sets 11.2 as the minimum Oracle version it officially supports. Bulk behavior of add() method of related managers ¶ To improve performance, the add() methods of the related managers created\nby ForeignKey and GenericForeignKey changed from a series of Model.save() calls to a single QuerySet.update() call. The change means\nthat pre_save and post_save signals aren’t sent anymore. You can use\nthe bulk=False keyword argument to revert to the previous behavior. Template LoaderOrigin and StringOrigin are removed ¶ In previous versions of Django, when a template engine was initialized with\ndebug as True , an instance of django.template.loader.LoaderOrigin or django.template.base.StringOrigin was set as the origin attribute on the\ntemplate object. These classes have been combined into Origin and is now always set regardless of the\nengine debug setting. For a minimal level of backwards compatibility, the old\nclass names will be kept as aliases to the new Origin class until\nDjango 2.0. Changes to the default logging configuration ¶ To make it easier to write custom logging configurations, Django’s default\nlogging configuration no longer defines django.request and django.security loggers. Instead, it defines a single django logger,\nfiltered at the INFO level, with two handlers: console : filtered at the INFO level and only active if DEBUG=True . mail_admins : filtered at the ERROR level and only active if DEBUG=False . If you aren’t overriding Django’s default logging, you should see minimal\nchanges in behavior, but you might see some new logging to the runserver console, for example. If you are overriding Django’s default logging, you should check to see how\nyour configuration merges with the new defaults. HttpRequest details in error reporting ¶ It was redundant to display the full details of the HttpRequest each time it appeared as a stack frame\nvariable in the HTML version of the debug page and error email. Thus, the HTTP\nrequest will now display the same standard representation as other variables\n( repr(request) ). As a result, the ExceptionReporterFilter.get_request_repr() method and the undocumented django.http.build_request_repr() function were removed. The contents of the text version of the email were modified to provide a\ntraceback of the same structure as in the case of AJAX requests. The traceback\ndetails are rendered by the ExceptionReporter.get_traceback_text() method. Removal of time zone aware global adapters and converters for datetimes ¶ Django no longer registers global adapters and converters for managing time\nzone information on datetime values sent to the database as\nquery parameters or read from the database in query results. This change\naffects projects that meet all the following conditions: The USE_TZ setting is True . The database is SQLite, MySQL, Oracle, or a third-party database that\ndoesn’t support time zones. In doubt, you can check the value of connection.features.supports_timezones . The code queries the database outside of the ORM, typically with cursor.execute(sql, params) . If you’re passing aware datetime parameters to such\nqueries, you should turn them into naive datetimes in UTC: from django.utils import timezone param = timezone . make_naive ( param , timezone . utc ) If you fail to do so, the conversion will be performed as in earlier versions\n(with a deprecation warning) up until Django 1.11. Django 2.0 won’t perform any\nconversion, which may result in data corruption. If you’re reading datetime values from the results, they\nwill be naive instead of aware. You can compensate as follows: from django.utils import timezone value = timezone . make_aware ( value , timezone . utc ) You don’t need any of this if you’re querying the database through the ORM,\neven if you’re using raw() queries. The ORM takes care of managing time zone information. Template tag modules are imported when templates are configured ¶ The DjangoTemplates backend now\nperforms discovery on installed template tag modules when instantiated. This\nupdate enables libraries to be provided explicitly via the 'libraries' key of OPTIONS when defining a DjangoTemplates backend. Import\nor syntax errors in template tag modules now fail early at instantiation time\nrather than when a template with a {% load %} tag is first\ncompiled. django.template.base.add_to_builtins() is removed ¶ Although it was a private API, projects commonly used add_to_builtins() to\nmake template tags and filters available without using the {% load %} tag. This API has been formalized. Projects should now\ndefine built-in libraries via the 'builtins' key of OPTIONS when defining a DjangoTemplates backend. simple_tag now wraps tag output in conditional_escape ¶ In general, template tags do not autoescape their contents, and this behavior is documented . For tags like inclusion_tag , this is not a problem because\nthe included template will perform autoescaping. For assignment_tag() ,\nthe output will be escaped when it is used as a variable in the template. For the intended use cases of simple_tag ,\nhowever, it is very easy to end up with incorrect HTML and possibly an XSS\nexploit. For example: @register . simple_tag ( takes_context = True ) def greeting ( context ): return \"Hello {0} !\" . format ( context [ \"request\" ] . user . first_name ) In older versions of Django, this will be an XSS issue because user.first_name is not escaped. In Django 1.9, this is fixed: if the template context has autoescape=True set (the default), then simple_tag will wrap the output of the tag function\nwith conditional_escape() . To fix your simple_tag s, it is best to apply the following practices: Any code that generates HTML should use either the template system or format_html() . If the output of a simple_tag needs escaping, use escape() or conditional_escape() . If you are absolutely certain that you are outputting HTML from a trusted\nsource (e.g. a CMS field that stores HTML entered by admins), you can mark it\nas such using mark_safe() . Tags that follow these rules will be correct and safe whether they are run on\nDjango 1.9+ or earlier. Paginator.page_range ¶ Paginator.page_range is\nnow an iterator instead of a list. In versions of Django previous to 1.8, Paginator.page_range returned a list in Python 2 and a range in Python 3. Django 1.8 consistently\nreturned a list, but an iterator is more efficient. Existing code that depends on list specific features, such as indexing,\ncan be ported by converting the iterator into a list using list() . Implicit QuerySet __in lookup removed ¶ In earlier versions, queries such as: Model . objects . filter ( related_id = RelatedModel . objects . all ()) would implicitly convert to: Model . objects . filter ( related_id__in = RelatedModel . objects . all ()) resulting in SQL like \"related_id IN (SELECT id FROM ...)\" . This implicit __in no longer happens so the “IN” SQL is now “=”, and if the\nsubquery returns multiple results, at least some databases will throw an error. contrib.admin browser support ¶ The admin no longer supports Internet Explorer 8 and below, as these browsers\nhave reached end-of-life. CSS and images to support Internet Explorer 6 and 7 have been removed. PNG and\nGIF icons have been replaced with SVG icons, which are not supported by\nInternet Explorer 8 and earlier. The jQuery library embedded in the admin has been upgraded from version 1.11.2\nto 2.1.4. jQuery 2.x has the same API as jQuery 1.x, but does not support\nInternet Explorer 6, 7, or 8, allowing for better performance and a smaller\nfile size. If you need to support IE8 and must also use the latest version of\nDjango, you can override the admin’s copy of jQuery with your own by creating\na Django application with this structure: app/static/admin/js/vendor/\n    jquery.js\n    jquery.min.js SyntaxError when installing Django setuptools 5.5.x ¶ When installing Django 1.9 or 1.9.1 with setuptools 5.5.x, you’ll see: Compiling django/conf/app_template/apps.py ... File \"django/conf/app_template/apps.py\" , line 4 class {{ camel_case_app_name }} Config ( AppConfig ) : ^\nSyntaxError: invalid syntax\n\nCompiling django/conf/app_template/models.py ... File \"django/conf/app_template/models.py\" , line 1 {{ unicode_literals }} from django.db import models ^\nSyntaxError: invalid syntax It’s safe to ignore these errors (Django will still install just fine), but you\ncan avoid them by upgrading setuptools to a more recent version. If you’re\nusing pip, you can upgrade pip using python -m pip install -U pip which\nwill also upgrade setuptools . This is resolved in later versions of Django\nas described in the Django 1.9.2 release notes . Miscellaneous ¶ The jQuery static files in contrib.admin have been moved into a vendor/jquery subdirectory. The text displayed for null columns in the admin changelist list_display cells has changed from (None) (or its translated equivalent) to - (a\ndash). django.http.responses.REASON_PHRASES and django.core.handlers.wsgi.STATUS_CODE_TEXT have been removed. Use\nPython’s Standard Library instead: http.client.responses for Python\n3 and httplib.responses for Python 2. ValuesQuerySet and ValuesListQuerySet have been removed. The admin/base.html template no longer sets window.__admin_media_prefix__ or window.__admin_utc_offset__ . Image\nreferences in JavaScript that used that value to construct absolute URLs have\nbeen moved to CSS for easier customization. The UTC offset is stored on a\ndata attribute of the <body> tag. CommaSeparatedIntegerField validation has been refined to forbid values\nlike ',' , ',1' , and '1,,2' . Form initialization was moved from the ProcessFormView.get() method to the new FormMixin.get_context_data() method. This may be\nbackwards incompatible if you have overridden the get_context_data() method without calling super() . Support for PostGIS 1.5 has been dropped. The django.contrib.sites.models.Site.domain field was changed to be unique . In order to enforce test isolation, database queries are not allowed\nby default in SimpleTestCase tests anymore. You\ncan disable this behavior by setting the allow_database_queries class\nattribute to True on your test class. ResolverMatch.app_name was changed to contain the full namespace path in\nthe case of nested namespaces. For consistency with ResolverMatch.namespace , the empty value is now an empty string instead\nof None . For security hardening, session keys must be at least 8 characters. Private function django.utils.functional.total_ordering() has been\nremoved. It contained a workaround for a functools.total_ordering() bug\nin Python versions older than 2.7.3. XML serialization (either through dumpdata or the syndication\nframework) used to output any characters it received. Now if the content to\nbe serialized contains any control characters not allowed in the XML 1.0\nstandard, the serialization will fail with a ValueError . CharField now strips input of leading and trailing\nwhitespace by default. This can be disabled by setting the new strip argument to False . Template text that is translated and uses two or more consecutive percent\nsigns, e.g. \"%%\" , may have a new msgid after makemessages is run\n(most likely the translation will be marked fuzzy). The new msgid will be\nmarked \"#, python-format\" . If neither request.current_app nor Context.current_app are set, the url template tag will now use the namespace of the current request.\nSet request.current_app to None if you don’t want to use a namespace\nhint. The SILENCED_SYSTEM_CHECKS setting now silences messages of all\nlevels. Previously, messages of ERROR level or higher were printed to the\nconsole. The FlatPage.enable_comments field is removed from the FlatPageAdmin as it’s unused by the application. If your project or a third-party app makes\nuse of it, create a custom ModelAdmin to add it back. The return value of setup_databases() and the first\nargument of teardown_databases() changed. They used to be (old_names, mirrors) tuples. Now they’re just\nthe first item, old_names . By default LiveServerTestCase attempts to find an\navailable port in the 8081-8179 range instead of just trying port 8081. The system checks for ModelAdmin now check\ninstances rather than classes. The private API to apply mixed migration plans has been dropped for\nperformance reasons. Mixed plans consist of a list of migrations where some\nare being applied and others are being unapplied. The related model object descriptor classes in django.db.models.fields.related (private API) are moved from the related module to related_descriptors and renamed as follows: ReverseSingleRelatedObjectDescriptor is ForwardManyToOneDescriptor SingleRelatedObjectDescriptor is ReverseOneToOneDescriptor ForeignRelatedObjectsDescriptor is ReverseManyToOneDescriptor ManyRelatedObjectsDescriptor is ManyToManyDescriptor If you implement a custom handler404 view, it must\nreturn a response with an HTTP 404 status code. Use HttpResponseNotFound or pass status=404 to the HttpResponse . Otherwise, APPEND_SLASH won’t\nwork correctly with DEBUG=False . Features deprecated in 1.9 ¶ assignment_tag() ¶ Django 1.4 added the assignment_tag helper to ease the creation of\ntemplate tags that store results in a template variable. The simple_tag() helper has gained this same\nability, making the assignment_tag obsolete. Tags that use assignment_tag should be updated to use simple_tag . {% cycle %} syntax with comma-separated arguments ¶ The cycle tag supports an inferior old syntax from previous Django\nversions: {% cycle row1 , row2 , row3 %} Its parsing caused bugs with the current syntax, so support for the old syntax\nwill be removed in Django 1.10 following an accelerated deprecation. ForeignKey and OneToOneField on_delete argument ¶ In order to increase awareness about cascading model deletion, the on_delete argument of ForeignKey and OneToOneField will be required\nin Django 2.0. Update models and existing migrations to explicitly set the argument. Since the\ndefault is models.CASCADE , add on_delete=models.CASCADE to all ForeignKey and OneToOneField s that don’t use a different option. You\ncan also pass it as the second positional argument if you don’t care about\ncompatibility with older versions of Django. Field.rel changes ¶ Field.rel and its methods and attributes have changed to match the related\nfields API. The Field.rel attribute is renamed to remote_field and many\nof its methods and attributes are either changed or renamed. The aim of these changes is to provide a documented API for relation fields. GeoManager and GeoQuerySet custom methods ¶ All custom GeoQuerySet methods ( area() , distance() , gml() , …)\nhave been replaced by equivalent geographic expressions in annotations (see in\nnew features). Hence the need to set a custom GeoManager to GIS-enabled\nmodels is now obsolete. As soon as your code doesn’t call any of the deprecated\nmethods, you can simply remove the objects = GeoManager() lines from your\nmodels. Template loader APIs have changed ¶ Django template loaders have been updated to allow recursive template\nextending. This change necessitated a new template loader API. The old load_template() and load_template_sources() methods are now deprecated.\nDetails about the new API can be found in the template loader\ndocumentation . Passing a 3-tuple or an app_name to include() ¶ The instance namespace part of passing a tuple as an argument to include() has been replaced by passing the namespace argument to include() . For\nexample: polls_patterns = [ url ( ... ), ] urlpatterns = [ url ( r \"^polls/\" , include (( polls_patterns , \"polls\" , \"author-polls\" ))), ] becomes: polls_patterns = ( [ url ( ... ), ], \"polls\" , ) # 'polls' is the app_name urlpatterns = [ url ( r \"^polls/\" , include ( polls_patterns , namespace = \"author-polls\" )), ] The app_name argument to include() has been replaced by passing a\n2-tuple (as above), or passing an object or module with an app_name attribute (as below). If the app_name is set in this new way, the namespace argument is no longer required. It will default to the value of app_name . For example, the URL patterns in the tutorial are changed from: mysite/urls.py ¶ urlpatterns = [ url ( r \"^polls/\" , include ( \"polls.urls\" , namespace = \"polls\" )), ... ] to: mysite/urls.py ¶ urlpatterns = [ url ( r \"^polls/\" , include ( \"polls.urls\" )), # 'namespace=\"polls\"' removed ... , ] polls/urls.py ¶ app_name = \"polls\" # added urlpatterns = [ ... ] This change also means that the old way of including an AdminSite instance\nis deprecated. Instead, pass admin.site.urls directly to django.conf.urls.url() : urls.py ¶ from django.conf.urls import url from django.contrib import admin urlpatterns = [ url ( r \"^admin/\" , admin . site . urls ), ] URL application namespace required if setting an instance namespace ¶ In the past, an instance namespace without an application namespace\nwould serve the same purpose as the application namespace, but it was\nimpossible to reverse the patterns if there was an application namespace\nwith the same name. Includes that specify an instance namespace require that\nthe included URLconf sets an application namespace. current_app parameter to contrib.auth views ¶ All views in django.contrib.auth.views have the following structure: def view(request, ..., current_app=None, ...):\n\n    ...\n\n    if current_app is not None:\n        request.current_app = current_app\n\n    return TemplateResponse(request, template_name, context) As of Django 1.8, current_app is set on the request object. For\nconsistency, these views will require the caller to set current_app on the request instead of passing it in a separate argument. django.contrib.gis.geoip ¶ The django.contrib.gis.geoip2 module supersedes django.contrib.gis.geoip . The new module provides a similar API except that\nit doesn’t provide the legacy GeoIP-Python API compatibility methods. Miscellaneous ¶ The weak argument to django.dispatch.signals.Signal.disconnect() has\nbeen deprecated as it has no effect. The check_aggregate_support() method of django.db.backends.base.BaseDatabaseOperations has been deprecated and\nwill be removed in Django 2.0. The more general check_expression_support() should be used instead. django.forms.extras is deprecated. You can find SelectDateWidget in django.forms.widgets (or simply django.forms ) instead. Private API django.db.models.fields.add_lazy_relation() is deprecated. The django.contrib.auth.tests.utils.skipIfCustomUser() decorator is\ndeprecated. With the test discovery changes in Django 1.6, the tests for django.contrib apps are no longer run as part of the user’s project.\nTherefore, the @skipIfCustomUser decorator is no longer needed to\ndecorate tests in django.contrib.auth . If you customized some error handlers , the view\nsignatures with only one request parameter are deprecated. The views should\nnow also accept a second exception positional parameter. The django.utils.feedgenerator.Atom1Feed.mime_type and django.utils.feedgenerator.RssFeed.mime_type attributes are deprecated in\nfavor of content_type . Signer now issues a warning if an invalid\nseparator is used. This will become an exception in Django 1.10. django.db.models.Field._get_val_from_obj() is deprecated in favor of Field.value_from_object() . django.template.loaders.eggs.Loader is deprecated as distributing\napplications as eggs is not recommended. The callable_obj keyword argument to SimpleTestCase.assertRaisesMessage() is deprecated. Pass the callable as\na positional argument instead. The allow_tags attribute on methods of ModelAdmin has been\ndeprecated. Use format_html() , format_html_join() , or mark_safe() when constructing the method’s\nreturn value instead. The enclosure keyword argument to SyndicationFeed.add_item() is\ndeprecated. Use the new enclosures argument which accepts a list of Enclosure objects instead of a single one. The django.template.loader.LoaderOrigin and django.template.base.StringOrigin aliases for django.template.base.Origin are deprecated. Features removed in 1.9 ¶ These features have reached the end of their deprecation cycle and are removed\nin Django 1.9. See Features deprecated in 1.7 for details, including how to\nremove usage of these features. django.utils.dictconfig is removed. django.utils.importlib is removed. django.utils.tzinfo is removed. django.utils.unittest is removed. The syncdb command is removed. django.db.models.signals.pre_syncdb and django.db.models.signals.post_syncdb is removed. Support for allow_syncdb on database routers is removed. Automatic syncing of apps without migrations is removed. Migrations are\ncompulsory for all apps unless you pass the migrate --run-syncdb option. The SQL management commands for apps without migrations, sql , sqlall , sqlclear , sqldropindexes , and sqlindexes , are removed. Support for automatic loading of initial_data fixtures and initial SQL\ndata is removed. All models need to be defined inside an installed application or declare an\nexplicit app_label . Furthermore, it isn’t\npossible to import them before their application is loaded. In particular, it\nisn’t possible to import models inside the root package of an application. The model and form IPAddressField is removed. A stub field remains for\ncompatibility with historical migrations. AppCommand.handle_app() is no longer supported. RequestSite and get_current_site() are no longer importable from django.contrib.sites.models . FastCGI support via the runfcgi management command is removed. django.utils.datastructures.SortedDict is removed. ModelAdmin.declared_fieldsets is removed. The util modules that provided backwards compatibility are removed: django.contrib.admin.util django.contrib.gis.db.backends.util django.db.backends.util django.forms.util ModelAdmin.get_formsets is removed. The backward compatible shims introduced to rename the BaseMemcachedCache._get_memcache_timeout() method to get_backend_timeout() is removed. The --natural and -n options for dumpdata are removed. The use_natural_keys argument for serializers.serialize() is removed. Private API django.forms.forms.get_declared_fields() is removed. The ability to use a SplitDateTimeWidget with DateTimeField is\nremoved. The WSGIRequest.REQUEST property is removed. The class django.utils.datastructures.MergeDict is removed. The zh-cn and zh-tw language codes are removed. The internal django.utils.functional.memoize() is removed. django.core.cache.get_cache is removed. django.db.models.loading is removed. Passing callable arguments to querysets is no longer possible. BaseCommand.requires_model_validation is removed in favor of requires_system_checks . Admin validators is replaced by admin checks. The ModelAdmin.validator_class and default_validator_class attributes\nare removed. ModelAdmin.validate() is removed. django.db.backends.DatabaseValidation.validate_field is removed in\nfavor of the check_field method. The validate management command is removed. django.utils.module_loading.import_by_path is removed in favor of django.utils.module_loading.import_string . ssi and url template tags are removed from the future template\ntag library. django.utils.text.javascript_quote() is removed. Database test settings as independent entries in the database settings,\nprefixed by TEST_ , are no longer supported. The cache_choices option to ModelChoiceField and ModelMultipleChoiceField is removed. The default value of the RedirectView.permanent attribute has changed from True to False . django.contrib.sitemaps.FlatPageSitemap is removed in favor of django.contrib.flatpages.sitemaps.FlatPageSitemap . Private API django.test.utils.TestTemplateLoader is removed. The django.contrib.contenttypes.generic module is removed.", "keywords": ["simple_tag", "users", "feed", "exceptionreporterfilter.get_request_repr", "degradation", "feature", "request.get_host", "gml", "storage", "contrib.admin", "pattern", "formset", "login", "modeladmin.validate", "iterables", "messages", "relatedmanager.set", "available_apps", "related_id", "ssi", "404s", "get_bound_field", "corruption", "library", "django.views.i18n.set_language", "field", "#", "foreignrelatedobjectsdescriptor", "relation", "raster", "record", "serialization", "eggs", "migrations", "terminal", "user.first_name", "brokenlinkemailsmiddleware", "setups", "validate_unicode_slug", "emails", "host", "setters", "lookaround", "representation", "range", "config", "transforms", "lines", "django.db.models", "httpresponse", "wsgirequest", "cache", "compatibility", "doubt", "august", "modelmultiplechoicefield", "cached_db", "django.http.build_request_repr", "change", "databaseoperations.datetime_cast_date_sql", "https", "emailvalidator", "links", "suite", "default_validator_class", "hook", "remote_user", "valueslistqueryset", "asvar", "compiling", "http", "changes", "geomanager", "=", "allow_syncdb", "results", "sqlmigrate", "connection.queries", "engine", "message", "resolvermatch.app_name", "language_name_translated", "process_response", "permissiondenied", "self.assertredirects(response", "subquery", "character", "django.contrib.admindocs", "django.forms.util", "tag", "filesystem", "django.contrib.auth.decorators", "httpresponsenotfound", "zones", "pip", "openlayers", "genericforeignkey", "height", "silences", "process", "places", "reuse", "debug", "httpresponseforbidden", "formmixin.get_context_data", "separator", "geolite2", "django.conf.urls.url", "autoescape", "type", "django.contrib.flatpages.sitemaps", "custom", "objects", "documentation", "lookups", "maxmind", "file", "cells", "root_urlconf", "customization", "gdalraster", "bulk_create", "modules", "improvement", "syntaxerror", "django.contrib.sitemaps", "user", "httpresponse.status_code", "django.views.i18n.javascript_catalog", "mistakes", "cases", "django.contrib.admin.util", "handler404", "permission_required", "--no", "--fake", "annotations", "js", "attribute", "helper", "states", "django.contrib.gis", "userpassestestmixin", "lazyobject", "warning", "size", "django.db.models.signals.post_syncdb", "handle_no_permission", "icons", "url/", "time", "forwardmanytoonedescriptor", "tags", "workaround", "save", "signatures", "jquery", "date", "render", "setting", "startapp", "responses", "app_label", "hour", "polls", "transform", "field.default", "minor", "password", "enclosures", "iterator", "userattributesimilarityvalidator", "uris", "django.core.cache.backends.base", "name", "signs", "parameter", "django.views.decorators.cache.never_cache", "format_html_join", "feeds", "rule", "django.core.validators.int_list_validator", "as_view", "cyrillic", "backends", "reference", "web", "django.contrib.auth", "issue", "versions", "greeting", "accessmixin", "projection", "queries", "get_current_site", "notification", "xgettext", "simpletestcase", "configurations", "dst", "manager", "django.contrib.admin", "selectdatewidget", "addresses", "return", "handlers", "applications", "deletion", "self.request", "memory", "tutorial", "expressions", "transitions", "format_html", "use_tz", "order_with_respect_to", "december", "reason_phrase", "isolation", "app_name", "kinds", "django.utils.dictconfig", "srid", "datetimefield", "callables", "store", "commonmiddleware", "/admin/<app>/<model>/<pk>/", "order_fields", "django.contrib.sites.models", "databasecreation._clone_test_db", "status", "aliases", "json_dumps_params", "leap", "proxy", "model.save", "url", "error", "conditions", "module", "code", "base.html", "1.9.2", "bulk", "pages", "filter", "false", "behavior", "info", "access", "class", "display", "migration", "discovery", "i", "request.current_app", "django.db.backends.util", "modeladmin.get_formsets", "latin", "redirection", "django.forms.forms.get_declared_fields", "connection.features.supports_timezones", "widget", "returns", "names", "javascript", "django.utils.importlib", "pbkdf2", "years", "force_login", "request", "formatting", "past", "database", "flag", "output", "input", "lower", "signal", "takes_context", "awareness", "query", "page", "test", "commands", "postgresql", "add_to_builtins", "count", "migrate", "strings", "subclass", "admin", "creation", "scripts", "silenced_system_checks", "loggers", "django.contrib.auth.views.password_reset", "usage", "adapter", "django.db.models.fields.add_lazy_relation", "xml", "configuration", "script", "step", "frame", "django.core.cache.get_cache", "added", "gif", "django.contrib.sites", "validation", "context.update", "converter", "persistentremoteusermiddleware", "upload_to", "instantiation", "1.x", "django.utils.timezone.make_aware", "stringorigin", "section", "validator", "geoqueryset", "source", "cn", "spanish", "managing", "row3", "css", "use", "querying", "dbshell", "origin", "author", "a", "numericpasswordvalidator", "django.contrib.auth.base_user", "engines", "gettext", "performance", "releases", "django.db.models.loading", "app_template", "core", "handler403", "bots", "operation", "order", "commonpasswordvalidator", "default", "params", "related_descriptors", "check_aggregate_support", "loader", "ioerror", "django.contrib.auth.tests.utils.skipifcustomuser", "alias", "atom", "upper", "bug", "requestsite", "form", "signals", "enclosure", "prefix", "dash", "option", "properties", "format", "httplib.responses", "classes", "help", "tests", "characters", "expression", "process_exception", "csrf_trusted_origins", "percent", "comma", "get_or_set", "current_app", "entry.objects.filter(pub_date__month__gt=6", "django.utils.module_loading.import_by_path", "initial_data", "mail_admins", "basedatabaseoperations", "date_extract_sql", "browsers", "timezone", "relatedmodel", "area", "supports", "django.conf.global_settings", "scheme", "adapters", "contrib.auth", "admin.site.urls", "extra_email_context", "geoip", "be@latin", "exceptionreporter.get_traceback_text", "loaderorigin", "combination", "template", "builds", "rss", "load_template", "header", "onetoonefield", "manyrelatedobjectsdescriptor", "traceback", "mysite", "way", "internet", "console", "django.contrib.auth.views", "gdal", "super", "checks", "can_introspect_default", "index", "builtins", "syndication", "implicit", "transactionnow", "validate", "rounds", "party", "raise_exception", "status_code", "september", "queryset", "session", "requires_system_checks", "¶", "command", "internationalization", "django.db.backends.postgresql", "post", "parameters", "modelchoicefield", "admindocs", "jquery.min.js", "allow_tags", "integers", "get_context_data", "property", "side", "caller", "--output", "gaelic", "content", "function", "django.template.loader", "views", "result", "sqlclear", "view", "django.security", "django.contrib.sessions", "control", "zone", "atom1feed.mime_type", "number", "yui", "view(request", "jsonfield", "autoescaping", "permissions", "relations", "modelform", "def", "--noinput", "datetimes", "values", "reversemanytoonedescriptor", "field_order", "polls.urls", "generic", "django.http.responses", "django.contrib", "string", "queryset.bulk_create", "loops", "_", "urls.py", "windows", "aggregate", "timeline", "django.utils.module_loading.import_string", "model.delete", "row2", "rssfeed.mime_type", "favor", "databases", "databasefeatures.can_clone_databases", "managers", "hand", "setup_databases", "check_expression_support", "libraries", "location", "zh", "django.template.base.add_to_builtins", "language", "models", "dates", "copy", "querysets", "ipv6", "version", "basecache", "prefixes", "json", "plans", "p.m", "level", "contents", "resolvermatch.namespace", "auth_password_validators", "loading", "testtemplateloader", "timeuntil", "gis", "view_initkwargs", "width", "image", "labels", "namespace", "deprecation", "remote_field", "portion", "django", "series", "csrf_header_name", "flatpageadmin", "rfc", "n’t", "gt", "locationheaderfix", "fields", "liveservertestcase", "dumpdata", "languages", "reverseonetoonedescriptor", "set", "gdalraster.warp", "os", "view_class", "db", "practice", "urlpatterns", "value", "events", "legacy", "jsonresponse", "django.utils.feedgenerator", "line", "codes", "columns", "implementation", "browser", "data", "resources", "item", "mixins", "httprequest.get_port", "strip", "old_names", "build_absolute_uri", "setuptools", "backend", "guide", "hardening", "json.dumps", "inline", "queryset.update", "assertions", "add", "list_display", "disallowed_user_agents", "security", "django.utils.functional.total_ordering", "self", "need", "instance", "affects", "permissionrequiredmixin", "uri", "databaseoperations.datetime_cast_sql", "localization", "aggregation", "output_field", "makemessages", "djangotemplates", "initialization", "django.contrib.syndication", "reversesinglerelatedobjectdescriptor", "levels", "field._get_val_from_obj", "interface", "consequence", "readability", "django.utils.tzinfo", "validators", "field.value_from_object", "serializers.serialize", "exploit", "modeladmin", "functionality", "unicode", "paginator.page_range", "bugs", "assertredirects", "png", "ipaddressfield", "^admin/", "decorator", "row1", "obsolete", "constructor", "rangefield.contained_by", "descriptor", "instances", "syncing", "signer", "structure", "screens", "part", "fixtures", "merges", "agents", "object", "references", "load", "camel_case_app_name", "templatedoesnotexist", "teardown_databases", "couple", "domain", "valueerror", "sqldropindexes", "django.utils.datastructures", "httprequest", "charfield", "management", "manytomanyfield", "response", "context.current_app", "django.contrib.auth.hashers", "loaders", "namespaces", "sql", "whitespace", "syncdb", "reprojection", "requests", "httpresponse.reason_phrase", "braces", "compilemessages", "situations", "rendering", "keyword", "singlerelatedobjectdescriptor", "minute", "self.request.user", "s", "csrf", "5.5.x", "child", "logger", "parallelization", "abstractbaseuser", "conversion", "csrf_cookie_domain", "others", "app_directories", "variables", "rules", "check_field", "decorators", "root", "integration", "django.forms.widgets", "inclusion_tag", "notes", "hours", "redirect", "life", "mirrors", "effect", "django.contrib.contenttypes", "system", "practices", "port", "inheritance", "apps", "runfcgi", "django.db.backends", "egg", "changelist", "conf", "sessionstore", "adminsite.each_context", "modeladmin.declared_fieldsets", "permission_denied_message", "rasterfield", "keep_parents", "s.", "widgets", "routers", "escape", "field_value", "removal", "headers", "sorteddict", "processes", "target", "param", "check", "features", "forms", "site", "consistency", "queryset.distinct", "apache", "django.template.base", "’s", "window.__admin_media_prefix", "django.views.i18n.json_catalog", "referer", "addition", "lists", "example", "care", "explorer", "app", "hooks", "progress", "func", "django.contrib.gis.geoip2", "use_natural_keys", "i18n", "requirements", "parallel", "column", "convert_<type", "list", "namespace=\"polls", "django.utils.functional.memoize", "minimumlengthvalidator", "orm", "processformview.get", "field.rel", "utc", "runserver", "ie8", "parsing", "upstream", "hasher", "unicode_literals", "email", "steps", "stack", "starting", "-u", "gdalraster.transform", "flatpage.enable_comments", "variable", "model", "cms", "reasons", "apis", "extending", "application", "actions", "attributes", "loginrequiredmixin", "pollsconfig", "django.db.models.signals.pre_syncdb", "slugfield", "picker", "django.contrib.auth.password_validation", "release", "ability", "differences", "cursor.execute(sql", "redirects", "variants", "timefield", "urlconf", "databaseoperations.value_to_db_<type", "databaseoperations.get_db_converters", "related_id__in", "svg", "translation", "syntax", "subdirectory", "allow_database_queries", "repr(request", "r", "circumstances", "default_app_config", "timesince", "django.contrib.gis.db.backends.util", "databaseoperations.time_extract_sql", "content_type", "converters", "keys", "case", "equivalent", "django.forms.extras", "length", "experience", "lookup", "authentication", "assignment", "flatpagesitemap", "aim", "indexing", "runtime", "html", "errors", "polls.apps", "tuple", "sqlindexes", "arguments", "queryset.delete", "lt", "django.conf.urls", "passwords", "package", "precomputation", "static", "middleware", "xss", "one", "catalog", "postmortem", "stub", "end", "generation", "translations", "entries", "sqlite", "cache_choices", "startproject", "mod_scgi", "tuples", "verbosity", "tw", "adminsite", "amount", "grade", "bar", "assignment_tag", "make_aware", "standard", "polls_patterns", "get_language_info", "path", "firstof", "functions", "slugs", "key", "appconfig", "update", "none", "filters", "problem", "bcryptsha256passwordhasher", "method_decorator", "patterns", "durationfield", "logging", "framework", "caches", "manytomanydescriptor", "django.test.utils", "true", "on_commit", "templateresponse", "urls", "storage.get_valid_name", "api", "support", "description", "splitdatetimewidget", "apps.py", "projects", "mode", "styling", "django.db.backends.postgresql_psycopg2", "hint", "-", "django.db.backends.base", "basememcachedcache._get_memcache_timeout", "django.utils", "context", "conditional_escape", "cycle", "permission", "offset", "files", "squashmigrations", "blocktrans", "import", "d", "admins", "iteration", "mergedict", "demand", "directory", "%", "defaults", "mysql", "call", "foreignkey", "avg", "attempts", "information", "images", "in", "python", "shims", "syndicationfeed.add_item", "functools.partial", "methods", "basecommand.requires_model_validation", "baseusermanager", "options", "times", "exception", "purpose", "client", "vendor", "details", "method", "verification", "settings", "transaction", "argument", "body", "scottish", "tasks", "databasecreation.get_test_db_clone_settings", "oracle", "spans", "databasevalidation.validate_field", "callable_obj", "mark_safe", "fastcgi", "design", "distance", "templates", "sendtestemail", "text", "django.db.models.fields.related", "project", "exceptions"], "type": "documentation"},
{"title": "PostgreSQL specific database functions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/functions/", "content": "PostgreSQL specific database functions ¶ All of these functions are available from the django.contrib.postgres.functions module. RandomUUID ¶ class RandomUUID [source] ¶ Returns a version 4 UUID. On PostgreSQL < 13, the pgcrypto extension must be installed. You can use\nthe CryptoExtension migration\noperation to install it. Usage example: >>> from django.contrib.postgres.functions import RandomUUID >>> Article . objects . update ( uuid = RandomUUID ()) TransactionNow ¶ class TransactionNow [source] ¶ Returns the date and time on the database server that the current transaction\nstarted. If you are not in a transaction it will return the date and time of\nthe current statement. This is a complement to django.db.models.functions.Now , which returns the date and time of the\ncurrent statement. Note that only the outermost call to atomic() sets up a transaction and thus sets the time that TransactionNow() will\nreturn; nested calls create savepoints which do not affect the transaction\ntime. Usage example: >>> from django.contrib.postgres.functions import TransactionNow >>> Article . objects . filter ( published__lte = TransactionNow ()) <QuerySet [<Article: How to Django>]>", "keywords": ["server", "complement", "uuid", "import", "article", "django.db.models.functions", "calls", "objects", "published__lte", "usage", "cryptoextension", "call", "django", "module", "=", "extension", "operation", "filter", "pgcrypto", "class", "example", "migration", "functions", "transactionnow", "queryset", "transaction", "returns", "¶", "time", "django.contrib.postgres.functions", "source", "date", "database", "atomic", "savepoints", "statement", "randomuuid", "postgresql", "version"], "type": "documentation"},
{"title": "Advice for new contributors | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/internals/contributing/new-contributors/", "content": "Advice for new contributors ¶ New contributor and not sure what to do? Want to help but just don’t know how\nto get started? This is the section for you. Get up and running! If you are new to contributing to Django, the Writing your first contribution for Django tutorial will give you an introduction to the tools and the workflow. This page contains more general advice on ways you can contribute to Django,\nand how to approach that. If you are looking for a reference on the details of making code contributions,\nsee the Contributing code documentation. First steps ¶ Start with these steps to discover Django’s development process. Triage tickets ¶ If an unreviewed ticket reports a bug, try and reproduce it. If you can\nreproduce it and it seems valid, make a note that you confirmed the bug and\naccept the ticket. Make sure the ticket is filed under the correct component\narea. Consider writing a patch that adds a test for the bug’s behavior, even if\nyou don’t fix the bug itself. See more at How can I help with triaging? Review patches of accepted tickets ¶ This will help you build familiarity with the codebase and processes. Mark the\nappropriate flags if a patch needs docs or tests. Look through the changes a\npatch makes, and keep an eye out for syntax that is incompatible with older but\nstill supported versions of Python. Run the tests and make sure they pass.\nWhere possible and relevant, try them out on a database other than SQLite.\nLeave comments and feedback! Keep old patches up-to-date ¶ Oftentimes the codebase will change between a patch being submitted and the\ntime it gets reviewed. Make sure it still applies cleanly and functions as\nexpected. Updating a patch is both useful and important! See more on Submitting contributions . Write some documentation ¶ Django’s documentation is great but it can always be improved. Did you find a\ntypo? Do you think that something should be clarified? Go ahead and suggest a\ndocumentation patch! See also the guide on Writing documentation . Note The reports page contains links to many useful Trac queries, including\nseveral that are useful for triaging tickets and reviewing patches as\nsuggested above. Sign the Contributor License Agreement ¶ The code that you write belongs to you or your employer. If your contribution\nis more than one or two lines of code, you need to sign the CLA . See the Contributor License Agreement FAQ for a more thorough explanation. Guidelines ¶ As a newcomer on a large project, it’s easy to experience frustration. Here’s\nsome advice to make your work on Django more useful and rewarding. Pick a subject area ¶ This should be something that you care about, that you are familiar with or\nthat you want to learn about. You don’t already have to be an expert on the\narea you want to work on; you become an expert through your ongoing\ncontributions to the code. Analyze tickets’ context and history ¶ Trac isn’t an absolute; the context is just as important as the words. When\nreading Trac, you need to take into account who says things, and when they were\nsaid. Support for an idea two years ago doesn’t necessarily mean that the idea\nwill still have support. You also need to pay attention to who hasn’t spoken\n– for example, if an experienced contributor hasn’t been recently involved in\na discussion, then a ticket may not have the support required to get into\nDjango. Start small ¶ It’s easier to get feedback on a little issue than on a big one. See the easy pickings . Confirm support before engaging in a big task ¶ This means getting someone else to confirm that a bug is real before you fix\nthe issue, and ensuring that there’s consensus on a proposed feature before you\ngo implementing it. Be bold! Leave feedback! ¶ Sometimes it can be scary to put your opinion out to the world and say “this\nticket is correct” or “this patch needs work”, but it’s the only way the\nproject moves forward. The contributions of the broad Django community\nultimately have a much greater impact than that of any one person. We can’t do\nit without you ! Be cautious when marking things “Ready For Check-in” ¶ If you’re really not certain if a ticket is ready, don’t mark it as such. Leave\na comment instead, letting others know your thoughts. If you’re mostly certain,\nbut not completely certain, you might also try asking on the #contributing-getting-started channel in the Django Discord server to\nsee if someone else can confirm your suspicions. Wait for feedback, and respond to feedback that you receive ¶ Focus on one or two tickets, see them through from start to finish, and repeat.\nThe shotgun approach of taking on lots of tickets and letting some fall by the\nwayside ends up doing more harm than good. Be rigorous ¶ When we say “ PEP 8 , and must have docs and tests”, we mean it. If a patch\ndoesn’t have docs and tests, there had better be a good reason. Arguments like\n“I couldn’t find any existing tests of this feature” don’t carry much weight.\nWhile it may be true, that means you have the extra-important job of writing\nthe very first tests for that feature, not that you get a pass from writing\ntests altogether. Be patient ¶ It’s not always easy for your ticket or your patch to be reviewed quickly. This\nisn’t personal. There are a lot of tickets and pull requests to get through. Keeping your patch up to date is important. Review the ticket on Trac to ensure\nthat the Needs tests , Needs documentation , and Patch needs improvement flags are unchecked once you’ve addressed all review comments. Remember that Django has an eight-month release cycle, so there’s plenty of\ntime for your patch to be reviewed. Finally, a well-timed reminder can help. See contributing code FAQ for ideas here.", "keywords": ["ideas", "feature", "lot", "processes", "guidelines", "pickings", "check", "code", "lots", "absolute", "behavior", "example", "shotgun", "wayside", "month", "frustration", "contributions", "attention", "years", "typo", "database", "community", "steps", "lines", "opinion", "history", "page", "test", "oftentimes", "ways", "contributor", "words", "needs", "idea", "links", "approach", "django", "changes", "release", "n’t", "development", "advice", "finish", "plenty", "syntax", "weight", "contributors", "section", "fall", "expert", "discussion", "component", "channel", "pep", "process", "employer", "guide", "task", "patch", "person", "job", "suspicions", "server", "arguments", "introduction", "explanation", "thoughts", "one", "documentation", "sqlite", "pass", "work", "improvement", "functions", "bug", "comment", "start", "feedback", "familiarity", "docs", "triage", "tests", "newcomer", "consensus", "tickets", "time", "workflow", "reason", "discord", "date", "new", "contributing", "faq", "account", "area", "support", "patches", "things", "ticket", "cla", "context", "cycle", "trac", "eye", "triaging", "flags", "world", "requests", "way", "impact", "codebase", "reference", "harm", "python", "issue", "versions", "comments", "queries", "focus", "details", "others", "license", "reports", "¶", "note", "agreement", "reminder", "tutorial", "tools", "contribution", "review", "project"], "type": "documentation"},
{"title": "Django 1.10 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.10/", "content": "Django 1.10 release notes ¶ August 1, 2016 Welcome to Django 1.10! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 1.9 or older versions. We’ve dropped some features that have reached the end\nof their deprecation cycle, and we’ve begun the deprecation process for\nsome features . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Python compatibility ¶ Like Django 1.9, Django 1.10 requires Python 2.7, 3.4, or 3.5. We highly\nrecommend and only officially support the latest release of each series. What’s new in Django 1.10 ¶ Full text search for PostgreSQL ¶ django.contrib.postgres now includes a collection of database\nfunctions to allow the use of the full text\nsearch engine. You can search across multiple fields in your relational\ndatabase, combine the searches with other lookups, use different language\nconfigurations and weightings, and rank the results by relevance. It also now includes trigram support, using the trigram_similar lookup, and the TrigramSimilarity and TrigramDistance expressions. New-style middleware ¶ A new style of middleware is introduced to\nsolve the lack of strict request/response layering of the old-style of\nmiddleware described in DEP 0005 .\nYou’ll need to adapt old, custom middleware and\nswitch from the MIDDLEWARE_CLASSES setting to the new MIDDLEWARE setting to take advantage of the improvements. Official support for Unicode usernames ¶ The User model in django.contrib.auth originally only accepted ASCII letters and numbers in usernames. Although it\nwasn’t a deliberate choice, Unicode characters have always been accepted when\nusing Python 3. The username validator now explicitly accepts Unicode characters by\ndefault on Python 3 only. Custom user models may use the new ASCIIUsernameValidator or UnicodeUsernameValidator . Minor features ¶ django.contrib.admin ¶ For sites running on a subpath, the default URL for the \"View site\" link at the top of each admin page\nwill now point to request.META['SCRIPT_NAME'] if set, instead of / . The success message that appears after adding or editing an object now\ncontains a link to the object’s change form. All inline JavaScript is removed so you can enable the Content-Security-Policy HTTP header if you wish. The new InlineModelAdmin.classes attribute allows specifying\nclasses on inline fieldsets. Inlines with a collapse class will be\ninitially collapsed and their header will have a small “show” link. If a user doesn’t have the add permission, the object-tools block on a\nmodel’s changelist will now be rendered (without the add button). This makes\nit easier to add custom tools in this case. The LogEntry model now stores change\nmessages in a JSON structure so that the message can be dynamically translated\nusing the current active language. A new LogEntry.get_change_message() method is now the preferred way of retrieving the change message. Selected objects for fields in ModelAdmin.raw_id_fields now have a link\nto object’s change form. Added “No date” and “Has date” choices for DateFieldListFilter if the\nfield is nullable. The jQuery library embedded in the admin is upgraded from version 2.1.4 to\n2.2.3. django.contrib.auth ¶ Added support for the Argon2 password hash . It’s\nrecommended over PBKDF2, however, it’s not the default as it requires a\nthird-party library. The default iteration count for the PBKDF2 password hasher has been increased\nby 25%. This backwards compatible change will not affect users who have\nsubclassed django.contrib.auth.hashers.PBKDF2PasswordHasher to change the\ndefault value. The django.contrib.auth.views.logout() view sends “no-cache” headers\nto prevent an issue where Safari caches redirects and prevents a user from\nbeing able to log out. Added the optional backend argument to django.contrib.auth.login() to allow using it without credentials. The new LOGOUT_REDIRECT_URL setting controls the redirect of the django.contrib.auth.views.logout() view, if the view doesn’t get a next_page argument. The new redirect_authenticated_user parameter for the django.contrib.auth.views.login() view allows redirecting\nauthenticated users visiting the login page. The new AllowAllUsersModelBackend and AllowAllUsersRemoteUserBackend ignore\nthe value of User.is_active , while ModelBackend and RemoteUserBackend now reject inactive\nusers. django.contrib.gis ¶ Distance lookups now accept expressions as the\ndistance value parameter. The new GEOSGeometry.unary_union property computes the\nunion of all the elements of this geometry. Added the GEOSGeometry.covers() binary predicate. Added the GDALBand.statistics() method and mean and std attributes. Added support for the MakeLine aggregate and GeoHash function on SpatiaLite. Added support for the Difference , Intersection , and SymDifference functions on MySQL. Added support for instantiating empty GEOS geometries. The new trim and precision properties\nof WKTWriter allow controlling\noutput of the fractional part of the coordinates in WKT. Added the LineString.closed and MultiLineString.closed properties. The GeoJSON serializer now outputs the\nprimary key of objects in the properties dictionary if specific fields\naren’t specified. The ability to replicate input data on the GDALBand.data() method was added. Band data can\nnow be updated with repeated values efficiently. Added database functions IsValid and MakeValid , as well as the isvalid lookup, all for PostGIS. This allows filtering and\nrepairing invalid geometries on the database side. Added raster support for all spatial lookups . django.contrib.postgres ¶ For convenience, HStoreField now\ncasts its keys and values to strings. django.contrib.sessions ¶ The clearsessions management command now removes file-based\nsessions. django.contrib.sites ¶ The Site model now supports natural keys . django.contrib.staticfiles ¶ The static template tag now uses django.contrib.staticfiles if it’s in INSTALLED_APPS . This is especially useful for third-party apps\nwhich can now always use {% load static %} (instead of {% load staticfiles %} or {% load static from staticfiles %} ) and\nnot worry about whether or not the staticfiles app is installed. You can more easily customize the collectstatic --ignore option with a custom AppConfig . Cache ¶ The file-based cache backend now uses the highest pickling protocol. CSRF ¶ The default CSRF_FAILURE_VIEW , views.csrf.csrf_failure() now\naccepts an optional template_name parameter, defaulting to '403_csrf.html' , to control the template used to render the page. To protect against BREACH attacks, the CSRF protection mechanism now\nchanges the form token value on every request (while keeping an invariant\nsecret which can be used to validate the different tokens). Database backends ¶ Temporal data subtraction was unified on all backends. If the database supports it, backends can set DatabaseFeatures.can_return_ids_from_bulk_insert=True and implement DatabaseOperations.fetch_returned_insert_ids() to set primary keys\non objects created using QuerySet.bulk_create() . Added keyword arguments to the as_sql() methods of various expressions\n( Func , When , Case , and OrderBy ) to allow database backends to\ncustomize them without mutating self , which isn’t safe when using\ndifferent database backends. See the arg_joiner and **extra_context parameters of Func.as_sql() for an\nexample. File Storage ¶ Storage backends now present a timezone-aware API with new methods get_accessed_time() , get_created_time() , and get_modified_time() . They return a\ntimezone-aware datetime if USE_TZ is True and a naive datetime in the local timezone otherwise. The new Storage.generate_filename() method makes it easier\nto implement custom storages that don’t use the os.path calls previously\nin FileField . Forms ¶ Form and widget Media is now served using django.contrib.staticfiles if installed. The <input> tag rendered by CharField now includes\na minlength attribute if the field has a min_length . Required form fields now have the required HTML attribute. Set the new Form.use_required_attribute attribute to False to disable it. The required attribute isn’t\nincluded on forms of formsets because the browser validation may not be\ncorrect when adding and deleting formsets. Generic Views ¶ The View class can now be imported from django.views . Internationalization ¶ The i18n_patterns() helper function can now be\nused in a root URLConf specified using request.urlconf . By setting the new prefix_default_language parameter for i18n_patterns() to False , you can allow\naccessing the default language without a URL prefix. set_language() now returns a 204 status code (No\nContent) for AJAX requests when there is no next parameter in POST or GET . The JavaScriptCatalog and JSONCatalog class-based views supersede the\ndeprecated javascript_catalog() and json_catalog() function-based\nviews. The new views are almost equivalent to the old ones except that by\ndefault the new views collect all JavaScript strings in the djangojs translation domain from all installed apps rather than only the JavaScript\nstrings from LOCALE_PATHS . Management Commands ¶ call_command() now returns the value returned\nfrom the command.handle() method. The new check --fail-level option allows specifying the message\nlevel that will cause the command to exit with a non-zero status. The new makemigrations --check option makes the command exit\nwith a non-zero status when model changes without migrations are detected. makemigrations now displays the path to the migration files that\nit generates. The shell --interface option now accepts python to force use of\nthe “plain” Python interpreter. The new shell --command option lets you run a command as Django and\nexit, instead of opening the interactive shell. Added a warning to dumpdata if a proxy model is specified (which\nresults in no output) without its concrete parent. The new BaseCommand.requires_migrations_checks attribute\nmay be set to True if you want your command to print a warning, like runserver does, if the set of migrations on disk don’t match the\nmigrations in the database. To assist with testing, call_command() now\naccepts a command object as the first argument. The shell command supports tab completion on systems using libedit , e.g. macOS. The inspectdb command lets you choose what tables should be\ninspected by specifying their names as arguments. Migrations ¶ Added support for serialization of enum.Enum objects. Added the elidable argument to the RunSQL and RunPython operations to allow them\nto be removed when squashing migrations. Added support for non-atomic migrations by\nsetting the atomic attribute on a Migration . The migrate and makemigrations commands now check for a\nconsistent migration history . If they find\nsome unapplied dependencies of an applied migration, InconsistentMigrationHistory is raised. The pre_migrate() and post_migrate() signals now dispatch their\nmigration plan and apps . Models ¶ Reverse foreign keys from proxy models are now propagated to their\nconcrete class. The reverse relation attached by a ForeignKey pointing to a proxy model is now\naccessible as a descriptor on the proxied model class and may be referenced in\nqueryset filtering. The new Field.rel_db_type() method returns the database column data type for fields such as ForeignKey and OneToOneField that point to another field. The arity class attribute is added to Func . This attribute can be used to set the number\nof arguments the function accepts. Added BigAutoField which acts much like an AutoField except that it is guaranteed\nto fit numbers from 1 to 9223372036854775807 . QuerySet.in_bulk() may be called without any arguments to return all objects in the queryset. related_query_name now supports\napp label and class interpolation using the '%(app_label)s' and '%(class)s' strings. Allowed overriding model fields inherited from abstract base classes. The prefetch_related_objects() function is now a\npublic API. QuerySet.bulk_create() sets the primary key on objects when using PostgreSQL. Added the Cast database function. A proxy model may now inherit multiple proxy models that share a common\nnon-abstract parent class. Added Extract functions to extract\ndatetime components as integers, such as year and hour. Added Trunc functions to truncate a date\nor datetime to a significant component. They enable queries like\nsales-per-day or sales-per-hour. Model.__init__() now sets values of virtual fields from its keyword\narguments. The new Meta.base_manager_name and Meta.default_manager_name options allow controlling\nthe _base_manager and _default_manager , respectively. Requests and Responses ¶ Added request.user to the debug view. Added HttpResponse methods readable() and seekable() to make an instance a\nstream-like object and allow wrapping it with io.TextIOWrapper . Added the HttpRequest.content_type and content_params attributes which are\nparsed from the CONTENT_TYPE header. The parser for request.COOKIES is simplified to better match the behavior\nof browsers. request.COOKIES may now contain cookies that are invalid\naccording to RFC 6265 but are possible to set via document.cookie . Serialization ¶ The django.core.serializers.json.DjangoJSONEncoder now knows how to\nserialize lazy strings, typically used for translatable content. Templates ¶ Added the autoescape option to the DjangoTemplates backend and the Engine class. Added the is and is not comparison operators to the if tag. Allowed dictsort to order a list of lists by an element at a\nspecified index. The debug() context processor\ncontains queries for all database aliases instead of only the default alias. Added relative path support for string arguments of the extends and include template tags. Tests ¶ To better catch bugs, TestCase now checks deferrable\ndatabase constraints at the end of each test. Tests and test cases can be marked with tags and run selectively with the new test --tag and test --exclude-tag options. You can now login and use sessions with the test client even if django.contrib.sessions is not in INSTALLED_APPS . URLs ¶ An addition in django.setup() allows URL resolving that happens\noutside of the request/response cycle (e.g. in management commands and\nstandalone scripts) to take FORCE_SCRIPT_NAME into account when it\nis set. Validators ¶ URLValidator now limits the length of\ndomain name labels to 63 characters and the total length of domain\nnames to 253 characters per RFC 1034 . int_list_validator() now accepts an optional allow_negative boolean parameter, defaulting to False , to allow\nnegative integers. Backwards incompatible changes in 1.10 ¶ Warning In addition to the changes outlined in this section, be sure to review the Features removed in 1.10 for the features that have reached the end of\ntheir deprecation cycle and therefore been removed. If you haven’t updated\nyour code within the deprecation timeline for a given feature, its removal\nmay appear as a backwards incompatible change. Database backend API ¶ GIS’s AreaField uses an unspecified underlying numeric type that could in\npractice be any numeric Python type. decimal.Decimal values retrieved\nfrom the database are now converted to float to make it easier to combine\nthem with values used by the GIS libraries. In order to enable temporal subtraction you must set the supports_temporal_subtraction database feature flag to True and\nimplement the DatabaseOperations.subtract_temporals() method. This\nmethod should return the SQL and parameters required to compute the\ndifference in microseconds between the lhs and rhs arguments in the\ndatatype used to store DurationField . select_related() prohibits non-relational fields for nested relations ¶ Django 1.8 added validation for non-relational fields in select_related() : >>> Book . objects . select_related ( \"title\" ) Traceback (most recent call last): ... FieldError : Non-relational field given in select_related: 'title' But it didn’t prohibit nested non-relation fields as it does now: >>> Book . objects . select_related ( \"author__name\" ) Traceback (most recent call last): ... FieldError : Non-relational field given in select_related: 'name' _meta.get_fields() returns consistent reverse fields for proxy models ¶ Before Django 1.10, the get_fields() method returned different reverse fields when called on a proxy model compared\nto its proxied concrete class. This inconsistency was fixed by returning the\nfull set of fields pointing to a concrete class or one of its proxies in both\ncases. AbstractUser.username max_length increased to 150 ¶ A migration for django.contrib.auth.models.User.username is included.\nIf you have a custom user model inheriting from AbstractUser , you’ll need\nto generate and apply a database migration for your user model. We considered an increase to 254 characters to more easily allow the use of\nemail addresses (which are limited to 254 characters) as usernames but rejected\nit due to a MySQL limitation.  When using the utf8mb4 encoding (recommended\nfor proper Unicode support), MySQL can only create unique indexes with 191\ncharacters by default. Therefore, if you need a longer length, please use a\ncustom user model. If you want to preserve the 30 character limit for usernames, use a custom form\nwhen creating a user or changing usernames: from django.contrib.auth.forms import UserCreationForm class MyUserCreationForm ( UserCreationForm ): username = forms . CharField ( max_length = 30 , help_text = \"Required. 30 characters or fewer. Letters, digits and @/./+/-/_ only.\" , ) If you wish to keep this restriction in the admin, set UserAdmin.add_form to use this form: from django.contrib.auth.admin import UserAdmin as BaseUserAdmin from django.contrib.auth.models import User class UserAdmin ( BaseUserAdmin ): add_form = MyUserCreationForm admin . site . unregister ( User ) admin . site . register ( User , UserAdmin ) Dropped support for PostgreSQL 9.1 ¶ Upstream support for PostgreSQL 9.1 ends in September 2016. As a consequence,\nDjango 1.10 sets PostgreSQL 9.2 as the minimum version it officially supports. runserver output goes through logging ¶ Request and response handling of the runserver command is sent to the django.server logger instead of to sys.stderr . If you\ndisable Django’s logging configuration or override it with your own, you’ll\nneed to add the appropriate logging configuration if you want to see that\noutput: LOGGING = { # ... \"formatters\" : { \"django.server\" : { \"()\" : \"django.utils.log.ServerFormatter\" , \"format\" : \"[ %(server_time)s ] %(message)s \" , } }, \"handlers\" : { \"django.server\" : { \"level\" : \"INFO\" , \"class\" : \"logging.StreamHandler\" , \"formatter\" : \"django.server\" , }, }, \"loggers\" : { \"django.server\" : { \"handlers\" : [ \"django.server\" ], \"level\" : \"INFO\" , \"propagate\" : False , } }, } auth.CustomUser and auth.ExtensionUser test models were removed ¶ Since the introduction of migrations for the contrib apps in Django 1.8, the\ntables of these custom user test models were not created anymore making them\nunusable in a testing context. Apps registry is no longer auto-populated when unpickling models outside of Django ¶ The apps registry is no longer auto-populated when unpickling models. This was\nadded in Django 1.7.2 as an attempt to allow unpickling models outside of\nDjango, such as in an RQ worker, without calling django.setup() , but it\ncreates the possibility of a deadlock. To adapt your code in the case of RQ,\nyou can provide your own worker script that calls django.setup() . Removed null assignment check for non-null foreign key fields ¶ In older versions, assigning None to a non-nullable ForeignKey or OneToOneField raised ValueError('Cannot assign None: \"model.field\" does not allow null values.') . For consistency with other model fields which don’t\nhave a similar check, this check is removed. Removed weak password hashers from the default PASSWORD_HASHERS setting ¶ Django 0.90 stored passwords as unsalted MD5. Django 0.91 added support for\nsalted SHA1 with automatic upgrade of passwords when a user logs in. Django 1.4\nadded PBKDF2 as the default password hasher. If you have an old Django project with MD5 or SHA1 (even salted) encoded\npasswords, be aware that these can be cracked fairly easily with today’s\nhardware. To make Django users acknowledge continued use of weak hashers, the\nfollowing hashers are removed from the default PASSWORD_HASHERS setting: \"django.contrib.auth.hashers.SHA1PasswordHasher\" \"django.contrib.auth.hashers.MD5PasswordHasher\" \"django.contrib.auth.hashers.UnsaltedSHA1PasswordHasher\" \"django.contrib.auth.hashers.UnsaltedMD5PasswordHasher\" \"django.contrib.auth.hashers.CryptPasswordHasher\" Consider using a wrapped password hasher to\nstrengthen the hashes in your database. If that’s not feasible, add the PASSWORD_HASHERS setting to your project and add back any hashers\nthat you need. You can check if your database has any of the removed hashers like this: from django.contrib.auth import get_user_model User = get_user_model () # Unsalted MD5/SHA1: User . objects . filter ( password__startswith = \"md5$$\" ) User . objects . filter ( password__startswith = \"sha1$$\" ) # Salted MD5/SHA1: User . objects . filter ( password__startswith = \"md5$\" ) . exclude ( password__startswith = \"md5$$\" ) User . objects . filter ( password__startswith = \"sha1$\" ) . exclude ( password__startswith = \"sha1$$\" ) # Crypt hasher: User . objects . filter ( password__startswith = \"crypt$$\" ) from django.db.models import CharField from django.db.models.functions import Length CharField . register_lookup ( Length ) # Unsalted MD5 passwords might not have an 'md5$$' prefix: User . objects . filter ( password__length = 32 ) Field.get_prep_lookup() and Field.get_db_prep_lookup() methods are removed ¶ If you have a custom field that implements either of these methods, register a\ncustom lookup for it. For example: from django.db.models import Field from django.db.models.lookups import Exact class MyField ( Field ): ... class MyFieldExact ( Exact ): def get_prep_lookup ( self ): # do_custom_stuff_for_myfield ... MyField . register_lookup ( MyFieldExact ) django.contrib.gis ¶ Support for SpatiaLite < 3.0 and GEOS < 3.3 is dropped. The add_postgis_srs() backwards compatibility alias for django.contrib.gis.utils.add_srs_entry() is removed. On Oracle/GIS, the Area aggregate function now returns a float instead of decimal.Decimal .\n(It’s still wrapped in a measure of square meters.) The default GEOSGeometry representation (WKT\noutput) is trimmed by default. That is, instead of POINT (23.0000000000000000 5.5000000000000000) , you’ll get POINT (23 5.5) . Maximum size of a request body and the number of GET/POST parameters is limited ¶ Two new settings help mitigate denial-of-service attacks via large requests: DATA_UPLOAD_MAX_MEMORY_SIZE limits the size that a request body\nmay be. File uploads don’t count toward this limit. DATA_UPLOAD_MAX_NUMBER_FIELDS limits the number of GET/POST\nparameters that are parsed. Applications that receive unusually large form posts may need to tune these\nsettings. Miscellaneous ¶ The repr() of a QuerySet is wrapped in <QuerySet > to\ndisambiguate it from a plain list when debugging. utils.version.get_version() returns PEP 440 compliant release\ncandidate versions (e.g. ‘1.10rc1’ instead of ‘1.10c1’). CSRF token values are now required to be strings of 64 alphanumerics; values\nof 32 alphanumerics, as set by older versions of Django by default, are\nautomatically replaced by strings of 64 characters. Other values are\nconsidered invalid. This should only affect developers or users who replace\nthese tokens. The LOGOUT_URL setting is removed as Django hasn’t made use of it\nsince pre-1.0. If you use it in your project, you can add it to your\nproject’s settings. The default value was '/accounts/logout/' . Objects with a close() method such as files and generators passed to HttpResponse are now closed immediately instead of when\nthe WSGI server calls close() on the response. A redundant transaction.atomic() call in QuerySet.update_or_create() is removed. This may affect query counts tested by TransactionTestCase.assertNumQueries() . Support for skip_validation in BaseCommand.execute(**options) is\nremoved. Use skip_checks (added in Django 1.7) instead. loaddata now raises a CommandError instead of showing a\nwarning when the specified fixture file is not found. Instead of directly accessing the LogEntry.change_message attribute, it’s\nnow better to call the LogEntry.get_change_message() method which will\nprovide the message in the current language. The default error views now raise TemplateDoesNotExist if a nonexistent template_name is specified. The unused choices keyword argument of the Select and SelectMultiple widgets’ render() method is removed. The choices argument of the render_options() method is also removed, making selected_choices the first argument. Tests that violate deferrable database constraints will now error when run on\na database that supports deferrable constraints. Built-in management commands now use indexing of keys in options , e.g. options['verbosity'] , instead of options.get() and no longer perform\nany type coercion. This could be a problem if you’re calling commands using Command.execute() (which bypasses the argument parser that sets a default\nvalue) instead of call_command() . Instead of\ncalling Command.execute() , pass the command object as the first argument\nto call_command() . ModelBackend and RemoteUserBackend now reject inactive\nusers. This means that inactive users can’t login and will be logged\nout if they are switched from is_active=True to False . If you need\nthe previous behavior, use the new AllowAllUsersModelBackend or AllowAllUsersRemoteUserBackend in AUTHENTICATION_BACKENDS instead. In light of the previous change, the test client’s login() method no longer always rejects inactive\nusers but instead delegates this decision to the authentication backend. force_login() also delegates the decision to the\nauthentication backend, so if you’re using the default backends, you need to\nuse an active user. django.views.i18n.set_language() may now return a 204 status code for\nAJAX requests. The base_field attribute of RangeField is now a type of field,\nnot an instance of a field.  If you have created a custom subclass of RangeField , you should change the base_field attribute. Middleware classes are now initialized when the server starts rather than\nduring the first request. If you override is_authenticated() or is_anonymous() in a custom user\nmodel, you must convert them to attributes or properties as described in the deprecation note . When using ModelAdmin.save_as=True , the “Save as new” button now\nredirects to the change view for the new object instead of to the model’s\nchangelist. If you need the previous behavior, set the new ModelAdmin.save_as_continue attribute to False . Required form fields now have the required HTML attribute. Set the Form.use_required_attribute attribute to False to disable it. You could also add the novalidate attribute to <form> if you don’t want browser validation. To disable\nthe required attribute on custom widgets, override the Widget.use_required_attribute() method. The WSGI handler no longer removes content of responses from HEAD requests or responses with a status_code of 100-199, 204, or 304. Most\nweb servers already implement this behavior. Responses retrieved using the\nDjango test client continue to have these “response fixes” applied. Model.__init__() now receives django.db.models.DEFERRED as the value\nof deferred fields. The Model._deferred attribute is removed as dynamic model classes when\nusing QuerySet.defer() and only() is removed. Storage.save() no longer\nreplaces '\\' with '/' . This behavior is moved to FileSystemStorage since this is a storage\nspecific implementation detail. Any Windows user with a custom storage\nimplementation that relies on this behavior will need to implement it in the\ncustom storage’s save() method. Private FileField methods get_directory_name() and get_filename() are no longer called (and are now deprecated) which is\na backwards incompatible change for users overriding those methods on custom\nfields. To adapt such code, override FileField.generate_filename() or Storage.generate_filename() instead. It\nmight be possible to use upload_to also. The subject of mail sent by AdminEmailHandler is no longer truncated at\n989 characters. If you were counting on a limited length, truncate the subject\nyourself. Private expressions django.db.models.expressions.Date and DateTime are removed. The new Trunc expressions\nprovide the same functionality. The _base_manager and _default_manager attributes are removed from\nmodel instances. They remain accessible on the model class. Accessing a deleted field on a model instance, e.g. after del obj.field ,\nreloads the field’s value instead of raising AttributeError . If you subclass AbstractBaseUser and override clean() , be sure it\ncalls super() . AbstractBaseUser.normalize_username() is called in\na new AbstractBaseUser.clean() method. Private API django.forms.models.model_to_dict() returns a queryset rather\nthan a list of primary keys for ManyToManyField s. If django.contrib.staticfiles is\ninstalled, the static template tag uses the staticfiles storage\nto construct the URL rather than simply joining the value with STATIC_ROOT . The new approach encodes the URL, which could be\nbackwards-incompatible in cases such as including a fragment in a path, e.g. {% static 'img.svg#fragment' %} , since the # is encoded as %23 .\nTo adapt, move the fragment outside the template tag: {% static 'img.svg' %}#fragment . When USE_L10N is True , localization is now applied for the date and time filters when no format string is\nspecified. The DATE_FORMAT and TIME_FORMAT specifiers from the active\nlocale are used instead of the settings of the same name. Features deprecated in 1.10 ¶ Direct assignment to a reverse foreign key or many-to-many relation ¶ Instead of assigning related objects using direct assignment: >>> new_list = [ obj1 , obj2 , obj3 ] >>> e . related_set = new_list Use the set() method\nadded in Django 1.9: >>> e . related_set . set ([ obj1 , obj2 , obj3 ]) This prevents confusion about an assignment resulting in an implicit save. Non-timezone-aware Storage API ¶ The old, non-timezone-aware methods accessed_time() , created_time() ,\nand modified_time() are deprecated in favor of the new get_*_time() methods. Third-party storage backends should implement the new methods and mark the old\nones as deprecated. Until then, the new get_*_time() methods on the base Storage class convert datetime s from\nthe old methods as required and emit a deprecation warning as they do so. Third-party storage backends may retain the old methods as long as they\nwish to support earlier versions of Django. django.contrib.gis ¶ The get_srid() and set_srid() methods of GEOSGeometry are deprecated in favor\nof the srid property. The get_x() , set_x() , get_y() , set_y() , get_z() , and set_z() methods of Point are deprecated\nin favor of the x , y , and z properties. The get_coords() and set_coords() methods of Point are deprecated in favor of the tuple property. The cascaded_union property of MultiPolygon is deprecated in favor of the unary_union property. The django.contrib.gis.utils.precision_wkt() function is deprecated in\nfavor of WKTWriter . CommaSeparatedIntegerField model field ¶ CommaSeparatedIntegerField is deprecated in favor of CharField with the validate_comma_separated_integer_list() validator: from django.core.validators import validate_comma_separated_integer_list from django.db import models class MyModel ( models . Model ): numbers = models . CharField ( ... , validators = [ validate_comma_separated_integer_list ]) If you’re using Oracle, CharField uses a different database field  type\n( NVARCHAR2 ) than CommaSeparatedIntegerField ( VARCHAR2 ). Depending\non your database settings, this might imply a different encoding, and thus a\ndifferent length (in bytes) for the same contents. If your stored values are\nlonger than the 4000 byte limit of NVARCHAR2 , you should use TextField ( NCLOB ) instead. In this case, if you have any queries that group by the\nfield (e.g. annotating the model with an aggregation or using distinct() )\nyou’ll need to change them (to defer the field). Using a model name as a query lookup when default_related_name is set ¶ Assume the following models: from django.db import models class Foo ( models . Model ): pass class Bar ( models . Model ): foo = models . ForeignKey ( Foo ) class Meta : default_related_name = \"bars\" In older versions, default_related_name couldn’t be used as a query lookup. This is fixed and support for the old\nlookup name is deprecated. For example, since default_related_name is set\nin model Bar , instead of using the model name bar as the lookup: >>> bar = Bar . objects . get ( pk = 1 ) >>> Foo . objects . get ( bar = bar ) use the default_related_name bars : >>> Foo . objects . get ( bars = bar ) __search query lookup ¶ The search lookup, which supports MySQL only and is extremely limited in\nfeatures, is deprecated. Replace it with a custom lookup: from django.db import models class Search ( models . Lookup ): lookup_name = \"search\" def as_mysql ( self , compiler , connection ): lhs , lhs_params = self . process_lhs ( compiler , connection ) rhs , rhs_params = self . process_rhs ( compiler , connection ) params = lhs_params + rhs_params return \"MATCH ( %s ) AGAINST ( %s IN BOOLEAN MODE)\" % ( lhs , rhs ), params models . CharField . register_lookup ( Search ) models . TextField . register_lookup ( Search ) Using User.is_authenticated() and User.is_anonymous() as methods ¶ The is_authenticated() and is_anonymous() methods of AbstractBaseUser and AnonymousUser classes are now\nproperties. They will still work as methods until Django 2.0, but all usage\nin Django now uses attribute access. For example, if you use AuthenticationMiddleware and want\nto know whether the user is currently logged-in you would use: if request . user . is_authenticated : ... # Do something for logged-in users. else : ... # Do something for anonymous users. instead of request.user.is_authenticated() . This change avoids accidental information leakage if you forget to call the\nmethod, e.g.: if request . user . is_authenticated : return sensitive_information If you override these methods in a custom user model, you must change them to\nproperties or attributes. Django uses a CallableBool object to allow these attributes to work as both\na property and a method. Thus, until the deprecation period ends, you cannot\ncompare these properties using the is operator. That is, the following\nwon’t work: if request . user . is_authenticated is True : ... Custom manager classes available through prefetch_related must define a _apply_rel_filters() method ¶ If you defined a custom manager class available through prefetch_related() you must make sure\nit defines a _apply_rel_filters() method. This method must accept a QuerySet instance\nas its single argument and return a filtered version of the queryset for the\nmodel instance the manager is bound to. The “escape” half of django.utils.safestring ¶ The mark_for_escaping() function and the classes it uses: EscapeData , EscapeBytes , EscapeText , EscapeString , and EscapeUnicode are\ndeprecated. As a result, the “lazy” behavior of the escape filter (where it would\nalways be applied as the last filter no matter where in the filter chain it\nappeared) is deprecated. The filter will change to immediately apply conditional_escape() in Django 2.0. Manager.use_for_related_fields and inheritance changes ¶ Manager.use_for_related_fields is deprecated in favor of setting Meta.base_manager_name on\nthe model. Model Manager inheritance will follow MRO inheritance rules in Django 2.0,\nchanging the current behavior where managers defined on non-abstract base\nclasses aren’t inherited by child classes. A deprecating warning with\ninstructions on how to adapt your code is raised if you have any affected\nmanagers. You’ll either redeclare a manager from an abstract model on the child\nclass to override the manager from the concrete model, or you’ll set the\nmodel’s Meta.manager_inheritance_from_future=True option to opt-in to the\nnew inheritance behavior. During the deprecation period, use_for_related_fields will be honored and\nraise a warning, even if a base_manager_name is set. This allows\nthird-party code to preserve legacy behavior while transitioning to the new\nAPI. The warning can be silenced by setting silence_use_for_related_fields_deprecation=True on the manager. Miscellaneous ¶ The makemigrations --exit option is deprecated in favor of the makemigrations --check option. django.utils.functional.allow_lazy() is deprecated in favor of the new keep_lazy() function which can be used with a\nmore natural decorator syntax. The shell --plain option is deprecated in favor of -i python or --interface python . Importing from the django.core.urlresolvers module is deprecated in\nfavor of its new location, django.urls . The template Context.has_key() method is deprecated in favor of in . The private attribute virtual_fields of Model._meta is\ndeprecated in favor of private_fields . The private keyword arguments virtual_only in Field.contribute_to_class() and virtual in Model._meta.add_field() are deprecated in favor of private_only and private , respectively. The javascript_catalog() and json_catalog() views are deprecated in\nfavor of class-based views JavaScriptCatalog and JSONCatalog . In multi-table inheritance, implicit promotion of a OneToOneField to a parent_link is deprecated. Add parent_link=True to such fields. The private API Widget._format_value() is made public and renamed to format_value() . The old name will work\nthrough a deprecation period. Private FileField methods get_directory_name() and get_filename() are deprecated in favor of performing this work in Storage.generate_filename() ). Old-style middleware that uses settings.MIDDLEWARE_CLASSES are\ndeprecated. Adapt old, custom middleware and\nuse the new MIDDLEWARE setting. Features removed in 1.10 ¶ These features have reached the end of their deprecation cycle and are removed\nin Django 1.10. See Features deprecated in 1.8 for details, including how\nto remove usage of these features. Support for calling a SQLCompiler directly as an alias for calling its quote_name_unless_alias method is removed. The cycle and firstof template tags are removed from the future template tag library. django.conf.urls.patterns() is removed. Support for the prefix argument to django.conf.urls.i18n.i18n_patterns() is removed. SimpleTestCase.urls is removed. Using an incorrect count of unpacked values in the for template tag\nraises an exception rather than failing silently. The ability to reverse() URLs using a dotted Python path\nis removed. The ability to use a dotted Python path for the LOGIN_URL and LOGIN_REDIRECT_URL settings is removed. Support for optparse is dropped for custom management commands. The class django.core.management.NoArgsCommand is removed. django.core.context_processors module is removed. django.db.models.sql.aggregates module is removed. django.contrib.gis.db.models.sql.aggregates module is removed. The following methods and properties of django.db.sql.query.Query are\nremoved: Properties: aggregates and aggregate_select Methods: add_aggregate , set_aggregate_mask , and append_aggregate_mask . django.template.resolve_variable is removed. The following private APIs are removed from django.db.models.options.Options ( Model._meta ): get_field_by_name() get_all_field_names() get_fields_with_model() get_concrete_fields_with_model() get_m2m_with_model() get_all_related_objects() get_all_related_objects_with_model() get_all_related_many_to_many_objects() get_all_related_m2m_objects_with_model() The error_message argument of django.forms.RegexField is removed. The unordered_list filter no longer supports old style lists. Support for string view arguments to url() is removed. The backward compatible shim  to rename django.forms.Form._has_changed() to has_changed() is removed. The removetags template filter is removed. The remove_tags() and strip_entities() functions in django.utils.html is removed. The is_admin_site argument to django.contrib.auth.views.password_reset() is removed. django.db.models.field.subclassing.SubfieldBase is removed. django.utils.checksums is removed. The original_content_type_id attribute on django.contrib.admin.helpers.InlineAdminForm is removed. The backwards compatibility shim to allow FormMixin.get_form() to be\ndefined with no default value for its form_class argument is removed. The following settings are removed, and you must upgrade to the TEMPLATES setting: ALLOWED_INCLUDE_ROOTS TEMPLATE_CONTEXT_PROCESSORS TEMPLATE_DEBUG TEMPLATE_DIRS TEMPLATE_LOADERS TEMPLATE_STRING_IF_INVALID The backwards compatibility alias django.template.loader.BaseLoader is\nremoved. Django template objects returned by get_template() and select_template() no longer accept a Context in their render() method. Template response APIs enforce the use of dict and backend-dependent template objects instead of Context and Template respectively. The current_app parameter for the following function and classes is\nremoved: django.shortcuts.render() django.template.Context() django.template.RequestContext() django.template.response.TemplateResponse() The dictionary and context_instance parameters for the following\nfunctions are removed: django.shortcuts.render() django.shortcuts.render_to_response() django.template.loader.render_to_string() The dirs parameter for the following functions is removed: django.template.loader.get_template() django.template.loader.select_template() django.shortcuts.render() django.shortcuts.render_to_response() Session verification is enabled regardless of whether or not 'django.contrib.auth.middleware.SessionAuthenticationMiddleware' is in MIDDLEWARE_CLASSES . SessionAuthenticationMiddleware no longer has\nany purpose and can be removed from MIDDLEWARE_CLASSES . It’s kept as\na stub until Django 2.0 as a courtesy for users who don’t read this note. Private attribute django.db.models.Field.related is removed. The --list option of the migrate management command is removed. The ssi template tag is removed. Support for the = comparison operator in the if template tag is\nremoved. The backwards compatibility shims to allow Storage.get_available_name() and Storage.save() to be defined without a max_length argument are\nremoved. Support for the legacy %(<foo>)s syntax in ModelFormMixin.success_url is removed. GeoQuerySet aggregate methods collect() , extent() , extent3d() , make_line() , and unionagg() are removed. The ability to specify ContentType.name when creating a content type\ninstance is removed. Support for the old signature of allow_migrate is removed. Support for the syntax of {% cycle %} that uses comma-separated arguments\nis removed. The warning that Signer issued when given an\ninvalid separator is now a ValueError .", "keywords": ["users", "minlength", "dep", "streamhandler", "safari", "selected_choices", "allow_migrate", "feature", "user.is_authenticated", "django.shortcuts.render_to_response", "storage", "commanderror", "get_concrete_fields_with_model", "login", "textiowrapper", "searches", "relational", "django.conf.urls.patterns", "messages", "model.__init", "formsets", "ssi", "content_params", "baseloader", "library", "django.views.i18n.set_language", "field", "#", "javascriptcatalog", "unsaltedmd5passwordhasher", "fielderror", "relation", "raster", "serialization", "private_fields", "migrations", "django.forms", "new_list", "datatype", "cascaded_union", "numbers", "stores", "img.svg#fragment", "lhs", "add_aggregate", "representation", "mro", "trim", "django.db.models", "httpresponse", "rhs", "match", "cache", "compatibility", "abstractuser", "sha1", "get_fields_with_model", "august", "clearsessions", "asciiusernamevalidator", "silence_use_for_related_fields_deprecation", "change", "databaseoperations.subtract_temporals", "django.urls", "django.db.sql.query", "arity", "is_authenticated", "label", "shim", "storage.generate_filename", "http", "hash", "changes", "=", "results", "context_instance", "head", "engine", "stream", "message", "get_created_time", "request.urlconf", "crypt", "shell", "character", "model.field", "letters", "call_command", "date_format", "callablebool", "tables", "tag", "button", "process", "dictsort", "separator", "debug", "default_manager", "choice", "supports_temporal_subtraction", "options['verbosity", "collection", "get_field_by_name", "mark_for_escaping", "get_y", "autoescape", "following", "type", "data_upload_max_memory_size", "get_*_time", "required", "filefield", "crypt$$", "subpath", "custom", "calls", "unsalted", "objects", "django.contrib.gis.db.models.sql.aggregates", "lookups", "file", "queryset.defer", "work", "unsaltedsha1passwordhasher", "urlvalidator", "utf8mb4", "user", "subtraction", "fragment", "cases", "django.utils.html", "attribute", "helper", "django.db.models.sql.aggregates", "django.contrib.gis", "mechanism", "warning", "size", "constraints", "developers", "makeline", "queryset.update_or_create", "inlinemodeladmin.classes", "modeladmin.save_as_continue", "time", "tags", "get_m2m_with_model", "save", "date", "jquery", "httprequest.content_type", "render", "setting", "responses", "operators", "components", "account", "hour", "set_language", "proxies", "customuser", "service", "widget._format_value", "minor", "password", "name", "render_options", "makemigrations", "interpreter", "parameter", "candidate", "field.get_prep_lookup", "backends", "min_length", "django.contrib.auth", "issue", "web", "upgrade", "versions", "interpolation", "parent_link", "djangojsonencoder", "queries", "set_coords", "specifiers", "configurations", "author__name", "manager", "django.contrib.admin", "resolving", "addresses", "z", "reverse", "handlers", "applications", "operator", "expressions", "foo", "use_tz", "search", "parent", "textfield", "fieldsets", "exact", "geosgeometry.unary_union", "mymodel", "get_fields", "django.contrib.staticfiles", "validate_comma_separated_integer_list", "username", "courtesy", "status", "aliases", "dirs", "pre_migrate", "plan", "server_time)s", "proxy", "url", "libedit", "error", "geometry", "get_coords", "module", "code", "secret", "period", "auth", "replaces", "post_migrate", "postgis", "style", "false", "behavior", "link", "class", "migration", "info", "filter", "access", "group", "show", "django.core.context_processors", "get_modified_time", "widget", "names", "javascript", "extra_context", "x", "compiler", "login_url", "pbkdf2", "app_label)s", "force_login", "request", "database", "block", "output", "flag", "input", "django.utils.checksums", "model._meta.add_field", "query", "page", "test", "commands", "postgresql", "use_l10n", "count", "migrate", "baseuseradmin", "strings", "elements", "register_lookup", "subclass", "get_all_field_names", "admin", "scripts", "gdalband.data", "loggers", "usage", "registry", "help_text", "wsgi", "trigram", "databasefeatures.can_return_ids_from_bulk_insert", "javascript_catalog", "configuration", "limit", "script", "base_manager_name", "max_length", "apply_rel_filters", "form.use_required_attribute", "django.contrib.sites", "makevalid", "validation", "useradmin.add_form", "upload_to", "pointing", "formatters", "field.get_db_prep_lookup", "e", "sessionauthenticationmiddleware", "section", "validator", "cast", "django.conf.urls.i18n.i18n_patterns", "geoqueryset", "basecommand.requires_migrations_checks", "django.setup", "component", "mail", "django.template.loader.get_template", "transaction.atomic", "get_filename", "use", "model._meta", "filefield.generate_filename", "credentials", "myusercreationform", "static_root", "adminemailhandler", "--plain", "queryset.in_bulk", "protection", "trigramdistance", "modeladmin.raw_id_fields", "deprecating", "pass", "weightings", "order", "document.cookie", "signature", "params", "default", "allowallusersmodelbackend", "escapedata", "choices", "alias", "middleware_classes", "form", "signals", "multipolygon", "prefix", "select_template", "option", "properties", "format", "strip_entities", "classes", "characters", "tests", "set_x", "django.template.loader.render_to_string", "comma", "datefieldlistfilter", "set_srid", "virtual_fields", "jsoncatalog", "day", "current_app", "meters", "worker", "browsers", "fixture", "storage.get_available_name", "timezone", "area", "advantage", "convenience", "get_all_related_m2m_objects_with_model", "remoteuserbackend", "attempt", "chain", "original_content_type_id", "serverformatter", "rhs_params", "limitation", "template", "--exclude", "deadlock", "aggregates", "header", "onetoonefield", "traceback", "way", "useradmin", "django.contrib.postgres", "data_upload_max_number_fields", "servers", "template_name", "remove_tags", "index", "macos", "microseconds", "possibility", "class)s", "party", "september", "completion", "queryset", "status_code", "basecommand.execute(**options", "session", "¶", "trigramsimilarity", "command", "varchar2", "bytes", "internationalization", "django.contrib.auth.views.login", "parameters", "post", "disk", "precision", "integers", "django.template.response", "escapestring", "property", "side", "base_manager", "content", "function", "ends", "django.template.loader", "protocol", "views", "testing", "result", "view", "float", "contenttype.name", "django.contrib.sessions", "enum", "indexes", "command.handle", "extent", "number", "django.forms.models.model_to_dict", "measure", "relations", "def", "point", "django.shortcuts.render", "values", "staticfiles", "get_srid", "string", "queryset.bulk_create", "_", "modeladmin.save_as", "windows", "rq", "django.db.models.expressions", "aggregate", "timeline", "geosgeometry.covers", "geojson", "favor", "auto", "sqlcompiler", "managers", "inlines", "libraries", "coercion", "logout_url", "language", "subject", "unary_union", "models", "history", "meta.base_manager_name", "escapetext", "exit", "version", "level", "json", "anonymoususer", "contents", "processor", "sensitive_information", "gis", "labels", "cryptpasswordhasher", "deprecation", "areafield", "add_postgis_srs", "parser", "password__length", "django", "series", "regexfield", "nvarchar2", "redirect_authenticated_user", "rfc", "n’t", "sales", "fields", "modelbackend", "commaseparatedintegerfield", "dumpdata", "password_hashers", "fixes", "set", "hardware", "override", "book", "csrf_failure_view", "practice", "value", "media", "legacy", "wkt", "get_all_related_many_to_many_objects", "policy", "related_query_name", "wktwriter", "data", "browser", "myfield", "pep", "implementation", "handler", "predicate", "datetime", "base", "backend", "guide", "trigram_similar", "inline", "runsql", "add", "standalone", "security", "django.contrib.auth.views.logout", "as_sql", "self", "instance", "command.execute", "meta.default_manager_name", "promotion", "today", "localization", "djangotemplates", "geometries", "aggregation", "trunc", "accessed_time", "handling", "consequence", "set_aggregate_mask", "unicodeusernamevalidator", "validators", "django.server", "extent3d", "unicode", "functionality", "modified_time", "bugs", "form_class", "logout_redirect_url", "logentry.get_change_message", "decorator", "formmixin.get_form", "prefix_default_language", "digits", "descriptor", "sha1$$", "instances", "field.contribute_to_class", "signer", "structure", "alphanumerics", "inheriting", "i18n_patterns", "inconsistency", "authenticationmiddleware", "django.db.models.options", "django.template", "part", "filesystemstorage", "django.core.urlresolvers", "object", "load", "templatedoesnotexist", "extensionuser", "domain", "--check", "valueerror", "symdifference", "counts", "charfield", "quote_name_unless_alias", "response", "management", "manytomanyfield", "django.contrib.auth.hashers", "collapse", "sql", "lookup_name", "instructions", "requests", "locale", "tokens", "keyword", "escapebytes", "views.csrf.csrf_failure", "csrf", "io", "func.as_sql", "django.utils.log", "logger", "child", "logentry", "abstractbaseuser", "top", "rules", "root", "location", "notes", "redirect", "removetags", "runpython", "intersection", "request.user", "1.10c1", "detail", "apps", "403_csrf.html", "storage.save", "inheritance", "inlineadminform", "no", "django.contrib.admin.helpers", "changelist", "filtering", "spatialite", "dependencies", "obj2", "welcome", "keep_lazy", "django.db.models.lookups", "loaddata", "s.", "storages", "widgets", "escape", "base_field", "removal", "serializer", "json_catalog", "usernames", "decimal", "headers", "autofield", "check", "difference", "djangojs", "features", "site", "forms", "consistency", "set_y", "get_accessed_time", "uploads", "do_custom_stuff_for_myfield", "addition", "lists", "example", "add_form", "denial", "transactiontestcase.assertnumqueries", "app", "geosgeometry", "unordered_list", "func", "modelformmixin.success_url", "column", "int_list_validator", "list", "unregister", "locale_paths", "related_set", "user.is_anonymous", "default_related_name", "runserver", "usercreationform", "format_value", "get_x", "upstream", "manager.use_for_related_fields", "hasher", "email", "created_time", "abstractuser.username", "django.utils.functional.allow_lazy", "md5", "model", "--ignore", "databaseoperations.fetch_returned_insert_ids", "hashes", "unionagg", "year", "apis", "systems", "element", "django.db.models.functions", "confusion", "encoding", "django.core.validators", "relevance", "get_user_model", "django.contrib.auth.models", "skip_validation", "attributes", "obj3", "approach", "meta.get_fields", "formatter", "testcase", "make_line", "title", "release", "ability", "redirects", "get_all_related_objects_with_model", "isvalid", "gdalband.statistics", "os.path", "widget.use_required_attribute", "y", "geos", "as_mysql", "translation", "syntax", "deferrable", "restriction", "select", "subfieldbase", "prefetch_related_objects", "get_prep_lookup", "ones", "get_z", "coordinates", "keys", "case", "attributeerror", "boolean", "length", "authentication", "lookup", "assignment", "django.core.serializers.json", "indexing", "md5$$", "clean", "html", "utils.version.get_version", "generators", "tuple", "server", "arguments", "introduction", "lhs_params", "passwords", "static", "light", "middleware", "stub", "foo>)s", "end", "geohash", "improvements", "increase", "contrib", "comparison", "obj.field", "selectmultiple", "user.is_active", "decision", "bar", "get_template", "extract", "nclob", "path", "firstof", "functions", "key", "--fail", "hashers", "operations", "success", "appconfig", "django.contrib.auth.forms", "convert", "inspectdb", "none", "filters", "problem", "meta", "get", "durationfield", "logging", "set_z", "leakage", "true", "templateresponse", "get_all_related_objects", "\\", "urls", "hstorefield", "api", "sessions", "posts", "support", "django.contrib.gis.utils.precision_wkt", "cookies", "mode", "django.contrib.gis.utils.add_srs_entry", "connection", "escapeunicode", "django.views", "noargscommand", "context", "conditional_escape", "cycle", "permission", "layering", "files", "import", "simpletestcase.urls", "field.rel_db_type", "iteration", "rangefield", "mysql", "%", "union", "call", "foreignkey", "distinct", "information", "in", "python", "bigautofield", "bars", "requestcontext", "methods", "options", "extends", "exception", "purpose", "client", "-i", "force_script_name", "assume", "details", "method", "breach", "django.db", "settings", "half", "argument", "django.contrib.auth.models.user.username", "verification", "del", "note", "sites", "body", "oracle", "attacks", "tools", "band", "distance", "templates", "pre-1.0", "lack", "img.svg", "text", "orderby", "project"], "type": "documentation"},
{"title": "How to install Django | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/install/", "content": "How to install Django ¶ This document will get you up and running with Django. Install Python ¶ Django is a Python web framework. See What Python version can I use with Django? for\ndetails. Get the latest version of Python at https://www.python.org/downloads/ or with\nyour operating system’s package manager. Python on Windows If you are just starting with Django and using Windows, you may find How to install Django on Windows useful. Install Apache and mod_wsgi ¶ If you just want to experiment with Django, skip ahead to the next\nsection; Django includes a lightweight web server you can use for\ntesting, so you won’t need to set up Apache until you’re ready to\ndeploy Django in production. If you want to use Django on a production site, use Apache with mod_wsgi . mod_wsgi operates in one of two modes: embedded\nmode or daemon mode. In embedded mode, mod_wsgi is similar to\nmod_perl – it embeds Python within Apache and loads Python code into\nmemory when the server starts. Code stays in memory throughout the\nlife of an Apache process, which leads to significant performance\ngains over other server arrangements. In daemon mode, mod_wsgi spawns\nan independent daemon process that handles requests. The daemon\nprocess can run as a different user than the web server, possibly\nleading to improved security. The daemon process can be restarted\nwithout restarting the entire Apache web server, possibly making\nrefreshing your codebase more seamless. Consult the mod_wsgi\ndocumentation to determine which mode is right for your setup. Make\nsure you have Apache installed with the mod_wsgi module activated.\nDjango will work with any version of Apache that supports mod_wsgi. See How to use Django with mod_wsgi for information on how to configure mod_wsgi once you have it\ninstalled. If you can’t use mod_wsgi for some reason, fear not: Django supports many other\ndeployment options. One is uWSGI ; it works\nvery well with nginx . Additionally, Django follows the WSGI spec\n( PEP 3333 ), which allows it to run on a variety of server platforms. Get your database running ¶ If you plan to use Django’s database API functionality, you’ll need to make\nsure a database server is running. Django supports many different database\nservers and is officially supported with PostgreSQL , MariaDB , MySQL , Oracle and SQLite . If you are developing a small project or something you don’t plan to deploy in\na production environment, SQLite is generally the best option as it doesn’t\nrequire running a separate server. However, SQLite has many differences from\nother databases, so if you are working on something substantial, it’s\nrecommended to develop with the same database that you plan on using in\nproduction. In addition to the officially supported databases, there are backends\nprovided by 3rd parties that allow you to use other\ndatabases with Django. To use another database other than SQLite, you’ll need to make sure that the\nappropriate Python database bindings are installed: If you’re using PostgreSQL, you’ll need the psycopg or psycopg2 package. Refer to the PostgreSQL notes for further\ndetails. If you’re using MySQL or MariaDB, you’ll need a DB API driver like mysqlclient . See notes for the MySQL\nbackend for details. If you’re using SQLite you might want to read the SQLite backend notes . If you’re using Oracle, you’ll need to install oracledb , but please read the notes for the Oracle backend for details regarding\nsupported versions of both Oracle and oracledb . If you’re using an unofficial 3rd party backend, please consult the\ndocumentation provided for any additional requirements. And ensure that the following keys in the 'default' item of the DATABASES dictionary match your database connection settings: ENGINE – Either 'django.db.backends.sqlite3' , 'django.db.backends.postgresql' , 'django.db.backends.mysql' , or 'django.db.backends.oracle' . Other backends are also available . NAME – The name of your database. If you’re using SQLite, the\ndatabase will be a file on your computer. In that case, NAME should be\nthe full absolute path, including the filename of that file. You don’t need\nto create anything beforehand; the database file will be created\nautomatically when needed. The default value, BASE_DIR / 'db.sqlite3' ,\nwill store the file in your project directory. For databases other than SQLite If you are not using SQLite as your database, additional settings such as USER , PASSWORD , and HOST must be added.\nFor more details, see the reference documentation for DATABASES . Also, make sure that you’ve created the database by this point. Do that\nwith “ CREATE DATABASE database_name; ” within your database’s\ninteractive prompt. If you plan to use Django’s manage.py migrate command to automatically\ncreate database tables for your models (after first installing Django and\ncreating a project), you’ll need to ensure that Django has permission to create\nand alter tables in the database you’re using; if you plan to manually create\nthe tables, you can grant Django SELECT , INSERT , UPDATE and DELETE permissions. After creating a database user with these permissions,\nyou’ll specify the details in your project’s settings file, see DATABASES for details. If you’re using Django’s testing framework to test\ndatabase queries, Django will need permission to create a test database. Install the Django code ¶ Installation instructions are slightly different depending on whether you’re\ninstalling a distribution-specific package, downloading the latest official\nrelease, or fetching the latest development version. Installing an official release with pip ¶ This is the recommended way to install Django. Install pip . The easiest is to use the standalone pip installer . If your\ndistribution already has pip installed, you might need to update it if\nit’s outdated. If it’s outdated, you’ll know because installation won’t\nwork. Take a look at venv . This tool provides\nisolated Python environments, which are more practical than installing\npackages systemwide. It also allows installing packages without\nadministrator privileges. The contributing tutorial walks through how to create a virtual environment. After you’ve created and activated a virtual environment, enter the command: /  $ python -m pip install Django ...\\> py -m pip install Django Installing a distribution-specific package ¶ Check the distribution specific notes to see if\nyour platform/distribution provides official Django packages/installers.\nDistribution-provided packages will typically allow for automatic installation\nof dependencies and supported upgrade paths; however, these packages will rarely\ncontain the latest release of Django. Installing the development version ¶ Tracking Django development If you decide to use the latest development version of Django,\nyou’ll want to pay close attention to the development timeline ,\nand you’ll want to keep an eye on the release notes for the\nupcoming release . This will help you stay\non top of any new features you might want to use, as well as any changes\nyou’ll need to make to your code when updating your copy of Django.\n(For stable releases, any necessary changes are documented in the\nrelease notes.) If you’d like to be able to update your Django code occasionally with the\nlatest bug fixes and improvements, follow these instructions: Make sure that you have Git installed and that you can run its commands\nfrom a shell. (Enter git help at a shell prompt to test this.) Check out Django’s main development branch like so: /  $ git clone https://github.com/django/django.git ...\\> git clone https://github.com/django/django.git This will create a directory django in your current directory. Make sure that the Python interpreter can load Django’s code. The most\nconvenient way to do this is to use a virtual environment and pip . The contributing tutorial walks through how to\ncreate a virtual environment. After setting up and activating the virtual environment, run the following\ncommand: /  $ python -m pip install -e django/ ...\\> py -m pip install -e django\\ This will make Django’s code importable, and will also make the django-admin utility command available. In other words, you’re all\nset! When you want to update your copy of the Django source code, run the command git pull from within the django directory. When you do this, Git will\ndownload any changes.", "keywords": ["testing", "production", "permissions", "module", "code", "point", "site", "platforms", "features", "apache", "psycopg", "django.db.backends.oracle", "addition", "manage.py", "windows", "modes", "requirements", "handles", "tracking", "timeline", "venv", "databases", "attention", "parties", "database", "host", "installers", "privileges", "models", "copy", "test", "commands", "postgresql", "version", "migrate", "platform", "words", "py", "tool", "dependencies", "insert", "mod_perl", "django", "wsgi", "changes", "release", "n’t", "differences", "filename", "db.sqlite3", "https://github.com/django/django.git", "engine", "git", "fixes", "installation", "development", "variety", "shell", "db", "operating", "create", "setup", "spec", "value", "tables", "select", "section", "mod_wsgi", "spawns", "branch", "pip", "/", "source", "keys", "case", "pep", "process", "item", "importable", "backend", "look", "https://www.python.org/downloads/", "environment", "server", "django.db.backends.mysql", "security", "package", "driver", "mysqlclient", "paths", "performance", "documentation", "administrator", "releases", "improvements", "file", "sqlite", "nginx", "delete", "work", "default", "user", "path", "functionality", "gains", "bug", "update", "option", "distribution", "help", "packages", "mariadb", "computer", "install", "reason", "framework", "prompt", "uwsgi", "bindings", "daemon", "\\", "api", "mode", "document", "connection", "deployment", "arrangements", "password", "permission", "name", "interpreter", "eye", "mysql", "directory", "dictionary", "instructions", "utility", "requests", "way", "codebase", "information", "backends", "web", "python", "reference", "servers", "upgrade", "versions", "options", "queries", "details", "manager", "party", "oracledb", "top", "django.db.backends.sqlite3", "settings", "notes", "¶", "life", "command", "clone", "django.db.backends.postgresql", "memory", "tutorial", "oracle", "system", "environments", "installer", "project", "base_dir"], "type": "documentation"},
{"title": "FAQ: Installation | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/faq/install/", "content": "FAQ: Installation ¶ How do I get started? ¶ Download the code . Install Django (read the installation guide ). Walk through the tutorial . Check out the rest of the documentation , and ask questions if you\nrun into trouble. What are Django’s prerequisites? ¶ Django requires Python. See the table in the next question for the versions of\nPython that work with each version of Django. Other Python libraries may be\nrequired for some use cases, but you’ll receive an error about them as they’re\nneeded. For a development environment – if you just want to experiment with Django –\nyou don’t need to have a separate web server installed or database server. Django comes with its own lightweight development server .\nFor a production environment, Django follows the WSGI spec, PEP 3333 , which\nmeans it can run on a variety of web servers. See Deploying Django for more information. Django runs SQLite by default, which is included in Python installations.\nFor a production environment, we recommend PostgreSQL ; but we also officially\nsupport MariaDB , MySQL , SQLite , and Oracle . See Supported Databases for more information. What Python version can I use with Django? ¶ Django version Python versions 3.2 3.6, 3.7, 3.8, 3.9, 3.10 (added in 3.2.9) 4.0 3.8, 3.9, 3.10 4.1 3.8, 3.9, 3.10, 3.11 (added in 4.1.3) 4.2 3.8, 3.9, 3.10, 3.11, 3.12 (added in 4.2.8) 5.0 3.10, 3.11, 3.12 5.1 3.10, 3.11, 3.12, 3.13 (added in 5.1.3) For each version of Python, only the latest micro release (A.B.C) is officially\nsupported. You can find the latest micro version for each series on the Python\ndownload page . Typically, we will support a Python version up to and including the first\nDjango LTS release whose security support ends after security support for that\nversion of Python ends. For example, Python 3.9 security support ends in\nOctober 2025 and Django 4.2 LTS security support ends in April 2026. Therefore\nDjango 4.2 is the last version to support Python 3.9. What Python version should I use with Django? ¶ Since newer versions of Python are often faster, have more features, and are\nbetter supported, the latest version of Python 3 is recommended. You don’t lose anything in Django by using an older release, but you don’t take\nadvantage of the improvements and optimizations in newer Python releases.\nThird-party applications for use with Django are free to set their own version\nrequirements. Should I use the stable version or development version? ¶ Generally, if you’re using code in production, you should be using a\nstable release. The Django project publishes a full stable release\nevery eight months or so, with bugfix updates in between. These stable\nreleases contain the API that is covered by our backwards\ncompatibility guarantees; if you write code against stable releases,\nyou shouldn’t have any problems upgrading when the next official\nversion is released.", "keywords": ["compatibility", "question", "server", "security", "production", "bugfix", "api", "documentation", "releases", "improvements", "mysql", "sqlite", "guarantees", "error", "django", "series", "wsgi", "code", "installations", "information", "release", "n’t", "python", "web", "page", "servers", "default", "features", "download", "problems", "versions", "installation", "cases", "development", "example", "optimizations", "months", "variety", "requirements", "party", "rest", "environment", "spec", "¶", "mariadb", "databases", "a.b.c", "questions", "trouble", "applications", "october", "tutorial", "install", "oracle", "prerequisites", "pep", "deploying", "lts", "database", "april", "project", "table", "libraries", "faq", "use", "guide", "advantage", "support", "version"], "type": "documentation"},
{"title": "Django 1.8 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.8/", "content": "Django 1.8 release notes ¶ April 1, 2015 Welcome to Django 1.8! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 1.7 or older versions. We’ve\nalso begun the deprecation process for some features , and some features have reached the end of their\ndeprecation process and have been removed . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Django 1.8 has been designated as Django’s second long-term support\nrelease . It will receive security updates for at\nleast three years after its release. Support for the previous LTS, Django 1.4,\nwill end 6 months from the release date of Django 1.8. Python compatibility ¶ Django 1.8 requires Python 2.7, 3.2, 3.3, 3.4, or 3.5. We highly recommend and only officially support the latest release of each series. Django 1.8 is the first release to support Python 3.5. Due to the end of upstream support for Python 3.2 in February 2016, we won’t\ntest Django 1.8.x on Python 3.2 after the end of 2016. What’s new in Django 1.8 ¶ Model._meta API ¶ Django now has a formalized API for Model._meta ,\nproviding an officially supported way to retrieve fields and filter fields based on their attributes . The Model._meta object has been part of Django since the days of pre-0.96\n“Magic Removal” – it just wasn’t an official, stable API. In recognition of\nthis, we’ve endeavored to maintain backwards-compatibility with the old\nAPI endpoint where possible. However, API endpoints that aren’t part of the\nnew official API have been deprecated and will eventually be removed. Multiple template engines ¶ Django 1.8 defines a stable API for integrating template backends. It includes\nbuilt-in support for the Django template language and for Jinja2 . It supports rendering\ntemplates with multiple engines within the same project. Learn more about the\nnew features in the topic guide and check the\nupgrade instructions in older versions of the documentation. Security enhancements ¶ Several features of the django-secure third-party library have been\nintegrated into Django. django.middleware.security.SecurityMiddleware provides several security enhancements to the request/response cycle. The new check --deploy option allows you to check your production settings\nfile for ways to increase the security of your site. New PostgreSQL specific functionality ¶ Django now has a module with extensions for PostgreSQL specific features, such\nas ArrayField , HStoreField , Range Fields , and unaccent lookup. A full breakdown of the features is available in the documentation . New data types ¶ Django now has a UUIDField for storing\nuniversally unique identifiers. It is stored as the native uuid data type\non PostgreSQL and as a fixed length character field on other backends. There\nis a corresponding form field . Django now has a DurationField for storing periods\nof time - modeled in Python by timedelta . It is\nstored in the native interval data type on PostgreSQL, as a INTERVAL DAY(9) TO SECOND(6) on Oracle, and as a bigint of microseconds on other\nbackends. Date and time related arithmetic has also been improved on all\nbackends. There is a corresponding form field . Query Expressions, Conditional Expressions, and Database Functions ¶ Query Expressions allow you to create,\ncustomize, and compose complex SQL expressions. This has enabled annotate\nto accept expressions other than aggregates. Aggregates are now able to\nreference multiple fields, as well as perform arithmetic, similar to F() objects. order_by() has also gained the\nability to accept expressions. Conditional Expressions allow\nyou to use if … elif … else logic within\nqueries. A collection of database functions is\nalso included with functionality such as Coalesce , Concat , and Substr . TestCase data setup ¶ TestCase has been refactored to allow for data\ninitialization at the class level using transactions and savepoints. Database\nbackends which do not support transactions, like MySQL with the MyISAM storage\nengine, will still be able to run these tests but won’t benefit from the\nimprovements. Tests are now run within two nested atomic() blocks: one for the whole class and one\nfor each test. The class method TestCase.setUpTestData() adds\nthe ability to set up test data at the class level. Using this technique can\nspeed up the tests as compared to using setUp() . Fixture loading within TestCase is now performed once for the whole TestCase . Minor features ¶ django.contrib.admin ¶ ModelAdmin now has a has_module_permission() method to allow limiting access to the module on the admin index page. InlineModelAdmin now has an attribute show_change_link that\nsupports showing a link to an inline object’s change form. Use the new django.contrib.admin.RelatedOnlyFieldListFilter in ModelAdmin.list_filter to limit the list_filter choices to foreign objects which are attached to\nthose from the ModelAdmin . The ModelAdmin.delete_view() displays a summary of objects\nto be deleted on the deletion confirmation page. The jQuery library embedded in the admin has been upgraded to version 1.11.2. You can now specify AdminSite.site_url in order to display a link to the\nfront-end site. You can now specify ModelAdmin.show_full_result_count to control whether\nor not the full count of objects should be displayed on a filtered admin page. The AdminSite.password_change() method now has an extra_context parameter. You can now control who may login to the admin site by overriding only AdminSite.has_permission() and AdminSite.login_form .\nThe base.html template has a new block usertools which contains the\nuser-specific header. A new context variable has_permission , which gets\nits value from has_permission() ,\nindicates whether the user may access the site. Foreign key dropdowns now have buttons for changing or deleting related\nobjects using a popup. django.contrib.admindocs ¶ reStructuredText is now parsed in model docstrings. django.contrib.auth ¶ Authorization backends can now raise PermissionDenied in has_perm() and has_module_perms() to short-circuit permission checking. PasswordResetForm now\nhas a method send_mail() that can be overridden to customize the mail to be sent. The max_length of Permission.name has been increased from 50 to\n255 characters. Please run the database migration. USERNAME_FIELD and REQUIRED_FIELDS now supports ForeignKey s. The default iteration count for the PBKDF2 password hasher has been\nincreased by 33%. This backwards compatible change will not affect users who\nhave subclassed django.contrib.auth.hashers.PBKDF2PasswordHasher to\nchange the default value. django.contrib.gis ¶ A new GeoJSON serializer is now\navailable. It is now allowed to include a subquery as a geographic lookup argument, for\nexample City.objects.filter(point__within=Country.objects.filter(continent='Africa').values('mpoly')) . The SpatiaLite backend now supports Collect and Extent aggregates\nwhen the database version is 3.0 or later. The PostGIS 2 CREATE EXTENSION postgis and the SpatiaLite SELECT InitSpatialMetaData initialization commands are now automatically\nrun by migrate . The GDAL interface now supports retrieving properties of raster (image) data file . Compatibility shims for SpatialRefSys and GeometryColumns changed in\nDjango 1.2 have been removed. All GDAL-related exceptions are now raised with GDALException . The former OGRException has been kept for backwards compatibility but should not be\nused any longer. django.contrib.sessions ¶ Session cookie is now deleted after flush() is called. django.contrib.sitemaps ¶ The new Sitemap.i18n attribute\nallows you to generate a sitemap based on the LANGUAGES setting. django.contrib.sites ¶ get_current_site() will now lookup\nthe current site based on request.get_host() if the SITE_ID setting is not\ndefined. The default Site created when running migrate now respects the SITE_ID setting (instead of always\nusing pk=1 ). Cache ¶ The incr() method of the django.core.cache.backends.locmem.LocMemCache backend is now thread-safe. Cryptography ¶ The max_age parameter of the django.core.signing.TimestampSigner.unsign() method now also accepts a datetime.timedelta object. Database backends ¶ The MySQL backend no longer strips microseconds from datetime values as\nMySQL 5.6.4 and up supports fractional seconds depending on the declaration\nof the datetime field (when DATETIME includes fractional precision greater\nthan 0). New datetime database columns created with Django 1.8 and MySQL 5.6.4\nand up will support microseconds. See the MySQL database notes for more details. The MySQL backend no longer creates explicit indexes for foreign keys when\nusing the InnoDB storage engine, as MySQL already creates them automatically. The Oracle backend no longer defines the connection_persists_old_columns feature as True . Instead, Oracle will now include a cache busting clause\nwhen getting the description of a table. Email ¶ Email backends now support the context manager\nprotocol for opening and closing connections. The SMTP email backend now supports keyfile and certfile authentication with the EMAIL_SSL_CERTFILE and EMAIL_SSL_KEYFILE settings. The SMTP EmailBackend now supports\nsetting the timeout parameter with the EMAIL_TIMEOUT setting. EmailMessage and EmailMultiAlternatives now\nsupport the reply_to parameter. File Storage ¶ Storage.get_available_name() and Storage.save() now take a max_length argument to implement storage-level maximum\nfilename length constraints. Filenames exceeding this argument will get\ntruncated. This prevents a database error when appending a unique suffix to a\nlong filename that already exists on the storage. See the deprecation\nnote about adding this argument to your custom\nstorage classes. Forms ¶ Form widgets now render attributes with a value of True or False as HTML5 boolean attributes. The new has_error() method allows checking\nif a specific error has happened. If required_css_class is defined on a form, then\nthe <label> tags for required fields will have this class present in its\nattributes. The rendering of non-field errors in unordered lists ( <ul> ) now includes nonfield in its list of classes to distinguish them from field-specific\nerrors. Field now accepts a label_suffix argument, which will override the\nform’s label_suffix . This enables customizing the\nsuffix on a per-field basis — previously it wasn’t possible to override\na form’s label_suffix while using  shortcuts such\nas {{ form.as_p }} in templates. SelectDateWidget now accepts an empty_label argument, which will\noverride the top list choice label when DateField is not required. After an ImageField has been cleaned and validated, the UploadedFile object will have an additional image attribute containing\nthe Pillow Image instance used to check if the file was a valid image. It\nwill also update UploadedFile.content_type with the image’s content type\nas determined by Pillow. You can now pass a callable that returns an iterable of choices when\ninstantiating a ChoiceField . Generic Views ¶ Generic views that use MultipleObjectMixin may now specify the ordering applied to the queryset by setting ordering or overriding get_ordering() . The new SingleObjectMixin.query_pk_and_slug attribute allows changing the behavior of get_object() so that it’ll perform its lookup using both the primary key and the slug. The get_form() method doesn’t\nrequire a form_class to be provided anymore. If not provided form_class defaults to get_form_class() . Placeholders in ModelFormMixin.success_url now support the Python str.format() syntax. The legacy %(<foo>)s syntax is still\nsupported but will be removed in Django 1.10. Internationalization ¶ FORMAT_MODULE_PATH can now be a list of strings representing\nmodule paths. This allows importing several format modules from different\nreusable apps. It also allows overriding those custom formats in your main\nDjango project. Logging ¶ The django.utils.log.AdminEmailHandler class now has a send_mail() method to make it more\nsubclass friendly. Management Commands ¶ Database connections are now always closed after a management command called\nfrom the command line has finished doing its job. Commands from alternate package formats like eggs are now also discovered. The new dumpdata --output option allows specifying a file to which\nthe serialized data is written. The new makemessages --exclude and compilemessages --exclude options allow excluding specific locales from processing. compilemessages now has a --use-fuzzy or -f option which\nincludes fuzzy translations into compiled files. The loaddata --ignorenonexistent option now ignores data for models\nthat no longer exist. runserver now uses daemon threads for faster reloading. inspectdb now outputs Meta.unique_together . It is also able to\nintrospect AutoField for MySQL and PostgreSQL\ndatabases. When calling management commands with options using call_command() , the option name can match the\ncommand line option name (without the initial dashes) or the final option\ndestination variable name, but in either case, the resulting option received\nby the command is now always the dest name specified in the command\noption definition (as long as the command uses the argparse module). The dbshell command now supports MySQL’s optional SSL certificate\nauthority setting ( --ssl-ca ). The new makemigrations --name allows giving the migration(s) a\ncustom name instead of a generated one. The loaddata command now prevents repeated fixture loading. If FIXTURE_DIRS contains duplicates or a default fixture directory\npath ( app_name/fixtures ), an exception is raised. The new makemigrations --exit option allows exiting with an error\ncode if no migrations are created. The new showmigrations command allows listing all migrations and\ntheir dependencies in a project. Middleware ¶ The CommonMiddleware.response_redirect_class attribute allows you to customize the redirects issued by the middleware. A debug message will be logged to the django.request logger when a\nmiddleware raises a MiddlewareNotUsed exception\nin DEBUG mode. Migrations ¶ The RunSQL operation can now handle\nparameters passed to the SQL statements. It is now possible to have migrations (most probably data migrations ) for applications without models. Migrations can now serialize model managers as part of the model state. A generic mechanism to handle the deprecation of model fields was added. The RunPython.noop() and RunSQL.noop class\nmethod/attribute were added to ease in making RunPython and RunSQL operations reversible. The migration operations RunPython and RunSQL now call the allow_migrate() method of database routers. The router can use the\nnewly introduced app_label and hints arguments to make a routing\ndecision. To take advantage of this feature you need to update the router to\nthe new allow_migrate signature, see the deprecation section for more details. Models ¶ Django now logs at most 9000 queries in connections.queries , in order\nto prevent excessive memory usage in long-running processes in debug mode. There is now a model Meta option to define a default related name for all relational fields of a model. Pickling models and querysets across different versions of Django isn’t\nofficially supported (it may work, but there’s no guarantee). An extra\nvariable that specifies the current Django version is now added to the\npickled state of models and querysets, and Django raises a RuntimeWarning when these objects are unpickled in a different version than the one in\nwhich they were pickled. Added Model.from_db() which\nDjango uses whenever objects are loaded using the ORM. The method allows\ncustomizing model loading behavior. extra(select={...}) now allows you to escape a literal %s sequence\nusing %%s . Custom Lookups can now be registered using\na decorator pattern. The new Transform.bilateral attribute allows creating bilateral transformations. These transformations\nare applied to both lhs and rhs when used in a lookup expression,\nproviding opportunities for more sophisticated lookups. SQL special characters (, %, _) are now escaped properly when a pattern\nlookup (e.g. contains , startswith , etc.) is used with an F() expression as the right-hand side. In those cases, the escaping is performed\nby the database, which can lead to somewhat complex queries involving nested REPLACE function calls. You can now refresh model instances by using Model.refresh_from_db() . You can now get the set of deferred fields for a model using Model.get_deferred_fields() . Model field default ’s are now used when primary key field’s are set to None . Signals ¶ Exceptions from the (receiver, exception) tuples returned by Signal.send_robust() now have\ntheir traceback attached as a __traceback__ attribute. The environ argument, which contains the WSGI environment structure from\nthe request, was added to the request_started signal. You can now import the setting_changed() signal\nfrom django.core.signals to avoid loading django.test in non-test\nsituations. Django no longer does so itself. System Check Framework ¶ register can now be used as a function. Templates ¶ urlize now supports domain-only links that include characters after\nthe top-level domain (e.g. djangoproject.com/ and djangoproject.com/download/ ). urlize doesn’t treat exclamation marks at the end of a domain or\nits query string as part of the URL (the URL in e.g. 'djangoproject.com! is djangoproject.com ) Added a locmem.Loader class that loads Django templates from a Python dictionary. The now tag can now store its output in a context variable with the\nusual syntax: {% now 'j n Y' as varname %} . Requests and Responses ¶ WSGIRequest now respects paths starting with // . The HttpRequest.build_absolute_uri() method now handles paths\nstarting with // correctly. If DEBUG is True and a request raises a SuspiciousOperation , the response will be\nrendered with a detailed error page. The query_string argument of QueryDict is now\noptional, defaulting to None , so a blank QueryDict can now be\ninstantiated with QueryDict() instead of QueryDict(None) or QueryDict('') . The GET and POST attributes of an HttpRequest object are now QueryDict s rather than dictionaries,\nand the FILES attribute is now a MultiValueDict .\nThis brings this class into line with the documentation and with WSGIRequest . The HttpResponse.charset attribute\nwas added. WSGIRequestHandler now follows RFC in converting URI to IRI, using uri_to_iri() . The HttpRequest.get_full_path() method now escapes unsafe characters\nfrom the path portion of a Uniform Resource Identifier (URI) properly. HttpResponse now implements a few additional methods\nlike getvalue() so that instances can be used\nas stream objects. The new HttpResponse.setdefault() method allows setting a header unless\nit has already been set. You can use the new FileResponse to stream files. The condition() decorator for\nconditional view processing now supports the If-unmodified-since header. Tests ¶ The RequestFactory.trace() and Client.trace() methods were\nimplemented, allowing you to create TRACE requests in your tests. The count argument was added to assertTemplateUsed() . This allows you to\nassert that a template was rendered a specific number of times. The new assertJSONNotEqual() assertion\nallows you to test that two JSON fragments are not equal. Added options to the test command to preserve the test database\n( --keepdb ), to run the test cases in reverse order\n( --reverse ), and to enable SQL logging for failing\ntests ( --debug-sql ). Added the resolver_match attribute to test\nclient responses. Added several settings that allow customization of test tablespace parameters\nfor Oracle: DATAFILE , DATAFILE_TMP , DATAFILE_MAXSIZE and DATAFILE_TMP_MAXSIZE . The override_settings() decorator can now affect the\nmaster router in DATABASE_ROUTERS . Added test client support for file uploads with file-like objects. A shared cache is now used when testing with an SQLite in-memory database when\nusing Python 3.4+ and SQLite 3.7.13+. This allows sharing the database\nbetween threads. Validators ¶ URLValidator now supports IPv6 addresses,\nUnicode domains, and URLs containing authentication data. Backwards incompatible changes in 1.8 ¶ Warning In addition to the changes outlined in this section, be sure to review the deprecation plan for any features that\nhave been removed. If you haven’t updated your code within the\ndeprecation timeline for a given feature, its removal may appear as a\nbackwards incompatible change. Related object operations are run in a transaction ¶ Some operations on related objects such as add() or direct\nassignment ran multiple data modifying queries without wrapping them in\ntransactions. To reduce the risk of data corruption, all data modifying methods\nthat affect multiple related objects (i.e. add() , remove() , clear() , and direct assignment) now perform their data modifying queries\nfrom within a transaction, provided your database supports transactions. This has one backwards incompatible side effect, signal handlers triggered from\nthese methods are now executed within the method’s transaction and any\nexception in a signal handler will prevent the whole operation. Assigning unsaved objects to relations raises an error ¶ Note To more easily allow in-memory usage of models, this change was reverted in\nDjango 1.8.4 and replaced with a check during model.save() . For example: >>> book = Book . objects . create ( name = \"Django\" ) >>> book . author = Author ( name = \"John\" ) >>> book . save () Traceback (most recent call last): ... ValueError : save() prohibited to prevent data loss due to unsaved related object 'author'. A similar check on assignment to reverse one-to-one relations was removed\nin Django 1.8.5. Assigning unsaved objects to a ForeignKey , GenericForeignKey , and OneToOneField now raises a ValueError . Previously, the assignment of an unsaved object would be silently ignored.\nFor example: >>> book = Book . objects . create ( name = \"Django\" ) >>> book . author = Author ( name = \"John\" ) >>> book . author . save () >>> book . save () >>> Book . objects . get ( name = \"Django\" ) >>> book . author >>> Now, an error will be raised to prevent data loss: >>> book . author = Author ( name = \"john\" ) Traceback (most recent call last): ... ValueError : Cannot assign \"<Author: John>\": \"Author\" instance isn't saved in the database. If you require allowing the assignment of unsaved instances (the old behavior)\nand aren’t concerned about the data loss possibility (e.g. you never save the\nobjects to the database), you can disable this check by using the ForeignKey.allow_unsaved_instance_assignment attribute. (This attribute was\nremoved in 1.8.4 as it’s no longer relevant.) Management commands that only accept positional arguments ¶ If you have written a custom management command that only accepts positional\narguments and you didn’t specify the args command variable, you might get\nan error like Error: unrecognized arguments: ... , as variable parsing is\nnow based on argparse which doesn’t implicitly accept positional\narguments. You can make your command backwards compatible by simply setting the args class variable. However, if you don’t have to keep compatibility with\nolder Django versions, it’s better to implement the new add_arguments() method as described\nin How to create custom django-admin commands . Custom test management command arguments through test runner ¶ The method to add custom arguments to the test management command through\nthe test runner has changed. Previously, you could provide an option_list class variable on the test runner to add more arguments (à la optparse ). Now to implement the same behavior, you have to create an add_arguments(cls, parser) class method on the test runner and call parser.add_argument to add any custom arguments, as parser is now an argparse.ArgumentParser instance. Model check ensures auto-generated column names are within limits specified by database ¶ A field name that’s longer than the column name length supported by a database\ncan create problems. For example, with MySQL you’ll get an exception trying to\ncreate the column, and with PostgreSQL the column name is truncated by the\ndatabase (you may see a warning in the PostgreSQL logs). A model check has been introduced to better alert users to this scenario before\nthe actual creation of database tables. If you have an existing model where this check seems to be a false positive,\nfor example on PostgreSQL where the name was already being truncated, simply\nuse db_column to specify the name that’s being\nused. The check also applies to the columns generated in an implicit ManyToManyField.through model. If you run into an issue there, use through to create an explicit model\nand then specify db_column on its column(s)\nas needed. Query relation lookups now check object types ¶ Querying for model lookups now checks if the object passed is of correct type\nand raises a ValueError if not. Previously, Django didn’t care if the\nobject was of correct type; it just used the object’s related field attribute\n(e.g. id ) for the lookup. Now, an error is raised to prevent incorrect\nlookups: >>> book = Book . objects . create ( name = \"Django\" ) >>> book = Book . objects . filter ( author = book ) Traceback (most recent call last): ... ValueError : Cannot query \"<Book: Django>\": Must be \"Author\" instance. select_related() now checks given fields ¶ select_related() now validates that the given fields actually exist.\nPreviously, nonexistent fields were silently ignored. Now, an error is raised: >>> book = Book . objects . select_related ( \"nonexistent_field\" ) Traceback (most recent call last): ... FieldError : Invalid field name(s) given in select_related: 'nonexistent_field' The validation also makes sure that the given field is relational: >>> book = Book . objects . select_related ( \"name\" ) Traceback (most recent call last): ... FieldError : Non-relational field given in select_related: 'name' Default EmailField.max_length increased to 254 ¶ The old default 75 character max_length was not capable of storing all\npossible RFC3696/5321-compliant email addresses. In order to store all\npossible valid email addresses, the max_length has been increased to 254\ncharacters. You will need to generate and apply database migrations for your\naffected models (or add max_length=75 if you wish to keep the length on\nyour current fields). A migration for django.contrib.auth.models.User.email is included. Support for PostgreSQL versions older than 9.0 ¶ The end of upstream support periods was reached in July 2014 for PostgreSQL 8.4.\nAs a consequence, Django 1.8 sets 9.0 as the minimum PostgreSQL version it\nofficially supports. This also includes dropping support for PostGIS 1.3 and 1.4 as these versions\nare not supported on versions of PostgreSQL later than 8.4. Django also now requires the use of Psycopg2 version 2.4.5 or higher (or 2.5+\nif you want to use django.contrib.postgres ). Support for MySQL versions older than 5.5 ¶ The end of upstream support periods was reached in January 2012 for MySQL 5.0\nand December 2013 for MySQL 5.1. As a consequence, Django 1.8 sets 5.5 as the\nminimum MySQL version it officially supports. Support for Oracle versions older than 11.1 ¶ The end of upstream support periods was reached in July 2010 for Oracle 9.2,\nJanuary 2012 for Oracle 10.1, and July 2013 for Oracle 10.2. As a consequence,\nDjango 1.8 sets 11.1 as the minimum Oracle version it officially supports. Specific privileges used instead of roles for tests on Oracle ¶ Earlier versions of Django granted the CONNECT and RESOURCE roles to the test\nuser on Oracle. These roles have been deprecated, so Django 1.8 uses the\nspecific underlying privileges instead. This changes the privileges required\nof the main user for running tests (unless the project is configured to avoid\ncreating a test user). The exact privileges required now are detailed in Oracle notes . AbstractUser.last_login allows null values ¶ The AbstractUser.last_login field now allows null values. Previously, it defaulted to the time when the user\nwas created which was misleading if the user never logged in. If you are using\nthe default user ( django.contrib.auth.models.User ), run the database\nmigration included in contrib.auth . If you are using a custom user model that inherits from AbstractUser ,\nyou’ll need to run makemigrations and generate a migration for your\napp that contains that model. Also, if wish to set last_login to NULL for users who haven’t logged in, you can run this query: from django.db import models from django.contrib.auth import get_user_model from django.contrib.auth.models import AbstractBaseUser UserModel = get_user_model () if issubclass ( UserModel , AbstractBaseUser ): UserModel . _default_manager . filter ( last_login = models . F ( \"date_joined\" )) . update ( last_login = None ) django.contrib.gis ¶ Support for GEOS 3.1 and GDAL 1.6 has been dropped. Support for SpatiaLite < 2.4 has been dropped. GIS-specific lookups have been refactored to use the django.db.models.Lookup API. The default str representation of GEOSGeometry objects has been changed from\nWKT to EWKT format (including the SRID). As this representation is used in\nthe serialization framework, that means that dumpdata output will now\ncontain the SRID value of geometry objects. Priority of context processors for TemplateResponse brought in line with render ¶ The TemplateResponse constructor is designed to be a\ndrop-in replacement for the render() function. However,\nit had a slight incompatibility, in that for TemplateResponse , context data\nfrom the passed in context dictionary could be shadowed by context data returned\nfrom context processors, whereas for render it was the other way\naround. This was a bug, and the behavior of render is more appropriate,\nsince it allows the globally defined context processors to be overridden locally\nin the view. If you were relying on the fact context data in a TemplateResponse could be overridden using a context processor, you will\nneed to change your code. Overriding setUpClass / tearDownClass in test cases ¶ The decorators override_settings() and modify_settings() now act at the class level when used as\nclass decorators. As a consequence, when overriding setUpClass() or tearDownClass() , the super implementation should always be called. Removal of django.contrib.formtools ¶ The formtools contrib app has been moved to a separate package and the\nrelevant documentation pages have been updated or removed. The new package is available on GitHub and on PyPI. Database connection reloading between tests ¶ Django previously closed database connections between each test within a TestCase . This is no longer the case as Django now wraps the whole TestCase within a transaction. If some of your tests relied on the old\nbehavior, you should have them inherit from TransactionTestCase instead. Cleanup of the django.template namespace ¶ If you’ve been relying on private APIs exposed in the django.template module, you may have to import them from django.template.base instead. Also private APIs django.template.base.compile_string() , django.template.loader.find_template() , and django.template.loader.get_template_from_string() were removed. model attribute on private model relations ¶ In earlier versions of Django, on a model with a reverse foreign key\nrelationship (for example), model._meta.get_all_related_objects() returned\nthe relationship as a django.db.models.related.RelatedObject with the model attribute set to the source of the relationship. Now, this method\nreturns the relationship as django.db.models.fields.related.ManyToOneRel (private API RelatedObject has been removed), and the model attribute\nis set to the target of the relationship instead of the source. The source\nmodel is accessible on the related_model attribute instead. Consider this example from the tutorial in Django 1.8: >>> p = Poll . objects . get ( pk = 1 ) >>> p . _meta . get_all_related_objects () [<ManyToOneRel: polls.choice>] >>> p . _meta . get_all_related_objects ()[ 0 ] . model <class 'polls.models.Poll'> >>> p . _meta . get_all_related_objects ()[ 0 ] . related_model <class 'polls.models.Choice'> and compare it to the behavior on older versions: >>> p . _meta . get_all_related_objects () [<RelatedObject: polls:choice related to poll>] >>> p . _meta . get_all_related_objects ()[ 0 ] . model <class 'polls.models.Choice'> To access the source model, you can use a pattern like this to write code that\nwill work with both Django 1.8 and older versions: for relation in opts . get_all_related_objects (): to_model = getattr ( relation , \"related_model\" , relation . model ) Also note that get_all_related_objects() is deprecated in 1.8. Database backend API ¶ The following changes to the database backend API are documented to assist\nthose writing third-party backends in updating their code: BaseDatabaseXXX classes have been moved to django.db.backends.base .\nPlease import them from the new locations: from django.db.backends.base.base import BaseDatabaseWrapper from django.db.backends.base.client import BaseDatabaseClient from django.db.backends.base.creation import BaseDatabaseCreation from django.db.backends.base.features import BaseDatabaseFeatures from django.db.backends.base.introspection import BaseDatabaseIntrospection from django.db.backends.base.introspection import FieldInfo , TableInfo from django.db.backends.base.operations import BaseDatabaseOperations from django.db.backends.base.schema import BaseDatabaseSchemaEditor from django.db.backends.base.validation import BaseDatabaseValidation The data_types , data_types_suffix , and data_type_check_constraints attributes have moved from the DatabaseCreation class to DatabaseWrapper . The SQLCompiler.as_sql() method now takes a subquery parameter\n( #24164 ). The BaseDatabaseOperations.date_interval_sql() method now only takes a timedelta parameter. django.contrib.admin ¶ AdminSite no longer takes an app_name argument and its app_name attribute has been removed. The application name is always admin (as\nopposed to the instance name which you can still customize using AdminSite(name=\"...\") . The ModelAdmin.get_object() method (private API) now takes a third\nargument named from_field in order to specify which field should match\nthe provided object_id . The ModelAdmin.response_delete() method\nnow takes a second argument named obj_id which is the serialized\nidentifier used to retrieve the object before deletion. Default autoescaping of functions in django.template.defaultfilters ¶ In order to make built-in template filters that output HTML “safe by default”\nwhen calling them in Python code, the following functions in django.template.defaultfilters have been changed to automatically escape\ntheir input value: join linebreaksbr linebreaks_filter linenumbers unordered_list urlize urlizetrunc You can revert to the old behavior by specifying autoescape=False if you\nare passing trusted content. This change doesn’t have any effect when using\nthe corresponding filters in templates. Miscellaneous ¶ connections.queries is now a read-only attribute. Database connections are considered equal only if they’re the same object.\nThey aren’t hashable any more. GZipMiddleware used to disable compression\nfor some content types when the request is from Internet Explorer, in order\nto work around a bug in IE6 and earlier. This behavior could affect\nperformance on IE7 and later. It was removed. URLField.to_python no longer adds a trailing slash to pathless URLs. The length template filter now returns 0 for an undefined\nvariable, rather than an empty string. ForeignKey.default_error_message['invalid'] has been changed from '%(model)s instance with pk %(pk)r does not exist.' to '%(model)s instance with %(field)s %(value)r does not exist.' If you are\nusing this message in your own code, please update the list of interpolated\nparameters. Internally, Django will continue to provide the pk parameter in params for backwards compatibility. UserCreationForm.error_messages['duplicate_username'] is no longer used.\nIf you wish to customize that error message, override it on the form using the 'unique' key in Meta.error_messages['username'] or, if you have a custom form field for 'username' , using the 'unique' key in its error_messages argument. The block usertools in the base.html template of django.contrib.admin now requires the has_permission context\nvariable to be set. If you have any custom admin views that use this\ntemplate, update them to pass AdminSite.has_permission() as this new variable’s\nvalue or simply include AdminSite.each_context(request) in the context. Internal changes were made to the ClearableFileInput widget to allow more customization. The undocumented url_markup_template attribute was removed in favor of template_with_initial . For consistency with other major vendors, the en_GB locale now has Monday\nas the first day of the week. Seconds have been removed from any locales that had them in TIME_FORMAT , DATETIME_FORMAT , or SHORT_DATETIME_FORMAT . The default max size of the Oracle test tablespace has increased from 300M\n(or 200M, before 1.7.2) to 500M. reverse() and reverse_lazy() now return Unicode strings instead of\nbytestrings. The CacheClass shim has been removed from all cache backends.\nThese aliases were provided for backwards compatibility with Django 1.3.\nIf you are still using them, please update your project to use the real\nclass name found in the BACKEND key of the CACHES setting. By default, call_command() now always skips the\ncheck framework (unless you pass it skip_checks=False ). When iterating over lines, File now uses universal newlines . The following are recognized as ending a\nline: the Unix end-of-line convention '\\n' , the Windows convention '\\r\\n' , and the old Macintosh convention '\\r' . The Memcached cache backends MemcachedCache and PyLibMCCache will\ndelete a key if set() fails. This is necessary to ensure the cache_db session store always fetches the most current session data. Private APIs override_template_loaders and override_with_test_loader in django.test.utils were removed. Override TEMPLATES with override_settings instead. Warnings from the MySQL database backend are no longer converted to\nexceptions when DEBUG is True . HttpRequest now has a simplified repr (e.g. <WSGIRequest: GET '/somepath/'> ). This won’t change the behavior of\nthe SafeExceptionReporterFilter class. Class-based views that use ModelFormMixin will raise an ImproperlyConfigured exception\nwhen both the fields and form_class attributes are specified.\nPreviously, fields was silently ignored. When following redirects, the test client now raises RedirectCycleError if it detects a loop or hits a\nmaximum redirect limit (rather than passing silently). Translatable strings set as the default parameter of the field are cast\nto concrete strings later, so the return type of Field.get_default() is\ndifferent in some cases. There is no change to default values which are the\nresult of a callable. GenericIPAddressField.empty_strings_allowed is now False . Database\nbackends that interpret empty strings as null (only Oracle among the backends\nthat Django includes) will no longer convert null values back to an empty\nstring. This is consistent with other backends. When the BaseCommand.leave_locale_alone attribute is False , translations are now deactivated instead of forcing\nthe “en-us” locale. In the case your models contained non-English strings and\nyou counted on English translations to be activated in management commands,\nthis will not happen any longer. It might be that new database migrations are\ngenerated (once) after migrating to 1.8. django.utils.translation.get_language() now returns None instead\nof LANGUAGE_CODE when translations are temporarily deactivated. When a translation doesn’t exist for a specific literal, the fallback is now\ntaken from the LANGUAGE_CODE language (instead of from the\nuntranslated msgid message). The name field of django.contrib.contenttypes.models.ContentType has been removed by a migration and replaced by a property. That means it’s\nnot possible to query or filter a ContentType by this field any longer. Be careful if you upgrade to Django 1.8 and skip Django 1.7. If you run manage.py migrate --fake , this migration will be skipped and you’ll see\na RuntimeError: Error creating new content types. exception because the name column won’t be dropped from the database. Use manage.py migrate --fake-initial to fake only the initial migration instead. The new migrate --fake-initial option allows faking initial\nmigrations. In 1.7, initial migrations were always automatically faked if all\ntables created in an initial migration already existed. An app without migrations with a ForeignKey to an app with migrations\nmay now result in a foreign key constraint error when migrating the database\nor running tests. In Django 1.7, this could fail silently and result in a\nmissing constraint. To resolve the error, add migrations to the app without\nthem. Features deprecated in 1.8 ¶ Selected methods in django.db.models.options.Options ¶ As part of the formalization of the Model._meta API (from the django.db.models.options.Options class), a number of methods have been\ndeprecated and will be removed in Django 1.10: get_all_field_names() get_all_related_objects() get_all_related_objects_with_model() get_all_related_many_to_many_objects() get_all_related_m2m_objects_with_model() get_concrete_fields_with_model() get_field_by_name() get_fields_with_model() get_m2m_with_model() Loading cycle and firstof template tags from future library ¶ Django 1.6 introduced {% load cycle from future %} and {% load firstof from future %} syntax for forward compatibility of the cycle and firstof template tags. This syntax is now deprecated\nand will be removed in Django 1.10. You can simply remove the {% load ... from future %} tags. django.conf.urls.patterns() ¶ In the olden days of Django, it was encouraged to reference views as strings\nin urlpatterns : urlpatterns = patterns ( \"\" , url ( \"^$\" , \"myapp.views.myview\" ), ) and Django would magically import myapp.views.myview internally and turn\nthe string into a real function reference. In order to reduce repetition when\nreferencing many views from the same module, the patterns() function takes\na required initial prefix argument which is prepended to all\nviews-as-strings in that set of urlpatterns : urlpatterns = patterns ( \"myapp.views\" , url ( \"^$\" , \"myview\" ), url ( \"^other/$\" , \"otherview\" ), ) In the modern era, we have updated the tutorial to instead recommend importing\nyour views module and referencing your view functions (or classes) directly.\nThis has a number of advantages, all deriving from the fact that we are using\nnormal Python in place of “Django String Magic”: the errors when you mistype a\nview name are less obscure, IDEs can help with autocompletion of view names,\netc. So these days, the above use of the prefix arg is much more likely to be\nwritten (and is better written) as: from myapp import views urlpatterns = patterns ( \"\" , url ( \"^$\" , views . myview ), url ( \"^other/$\" , views . otherview ), ) Thus patterns() serves little purpose and is a burden when teaching new users\n(answering the newbie’s question “why do I need this empty string as the first\nargument to patterns() ?”). For these reasons, we are deprecating it.\nUpdating your code is as simple as ensuring that urlpatterns is a list of django.conf.urls.url() instances. For example: from django.conf.urls import url from myapp import views urlpatterns = [ url ( \"^$\" , views . myview ), url ( \"^other/$\" , views . otherview ), ] Passing a string as view to django.conf.urls.url() ¶ Related to the previous item, referencing views as strings in the url() function is deprecated. Pass the callable view as described in the previous\nsection instead. Template-related settings ¶ As a consequence of the multiple template engines refactor, several settings\nare deprecated in favor of TEMPLATES : ALLOWED_INCLUDE_ROOTS TEMPLATE_CONTEXT_PROCESSORS TEMPLATE_DEBUG TEMPLATE_DIRS TEMPLATE_LOADERS TEMPLATE_STRING_IF_INVALID django.core.context_processors ¶ Built-in template context processors have been moved to django.template.context_processors . django.test.SimpleTestCase.urls ¶ The attribute SimpleTestCase.urls for specifying URLconf configuration in\ntests has been deprecated and will be removed in Django 1.10. Use @override_settings(ROOT_URLCONF=...) instead. prefix argument to i18n_patterns() ¶ Related to the previous item, the prefix argument to django.conf.urls.i18n.i18n_patterns() has been deprecated. Simply pass a\nlist of django.conf.urls.url() instances instead. Using an incorrect count of unpacked values in the for template tag ¶ Using an incorrect count of unpacked values in for tag will raise an\nexception rather than fail silently in Django 1.10. Passing a dotted path to reverse() and url ¶ Reversing URLs by Python path is an expensive operation as it causes the\npath being reversed to be imported. This behavior has also resulted in a security issue . Use named URL patterns for reversing instead. If you are using django.contrib.sitemaps , add the name argument to\nthe url that references django.contrib.sitemaps.views.sitemap() : from django.contrib.sitemaps.views import sitemap url ( r \"^sitemap\\.xml$\" , sitemap , { \"sitemaps\" : sitemaps }, name = \"django.contrib.sitemaps.views.sitemap\" , ) to ensure compatibility when reversing by Python path is removed in Django 1.10. Similarly for GIS sitemaps, add name='django.contrib.gis.sitemaps.views.kml' or name='django.contrib.gis.sitemaps.views.kmz' . If you are using a Python path for the LOGIN_URL or LOGIN_REDIRECT_URL setting, use the name of the url() instead. Aggregate methods and modules ¶ The django.db.models.sql.aggregates and django.contrib.gis.db.models.sql.aggregates modules (both private API), have\nbeen deprecated as django.db.models.aggregates and django.contrib.gis.db.models.aggregates are now also responsible\nfor SQL generation. The old modules will be removed in Django 1.10. If you were using the old modules, see Query Expressions for instructions on rewriting custom aggregates\nusing the new stable API. The following methods and properties of django.db.models.sql.query.Query have also been deprecated and the backwards compatibility shims will be removed\nin Django 1.10: Query.aggregates , replaced by annotations . Query.aggregate_select , replaced by annotation_select . Query.add_aggregate() , replaced by add_annotation() . Query.set_aggregate_mask() , replaced by set_annotation_mask() . Query.append_aggregate_mask() , replaced by append_annotation_mask() . Extending management command arguments through Command.option_list ¶ Management commands now use argparse instead of optparse to\nparse command-line arguments passed to commands. This also means that the way\nto add custom arguments to commands has changed: instead of extending the option_list class list, you should now override the add_arguments() method and add\narguments through argparse.add_argument() . See this example for more details. django.core.management.NoArgsCommand ¶ The class NoArgsCommand is now deprecated and will be removed in Django\n1.10. Use BaseCommand instead, which takes no\narguments by default. Listing all migrations in a project ¶ The --list option of the migrate management command is\ndeprecated and will be removed in Django 1.10. Use showmigrations instead. cache_choices option of ModelChoiceField and ModelMultipleChoiceField ¶ ModelChoiceField and ModelMultipleChoiceField took an undocumented, untested\noption cache_choices . This cached querysets between multiple renderings of\nthe same Form object. This option is subject to an accelerated deprecation\nand will be removed in Django 1.9. django.template.resolve_variable() ¶ The function has been informally marked as “Deprecated” for some time. Replace resolve_variable(path, context) with django.template.Variable(path).resolve(context) . django.contrib.webdesign ¶ It provided the lorem template tag which is now included in the\nbuilt-in tags. Simply remove 'django.contrib.webdesign' from INSTALLED_APPS and {% load webdesign %} from your templates. error_message argument to django.forms.RegexField ¶ It provided backwards compatibility for pre-1.0 code, but its functionality is\nredundant. Use Field.error_messages['invalid'] instead. Old unordered_list syntax ¶ An older (pre-1.0), more restrictive and verbose input format for the unordered_list template filter has been deprecated: [ \"States\" , [[ \"Kansas\" , [[ \"Lawrence\" , []], [ \"Topeka\" , []]]], [ \"Illinois\" , []]]] Using the new syntax, this becomes: [ \"States\" , [ \"Kansas\" , [ \"Lawrence\" , \"Topeka\" ], \"Illinois\" ]] django.forms.Field._has_changed() ¶ Rename this method to has_changed() by removing the\nleading underscore. The old name will still work until Django 1.10. django.utils.html.remove_tags() and removetags template filter ¶ django.utils.html.remove_tags() as well as the template filter removetags have been deprecated as they cannot guarantee safe output. Their\nexistence is likely to lead to their use in security-sensitive contexts where\nthey are not actually safe. The unused and undocumented django.utils.html.strip_entities() function has\nalso been deprecated. is_admin_site argument to django.contrib.auth.views.password_reset() ¶ It’s a legacy option that should no longer be necessary. SubfieldBase ¶ django.db.models.fields.subclassing.SubfieldBase has been deprecated and\nwill be removed in Django 1.10. Historically, it was used to handle fields where\ntype conversion was needed when loading from the database, but it was not used\nin .values() calls or in aggregates. It has been replaced with from_db_value() . The new approach doesn’t call the to_python() method on assignment as was the case with SubfieldBase . If you need that\nbehavior, reimplement the Creator class from Django’s source code in your project. django.utils.checksums ¶ The django.utils.checksums module has been deprecated and will be removed\nin Django 1.10. The functionality it provided (validating checksum using the\nLuhn algorithm) was undocumented and not used in Django. The module has been\nmoved to the django-localflavor package (version 1.1+). InlineAdminForm.original_content_type_id ¶ The original_content_type_id attribute on InlineAdminForm has been\ndeprecated and will be removed in Django 1.10. Historically, it was used\nto construct the “view on site” URL. This URL is now accessible using the absolute_url attribute of the form. django.views.generic.edit.FormMixin.get_form() ’s form_class argument ¶ FormMixin subclasses that override the get_form() method should make\nsure to provide a default value for the form_class argument since it’s\nnow optional. Rendering templates loaded by get_template() with a Context ¶ The return type of get_template() has changed\nin Django 1.8: instead of a django.template.Template , it returns a Template instance whose exact type depends on which backend loaded it. Both classes provide a render() method, however, the former takes a django.template.Context as an argument while the latter expects a dict . This change is enforced through a deprecation path for Django\ntemplates. All this also applies to select_template() . Template and Context classes in template responses ¶ Some methods of SimpleTemplateResponse and TemplateResponse accepted django.template.Context and django.template.Template objects\nas arguments. They should now receive dict and backend-dependent\ntemplate objects respectively. This also applies to the return types if you have subclassed either template\nresponse class. Check the template response API documentation for details. current_app argument of template-related APIs ¶ The following functions and classes will no longer accept a current_app parameter to set an URL namespace in Django 1.10: django.shortcuts.render() django.template.Context() django.template.RequestContext() django.template.response.TemplateResponse() Set request.current_app instead, where request is the first argument\nto these functions or classes. If you’re using a plain Context , use a RequestContext instead. dictionary and context_instance arguments of rendering functions ¶ The following functions will no longer accept the dictionary and context_instance parameters in Django 1.10: django.shortcuts.render() django.shortcuts.render_to_response() django.template.loader.render_to_string() Use the context parameter instead. When dictionary is passed as a\npositional argument, which is the most common idiom, no changes are needed. If you’re passing a Context in context_instance ,\npass a dict in the context parameter instead. If you’re passing a RequestContext , pass the request separately in the request parameter. dirs argument of template-finding functions ¶ The following functions will no longer accept a dirs parameter to override TEMPLATE_DIRS in Django 1.10: django.template.loader.get_template() django.template.loader.select_template() django.shortcuts.render() django.shortcuts.render_to_response() The parameter didn’t work consistently across different template loaders and\ndidn’t work for included templates. django.template.loader.BaseLoader ¶ django.template.loader.BaseLoader was renamed to django.template.loaders.base.Loader . If you’ve written a custom template\nloader that inherits BaseLoader , you must inherit Loader instead. django.test.utils.TestTemplateLoader ¶ Private API django.test.utils.TestTemplateLoader is deprecated in favor of django.template.loaders.locmem.Loader and will be removed in Django 1.9. Support for the max_length argument on custom Storage classes ¶ Storage subclasses should add max_length=None as a parameter to get_available_name() and/or save() if they override either method.\nSupport for storages that do not accept this argument will be removed in\nDjango 1.10. qn replaced by compiler ¶ In previous Django versions, various internal ORM methods (mostly as_sql methods) accepted a qn (for “quote name”) argument, which was a reference\nto a function that quoted identifiers for sending to the database. In Django\n1.8, that argument has been renamed to compiler and is now a full SQLCompiler instance. For backwards-compatibility, calling a SQLCompiler instance performs the same name-quoting that the qn function used to. However, this backwards-compatibility shim is immediately\ndeprecated: you should rename your qn arguments to compiler , and call compiler.quote_name_unless_alias(...) where you previously called qn(...) . Default value of RedirectView.permanent ¶ The default value of the RedirectView.permanent attribute will change from True to False in Django 1.9. Using AuthenticationMiddleware without SessionAuthenticationMiddleware ¶ django.contrib.auth.middleware.SessionAuthenticationMiddleware was\nadded in Django 1.7. In Django 1.7.2, its functionality was moved to auth.get_user() and, for backwards compatibility, enabled only if 'django.contrib.auth.middleware.SessionAuthenticationMiddleware' appears in MIDDLEWARE_CLASSES . In Django 1.10, session verification will be enabled regardless of whether or not SessionAuthenticationMiddleware is enabled (at which point SessionAuthenticationMiddleware will have no significance). You can add it\nto your MIDDLEWARE_CLASSES sometime before then to opt-in. Please read the upgrade considerations first. django.contrib.sitemaps.FlatPageSitemap ¶ django.contrib.sitemaps.FlatPageSitemap has moved to django.contrib.flatpages.sitemaps.FlatPageSitemap . The old import location\nis deprecated and will be removed in Django 1.9. Model Field.related ¶ Private attribute django.db.models.Field.related is deprecated in favor\nof Field.rel .  The latter is an instance of django.db.models.fields.related.ForeignObjectRel which replaces django.db.models.related.RelatedObject . The django.db.models.related module has been removed and the Field.related attribute will be removed in\nDjango 1.10. ssi template tag ¶ The ssi template tag allows files to be included in a template by\nabsolute path. This is of limited use in most deployment situations, and\nthe include tag often makes more sense. This tag is now deprecated and\nwill be removed in Django 1.10. = as comparison operator in if template tag ¶ Using a single equals sign with the {% if %} template tag for equality\ntesting was undocumented and untested. It’s now deprecated in favor of == . %(<foo>)s syntax in ModelFormMixin.success_url ¶ The legacy %(<foo>)s syntax in ModelFormMixin.success_url is deprecated and\nwill be removed in Django 1.10. GeoQuerySet aggregate methods ¶ The collect() , extent() , extent3d() , make_line() , and unionagg() aggregate methods are deprecated and should be replaced by their\nfunction-based aggregate equivalents ( Collect , Extent , Extent3D , MakeLine , and Union ). Signature of the allow_migrate router method ¶ The signature of the allow_migrate() method of database routers has\nchanged from allow_migrate(db, model) to allow_migrate(db, app_label, model_name=None, **hints) . When model_name is set, the value that was previously given through the model positional argument may now be found inside the hints dictionary\nunder the key 'model' . After switching to the new signature the router will also be called by the RunPython and RunSQL operations. Features removed in 1.8 ¶ These features have reached the end of their deprecation cycle and are removed\nin Django 1.8. See Features deprecated in 1.6 for details, including how to\nremove usage of these features. django.contrib.comments is removed. The following transaction management APIs are removed: TransactionMiddleware the decorators and context managers autocommit , commit_on_success ,\nand commit_manually , defined in django.db.transaction the functions commit_unless_managed and rollback_unless_managed ,\nalso defined in django.db.transaction the TRANSACTIONS_MANAGED setting The cycle and firstof template tags auto-escape their\narguments. The SEND_BROKEN_LINK_EMAILS setting is removed. django.middleware.doc.XViewMiddleware is removed. The Model._meta.module_name alias is removed. The backward compatible shims introduced to rename get_query_set and similar queryset methods are removed. This affects the following classes: BaseModelAdmin , ChangeList , BaseCommentNode , GenericForeignKey , Manager , SingleRelatedObjectDescriptor and ReverseSingleRelatedObjectDescriptor . The backward compatible shims introduced to rename the attributes ChangeList.root_query_set and ChangeList.query_set are removed. django.views.defaults.shortcut and django.conf.urls.shortcut are\nremoved. Support for the Python Imaging Library (PIL) module is removed. The following private APIs are removed: django.db.backend django.db.close_connection() django.db.backends.creation.BaseDatabaseCreation.set_autocommit() django.db.transaction.is_managed() django.db.transaction.managed() django.forms.widgets.RadioInput is removed. The module django.test.simple and the class django.test.simple.DjangoTestSuiteRunner are removed. The module django.test._doctest is removed. The CACHE_MIDDLEWARE_ANONYMOUS_ONLY setting is removed. This change\naffects both django.middleware.cache.CacheMiddleware and django.middleware.cache.UpdateCacheMiddleware despite the lack of a\ndeprecation warning in the latter class. Usage of the hard-coded Hold down “Control”, or “Command” on a Mac, to select\nmore than one. string to override or append to user-provided help_text in\nforms for ManyToMany model fields is not performed by Django anymore\neither at the model or forms layer. The Model._meta.get_(add|change|delete)_permission methods are removed. The session key django_language is no longer read for backwards\ncompatibility. Geographic Sitemaps are removed\n( django.contrib.gis.sitemaps.views.index and django.contrib.gis.sitemaps.views.sitemap ). django.utils.html.fix_ampersands , the fix_ampersands template filter,\nand django.utils.html.clean_html are removed.", "keywords": ["users", "allow_migrate", "argparse", "feature", "permission.name", "request.get_host", "django.shortcuts.render_to_response", "uuidfield", "storage", "pattern", "receiver", "get_concrete_fields_with_model", "cleanup", "django.db.backends.base.features", "endpoint", "basedatabasevalidation", "cache_db", "django.conf.urls.patterns", "pillow", "clearablefileinput", "ssi", "runsql.noop", "--ssl", "corruption", "field.error_messages['invalid", "library", "safeexceptionreporterfilter", "baseloader", "fix_ampersands", "field", "set_annotation_mask", "fielderror", "relation", "runner", "raster", "serialization", "time_format", "m", "flush", "adminsite.password_change", "eggs", "migrations", "ewkt", "django.forms", "xviewmiddleware", "get_ordering", "polls.models", "+", "django_language", "loop", "lts", "lhs", "representation", "range", "5.6.4", "lines", "django.db.models", "rhs", "cryptography", "wsgirequest", "httpresponse", "redirectview.permanent", "cache", "compatibility", "datefield", "abstractuser", "get_fields_with_model", "modelmultiplechoicefield", "databasecreation", "get_form", "change", "literal", "links", "filenames", "label", "shim", "creator", "destination", "changes", "=", "django.contrib.contenttypes.models", "interval", "context_instance", "linenumbers", "refactor", "engine", "stream", "message", "testcase.setuptestdata", "querydict(none", "logs", "months", "permissiondenied", "subquery", "django.core.signing.timestampsigner.unsign", "n", "fact", "relationship", "basecommand.leave_locale_alone", "data_type_check_constraints", "character", "call_command", "setup", "django.contrib.admindocs", "tables", "tag", "flatpagesitemap", "nonexistent_field", "varname", "--debug", "genericforeignkey", "to_model", "process", "fallback", "debug", "django.utils.translation.get_language", "memcached", "adminsite.has_permission", "migration(s", "exclamation", "substr", "choice", "mac", "topic", "collection", "get_field_by_name", "/somepath/", "john", "django.conf.urls.url", "autoescape", "compression", "type", "processing", "django.contrib.flatpages.sitemaps", "error_messages", "calls", "custom", "django.contrib.gis.db.models.sql.aggregates", "objects", "documentation", "lookups", "\\n", "datetime.timedelta", "file", "customization", "constraint", "guarantee", "email_timeout", "modules", "urlvalidator", "gzipmiddleware", "latter", "user", "processors", "cases", "django.db.backends.base.client", "login_redirect_url", "django.db.models.fields.subclassing", "django.middleware.security", "--fake", "annotations", "era", "attribute", "column(s", "django.template.context_processors", "args", "django.contrib.gis", "mechanism", "django.db.models.sql.aggregates", "states", "basedatabaseoperations.date_interval_sql", "object_id", "warning", "size", "constraints", "runtimewarning", "maximum", "runtimeerror", "makeline", "time", "tags", "get_m2m_with_model", "emailfield.max_length", "basis", "risk", "date", "inlinemodeladmin", "jquery", "save", "setting", "render", "responses", "daemon", "app_label", "polls", "django.contrib.gis.sitemaps.views.sitemap", "geometrycolumns", "multivaluedict", "password", "logic", "passwordresetform", "name", "djangoproject.com/download/", "makemigrations", "rfc3696/5321", "django.test.simple", "parameter", "max_length=75", "has_permission", "^sitemap\\.xml$", "django.core.signals", "datafile_maxsize", "escaping", "backends", "reference", "multipleobjectmixin", "january", "modeladmin.show_full_result_count", "django.contrib.auth", "issue", "upgrade", "monday", "ides", "problems", "versions", "django.contrib.formtools", "queries", "get_current_site", "name='django.contrib.gis.sitemaps.views.kmz", "django.contrib.auth.models.user.email", "manager", "django.template.base.compile_string", "trailing", "django.contrib.admin", "github", "selectdatewidget", "datafile_tmp", "django.middleware.doc", "override_settings", "addresses", "return", "reverse", "deletion", "applications", "handlers", "operator", "memory", "django.db.backends.base.creation", "tutorial", "expressions", "foreignobjectrel", "december", "field.get_default", "srid", "question", "model._meta.get_(add|change|delete)_permission", "store", "locmem", "smtp", "pylibmccache", "username", "aliases", "dirs", "february", "plan", "model.save", "url", "error", "timeout", "module", "geometry", "code", "bigint", "base.html", "locmemcache", "databasewrapper", "algorithm", "field.related", "opts", "pages", "filter", "usermodel", "behavior", "false", "access", "class", "link", "migration", "clause", "placeholders", "data_types", "request.current_app", "allow_migrate(db", "django.core.context_processors", "reply_to", "ssl", "warnings", "widget", "names", "'", "compiler", "basecommentnode", "pbkdf2", "years", "str.format", "usercreationform.error_messages['duplicate_username", "request", "database", "block", "django.core.cache.backends.locmem", "required_css_class", "output", "privileges", "input", "topeka", "django.utils.checksums", "signal", "*", "query", "page", "test", "docstrings", "postgresql", "commands", "suspiciousoperation", "count", "migrate", "types", "django.contrib.comments", "strings", "locales", "subclass", "burden", "get_all_field_names", "admin", "spatialrefsys", "creation", ".", "parser.add_argument", ".values", "basedatabasexxx", "usertools", "usage", "inlineadminform.original_content_type_id", "querydict", "transactiontestcase", "help_text", "wsgi", "fileresponse", "pk)r", "configuration", "meta.error_messages['username", "luhn", "limit", "has_module_permission", "max_length", "day(9", "django.utils.html.fix_ampersands", "django.contrib.sites", "validation", "django.utils.html.strip_entities", "create", "django.test.simpletestcase.urls", "include", "bytestrings", "django.db.backend", "sessionauthenticationmiddleware", "section", "authority", "django.db.models.sql.query", "django.conf.urls.i18n.i18n_patterns", "geoqueryset", "suffix", "source", "send_mail", "datafile", "country.objects.filter(continent='africa').values('mpoly", "mail", "sequence", "to_python", "router", "django.template.loader.get_template", "underscore", "use", "querying", "dbshell", "replacement", "advantages", "environment", "model._meta", "django.db.backends.base.operations", "adminemailhandler", "author", "engines", "teardownclass", "subclasses", "performance", "extensions", "httprequest.build_absolute_uri", "newbie", "foreignkey.default_error_message['invalid", "httpresponse.charset", "operation", "order", "j", "signature", "params", "default", "cachemiddleware", "django.middleware.cache", "loader", "breakdown", "choices", "opening", "identifiers", "django.contrib.sitemaps", "middleware_classes", "short_datetime_format", "bug", "alias", "form", "shortcuts", "signals", "manytoonerel", "prefix", "option", "properties", "format", "select_template", "classes", "tests", "characters", "expression", "django.template.loader.render_to_string", "restructuredtext", "environ", "equality", "day", "convention", "current_app", "equivalents", "basedatabaseoperations", "annotate", "storage.get_available_name", "fixture", "considerations", "datafile_tmp_maxsize", "psycopg2", "advantage", "f", "contrib.auth", "get_all_related_m2m_objects_with_model", "domains", "getattr", "last_login", "confirmation", "original_content_type_id", "existence", "wsgirequesthandler", "routing", "template", "marks", "week", "aggregates", "header", "onetoonefield", "traceback", "way", "django.contrib.postgres", "formats", "internet", "gdal", "has_module_perms", "checks", "basedatabaseschemaeditor", "index", "macintosh", "microseconds", "possibility", "party", "queryset", "django.contrib.sitemaps.views.sitemap", "periods", "session", "model._meta.get_all_related_objects", "¶", "command", "pil", "internationalization", "parameters", "post", "modelchoicefield", "format_module_path", "compiler.quote_name_unless_alias", "precision", "emailmultialternatives", "django.template.response", "atomic", "property", "side", "--output", "content", "function", "django.template.loader", "protocol", "views", "arrayfield", "arg", "result", "qn", "view", "testing", "uuid", "django.template.loader.find_template", "django.contrib.sessions", "sitemap.i18n", "popup", "500m.", "control", "indexes", "relatedonlyfieldlistfilter", "extent", "number", "linebreaks_filter", "myapp.views.myview", "djangotestsuiterunner", "autoescaping", "template_with_initial", "relations", "point", "\\r", "django.shortcuts.render", "values", "assertjsonnotequal", "enhancements", "autocompletion", "generic", "argumentparser", "string", "relatedobject", "abstractuser.last_login", "order_by", "ie7", "windows", "aggregate", "timeline", "unix", "geojson", "extra(select=", "memcachedcache", "commonmiddleware.response_redirect_class", "favor", "auto", "connections", "databases", "jinja2", "sqlcompiler", "managers", "signal.send_robust", "query.aggregates", "hand", "table", "django.db.backends.base.validation", "location", "basedatabaseintrospection", "language", "query.append_aggregate_mask", "models", "querysets", "ipv6", "blocks", "version", "-f", "ways", "level", "json", "pre-0.96", "scenario", "loading", "data_types_suffix", "dashes", "testtemplateloader", "cache_middleware_anonymous_only", "processor", "gis", "endpoints", "image", "tablespace", "namespace", "deprecation", "condition", "parser", "command.option_list", "portion", "django", "series", "basemodeladmin", "regexfield", "finding", "django.contrib.auth.middleware", "myapp", "rfc", "n’t", "securitymiddleware", "filename", "fields", "summary", "coalesce", "dumpdata", "setupclass", "languages", "set", "p", "book", "urlpatterns", "value", "en_gb", "legacy", "assertion", "wkt", "line", "modify_settings", "improperlyconfigured", "contenttype", "get_all_related_many_to_many_objects", "radioinput", "columns", "data", "implementation", "april", "changelist.query_set", "handler", "item", "datetime", "backend", "guide", "annotation_select", "get_available_name", "layer", "inline", "runsql", "identifier", "add", "declaration", "iterable", "security", "magic", "updates", "as_sql", "has_error", "paths", "instance", "master", "uri", "initialization", "makemessages", "django.views.generic.edit", "opportunities", "extension", "simpletemplateresponse", "interface", "consequence", "basecommand", "sitemaps", "validators", "database_routers", "extent3d", "modeladmin", "empty_label", "trace", "functionality", "max_age", "unicode", "override_template_loaders", "concat", "timedelta", "closing", "form_class", "cacheclass", "decorator", "requestfactory.trace", "formmixin.get_form", "adminsite(name=", "issubclass", "add_arguments", "reloading", "constructor", "instances", "conditional", "emailmessage", "structure", "django.db.models.options", "checking", "i18n_patterns", "override_with_test_loader", "django.template", "authenticationmiddleware", "django.utils.html.clean_html", "part", "fixtures", "object", "load", "rollback_unless_managed", "client.trace", "django.db.models.aggregates", "domain", "valueerror", "choicefield", "us", "argparse.add_argument", "linebreaksbr", "geographic", "django.utils.html.remove_tags", "httprequest", "response", "management", "iri", "django.contrib.auth.hashers", "loaders", "incr", "instructions", "sql", "dictionary", "hints", "requests", "vendors", "locale", "compilemessages", "situations", "ie6", "rendering", "register", "replace", "singlerelatedobjectdescriptor", "django.utils.log", "related_model", "ordering", "logger", "repetition", "abstractbaseuser", "fieldinfo", "max", "conversion", "commit_on_success", "from_db_value", "decorators", "django.db.backends.base.base", "myapp.views", "django.forms.widgets", "notes", "redirect", "removetags", "kansas", "runpython", "model.from_db", "effect", "redirectcycleerror", "inlineadminform", "system", "apps", "storage.save", "singleobjectmixin.query_pk_and_slug", "savepoints", "localflavor", "changelist", "dependencies", "spatialite", "runpython.noop", "city.objects.filter(point__within", "imagefield", "innodb", "loaddata", "production", "dropdowns", "s.", "widgets", "routers", "storages", "removal", "djangoproject.com/", "serializer", "definition", "basedatabasewrapper", "autofield", "processes", "target", "slash", "check", "html5", "features", "site", "connection_persists_old_columns", "forms", "’s", "uploads", "july", "django.template.base", "customize", "incompatibility", "sqlcompiler.as_sql", "consistency", "roles", "form.as_p", "add_annotation", "@override_settings(root_urlconf=", "addition", "lists", "example", "unordered_list", "basedatabasecreation", "explorer", "app", "geosgeometry", "get_query_set", "changelist.root_query_set", "modelformmixin.success_url", "locations", "column", "append_annotation_mask", "list", "django.contrib.gis.db.models.aggregates", "loss", "seconds", "orm", "field.rel", "django.db.close_connection", "runserver", "connections.queries", "model.get_deferred_fields", "idiom", "has_perm", "parsing", "newlines", "poll", "fragments", "hasher", "email", "official", "model", "variable", "unionagg", "1.8.x", "reasons", "apis", "callable", "place", "emailbackend", "basedatabasecreation.set_autocommit", "application", "dictionaries", "get_user_model", "django.contrib.auth.models", "attributes", "approach", "formmixin", "testcase", "genericipaddressfield.empty_strings_allowed", "illinois", "basedatabaseclient", "make_line", "release", "ability", "redirects", "get_all_related_objects_with_model", "get_form_class", "y", "sense", "myisam", "meta.unique_together", "geos", "modifying", "translation", "syntax", "r", "subfieldbase", "select", "django.contrib.gis.sitemaps.views.index", "variable(path).resolve(context", "query.set_aggregate_mask", "keys", "name(s", "case", "recognition", "length", "ogrexception", "authentication", "lookup", "authorization", "get_object", "uniform", "certificate", "assignment", "slug", "model.refresh_from_db", "null", "technique", "language_code", "resolve_variable(path", "errors", "html", "job", "lawrence", "showmigrations", "datetime_format", "str", "imaging", "arguments", "django.conf.urls", "significance", "package", "middleware", "value)r", "transactionmiddleware", "foo>)s", "end", "translations", "generation", "adminsite.login_form", "improvements", "e.g.", "sqlite", "contrib", "pypi", "uploadedfile.content_type", "myview", "tuples", "cache_choices", "comparison", "adminsite", "decision", "django.template.defaultfilters", "get_template", "path", "duplicates", "django.db.backends.base.introspection", "firstof", "functions", "key", "term", "collect", "operations", "nonfield", "inspectdb", "none", "filters", "sign", "get", "patterns", "renderings", "durationfield", "email_ssl_certfile", "framework", "caches", "django.test.utils", "pk=1", "gdalexception", "django.contrib.webdesign", "django.db.backends.base.schema", "templateresponse", "formtools", "get_all_related_objects", "dict", "sitemap", "urls", "hstorefield", "api", "\\r\\n", "django.db.backends.creation", "support", "description", "mode", "priority", "transactions", "django.contrib.sitemaps.views", "circuit", "connection", "django.db.backends.base", "transformations", "polls.choice", "context", "noargscommand", "cycle", "permission", "limits", "threads", "files", "import", "simpletestcase.urls", "d", "reverse_lazy", "iteration", "mysql", "directory", "%", "defaults", "statements", ">", "site_id", "call", "foreignkey", "pk", "union", "shims", "python", "in", "urlizetrunc", "formalization", "methods", "requestcontext", "basedatabasefeatures", "modelformmixin", "options", "modeladmin.delete_view", "times", "checksum", "exception", "resource", "purpose", "client", "details", "uploadedfile", "method", "field)s", "django.db", "settings", "transaction", "list_filter", "days", "argument", "verification", "django.template.loaders.base", "cookie", "note", "getvalue", "state", "model_name", "oracle", "httpresponse.setdefault", "url_markup_template", "templates", "buttons", "transform.bilateral", "pre-1.0", "lack", "label_suffix", "tableinfo", "project", "exceptions"], "type": "documentation"},
{"title": "Django 2.1 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/2.1/", "content": "Django 2.1 release notes ¶ August 1, 2018 Welcome to Django 2.1! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 2.0 or earlier. We’ve dropped some features that have reached the end of\ntheir deprecation cycle, and we’ve begun the deprecation process for some\nfeatures . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Python compatibility ¶ Django 2.1 supports Python 3.5, 3.6, and 3.7. Django 2.0 is the last version to\nsupport Python 3.4.  We highly recommend and only officially support the\nlatest release of each series. What’s new in Django 2.1 ¶ Model “view” permission ¶ A “view” permission is added to the model Meta.default_permissions . The new permissions will be\ncreated automatically when running migrate . This allows giving users read-only access to models in the admin. ModelAdmin.has_view_permission() is new. The implementation is backwards\ncompatible in that there isn’t a need to assign the “view” permission to allow\nusers who have the “change” permission to edit objects. There are a couple of backwards incompatible considerations . Minor features ¶ django.contrib.admin ¶ ModelAdmin.search_fields now accepts any lookup such as field__exact . jQuery is upgraded from version 2.2.3 to 3.3.1. The new ModelAdmin.delete_queryset() method allows customizing the\ndeletion process of the “delete selected objects” action. You can now override the default admin site . The new ModelAdmin.sortable_by attribute and ModelAdmin.get_sortable_by() method allow limiting the columns that\ncan be sorted in the change list page. The admin_order_field attribute for elements in ModelAdmin.list_display may now be a query expression. The new ModelAdmin.get_deleted_objects() method allows customizing\nthe deletion process of the delete view and the “delete selected” action. The actions.html , change_list_results.html , date_hierarchy.html , pagination.html , prepopulated_fields_js.html , search_form.html ,\nand submit_line.html templates can now be overridden per app or\nper model (besides overridden\nglobally). The admin change list and change form object tools can now be overridden\nper app, per model, or globally with change_list_object_tools.html and change_form_object_tools.html templates. InlineModelAdmin.has_add_permission() is now passed the parent object\nas the second positional argument, obj . Admin actions may now specify permissions to limit their availability to certain users. django.contrib.auth ¶ createsuperuser now gives a prompt to allow bypassing the AUTH_PASSWORD_VALIDATORS checks. django.contrib.gis ¶ The new GEOSGeometry.buffer_with_style() method is a version of buffer() that allows customizing the style of the\nbuffer. OpenLayersWidget is now based on\nOpenLayers 4.6.5 (previously 3.20.1). django.contrib.sessions ¶ Added the SESSION_COOKIE_SAMESITE setting to set the SameSite cookie flag on session cookies. Cache ¶ The local-memory cache backend now uses a\nleast-recently-used (LRU) culling strategy rather than a pseudo-random one. The new touch() method of the low-level\ncache API updates the timeout of cache keys. CSRF ¶ Added the CSRF_COOKIE_SAMESITE setting to set the SameSite cookie flag on CSRF cookies. Forms ¶ The widget for ImageField now renders with the HTML attribute accept=\"image/*\" . Internationalization ¶ Added the get_supported_language_variant() function. Untranslated strings for territorial language variants now use the\ntranslations of the generic language. For example, untranslated pt_BR strings use pt translations. Management Commands ¶ The new inspectdb --include-views option allows creating models\nfor database views. The BaseCommand class now uses a custom help\nformatter so that the standard options like --verbosity or --settings appear last in the help output, giving a more prominent position to subclassed\ncommand’s options. Migrations ¶ Added support for serialization of functools.partialmethod objects. To support frozen environments, migrations may be loaded from .pyc files. Models ¶ Models can now use __init_subclass__() from PEP 487 . A BinaryField may now be set to editable=True if you wish to include\nit in model forms. A number of new text database functions are added: Chr , Left , LPad , LTrim , Ord , Repeat , Replace , Right , RPad , RTrim , and Trim . The new TruncWeek function truncates DateField and DateTimeField to the Monday of a week. Query expressions can now be negated using a minus sign. QuerySet.order_by() and distinct(*fields) now support using field transforms. BooleanField can now be null=True . This is\nencouraged instead of NullBooleanField , which will likely be deprecated\nin the future. The new QuerySet.explain() method displays the database’s execution\nplan of a queryset’s query. QuerySet.raw() now supports prefetch_related() . Requests and Responses ¶ Added HttpRequest.get_full_path_info() . Added the samesite argument to HttpResponse.set_cookie() to allow\nsetting the SameSite cookie flag. The new as_attachment argument for FileResponse sets the Content-Disposition header to make the browser ask if the user\nwants to download the file. FileResponse also tries to set the Content-Type and Content-Length headers where appropriate. Templates ¶ The new json_script filter safely outputs a Python object as JSON,\nwrapped in a <script> tag, ready for use with JavaScript. Tests ¶ Added test Client support for 307 and 308 redirects. The test Client now serializes a request data\ndictionary as JSON if content_type='application/json' . You can customize\nthe JSON encoder with test client’s json_encoder parameter. The new SimpleTestCase.assertWarnsMessage() method is a simpler\nversion of assertWarnsRegex() . Backwards incompatible changes in 2.1 ¶ Database backend API ¶ This section describes changes that may be needed in third-party database\nbackends. To adhere to PEP 249 , exceptions where a database doesn’t support a\nfeature are changed from NotImplementedError to django.db.NotSupportedError . Renamed the allow_sliced_subqueries database feature flag to allow_sliced_subqueries_with_in . DatabaseOperations.distinct_sql() now requires an additional params argument and returns a tuple of SQL and parameters instead of an SQL string. DatabaseFeatures.introspected_boolean_field_type is changed from a method\nto a property. django.contrib.gis ¶ Support for SpatiaLite 4.0 is removed. Dropped support for MySQL 5.5 ¶ The end of upstream support for MySQL 5.5 is December 2018. Django 2.1 supports\nMySQL 5.6 and higher. Dropped support for PostgreSQL 9.3 ¶ The end of upstream support for PostgreSQL 9.3 is September 2018. Django 2.1\nsupports PostgreSQL 9.4 and higher. Removed BCryptPasswordHasher from the default PASSWORD_HASHERS setting ¶ If you used bcrypt with Django 1.4 or 1.5 (before BCryptSHA256PasswordHasher was added in Django 1.6), you might have some passwords that use the BCryptPasswordHasher hasher. You can check if that’s the case like this: from django.contrib.auth import get_user_model User = get_user_model () User . objects . filter ( password__startswith = \"bcrypt$$\" ) If you want to continue to allow those passwords to be used, you’ll\nhave to define the PASSWORD_HASHERS setting (if you don’t already)\nand include 'django.contrib.auth.hashers.BCryptPasswordHasher' . Moved wrap_label widget template context variable ¶ To fix the lack of <label> when using RadioSelect and CheckboxSelectMultiple with MultiWidget , the wrap_label context\nvariable now appears as an attribute of each option. For example, in a custom input_option.html template, change {% if wrap_label %} to {% if widget.wrap_label %} . SameSite cookies ¶ The cookies used for django.contrib.sessions , django.contrib.messages ,\nand Django’s CSRF protection now set the SameSite flag to Lax by\ndefault. Browsers that respect this flag won’t send these cookies on\ncross-origin requests. If you rely on the old behavior, set the SESSION_COOKIE_SAMESITE and/or CSRF_COOKIE_SAMESITE setting to None . Considerations for the new model “view” permission ¶ Custom admin forms need to take the view-only case into account ¶ With the new “view” permission, existing custom admin forms may raise errors\nwhen a user doesn’t have the change permission because the form might access\nnonexistent fields. Fix this by overriding ModelAdmin.get_form() and\nchecking if the user has the “change” permissions and returning the default\nform if not: class MyAdmin ( admin . ModelAdmin ): def get_form ( self , request , obj = None , ** kwargs ): if not self . has_change_permission ( request , obj ): return super () . get_form ( request , obj , ** kwargs ) return CustomForm New default view permission could allow unwanted access to admin views ¶ If you have a custom permission with a codename of the form view_<modelname> , the new view permission handling in the admin will allow\nview access to the changelist and detail pages for those models. If this is\nunwanted, you must change your custom permission codename. Miscellaneous ¶ The minimum supported version of mysqlclient is increased from 1.3.3 to\n1.3.7. Support for SQLite < 3.7.15 is removed. The date format of Set-Cookie ’s Expires directive is changed to\nfollow RFC 7231 Section 7.1.1.1 instead of Netscape’s cookie standard.\nHyphens present in dates like Tue, 25-Dec-2018 22:26:13 GMT are removed.\nThis change should be merely cosmetic except perhaps for antiquated browsers\nthat don’t parse the new format. allowed_hosts is now a required argument of private API django.utils.http.is_safe_url() . The multiple attribute rendered by the SelectMultiple widget now uses HTML5 boolean syntax\nrather than XHTML’s multiple=\"multiple\" . HTML rendered by form widgets no longer includes a closing slash on void\nelements, e.g. <br> . This is incompatible within XHTML, although some\nwidgets already used aspects of HTML5 such as boolean attributes. The value of SelectDateWidget ’s empty options is\nchanged from 0 to an empty string, which mainly may require some adjustments\nin tests that compare HTML. User.has_usable_password() and the is_password_usable() function no longer\nreturn False if the password is None or an empty string, or if the\npassword uses a hasher that’s not in the PASSWORD_HASHERS setting.\nThis undocumented behavior was a regression in Django 1.6 and prevented users\nwith such passwords from requesting a password reset. Audit your code to\nconfirm that your usage of these APIs don’t rely on the old behavior. Since migrations are now loaded from .pyc files, you might need to delete\nthem if you’re working in a mixed Python 2 and Python 3 environment. Using None as a django.contrib.postgres.fields.JSONField lookup\nvalue now matches objects that have the specified key and a null value rather\nthan objects that don’t have the key. The admin CSS class field-box is renamed to fieldBox to prevent\nconflicts with the class given to model fields named “box”. Since the admin’s actions.html , change_list_results.html , date_hierarchy.html , pagination.html , prepopulated_fields_js.html , search_form.html , and submit_line.html templates can now be\noverridden per app or per model, you may need to rename existing templates\nwith those names that were written for a different purpose. QuerySet.raw() now caches its results like regular querysets. Use iterator() if you don’t want caching. The database router allow_relation() method is called in more cases.\nImproperly written routers may need to be updated accordingly. Translations are no longer deactivated before running management commands.\nIf your custom command requires translations to be deactivated (for example,\nto insert untranslated content into the database), use the new @no_translations decorator . Management commands no longer allow the abbreviated forms of the --settings and --pythonpath arguments. The private django.db.models.sql.constants.QUERY_TERMS constant is\nremoved. The get_lookup() and get_lookups() methods\nof the Lookup Registration API may be\nsuitable alternatives. Compared to the QUERY_TERMS constant, they allow\nyour code to also account for any custom lookups that have been registered. Compatibility with py-bcrypt is removed as it’s unmaintained. Use bcrypt instead. Features deprecated in 2.1 ¶ Miscellaneous ¶ The ForceRHR GIS function is deprecated in favor of the new ForcePolygonCW function. django.utils.http.cookie_date() is deprecated in favor of http_date() , which follows the format of the latest\nRFC. {% load staticfiles %} and {% load admin_static %} are deprecated\nin favor of {% load static %} , which works the same. django.contrib.staticfiles.templatetags.static() is deprecated in favor\nof django.templatetags.static.static() . Support for InlineModelAdmin.has_add_permission() methods that don’t\naccept obj as the second positional argument will be removed in Django\n3.0. Features removed in 2.1 ¶ These features have reached the end of their deprecation cycle and are removed\nin Django 2.1. See Features deprecated in 1.11 for details, including how\nto remove usage of these features. contrib.auth.views.login() , logout() , password_change() , password_change_done() , password_reset() , password_reset_done() , password_reset_confirm() , and password_reset_complete() are removed. The extra_context parameter of contrib.auth.views.logout_then_login() is removed. django.test.runner.setup_databases() is removed. django.utils.translation.string_concat() is removed. django.core.cache.backends.memcached.PyLibMCCache no longer supports\npassing pylibmc behavior settings as top-level attributes of OPTIONS . The host parameter of django.utils.http.is_safe_url() is removed. Silencing of exceptions raised while rendering the {% include %} template\ntag is removed. DatabaseIntrospection.get_indexes() is removed. The authenticate() method of authentication backends requires request as the first positional argument. The django.db.models.permalink() decorator is removed. The USE_ETAGS setting is removed. CommonMiddleware and django.utils.cache.patch_response_headers() no longer set ETags. The Model._meta.has_auto_field attribute is removed. url() ’s support for inline flags in regular expression groups ( (?i) , (?L) , (?m) , (?s) , and (?u) ) is removed. Support for Widget.render() methods without the renderer argument\nis removed.", "keywords": ["prepopulated_fields_js.html", "users", "box", "feature", "user.has_usable_password", "forcepolygoncw", "json_script", "field", "wrap_label", "touch", "m", "serialization", "1.3.3", "migrations", "l", "host", "modeladmin.has_view_permission", "action", "transforms", "trim", "django.utils.http.cookie_date", "cache", "compatibility", "datefield", "august", "1.3.7", "forcerhr", "get_form", "change", "xhtml", "label", "simpletestcase.assertwarnsmessage", "changes", "=", "results", "lpad", "view_<modelname", "password_change", "tag", "assertwarnsregex", "openlayers", "process", "allow_sliced_subqueries_with_in", "django.test.runner.setup_databases", "change_list_object_tools.html", "codename", "type", "mysqlclient", "change_list_results.html", "custom", "kwargs", "objects", "lookups", "file", "disposition", "strategy", "user", "cases", "attribute", "django.contrib.gis", "allow_sliced_subqueries", "gmt", "jquery", "date", "4.6.5", "setting", "responses", "account", "search_form.html", "3.7.15", "password", "iterator", "parameter", "execution", "flags", "backends", "django.contrib.auth", "monday", "pt", "django.contrib.admin", "selectdatewidget", "return", "deletion", "memory", "expressions", "environments", "parent", "december", "datetimefield", "commonmiddleware", "pylibmccache", "position", "plan", "url", "timeout", "code", "change_form_object_tools.html", "pages", "filter", "style", "behavior", "false", "access", "class", "i", "modeladmin.delete_queryset", "widget", "names", "javascript", "contrib.auth.views.logout_then_login", "u", "session_cookie_samesite", "request", "notsupportederror", "flag", "database", "output", "*", "query", "page", "test", "commands", "postgresql", "migrate", "multiple=\"multiple", "databaseintrospection.get_indexes", "modeladmin.get_sortable_by", "elements", "strings", "py", "admin", "usage", "fileresponse", "script", "rpad", "pt_br", "section", "httpresponse.set_cookie", "router", "css", "use", "left", "environment", "queryset.order_by", "protection", "http_date", "adjustments", "aspects", "params", "default", "form", "samesite", "3.3.1", "modeladmin.list_display", "option", "format", "expression", "help", "tests", "etags", "bcrypt", "customform", "csrf_cookie_samesite", "browsers", "considerations", "booleanfield", "supports", "ord", "django.utils.cache.patch_response_headers", "nullbooleanfield", "createsuperuser", "week", "template", "rtrim", "actions.html", "truncweek", "header", "django.contrib.staticfiles.templatetags.static", "--pythonpath", "checks", "content_type='application", "party", "september", "queryset", "repeat", "session", "¶", "command", "internationalization", ".pyc", "parameters", "encoder", "property", "miscellaneous", "content", "lru", "function", "views", "view", "django.contrib.sessions", "modeladmin.get_form", "number", "jsonfield", "permissions", "string", "@no_translations", "myadmin", "?", "availability", "favor", "netscape", "has_change_permission", "language", "models", "dates", "querysets", "version", "level", "json", "auth_password_validators", "hyphens", "gis", "meta.default_permissions", "databasefeatures.introspected_boolean_field_type", "deprecation", "minimum", "django", "series", "rfc", "n’t", "fields", "django.contrib.messages", "password_hashers", "alternatives", "set", "query_terms", "password_reset_complete", "get_supported_language_variant", "value", "password_reset", "openlayerswidget", "columns", "implementation", "pep", "browser", "httprequest.get_full_path_info", "data", "backend", "guide", "inline", "expires", "databaseoperations.distinct_sql", "regression", "--include", "self", "need", "buffer", "handling", "basecommand", "constant", "pagination.html", "modeladmin.search_fields", "modeladmin", "multiwidget", "widget.wrap_label", "closing", "decorator", "allowed_hosts", "field__exact", "object", "bcrypt$$", "load", "couple", "distinct(*fields", "authenticate", "groups", "get_lookup", "management", "django.contrib.auth.hashers", "dictionary", "sql", "requests", "reset", "django.utils.translation.string_concat", "modeladmin.sortable_by", "binaryfield", "django.utils.http.is_safe_url", "queryset.explain", "replace", "model._meta.has_auto_field", "s", "csrf", "django.db.models.permalink", "registration", "notes", "obj", "django.contrib.postgres.fields", "detail", "widget.render", "changelist", "spatialite", "imagefield", "queryset.raw", "widgets", "routers", "headers", "slash", "html5", "features", "site", "forms", "example", "app", "list", "chr", "hasher", "model", "variable", "use_etags", "password_reset_confirm", "apis", "get_user_model", "actions", "conflicts", "attributes", "formatter", "lax", "release", "redirects", "variants", "modeladmin.get_deleted_objects", "django.db.models.sql.constants", "as_attachment", "syntax", "get_lookups", "geosgeometry.buffer_with_style", "keys", "case", "length", "authentication", "lookup", "html", "errors", "notimplementederror", "future", "tuple", "arguments", "passwords", "one", "directive", "end", "translations", "sqlite", "selectmultiple", "standard", "ltrim", "checkboxselectmultiple", "functions", "key", "allow_relation", "renderer", "inspectdb", "none", "bcryptsha256passwordhasher", "sign", "tue", "password_reset_done", "dec-2018", "prompt", "api", "support", "cookies", "-", "context", "cycle", "permission", "files", "import", "mysql", "%", "python", "methods", "options", "purpose", "client", "details", "method", "settings", "argument", "inlinemodeladmin.has_add_permission", "radioselect", "cookie", "json_encoder", "tools", "templates", "admin_order_field", "lack", "text", "project", "exceptions"], "type": "documentation"},
{"title": "Django 1.6 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.6/", "content": "Django 1.6 release notes ¶ Note Dedicated to Malcolm Tredinnick On March 17, 2013, the Django project and the free software community lost\na very dear friend and developer. Malcolm was a long-time contributor to Django, a model community member, a\nbrilliant mind, and a friend. His contributions to Django — and to many other\nopen source projects — are nearly impossible to enumerate. Many on the core\nDjango team had their first patches reviewed by him; his mentorship enriched\nus. His consideration, patience, and dedication will always be an inspiration\nto us. This release of Django is for Malcolm. – The Django Developers November 6, 2013 Welcome to Django 1.6! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 1.5 or older versions. We’ve\nalso dropped some features, which are detailed in our deprecation plan , and we’ve begun the deprecation process\nfor some features . Python compatibility ¶ Django 1.6, like Django 1.5, requires Python 2.6.5 or above. Python 3 is also\nofficially supported. We highly recommend the latest minor release for each\nsupported Python series (2.6.X, 2.7.X, 3.2.X, and 3.3.X). Django 1.6 will be the final release series to support Python 2.6; beginning\nwith Django 1.7, the minimum supported Python version will be 2.7. Python 3.4 is not supported, but support will be added in Django 1.7. What’s new in Django 1.6 ¶ Simplified default project and app templates ¶ The default templates used by startproject and startapp have been simplified and modernized. The admin is now enabled by default in new projects; the sites framework no longer is. clickjacking\nprevention is now on and the database defaults to\nSQLite. If the default templates don’t suit your tastes, you can use custom\nproject and app templates . Improved transaction management ¶ Django’s transaction management was overhauled. Database-level autocommit is\nnow turned on by default. This makes transaction handling more explicit and\nshould improve performance. The existing APIs were deprecated, and new APIs\nwere introduced, as described in the transaction management docs . Persistent database connections ¶ Django now supports reusing the same database connection for several requests.\nThis avoids the overhead of reestablishing a connection at the beginning of\neach request. For backwards compatibility, this feature is disabled by\ndefault. See Persistent connections for details. Discovery of tests in any test module ¶ Django 1.6 ships with a new test runner that allows more flexibility in the\nlocation of tests. The previous runner\n( django.test.simple.DjangoTestSuiteRunner ) found tests only in the models.py and tests.py modules of a Python package in INSTALLED_APPS . The new runner ( django.test.runner.DiscoverRunner ) uses the test discovery\nfeatures built into unittest2 (the version of unittest in the\nPython 2.7+ standard library, and bundled with Django). With test discovery,\ntests can be located in any module whose name matches the pattern test*.py . In addition, the test labels provided to ./manage.py test to nominate\nspecific tests to run must now be full Python dotted paths (or directory\npaths), rather than applabel.TestCase.test_method_name pseudo-paths. This\nallows running tests located anywhere in your codebase, rather than only in INSTALLED_APPS . For more details, see Testing in Django . This change is backwards-incompatible; see the backwards-incompatibility\nnotes . Time zone aware aggregation ¶ The support for time zones introduced in\nDjango 1.4 didn’t work well with QuerySet.dates() : aggregation was always performed in\nUTC. This limitation was lifted in Django 1.6. Use QuerySet.datetimes() to perform time zone aware\naggregation on a DateTimeField . Support for savepoints in SQLite ¶ Django 1.6 adds support for savepoints in SQLite, with some limitations . BinaryField model field ¶ A new django.db.models.BinaryField model field allows storage of raw\nbinary data in the database. GeoDjango form widgets ¶ GeoDjango now provides form fields and widgets for its geo-specialized fields. They are OpenLayers-based by default, but they\ncan be customized to use any other JS framework. check management command added for verifying compatibility ¶ A check management command was added, enabling you to verify if your\ncurrent configuration (currently oriented at settings) is compatible with the\ncurrent version of Django. Model.save() algorithm changed ¶ The Model.save() method now\ntries to directly UPDATE the database if the instance has a primary\nkey value. Previously SELECT was performed to determine if UPDATE or INSERT were needed. The new algorithm needs only one query for\nupdating an existing row while the old algorithm needed two. See Model.save() for more details. In some rare cases the database doesn’t report that a matching row was\nfound when doing an UPDATE . An example is the PostgreSQL ON UPDATE trigger which returns NULL . In such cases it is possible to set django.db.models.Options.select_on_save flag to force saving to\nuse the old algorithm. Minor features ¶ Authentication backends can raise PermissionDenied to immediately fail\nthe authentication chain. The HttpOnly flag can be set on the CSRF cookie with CSRF_COOKIE_HTTPONLY . The assertQuerysetEqual() now checks\nfor undefined order and raises ValueError if undefined\norder is spotted. The order is seen as undefined if the given QuerySet isn’t ordered and there is more than one ordered value to compare against. Added earliest() for symmetry with latest() . In addition to year , month and day , the ORM\nnow supports hour , minute and second lookups. Django now wraps all PEP 249 exceptions. The default widgets for EmailField , URLField , IntegerField , FloatField and DecimalField use\nthe new type attributes available in HTML5 ( type='email' , type='url' , type='number' ). Note that due to erratic support of the number input type with localized numbers in current browsers, Django only uses it\nwhen numeric fields are not localized. The number argument for lazy plural translations can be provided at translation time rather than\nat definition time. For custom management commands: Verification of the presence of valid\nsettings in commands that ask for it by using the BaseCommand.can_import_settings internal\noption is now performed independently from handling of the locale that\nshould be active during the execution of the command. The latter can now be\ninfluenced by the new BaseCommand.leave_locale_alone internal\noption. See Management commands and locales for more details. The success_url of DeletionMixin is now interpolated with\nits object ’s __dict__ . HttpResponseRedirect and HttpResponsePermanentRedirect now provide an url attribute (equivalent to the URL the response will redirect to). The MemcachedCache cache backend now uses the latest pickle protocol available. Added SuccessMessageMixin which\nprovides a success_message attribute for FormView based classes. Added the django.db.models.ForeignKey.db_constraint and django.db.models.ManyToManyField.db_constraint options. The jQuery library embedded in the admin has been upgraded to version 1.9.1. Syndication feeds ( django.contrib.syndication ) can now pass extra\ncontext through to feed templates using a new Feed.get_context_data() callback. The admin list columns have a column-<field_name> class in the HTML\nso the columns header can be styled with CSS, e.g. to set a column width. The isolation level can be customized under\nPostgreSQL. The blocktrans template tag now respects TEMPLATE_STRING_IF_INVALID for variables not present in the\ncontext, just like other template constructs. SimpleLazyObject s will now present more helpful representations in shell\ndebugging situations. Generic GeometryField is now editable\nwith the OpenLayers widget in the admin. The documentation contains a deployment checklist . The diffsettings command gained a --all option. django.forms.fields.Field.__init__ now calls super() , allowing\nfield mixins to implement __init__() methods that will reliably be\ncalled. The validate_max parameter was added to BaseFormSet and formset_factory() , and ModelForm and inline\nversions of the same.  The behavior of validation for formsets with max_num was clarified.  The previously undocumented behavior that\nhardened formsets against memory exhaustion attacks was documented,\nand the undocumented limit of the higher of 1000 or max_num forms\nwas changed so it is always 1000 more than max_num . Added BCryptSHA256PasswordHasher to resolve the password truncation issue\nwith bcrypt. Pillow is now the preferred image manipulation library to use with\nDjango. PIL is pending deprecation (support to be removed in Django\n1.8). To upgrade, you should first uninstall PIL, then install\nPillow. ModelForm accepts several new Meta options. Fields included in the localized_fields list will be localized\n(by setting localize on the form field). The labels , help_texts and error_messages options may be used\nto customize the default fields, see Overriding the default fields for details. The choices argument to model fields now accepts an iterable of iterables\ninstead of requiring an iterable of lists or tuples. The reason phrase can be customized in HTTP responses using reason_phrase . When giving the URL of the next page for django.contrib.auth.views.logout() , django.contrib.auth.views.password_reset() , django.contrib.auth.views.password_reset_confirm() ,\nand django.contrib.auth.views.password_change() , you can now pass\nURL names and they will be resolved. The new dumpdata --pks option specifies the primary keys of objects\nto dump. This option can only be used with one model. Added QuerySet methods first() and last() which are convenience\nmethods returning the first or last object matching the filters. Returns None if there are no objects matching. View and RedirectView now support HTTP PATCH method. GenericForeignKey now takes an optional for_concrete_model argument,\nwhich when set to False allows the field to reference proxy models. The\ndefault is True to retain the old behavior. The LocaleMiddleware now stores the active\nlanguage in session if it is not present there. This prevents loss of\nlanguage settings after session flush, e.g. logout. SuspiciousOperation has been differentiated\ninto a number of subclasses, and each will log to a matching named logger\nunder the django.security logging hierarchy. Along with this change,\na handler400 mechanism and default view are used whenever\na SuspiciousOperation reaches the WSGI handler to return an HttpResponseBadRequest . The DoesNotExist exception now includes a\nmessage indicating the name of the attribute used for the lookup. The get_or_create() method no longer\nrequires at least one keyword argument. The SimpleTestCase class includes a new assertion\nhelper for testing formset errors: django.test.SimpleTestCase.assertFormsetError() . The list of related fields added to a QuerySet by select_related() can be cleared using select_related(None) . The get_extra() and get_max_num() methods on InlineModelAdmin may be overridden to\ncustomize the extra and maximum number of inline forms. Formsets now have a total_error_count() method. ModelForm fields can now override error messages\ndefined in model fields by using the error_messages argument of a Field ’s\nconstructor. To take advantage of this new feature with your custom fields, see the updated recommendation for raising\na ValidationError . ModelAdmin now preserves filters on the list view\nafter creating, editing or deleting an object. It’s possible to restore the previous\nbehavior of clearing filters by setting the preserve_filters attribute to False . Added FormMixin.get_prefix (which returns FormMixin.prefix by\ndefault) to allow customizing the prefix of the\nform. Raw queries ( Manager.raw() or cursor.execute() ) can now use the\n“pyformat” parameter style, where placeholders in the query are given as '%(name)s' and the parameters are passed as a dictionary rather than\na list (except on SQLite). This has long been possible (but not officially\nsupported) on MySQL and PostgreSQL, and is now also available on Oracle. The default iteration count for the PBKDF2 password hasher has been\nincreased by 20%. This backwards compatible change will not affect\nexisting passwords or users who have subclassed django.contrib.auth.hashers.PBKDF2PasswordHasher to change the\ndefault value. Passwords will be upgraded to use\nthe new iteration count as necessary. Backwards incompatible changes in 1.6 ¶ Warning In addition to the changes outlined in this section, be sure to review the deprecation plan for any features that\nhave been removed. If you haven’t updated your code within the\ndeprecation timeline for a given feature, its removal may appear as a\nbackwards incompatible change. New transaction management model ¶ Behavior changes ¶ Database-level autocommit is enabled by default in Django 1.6. While this\ndoesn’t change the general spirit of Django’s transaction management, there\nare a few backwards-incompatibilities. Savepoints and assertNumQueries ¶ The changes in transaction management may result in additional statements to\ncreate, release or rollback savepoints. This is more likely to happen with\nSQLite, since it didn’t support savepoints until this release. If tests using assertNumQueries() fail\nbecause of a higher number of queries than expected, check that the extra\nqueries are related to savepoints, and adjust the expected number of queries\naccordingly. Autocommit option for PostgreSQL ¶ In previous versions, database-level autocommit was only an option for\nPostgreSQL, and it was disabled by default. This option is now ignored and can\nbe removed. New test runner ¶ In order to maintain greater consistency with Python’s unittest module, the\nnew test runner ( django.test.runner.DiscoverRunner ) does not automatically\nsupport some types of tests that were supported by the previous runner: Tests in models.py and tests/__init__.py files will no longer be\nfound and run. Move them to a file whose name begins with test . Doctests will no longer be automatically discovered. To integrate doctests in\nyour test suite, follow the recommendations in the Python documentation . Django bundles a modified version of the doctest module from the Python\nstandard library (in django.test._doctest ) and includes some additional\ndoctest utilities. These utilities are deprecated and will be removed in Django\n1.8; doctest suites should be updated to work with the standard library’s\ndoctest module (or converted to unittest -compatible tests). If you wish to delay updates to your test suite, you can set your TEST_RUNNER setting to django.test.simple.DjangoTestSuiteRunner to fully restore the old test behavior. DjangoTestSuiteRunner is deprecated\nbut will not be removed from Django until version 1.8. Removal of django.contrib.gis.tests.GeoDjangoTestSuiteRunner GeoDjango custom test runner ¶ This is for developers working on the GeoDjango application itself and related\nto the item above about changes in the test runners: The django.contrib.gis.tests.GeoDjangoTestSuiteRunner test runner has been\nremoved and the standalone GeoDjango tests execution setup it implemented isn’t\nsupported anymore. To run the GeoDjango tests simply use the new DiscoverRunner and specify the django.contrib.gis app. Custom user models in tests ¶ The introduction of the new test runner has also slightly changed the way that\ntest models are imported. As a result, any test that overrides AUTH_USER_MODEL to test behavior with one of Django’s test user models ( django.contrib.auth.tests.custom_user.CustomUser and django.contrib.auth.tests.custom_user.ExtensionUser ) must now\nexplicitly import the User model in your test module: from django.contrib.auth.tests.custom_user import CustomUser @override_settings ( AUTH_USER_MODEL = \"auth.CustomUser\" ) class CustomUserFeatureTests ( TestCase ): def test_something ( self ): # Test code here ... This import forces the custom user model to be registered. Without this import,\nthe test will be unable to swap in the custom user model, and you will get an\nerror reporting: ImproperlyConfigured: AUTH_USER_MODEL refers to model 'auth.CustomUser' that has not been installed Time zone-aware day , month , and week_day lookups ¶ Django 1.6 introduces time zone support for day , month ,\nand week_day lookups when USE_TZ is True . These\nlookups were previously performed in UTC regardless of the current time zone. This requires time zone definitions in the database . If you’re using SQLite, you must install pytz . If you’re using MySQL, you must install pytz and load the time zone\ntables with mysql_tzinfo_to_sql . Addition of QuerySet.datetimes() ¶ When the time zone support added in Django 1.4\nwas active, QuerySet.dates() lookups returned unexpected results, because the aggregation was performed in\nUTC. To fix this, Django 1.6 introduces a new API, QuerySet.datetimes() . This requires a few changes in\nyour code. QuerySet.dates() returns date objects ¶ QuerySet.dates() now returns a\nlist of date . It used to return a list of datetime . QuerySet.datetimes() returns a list of datetime . QuerySet.dates() no longer usable on DateTimeField ¶ QuerySet.dates() raises an\nerror if it’s used on DateTimeField when time\nzone support is active. Use QuerySet.datetimes() instead. date_hierarchy requires time zone definitions ¶ The date_hierarchy feature of the\nadmin now relies on QuerySet.datetimes() when it’s used on a DateTimeField . This requires time zone definitions in the database when USE_TZ is True . Learn more . date_list in generic views requires time zone definitions ¶ For the same reason, accessing date_list in the context of a date-based\ngeneric view requires time zone definitions in the database when the view is\nbased on a DateTimeField and USE_TZ is True . Learn more . New lookups may clash with model fields ¶ Django 1.6 introduces hour , minute , and second lookups on DateTimeField . If you had model fields called hour , minute , or second , the new lookups will clash with you field\nnames. Append an explicit exact lookup if this is an issue. BooleanField no longer defaults to False ¶ When a BooleanField doesn’t have an explicit default , the implicit default value is None . In previous version of Django, it was False , but that didn’t\nrepresent accurately the lack of a value. Code that relies on the default value being False may raise an exception\nwhen saving new model instances to the database, because None isn’t an\nacceptable value for a BooleanField . You should\neither specify default=False in the field definition, or ensure the field\nis set to True or False before saving the object. Translations and comments in templates ¶ Extraction of translations after comments ¶ Extraction of translatable literals from templates with the makemessages command now correctly detects i18n constructs when\nthey are located after a {# / #} -type comment on the same line. E.g.: {# A comment #} {% trans \"This literal was incorrectly ignored. Not anymore\" %} Location of translator comments ¶ Comments for translators in templates specified using {# / #} need to\nbe at the end of a line. If they are not, the comments are ignored and makemessages will generate a warning. For example: {# Translators: This is ignored #} {% trans \"Translate me\" %} {{ title }} {# Translators: Extracted and associated with 'Welcome' below #} < h1 > {% trans \"Welcome\" %} </ h1 > Quoting in reverse() ¶ When reversing URLs, Django didn’t apply django.utils.http.urlquote to arguments before interpolating them in URL patterns. This bug is fixed in\nDjango 1.6. If you worked around this bug by applying URL quoting before\npassing arguments to reverse() , this may result in double-quoting. If this\nhappens, simply remove the URL quoting from your code. You will also have to\nreplace special characters in URLs used in assertRedirects() with their encoded\nversions. Storage of IP addresses in the comments app ¶ The comments app now uses a GenericIPAddressField for storing commenters’ IP addresses, to support\ncomments submitted from IPv6 addresses. Until now, it stored them in an IPAddressField , which is only meant to support IPv4. When saving a comment\nmade from an IPv6 address, the address would be silently truncated on MySQL\ndatabases, and raise an exception on Oracle. You will need to change the\ncolumn type in your database to benefit from this change. For MySQL, execute this query on your project’s database: ALTER TABLE django_comments MODIFY ip_address VARCHAR ( 39 ); For Oracle, execute this query: ALTER TABLE DJANGO_COMMENTS MODIFY ( ip_address VARCHAR2 ( 39 )); If you do not apply this change, the behavior is unchanged: on MySQL, IPv6\naddresses are silently truncated; on Oracle, an exception is generated. No\ndatabase change is needed for SQLite or PostgreSQL databases. Percent literals in cursor.execute queries ¶ When you are running raw SQL queries through the cursor.execute method, the rule about doubling\npercent literals ( % ) inside the query has been unified. Past behavior\ndepended on the database backend. Now, across all backends, you only need to\ndouble literal percent characters if you are also providing replacement\nparameters. For example: # No parameters, no percent doubling cursor . execute ( \"SELECT foo FROM bar WHERE baz = '30%'\" ) # Parameters passed, non-placeholders have to be doubled cursor . execute ( \"SELECT foo FROM bar WHERE baz = '30 %% ' and id = %s \" , [ self . id ]) SQLite users need to check and update such queries. Help text of model form fields for ManyToManyField fields ¶ HTML rendering of model form fields corresponding to ManyToManyField model fields used to get the\nhard-coded sentence: Hold down “Control”, or “Command” on a Mac, to select more than one. (or its translation to the active locale) imposed as the help legend shown along\nthem if neither model nor form help_text attributes were specified by the\nuser (or this string was appended to any help_text that was provided). Since this happened at the model layer, there was no way to prevent the text\nfrom appearing in cases where it wasn’t applicable such as form fields that\nimplement user interactions that don’t involve a keyboard and/or a mouse. Starting with Django 1.6, as an ad-hoc temporary backward-compatibility\nprovision, the logic to add the “Hold down…” sentence has been moved to the\nmodel form field layer and modified to add the text only when the associated\nwidget is SelectMultiple or selected subclasses. The change can affect you in a backward incompatible way if you employ custom\nmodel form fields and/or widgets for ManyToManyField model fields whose UIs\ndo rely on the automatic provision of the mentioned hard-coded sentence. These\nform field implementations need to adapt to the new scenario by providing their\nown handling of the help_text attribute. Applications that use Django model form facilities together with Django built-in form fields and widgets aren’t affected but need to be aware of\nwhat’s described in Munging of help text of model form fields for ManyToManyField fields below. QuerySet iteration ¶ The QuerySet iteration was changed to immediately convert all fetched\nrows to Model objects. In Django 1.5 and earlier the fetched rows were\nconverted to Model objects in chunks of 100. Existing code will work, but the amount of rows converted to objects\nmight change in certain use cases. Such usages include partially looping\nover a queryset or any usage which ends up doing __bool__ or __contains__ . Notably most database backends did fetch all the rows in one go already in\n1.5. It is still possible to convert the fetched rows to Model objects\nlazily by using the iterator() method. BoundField.label_tag now includes the form’s label_suffix ¶ This is consistent with how methods like Form.as_p and Form.as_ul render labels. If you manually render label_tag in your templates: {{ form.my_field.label_tag }} : {{ form.my_field }} you’ll want to remove the colon (or whatever other separator you may be\nusing) to avoid duplicating it when upgrading to Django 1.6. The following\ntemplate in Django 1.6 will render identically to the above template in Django\n1.5, except that the colon will appear inside the <label> element. {{ form.my_field.label_tag }} {{ form.my_field }} will render something like: < label for = \"id_my_field\" > My Field: </ label > < input id = \"id_my_field\" type = \"text\" name = \"my_field\" /> If you want to keep the current behavior of rendering label_tag without\nthe label_suffix , instantiate the form label_suffix='' . You can also\ncustomize the label_suffix on a per-field basis using the new label_suffix parameter on label_tag() . Admin views _changelist_filters GET parameter ¶ To achieve preserving and restoring list view filters, admin views now\npass around the _changelist_filters GET parameter. It’s important that you\naccount for that change if you have custom admin templates or if your tests\nrely on the previous URLs. If you want to revert to the original behavior you\ncan set the preserve_filters attribute to False . django.contrib.auth password reset uses base 64 encoding of User PK ¶ Past versions of Django used base 36 encoding of the User primary key in\nthe password reset views and URLs\n( django.contrib.auth.views.password_reset_confirm() ). Base 36 encoding is\nsufficient if the user primary key is an integer, however, with the\nintroduction of custom user models in Django 1.5, that assumption may no longer\nbe true. django.contrib.auth.views.password_reset_confirm() has been modified to\ntake a uidb64 parameter instead of uidb36 . If you are reversing this\nview, for example in a custom password_reset_email.html template, be sure\nto update your code. A temporary shim for django.contrib.auth.views.password_reset_confirm() that will allow password reset links generated prior to Django 1.6 to continue\nto work has been added to provide backwards compatibility; this will be removed\nin Django 1.7. Thus, as long as your site has been running Django 1.6 for more\nthan PASSWORD_RESET_TIMEOUT_DAYS , this change will have no effect.\nIf not (for example, if you upgrade directly from Django 1.5 to Django 1.7),\nthen any password reset links generated before you upgrade to Django 1.7 or\nlater won’t work after the upgrade. In addition, if you have any custom password reset URLs, you will need to\nupdate them by replacing uidb36 with uidb64 and the dash that follows\nthat pattern with a slash. Also add _\\- to the list of characters that may\nmatch the uidb64 pattern. For example: url ( r \"^reset/(?P<uidb36>[0-9A-Za-z]+)-(?P<token>.+)/$\" , \"django.contrib.auth.views.password_reset_confirm\" , name = \"password_reset_confirm\" , ), becomes: url ( r \"^reset/(?P<uidb64>[0-9A-Za-z_\\-]+)/(?P<token>.+)/$\" , \"django.contrib.auth.views.password_reset_confirm\" , name = \"password_reset_confirm\" , ), You may also want to add the shim to support the old style reset links. Using\nthe example above, you would modify the existing url by replacing django.contrib.auth.views.password_reset_confirm with django.contrib.auth.views.password_reset_confirm_uidb36 and also remove\nthe name argument so it doesn’t conflict with the new url: url ( r \"^reset/(?P<uidb36>[0-9A-Za-z]+)-(?P<token>.+)/$\" , \"django.contrib.auth.views.password_reset_confirm_uidb36\" , ), You can remove this URL pattern after your app has been deployed with Django\n1.6 for PASSWORD_RESET_TIMEOUT_DAYS . Default session serialization switched to JSON ¶ Historically, django.contrib.sessions used pickle to serialize\nsession data before storing it in the backend. If you’re using the signed\ncookie session backend and SECRET_KEY is\nknown by an attacker (there isn’t an inherent vulnerability in Django that\nwould cause it to leak), the attacker could insert a string into their session\nwhich, when unpickled, executes arbitrary code on the server. The technique for\ndoing so is simple and easily available on the internet. Although the cookie\nsession storage signs the cookie-stored data to prevent tampering, a SECRET_KEY leak immediately escalates to a remote code execution\nvulnerability. This attack can be mitigated by serializing session data using JSON rather\nthan pickle . To facilitate this, Django 1.5.3 introduced a new setting, SESSION_SERIALIZER , to customize the session serialization format.\nFor backwards compatibility, this setting defaulted to using pickle in Django 1.5.3, but we’ve changed the default to JSON in 1.6. If you upgrade\nand switch from pickle to JSON, sessions created before the upgrade will be\nlost. While JSON serialization does not support all Python objects like pickle does, we highly recommend using JSON-serialized sessions. Be\naware of the following when checking your code to determine if JSON\nserialization will work for your application: JSON requires string keys, so you will likely run into problems if you are\nusing non-string keys in request.session . Setting session expiration by passing datetime values to set_expiry() will\nnot work as datetime values are not serializable in JSON. You can use\ninteger values instead. See the Session serialization documentation for more details. Object Relational Mapper changes ¶ Django 1.6 contains many changes to the ORM. These changes fall mostly in\nthree categories: Bug fixes (e.g. proper join clauses for generic relations, query combining,\njoin promotion, and join trimming fixes) Preparation for new features. For example the ORM is now internally ready\nfor multicolumn foreign keys. General cleanup. These changes can result in some compatibility problems. For example, some\nqueries will now generate different table aliases. This can affect QuerySet.extra() . In addition\nsome queries will now produce different results. An example is exclude(condition) where the condition is a complex one (referencing multijoins inside Q objects ). In many cases the affected\nqueries didn’t produce correct results in Django 1.5 but do now.\nUnfortunately there are also cases that produce different results, but\nneither Django 1.5 nor 1.6 produce correct results. Finally, there have been many changes to the ORM internal APIs. Miscellaneous ¶ The django.db.models.query.EmptyQuerySet can’t be instantiated any more -\nit is only usable as a marker class for checking if none() has been called: isinstance(qs.none(), EmptyQuerySet) If your CSS/JavaScript code used to access HTML input widgets by type, you\nshould review it as type='text' widgets might be now output as type='email' , type='url' or type='number' depending on their\ncorresponding field type. Form field’s error_messages that contain a\nplaceholder should now always use a named placeholder ( \"Value '%(value)s' is too big\" instead of \"Value '%s' is too big\" ). See the corresponding\nfield documentation for details about the names of the placeholders. The\nchanges in 1.6 particularly affect DecimalField and ModelMultipleChoiceField . Some error_messages for IntegerField , EmailField , IPAddressField , GenericIPAddressField , and SlugField have been suppressed because they\nduplicated error messages already provided by validators tied to the fields. Due to a change in the form validation workflow, TypedChoiceField coerce method should always\nreturn a value present in the choices field attribute. That limitation\nshould be lift again in Django 1.7. There have been changes in the way timeouts are handled in cache backends.\nExplicitly passing in timeout=None no longer results in using the\ndefault timeout. It will now set a non-expiring timeout. Passing 0 into the\nmemcache backend no longer uses the default timeout, and now will\nset-and-expire-immediately the value. The django.contrib.flatpages app used to set custom HTTP headers for\ndebugging purposes. This functionality was not documented and made caching\nineffective so it has been removed, along with its generic implementation,\npreviously available in django.core.xheaders . The XViewMiddleware has been moved from django.middleware.doc to django.contrib.admindocs.middleware because it is an implementation\ndetail of admindocs, proven not to be reusable in general. GenericIPAddressField will now only allow blank values if null values are also allowed. Creating a GenericIPAddressField where blank is allowed but null is not\nwill trigger a model validation error because blank values are always\nstored as null . Previously, storing a blank value in a field which\ndid not allow null would cause a database exception at runtime. If a NoReverseMatch exception is raised from a method when rendering a\ntemplate, it is not silenced. For example, {{ obj.view_href }} will\ncause template rendering to fail if view_href() raises NoReverseMatch . There is no change to the {% url %} tag, it\ncauses template rendering to fail like always when NoReverseMatch is\nraised. django.test.Client.logout() now calls django.contrib.auth.logout() which will send the user_logged_out() signal. Authentication views are now reversed by name,\nnot their locations in django.contrib.auth.views . If you are using the\nviews without a name , you should update your urlpatterns to use django.conf.urls.url() with the name parameter. For example: ( r \"^reset/done/$\" , \"django.contrib.auth.views.password_reset_complete\" ) becomes: url ( r \"^reset/done/$\" , \"django.contrib.auth.views.password_reset_complete\" , name = \"password_reset_complete\" , ) RedirectView now has a pattern_name attribute which allows it to choose the target by reversing the URL. In Django 1.4 and 1.5, a blank string was unintentionally not considered to\nbe a valid password. This meant set_password() would save a blank\npassword as an unusable password like set_unusable_password() does, and\nthus check_password() always\nreturned False for blank passwords. This has been corrected in this\nrelease: blank passwords are now valid. The admin changelist_view previously\naccepted a pop GET parameter to signify it was to be displayed in a popup.\nThis parameter has been renamed to _popup to be consistent with the rest\nof the admin views. You should update your custom templates if they use the\nprevious parameter name. validate_email() now accepts email addresses\nwith localhost as the domain. The new makemessages --keep-pot option prevents deleting the\ntemporary .pot file generated before creating the .po file. The undocumented django.core.servers.basehttp.WSGIServerException has\nbeen removed. Use socket.error provided by the standard library instead.\nThis change was also released in Django 1.5.5. The signature of django.views.generic.base.RedirectView.get_redirect_url() has changed and now accepts positional arguments as well ( *args, **kwargs ).\nAny unnamed captured group will now be passed to get_redirect_url() which may result in a TypeError if you don’t update the signature of your\ncustom method. Features deprecated in 1.6 ¶ Transaction management APIs ¶ Transaction management was completely overhauled in Django 1.6, and the\ncurrent APIs are deprecated: django.middleware.transaction.TransactionMiddleware django.db.transaction.autocommit django.db.transaction.commit_on_success django.db.transaction.commit_manually the TRANSACTIONS_MANAGED setting django.contrib.comments ¶ Django’s comment framework has been deprecated and is no longer supported. It\nwill be available in Django 1.6 and 1.7, and removed in Django 1.8. Most users\nwill be better served with a custom solution, or a hosted product like Disqus . The code formerly known as django.contrib.comments is still available\nin an external repository . Support for PostgreSQL versions older than 8.4 ¶ The end of upstream support periods was reached in December 2011 for\nPostgreSQL 8.2 and in February 2013 for 8.3. As a consequence, Django 1.6 sets\n8.4 as the minimum PostgreSQL version it officially supports. You’re strongly encouraged to use the most recent version of PostgreSQL\navailable, because of performance improvements and to take advantage of the\nnative streaming replication available in PostgreSQL 9.x. Changes to cycle and firstof ¶ The template system generally escapes all variables to avoid XSS attacks.\nHowever, due to an accident of history, the cycle and firstof tags render their arguments as-is. Django 1.6 starts a process to correct this inconsistency. The future template library provides alternate implementations of cycle and firstof that autoescape their inputs. If you’re using these tags,\nyou’re encouraged to include the following line at the top of your templates to\nenable the new behavior: {% load cycle from future %} or: {% load firstof from future %} The tags implementing the old behavior have been deprecated, and in Django\n1.8, the old behavior will be replaced with the new behavior. To ensure\ncompatibility with future versions of Django, existing templates should be\nmodified to use the future versions. If necessary, you can temporarily disable auto-escaping with mark_safe() or {% autoescape off %} . CACHE_MIDDLEWARE_ANONYMOUS_ONLY setting ¶ CacheMiddleware and UpdateCacheMiddleware used to provide a way to\ncache requests only if they weren’t made by a logged-in user. This mechanism\nwas largely ineffective because the middleware correctly takes into account the Vary: Cookie HTTP header, and this header is being set on a variety of\noccasions, such as: accessing the session, or using CSRF protection, which is turned on by default, or using a client-side library which sets cookies, like Google Analytics . This makes the cache effectively work on a per-session basis regardless of the CACHE_MIDDLEWARE_ANONYMOUS_ONLY setting. SEND_BROKEN_LINK_EMAILS setting ¶ CommonMiddleware used to provide basic\nreporting of broken links by email when SEND_BROKEN_LINK_EMAILS is set to True . Because of intractable ordering problems between CommonMiddleware and LocaleMiddleware , this feature was split\nout into a new middleware: BrokenLinkEmailsMiddleware . If you’re relying on this feature, you should add 'django.middleware.common.BrokenLinkEmailsMiddleware' to your MIDDLEWARE_CLASSES setting and remove SEND_BROKEN_LINK_EMAILS from your settings. _has_changed method on widgets ¶ If you defined your own form widgets and defined the _has_changed method\non a widget, you should now define this method on the form field itself. module_name model _meta attribute ¶ Model._meta.module_name was renamed to model_name . Despite being a\nprivate API, it will go through a regular deprecation path. get_(add|change|delete)_permission model _meta methods ¶ Model._meta.get_(add|change|delete)_permission methods were deprecated.\nEven if they were not part of the public API they’ll also go through\na regular deprecation path. You can replace them with django.contrib.auth.get_permission_codename('action', Model._meta) where 'action' is 'add' , 'change' , or 'delete' . get_query_set and similar methods renamed to get_queryset ¶ Methods that return a QuerySet such as Manager.get_query_set or ModelAdmin.queryset have been renamed to get_queryset . If you are writing a library that implements, for example, a Manager.get_query_set method, and you need to support old Django versions,\nyou should rename the method and conditionally add an alias with the old name: class CustomManager ( models . Manager ): def get_queryset ( self ): pass # ... if django . VERSION < ( 1 , 6 ): get_query_set = get_queryset # For Django >= 1.6, models.Manager provides a get_query_set fallback # that emits a warning when used. If you are writing a library that needs to call the get_queryset method and\nmust support old Django versions, you should write: get_queryset = ( some_manager . get_query_set if hasattr ( some_manager , \"get_query_set\" ) else some_manager . get_queryset ) return get_queryset () # etc In the general case of a custom manager that both implements its own get_queryset method and calls that method, and needs to work with older Django\nversions, and libraries that have not been updated yet, it is useful to define\na get_queryset_compat method as below and use it internally to your manager: class YourCustomManager ( models . Manager ): def get_queryset ( self ): return YourCustomQuerySet () # for example if django . VERSION < ( 1 , 6 ): get_query_set = get_queryset def active ( self ): # for example return self . get_queryset_compat () . filter ( active = True ) def get_queryset_compat ( self ): get_queryset = ( self . get_query_set if hasattr ( self , \"get_query_set\" ) else self . get_queryset ) return get_queryset () This helps to minimize the changes that are needed, but also works correctly in\nthe case of subclasses (such as RelatedManagers from Django 1.5) which might\noverride either get_query_set or get_queryset . shortcut view and URLconf ¶ The shortcut view was moved from django.views.defaults to django.contrib.contenttypes.views shortly after the 1.0 release, but the\nold location was never deprecated. This oversight was corrected in Django 1.6\nand you should now use the new location. The URLconf django.conf.urls.shortcut was also deprecated. If you’re\nincluding it in an URLconf, simply replace: ( r \"^prefix/\" , include ( \"django.conf.urls.shortcut\" )), with: ( r \"^prefix/(?P<content_type_id>\\d+)/(?P<object_id>.*)/$\" , \"django.contrib.contenttypes.views.shortcut\" , ), ModelForm without fields or exclude ¶ Previously, if you wanted a ModelForm to use all fields on\nthe model, you could simply omit the Meta.fields attribute, and all fields\nwould be used. This can lead to security problems where fields are added to the model and,\nunintentionally, automatically become editable by end users. In some cases,\nparticular with boolean fields, it is possible for this problem to be completely\ninvisible. This is a form of Mass assignment vulnerability . For this reason, this behavior is deprecated, and using the Meta.exclude option is strongly discouraged. Instead, all fields that are intended for\ninclusion in the form should be listed explicitly in the fields attribute. If this security concern really does not apply in your case, there is a shortcut\nto explicitly indicate that all fields should be used - use the special value \"__all__\" for the fields attribute: class MyModelForm ( ModelForm ): class Meta : fields = \"__all__\" model = MyModel If you have custom ModelForms that only need to be used in the admin, there\nis another option. The admin has its own methods for defining fields\n( fieldsets etc.), and so adding a list of fields to the ModelForm is\nredundant. Instead, simply omit the Meta inner class of the ModelForm ,\nor omit the Meta.model attribute. Since the ModelAdmin subclass knows\nwhich model it is for, it can add the necessary attributes to derive a\nfunctioning ModelForm . This behavior also works for earlier Django\nversions. UpdateView and CreateView without explicit fields ¶ The generic views CreateView and UpdateView , and anything else derived from ModelFormMixin , are vulnerable to the\nsecurity problem described in the section above, because they can automatically\ncreate a ModelForm that uses all fields for a model. For this reason, if you use these views for editing models, you must also supply\nthe fields attribute (new in Django 1.6), which is a list of model fields\nand works in the same way as the ModelForm Meta.fields attribute. Alternatively, you can set the form_class attribute to a ModelForm that explicitly defines the fields to be used.\nDefining an UpdateView or CreateView subclass to be used with a model\nbut without an explicit list of fields is deprecated. Munging of help text of model form fields for ManyToManyField fields ¶ All special handling of the help_text attribute of ManyToManyField model\nfields performed by standard model or model form fields as described in Help text of model form fields for ManyToManyField fields above is deprecated and will be removed in Django 1.8. Help text of these fields will need to be handled either by applications, custom\nform fields or widgets, just like happens with the rest of the model field\ntypes.", "keywords": ["users", "get_queryset", "rows", "exclude(condition", "feature", "select_related(none", "timeouts", "integerfield", "storage", "pattern", "formset", "form.my_field.label_tag", "cleanup", "iterables", "emailfield", "relational", "messages", "relatedmanagers", "pillow", "occasions", "formsets", "extraction", "library", "field", "#", "legend", "runner", "serialization", "flush", "xviewmiddleware", "coerce", "type='email", "numbers", "object_id>.*)/$", "spirit", "action", "django.db.models", "member", "cache", "compatibility", "manytomanyfield.db_constraint", "malcolm", "set_unusable_password", "total_error_count", "form.as_ul", "modelmultiplechoicefield", "non", "csrf_cookie_httponly", "constructs", "change", "colon", "literal", "pattern_name", "links", "testcase.test_method_name", "suite", "recommendation", "label", "shim", "presence", "truncation", "name)s", "http", "ip_address", "changes", "=", "keyboard", "usages", "results", "customuserfeaturetests", "message", "categories", "permissiondenied", "basecommand.leave_locale_alone", "cursor.execute", "get_redirect_url", "shell", "inputs", "type='text", "setup", "tables", "tag", "zones", "sets", "openlayers", "genericforeignkey", "process", "separator", "fallback", "software", "mac", "interactions", "django.conf.urls.url", "autoescape", "ipv4", "following", "type", "error_messages", "symmetry", "custom", "kwargs", "objects", "documentation", "combining", "lookups", ".po", "mind", "discoverrunner", "file", "modules", "latter", "user", "autocommit", "cases", "js", "attribute", "helper", "args", "mentorship", "mechanism", "pickle", "django.contrib.gis", "queryset.datetimes", "developers", "warning", "time", "workflow", "tags", "expiration", "basis", "jquery", "inlinemodeladmin", "date", "startapp", "setting", "purposes", "responses", "account", "memcache", "hour", "customuser", "form.my_field", "request.session", "modeladmin.queryset", "password", "iterator", "logic", "name", "custommanager", "django.test.simple", "django.contrib.auth.get_permission_codename('action", "parameter", "rule", "test_runner", "execution", "leak", "escaping", "codebase", "backends", "django.contrib.auth", "issue", "upgrade", "problems", "versions", "quoting", "oversight", "django.db.transaction.autocommit", "queries", "simpletestcase", "date_list", "\\-", "manager", "analytics", "django.middleware.doc", "literals", "addresses", "return", "reverse", "applications", "9a", "memory", "consideration", "foo", "use_tz", "isolation", "december", "reason_phrase", "fieldsets", "uis", "datetimefield", "model._meta.get_(add|change|delete)_permission", "mymodel", "tredinnick", "django.test.client.logout", "commonmiddleware", "aliases", "emptyqueryset", "february", "plan", "bool", "checklist", "model.save", "url", "proxy", "error", "join", "module", "timeout", "code", "wsgiserverexception", "my_field", "algorithm", "decimalfield", "auth", "localize", "filter", "false", "behavior", "style", "i", "class", "placeholders", "discovery", "group", "widget", "geo", "names", "returns", "javascript", "done/$", "contributions", "pbkdf2", "uidb64>[0", "attack", "request", "past", "patience", "database", "flag", "output", "input", "signal", "*", "query", "page", "test", "commands", "postgresql", "suspiciousoperation", "z]+)-(?p", "count", "django.contrib.comments", "types", "sentence", "contributor", "locales", "floatfield", "subclass", "admin", "2.7.x", "django.contrib.auth.tests.custom_user", "insert", "usage", "password_reset_email.html", "noreversematch", "help_text", "wsgi", "configuration", "auth_user_model", "limit", "redirectview", "validation", "flexibility", "successmessagemixin", "limitations", "modelforms", "pyformat", "section", "translator", "django.contrib.auth.views.password_reset_confirm_uidb36", "developer", "source", "set_expiry", "representations", "mass", "modify", "pop", "css", "django.db.models.query", "use", "placeholder", "replacement", "help_texts", "model._meta", "manipulation", "doctests", "baz", "solution", "boundfield.label_tag", "subclasses", "multijoins", "repository", "performance", "protection", "id_my_field", "genericipaddressfield", "core", "pass", "type='number", "product", "order", "^prefix/", "signature", "cachemiddleware", "default", "baseformset", "obj.view_href", "django.contrib.auth.views.password_change", "choices", "inclusion", "team", "alias", "bug", "comment", "form", "prefix", "dash", "option", "format", "callback", "classes", "tests", "characters", "help", "percent", "django.contrib.admindocs.middleware", "set_password", "day", "bcrypt", "browsers", "get_max_num", "concern", "booleanfield", "@override_settings", "queryset.extra", "convenience", "advantage", "validationerror", "queryset.dates", "django.middleware.common", "chain", "cursor", "aware", "foreignkey.db_constraint", "limitation", "template", "header", "varchar", "way", "internet", "django.core.xheaders", "phrase", "django.contrib.auth.views", "manager.raw", "comments", "multicolumn", "syndication", "runners", "queryset", "integer", "periods", "session", "streaming", "¶", "varchar2", "command", "pil", "type='url", "parameters", "admindocs", "side", "django.contrib.gis.tests", "suites", "formmixin.prefix", "disqus", "implementations", "protocol", "views", "replication", "testing", "result", "meta.model", "view", "django.security", "yourcustommanager", "django.contrib.sessions", "control", "zone", "popup", "number", "djangotestsuiterunner", "label_suffix=", "meta.exclude", "relations", "modelform", "def", "values", "generic", "string", "_", "django.views.generic.base", "timeline", "memcachedcache", "provision", "auto", "connections", "databases", "formmixin.get_prefix", "accident", "django.forms.fields", "preserve_filters", "location", "table", "libraries", "language", "facilities", "models", "history", "ipv6", "version", "scenario", "changelist_view", "level", "json", "cache_middleware_anonymous_only", "commenters", "width", "image", "labels", "deprecation", "condition", "on", "minimum", "user_logged_out", "django", "series", "vulnerability", "django.middleware.transaction", "n’t", "2.6.x", "formset_factory", "fields", "label_tag", "utilities", "tastes", "ip", "dumpdata", "fixes", "pseudo", "urlpatterns", "password_reset_complete", "value", "assertion", "line", "improperlyconfigured", "hierarchy", "pep", "data", "columns", "implementation", "handler", "mixins", "item", "datetime", "base", "backend", "patch", "layer", "inline", "iterable", "view_href", "standalone", "token>.+)/$", "django.contrib.auth.views.logout", "updates", "tampering", "security", "shortcut", "paths", "self", "instance", "some_manager", "diffsettings", "typeerror", "z_\\-]+)/(?p", "promotion", "reporting", "aggregation", "yourcustomqueryset", "makemessages", "django.contrib.syndication", "updateview", "handling", "handler400", "consequence", "alter", "validators", "ad", "modeladmin", "pot", "functionality", "za", "2.6.5", "ipaddressfield", "form_class", "assertredirects", "docs", "httpresponsebadrequest", "1.9.1", "constructor", "./manage.py", "instances", "socket.error", "simpletestcase.assertformseterror", "mymodelform", "inconsistency", "^prefix/(?p", "part", "object", "patches", "load", "march", "extensionuser", "deployment", "domain", "valueerror", "localemiddleware", "management", "response", "get_extra", "november", "django.contrib.auth.hashers", "manytomanyfield", "dictionary", "sql", "requests", "exhaustion", "reset", "locale", "situations", "binaryfield", "rendering", "keyword", "unittest2", "minute", "s", "csrf", "ordering", "logger", "force", "top", "variables", "--keep", "rest", "notes", "attacker", "effect", "detail", "system", "address", "savepoints", "overhead", "clauses", "field.__init", "welcome", "password_reset_timeout_days", "widgets", "applabel", "removal", "definition", "headers", "slash", "target", "check", "html5", "features", "forms", "site", "consistency", "munging", "incompatibility", "backwards", "inspiration", "form.as_p", "addition", "lists", "example", "get_query_set", "django.contrib.contenttypes.views", "app", "month", "locations", "column", "pytz", "list", "loss", "orm", "get_(add|change|delete)_permission", "utc", "uidb64", ".pot", "changelist_filters", "get_queryset_compat", "content_type_id>\\d+)/(?p", "hasher", "community", "email", "preparation", "google", "incompatibilities", "model", "password_reset_confirm", "year", "apis", "value)s", "element", "application", "encoding", "urlfield", "attributes", "testcase", "slugfield", "vary", "title", "editing", "release", "django.views.defaults", "django.contrib.auth.views.password_reset_confirm", "localhost", "urlconf", "variety", "translation", "friend", "dedication", "django.core.servers.basehttp", "r", "select", "model._meta.module_name", "prevention", "formview", "validate_email", "rollback", "keys", "case", "h1", "recommendations", "authentication", "lookup", "assignment", "redirectview.get_redirect_url", "hasattr", "null", "technique", "runtime", "html", "errors", "^reset", "server", "arguments", "introduction", "passwords", "package", "init", "middleware", "transactionmiddleware", "one", "xss", "mapper", "uidb36", "translations", "end", "improvements", "sqlite", "e.g.", "startproject", "matching", "tuples", "selectmultiple", "secret_key", "amount", "assertnumqueries", "bar", "firstof", "path", "key", "manager.get_query_set", "trans", "update", "none", "filters", "problem", "bcryptsha256passwordhasher", "django.contrib.flatpages", "meta", "):", "get", "patterns", "definitions", "feed.get_context_data", "reason", "framework", "q", "true", "urls", "geometryfield", "api", "sessions", "support", "cookies", "projects", "assumption", "max_num", "connection", "-", "context", "cycle", "files", "import", "success_url", "blocktrans", "d", "iteration", "mysql", "directory", "%", "statements", "pk", "meta.fields", "chunks", "createview", "row", "python", "updatecachemiddleware", "django.test.runner", "translators", "mouse", "methods", "trigger", "modelformmixin", "options", "exception", "mysql_tzinfo_to_sql", "client", "details", "geodjango", "method", "verification", "settings", "transaction", "ships", "argument", "isinstance(qs.none", "cookie", "note", "sites", "-type", "deletionmixin", "model_name", "oracle", "attacks", "marker", "mark_safe", "templates", "beginning", "lack", "label_suffix", "text", "typedchoicefield", "project", "exceptions"], "type": "documentation"},
{"title": "Databases | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/databases/", "content": "Databases ¶ Django officially supports the following databases: PostgreSQL MariaDB MySQL Oracle SQLite There are also a number of database backends provided by third parties . Django attempts to support as many features as possible on all database\nbackends. However, not all database backends are alike, and we’ve had to make\ndesign decisions on which features to support and which assumptions we can make\nsafely. This file describes some of the features that might be relevant to Django\nusage. It is not intended as a replacement for server-specific documentation or\nreference manuals. General notes ¶ Persistent connections ¶ Persistent connections avoid the overhead of reestablishing a connection to\nthe database in each HTTP request. They’re controlled by the CONN_MAX_AGE parameter which defines the maximum lifetime of a\nconnection. It can be set independently for each database. The default value is 0 , preserving the historical behavior of closing the\ndatabase connection at the end of each request. To enable persistent\nconnections, set CONN_MAX_AGE to a positive integer of seconds. For\nunlimited persistent connections, set it to None . Connection management ¶ Django opens a connection to the database when it first makes a database\nquery. It keeps this connection open and reuses it in subsequent requests.\nDjango closes the connection once it exceeds the maximum age defined by CONN_MAX_AGE or when it isn’t usable any longer. In detail, Django automatically opens a connection to the database whenever it\nneeds one and doesn’t have one already — either because this is the first\nconnection, or because the previous connection was closed. At the beginning of each request, Django closes the connection if it has\nreached its maximum age. If your database terminates idle connections after\nsome time, you should set CONN_MAX_AGE to a lower value, so that\nDjango doesn’t attempt to use a connection that has been terminated by the\ndatabase server. (This problem may only affect very low traffic sites.) At the end of each request, Django closes the connection if it has reached its\nmaximum age or if it is in an unrecoverable error state. If any database\nerrors have occurred while processing the requests, Django checks whether the\nconnection still works, and closes it if it doesn’t. Thus, database errors\naffect at most one request per each application’s worker thread; if the\nconnection becomes unusable, the next request gets a fresh connection. Setting CONN_HEALTH_CHECKS to True can be used to improve the\nrobustness of connection reuse and prevent errors when a connection has been\nclosed by the database server which is now ready to accept and serve new\nconnections, e.g. after database server restart. The health check is performed\nonly once per request and only if the database is being accessed during the\nhandling of the request. Caveats ¶ Since each thread maintains its own connection, your database must support at\nleast as many simultaneous connections as you have worker threads. Sometimes a database won’t be accessed by the majority of your views, for\nexample because it’s the database of an external system, or thanks to caching.\nIn such cases, you should set CONN_MAX_AGE to a low value or even 0 , because it doesn’t make sense to maintain a connection that’s unlikely\nto be reused. This will help keep the number of simultaneous connections to\nthis database small. The development server creates a new thread for each request it handles,\nnegating the effect of persistent connections. Don’t enable them during\ndevelopment. When Django establishes a connection to the database, it sets up appropriate\nparameters, depending on the backend being used. If you enable persistent\nconnections, this setup is no longer repeated every request. If you modify\nparameters such as the connection’s isolation level or time zone, you should\neither restore Django’s defaults at the end of each request, force an\nappropriate value at the beginning of each request, or disable persistent\nconnections. If a connection is created in a long-running process, outside of Django’s\nrequest-response cycle, the connection will remain open until explicitly\nclosed, or timeout occurs. You can use django.db.close_old_connections() to\nclose all old or unusable connections. Encoding ¶ Django assumes that all databases use UTF-8 encoding. Using other encodings may\nresult in unexpected behavior such as “value too long” errors from your\ndatabase for data that is valid in Django. See the database specific notes\nbelow for information on how to set up your database correctly. PostgreSQL notes ¶ Django supports PostgreSQL 13 and higher. psycopg 3.1.8+ or psycopg2 2.8.4+ is required, though the latest psycopg 3.1.8+ is recommended. Note Support for psycopg2 is likely to be deprecated and removed at some\npoint in the future. PostgreSQL connection settings ¶ See HOST for details. To connect using a service name from the connection service file and a\npassword from the password file , you must specify them in the OPTIONS part of your database configuration in DATABASES : settings.py ¶ DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.postgresql\" , \"OPTIONS\" : { \"service\" : \"my_service\" , \"passfile\" : \".my_pgpass\" , }, } } .pg_service.conf ¶ [my_service]\nhost=localhost\nuser=USER\ndbname=NAME\nport=5432 .my_pgpass ¶ localhost:5432:NAME:USER:PASSWORD The PostgreSQL backend passes the content of OPTIONS as keyword\narguments to the connection constructor, allowing for more advanced control\nof driver behavior. All available parameters are described in detail in the\nPostgreSQL documentation. Warning Using a service name for testing purposes is not supported. This may be implemented later . Optimizing PostgreSQL’s configuration ¶ Django needs the following parameters for its database connections: client_encoding : 'UTF8' , default_transaction_isolation : 'read committed' by default,\nor the value set in the connection options (see below), timezone : when USE_TZ is True , 'UTC' by default, or the TIME_ZONE value set for the connection, when USE_TZ is False , the value of the global TIME_ZONE setting. If these parameters already have the correct values, Django won’t set them for\nevery new connection, which improves performance slightly. You can configure\nthem directly in postgresql.conf or more conveniently per database\nuser with ALTER ROLE . Django will work just fine without this optimization, but each new connection\nwill do some additional queries to set these parameters. Isolation level ¶ Like PostgreSQL itself, Django defaults to the READ COMMITTED isolation\nlevel . If you need a higher isolation level such as REPEATABLE READ or SERIALIZABLE , set it in the OPTIONS part of your database\nconfiguration in DATABASES : from django.db.backends.postgresql.psycopg_any import IsolationLevel DATABASES = { # ... \"OPTIONS\" : { \"isolation_level\" : IsolationLevel . SERIALIZABLE , }, } Note Under higher isolation levels, your application should be prepared to\nhandle exceptions raised on serialization failures. This option is\ndesigned for advanced uses. Role ¶ If you need to use a different role for database connections than the role use\nto establish the connection, set it in the OPTIONS part of your\ndatabase configuration in DATABASES : DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.postgresql\" , # ... \"OPTIONS\" : { \"assume_role\" : \"my_application_role\" , }, }, } Connection pool ¶ New in Django 5.1. To use a connection pool with psycopg , you can either set \"pool\" in the OPTIONS part of your database configuration in DATABASES to be a dict to be passed to ConnectionPool , or\nto True to use the ConnectionPool defaults: DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.postgresql\" , # ... \"OPTIONS\" : { \"pool\" : True , }, }, } This option requires psycopg[pool] or psycopg-pool to be installed\nand is ignored with psycopg2 . Server-side parameters binding ¶ With psycopg 3.1.8+, Django defaults to the client-side binding\ncursors . If you want to use the server-side binding set it in the OPTIONS part of your database configuration in DATABASES : DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.postgresql\" , # ... \"OPTIONS\" : { \"server_side_binding\" : True , }, }, } This option is ignored with psycopg2 . Indexes for varchar and text columns ¶ When specifying db_index=True on your model fields, Django typically\noutputs a single CREATE INDEX statement.  However, if the database type\nfor the field is either varchar or text (e.g., used by CharField , FileField , and TextField ), then Django will create\nan additional index that uses an appropriate PostgreSQL operator class for the column.  The extra index is necessary to correctly perform\nlookups that use the LIKE operator in their SQL, as is done with the contains and startswith lookup types. Migration operation for adding extensions ¶ If you need to add a PostgreSQL extension (like hstore , postgis , etc.)\nusing a migration, use the CreateExtension operation. Server-side cursors ¶ When using QuerySet.iterator() , Django opens a server-side\ncursor . By default, PostgreSQL assumes that\nonly the first 10% of the results of cursor queries will be fetched. The query\nplanner spends less time planning the query and starts returning results\nfaster, but this could diminish performance if more than 10% of the results are\nretrieved. PostgreSQL’s assumptions on the number of rows retrieved for a\ncursor query is controlled with the cursor_tuple_fraction option. Transaction pooling and server-side cursors ¶ Using a connection pooler in transaction pooling mode (e.g. PgBouncer )\nrequires disabling server-side cursors for that connection. Server-side cursors are local to a connection and remain open at the end of a\ntransaction when AUTOCOMMIT is True . A\nsubsequent transaction may attempt to fetch more results from a server-side\ncursor. In transaction pooling mode, there’s no guarantee that subsequent\ntransactions will use the same connection. If a different connection is used,\nan error is raised when the transaction references the server-side cursor,\nbecause server-side cursors are only accessible in the connection in which they\nwere created. One solution is to disable server-side cursors for a connection in DATABASES by setting DISABLE_SERVER_SIDE_CURSORS to True . To benefit from server-side cursors in transaction pooling mode, you could set\nup another connection to the database in order to\nperform queries that use server-side cursors. This connection needs to either\nbe directly to the database or to a connection pooler in session pooling mode. Another option is to wrap each QuerySet using server-side cursors in an atomic() block, because it disables autocommit for the duration of the transaction. This way, the server-side cursor will only\nlive for the duration of the transaction. Manually-specifying values of auto-incrementing primary keys ¶ Django uses PostgreSQL’s identity columns to store auto-incrementing primary\nkeys. An identity column is populated with values from a sequence that keeps\ntrack of the next available value. Manually assigning a value to an\nauto-incrementing field doesn’t update the field’s sequence, which might later\ncause a conflict. For example: >>> from django.contrib.auth.models import User >>> User . objects . create ( username = \"alice\" , pk = 1 ) <User: alice> >>> # The sequence hasn't been updated; its next value is 1. >>> User . objects . create ( username = \"bob\" ) IntegrityError: duplicate key value violates unique constraint \"auth_user_pkey\" DETAIL:  Key (id)=(1) already exists. If you need to specify such values, reset the sequence afterward to avoid\nreusing a value that’s already in the table. The sqlsequencereset management command generates the SQL statements to do that. Test database templates ¶ You can use the TEST['TEMPLATE'] setting to specify\na template (e.g. 'template0' ) from which to create a test database. Speeding up test execution with non-durable settings ¶ You can speed up test execution times by configuring PostgreSQL to be\nnon-durable . Warning This is dangerous: it will make your database more susceptible to data loss\nor corruption in the case of a server crash or power loss. Only use this on\na development machine where you can easily restore the entire contents of\nall databases in the cluster. MariaDB notes ¶ Django supports MariaDB 10.5 and higher. To use MariaDB, use the MySQL backend, which is shared between the two. See the MySQL notes for more details. MySQL notes ¶ Version support ¶ Django supports MySQL 8.0.11 and higher. Django’s inspectdb feature uses the information_schema database, which\ncontains detailed data on all database schemas. Django expects the database to support Unicode (UTF-8 encoding) and delegates to\nit the task of enforcing transactions and referential integrity. It is important\nto be aware of the fact that the two latter ones aren’t actually enforced by\nMySQL when using the MyISAM storage engine, see the next section. Storage engines ¶ MySQL has several storage engines . You can change the default storage engine\nin the server configuration. MySQL’s default storage engine is InnoDB . This engine is fully transactional\nand supports foreign key references. It’s the recommended choice. However, the\nInnoDB autoincrement counter is lost on a MySQL restart because it does not\nremember the AUTO_INCREMENT value, instead recreating it as “max(id)+1”.\nThis may result in an inadvertent reuse of AutoField values. The main drawbacks of MyISAM are that it doesn’t support transactions or\nenforce foreign-key constraints. MySQL DB API Drivers ¶ MySQL has a couple drivers that implement the Python Database API described in PEP 249 : mysqlclient is a native driver. It’s the recommended choice . MySQL Connector/Python is a pure Python driver from Oracle that does not\nrequire the MySQL client library or any Python modules outside the standard\nlibrary. These drivers are thread-safe and provide connection pooling. In addition to a DB API driver, Django needs an adapter to access the database\ndrivers from its ORM. Django provides an adapter for mysqlclient while MySQL\nConnector/Python includes its own . mysqlclient ¶ Django requires mysqlclient 1.4.3 or later. MySQL Connector/Python ¶ MySQL Connector/Python is available from the download page .\nThe Django adapter is available in versions 1.1.X and later. It may not\nsupport the most recent releases of Django. Time zone definitions ¶ If you plan on using Django’s timezone support ,\nuse mysql_tzinfo_to_sql to load time zone tables into the MySQL database.\nThis needs to be done just once for your MySQL server, not per database. Creating your database ¶ You can create your database using the command-line tools and this SQL: CREATE DATABASE < dbname > CHARACTER SET utf8 ; This ensures all tables and columns will use UTF-8 by default. Collation settings ¶ The collation setting for a column controls the order in which data is sorted\nas well as what strings compare as equal. You can specify the db_collation parameter to set the collation name of the column for CharField and TextField . The collation can also be set on a database-wide level and per-table. This is documented thoroughly in the MySQL documentation. In such cases, you must\nset the collation by directly manipulating the database settings or tables.\nDjango doesn’t provide an API to change them. By default, with a UTF-8 database, MySQL will use the utf8_general_ci collation. This results in all string equality\ncomparisons being done in a case-insensitive manner. That is, \"Fred\" and \"freD\" are considered equal at the database level. If you have a unique\nconstraint on a field, it would be illegal to try to insert both \"aa\" and \"AA\" into the same column, since they compare as equal (and, hence,\nnon-unique) with the default collation. If you want case-sensitive comparisons\non a particular column or table, change the column or table to use the utf8_bin collation. Please note that according to MySQL Unicode Character Sets , comparisons for\nthe utf8_general_ci collation are faster, but slightly less correct, than\ncomparisons for utf8_unicode_ci . If this is acceptable for your application,\nyou should use utf8_general_ci because it is faster. If this is not acceptable\n(for example, if you require German dictionary order), use utf8_unicode_ci because it is more accurate. Warning Model formsets validate unique fields in a case-sensitive manner. Thus when\nusing a case-insensitive collation, a formset with unique field values that\ndiffer only by case will pass validation, but upon calling save() , an IntegrityError will be raised. Connecting to the database ¶ Refer to the settings documentation . Connection settings are used in this order: OPTIONS . NAME , USER , PASSWORD , HOST , PORT MySQL option files. In other words, if you set the name of the database in OPTIONS ,\nthis will take precedence over NAME , which would override\nanything in a MySQL option file . Here’s a sample configuration which uses a MySQL option file: # settings.py DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.mysql\" , \"OPTIONS\" : { \"read_default_file\" : \"/path/to/my.cnf\" , }, } } # my.cnf [client] database = NAME user = USER password = PASSWORD default-character-set = utf8 Several other MySQLdb connection options may be useful, such as ssl , init_command , and sql_mode . Setting sql_mode ¶ The default value of the sql_mode option contains STRICT_TRANS_TABLES .\nThat option escalates warnings into errors when data are truncated upon\ninsertion, so Django highly recommends activating a strict mode for MySQL to\nprevent data loss (either STRICT_TRANS_TABLES or STRICT_ALL_TABLES ). If you need to customize the SQL mode, you can set the sql_mode variable\nlike other MySQL options: either in a config file or with the entry 'init_command': \"SET sql_mode='STRICT_TRANS_TABLES'\" in the OPTIONS part of your database configuration in DATABASES . Isolation level ¶ When running concurrent loads, database transactions from different sessions\n(say, separate threads handling different requests) may interact with each\nother. These interactions are affected by each session’s transaction isolation\nlevel . You can set a connection’s isolation level with an 'isolation_level' entry in the OPTIONS part of your database\nconfiguration in DATABASES . Valid values for\nthis entry are the four standard isolation levels: 'read uncommitted' 'read committed' 'repeatable read' 'serializable' or None to use the server’s configured isolation level. However, Django\nworks best with and defaults to read committed rather than MySQL’s default,\nrepeatable read. Data loss is possible with repeatable read. In particular,\nyou may see cases where get_or_create() will raise an IntegrityError but the object won’t appear in\na subsequent get() call. Creating your tables ¶ When Django generates the schema, it doesn’t specify a storage engine, so\ntables will be created with whatever default storage engine your database\nserver is configured for. The easiest solution is to set your database server’s\ndefault storage engine to the desired engine. If you’re using a hosting service and can’t change your server’s default\nstorage engine, you have a couple of options. After the tables are created, execute an ALTER TABLE statement to\nconvert a table to a new storage engine (such as InnoDB): ALTER TABLE < tablename > ENGINE = INNODB ; This can be tedious if you have a lot of tables. Another option is to use the init_command option for MySQLdb prior to\ncreating your tables: \"OPTIONS\" : { \"init_command\" : \"SET default_storage_engine=INNODB\" , } This sets the default storage engine upon connecting to the database.\nAfter your tables have been created, you should remove this option as it\nadds a query that is only needed during table creation to each database\nconnection. Table names ¶ There are known issues in even the latest versions of MySQL that can cause the\ncase of a table name to be altered when certain SQL statements are executed\nunder certain conditions. It is recommended that you use lowercase table\nnames, if possible, to avoid any problems that might arise from this behavior.\nDjango uses lowercase table names when it auto-generates table names from\nmodels, so this is mainly a consideration if you are overriding the table name\nvia the db_table parameter. Savepoints ¶ Both the Django ORM and MySQL (when using the InnoDB storage engine ) support database savepoints . If you use the MyISAM storage engine please be aware of the fact that you will\nreceive database-generated errors if you try to use the savepoint-related\nmethods of the transactions API . The reason\nfor this is that detecting the storage engine of a MySQL database/table is an\nexpensive operation so it was decided it isn’t worth to dynamically convert\nthese methods in no-op’s based in the results of such detection. Notes on specific fields ¶ Character fields ¶ Any fields that are stored with VARCHAR column types may have their max_length restricted to 255 characters if you are using unique=True for the field. This affects CharField , SlugField . See the MySQL documentation for more\ndetails. TextField limitations ¶ MySQL can index only the first N chars of a BLOB or TEXT column. Since TextField doesn’t have a defined length, you can’t mark it as unique=True . MySQL will report: “BLOB/TEXT column ‘<db_column>’ used in key\nspecification without a key length”. Fractional seconds support for Time and DateTime fields ¶ MySQL can store fractional seconds, provided that the column definition\nincludes a fractional indication (e.g. DATETIME(6) ). Django will not upgrade existing columns to include fractional seconds if the\ndatabase server supports it. If you want to enable them on an existing database,\nit’s up to you to either manually update the column on the target database, by\nexecuting a command like: ALTER TABLE ` your_table ` MODIFY ` your_datetime_column ` DATETIME ( 6 ) or using a RunSQL operation in a data migration . TIMESTAMP columns ¶ If you are using a legacy database that contains TIMESTAMP columns, you must\nset USE_TZ = False to avoid data corruption. inspectdb maps these columns to DateTimeField and if you enable timezone support,\nboth MySQL and Django will attempt to convert the values from UTC to local time. Row locking with QuerySet.select_for_update() ¶ MySQL and MariaDB do not support some options to the SELECT ... FOR UPDATE statement. If select_for_update() is used with an unsupported option, then\na NotSupportedError is raised. Option MariaDB MySQL SKIP LOCKED X (≥10.6) X NOWAIT X X OF X NO KEY When using select_for_update() on MySQL, make sure you filter a queryset\nagainst at least a set of fields contained in unique constraints or only\nagainst fields covered by indexes. Otherwise, an exclusive write lock will be\nacquired over the full table for the duration of the transaction. Automatic typecasting can cause unexpected results ¶ When performing a query on a string type, but with an integer value, MySQL will\ncoerce the types of all values in the table to an integer before performing the\ncomparison. If your table contains the values 'abc' , 'def' and you\nquery for WHERE mycolumn=0 , both rows will match. Similarly, WHERE mycolumn=1 will match the value 'abc1' . Therefore, string type fields included in Django\nwill always cast the value to a string before using it in a query. If you implement custom model fields that inherit from Field directly, are overriding get_prep_value() , or use RawSQL , extra() , or raw() , you should ensure that you perform\nappropriate typecasting. SQLite notes ¶ Django supports SQLite 3.31.0 and later. SQLite provides an excellent development alternative for applications that\nare predominantly read-only or require a smaller installation footprint. As\nwith all database servers, though, there are some differences that are\nspecific to SQLite that you should be aware of. Substring matching and case sensitivity ¶ For all SQLite versions, there is some slightly counterintuitive behavior when\nattempting to match some types of strings.  These are triggered when using the iexact or contains filters in Querysets. The behavior\nsplits into two cases: 1. For substring matching, all matches are done case-insensitively. That is a\nfilter such as filter(name__contains=\"aa\") will match a name of \"Aabb\" . 2. For strings containing characters outside the ASCII range, all exact string\nmatches are performed case-sensitively, even when the case-insensitive options\nare passed into the query. So the iexact filter will behave exactly\nthe same as the exact filter in these cases. Some possible workarounds for this are documented at sqlite.org , but they\naren’t utilized by the default SQLite backend in Django, as incorporating them\nwould be fairly difficult to do robustly. Thus, Django exposes the default\nSQLite behavior and you should be aware of this when doing case-insensitive or\nsubstring filtering. Decimal handling ¶ SQLite has no real decimal internal type. Decimal values are internally\nconverted to the REAL data type (8-byte IEEE floating point number), as\nexplained in the SQLite datatypes documentation , so they don’t support\ncorrectly-rounded decimal floating point arithmetic. “Database is locked” errors ¶ SQLite is meant to be a lightweight database, and thus can’t support a high\nlevel of concurrency. OperationalError: database is locked errors indicate\nthat your application is experiencing more concurrency than sqlite can\nhandle in default configuration. This error means that one thread or process has\nan exclusive lock on the database connection and another thread timed out\nwaiting for the lock the be released. Python’s SQLite wrapper has\na default timeout value that determines how long the second thread is allowed to\nwait on the lock before it times out and raises the OperationalError: database is locked error. If you’re getting this error, you can solve it by: Switching to another database backend. At a certain point SQLite becomes\ntoo “lite” for real-world applications, and these sorts of concurrency\nerrors indicate you’ve reached that point. Rewriting your code to reduce concurrency and ensure that database\ntransactions are short-lived. Increase the default timeout value by setting the timeout database\noption: \"OPTIONS\" : { # ... \"timeout\" : 20 , # ... } This will make SQLite wait a bit longer before throwing “database is locked”\nerrors; it won’t really do anything to solve them. Transactions behavior ¶ New in Django 5.1. SQLite supports three transaction modes: DEFERRED , IMMEDIATE , and EXCLUSIVE . The default is DEFERRED . If you need to use a different mode, set it in the OPTIONS part of your database configuration in DATABASES , for example: \"OPTIONS\" : { # ... \"transaction_mode\" : \"IMMEDIATE\" , # ... } To make sure your transactions wait until timeout before raising “Database\nis Locked”, change the transaction mode to IMMEDIATE . For the best performance with IMMEDIATE and EXCLUSIVE , transactions\nshould be as short as possible. This might be hard to guarantee for all of your\nviews so the usage of ATOMIC_REQUESTS is\ndiscouraged  in this case. For more information see Transactions in SQLite . QuerySet.select_for_update() not supported ¶ SQLite does not support the SELECT ... FOR UPDATE syntax. Calling it will\nhave no effect. Isolation when using QuerySet.iterator() ¶ There are special considerations described in Isolation In SQLite when\nmodifying a table while iterating over it using QuerySet.iterator() . If\na row is added, changed, or deleted within the loop, then that row may or may\nnot appear, or may appear twice, in subsequent results fetched from the\niterator. Your code must handle this. Enabling JSON1 extension on SQLite ¶ To use JSONField on SQLite, you need to enable the JSON1 extension on Python’s sqlite3 library. If the extension is\nnot enabled on your installation, a system error ( fields.E180 ) will be\nraised. To enable the JSON1 extension you can follow the instruction on the wiki page . Note The JSON1 extension is enabled by default on SQLite 3.38+. Setting pragma options ¶ New in Django 5.1. Pragma options can be set upon connection by using the init_command in\nthe OPTIONS part of your database configuration in DATABASES . The example below shows how to enable extra durability of\nsynchronous writes and change the cache_size : DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.sqlite3\" , # ... \"OPTIONS\" : { \"init_command\" : \"PRAGMA synchronous=3; PRAGMA cache_size=2000;\" , }, } } Oracle notes ¶ Django supports Oracle Database Server versions 19c and higher. Version\n1.3.2 or higher of the oracledb Python driver is required. Deprecated since version 5.0: Support for cx_Oracle is deprecated. In order for the python manage.py migrate command to work, your Oracle\ndatabase user must have privileges to run the following commands: CREATE TABLE CREATE SEQUENCE CREATE PROCEDURE CREATE TRIGGER To run a project’s test suite, the user usually needs these additional privileges: CREATE USER ALTER USER DROP USER CREATE TABLESPACE DROP TABLESPACE CREATE SESSION WITH ADMIN OPTION CREATE TABLE WITH ADMIN OPTION CREATE SEQUENCE WITH ADMIN OPTION CREATE PROCEDURE WITH ADMIN OPTION CREATE TRIGGER WITH ADMIN OPTION While the RESOURCE role has the required CREATE TABLE , CREATE SEQUENCE , CREATE PROCEDURE , and CREATE TRIGGER privileges,\nand a user granted RESOURCE WITH ADMIN OPTION can grant RESOURCE , such\na user cannot grant the individual privileges (e.g. CREATE TABLE ), and thus RESOURCE WITH ADMIN OPTION is not usually sufficient for running tests. Some test suites also create views or materialized views; to run these, the\nuser also needs CREATE VIEW WITH ADMIN OPTION and CREATE MATERIALIZED VIEW WITH ADMIN OPTION privileges. In particular, this\nis needed for Django’s own test suite. All of these privileges are included in the DBA role, which is appropriate\nfor use on a private developer’s database. The Oracle database backend uses the SYS.DBMS_LOB and SYS.DBMS_RANDOM packages, so your user will require execute permissions on it. It’s normally\naccessible to all users by default, but in case it is not, you’ll need to grant\npermissions like so: GRANT EXECUTE ON SYS . DBMS_LOB TO user ; GRANT EXECUTE ON SYS . DBMS_RANDOM TO user ; Connecting to the database ¶ To connect using the service name of your Oracle database, your settings.py file should look something like this: DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.oracle\" , \"NAME\" : \"xe\" , \"USER\" : \"a_user\" , \"PASSWORD\" : \"a_password\" , \"HOST\" : \"\" , \"PORT\" : \"\" , } } In this case, you should leave both HOST and PORT empty.\nHowever, if you don’t use a tnsnames.ora file or a similar naming method\nand want to connect using the SID (“xe” in this example), then fill in both HOST and PORT like so: DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.oracle\" , \"NAME\" : \"xe\" , \"USER\" : \"a_user\" , \"PASSWORD\" : \"a_password\" , \"HOST\" : \"dbprod01ned.mycompany.com\" , \"PORT\" : \"1540\" , } } You should either supply both HOST and PORT , or leave\nboth as empty strings. Django will use a different connect descriptor depending\non that choice. Full DSN and Easy Connect ¶ A Full DSN or Easy Connect string can be used in NAME if both HOST and PORT are empty. This format is required when\nusing RAC or pluggable databases without tnsnames.ora , for example. Example of an Easy Connect string: \"NAME\" : \"localhost:1521/orclpdb1\" Example of a full DSN string: \"NAME\" : ( \"(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521))\" \"(CONNECT_DATA=(SERVICE_NAME=orclpdb1)))\" ) Threaded option ¶ If you plan to run Django in a multithreaded environment (e.g. Apache using the\ndefault MPM module on any modern operating system), then you must set\nthe threaded option of your Oracle database configuration to True : \"OPTIONS\" : { \"threaded\" : True , } Failure to do this may result in crashes and other odd behavior. INSERT … RETURNING INTO ¶ By default, the Oracle backend uses a RETURNING INTO clause to efficiently\nretrieve the value of an AutoField when inserting new rows.  This behavior\nmay result in a DatabaseError in certain unusual setups, such as when\ninserting into a remote table, or into a view with an INSTEAD OF trigger.\nThe RETURNING INTO clause can be disabled by setting the use_returning_into option of the database configuration to False : \"OPTIONS\" : { \"use_returning_into\" : False , } In this case, the Oracle backend will use a separate SELECT query to\nretrieve AutoField values. Naming issues ¶ Oracle imposes a name length limit of 30 characters. To accommodate this, the\nbackend truncates database identifiers to fit, replacing the final four\ncharacters of the truncated name with a repeatable MD5 hash value.\nAdditionally, the backend turns database identifiers to all-uppercase. To prevent these transformations (this is usually required only when dealing\nwith legacy databases or accessing tables which belong to other users), use\na quoted name as the value for db_table : class LegacyModel ( models . Model ): class Meta : db_table = '\"name_left_in_lowercase\"' class ForeignModel ( models . Model ): class Meta : db_table = '\"OTHER_USER\".\"NAME_ONLY_SEEMS_OVER_30\"' Quoted names can also be used with Django’s other supported database\nbackends; except for Oracle, however, the quotes have no effect. When running migrate , an ORA-06552 error may be encountered if\ncertain Oracle keywords are used as the name of a model field or the\nvalue of a db_column option.  Django quotes all identifiers used\nin queries to prevent most such problems, but this error can still\noccur when an Oracle datatype is used as a column name.  In\nparticular, take care to avoid using the names date , timestamp , number or float as a field name. NULL and empty strings ¶ Django generally prefers to use the empty string ( '' ) rather than NULL , but Oracle treats both identically. To get around this, the\nOracle backend ignores an explicit null option on fields that\nhave the empty string as a possible value and generates DDL as if null=True . When fetching from the database, it is assumed that\na NULL value in one of these fields really means the empty\nstring, and the data is silently converted to reflect this assumption. TextField limitations ¶ The Oracle backend stores TextFields as NCLOB columns. Oracle imposes\nsome limitations on the usage of such LOB columns in general: LOB columns may not be used as primary keys. LOB columns may not be used in indexes. LOB columns may not be used in a SELECT DISTINCT list. This means that\nattempting to use the QuerySet.distinct method on a model that\nincludes TextField columns will result in an ORA-00932 error when\nrun against Oracle. As a workaround, use the QuerySet.defer method in\nconjunction with distinct() to prevent TextField columns from being\nincluded in the SELECT DISTINCT list. Subclassing the built-in database backends ¶ Django comes with built-in database backends. You may subclass an existing\ndatabase backends to modify its behavior, features, or configuration. Consider, for example, that you need to change a single database feature.\nFirst, you have to create a new directory with a base module in it. For\nexample: mysite/\n    ...\n    mydbengine/\n        __init__.py\n        base.py The base.py module must contain a class named DatabaseWrapper that\nsubclasses an existing engine from the django.db.backends module. Here’s an\nexample of subclassing the PostgreSQL engine to change a feature class allows_group_by_selected_pks_on_model : mysite/mydbengine/base.py ¶ from django.db.backends.postgresql import base , features class DatabaseFeatures ( features . DatabaseFeatures ): def allows_group_by_selected_pks_on_model ( self , model ): return True class DatabaseWrapper ( base . DatabaseWrapper ): features_class = DatabaseFeatures Finally, you must specify a DATABASE-ENGINE in your settings.py file: DATABASES = { \"default\" : { \"ENGINE\" : \"mydbengine\" , # ... }, } You can see the current list of database engines by looking in django/db/backends . Using a 3rd-party database backend ¶ In addition to the officially supported databases, there are backends provided\nby 3rd parties that allow you to use other databases with Django: CockroachDB Firebird Google Cloud Spanner Microsoft SQL Server Snowflake TiDB YugabyteDB The Django versions and ORM features supported by these unofficial backends\nvary considerably. Queries regarding the specific capabilities of these\nunofficial backends, along with any support queries, should be directed to\nthe support channels provided by each 3rd party project.", "keywords": ["users", "robustness", "rows", "strict_all_tables", "feature", "storage", "formset", "lob", "orclpdb1", "formsets", "use_returning_into", "corruption", "library", "field", "#", "utf8", "serialization", "mycolumn=1", "tidb", "dbprod01ned.mycompany.com", "psycopg[pool", "abc", "datatype", "+", "crashes", "loop", "setups", "stores", "host", "instruction", "range", "config", "ddl", "isolationlevel", "get_prep_value", "words", "template0", "suite", "sys.dbms_lob", "http", "hash", "=", "results", "download", "engine", "installation", "fact", "character", "setup", "cursor_tuple_fraction", "tables", "like", "sorts", "sets", "blob", "process", "reuse", "microsoft", "iexact", "choice", "interactions", "django.db.backends.mysql", "type", "mysqlclient", "savepoint", "filefield", "custom", "optimization", "documentation", "objects", "lookups", "utf8_general_ci", "file", "alice", "queryset.defer", "constraint", "guarantee", "modules", "lite", "user", "cases", ".my_pgpass", "autocommit", "manuals", "mydbengine", "warning", "packages", "constraints", "synchronous=3", "time", "cache_size", "inherit", "workaround", "save", "thanks", "date", "purposes", "restart", "crash", "service", "password", "ora-00932", "iterator", "name", "parameter", "execution", "world", "backends", "reference", "chars", "age", "strict_trans_tables", "problems", "versions", "queries", "majority", "oracledb", "description=(address=(protocol", "select_for_update", "uses", "return", "operator", "applications", "connect", "consideration", "cursors", "duration", "use_tz", "isolation", "textfield", "failure", "max(id)+1", "username", "wrapper", "error", "timeout", "conditions", "module", "code", "databasewrapper", "filter", "false", "behavior", "class", "migration", "workarounds", "clause", "sid", "ssl", "warnings", "ieee", "names", "x", "sys.dbms_random", "request", "mysqldb", "notsupportederror", "database", "block", "inserting", "privileges", "query", "page", "test", "commands", "postgresql", "conflict", "migrate", "types", "strings", "decisions", "mycolumn=0", "e180", "admin", "creation", "xe", "usage", "adapter", "pool", "configuration", "limit", "max_length", "sql_mode='strict_trans_tables", "json1", "thread", "conn_health_checks", "a_password", "role", "validation", "create", "limitations", "section", "substring", "binding", "developer", "specification", "sequence", "localhost:5432", "into", "modify", "read_default_file", "encodings", "use", "replacement", "environment", "materialized", "engines", "solution", "performance", "releases", "port=5432", "extensions", "operation", "order", "default", "counter", "8.0.11", "identifiers", "typecasting", "connectionpool", "serializable", "fred", "option", "format", "characters", "tests", "postgresql.conf", "equality", "my.cnf", "worker", "my_application_role", "contains", "considerations", "timezone", "psycopg2", "persistent", "cursor", "caveats", "exclusive", "truncates", "cloud", "utf8_bin", "template", "mysite", "schema", "cx_oracle", "way", "utf-8", "utf8_unicode_ci", "execute", "servers", "uppercase", "index", "op", "party", "queryset", "integer", "session", "¶", "command", "django.db.backends.postgresql", "parameters", "side", "createextension", "suites", "queryset.iterator", "content", "keywords", "views", "testing", "integrity", "view", "control", "zone", "indexes", "indication", "number", "lot", "maps", "jsonfield", "permissions", "def", "point", "values", "failures", "django.db.backends.oracle", "string", "dba", "dbms_lob", "abc1", "health", "aa", "databaseerror", "auto", "databases", "connections", "timestamp", "id)=(1", "traffic", "pgbouncer", "table", "drivers", "localhost)(port=1521", "models", "querysets", "version", "level", "contents", "allows_group_by_selected_pks_on_model", "machine", "atomic_requests", "drop", "tablespace", "refer", "instead", "tcp)(host", "django", "general", "grant", "n’t", "fields", "entry", "passfile", "set", "dsn", "development", "power", "lowercase", "db", "operating", "value", "legacy", "line", "bit", "columns", "data", "pep", "db_collation", "lifetime", "datetime", "base", "backend", "task", "easy", "insertion", "runsql", "db_index", "default_storage_engine", "self", "handling", "levels", "extension", "alter", "unicode", "issues", "constructor", "writes", "descriptor", "assumptions", "repeatable", "statement", "part", "features_class", "references", "object", "couple", "name_left_in_lowercase", "snowflake", "charfield", "management", "response", "precedence", "operationalerror", "sys", "sql", "requests", "\"name_only_seems_over_30", "keyword", "delegates", "sqlsequencereset", "pragma", "naming", "drawbacks", "matches", "queryset.select_for_update", "notes", "integrityerror", "immediate", "effect", "detail", "system", "port", "savepoints", "manner", "overhead", "filtering", "other_user\"", "innodb", "bob", "comparisons", "definition", "decimal", "aabb", "procedure", "autofield", "target", "server_side_binding", "check", "features", "my_service", "sqlite3", "rac", "apache", "psycopg", "skip", "addition", "example", "information_schema", "care", "column", "django.db.close_old_connections", "sample", "loss", "list", "collation", "firebird", "auto_increment", "channels", "seconds", "orm", "utc", "autoincrement", "detection", "parties", "locked", "nowait", "google", "schemas", "read", "md5", "model", "hstore", "pooler", "variable", "durability", "application", "encoding", "test['template", "pooling", "identity", "django.contrib.auth.models", "slugfield", "databasefeatures", "differences", "localhost", "sense", "myisam", "track", "syntax", "capabilities", "select", "ones", "keys", "case", "length", "spanner", "conjunction", "null", "isolation_level", "errors", "future", "server", "arguments", "quotes", "driver", "lock", "deferred", "rawsql", "end", "disable_server_side_cursors", "mpm", "your_datetime_column", "sqlite", "comparison", "real", "matching", "cluster", "nclob", "key", "update", "auth_user_pkey", "inspectdb", "none", "localhost:1521", "filters", "assume_role", "problem", "meta", "init_command", "mariadb", "get", "ora-06552", "concurrency", "dbname", "reason", "planner", "new", "true", "footprint", "api", "sql_mode", "loads", "support", "sessions", "mode", "db_column", "assumption", "transactions", "textfields", "connection", "transformations", "cycle", "alternative", "threads", "import", "files", "connector", "sensitivity", "legacymodel", "mysql", "statements", "%", "defaults", "1.3.2", "call", "pk", "foreignmodel", "directory", "information", "row", "distinct", "python", "methods", "trigger", "options", "times", "mysql_tzinfo_to_sql", "resource", "client", "details", "method", "django.db.backends.sqlite3", "returning", "settings", "transaction", "sites", "state", "oracle", "tools", "design", "beginning", "text", "project", "exceptions"], "type": "documentation"},
{"title": "Testing GeoDjango apps | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/testing/", "content": "Testing GeoDjango apps ¶ Included in this documentation are some additional notes and settings\nfor PostGIS users. PostGIS ¶ Settings ¶ Note The settings below have sensible defaults, and shouldn’t require manual setting. POSTGIS_VERSION ¶ When GeoDjango’s spatial backend initializes on PostGIS, it has to perform\nan SQL query to determine the version in order to figure out what\nfeatures are available. Advanced users wishing to prevent this additional\nquery may set the version manually using a 3-tuple of integers specifying\nthe major, minor, and micro version numbers for PostGIS. For example,\nto configure for PostGIS X.Y.Z you would use: POSTGIS_VERSION = ( X , Y , Z ) Obtaining sufficient privileges ¶ Depending on your configuration, this section describes several methods to\nconfigure a database user with sufficient privileges to run tests for\nGeoDjango applications on PostgreSQL. If your spatial database template was created like in the instructions, then your testing database user\nonly needs to have the ability to create databases. In other configurations,\nyou may be required to use a database superuser. Create database user ¶ To make a database user with the ability to create databases, use the\nfollowing command: $ createuser --createdb -R -S <user_name> The -R -S flags indicate that we do not want the user to have the ability\nto create additional users (roles) or to be a superuser, respectively. Alternatively, you may alter an existing user’s role from the SQL shell\n(assuming this is done from an existing superuser account): postgres # ALTER ROLE < user_name > CREATEDB NOSUPERUSER NOCREATEROLE ; Create database superuser ¶ This may be done at the time the user is created, for example: $ createuser --superuser <user_name> Or you may alter the user’s role from the SQL shell (assuming this\nis done from an existing superuser account): postgres # ALTER ROLE < user_name > SUPERUSER ; Windows ¶ On Windows platforms you can use the pgAdmin III utility to add superuser\nprivileges to your database user. By default, the PostGIS installer on Windows includes a template\nspatial database entitled template_postgis . GeoDjango tests ¶ To have the GeoDjango tests executed when running the Django test suite with runtests.py all of the databases in the settings\nfile must be using one of the spatial database backends . Example ¶ The following is an example bare-bones settings file with spatial backends\nthat can be used to run the entire Django test suite, including those\nin django.contrib.gis : DATABASES = { \"default\" : { \"ENGINE\" : \"django.contrib.gis.db.backends.postgis\" , \"NAME\" : \"geodjango\" , \"USER\" : \"geodjango\" , }, \"other\" : { \"ENGINE\" : \"django.contrib.gis.db.backends.postgis\" , \"NAME\" : \"other\" , \"USER\" : \"geodjango\" , }, } SECRET_KEY = \"django_tests_secret_key\" Assuming the settings above were in a postgis.py file in the same\ndirectory as runtests.py , then all Django and GeoDjango tests would\nbe performed when executing the command: $ ./runtests.py --settings = postgis To run only the GeoDjango test suite, specify gis_tests : $ ./runtests.py --settings = postgis gis_tests", "keywords": ["users", "testing", "features", "platforms", "user_name", "postgis", "roles", "nosuperuser", "example", "#", "windows", "-r", "x", "databases", "./runtests.py", "numbers", "database", "--settings", "privileges", "iii", "query", "test", "postgresql", "version", "gis_tests", "suite", "django", "configuration", "=", "ability", "engine", "role", "y", "shell", "bones", "section", "postgres", "nocreaterole", "pgadmin", "backend", "tuple", "following", "documentation", "file", "-s", "order", "alter", "default", "secret_key", "user", "django.contrib.gis", "tests", "superuser", "time", "setting", "account", "name", "template", "directory", "createdb", "defaults", "sql", "instructions", "flags", "utility", "backends", "methods", "configurations", "django_tests_secret_key", "geodjango", "settings", "notes", "¶", "z", "command", "note", "applications", "apps", "integers", "x.y.z", "installer"], "type": "documentation"},
{"title": "Model class reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/class/", "content": "Model class reference ¶ This document covers features of the Model class.\nFor more information about models, see the complete list of Model\nreference guides . Attributes ¶ DoesNotExist ¶ exception Model. DoesNotExist ¶ This exception is raised by the ORM when an expected object is not found.\nFor example, QuerySet.get() will raise it when no object is found\nfor the given lookups. Django provides a DoesNotExist exception as an attribute of each model\nclass to identify the class of object that could not be found, allowing you\nto catch exceptions for a particular model class. The exception is a\nsubclass of django.core.exceptions.ObjectDoesNotExist . MultipleObjectsReturned ¶ exception Model. MultipleObjectsReturned ¶ This exception is raised by QuerySet.get() when multiple objects are\nfound for the given lookups. Django provides a MultipleObjectsReturned exception as an attribute of\neach model class to identify the class of object for which multiple objects\nwere found, allowing you to catch exceptions for a particular model class.\nThe exception is a subclass of django.core.exceptions.MultipleObjectsReturned . objects ¶ Model. objects ¶ Each non-abstract Model class must have a Manager instance added to it.\nDjango ensures that in your model class you have  at least a\ndefault Manager specified. If you don’t add your own Manager ,\nDjango will add an attribute objects containing default Manager instance. If you add your own Manager instance attribute, the default one does\nnot appear. Consider the following example: from django.db import models class Person ( models . Model ): # Add manager with another name people = models . Manager () For more details on model managers see Managers and Retrieving objects .", "keywords": ["object", "document", "model", "subclass", "import", "one", "name", ".", "instance", "objectdoesnotexist", "objects", "people", "lookups", "attributes", "django", "django.core.exceptions", "=", "reference", "features", "information", "queryset.get", "default", "class", "example", "#", "exception", "attribute", "manager", "details", "list", "django.db", "¶", "orm", "doesnotexist", "guides", "managers", "models", "person", "exceptions"], "type": "documentation"},
{"title": "Format localization | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/i18n/formatting/", "content": "Format localization ¶ Overview ¶ Django’s formatting system is capable of displaying dates, times and numbers in\ntemplates using the format specified for the current locale . It also handles localized input in forms. Two users accessing the same content may see dates, times and numbers formatted\nin different ways, depending on the formats for their current locale. Note To enable number formatting with thousand separators, it is necessary to\nset USE_THOUSAND_SEPARATOR = True in\nyour settings file. Alternatively, you could use intcomma to\nformat numbers in your template. Note There is a related USE_I18N setting that controls if Django\nshould activate translation. See Translation for more\ndetails. Locale aware input in forms ¶ When formatting is enabled, Django can use localized formats when parsing dates,\ntimes and numbers in forms. That means it tries different formats for different\nlocales when guessing the format used by the user when inputting data on forms. Note Django uses different formats for displaying data to those it uses for\nparsing data. Most notably, the formats for parsing dates can’t use the %a (abbreviated weekday name), %A (full weekday name), %b (abbreviated month name), %B (full month name),\nor %p (AM/PM). To enable a form field to localize input and output data use its localize argument: class CashRegisterForm ( forms . Form ): product = forms . CharField () revenue = forms . DecimalField ( max_digits = 4 , decimal_places = 2 , localize = True ) Controlling localization in templates ¶ Django tries to use a locale specific format whenever it outputs a value in a\ntemplate. However, it may not always be appropriate to use localized values –\nfor example, if you’re outputting JavaScript or XML that is designed\nto be machine-readable, you will always want unlocalized values. You\nmay also want to use localization in selected templates, rather than\nusing localization everywhere. To allow for fine control over the use of localization, Django\nprovides the l10n template library that contains the following\ntags and filters. Template tags ¶ localize ¶ Enables or disables localization of template variables in the\ncontained block. To activate or deactivate localization for a template block, use: {% load l10n %} {% localize on %} {{ value }} {% endlocalize %} {% localize off %} {{ value }} {% endlocalize %} When localization is disabled, the localization settings formats are applied. See localize and unlocalize for template filters that will\ndo the same job on a per-variable basis. Template filters ¶ localize ¶ Forces localization of a single value. For example: {% load l10n %} {{ value | localize }} To disable localization on a single value, use unlocalize . To control\nlocalization over a large section of a template, use the localize template\ntag. unlocalize ¶ Forces a single value to be printed without localization. For example: {% load l10n %} {{ value | unlocalize }} To force localization of a single value, use localize . To\ncontrol localization over a large section of a template, use the localize template tag. Returns a string representation for numbers  ( int , float , or Decimal ) with the localization settings formats\napplied. Creating custom format files ¶ Django provides format definitions for many locales, but sometimes you might\nwant to create your own, because a format file doesn’t exist for your locale,\nor because you want to overwrite some of the values. To use custom formats, specify the path where you’ll place format files\nfirst.  To do that, set your FORMAT_MODULE_PATH setting to the\npackage where format files will exist, for instance: FORMAT_MODULE_PATH = [ \"mysite.formats\" , \"some_app.formats\" , ] Files are not placed directly in this directory, but in a directory named as\nthe locale, and must be named formats.py . Be careful not to put sensitive\ninformation in these files as values inside can be exposed if you pass the\nstring to django.utils.formats.get_format() (used by the date template filter). To customize the English formats, a structure like this would be needed: mysite/\n    formats/\n        __init__.py\n        en/\n            __init__.py\n            formats.py where formats.py contains custom format definitions. For example: THOUSAND_SEPARATOR = \" \\xa0 \" to use a non-breaking space (Unicode 00A0 ) as a thousand separator,\ninstead of the default for English, a comma. Limitations of the provided locale formats ¶ Some locales use context-sensitive formats for numbers, which Django’s\nlocalization system cannot handle automatically. Switzerland (German) ¶ The Swiss number formatting depends on the type of number that is being\nformatted. For monetary values, a comma is used as the thousand separator and\na decimal point for the decimal separator. For all other numbers, a comma is\nused as decimal separator and a space as thousand separator. The locale format\nprovided by Django uses the generic separators, a comma for decimal and a space\nfor thousand separators.", "keywords": ["users", "control", "number", "decimal", "space", "b", "point", "forms", "values", "decimalfield", "enables", "localize", "library", "string", "l10n", "filter", "class", "example", "field", "intcomma", "month", "overview", "returns", "javascript", "unlocalize", "numbers", "formatting", "django.utils.formats.get_format", "block", "output", "input", "representation", "mysite.formats", "dates", "english", "ways", "locales", "variable", "machine", "place", "django", "xml", "=", "en/", "translation", "limitations", "value", "tag", "section", "data", "separator", "use", "job", "00a0", "some_app.formats", "type", "package", "custom", "instance", "file", "localization", "revenue", "product", "default", "user", "init__.py", "am", "|", "path", "pm", "unicode", "form", "format", "filters", "comma", "cashregisterform", "definitions", "tags", "basis", "date", "structure", "load", "decimal_places", "context", "german", "files", "name", "charfield", "template", "switzerland", "directory", "%", "locale", "formats", "information", "times", "details", "variables", "forces", "settings", "argument", "¶", "controls", "note", "format_module_path", "system", "int", "controlling", "templates", "weekday", "content", "separators"], "type": "documentation"},
{"title": "Time zones | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/i18n/timezones/", "content": "Time zones ¶ Overview ¶ When support for time zones is enabled, Django stores datetime information in\nUTC in the database, uses time-zone-aware datetime objects internally, and\ntranslates them to the end user’s time zone in templates and forms. This is handy if your users live in more than one time zone and you want to\ndisplay datetime information according to each user’s wall clock. Even if your website is available in only one time zone, it’s still good\npractice to store data in UTC in your database. The main reason is daylight\nsaving time (DST). Many countries have a system of DST, where clocks are moved\nforward in spring and backward in autumn. If you’re working in local time,\nyou’re likely to encounter errors twice a year, when the transitions happen.\nThis probably doesn’t matter for your blog, but it’s a problem if you over bill\nor under bill your customers by one hour, twice a year, every year. The\nsolution to this problem is to use UTC in the code and use local time only when\ninteracting with end users. Time zone support is enabled by default. To disable it, set USE_TZ = False in your settings file. Changed in Django 5.0: In older version, time zone support was disabled by default. Time zone support uses zoneinfo , which is part of the Python standard\nlibrary from Python 3.9. If you’re wrestling with a particular problem, start with the time zone\nFAQ . Concepts ¶ Naive and aware datetime objects ¶ Python’s datetime.datetime objects have a tzinfo attribute that\ncan be used to store time zone information, represented as an instance of a\nsubclass of datetime.tzinfo . When this attribute is set and describes\nan offset, a datetime object is aware . Otherwise, it’s naive . You can use is_aware() and is_naive() to determine whether datetimes are\naware or naive. When time zone support is disabled, Django uses naive datetime objects in local\ntime. This is sufficient for many use cases. In this mode, to obtain the\ncurrent time, you would write: import datetime now = datetime . datetime . now () When time zone support is enabled ( USE_TZ=True ), Django uses\ntime-zone-aware datetime objects. If your code creates datetime objects, they\nshould be aware too. In this mode, the example above becomes: from django.utils import timezone now = timezone . now () Warning Dealing with aware datetime objects isn’t always intuitive. For instance,\nthe tzinfo argument of the standard datetime constructor doesn’t work\nreliably for time zones with DST. Using UTC is generally safe; if you’re\nusing other time zones, you should review the zoneinfo documentation carefully. Note Python’s datetime.time objects also feature a tzinfo attribute, and PostgreSQL has a matching time with time zone type.\nHowever, as PostgreSQL’s docs put it, this type “exhibits properties which\nlead to questionable usefulness”. Django only supports naive time objects and will raise an exception if you\nattempt to save an aware time object, as a timezone for a time with no\nassociated date does not make sense. Interpretation of naive datetime objects ¶ When USE_TZ is True , Django still accepts naive datetime\nobjects, in order to preserve backwards-compatibility. When the database layer\nreceives one, it attempts to make it aware by interpreting it in the default time zone and raises a warning. Unfortunately, during DST transitions, some datetimes don’t exist or are\nambiguous. That’s why you should always create aware datetime objects when time\nzone support is enabled. (See the Using ZoneInfo section of the zoneinfo docs for examples using the fold attribute to specify the\noffset that should apply to a datetime during a DST transition.) In practice, this is rarely an issue. Django gives you aware datetime objects\nin the models and forms, and most often, new datetime objects are created from\nexisting ones through timedelta arithmetic. The only\ndatetime that’s often created in application code is the current time, and timezone.now() automatically does the\nright thing. Default time zone and current time zone ¶ The default time zone is the time zone defined by the TIME_ZONE setting. The current time zone is the time zone that’s used for rendering. You should set the current time zone to the end user’s actual time zone with activate() . Otherwise, the default time zone is\nused. Note As explained in the documentation of TIME_ZONE , Django sets\nenvironment variables so that its process runs in the default time zone.\nThis happens regardless of the value of USE_TZ and of the\ncurrent time zone. When USE_TZ is True , this is useful to preserve\nbackwards-compatibility with applications that still rely on local time.\nHowever, as explained above , this isn’t\nentirely reliable, and you should always work with aware datetimes in UTC\nin your own code. For instance, use fromtimestamp() and set the tz parameter to utc . Selecting the current time zone ¶ The current time zone is the equivalent of the current locale for translations. However, there’s no equivalent of the Accept-Language HTTP header that Django could use to determine the user’s\ntime zone automatically. Instead, Django provides time zone selection\nfunctions . Use them to build the time zone\nselection logic that makes sense for you. Most websites that care about time zones ask users in which time zone they live\nand store this information in the user’s profile. For anonymous users, they use\nthe time zone of their primary audience or UTC. zoneinfo.available_timezones() provides a set of available timezones that\nyou can use to build a map from likely locations to time zones. Here’s an example that stores the current timezone in the session. (It skips\nerror handling entirely for the sake of simplicity.) Add the following middleware to MIDDLEWARE : import zoneinfo from django.utils import timezone class TimezoneMiddleware : def __init__ ( self , get_response ): self . get_response = get_response def __call__ ( self , request ): tzname = request . session . get ( \"django_timezone\" ) if tzname : timezone . activate ( zoneinfo . ZoneInfo ( tzname )) else : timezone . deactivate () return self . get_response ( request ) Create a view that can set the current timezone: from django.shortcuts import redirect , render # Prepare a map of common locations to timezone choices you wish to offer. common_timezones = { \"London\" : \"Europe/London\" , \"Paris\" : \"Europe/Paris\" , \"New York\" : \"America/New_York\" , } def set_timezone ( request ): if request . method == \"POST\" : request . session [ \"django_timezone\" ] = request . POST [ \"timezone\" ] return redirect ( \"/\" ) else : return render ( request , \"template.html\" , { \"timezones\" : common_timezones }) Include a form in template.html that will POST to this view: {% load tz %} {% get_current_timezone as TIME_ZONE %} < form action = \" {% url 'set_timezone' %} \" method = \"POST\" > {% csrf_token %} < label for = \"timezone\" > Time zone: </ label > < select name = \"timezone\" > {% for city , tz in timezones %} < option value = \" {{ tz }} \" {% if tz == TIME_ZONE %} selected {% endif %} > {{ city }} </ option > {% endfor %} </ select > < input type = \"submit\" value = \"Set\" > </ form > Time zone aware input in forms ¶ When you enable time zone support, Django interprets datetimes entered in\nforms in the current time zone and returns\naware datetime objects in cleaned_data . Converted datetimes that don’t exist or are ambiguous because they fall in a\nDST transition will be reported as invalid values. Time zone aware output in templates ¶ When you enable time zone support, Django converts aware datetime objects to\nthe current time zone when they’re rendered\nin templates. This behaves very much like format localization . Warning Django doesn’t convert naive datetime objects, because they could be\nambiguous, and because your code should never produce naive datetimes when\ntime zone support is enabled. However, you can force conversion with the\ntemplate filters described below. Conversion to local time isn’t always appropriate – you may be generating\noutput for computers rather than for humans. The following filters and tags,\nprovided by the tz template tag library, allow you to control the time zone\nconversions. Template tags ¶ localtime ¶ Enables or disables conversion of aware datetime objects to the current time\nzone in the contained block. This tag has exactly the same effects as the USE_TZ setting as far\nas the template engine is concerned. It allows a more fine grained control of\nconversion. To activate or deactivate conversion for a template block, use: {% load tz %} {% localtime on %} {{ value }} {% endlocaltime %} {% localtime off %} {{ value }} {% endlocaltime %} Note The value of USE_TZ isn’t respected inside of a {% localtime %} block. timezone ¶ Sets or unsets the current time zone in the contained block. When the current\ntime zone is unset, the default time zone applies. {% load tz %} {% timezone \"Europe/Paris\" %} Paris time: {{ value }} {% endtimezone %} {% timezone None %} Server time: {{ value }} {% endtimezone %} get_current_timezone ¶ You can get the name of the current time zone using the get_current_timezone tag: {% get_current_timezone as TIME_ZONE %} Alternatively, you can activate the tz() context processor and\nuse the TIME_ZONE context variable. Template filters ¶ These filters accept both aware and naive datetimes. For conversion purposes,\nthey assume that naive datetimes are in the default time zone. They always\nreturn aware datetimes. localtime ¶ Forces conversion of a single value to the current time zone. For example: {% load tz %} {{ value | localtime }} utc ¶ Forces conversion of a single value to UTC. For example: {% load tz %} {{ value | utc }} timezone ¶ Forces conversion of a single value to an arbitrary timezone. The argument must be an instance of a tzinfo subclass or a\ntime zone name. For example: {% load tz %} {{ value | timezone :\"Europe/Paris\" }} Migration guide ¶ Here’s how to migrate a project that was started before Django supported time\nzones. Database ¶ PostgreSQL ¶ The PostgreSQL backend stores datetimes as timestamp with time zone . In\npractice, this means it converts datetimes from the connection’s time zone to\nUTC on storage, and from UTC to the connection’s time zone on retrieval. As a consequence, if you’re using PostgreSQL, you can switch between USE_TZ = False and USE_TZ = True freely. The database connection’s time zone\nwill be set to DATABASE-TIME_ZONE or UTC respectively, so that\nDjango obtains correct datetimes in all cases. You don’t need to perform any\ndata conversions. Time zone settings The time zone configured for the connection\nin the DATABASES setting is distinct from the general TIME_ZONE setting. Other databases ¶ Other backends store datetimes without time zone information. If you switch\nfrom USE_TZ = False to USE_TZ = True , you must convert your data from\nlocal time to UTC – which isn’t deterministic if your local time has DST. Code ¶ The first step is to add USE_TZ = True to your settings\nfile. At this point, things should mostly work. If you create naive datetime\nobjects in your code, Django makes them aware when necessary. However, these conversions may fail around DST transitions, which means you\naren’t getting the full benefits of time zone support yet. Also, you’re likely\nto run into a few problems because it’s impossible to compare a naive datetime\nwith an aware datetime. Since Django now gives you aware datetimes, you’ll get\nexceptions wherever you compare a datetime that comes from a model or a form\nwith a naive datetime that you’ve created in your code. So the second step is to refactor your code wherever you instantiate datetime\nobjects to make them aware. This can be done incrementally. django.utils.timezone defines some handy helpers for compatibility\ncode: now() , is_aware() , is_naive() , make_aware() , and make_naive() . Finally, in order to help you locate code that needs upgrading, Django raises\na warning when you attempt to save a naive datetime to the database: RuntimeWarning: DateTimeField ModelName.field_name received a naive datetime (2012-01-01 00:00:00) while time zone support is active. During development, you can turn such warnings into exceptions and get a\ntraceback by adding the following to your settings file: import warnings warnings . filterwarnings ( \"error\" , r \"DateTimeField .* received a naive datetime\" , RuntimeWarning , r \"django\\.db\\.models\\.fields\" , ) Fixtures ¶ When serializing an aware datetime, the UTC offset is included, like this: \"2011-09-01T13:20:30+03:00\" While for a naive datetime, it isn’t: \"2011-09-01T13:20:30\" For models with DateTimeField s, this difference\nmakes it impossible to write a fixture that works both with and without time\nzone support. Fixtures generated with USE_TZ = False , or before Django 1.4, use the\n“naive” format. If your project contains such fixtures, after you enable time\nzone support, you’ll see RuntimeWarning s when you load them. To get\nrid of the warnings, you must convert your fixtures to the “aware” format. You can regenerate fixtures with loaddata then dumpdata .\nOr, if they’re small enough, you can edit them to add the UTC offset that\nmatches your TIME_ZONE to each serialized datetime. FAQ ¶ Setup ¶ I don’t need multiple time zones. Should I enable time zone support? Yes. When time zone support is enabled, Django uses a more accurate model\nof local time. This shields you from subtle and unreproducible bugs around\ndaylight saving time (DST) transitions. When you enable time zone support, you’ll encounter some errors because\nyou’re using naive datetimes where Django expects aware datetimes. Such\nerrors show up when running tests. You’ll quickly learn how to avoid invalid\noperations. On the other hand, bugs caused by the lack of time zone support are much\nharder to prevent, diagnose and fix. Anything that involves scheduled tasks\nor datetime arithmetic is a candidate for subtle bugs that will bite you\nonly once or twice a year. For these reasons, time zone support is enabled by default in new projects,\nand you should keep it unless you have a very good reason not to. I’ve enabled time zone support. Am I safe? Maybe. You’re better protected from DST-related bugs, but you can still\nshoot yourself in the foot by carelessly turning naive datetimes into aware\ndatetimes, and vice-versa. If your application connects to other systems – for instance, if it queries\na web service – make sure datetimes are properly specified. To transmit\ndatetimes safely, their representation should include the UTC offset, or\ntheir values should be in UTC (or both!). Finally, our calendar system contains interesting edge cases. For example,\nyou can’t always subtract one year directly from a given date: >>> import datetime >>> def one_year_before ( value ): # Wrong example. ... return value . replace ( year = value . year - 1 ) ... >>> one_year_before ( datetime . datetime ( 2012 , 3 , 1 , 10 , 0 )) datetime.datetime(2011, 3, 1, 10, 0) >>> one_year_before ( datetime . datetime ( 2012 , 2 , 29 , 10 , 0 )) Traceback (most recent call last): ... ValueError : day is out of range for month To implement such a function correctly, you must decide whether 2012-02-29\nminus one year is 2011-02-28 or 2011-03-01, which depends on your business\nrequirements. How do I interact with a database that stores datetimes in local time? Set the TIME_ZONE option to the appropriate\ntime zone for this database in the DATABASES setting. This is useful for connecting to a database that doesn’t support time zones\nand that isn’t managed by Django when USE_TZ is True . Troubleshooting ¶ My application crashes with TypeError: can't compare offset-naive and offset-aware datetimes – what’s wrong? Let’s reproduce this error by comparing a naive and an aware datetime: >>> from django.utils import timezone >>> aware = timezone . now () >>> naive = timezone . make_naive ( aware ) >>> naive == aware Traceback (most recent call last): ... TypeError : can't compare offset-naive and offset-aware datetimes If you encounter this error, most likely your code is comparing these two\nthings: a datetime provided by Django – for instance, a value read from a form or\na model field. Since you enabled time zone support, it’s aware. a datetime generated by your code, which is naive (or you wouldn’t be\nreading this). Generally, the correct solution is to change your code to use an aware\ndatetime instead. If you’re writing a pluggable application that’s expected to work\nindependently of the value of USE_TZ , you may find django.utils.timezone.now() useful. This function returns the current\ndate and time as a naive datetime when USE_TZ = False and as an aware\ndatetime when USE_TZ = True . You can add or subtract datetime.timedelta as needed. I see lots of RuntimeWarning: DateTimeField received a naive datetime (YYYY-MM-DD HH:MM:SS) while time zone support is active – is that bad? When time zone support is enabled, the database layer expects to receive\nonly aware datetimes from your code. This warning occurs when it receives a\nnaive datetime. This indicates that you haven’t finished porting your code\nfor time zone support. Please refer to the migration guide for tips on this process. In the meantime, for backwards compatibility, the datetime is considered to\nbe in the default time zone, which is generally what you expect. now.date() is yesterday! (or tomorrow) If you’ve always used naive datetimes, you probably believe that you can\nconvert a datetime to a date by calling its date() method. You also consider that a date is a lot like a datetime , except that it’s less accurate. None of this is true in a time zone aware environment: >>> import datetime >>> import zoneinfo >>> paris_tz = zoneinfo . ZoneInfo ( \"Europe/Paris\" ) >>> new_york_tz = zoneinfo . ZoneInfo ( \"America/New_York\" ) >>> paris = datetime . datetime ( 2012 , 3 , 3 , 1 , 30 , tzinfo = paris_tz ) # This is the correct way to convert between time zones. >>> new_york = paris . astimezone ( new_york_tz ) >>> paris == new_york , paris . date () == new_york . date () (True, False) >>> paris - new_york , paris . date () - new_york . date () (datetime.timedelta(0), datetime.timedelta(1)) >>> paris datetime.datetime(2012, 3, 3, 1, 30, tzinfo=zoneinfo.ZoneInfo(key='Europe/Paris')) >>> new_york datetime.datetime(2012, 3, 2, 19, 30, tzinfo=zoneinfo.ZoneInfo(key='America/New_York')) As this example shows, the same datetime has a different date, depending on\nthe time zone in which it is represented. But the real problem is more\nfundamental. A datetime represents a point in time . It’s absolute: it doesn’t depend\non anything. On the contrary, a date is a calendaring concept . It’s a\nperiod of time whose bounds depend on the time zone in which the date is\nconsidered. As you can see, these two concepts are fundamentally different,\nand converting a datetime to a date isn’t a deterministic operation. What does this mean in practice? Generally, you should avoid converting a datetime to date . For instance, you can use the date template filter to only show the date part of a datetime. This filter will\nconvert the datetime into the current time zone before formatting it,\nensuring the results appear correctly. If you really need to do the conversion yourself, you must ensure the\ndatetime is converted to the appropriate time zone first. Usually, this\nwill be the current timezone: >>> from django.utils import timezone >>> timezone . activate ( zoneinfo . ZoneInfo ( \"Asia/Singapore\" )) # For this example, we set the time zone to Singapore, but here's how # you would obtain the current time zone in the general case. >>> current_tz = timezone . get_current_timezone () >>> local = paris . astimezone ( current_tz ) >>> local datetime.datetime(2012, 3, 3, 8, 30, tzinfo=zoneinfo.ZoneInfo(key='Asia/Singapore')) >>> local . date () datetime.date(2012, 3, 3) I get an error “ Are time zone definitions for your database installed? ” If you are using MySQL, see the Time zone definitions section\nof the MySQL notes for instructions on loading time zone definitions. Usage ¶ I have a string \"2012-02-21 10:28:45\" and I know it’s in the \"Europe/Helsinki\" time zone. How do I turn that into an aware\ndatetime? Here you need to create the required ZoneInfo instance and attach it to\nthe naïve datetime: >>> import zoneinfo >>> from django.utils.dateparse import parse_datetime >>> naive = parse_datetime ( \"2012-02-21 10:28:45\" ) >>> naive . replace ( tzinfo = zoneinfo . ZoneInfo ( \"Europe/Helsinki\" )) datetime.datetime(2012, 2, 21, 10, 28, 45, tzinfo=zoneinfo.ZoneInfo(key='Europe/Helsinki')) How can I obtain the local time in the current time zone? Well, the first question is, do you really need to? You should only use local time when you’re interacting with humans, and the\ntemplate layer provides filters and tags to convert datetimes to the time zone of your choice. Furthermore, Python knows how to compare aware datetimes, taking into\naccount UTC offsets when necessary. It’s much easier (and possibly faster)\nto write all your model and view code in UTC. So, in most circumstances,\nthe datetime in UTC returned by django.utils.timezone.now() will be\nsufficient. For the sake of completeness, though, if you really want the local time\nin the current time zone, here’s how you can obtain it: >>> from django.utils import timezone >>> timezone . localtime ( timezone . now ()) datetime.datetime(2012, 3, 3, 20, 10, 53, 873365, tzinfo=zoneinfo.ZoneInfo(key='Europe/Paris')) In this example, the current time zone is \"Europe/Paris\" . How can I see all available time zones? zoneinfo.available_timezones() provides the set of all valid keys for\nIANA time zones available to your system. See the docs for usage\nconsiderations.", "keywords": ["users", "is_naive", "usefulness", "storage", "selection", "lots", "library", "field", "#", "audience", "new_york_tz", "helsinki", "+", "stores", "action", "representation", "range", "calendar", "compatibility", "paris", "bounds", "label", "http", "=", "results", "engine", "setup", "tag", "zones", "sets", "datetime.timedelta(1", "process", "choice", "set_timezone", "following", "type", "zoneinfo(key='asia", "objects", "documentation", "clock", "datetime.timedelta", "now.date", "file", "make_naive", "fix", "user", "cases", "attribute", "warning", "runtimewarning", "time", "mm", "tags", "date", "setting", "purposes", "faq", "simplicity", "account", "hour", "service", "things", "logic", "name", "parameter", "candidate", "filterwarnings", "humans", "paris_tz", "backends", "web", "issue", "problems", "daylight", "dst", "foot", "asia", "ss", "return", "applications", "transitions", "use_tz", "parse_datetime", "edge", "blog", "datetimefield", "astimezone", "question", "examples", "get_current_timezone", "store", "url", "error", "code", "period", "filter", "false", "york", "class", "migration", "django_timezone", "warnings", "autumn", "returns", "diagnose", "request", "database", "block", "output", "input", "business", "postgresql", "computers", "subclass", "customers", "usage", "step", "yesterday", "is_aware", "sake", "section", "cleaned_data", "concepts", "use", "environment", "solution", "operation", "order", "default", "choices", "form", "option", "properties", "format", "tests", "america", "django\\.db\\.models\\.fields", "day", "fixture", "considerations", "timezone", "endtimezone", "datetime.date(2012", "template", "header", "traceback", "tzname", "way", "endfor", "accept", "concept", "session", "¶", "post", "singapore", "function", "view", "websites", "control", "zone", "timezone.now", "lot", "bill", "tz", "point", "datetimes", "values", "zoneinfo(key='europe", "enables", "string", "city", "overview", "thing", "template.html", "databases", "timestamp", "common_timezones", "hh", "zoneinfo.available_timezones", "hand", "language", "models", "version", "datetime.tzinfo", "processor", "benefits", "transition", "django", "profile", "n’t", "localtime", "conversions", "new_york", "set", "development", "practice", "value", "django.shortcuts", "london", "retrieval", "data", "datetime", "backend", "guide", "layer", "get_response", "tips", "self", "instance", "effects", "typeerror", "localization", "consequence", "|", "wall", "contrary", "naïve", "timedelta", "bugs", "docs", "datetime.datetime(2012", "constructor", "tzinfo", "part", "fixtures", "object", "load", "valueerror", "calendaring", "website", "interpretation", "instructions", "locale", "s", "conversion", "variables", "current_tz", "redirect", "notes", "activate", "system", "django.utils.timezone.now", "loaddata", "zoneinfo", "completeness", "difference", "forms", "’s", "example", "month", "requirements", "locations", "modelname.field_name", "datetime.timedelta(0", "utc", "django.utils.timezone", "clocks", "map", "model", "year", "reasons", "timezones", "systems", "fromtimestamp", "application", "zoneinfo(key='america", "timezonemiddleware", "countries", "sense", "r", "circumstances", "spring", "ones", "keys", "case", "equivalent", "errors", "deactivate", "server", "tomorrow", "init", "middleware", "end", "translations", "make_aware", "helpers", "functions", "operations", "django.utils.dateparse", "none", "filters", "problem", "definitions", "meantime", "reason", "new", "true", "dd", "support", "mode", "projects", "yyyy", "connection", "vice", "django.utils", "context", "offset", "saving", "import", "europe", "mysql", "%", "call", "information", "python", "exception", "method", "forces", "settings", "argument", "offsets", "tasks", "templates", "lack", "project", "exceptions"], "type": "documentation"},
{"title": "Internationalization and localization | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/i18n/", "content": "Internationalization and localization ¶ Overview ¶ The goal of internationalization and localization is to allow a single web\napplication to offer its content in languages and formats tailored to the\naudience. Django has full support for translation of text , formatting of dates, times and numbers , and time zones . Essentially, Django does two things: It allows developers and template authors to specify which parts of their apps\nshould be translated or formatted for local languages and cultures. It uses these hooks to localize web apps for particular users according to\ntheir preferences. Translation depends on the target language, and formatting usually depends on\nthe target country. This information is provided by browsers in the Accept-Language header. However, the time zone isn’t readily available. Definitions ¶ The words “internationalization” and “localization” often cause confusion;\nhere’s a simplified definition: internationalization ¶ Preparing the software for localization. Usually done by developers. localization ¶ Writing the translations and local formats. Usually done by translators. More details can be found in the W3C Web Internationalization FAQ , the Wikipedia article or the GNU gettext documentation . Warning Translation is controlled by the USE_I18N setting. However, it\ninvolves internationalization and localization. The name of the setting is\nan unfortunate result of Django’s history. Here are some other terms that will help us to handle a common language: locale name ¶ A locale name, either a language specification of the form ll or a\ncombined language and country specification of the form ll_CC .\nExamples: it , de_AT , es , pt_BR , sr_Latn . The language\npart is always in lowercase. The country part is in titlecase if it has\nmore than 2 characters, otherwise it’s in uppercase. The separator is an\nunderscore. language code ¶ Represents the name of a language. Browsers send the names of the\nlanguages they accept in the Accept-Language HTTP header using this\nformat. Examples: it , de-at , es , pt-br . Language codes\nare generally represented in lowercase, but the HTTP Accept-Language header is case-insensitive. The separator is a dash. message file ¶ A message file is a plain-text file, representing a single language,\nthat contains all available translation strings and how they should be represented in the given\nlanguage. Message files have a .po file extension. translation string ¶ A literal that can be translated. format file ¶ A format file is a Python module that defines the data formats for a given\nlocale.", "keywords": ["users", "examples", "goal", "result", "zone", "definition", "target", "module", "code", "string", "cultures", "hooks", "country", "audience", "overview", "names", "wikipedia", "numbers", "formatting", "language", "dates", "history", "strings", "preferences", "words", "literal", "gnu", "article", "confusion", "application", "django", "http", "message", "languages", "lowercase", "es", "translation", "zones", "codes", "specification", "case", "data", "separator", "underscore", "software", "br", "gettext", "translations", "documentation", "file", "localization", "extension", "form", "dash", "format", "characters", "developers", "warning", "time", "definitions", "setting", "faq", "browsers", "part", "support", "things", "files", "name", "template", "header", "authors", "locale", "formats", "information", "terms", "web", "python", "translators", "uppercase", "w3c", "times", "titlecase", "pt", "accept", "details", "¶", "internationalization", "apps", "text", "content", "parts"], "type": "documentation"},
{"title": "How to create custom template tags and filters | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/custom-template-tags/", "content": "How to create custom template tags and filters ¶ Django’s template language comes with a wide variety of built-in\ntags and filters designed to address the\npresentation logic needs of your application. Nevertheless, you may\nfind yourself needing functionality that is not covered by the core\nset of template primitives. You can extend the template engine by\ndefining custom tags and filters using Python, and then make them\navailable to your templates using the {% load %} tag. Code layout ¶ The most common place to specify custom template tags and filters is inside\na Django app. If they relate to an existing app, it makes sense to bundle them\nthere; otherwise, they can be added to a new app. When a Django app is added\nto INSTALLED_APPS , any tags it defines in the conventional location\ndescribed below are automatically made available to load within templates. The app should contain a templatetags directory, at the same level as models.py , views.py , etc. If this doesn’t already exist, create it -\ndon’t forget the __init__.py file to ensure the directory is treated as a\nPython package. Development server won’t automatically restart After adding the templatetags module, you will need to restart your\nserver before you can use the tags or filters in templates. Your custom tags and filters will live in a module inside the templatetags directory. The name of the module file is the name you’ll use to load the tags\nlater, so be careful to pick a name that won’t clash with custom tags and\nfilters in another app. For example, if your custom tags/filters are in a file called poll_extras.py , your app layout might look like this: polls/\n    __init__.py\n    models.py\n    templatetags/\n        __init__.py\n        poll_extras.py\n    views.py And in your template you would use the following: {% load poll_extras %} The app that contains the custom tags must be in INSTALLED_APPS in\norder for the {% load %} tag to work. This is a security feature:\nIt allows you to host Python code for many template libraries on a single host\nmachine without enabling access to all of them for every Django installation. There’s no limit on how many modules you put in the templatetags package.\nJust keep in mind that a {% load %} statement will load\ntags/filters for the given Python module name, not the name of the app. To be a valid tag library, the module must contain a module-level variable\nnamed register that is a template.Library instance, in which all the\ntags and filters are registered. So, near the top of your module, put the\nfollowing: from django import template register = template . Library () Alternatively, template tag modules can be registered through the 'libraries' argument to DjangoTemplates . This is useful if\nyou want to use a different label from the template tag module name when\nloading template tags. It also enables you to register tags without installing\nan application. Behind the scenes For a ton of examples, read the source code for Django’s default filters\nand tags. They’re in django/template/defaultfilters.py and django/template/defaulttags.py , respectively. For more information on the load tag, read its documentation. Writing custom template filters ¶ Custom filters are Python functions that take one or two arguments: The value of the variable (input) – not necessarily a string. The value of the argument – this can have a default value, or be left\nout altogether. For example, in the filter {{ var|foo:\"bar\" }} , the filter foo would be\npassed the variable var and the argument \"bar\" . Since the template language doesn’t provide exception handling, any exception\nraised from a template filter will be exposed as a server error. Thus, filter\nfunctions should avoid raising exceptions if there is a reasonable fallback\nvalue to return. In case of input that represents a clear bug in a template,\nraising an exception may still be better than silent failure which hides the\nbug. Here’s an example filter definition: def cut ( value , arg ): \"\"\"Removes all values of arg from the given string\"\"\" return value . replace ( arg , \"\" ) And here’s an example of how that filter would be used: {{ somevariable | cut :\"0\" }} Most filters don’t take arguments. In this case, leave the argument out of your\nfunction: def lower ( value ): # Only one argument. \"\"\"Converts a string into all lowercase\"\"\" return value . lower () Registering custom filters ¶ django.template.Library. filter () ¶ Once you’ve written your filter definition, you need to register it with\nyour Library instance, to make it available to Django’s template language: register . filter ( \"cut\" , cut ) register . filter ( \"lower\" , lower ) The Library.filter() method takes two arguments: The name of the filter – a string. The compilation function – a Python function (not the name of the\nfunction as a string). You can use register.filter() as a decorator instead: @register . filter ( name = \"cut\" ) def cut ( value , arg ): return value . replace ( arg , \"\" ) @register . filter def lower ( value ): return value . lower () If you leave off the name argument, as in the second example above, Django\nwill use the function’s name as the filter name. Finally, register.filter() also accepts three keyword arguments, is_safe , needs_autoescape , and expects_localtime . These arguments\nare described in filters and auto-escaping and filters and time zones below. Template filters that expect strings ¶ django.template.defaultfilters. stringfilter () ¶ If you’re writing a template filter that only expects a string as the first\nargument, you should use the decorator stringfilter . This will\nconvert an object to its string value before being passed to your function: from django import template from django.template.defaultfilters import stringfilter register = template . Library () @register . filter @stringfilter def lower ( value ): return value . lower () This way, you’ll be able to pass, say, an integer to this filter, and it\nwon’t cause an AttributeError (because integers don’t have lower() methods). Filters and auto-escaping ¶ When writing a custom filter, give some thought to how the filter will interact\nwith Django’s auto-escaping behavior. Note that two types of strings can be\npassed around inside the template code: Raw strings are the native Python strings. On output, they’re escaped if\nauto-escaping is in effect and presented unchanged, otherwise. Safe strings are strings that have been marked safe from further\nescaping at output time. Any necessary escaping has already been done.\nThey’re commonly used for output that contains raw HTML that is intended\nto be interpreted as-is on the client side. Internally, these strings are of type SafeString . You can test for them\nusing code like: from django.utils.safestring import SafeString if isinstance ( value , SafeString ): # Do something with the \"safe\" string. ... Template filter code falls into one of two situations: Your filter does not introduce any HTML-unsafe characters ( < , > , ' , \" or & ) into the result that were not already present. In\nthis case, you can let Django take care of all the auto-escaping\nhandling for you. All you need to do is set the is_safe flag to True when you register your filter function, like so: @register . filter ( is_safe = True ) def myfilter ( value ): return value This flag tells Django that if a “safe” string is passed into your\nfilter, the result will still be “safe” and if a non-safe string is\npassed in, Django will automatically escape it, if necessary. You can think of this as meaning “this filter is safe – it doesn’t\nintroduce any possibility of unsafe HTML.” The reason is_safe is necessary is because there are plenty of\nnormal string operations that will turn a SafeData object back into\na normal str object and, rather than try to catch them all, which would\nbe very difficult, Django repairs the damage after the filter has completed. For example, suppose you have a filter that adds the string xx to\nthe end of any input. Since this introduces no dangerous HTML characters\nto the result (aside from any that were already present), you should\nmark your filter with is_safe : @register . filter ( is_safe = True ) def add_xx ( value ): return \" %s xx\" % value When this filter is used in a template where auto-escaping is enabled,\nDjango will escape the output whenever the input is not already marked\nas “safe”. By default, is_safe is False , and you can omit it from any filters\nwhere it isn’t required. Be careful when deciding if your filter really does leave safe strings\nas safe. If you’re removing characters, you might inadvertently leave\nunbalanced HTML tags or entities in the result. For example, removing a > from the input might turn <a> into <a , which would need to\nbe escaped on output to avoid causing problems. Similarly, removing a\nsemicolon ( ; ) can turn &amp; into &amp , which is no longer a\nvalid entity and thus needs further escaping. Most cases won’t be nearly\nthis tricky, but keep an eye out for any problems like that when\nreviewing your code. Marking a filter is_safe will coerce the filter’s return value to\na string.  If your filter should return a boolean or other non-string\nvalue, marking it is_safe will probably have unintended\nconsequences (such as converting a boolean False to the string\n‘False’). Alternatively, your filter code can manually take care of any necessary\nescaping. This is necessary when you’re introducing new HTML markup into\nthe result. You want to mark the output as safe from further\nescaping so that your HTML markup isn’t escaped further, so you’ll need\nto handle the input yourself. To mark the output as a safe string, use django.utils.safestring.mark_safe() . Be careful, though. You need to do more than just mark the output as\nsafe. You need to ensure it really is safe, and what you do depends on\nwhether auto-escaping is in effect. The idea is to write filters that\ncan operate in templates where auto-escaping is either on or off in\norder to make things easier for your template authors. In order for your filter to know the current auto-escaping state, set the needs_autoescape flag to True when you register your filter function.\n(If you don’t specify this flag, it defaults to False ). This flag tells\nDjango that your filter function wants to be passed an extra keyword\nargument, called autoescape , that is True if auto-escaping is in\neffect and False otherwise. It is recommended to set the default of the autoescape parameter to True , so that if you call the function\nfrom Python code it will have escaping enabled by default. For example, let’s write a filter that emphasizes the first character of\na string: from django import template from django.utils.html import conditional_escape from django.utils.safestring import mark_safe register = template . Library () @register . filter ( needs_autoescape = True ) def initial_letter_filter ( text , autoescape = True ): first , other = text [ 0 ], text [ 1 :] if autoescape : esc = conditional_escape else : esc = lambda x : x result = \"<strong> %s </strong> %s \" % ( esc ( first ), esc ( other )) return mark_safe ( result ) The needs_autoescape flag and the autoescape keyword argument mean\nthat our function will know whether automatic escaping is in effect when the\nfilter is called. We use autoescape to decide whether the input data\nneeds to be passed through django.utils.html.conditional_escape or not.\n(In the latter case, we use the identity function as the “escape” function.)\nThe conditional_escape() function is like escape() except it only\nescapes input that is not a SafeData instance. If a SafeData instance is passed to conditional_escape() , the data is returned\nunchanged. Finally, in the above example, we remember to mark the result as safe\nso that our HTML is inserted directly into the template without further\nescaping. There’s no need to worry about the is_safe flag in this case\n(although including it wouldn’t hurt anything). Whenever you manually\nhandle the auto-escaping issues and return a safe string, the is_safe flag won’t change anything either way. Warning Avoiding XSS vulnerabilities when reusing built-in filters Django’s built-in filters have autoescape=True by default in order to\nget the proper autoescaping behavior and avoid a cross-site script\nvulnerability. In older versions of Django, be careful when reusing Django’s built-in\nfilters as autoescape defaults to None . You’ll need to pass autoescape=True to get autoescaping. For example, if you wanted to write a custom filter called urlize_and_linebreaks that combined the urlize and linebreaksbr filters, the filter would look like: from django.template.defaultfilters import linebreaksbr , urlize @register . filter ( needs_autoescape = True ) def urlize_and_linebreaks ( text , autoescape = True ): return linebreaksbr ( urlize ( text , autoescape = autoescape ), autoescape = autoescape ) Then: {{ comment | urlize_and_linebreaks }} would be equivalent to: {{ comment | urlize | linebreaksbr }} Filters and time zones ¶ If you write a custom filter that operates on datetime objects, you’ll usually register it with the expects_localtime flag set to True : @register . filter ( expects_localtime = True ) def businesshours ( value ): try : return 9 <= value . hour < 17 except AttributeError : return \"\" When this flag is set, if the first argument to your filter is a time zone\naware datetime, Django will convert it to the current time zone before passing\nit to your filter when appropriate, according to rules for time zones\nconversions in templates . Writing custom template tags ¶ Tags are more complex than filters, because tags can do anything. Django\nprovides a number of shortcuts that make writing most types of tags easier.\nFirst we’ll explore those shortcuts, then explain how to write a tag from\nscratch for those cases when the shortcuts aren’t powerful enough. Simple tags ¶ django.template.Library. simple_tag () ¶ Many template tags take a number of arguments – strings or template variables\n– and return a result after doing some processing based solely on\nthe input arguments and some external information. For example, a current_time tag might accept a format string and return the time as a\nstring formatted accordingly. To ease the creation of these types of tags, Django provides a helper function, simple_tag . This function, which is a method of django.template.Library , takes a function that accepts any number of\narguments, wraps it in a render function and the other necessary bits\nmentioned above and registers it with the template system. Our current_time function could thus be written like this: import datetime from django import template register = template . Library () @register . simple_tag def current_time ( format_string ): return datetime . datetime . now () . strftime ( format_string ) A few things to note about the simple_tag helper function: Checking for the required number of arguments, etc., has already been\ndone by the time our function is called, so we don’t need to do that. The quotes around the argument (if any) have already been stripped away,\nso we receive a plain string. If the argument was a template variable, our function is passed the\ncurrent value of the variable, not the variable itself. Unlike other tag utilities, simple_tag passes its output through conditional_escape() if the template context is in\nautoescape mode, to ensure correct HTML and protect you from XSS\nvulnerabilities. If additional escaping is not desired, you will need to use mark_safe() if you are absolutely sure that your\ncode does not contain XSS vulnerabilities. For building small HTML snippets,\nuse of format_html() instead of mark_safe() is\nstrongly recommended. If your template tag needs to access the current context, you can use the takes_context argument when registering your tag: @register . simple_tag ( takes_context = True ) def current_time ( context , format_string ): timezone = context [ \"timezone\" ] return your_get_current_time_method ( timezone , format_string ) Note that the first argument must be called context . For more information on how the takes_context option works, see the section\non inclusion tags . If you need to rename your tag, you can provide a custom name for it: register . simple_tag ( lambda x : x - 1 , name = \"minusone\" ) @register . simple_tag ( name = \"minustwo\" ) def some_function ( value ): return value - 2 simple_tag functions may accept any number of positional or keyword\narguments. For example: @register . simple_tag def my_tag ( a , b , * args , ** kwargs ): warning = kwargs [ \"warning\" ] profile = kwargs [ \"profile\" ] ... return ... Then in the template any number of arguments, separated by spaces, may be\npassed to the template tag. Like in Python, the values for keyword arguments\nare set using the equal sign (” = ”) and must be provided after the\npositional arguments. For example: {% my_tag 123 \"abcd\" book.title warning = message | lower profile = user.profile %} It’s possible to store the tag results in a template variable rather than\ndirectly outputting it. This is done by using the as argument followed by\nthe variable name. Doing so enables you to output the content yourself where\nyou see fit: {% current_time \"%Y-%m-%d %I:%M %p\" as the_time %} < p > The time is {{ the_time }} . </ p > Inclusion tags ¶ django.template.Library. inclusion_tag () ¶ Another common type of template tag is the type that displays some data by\nrendering another template. For example, Django’s admin interface uses custom\ntemplate tags to display the buttons along the bottom of the “add/change” form\npages. Those buttons always look the same, but the link targets change\ndepending on the object being edited – so they’re a perfect case for using a\nsmall template that is filled with details from the current object. (In the\nadmin’s case, this is the submit_row tag.) These sorts of tags are called “inclusion tags”. Writing inclusion tags is probably best demonstrated by example. Let’s write a\ntag that outputs a list of choices for a given Poll object, such as was\ncreated in the tutorials . We’ll use the tag like this: {% show_results poll %} …and the output will be something like this: < ul > < li > First choice </ li > < li > Second choice </ li > < li > Third choice </ li > </ ul > First, define the function that takes the argument and produces a dictionary of\ndata for the result. The important point here is we only need to return a\ndictionary, not anything more complex. This will be used as a template context\nfor the template fragment. Example: def show_results ( poll ): choices = poll . choice_set . all () return { \"choices\" : choices } Next, create the template used to render the tag’s output. This template is a\nfixed feature of the tag: the tag writer specifies it, not the template\ndesigner. Following our example, the template is very short: < ul > {% for choice in choices %} < li > {{ choice }} </ li > {% endfor %} </ ul > Now, create and register the inclusion tag by calling the inclusion_tag() method on a Library object. Following our example, if the above template is\nin a file called results.html in a directory that’s searched by the\ntemplate loader, we’d register the tag like this: # Here, register is a django.template.Library instance, as before @register . inclusion_tag ( \"results.html\" ) def show_results ( poll ): ... Alternatively it is possible to register the inclusion tag using a django.template.Template instance: from django.template.loader import get_template t = get_template ( \"results.html\" ) register . inclusion_tag ( t )( show_results ) …when first creating the function. Sometimes, your inclusion tags might require a large number of arguments,\nmaking it a pain for template authors to pass in all the arguments and remember\ntheir order. To solve this, Django provides a takes_context option for\ninclusion tags. If you specify takes_context in creating a template tag,\nthe tag will have no required arguments, and the underlying Python function\nwill have one argument – the template context as of when the tag was called. For example, say you’re writing an inclusion tag that will always be used in a\ncontext that contains home_link and home_title variables that point\nback to the main page. Here’s what the Python function would look like: @register . inclusion_tag ( \"link.html\" , takes_context = True ) def jump_link ( context ): return { \"link\" : context [ \"home_link\" ], \"title\" : context [ \"home_title\" ], } Note that the first parameter to the function must be called context . In that register.inclusion_tag() line, we specified takes_context=True and the name of the template. Here’s what the template link.html might look\nlike: Jump directly to < a href = \" {{ link }} \" > {{ title }} </ a > . Then, any time you want to use that custom tag, load its library and call it\nwithout any arguments, like so: {% jump_link %} Note that when you’re using takes_context=True , there’s no need to pass\narguments to the template tag. It automatically gets access to the context. The takes_context parameter defaults to False . When it’s set to True , the tag is passed the context object, as in this example. That’s the\nonly difference between this case and the previous inclusion_tag example. inclusion_tag functions may accept any number of positional or keyword\narguments. For example: @register . inclusion_tag ( \"my_template.html\" ) def my_tag ( a , b , * args , ** kwargs ): warning = kwargs [ \"warning\" ] profile = kwargs [ \"profile\" ] ... return ... Then in the template any number of arguments, separated by spaces, may be\npassed to the template tag. Like in Python, the values for keyword arguments\nare set using the equal sign (” = ”) and must be provided after the\npositional arguments. For example: {% my_tag 123 \"abcd\" book.title warning = message | lower profile = user.profile %} Advanced custom template tags ¶ Sometimes the basic features for custom template tag creation aren’t enough.\nDon’t worry, Django gives you complete access to the internals required to build\na template tag from the ground up. A quick overview ¶ The template system works in a two-step process: compiling and rendering. To\ndefine a custom template tag, you specify how the compilation works and how\nthe rendering works. When Django compiles a template, it splits the raw template text into\n‘’nodes’’. Each node is an instance of django.template.Node and has\na render() method. A compiled template is a list of Node objects. When\nyou call render() on a compiled template object, the template calls render() on each Node in its node list, with the given context.  The\nresults are all concatenated together to form the output of the template. Thus, to define a custom template tag, you specify how the raw template tag is\nconverted into a Node (the compilation function), and what the node’s render() method does. Writing the compilation function ¶ For each template tag the template parser encounters, it calls a Python\nfunction with the tag contents and the parser object itself. This function is\nresponsible for returning a Node instance based on the contents of the tag. For example, let’s write a full implementation of our template tag, {% current_time %} , that displays the current date/time, formatted according\nto a parameter given in the tag, in strftime() syntax. It’s a good\nidea to decide the tag syntax before anything else. In our case, let’s say the\ntag should be used like this: < p > The time is {% current_time \"%Y-%m-%d %I:%M %p\" %} . </ p > The parser for this function should grab the parameter and create a Node object: from django import template def do_current_time ( parser , token ): try : # split_contents() knows not to split quoted strings. tag_name , format_string = token . split_contents () except ValueError : raise template . TemplateSyntaxError ( \" %r tag requires a single argument\" % token . contents . split ()[ 0 ] ) if not ( format_string [ 0 ] == format_string [ - 1 ] and format_string [ 0 ] in ( '\"' , \"'\" )): raise template . TemplateSyntaxError ( \" %r tag's argument should be in quotes\" % tag_name ) return CurrentTimeNode ( format_string [ 1 : - 1 ]) Notes: parser is the template parser object. We don’t need it in this\nexample. token.contents is a string of the raw contents of the tag. In our\nexample, it’s 'current_time \"%Y-%m-%d %I:%M %p\"' . The token.split_contents() method separates the arguments on spaces\nwhile keeping quoted strings together. The more straightforward token.contents.split() wouldn’t be as robust, as it would naively\nsplit on all spaces, including those within quoted strings. It’s a good\nidea to always use token.split_contents() . This function is responsible for raising django.template.TemplateSyntaxError , with helpful messages, for\nany syntax error. The TemplateSyntaxError exceptions use the tag_name variable.\nDon’t hard-code the tag’s name in your error messages, because that\ncouples the tag’s name to your function. token.contents.split()[0] will ‘’always’’ be the name of your tag – even when the tag has no\narguments. The function returns a CurrentTimeNode with everything the node needs\nto know about this tag. In this case, it passes the argument – \"%Y-%m-%d %I:%M %p\" . The leading and trailing quotes from the\ntemplate tag are removed in format_string[1:-1] . The parsing is very low-level. The Django developers have experimented\nwith writing small frameworks on top of this parsing system, using\ntechniques such as EBNF grammars, but those experiments made the template\nengine too slow. It’s low-level because that’s fastest. Writing the renderer ¶ The second step in writing custom tags is to define a Node subclass that\nhas a render() method. Continuing the above example, we need to define CurrentTimeNode : import datetime from django import template class CurrentTimeNode ( template . Node ): def __init__ ( self , format_string ): self . format_string = format_string def render ( self , context ): return datetime . datetime . now () . strftime ( self . format_string ) Notes: __init__() gets the format_string from do_current_time() .\nAlways pass any options/parameters/arguments to a Node via its __init__() . The render() method is where the work actually happens. render() should generally fail silently, particularly in a production\nenvironment. In some cases however, particularly if context.template.engine.debug is True , this method may raise an\nexception to make debugging easier. For example, several core tags raise django.template.TemplateSyntaxError if they receive the wrong number or\ntype of arguments. Ultimately, this decoupling of compilation and rendering results in an\nefficient template system, because a template can render multiple contexts\nwithout having to be parsed multiple times. Auto-escaping considerations ¶ The output from template tags is not automatically run through the\nauto-escaping filters (with the exception of simple_tag() as described above). However, there\nare still a couple of things you should keep in mind when writing a template\ntag. If the render() method of your template tag stores the result in a context\nvariable (rather than returning the result in a string), it should take care\nto call mark_safe() if appropriate. When the variable is ultimately\nrendered, it will be affected by the auto-escape setting in effect at the\ntime, so content that should be safe from further escaping needs to be marked\nas such. Also, if your template tag creates a new context for performing some\nsub-rendering, set the auto-escape attribute to the current context’s value.\nThe __init__ method for the Context class takes a parameter called autoescape that you can use for this purpose. For example: from django.template import Context def render ( self , context ): # ... new_context = Context ({ \"var\" : obj }, autoescape = context . autoescape ) # ... Do something with new_context ... This is not a very common situation, but it’s useful if you’re rendering a\ntemplate yourself. For example: def render ( self , context ): t = context . template . engine . get_template ( \"small_fragment.html\" ) return t . render ( Context ({ \"var\" : obj }, autoescape = context . autoescape )) If we had neglected to pass in the current context.autoescape value to our\nnew Context in this example, the results would have always been\nautomatically escaped, which may not be the desired behavior if the template\ntag is used inside a {% autoescape off %} block. Thread-safety considerations ¶ Once a node is parsed, its render method may be called any number of times.\nSince Django is sometimes run in multi-threaded environments, a single node may\nbe simultaneously rendering with different contexts in response to two separate\nrequests. Therefore, it’s important to make sure your template tags are thread\nsafe. To make sure your template tags are thread safe, you should never store state\ninformation on the node itself. For example, Django provides a builtin cycle template tag that cycles among a list of given strings each time\nit’s rendered: {% for o in some_list %} < tr class = \" {% cycle 'row1' 'row2' %} \" > ... </ tr > {% endfor %} A naive implementation of CycleNode might look something like this: import itertools from django import template class CycleNode ( template . Node ): def __init__ ( self , cyclevars ): self . cycle_iter = itertools . cycle ( cyclevars ) def render ( self , context ): return next ( self . cycle_iter ) But, suppose we have two templates rendering the template snippet from above at\nthe same time: Thread 1 performs its first loop iteration, CycleNode.render() returns ‘row1’ Thread 2 performs its first loop iteration, CycleNode.render() returns ‘row2’ Thread 1 performs its second loop iteration, CycleNode.render() returns ‘row1’ Thread 2 performs its second loop iteration, CycleNode.render() returns ‘row2’ The CycleNode is iterating, but it’s iterating globally. As far as Thread 1\nand Thread 2 are concerned, it’s always returning the same value. This is\nnot what we want! To address this problem, Django provides a render_context that’s associated\nwith the context of the template that is currently being rendered. The render_context behaves like a Python dictionary, and should be used to\nstore Node state between invocations of the render method. Let’s refactor our CycleNode implementation to use the render_context : class CycleNode ( template . Node ): def __init__ ( self , cyclevars ): self . cyclevars = cyclevars def render ( self , context ): if self not in context . render_context : context . render_context [ self ] = itertools . cycle ( self . cyclevars ) cycle_iter = context . render_context [ self ] return next ( cycle_iter ) Note that it’s perfectly safe to store global information that will not change\nthroughout the life of the Node as an attribute. In the case of CycleNode , the cyclevars argument doesn’t change after the Node is\ninstantiated, so we don’t need to put it in the render_context . But state\ninformation that is specific to the template that is currently being rendered,\nlike the current iteration of the CycleNode , should be stored in the render_context . Note Notice how we used self to scope the CycleNode specific information\nwithin the render_context . There may be multiple CycleNodes in a\ngiven template, so we need to be careful not to clobber another node’s\nstate information. The easiest way to do this is to always use self as\nthe key into render_context . If you’re keeping track of several state\nvariables, make render_context[self] a dictionary. Registering the tag ¶ Finally, register the tag with your module’s Library instance, as explained\nin writing custom template tags above. Example: register . tag ( \"current_time\" , do_current_time ) The tag() method takes two arguments: The name of the template tag – a string. If this is left out, the\nname of the compilation function will be used. The compilation function – a Python function (not the name of the\nfunction as a string). As with filter registration, it is also possible to use this as a decorator: @register . tag ( name = \"current_time\" ) def do_current_time ( parser , token ): ... @register . tag def shout ( parser , token ): ... If you leave off the name argument, as in the second example above, Django\nwill use the function’s name as the tag name. Passing template variables to the tag ¶ Although you can pass any number of arguments to a template tag using token.split_contents() , the arguments are all unpacked as\nstring literals. A little more work is required in order to pass dynamic\ncontent (a template variable) to a template tag as an argument. While the previous examples have formatted the current time into a string and\nreturned the string, suppose you wanted to pass in a DateTimeField from an object and have the template\ntag format that date-time: < p > This post was last updated at {% format_time blog_entry.date_updated \"%Y-%m-%d %I:%M %p\" %} . </ p > Initially, token.split_contents() will return three values: The tag name format_time . The string 'blog_entry.date_updated' (without the surrounding\nquotes). The formatting string '\"%Y-%m-%d %I:%M %p\"' . The return value from split_contents() will include the leading and trailing quotes for\nstring literals like this. Now your tag should begin to look like this: from django import template def do_format_time ( parser , token ): try : # split_contents() knows not to split quoted strings. tag_name , date_to_be_formatted , format_string = token . split_contents () except ValueError : raise template . TemplateSyntaxError ( \" %r tag requires exactly two arguments\" % token . contents . split ()[ 0 ] ) if not ( format_string [ 0 ] == format_string [ - 1 ] and format_string [ 0 ] in ( '\"' , \"'\" )): raise template . TemplateSyntaxError ( \" %r tag's argument should be in quotes\" % tag_name ) return FormatTimeNode ( date_to_be_formatted , format_string [ 1 : - 1 ]) You also have to change the renderer to retrieve the actual contents of the date_updated property of the blog_entry object.  This can be\naccomplished by using the Variable() class in django.template . To use the Variable class, instantiate it with the name of the variable to\nbe resolved, and then call variable.resolve(context) . So, for example: class FormatTimeNode ( template . Node ): def __init__ ( self , date_to_be_formatted , format_string ): self . date_to_be_formatted = template . Variable ( date_to_be_formatted ) self . format_string = format_string def render ( self , context ): try : actual_date = self . date_to_be_formatted . resolve ( context ) return actual_date . strftime ( self . format_string ) except template . VariableDoesNotExist : return \"\" Variable resolution will throw a VariableDoesNotExist exception if it\ncannot resolve the string passed to it in the current context of the page. Setting a variable in the context ¶ The above examples output a value. Generally, it’s more flexible if your\ntemplate tags set template variables instead of outputting values. That way,\ntemplate authors can reuse the values that your template tags create. To set a variable in the context, use dictionary assignment on the context\nobject in the render() method. Here’s an updated version of CurrentTimeNode that sets a template variable current_time instead of\noutputting it: import datetime from django import template class CurrentTimeNode2 ( template . Node ): def __init__ ( self , format_string ): self . format_string = format_string def render ( self , context ): context [ \"current_time\" ] = datetime . datetime . now () . strftime ( self . format_string ) return \"\" Note that render() returns the empty string. render() should always\nreturn string output. If all the template tag does is set a variable, render() should return the empty string. Here’s how you’d use this new version of the tag: {% current_time \"%Y-%m-%d %I:%M %p\" %} < p > The time is {{ current_time }} . </ p > Variable scope in context Any variable set in the context will only be available in the same block of the template in which it was assigned. This behavior is\nintentional; it provides a scope for variables so that they don’t conflict\nwith context in other blocks. But, there’s a problem with CurrentTimeNode2 : The variable name current_time is hard-coded. This means you’ll need to make sure your\ntemplate doesn’t use {{ current_time }} anywhere else, because the {% current_time %} will blindly overwrite that variable’s value. A cleaner\nsolution is to make the template tag specify the name of the output variable,\nlike so: {% current_time \"%Y-%m-%d %I:%M %p\" as my_current_time %} < p > The current time is {{ my_current_time }} . </ p > To do that, you’ll need to refactor both the compilation function and Node class, like so: import re class CurrentTimeNode3 ( template . Node ): def __init__ ( self , format_string , var_name ): self . format_string = format_string self . var_name = var_name def render ( self , context ): context [ self . var_name ] = datetime . datetime . now () . strftime ( self . format_string ) return \"\" def do_current_time ( parser , token ): # This version uses a regular expression to parse tag contents. try : # Splitting by None == splitting by spaces. tag_name , arg = token . contents . split ( None , 1 ) except ValueError : raise template . TemplateSyntaxError ( \" %r tag requires arguments\" % token . contents . split ()[ 0 ] ) m = re . search ( r \"(.*?) as (\\w+)\" , arg ) if not m : raise template . TemplateSyntaxError ( \" %r tag had invalid arguments\" % tag_name ) format_string , var_name = m . groups () if not ( format_string [ 0 ] == format_string [ - 1 ] and format_string [ 0 ] in ( '\"' , \"'\" )): raise template . TemplateSyntaxError ( \" %r tag's argument should be in quotes\" % tag_name ) return CurrentTimeNode3 ( format_string [ 1 : - 1 ], var_name ) The difference here is that do_current_time() grabs the format string and\nthe variable name, passing both to CurrentTimeNode3 . Finally, if you only need to have a simple syntax for your custom\ncontext-updating template tag, consider using the simple_tag() shortcut, which supports assigning\nthe tag results to a template variable. Parsing until another block tag ¶ Template tags can work in tandem. For instance, the standard {% comment %} tag hides everything until {% endcomment %} .\nTo create a template tag such as this, use parser.parse() in your\ncompilation function. Here’s how a simplified {% comment %} tag might be implemented: def do_comment ( parser , token ): nodelist = parser . parse (( \"endcomment\" ,)) parser . delete_first_token () return CommentNode () class CommentNode ( template . Node ): def render ( self , context ): return \"\" Note The actual implementation of {% comment %} is slightly\ndifferent in that it allows broken template tags to appear between {% comment %} and {% endcomment %} . It does so by calling parser.skip_past('endcomment') instead of parser.parse(('endcomment',)) followed by parser.delete_first_token() , thus avoiding the generation of a\nnode list. parser.parse() takes a tuple of names of block tags ‘’to parse until’’. It\nreturns an instance of django.template.NodeList , which is a list of\nall Node objects that the parser encountered ‘’before’’ it encountered\nany of the tags named in the tuple. In \"nodelist = parser.parse(('endcomment',))\" in the above example, nodelist is a list of all nodes between the {% comment %} and {% endcomment %} , not counting {% comment %} and {% endcomment %} themselves. After parser.parse() is called, the parser hasn’t yet “consumed” the {% endcomment %} tag, so the code needs to explicitly call parser.delete_first_token() . CommentNode.render() returns an empty string. Anything between {% comment %} and {% endcomment %} is ignored. Parsing until another block tag, and saving contents ¶ In the previous example, do_comment() discarded everything between {% comment %} and {% endcomment %} . Instead of doing that, it’s\npossible to do something with the code between block tags. For example, here’s a custom template tag, {% upper %} , that capitalizes\neverything between itself and {% endupper %} . Usage: {% upper %} This will appear in uppercase, {{ your_name }} . {% endupper %} As in the previous example, we’ll use parser.parse() . But this time, we\npass the resulting nodelist to the Node : def do_upper ( parser , token ): nodelist = parser . parse (( \"endupper\" ,)) parser . delete_first_token () return UpperNode ( nodelist ) class UpperNode ( template . Node ): def __init__ ( self , nodelist ): self . nodelist = nodelist def render ( self , context ): output = self . nodelist . render ( context ) return output . upper () The only new concept here is the self.nodelist.render(context) in UpperNode.render() . For more examples of complex rendering, see the source code of {% for %} in django/template/defaulttags.py and {% if %} in django/template/smartif.py .", "keywords": ["simple_tag", "commentnode", "feature", "amp", "my_tag", "messages", "b", "library", "safedata", "#", "cyclenode", "m", "bits", "loop", "stores", "variable.resolve(context", "host", "lambda", "blog_entry", "needs", "change", "render_context", "label", "=", "results", "engine", "message", "installation", "href", "character", "cut", "endupper", "tag", "your_get_current_time_method", "sorts", "zones", "decoupling", "parser.parse(('endcomment", "grammars", "process", "fallback", "pain", "choice", "snippets", "var", "autoescape", "following", "type", "processing", "custom", "kwargs", "objects", "documentation", "mind", "file", "ground", "layout", "work", "modules", "uppernode", "init__.py", "li", "fragment", "cases", "helper", "attribute", "args", "scenes", "primitives", "warning", "developers", "time", "minusone", "ebnf", "scratch", "tags", "poll_extras.py", "render", "date", "setting", "new_context", "experiments", "hour", "itertools", "things", "i:%m", "logic", "name", "parameter", "formattimenode", "escaping", "raise", "problems", "versions", "home_link", "literals", "return", "results.html", "foo", "situation", "format_html", "environments", "search", "datetimefield", "my_template.html", "examples", "failure", "format_time", "isinstance", "abcd", "error", "module", "code", "safety", "pages", "filter", "false", "behavior", "access", "link", "class", "endcomment", "names", "x", "snippet", "django.utils.safestring.mark_safe", "flag", "block", "output", "input", "takes_context", "*", "page", "conflict", "compilation", "types", "strings", "subclass", "admin", "creation", "book.title", "usage", "bottom", "limit", "script", "step", "token.contents", "thread", "entities", "link.html", "section", "source", "use", "encounters", "environment", "entity", "solution", "context.autoescape", "core", "order", "default", "loader", "markup", "choices", "inclusion", "bug", "comment", "form", "shortcuts", "option", "format", "expression", "characters", "variabledoesnotexist", "do_comment", "considerations", "timezone", "minustwo", "invocations", "template", "myfilter", "eye", "way", "endfor", "frameworks", "uppercase", "date_to_be_formatted", "t", "possibility", "concept", "cyclenodes", "current_time", "integer", "o", "¶", "format_string[1:-1", "templatesyntaxerror", "sub", "spaces", "parameters", "post", "integers", "property", "side", "tutorials", "templatetags", "content", "function", "result", "defaulttags.py", "zone", "number", "autoescaping", "def", "point", "stringfilter", "values", "string", "overview", "row2", "auto", "location", "libraries", "language", "blocks", "version", "level", "contents", "machine", "@register", "parse", "parser", "django", "vulnerability", "profile", "n’t", "utilities", "conversions", "set", "development", "lowercase", "p", "jump_link", "value", "defaultfilters.py", "thought", "format_string", "line", "nodes", "data", "implementation", "safestring", "scope", "datetime", "parser.parse", "show_results", "node", "add", "django.utils.html.conditional_escape", "security", "writer", "shortcut", "ul", "self", "need", "instance", "self.nodelist.render(context", "designer", "djangotemplates", "handling", "interface", "|", "functionality", "token.contents.split", "cycle_iter", "issues", "decorator", "row1", "needs_autoescape", "do_format_time", "statement", "django.template", "token.split_contents", "parser.skip_past('endcomment", "parser.delete_first_token", "object", "load", "couple", "valueerror", "groups", "linebreaksbr", "response", "register.inclusion_tag", "internals", "dictionary", "requests", "authors", "split_contents", "consequences", "situations", "rendering", "register", "keyword", "s", "resolution", "uppernode.render", "notice", "top", "rules", "variables", "registration", "inclusion_tag", "notes", "obj", "life", "effect", "system", "production", "var|foo:\"bar", "escape", "definition", "var_name", "difference", "features", "’s", "tandem", "example", "care", "app", "list", "tag_name", "nodelist", "currenttimenode", "parsing", "poll", "is_safe", "re", "variable", "currenttimenode3", "splitting", "idea", "techniques", "place", "application", "library.filter", "identity", "@stringfilter", "title", "shout", "sense", "variety", "contexts", "track", "plenty", "syntax", "r", "works", "case", "attributeerror", "arg", "assignment", "html", "context.template.engine.debug", "tuple", "server", "str", "arguments", "quotes", "package", "init", "xss", "end", "do_current_time", "generation", "bar", "django.template.defaultfilters", "get_template", "functions", "key", "operations", "urlize_and_linebreaks", "renderer", "none", "my_current_time", "filters", "problem", "sign", "ton", "do_upper", "reason", "register.filter", "semicolon", "true", "mode", "some_list", "context", "conditional_escape", "cycle", "import", "currenttimenode2", "damage", "iteration", "directory", "%", "defaults", "cyclevars", "information", "python", "esc", "businesshours", "strftime", "methods", "options", "times", "exception", "purpose", "initial_letter_filter", "client", "details", "method", "argument", "state", "mark_safe", "vulnerabilities", "templates", "presentation", "buttons", "text", "cyclenode.render", "expects_localtime", "exceptions"], "type": "documentation"},
{"title": "PostgreSQL specific lookups | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/lookups/", "content": "PostgreSQL specific lookups ¶ Trigram similarity ¶ trigram_similar ¶ The trigram_similar lookup allows you to perform trigram lookups,\nmeasuring the number of trigrams (three consecutive characters) shared, using a\ndedicated PostgreSQL extension. A trigram lookup is given an expression and\nreturns results that have a similarity measurement greater than the current\nsimilarity threshold. To use it, add 'django.contrib.postgres' in your INSTALLED_APPS and activate the pg_trgm extension on PostgreSQL. You can install the\nextension using the TrigramExtension migration\noperation. The trigram_similar lookup can be used on CharField and TextField : >>> City . objects . filter ( name__trigram_similar = \"Middlesborough\" ) ['<City: Middlesbrough>'] trigram_word_similar ¶ The trigram_word_similar lookup allows you to perform trigram word\nsimilarity lookups using a dedicated PostgreSQL extension. It can be\napproximately understood as measuring the greatest number of trigrams shared\nbetween the parameter and any substring of the field. A trigram word lookup is\ngiven an expression and returns results that have a word similarity measurement\ngreater than the current similarity threshold. To use it, add 'django.contrib.postgres' in your INSTALLED_APPS and activate the pg_trgm extension on PostgreSQL. You can install the\nextension using the TrigramExtension migration\noperation. The trigram_word_similar lookup can be used on CharField and TextField : >>> Sentence . objects . filter ( name__trigram_word_similar = \"Middlesborough\" ) ['<Sentence: Gumby rides on the path of Middlesbrough>'] trigram_strict_word_similar ¶ Similar to trigram_word_similar , except that it forces extent\nboundaries to match word boundaries. To use it, add 'django.contrib.postgres' in your INSTALLED_APPS and activate the pg_trgm extension on PostgreSQL. You can install the\nextension using the TrigramExtension migration\noperation. The trigram_strict_word_similar lookup can be used on CharField and TextField . Unaccent ¶ The unaccent lookup allows you to perform accent-insensitive lookups using\na dedicated PostgreSQL extension. This lookup is implemented using Transform , so it\ncan be chained with other lookup functions. To use it, you need to add 'django.contrib.postgres' in your INSTALLED_APPS and activate\nthe unaccent extension on PostgreSQL . The UnaccentExtension migration\noperation is available if you want to perform this activation using migrations). The unaccent lookup can be used on CharField and TextField : >>> City . objects . filter ( name__unaccent = \"México\" ) ['<City: Mexico>'] >>> User . objects . filter ( first_name__unaccent__startswith = \"Jerem\" ) ['<User: Jeremy>', '<User: Jérémy>', '<User: Jérémie>', '<User: Jeremie>'] Warning unaccent lookups should perform fine in most use cases. However, queries\nusing this filter will generally perform full table scans, which can be slow\non large tables. In those cases, using dedicated full text indexing tools\nmight be appropriate.", "keywords": ["trigram_similar", "transform", "sentence", "word", "gumby", "scans", "middlesborough", "charfield", "extent", "number", "objects", "parameter", "lookups", "name__unaccent", "activation", ">", "trigram", "django.contrib.postgres", "extension", "trigramextension", "operation", "unaccent", "jerem", "results", "middlesbrough", "jeremy", "user", "filter", "measurement", "path", "migration", "name__trigram_word_similar", "field", "functions", "cases", "threshold", "queries", "trigrams", "city", "méxico", "jérémy", "jérémie", "expression", "characters", "pg_trgm", "returns", "migrations", "¶", "'", "substring", "warning", "trigram_strict_word_similar", "tables", "first_name__unaccent__startswith", "tools", "boundaries", "similarity", "lookup", "table", "unaccentextension", "jeremie", "textfield", "use", "indexing", "mexico", "text", "installed_apps", "postgresql"], "type": "documentation"},
{"title": "Full text search | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/search/", "content": "Full text search ¶ The database functions in the django.contrib.postgres.search module ease\nthe use of PostgreSQL’s full text search engine . For the examples in this document, we’ll use the models defined in Making queries . See also For a high-level overview of searching, see the topic documentation . The search lookup ¶ A common way to use full text search is to search a single term against a\nsingle column in the database. For example: >>> Entry . objects . filter ( body_text__search = \"Cheese\" ) [<Entry: Cheese on Toast recipes>, <Entry: Pizza Recipes>] This creates a to_tsvector in the database from the body_text field\nand a plainto_tsquery from the search term 'Cheese' , both using the\ndefault database search configuration. The results are obtained by matching the\nquery and the vector. To use the search lookup, 'django.contrib.postgres' must be in your INSTALLED_APPS . SearchVector ¶ class SearchVector ( * expressions , config = None , weight = None ) [source] ¶ Searching against a single field is great but rather limiting. The Entry instances we’re searching belong to a Blog , which has a tagline field.\nTo query against both fields, use a SearchVector : >>> from django.contrib.postgres.search import SearchVector >>> Entry . objects . annotate ( ... search = SearchVector ( \"body_text\" , \"blog__tagline\" ), ... ) . filter ( search = \"Cheese\" ) [<Entry: Cheese on Toast recipes>, <Entry: Pizza Recipes>] The arguments to SearchVector can be any Expression or the name of a field. Multiple\narguments will be concatenated together using a space so that the search\ndocument includes them all. SearchVector objects can be combined together, allowing you to reuse them.\nFor example: >>> Entry . objects . annotate ( ... search = SearchVector ( \"body_text\" ) + SearchVector ( \"blog__tagline\" ), ... ) . filter ( search = \"Cheese\" ) [<Entry: Cheese on Toast recipes>, <Entry: Pizza Recipes>] See Changing the search configuration and Weighting queries for an explanation of the config and weight parameters. SearchQuery ¶ class SearchQuery ( value , config = None , search_type = 'plain' ) [source] ¶ SearchQuery translates the terms the user provides into a search query\nobject that the database compares to a search vector. By default, all the words\nthe user provides are passed through the stemming algorithms, and then it\nlooks for matches for all of the resulting terms. If search_type is 'plain' , which is the default, the terms are treated\nas separate keywords. If search_type is 'phrase' , the terms are treated\nas a single phrase. If search_type is 'raw' , then you can provide a\nformatted search query with terms and operators. If search_type is 'websearch' , then you can provide a formatted search query, similar to the\none used by web search engines. 'websearch' requires PostgreSQL ≥ 11. Read\nPostgreSQL’s Full Text Search docs to learn about differences and syntax.\nExamples: >>> from django.contrib.postgres.search import SearchQuery >>> SearchQuery ( \"red tomato\" ) # two keywords >>> SearchQuery ( \"tomato red\" ) # same results as above >>> SearchQuery ( \"red tomato\" , search_type = \"phrase\" ) # a phrase >>> SearchQuery ( \"tomato red\" , search_type = \"phrase\" ) # a different phrase >>> SearchQuery ( \"'tomato' & ('red' | 'green')\" , search_type = \"raw\" ) # boolean operators >>> SearchQuery ( ... \"'tomato' ('red' OR 'green')\" , search_type = \"websearch\" ... ) # websearch operators SearchQuery terms can be combined logically to provide more flexibility: >>> from django.contrib.postgres.search import SearchQuery >>> SearchQuery ( \"meat\" ) & SearchQuery ( \"cheese\" ) # AND >>> SearchQuery ( \"meat\" ) | SearchQuery ( \"cheese\" ) # OR >>> ~ SearchQuery ( \"meat\" ) # NOT See Changing the search configuration for an explanation of the config parameter. SearchRank ¶ class SearchRank ( vector , query , weights = None , normalization = None , cover_density = False ) [source] ¶ So far, we’ve returned the results for which any match between the vector and\nthe query are possible. It’s likely you may wish to order the results by some\nsort of relevancy. PostgreSQL provides a ranking function which takes into\naccount how often the query terms appear in the document, how close together\nthe terms are in the document, and how important the part of the document is\nwhere they occur. The better the match, the higher the value of the rank. To\norder by relevancy: >>> from django.contrib.postgres.search import SearchQuery , SearchRank , SearchVector >>> vector = SearchVector ( \"body_text\" ) >>> query = SearchQuery ( \"cheese\" ) >>> Entry . objects . annotate ( rank = SearchRank ( vector , query )) . order_by ( \"-rank\" ) [<Entry: Cheese on Toast recipes>, <Entry: Pizza recipes>] See Weighting queries for an explanation of the weights parameter. Set the cover_density parameter to True to enable the cover density\nranking, which means that the proximity of matching query terms is taken into\naccount. Provide an integer to the normalization parameter to control rank\nnormalization. This integer is a bit mask, so you can combine multiple\nbehaviors: >>> from django.db.models import Value >>> Entry . objects . annotate ( ... rank = SearchRank ( ... vector , ... query , ... normalization = Value ( 2 ) . bitor ( Value ( 4 )), ... ) ... ) The PostgreSQL documentation has more details about different rank\nnormalization options . SearchHeadline ¶ class SearchHeadline ( expression , query , config = None , start_sel = None , stop_sel = None , max_words = None , min_words = None , short_word = None , highlight_all = None , max_fragments = None , fragment_delimiter = None ) [source] ¶ Accepts a single text field or an expression, a query, a config, and a set of\noptions. Returns highlighted search results. Set the start_sel and stop_sel parameters to the string values to be\nused to wrap highlighted query terms in the document. PostgreSQL’s defaults are <b> and </b> . Provide integer values to the max_words and min_words parameters to\ndetermine the longest and shortest headlines. PostgreSQL’s defaults are 35 and\n15. Provide an integer value to the short_word parameter to discard words of\nthis length or less in each headline. PostgreSQL’s default is 3. Set the highlight_all parameter to True to use the whole document in\nplace of a fragment and ignore max_words , min_words , and short_word parameters. That’s disabled by default in PostgreSQL. Provide a non-zero integer value to the max_fragments to set the maximum\nnumber of fragments to display. That’s disabled by default in PostgreSQL. Set the fragment_delimiter string parameter to configure the delimiter\nbetween fragments. PostgreSQL’s default is \" ... \" . The PostgreSQL documentation has more details on highlighting search\nresults . Usage example: >>> from django.contrib.postgres.search import SearchHeadline , SearchQuery >>> query = SearchQuery ( \"red tomato\" ) >>> entry = Entry . objects . annotate ( ... headline = SearchHeadline ( ... \"body_text\" , ... query , ... start_sel = \"<span>\" , ... stop_sel = \"</span>\" , ... ), ... ) . get () >>> print ( entry . headline ) Sandwich with <span>tomato</span> and <span>red</span> cheese. See Changing the search configuration for an explanation of the config parameter. Changing the search configuration ¶ You can specify the config attribute to a SearchVector and SearchQuery to use a different search configuration. This allows using\ndifferent language parsers and dictionaries as defined by the database: >>> from django.contrib.postgres.search import SearchQuery , SearchVector >>> Entry . objects . annotate ( ... search = SearchVector ( \"body_text\" , config = \"french\" ), ... ) . filter ( search = SearchQuery ( \"œuf\" , config = \"french\" )) [<Entry: Pain perdu>] The value of config could also be stored in another column: >>> from django.db.models import F >>> Entry . objects . annotate ( ... search = SearchVector ( \"body_text\" , config = F ( \"blog__language\" )), ... ) . filter ( search = SearchQuery ( \"œuf\" , config = F ( \"blog__language\" ))) [<Entry: Pain perdu>] Weighting queries ¶ Every field may not have the same relevance in a query, so you can set weights\nof various vectors before you combine them: >>> from django.contrib.postgres.search import SearchQuery , SearchRank , SearchVector >>> vector = SearchVector ( \"body_text\" , weight = \"A\" ) + SearchVector ( ... \"blog__tagline\" , weight = \"B\" ... ) >>> query = SearchQuery ( \"cheese\" ) >>> Entry . objects . annotate ( rank = SearchRank ( vector , query )) . filter ( rank__gte = 0.3 ) . order_by ( ... \"rank\" ... ) The weight should be one of the following letters: D, C, B, A. By default,\nthese weights refer to the numbers 0.1 , 0.2 , 0.4 , and 1.0 ,\nrespectively. If you wish to weight them differently, pass a list of four\nfloats to SearchRank as weights in the same order above: >>> rank = SearchRank ( vector , query , weights = [ 0.2 , 0.4 , 0.6 , 0.8 ]) >>> Entry . objects . annotate ( rank = rank ) . filter ( rank__gte = 0.3 ) . order_by ( \"-rank\" ) Performance ¶ Special database configuration isn’t necessary to use any of these functions,\nhowever, if you’re searching more than a few hundred records, you’re likely to\nrun into performance problems. Full text search is a more intensive process\nthan comparing the size of an integer, for example. In the event that all the fields you’re querying on are contained within one\nparticular model, you can create a functional GIN or GiST index which matches\nthe search vector you wish to use. For example: GinIndex ( SearchVector ( \"body_text\" , \"headline\" , config = \"english\" ), name = \"search_vector_idx\" , ) The PostgreSQL documentation has details on creating indexes for full text search . SearchVectorField ¶ class SearchVectorField [source] ¶ If this approach becomes too slow, you can add a SearchVectorField to your\nmodel. You’ll need to keep it populated with triggers, for example, as\ndescribed in the PostgreSQL documentation . You can then query the field as\nif it were an annotated SearchVector : >>> Entry . objects . update ( search_vector = SearchVector ( \"body_text\" )) >>> Entry . objects . filter ( search_vector = \"cheese\" ) [<Entry: Cheese on Toast recipes>, <Entry: Pizza recipes>] Trigram similarity ¶ Another approach to searching is trigram similarity. A trigram is a group of\nthree consecutive characters. In addition to the trigram_similar , trigram_word_similar , and trigram_strict_word_similar lookups, you can use a couple of other expressions. To use them, you need to activate the pg_trgm extension on PostgreSQL. You can\ninstall it using the TrigramExtension migration\noperation. TrigramSimilarity ¶ class TrigramSimilarity ( expression , string , ** extra ) [source] ¶ Accepts a field name or expression, and a string or expression. Returns the\ntrigram similarity between the two arguments. Usage example: >>> from django.contrib.postgres.search import TrigramSimilarity >>> Author . objects . create ( name = \"Katy Stevens\" ) >>> Author . objects . create ( name = \"Stephen Keats\" ) >>> test = \"Katie Stephens\" >>> Author . objects . annotate ( ... similarity = TrigramSimilarity ( \"name\" , test ), ... ) . filter ( ... similarity__gt = 0.3 ... ) . order_by ( \"-similarity\" ) [<Author: Katy Stevens>, <Author: Stephen Keats>] TrigramWordSimilarity ¶ class TrigramWordSimilarity ( string , expression , ** extra ) [source] ¶ Accepts a string or expression, and a field name or expression. Returns the\ntrigram word similarity between the two arguments. Usage example: >>> from django.contrib.postgres.search import TrigramWordSimilarity >>> Author . objects . create ( name = \"Katy Stevens\" ) >>> Author . objects . create ( name = \"Stephen Keats\" ) >>> test = \"Kat\" >>> Author . objects . annotate ( ... similarity = TrigramWordSimilarity ( test , \"name\" ), ... ) . filter ( ... similarity__gt = 0.3 ... ) . order_by ( \"-similarity\" ) [<Author: Katy Stevens>] TrigramStrictWordSimilarity ¶ class TrigramStrictWordSimilarity ( string , expression , ** extra ) [source] ¶ Accepts a string or expression, and a field name or expression. Returns the\ntrigram strict word similarity between the two arguments. Similar to TrigramWordSimilarity() , except that it forces\nextent boundaries to match word boundaries. TrigramDistance ¶ class TrigramDistance ( expression , string , ** extra ) [source] ¶ Accepts a field name or expression, and a string or expression. Returns the\ntrigram distance between the two arguments. Usage example: >>> from django.contrib.postgres.search import TrigramDistance >>> Author . objects . create ( name = \"Katy Stevens\" ) >>> Author . objects . create ( name = \"Stephen Keats\" ) >>> test = \"Katie Stephens\" >>> Author . objects . annotate ( ... distance = TrigramDistance ( \"name\" , test ), ... ) . filter ( ... distance__lte = 0.7 ... ) . order_by ( \"distance\" ) [<Author: Katy Stevens>, <Author: Stephen Keats>] TrigramWordDistance ¶ class TrigramWordDistance ( string , expression , ** extra ) [source] ¶ Accepts a string or expression, and a field name or expression. Returns the\ntrigram word distance between the two arguments. Usage example: >>> from django.contrib.postgres.search import TrigramWordDistance >>> Author . objects . create ( name = \"Katy Stevens\" ) >>> Author . objects . create ( name = \"Stephen Keats\" ) >>> test = \"Kat\" >>> Author . objects . annotate ( ... distance = TrigramWordDistance ( test , \"name\" ), ... ) . filter ( ... distance__lte = 0.7 ... ) . order_by ( \"distance\" ) [<Author: Katy Stevens>] TrigramStrictWordDistance ¶ class TrigramStrictWordDistance ( string , expression , ** extra ) [source] ¶ Accepts a string or expression, and a field name or expression. Returns the\ntrigram strict word distance between the two arguments.", "keywords": ["keywords", "function", "examples", "fragment_delimiter", "a.", "stop_sel", "indexes", "extent", "number", "search_vector", "plainto_tsquery", "space", "module", "b", "values", "triggers", "algorithms", "vectors", "filter", "string", "rank", "c", "class", "example", "field", "≥", "#", "order_by", "addition", "migration", "group", "weights", "overview", "column", "start_sel", "list", "tomato", "green", "cheese", "returns", "keats", "stephens", "short_word", "numbers", "event", "database", "stevens", "fragments", "config", "language", "*", "models", "query", "match", "test", "postgresql", "sandwich", "level", "relevancy", "vector", "model", "words", "word", "place", "mask", "dictionaries", "relevance", "usage", "trigramstrictworddistance", "sort", "approach", "katy", "configuration", "=", "searchrank", "trigram", "trigramextension", "differences", "results", "fields", "print", "engine", "entry", "set", "to_tsvector", "ease", "gist", "searchvector", "flexibility", "syntax", "letters", "weight", "value", "pg_trgm", "body_text__search", "proximity", "ranking", "body_text", "bit", "source", "max_words", "boundaries", "perdu", "length", "process", "lookup", "use", "pain", "topic", "ginindex", "bitor", "trigram_similar", "blog__tagline", "arguments", "normalization", "author", "a", "engines", "explanation", "delimiter", "trigramstrictwordsimilarity", "performance", "objects", "documentation", "lookups", "trigramdistance", "records", "gin", "-similarity", "matching", "extension", "operation", "order", "katie", "default", "trigramworddistance", "max_fragments", "user", "|", "fragment", "recipes", "functions", "term", "rank__gte", "red</span", "attribute", "none", "docs", "expression", "min_words", "œuf", "size", "characters", "pizza", "highlight_all", "similarity", "instances", "true", "annotate", "cover", "searchheadline", "operators", "django.contrib.postgres.search", "account", "installed_apps", "part", "stephen", "f", "blog__language", "object", "document", "couple", "import", "name", "d", "parameter", "special", "searchvectorfield", "kat", ">", "defaults", "way", "django.contrib.postgres", "searchquery", "parsers", "terms", "phrase", "web", "red", "tomato</span", "weighting", "headlines", "toast", "problems", "distance__lte", "options", "queries", "meat", "search_type", "index", "details", "cover_density", "matches", "websearch", "integer", "¶", "behaviors", "trigramsimilarity", "trigram_strict_word_similar", "trigramwordsimilarity", "parameters", "expressions", "floats", "headline", "search", "density", "distance", "blog", "text", "span", "english"], "type": "documentation"},
{"title": "Django’s release process | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/internals/release-process/", "content": "Django’s release process ¶ Official releases ¶ Since version 1.0, Django’s release numbering works as follows: Versions are numbered in the form A.B or A.B.C . A.B is the feature release version number. Each version will be mostly\nbackwards compatible with the previous release. Exceptions to this rule will\nbe listed in the release notes. C is the patch release version number, which is incremented for bugfix\nand security releases. These releases will be 100% backwards-compatible with\nthe previous patch release. The only exception is when a security or data\nloss issue can’t be fixed without breaking backwards-compatibility. If this\nhappens, the release notes will provide detailed upgrade instructions. Before a new feature release, we’ll make alpha, beta, and release candidate\nreleases. These are of the form A.B alpha/beta/rc N , which means the Nth alpha/beta/release candidate of version A.B . In git, each Django release will have a tag indicating its version number,\nsigned with the Django release key. Additionally, each release series has its\nown branch, called stable/A.B.x , and bugfix/security releases will be\nissued from those branches. For more information about how the Django project issues new releases for\nsecurity purposes, please see our security policies . Feature release ¶ Feature releases (A.B, A.B+1, etc.) will happen roughly every eight months\n– see release process for details. These releases will contain new\nfeatures, improvements to existing features, and such. Patch release ¶ Patch releases (A.B.C, A.B.C+1, etc.) will be issued as needed, to fix\nbugs and/or security issues. These releases will be 100% compatible with the associated feature release,\nunless this is impossible for security reasons or to prevent data loss.\nSo the answer to “should I upgrade to the latest patch release?” will always\nbe “yes.” Long-term support release ¶ Certain feature releases will be designated as long-term support (LTS)\nreleases. These releases will get security and data loss fixes applied for\na guaranteed period of time, typically three years. See the download page for the releases that have been designated for\nlong-term support. Release cadence ¶ Starting with Django 2.0, version numbers will use a loose form of semantic\nversioning such that each version following an LTS will\nbump to the next “dot zero” version. For example: 2.0, 2.1, 2.2 (LTS), 3.0,\n3.1, 3.2 (LTS), etc. SemVer makes it easier to see at a glance how compatible releases are with each\nother. It also helps to anticipate when compatibility shims will be removed.\nIt’s not a pure form of SemVer as each feature release will continue to have a\nfew documented backwards incompatibilities where a deprecation path isn’t\npossible or not worth the cost. Also, deprecations started in an LTS release\n(X.2) will be dropped in a non-dot-zero release (Y.1) to accommodate our policy\nof keeping deprecation shims for at least two feature releases. Read on to the\nnext section for an example. Deprecation policy ¶ A feature release may deprecate certain features from previous releases. If a\nfeature is deprecated in feature release A.x, it will continue to work in all\nA.x versions (for all versions of x) but raise warnings. Deprecated features\nwill be removed in the B.0 release, or B.1 for features deprecated in the last\nA.x feature release to ensure deprecations are done over at least 2 feature\nreleases. So, for example, if we decided to start the deprecation of a function in\nDjango 4.2: Django 4.2 will contain a backwards-compatible replica of the function which\nwill raise a RemovedInDjango51Warning . Django 5.0 (the version that follows 4.2) will still contain the\nbackwards-compatible replica. Django 5.1 will remove the feature outright. The warnings are silent by default. You can turn on display of these warnings\nwith the python -Wd option. A more generic example: X.0 X.1 X.2 LTS Y.0: Drop deprecation shims added in X.0 and X.1. Y.1: Drop deprecation shims added in X.2. Y.2 LTS: No deprecation shims dropped (while Y.0 is no longer supported,\nthird-party apps need to maintain compatibility back to X.2 LTS to ease\nLTS to LTS upgrades). Z.0: Drop deprecation shims added in Y.0 and Y.1. See also the Deprecating a feature guide. Supported versions ¶ At any moment in time, Django’s developer team will support a set of releases to\nvarying levels. See the supported versions section of the download\npage for the current state of support for each version. The current development branch main will get new features and bug fixes\nrequiring non-trivial refactoring. Patches applied to the main branch must also be applied to the last feature\nrelease branch, to be released in the next patch release of that feature\nseries, when they fix critical problems: Security issues. Data loss bugs. Crashing bugs. Major functionality bugs in new features of the latest stable release. Regressions from older versions of Django introduced in the current release\nseries. The rule of thumb is that fixes will be backported to the last feature\nrelease for bugs that would have prevented a release in the first place\n(release blockers). Security fixes and data loss bugs will be applied to the current main branch,\nthe last two feature release branches, and any other supported long-term\nsupport release branches. Documentation fixes generally will be more freely backported to the last\nrelease branch. That’s because it’s highly advantageous to have the docs for\nthe last release be up-to-date and correct, and the risk of introducing\nregressions is much less of a concern. As a concrete example, consider a moment in time halfway between the release of\nDjango 5.1 and 5.2. At this point in time: Features will be added to the development main branch, to be released as\nDjango 5.2. Critical bug fixes will be applied to the stable/5.1.x branch, and\nreleased as 5.1.1, 5.1.2, etc. Security fixes and bug fixes for data loss issues will be applied to main and to the stable/5.1.x , stable/5.0.x , and stable/4.2.x (LTS) branches. They will trigger the release of 5.1.1 , 5.0.5 , 4.2.8 , etc. Documentation fixes will be applied to main, and, if easily backported, to\nthe latest stable branch, 5.1.x . Release process ¶ Django uses a time-based release schedule, with feature releases every eight\nmonths or so. After each feature release, the release manager will announce a timeline for\nthe next feature release. Release cycle ¶ Each release cycle consists of three parts: Phase one: feature proposal ¶ The first phase of the release process will include figuring out what major\nfeatures to include in the next version. This should include a good deal of\npreliminary work on those features – working code trumps grand design. Major features for an upcoming release will be added to the wiki roadmap page,\ne.g. https://code.djangoproject.com/wiki/Version1.11Roadmap . Phase two: development ¶ The second part of the release schedule is the “heads-down” working period.\nUsing the roadmap produced at the end of phase one, we’ll all work very hard to\nget everything on it done. At the end of phase two, any unfinished features will be postponed until the\nnext release. Phase two will culminate with an alpha release. At this point, the stable/A.B.x branch will be forked from main . Phase three: bugfixes ¶ The last part of a release cycle is spent fixing bugs – no new features will\nbe accepted during this time. We’ll try to release a beta release one month\nafter the alpha and a release candidate one month after the beta. The release candidate marks the string freeze, and it happens at least two\nweeks before the final release. After this point, new translatable strings\nmust not be added. During this phase, mergers will be more and more conservative with backports,\nto avoid introducing regressions. After the release candidate, only release\nblockers and documentation fixes should be backported. In parallel to this phase, main can receive new features, to be released\nin the A.B+1 cycle. Bug-fix releases ¶ After a feature release (e.g. A.B), the previous release will go into bugfix\nmode. The branch for the previous feature release (e.g. stable/A.B-1.x ) will\ninclude bugfixes. Critical bugs fixed on main must also be fixed on the\nbugfix branch; this means that commits need to cleanly separate bug fixes from\nfeature additions. The developer who commits a fix to main will be\nresponsible for also applying the fix to the current bugfix branch.", "keywords": ["function", "additions", "feature", "number", "y.0", "point", "numbering", "code", "glance", "features", "https://code.djangoproject.com/wiki/version1.11roadmap", "period", "x.2", "backports", "string", "c", "x.0", "display", "example", "deprecations", "month", "timeline", "parallel", "warnings", "loss", "x", "5.1.2", "a.b.c", "answer", "years", "numbers", "lts", "y.2", "y.1", "rc", "a.b+1", "nth", "page", "main", "blockers", "version", "compatibility", "incompatibilities", "phase", "strings", "official", "a.b.c+1", "reasons", "stable/4.2.x", "place", "drop", "refactoring", "deprecation", "django", "series", "policies", "release", "n’t", "thumb", "download", "git", "regressions", "fixes", "set", "months", "development", "n", "schedule", "x.1", "tag", "section", "branch", "developer", "works", "policy", "data", "process", "proposal", "heads", "guide", "branches", "cost", "patch", "freeze", "alpha", "b.1", "bugfixes", "security", "removedindjango51warning", "a.b.x", "documentation", "end", "releases", "weeks", "improvements", "levels", "work", "beta", "fix", "default", "path", "functionality", "key", "team", "term", "bug", "form", "bugs", "option", "docs", "issues", "5.1.1", "roadmap", "a.b-1.x", "time", "risk", "replica", "date", "cadence", "purposes", "wiki", "concern", "parts", "support", "part", "mode", "patches", "cycle", "bugfix", "stable/5.1.x", "dot", "candidate", "rule", "%", "instructions", "a.x", "information", "shims", "python", "issue", "upgrade", "mergers", "problems", "versions", "exception", "upgrades", "working", "details", "manager", "party", "notes", "¶", "state", "deal", "apps", "semver", "design", "a.b", "moment", "project", "exceptions"], "type": "documentation"},
{"title": "Database instrumentation | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/db/instrumentation/", "content": "Database instrumentation ¶ To help you understand and control the queries issued by your code, Django\nprovides a hook for installing wrapper functions around the execution of\ndatabase queries. For example, wrappers can count queries, measure query\nduration, log queries, or even prevent query execution (e.g. to make sure that\nno queries are issued while rendering a template with prefetched data). The wrappers are modeled after middleware –\nthey are callables which take another callable as one of their arguments. They\ncall that callable to invoke the (possibly wrapped) database query, and they\ncan do what they want around that call. They are, however, created and\ninstalled by user code, and so don’t need a separate factory like middleware do. Installing a wrapper is done in a context manager – so the wrappers are\ntemporary and specific to some flow in your code. As mentioned above, an example of a wrapper is a query execution blocker. It\ncould look like this: def blocker ( * args ): raise Exception ( \"No database access allowed here.\" ) And it would be used in a view to block queries from the template like so: from django.db import connection from django.shortcuts import render def my_view ( request ): context = { ... } # Code to generate context with all data. template_name = ... with connection . execute_wrapper ( blocker ): return render ( request , template_name , context ) The parameters sent to the wrappers are: execute – a callable, which should be invoked with the rest of the\nparameters in order to execute the query. sql – a str , the SQL query to be sent to the database. params – a list/tuple of parameter values for the SQL command, or a\nlist/tuple of lists/tuples if the wrapped call is executemany() . many – a bool indicating whether the ultimately invoked call is execute() or executemany() (and whether params is expected to be\na sequence of values, or a sequence of sequences of values). context – a dictionary with further data about the context of\ninvocation. This includes the connection and cursor. Using the parameters, a slightly more complex version of the blocker could\ninclude the connection name in the error message: def blocker ( execute , sql , params , many , context ): alias = context [ \"connection\" ] . alias raise Exception ( \"Access to database ' {} ' blocked here\" . format ( alias )) For a more complete example, a query logger could look like this: import time class QueryLogger : def __init__ ( self ): self . queries = [] def __call__ ( self , execute , sql , params , many , context ): current_query = { \"sql\" : sql , \"params\" : params , \"many\" : many } start = time . monotonic () try : result = execute ( sql , params , many , context ) except Exception as e : current_query [ \"status\" ] = \"error\" current_query [ \"exception\" ] = e raise else : current_query [ \"status\" ] = \"ok\" return result finally : duration = time . monotonic () - start current_query [ \"duration\" ] = duration self . queries . append ( current_query ) To use this, you would create a logger object and install it as a wrapper: from django.db import connection ql = QueryLogger () with connection . execute_wrapper ( ql ): do_queries () # Now we can print the log. print ( ql . queries ) connection.execute_wrapper() ¶ execute_wrapper ( wrapper ) ¶ Returns a context manager which, when entered, installs a wrapper around\ndatabase query executions, and when exited, removes the wrapper. The wrapper is\ninstalled on the thread-local connection object. wrapper is a callable taking five arguments.  It is called for every query\nexecution in the scope of the context manager, with arguments execute , sql , params , many , and context as described above. It’s\nexpected to call execute(sql, params, many, context) and return the return\nvalue of that call.", "keywords": ["result", "view", "callables", "status", "wrapper", "measure", "bool", "error", "def", "code", "do_queries", "values", "monotonic", "access", "class", "lists", "example", "#", "list", "request", "database", "query", "version", "callable", ".", "flow", "hook", "sequences", "django", "=", "print", "thread", "message", "log", "e", "value", "wrappers", "append", "sequence", "data", "scope", "tuple", "factory", "str", "arguments", "init", "blocker", "middleware", "self", "tuples", "order", "params", "user", "invocation", "current_query", "functions", "execute_wrapper", "alias", "executions", "execute(sql", "my_view", "args", "format", "time", "render", "object", "connection", "cursor", "context", "import", "name", "template", "parameter", "execution", "sql", "call", "dictionary", "raise", "execute", "queries", "logger", "exception", "executemany", "manager", "rest", "¶", "return", "command", "parameters", "instrumentation", "duration", "querylogger"], "type": "documentation"},
{"title": "How to upgrade Django to a newer version | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/upgrade-version/", "content": "How to upgrade Django to a newer version ¶ While it can be a complex process at times, upgrading to the latest Django\nversion has several benefits: New features and improvements are added. Bugs are fixed. Older version of Django will eventually no longer receive security updates.\n(see Supported versions ). Upgrading as each new Django release is available makes future upgrades less\npainful by keeping your code base up to date. Here are some things to consider to help make your upgrade process as smooth as\npossible. Required Reading ¶ If it’s your first time doing an upgrade, it is useful to read the guide\non the different release processes . Afterward, you should familiarize yourself with the changes that were made in\nthe new Django version(s): Read the release notes for each ‘final’ release from\nthe one after your current Django version, up to and including the version to\nwhich you plan to upgrade. Look at the deprecation timeline for the\nrelevant versions. Pay particular attention to backwards incompatible changes to get a clear idea\nof what will be needed for a successful upgrade. If you’re upgrading through more than one feature version (e.g. 2.0 to 2.2),\nit’s usually easier to upgrade through each feature release incrementally\n(2.0 to 2.1 to 2.2) rather than to make all the changes for each feature\nrelease at once. For each feature release, use the latest patch release (e.g.\nfor 2.1, use 2.1.15). The same incremental upgrade approach is recommended when upgrading from one\nLTS to the next. Dependencies ¶ In most cases it will be necessary to upgrade to the latest version of your\nDjango-related dependencies as well. If the Django version was recently\nreleased or if some of your dependencies are not well-maintained, some of your\ndependencies may not yet support the new Django version. In these cases you may\nhave to wait until new versions of your dependencies are released. Resolving deprecation warnings ¶ Before upgrading, it’s a good idea to resolve any deprecation warnings raised\nby your project while using your current version of Django. Fixing these\nwarnings before upgrading ensures that you’re informed about areas of the code\nthat need altering. In Python, deprecation warnings are silenced by default. You must turn them on\nusing the -Wa Python command line option or the PYTHONWARNINGS environment variable. For example, to show warnings while running tests: /  $ python -Wa manage.py test ...\\> py -Wa manage.py test If you’re not using the Django test runner, you may need to also ensure that\nany console output is not captured which would hide deprecation warnings. For\nexample, if you use pytest : $ PYTHONWARNINGS = always pytest tests --capture = no Resolve any deprecation warnings with your current version of Django before\ncontinuing the upgrade process. Third party applications might use deprecated APIs in order to support multiple\nversions of Django, so deprecation warnings in packages you’ve installed don’t\nnecessarily indicate a problem. If a package doesn’t support the latest version\nof Django, consider raising an issue or sending a pull request for it. Installation ¶ Once you’re ready, it is time to install the new Django version . If you are using a virtual environment and it\nis a major upgrade, you might want to set up a new environment with all the\ndependencies first. If you installed Django with pip , you can use the --upgrade or -U flag: /  $ python -m pip install -U Django ...\\> py -m pip install -U Django Testing ¶ When the new environment is set up, run the full test suite for your application. Again, it’s useful to turn\non deprecation warnings on so they’re shown in the test output (you can also\nuse the flag if you test your app manually using manage.py runserver ): /  $ python -Wa manage.py test ...\\> py -Wa manage.py test After you have run the tests, fix any failures. While you have the release\nnotes fresh in your mind, it may also be a good time to take advantage of new\nfeatures in Django by refactoring your code to eliminate any deprecation\nwarnings. Deployment ¶ When you are sufficiently confident your app works with the new version of\nDjango, you’re ready to go ahead and deploy your upgraded Django project. If you are using caching provided by Django, you should consider clearing your\ncache after upgrading. Otherwise you may run into problems, for example, if you\nare caching pickled objects as these objects are not guaranteed to be\npickle-compatible across Django versions. A past instance of incompatibility\nwas caching pickled HttpResponse objects, either\ndirectly or indirectly via the cache_page() decorator.", "keywords": ["testing", "feature", "processes", "code", "features", "version(s", "failures", "incompatibility", "reading", "example", "app", "runner", "timeline", "warnings", "attention", "runserver", "request", "lts", "flag", "output", "test", "httpresponse", "version", "cache", "-u", "variable", "py", "idea", "apis", "suite", "benefits", "application", "deprecation", "approach", "django", "changes", "=", "release", "n’t", "pythonwarnings", "altering", "installation", "line", "/", "pip", "process", "base", "guide", "patch", "environment", "security", "updates", "package", "-wa", "one", "instance", "objects", "improvements", "mind", "order", "default", "cases", "bugs", "option", "pickle", "tests", "problem", "packages", "decorator", "time", "date", "\\", "areas", "advantage", "things", "deployment", "console", "python", "issue", "upgrade", "problems", "versions", "times", "upgrades", "upgrading", "cache_page", "party", "notes", "¶", "command", "applications", "dependencies", "project"], "type": "documentation"},
{"title": "Django 2.2.1 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/2.2.1/", "content": "Django 2.2.1 release notes ¶ May 1, 2019 Django 2.2.1 fixes several bugs in 2.2. Bugfixes ¶ Fixed a regression in Django 2.1 that caused the incorrect quoting of\ndatabase user password when using dbshell on Oracle\n( #30307 ). Added compatibility for psycopg2 2.8 ( #30331 ). Fixed a regression in Django 2.2 that caused a crash when loading the\ntemplate for the technical 500 debug page ( #30324 ). Fixed crash of ordering argument in ArrayAgg and StringAgg when it contains an\nexpression with params ( #30332 ). Fixed a regression in Django 2.2 that caused a single instance fast-delete\nto not set the primary key to None ( #30330 ). Prevented makemigrations from generating infinite migrations for\ncheck constraints and partial indexes when condition contains\na range object ( #30350 ). Reverted an optimization in Django 2.2 ( #29725 ) that caused the\ninconsistent behavior of count() and exists() on a reverse\nmany-to-many relationship with a custom manager ( #30325 ). Fixed a regression in Django 2.2 where Paginator crashes if object_list is\na queryset ordered or aggregated over a nested JSONField key transform\n( #30335 ). Fixed a regression in Django 2.2 where IntegerField validation of\ndatabase limits crashes if limit_value attribute in a custom validator is\ncallable ( #30328 ). Fixed a regression in Django 2.2 where SearchVector generates SQL that is\nnot indexable ( #30385 ). Fixed a regression in Django 2.2 that caused an exception to be raised when\na custom error handler could not be imported ( #30318 ). Relaxed the system check added in Django 2.2 for the admin app’s dependencies\nto reallow use of SessionMiddleware subclasses,\nrather than requiring django.contrib.sessions to be in INSTALLED_APPS ( #30312 ). Increased the default timeout when using Watchman to 5 seconds to prevent\nfalling back to StatReloader on larger projects and made it customizable\nvia the DJANGO_WATCHMAN_TIMEOUT environment variable\n( #30361 ). Fixed a regression in Django 2.2 that caused a crash when migrating\npermissions for proxy models if the target permissions already existed. For\nexample, when a permission had been created manually or a model had been\nmigrated from concrete to proxy ( #30351 ). Fixed a regression in Django 2.2 that caused a crash of runserver when URLConf modules raised exceptions ( #30323 ). Fixed a regression in Django 2.2 where changes were not reliably detected by\nauto-reloader when using StatReloader ( #30323 ). Fixed a migration crash on Oracle and PostgreSQL when adding a check\nconstraint with a contains , startswith , or endswith lookup (or\ntheir case-insensitive variant) ( #30408 ). Fixed a migration crash on Oracle and SQLite when adding a check constraint\nwith condition contains | ( OR ) operator ( #30412 ).", "keywords": ["concrete", "sessionmiddleware", "django.contrib.sessions", "integerfield", "indexes", "jsonfield", "proxy", "permissions", "error", "timeout", "check", "target", "behavior", "migration", "example", "app", "statreloader", "migrations", "seconds", "auto", "runserver", "database", "range", "models", "page", "postgresql", "compatibility", "count", "paginator", "variable", "model", "condition", "django", "changes", "release", "urlconf", "relationship", "validation", "searchvector", "validator", "case", "reloader", "debug", "lookup", "handler", "use", "dbshell", "arrayagg", "environment", "bugfixes", "regression", "variant", "subclasses", "instance", "custom", "optimization", "sqlite", "constraint", "delete", "modules", "params", "default", "user", "key", "bugs", "none", "expression", "django_watchman_timeout", "constraints", "contains", "psycopg2", "installed_apps", "crash", "object", "transform", "projects", "may", "password", "stringagg", "permission", "limits", "2.2.1", "makemigrations", "template", "sql", "quoting", "exception", "manager", "queryset", "argument", "¶", "reverse", "operator", "oracle", "system", "watchman", "dependencies", "exceptions"], "type": "documentation"},
{"title": "Django 1.7 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.7/", "content": "Django 1.7 release notes ¶ September 2, 2014 Welcome to Django 1.7! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 1.6 or older versions. We’ve begun the deprecation process for some features , and some features have reached the end of their\ndeprecation process and have been removed . Python compatibility ¶ Django 1.7 requires Python 2.7, 3.2, 3.3, or 3.4. We highly recommend and\nonly officially support the latest release of each series. The Django 1.6 series is the last to support Python 2.6. Django 1.7 is the\nfirst release to support Python 3.4. This change should affect only a small number of Django users, as most\noperating-system vendors today are shipping Python 2.7 or newer as their default\nversion. If you’re still using Python 2.6, however, you’ll need to stick to\nDjango 1.6 until you can upgrade your Python version. Per our support\npolicy , Django 1.6 will continue to receive\nsecurity support until the release of Django 1.8. What’s new in Django 1.7 ¶ Schema migrations ¶ Django now has built-in support for schema migrations. It allows models\nto be updated, changed, and deleted by creating migration files that represent\nthe model changes and which can be run on any development, staging or production\ndatabase. Migrations are covered in their own documentation ,\nbut a few of the key features are: syncdb has been deprecated and replaced by migrate . Don’t worry -\ncalls to syncdb will still work as before. A new makemigrations command provides an easy way to autodetect changes\nto your models and make migrations for them. django.db.models.signals.pre_syncdb and django.db.models.signals.post_syncdb have been deprecated,\nto be replaced by pre_migrate and post_migrate respectively. These\nnew signals have slightly different arguments. Check the\ndocumentation for details. The allow_syncdb method on database routers is now called allow_migrate ,\nbut still performs the same function. Routers with allow_syncdb methods\nwill still work, but that method name is deprecated and you should change\nit as soon as possible (nothing more than renaming is required). initial_data fixtures are no longer loaded for apps with migrations; if\nyou want to load initial data for an app, we suggest you create a migration for\nyour application and define a RunPython or RunSQL operation in the operations section of the migration. Test rollback behavior is different for apps with migrations; in particular,\nDjango will no longer emulate rollbacks on non-transactional databases or\ninside TransactionTestCase unless specifically requested . It is not advised to have apps without migrations depend on (have a ForeignKey or ManyToManyField to) apps with migrations. App-loading refactor ¶ Historically, Django applications were tightly linked to models. A singleton\nknown as the “app cache” dealt with both installed applications and models.\nThe models module was used as an identifier for applications in many APIs. As the concept of Django applications matured, this\ncode showed some shortcomings. It has been refactored into an “app registry”\nwhere models modules no longer have a central role and where it’s possible to\nattach configuration data to applications. Improvements thus far include: Applications can run code at startup, before Django does anything else, with\nthe ready() method of their configuration. Application labels are assigned correctly to models even when they’re\ndefined outside of models.py . You don’t have to set app_label explicitly any more. It is possible to omit models.py entirely if an application doesn’t\nhave any models. Applications can be relabeled with the label attribute of application configurations, to work around label conflicts. The name of applications can be customized in the admin with the verbose_name of application configurations. The admin automatically calls autodiscover() when Django starts. You can consequently remove this line from your\nURLconf. Django imports all application configurations and models as soon as it\nstarts, through a deterministic and straightforward process. This should\nmake it easier to diagnose import issues such as import loops. New method on Field subclasses ¶ To help power both schema migrations and to enable easier addition of\ncomposite keys in future releases of Django, the Field API now has a new required method: deconstruct() . This method takes no arguments, and returns a tuple of four items: name : The field’s attribute name on its parent model, or None if it\nis not part of a model path : A dotted, Python path to the class of this field, including the class name. args : Positional arguments, as a list kwargs : Keyword arguments, as a dict These four values allow any field to be serialized into a file, as well as\nallowing the field to be copied safely, both essential parts of these new features. This change should not affect you unless you write custom Field subclasses;\nif you do, you may need to reimplement the deconstruct() method if your\nsubclass changes the method signature of __init__ in any way. If your\nfield just inherits from a built-in Django field and doesn’t override __init__ ,\nno changes are necessary. If you do need to override deconstruct() , a good place to start is the\nbuilt-in Django fields ( django/db/models/fields/__init__.py ) as several\nfields, including DecimalField and DateField , override it and show how\nto call the method on the superclass and simply add or remove extra arguments. This also means that all arguments to fields must themselves be serializable;\nto see what we consider serializable, and to find out how to make your own\nclasses serializable, read the migration serialization documentation . Calling custom QuerySet methods from the Manager ¶ Historically, the recommended way to make reusable model queries was to create\nmethods on a custom Manager class. The problem with this approach was that\nafter the first method call, you’d get back a QuerySet instance and\ncouldn’t call additional custom manager methods. Though not documented, it was common to work around this issue by creating a\ncustom QuerySet so that custom methods could be chained; but the solution\nhad a number of drawbacks: The custom QuerySet and its custom methods were lost after the first\ncall to values() or values_list() . Writing a custom Manager was still necessary to return the custom QuerySet class and all methods that were desired on the Manager had to be proxied to the QuerySet . The whole process went against\nthe DRY principle. The QuerySet.as_manager() class method can now directly create Manager with QuerySet methods : class FoodQuerySet ( models . QuerySet ): def pizzas ( self ): return self . filter ( kind = \"pizza\" ) def vegetarian ( self ): return self . filter ( vegetarian = True ) class Food ( models . Model ): kind = models . CharField ( max_length = 50 ) vegetarian = models . BooleanField ( default = False ) objects = FoodQuerySet . as_manager () Food . objects . pizzas () . vegetarian () Using a custom manager when traversing reverse relations ¶ It is now possible to specify a custom manager when traversing a reverse relationship: class Blog ( models . Model ): pass class Entry ( models . Model ): blog = models . ForeignKey ( Blog ) objects = models . Manager () # Default Manager entries = EntryManager () # Custom Manager b = Blog . objects . get ( id = 1 ) b . entry_set ( manager = \"entries\" ) . all () New system check framework ¶ We’ve added a new System check framework for\ndetecting common problems (like invalid models) and providing hints for\nresolving those problems. The framework is extensible so you can add your\nown checks for your own apps and libraries. To perform system checks, you use the check management command.\nThis command replaces the older validate management command. New Prefetch object for advanced prefetch_related operations. ¶ The new Prefetch object allows customizing\nprefetch operations. You can specify the QuerySet used to traverse a given relation\nor customize the storage location of prefetch results. This enables things like filtering prefetched relations, calling select_related() from a prefetched\nrelation, or prefetching the same relation multiple times with different\nquerysets. See prefetch_related() for more details. Admin shortcuts support time zones ¶ The “today” and “now” shortcuts next to date and time input widgets in the\nadmin are now operating in the current time zone . Previously, they used the browser time zone,\nwhich could result in saving the wrong value when it didn’t match the current\ntime zone on the server. In addition, the widgets now display a help message when the browser and\nserver time zone are different, to clarify how the value inserted in the field\nwill be interpreted. Using database cursors as context managers ¶ Prior to Python 2.7, database cursors could be used as a context manager. The\nspecific backend’s cursor defined the behavior of the context manager. The\nbehavior of magic method lookups was changed with Python 2.7 and cursors were\nno longer usable as context managers. Django 1.7 allows a cursor to be used as a context manager. That is,\nthe following can be used: with connection . cursor () as c : c . execute ( ... ) instead of: c = connection . cursor () try : c . execute ( ... ) finally : c . close () Custom lookups ¶ It is now possible to write custom lookups and transforms for the ORM.\nCustom lookups work just like Django’s built-in lookups (e.g. lte , icontains ) while transforms are a new concept. The django.db.models.Lookup class provides a way to add lookup\noperators for model fields. As an example it is possible to add day_lte operator for DateFields . The django.db.models.Transform class allows transformations of\ndatabase values prior to the final lookup. For example it is possible to\nwrite a year transform that extracts year from the field’s value.\nTransforms allow for chaining. After the year transform has been added\nto DateField it is possible to filter on the transformed value, for\nexample qs.filter(author__birthdate__year__lte=1981) . For more information about both custom lookups and transforms refer to\nthe custom lookups documentation. Improvements to Form error handling ¶ Form.add_error() ¶ Previously there were two main patterns for handling errors in forms: Raising a ValidationError from within certain\nfunctions (e.g. Field.clean() , Form.clean_<fieldname>() , or Form.clean() for non-field errors.) Fiddling with Form._errors when targeting a specific field in Form.clean() or adding errors from outside of a “clean” method\n(e.g. directly from a view). Using the former pattern was straightforward since the form can guess from the\ncontext (i.e. which method raised the exception) where the errors belong and\nautomatically process them. This remains the canonical way of adding errors\nwhen possible. However the latter was fiddly and error-prone, since the burden\nof handling edge cases fell on the user. The new add_error() method allows adding errors\nto specific form fields from anywhere without having to worry about the details\nsuch as creating instances of django.forms.utils.ErrorList or dealing with Form.cleaned_data . This new API replaces manipulating Form._errors which now becomes a private API. See Cleaning and validating fields that depend on each other for an example using Form.add_error() . Error metadata ¶ The ValidationError constructor accepts metadata\nsuch as error code or params which are then available for interpolating\ninto the error message (see Raising ValidationError for more details);\nhowever, before Django 1.7 those metadata were discarded as soon as the errors\nwere added to Form.errors . Form.errors and django.forms.utils.ErrorList now store the ValidationError instances\nso these metadata can be retrieved at any time through the new Form.errors.as_data method. The retrieved ValidationError instances can then be identified thanks to\ntheir error code which enables things like rewriting the error’s message\nor writing custom logic in a view when a given error is present. It can also\nbe used to serialize the errors in a custom format such as XML. The new Form.errors.as_json() method is a convenience method which returns error messages along with error\ncodes serialized as JSON. as_json() uses as_data() and gives an idea\nof how the new system could be extended. Error containers and backward compatibility ¶ Heavy changes to the various error containers were necessary in order\nto support the features above, specifically Form.errors , django.forms.utils.ErrorList , and the internal storages of ValidationError . These containers which used\nto store error strings now store ValidationError instances and public APIs\nhave been adapted to make this as transparent as possible, but if you’ve been\nusing private APIs, some of the changes are backwards incompatible; see ValidationError constructor and internal storage for more details. Minor features ¶ django.contrib.admin ¶ You can now implement site_header , site_title , and index_title attributes on a custom AdminSite in order to easily change the admin\nsite’s page title and header text. No more needing to override templates! Buttons in django.contrib.admin now use the border-radius CSS\nproperty for rounded corners rather than GIF background images. Some admin templates now have app-<app_name> and model-<model_name> classes in their <body> tag to allow customizing the CSS per app or per\nmodel. The admin changelist cells now have a field-<field_name> class in the\nHTML to enable style customizations. The admin’s search fields can now be customized per-request thanks to the new django.contrib.admin.ModelAdmin.get_search_fields() method. The ModelAdmin.get_fields() method may be overridden to\ncustomize the value of ModelAdmin.fields . In addition to the existing admin.site.register syntax, you can use the\nnew register() decorator to register a ModelAdmin . You may specify ModelAdmin.list_display_links = None to disable\nlinks on the change list page grid. You may now specify ModelAdmin.view_on_site to control whether or not to\ndisplay the “View on site” link. You can specify a descending ordering for a ModelAdmin.list_display value by prefixing the admin_order_field value with a hyphen. The ModelAdmin.get_changeform_initial_data() method may be\noverridden to define custom behavior for setting initial change form data. django.contrib.auth ¶ Any **kwargs passed to email_user() are passed to the\nunderlying send_mail() call. The permission_required() decorator can\ntake a list of permissions as well as a single permission. You can override the new AuthenticationForm.confirm_login_allowed() method\nto more easily customize the login policy. django.contrib.auth.views.password_reset() takes an optional html_email_template_name parameter used to send a multipart HTML email\nfor password resets. The AbstractBaseUser.get_session_auth_hash() method was added and if your AUTH_USER_MODEL inherits from AbstractBaseUser , changing a user’s\npassword now invalidates old sessions if the django.contrib.auth.middleware.SessionAuthenticationMiddleware is\nenabled. See Session invalidation on password change for more details. django.contrib.formtools ¶ Calls to WizardView.done() now include a form_dict to allow easier\naccess to forms by their step name. django.contrib.gis ¶ The default OpenLayers library version included in widgets has been updated\nfrom 2.11 to 2.13. Prepared geometries now also support the crosses , disjoint , overlaps , touches and within predicates, if GEOS 3.3 or later is\ninstalled. django.contrib.messages ¶ The backends for django.contrib.messages that use cookies, will now\nfollow the SESSION_COOKIE_SECURE and SESSION_COOKIE_HTTPONLY settings. The messages context processor now adds a\ndictionary of default levels under the name DEFAULT_MESSAGE_LEVELS . Message objects now have a level_tag attribute that contains the string representation of the message level. django.contrib.redirects ¶ RedirectFallbackMiddleware has two new attributes\n( response_gone_class and response_redirect_class )\nthat specify the types of HttpResponse instances the\nmiddleware returns. django.contrib.sessions ¶ The \"django.contrib.sessions.backends.cached_db\" session backend now\nrespects SESSION_CACHE_ALIAS . In previous versions, it always used\nthe default cache. django.contrib.sitemaps ¶ The sitemap framework now makes use of lastmod to set a Last-Modified header in the response. This makes it possible for the ConditionalGetMiddleware to handle\nconditional GET requests for sitemaps which set lastmod . django.contrib.sites ¶ The new django.contrib.sites.middleware.CurrentSiteMiddleware allows\nsetting the current site on each request. django.contrib.staticfiles ¶ The static files storage classes may be\nsubclassed to override the permissions that collected static files and\ndirectories receive by setting the file_permissions_mode and directory_permissions_mode parameters. See collectstatic for example usage. The CachedStaticFilesStorage backend gets a sibling class called ManifestStaticFilesStorage that doesn’t use the cache system at all but instead a JSON file called staticfiles.json for storing the mapping between the original file name\n(e.g. css/styles.css ) and the hashed file name (e.g. css/styles.55e7cbb9ba48.css ). The staticfiles.json file is created\nwhen running the collectstatic management command and should\nbe a less expensive alternative for remote storages such as Amazon S3. See the ManifestStaticFilesStorage docs for more information. findstatic now accepts verbosity flag level 2, meaning it will\nshow the relative paths of the directories it searched. See findstatic for example output. django.contrib.syndication ¶ The Atom1Feed syndication feed’s updated element now utilizes updateddate instead of pubdate ,\nallowing the published element to be included in the feed (which\nrelies on pubdate ). Cache ¶ Access to caches configured in CACHES is now available via django.core.cache.caches . This dict-like object provides a different\ninstance per thread. It supersedes django.core.cache.get_cache() which\nis now deprecated. If you instantiate cache backends directly, be aware that they aren’t\nthread-safe any more, as django.core.cache.caches now yields\ndifferent instances per thread. Defining the TIMEOUT argument of the CACHES setting as None will set the cache keys as\n“non-expiring” by default. Previously, it was only possible to pass timeout=None to the cache backend’s set() method. Cross Site Request Forgery ¶ The CSRF_COOKIE_AGE setting facilitates the use of session-based\nCSRF cookies. Email ¶ send_mail() now accepts an html_message parameter for sending a multipart text/plain and text/html email. The SMTP EmailBackend now accepts a timeout parameter. File Storage ¶ File locking on Windows previously depended on the PyWin32 package; if it\nwasn’t installed, file locking failed silently. That dependency has been\nremoved, and file locking is now implemented natively on both Windows\nand Unix. File Uploads ¶ The new UploadedFile.content_type_extra attribute\ncontains extra parameters passed to the content-type header on a file\nupload. The new FILE_UPLOAD_DIRECTORY_PERMISSIONS setting controls\nthe file system permissions of directories created during file upload, like FILE_UPLOAD_PERMISSIONS does for the files themselves. The FileField.upload_to attribute is now optional. If it is omitted or given None or an empty\nstring, a subdirectory won’t be used for storing the uploaded files. Uploaded files are now explicitly closed before the response is delivered to\nthe client. Partially uploaded files are also closed as long as they are\nnamed file in the upload handler. Storage.get_available_name() now appends an\nunderscore plus a random 7 character alphanumeric string (e.g. \"_x3a1gho\" ), rather than iterating through an underscore followed by a\nnumber (e.g. \"_1\" , \"_2\" , etc.) to prevent a denial-of-service attack.\nThis change was also made in the 1.6.6, 1.5.9, and 1.4.14 security releases. Forms ¶ The <label> and <input> tags rendered by RadioSelect and CheckboxSelectMultiple when looping over the radio\nbuttons or checkboxes now include for and id attributes, respectively.\nEach radio button or checkbox includes an id_for_label attribute to\noutput the element’s ID. The <textarea> tags rendered by Textarea now\ninclude a maxlength attribute if the TextField model field has a max_length . Field.choices now allows you to\ncustomize the “empty choice” label by including a tuple with an empty string\nor None for the key and the custom label as the value. The default blank\noption \"----------\" will be omitted in this case. MultiValueField allows optional subfields by setting\nthe require_all_fields argument to False . The required attribute\nfor each individual field will be respected, and a new incomplete validation error will be raised when any required fields are empty. The clean() method on a form no longer needs to\nreturn self.cleaned_data . If it does return a changed dictionary then\nthat will still be used. After a temporary regression in Django 1.6, it’s now possible again to make TypedChoiceField coerce method return an arbitrary\nvalue. SelectDateWidget.months can be used to\ncustomize the wording of the months displayed in the select widget. The min_num and validate_min parameters were added to formset_factory() to allow validating\na minimum number of submitted forms. The metaclasses used by Form and ModelForm have been reworked to\nsupport more inheritance scenarios. The previous limitation that prevented\ninheriting from both Form and ModelForm simultaneously have been\nremoved as long as ModelForm appears first in the MRO. It’s now possible to remove a field from a Form when subclassing by\nsetting the name to None . It’s now possible to customize the error messages for ModelForm ’s unique , unique_for_date , and unique_together constraints.\nIn order to support unique_together or any other NON_FIELD_ERROR , ModelForm now looks for the NON_FIELD_ERROR key in the error_messages dictionary of the ModelForm ’s inner Meta class.\nSee considerations regarding model’s error_messages for more details. Internationalization ¶ The django.middleware.locale.LocaleMiddleware.response_redirect_class attribute allows you to customize the redirects issued by the middleware. The LocaleMiddleware now stores the user’s\nselected language with the session key _language . This should only be\naccessed using the LANGUAGE_SESSION_KEY constant. Previously it was\nstored with the key django_language and the LANGUAGE_SESSION_KEY constant did not exist, but keys reserved for Django should start with an\nunderscore. For backwards compatibility django_language is still read\nfrom in 1.7. Sessions will be migrated to the new key as they are written. The blocktrans tag now supports a trimmed option. This\noption will remove newline characters from the beginning and the end of the\ncontent of the {% blocktrans %} tag, replace any whitespace at the\nbeginning and end of a line and merge all lines into one using a space\ncharacter to separate them. This is quite useful for indenting the content of\na {% blocktrans %} tag without having the indentation characters end up\nin the corresponding entry in the .po file, which makes the translation\nprocess easier. When you run makemessages from the root directory of your project,\nany extracted strings will now be automatically distributed to the proper\napp or project message file. See Localization: how to create language files for\ndetails. The makemessages command now always adds the --previous command line flag to the msgmerge command, keeping previously translated\nstrings in .po files for fuzzy strings. The following settings to adjust the language cookie options were introduced: LANGUAGE_COOKIE_AGE , LANGUAGE_COOKIE_DOMAIN and LANGUAGE_COOKIE_PATH . Added Format localization for Esperanto. Management Commands ¶ The new --no-color option for django-admin disables the\ncolorization of management command output. The new dumpdata --natural-foreign and dumpdata --natural-primary options, and the new use_natural_foreign_keys and use_natural_primary_keys arguments for serializers.serialize() , allow\nthe use of natural primary keys when serializing. It is no longer necessary to provide the cache table name or the --database option for the createcachetable command.\nDjango takes this information from your settings file. If you have configured\nmultiple caches or multiple databases, all cache tables are created. The runserver command received several improvements: On Linux systems, if pyinotify is installed, the development server\nwill reload immediately when a file is changed. Previously, it polled the\nfilesystem for changes every second. That caused a small delay before\nreloads and reduced battery life on laptops. In addition, the development server automatically reloads when a\ntranslation file is updated, i.e. after running compilemessages . All HTTP requests are logged to the console, including requests for static\nfiles or favicon.ico that used to be filtered out. Management commands can now produce syntax colored output under Windows if\nthe ANSICON third-party tool is installed and active. collectstatic command with symlink option is now supported on\nWindows NT 6 (Windows Vista and newer). Initial SQL data now works better if the sqlparse Python library is\ninstalled. Note that it’s deprecated in favor of the RunSQL operation of migrations,\nwhich benefits from the improved behavior. Models ¶ The QuerySet.update_or_create() method was added. The new default_permissions model Meta option allows you to customize (or disable) creation of the default\nadd, change, and delete permissions. Explicit OneToOneField for Multi-table inheritance are now discovered in abstract classes. It is now possible to avoid creating a backward relation for OneToOneField by setting its related_name to '+' or ending it with '+' . F expressions support the power operator\n( ** ). The remove() and clear() methods of the related managers created by ForeignKey and GenericForeignKey now accept the bulk keyword\nargument to control whether or not to perform operations in bulk\n(i.e. using QuerySet.update() ). Defaults to True . It is now possible to use None as a query value for the iexact lookup. It is now possible to pass a callable as value for the attribute limit_choices_to when defining a ForeignKey or ManyToManyField . Calling only() and defer() on the result of QuerySet.values() now raises\nan error (before that, it would either result in a database error or\nincorrect data). You can use a single list for index_together (rather than a list of\nlists) when specifying a single set of fields. Custom intermediate models having more than one foreign key to any of the\nmodels participating in a many-to-many relationship are now permitted,\nprovided you explicitly specify which foreign keys should be used by setting\nthe new ManyToManyField.through_fields argument. Assigning a model instance to a non-relation field will now throw an error.\nPreviously this used to work if the field accepted integers as input as it\ntook the primary key. Integer fields are now validated against database backend specific min and\nmax values based on their internal_type .\nPreviously model field validation didn’t prevent values out of their associated\ncolumn data type range from being saved resulting in an integrity error. It is now possible to explicitly order_by() a relation _id field by using its attribute name. Signals ¶ The enter argument was added to the setting_changed signal. The model signals can be now be connected to using a str of the 'app_label.ModelName' form – just like related fields – to lazily\nreference their senders. Templates ¶ The Context.push() method now returns\na context manager which automatically calls pop() upon exiting the with statement.\nAdditionally, push() now accepts\nparameters that are passed to the dict constructor used to build the new\ncontext level. The new Context.flatten() method\nreturns a Context ’s stack as one flat dictionary. Context objects can now be compared for equality (internally, this\nuses Context.flatten() so the\ninternal structure of each Context ’s stack doesn’t matter as long as their\nflattened version is identical). The widthratio template tag now accepts an \"as\" parameter to\ncapture the result in a variable. The include template tag will now also accept anything with a render() method (such as a Template ) as an argument. String\narguments will be looked up using get_template() as always. It is now possible to include templates recursively. Template objects now have an origin attribute set when TEMPLATE_DEBUG is True . This allows template origins to be\ninspected and logged outside of the django.template infrastructure. TypeError exceptions are no longer silenced when raised during the\nrendering of a template. The following functions now accept a dirs parameter which is a list or\ntuple to override TEMPLATE_DIRS : django.template.loader.get_template() django.template.loader.select_template() django.shortcuts.render() django.shortcuts.render_to_response() The time filter now accepts timezone-related format\nspecifiers 'e' , 'O' , 'T' and 'Z' and is able to digest time-zone-aware datetime instances performing the expected\nrendering. The cache tag will now try to use the cache called\n“template_fragments” if it exists and fall back to using the default cache\notherwise. It also now accepts an optional using keyword argument to\ncontrol which cache it uses. The new truncatechars_html filter truncates a string to be no\nlonger than the specified number of characters, taking HTML into account. Requests and Responses ¶ The new HttpRequest.scheme attribute\nspecifies the scheme of the request ( http or https normally). The shortcut redirect() now supports\nrelative URLs. The new JsonResponse subclass of HttpResponse helps easily create JSON-encoded responses. Tests ¶ DiscoverRunner has two new attributes, test_suite and test_runner , which facilitate\noverriding the way tests are collected and run. The fetch_redirect_response argument was added to assertRedirects() . Since the test\nclient can’t fetch externals URLs, this allows you to use assertRedirects with redirects that aren’t part of your Django app. Correct handling of scheme when making comparisons in assertRedirects() . The secure argument was added to all the request methods of Client . If True , the request will be made\nthrough HTTPS. assertNumQueries() now prints\nout the list of executed queries if the assertion fails. The WSGIRequest instance generated by the test handler is now attached to\nthe django.test.Response.wsgi_request attribute. The database settings for testing have been collected into a dictionary\nnamed TEST . Utilities ¶ Improved strip_tags() accuracy (but it still cannot\nguarantee an HTML-safe result, as stated in the documentation). Validators ¶ RegexValidator now accepts the optional flags and\nBoolean inverse_match arguments.\nThe inverse_match attribute\ndetermines if the ValidationError should\nbe raised when the regular expression pattern matches ( True ) or does not\nmatch ( False , by default) the provided value . The flags attribute sets the flags\nused when compiling a regular expression string. URLValidator now accepts an optional schemes argument which allows customization of the accepted URI schemes\n(instead of the defaults http(s) and ftp(s) ). validate_email() now accepts addresses with\nIPv6 literals, like example@[2001:db8::1] , as specified in RFC 5321. Backwards incompatible changes in 1.7 ¶ Warning In addition to the changes outlined in this section, be sure to review the deprecation plan for any features that\nhave been removed. If you haven’t updated your code within the\ndeprecation timeline for a given feature, its removal may appear as a\nbackwards incompatible change. allow_syncdb / allow_migrate ¶ While Django will still look at allow_syncdb methods even though they\nshould be renamed to allow_migrate , there is a subtle difference in which\nmodels get passed to these methods. For apps with migrations, allow_migrate will now get passed historical models , which are special versioned models\nwithout custom attributes, methods or managers. Make sure your allow_migrate methods are only referring to fields or other items in model._meta . initial_data ¶ Apps with migrations will not load initial_data fixtures when they have\nfinished migrating. Apps without migrations will continue to load these fixtures\nduring the phase of migrate which emulates the old syncdb behavior,\nbut any new apps will not have this support. Instead, you are encouraged to load initial data in migrations if you need it\n(using the RunPython operation and your model classes);\nthis has the added advantage that your initial data will not need updating\nevery time you change the schema. Additionally, like the rest of Django’s old syncdb code, initial_data has been started down the deprecation path and will be removed in Django 1.9. deconstruct() and serializability ¶ Django now requires all Field classes and all of their constructor arguments\nto be serializable. If you modify the constructor signature in your custom\nField in any way, you’ll need to implement a deconstruct() method;\nwe’ve expanded the custom field documentation with instructions\non implementing this method . The requirement for all field arguments to be serializable means that any custom class\ninstances being passed into Field constructors - things like custom Storage\nsubclasses, for instance - need to have a deconstruct method defined on\nthem as well , though Django provides a handy\nclass decorator that will work for most applications. App-loading changes ¶ Start-up sequence ¶ Django 1.7 loads application configurations and models as soon as it starts.\nWhile this behavior is more straightforward and is believed to be more robust,\nregressions cannot be ruled out. See Troubleshooting for\nsolutions to some problems you may encounter. Standalone scripts ¶ If you’re using Django in a plain Python script — rather than a management\ncommand — and you rely on the DJANGO_SETTINGS_MODULE environment\nvariable, you must now explicitly initialize Django at the beginning of your\nscript with: >>> import django >>> django . setup () Otherwise, you will hit an AppRegistryNotReady exception. WSGI scripts ¶ Until Django 1.3, the recommended way to create a WSGI application was: import django.core.handlers.wsgi application = django . core . handlers . wsgi . WSGIHandler () In Django 1.4, support for WSGI was improved and the API changed to: from django.core.wsgi import get_wsgi_application application = get_wsgi_application () If you’re still using the former style in your WSGI script, you need to\nupgrade to the latter, or you will hit an AppRegistryNotReady exception. App registry consistency ¶ It is no longer possible to have multiple installed applications with the same\nlabel. In previous versions of Django, this didn’t always work correctly, but\ndidn’t crash outright either. If you have two apps with the same label, you should create an AppConfig for one of them and override its label there. You should then adjust your code\nwherever it references this application or its models with the old label. It isn’t possible to import the same model twice through different paths any\nmore. As of Django 1.6, this may happen only if you’re manually putting a\ndirectory and a subdirectory on PYTHONPATH . Refer to the section on\nthe new project layout in the 1.4 release notes for\nmigration instructions. You should make sure that: All models are defined in applications that are listed in INSTALLED_APPS or have an explicit app_label . Models aren’t imported as a side-effect of loading their application.\nSpecifically, you shouldn’t import models in the root module of an\napplication nor in the module that define its configuration class. Django will enforce these requirements as of version 1.9, after a deprecation\nperiod. Subclassing AppCommand ¶ Subclasses of AppCommand must now implement a handle_app_config() method instead of handle_app() . This method receives an AppConfig instance instead of a models module. Introspecting applications ¶ Since INSTALLED_APPS now supports application configuration classes\nin addition to application modules, you should review code that accesses this\nsetting directly and use the app registry ( django.apps.apps ) instead. The app registry has preserved some features of the old app cache. Even though\nthe app cache was a private API, obsolete methods and arguments will be\nremoved through a standard deprecation path, with the exception of the\nfollowing changes that take effect immediately: get_model raises LookupError instead of returning None when no\nmodel is found. The only_installed argument of get_model and get_models no\nlonger exists, nor does the seed_cache argument of get_model . Management commands and order of INSTALLED_APPS ¶ When several applications provide management commands with the same name,\nDjango loads the command from the application that comes first in INSTALLED_APPS . Previous versions loaded the command from the\napplication that came last. This brings discovery of management commands in line with other parts of\nDjango that rely on the order of INSTALLED_APPS , such as static\nfiles, templates, and translations. ValidationError constructor and internal storage ¶ The behavior of the ValidationError constructor has changed when it\nreceives a container of errors as an argument (e.g. a list or an ErrorList ): It converts any strings it finds to instances of ValidationError before adding them to its internal storage. It doesn’t store the given container but rather copies its content to its\nown internal storage; previously the container itself was added to the ValidationError instance and used as internal storage. This means that if you access the ValidationError internal storages, such\nas error_list ; error_dict ; or the return value of update_error_dict() you may find instances of ValidationError where you\nwould have previously found strings. Also if you directly assigned the return value of update_error_dict() to Form._errors you may inadvertently add list instances where ErrorList instances are expected. This is a problem because unlike a\nsimple list , an ErrorList knows how to handle instances of ValidationError . Most use-cases that warranted using these private APIs are now covered by\nthe newly introduced Form.add_error() method: # Old pattern: try : ... except ValidationError as e : self . _errors = e . update_error_dict ( self . _errors ) # New pattern: try : ... except ValidationError as e : self . add_error ( None , e ) If you need both Django <= 1.6 and 1.7 compatibility you can’t use Form.add_error() since it\nwasn’t available before Django 1.7, but you can use the following\nworkaround to convert any list into ErrorList : try : ... except ValidationError as e : self . _errors = e . update_error_dict ( self . _errors ) # Additional code to ensure ``ErrorDict`` is exclusively # composed of ``ErrorList`` instances. for field , error_list in self . _errors . items (): if not isinstance ( error_list , self . error_class ): self . _errors [ field ] = self . error_class ( error_list ) Behavior of LocMemCache regarding pickle errors ¶ An inconsistency existed in previous versions of Django regarding how pickle\nerrors are handled by different cache backends. django.core.cache.backends.locmem.LocMemCache used to fail silently when\nsuch an error occurs, which is inconsistent with other backends and leads to\ncache-specific errors. This has been fixed in Django 1.7, see #21200 for more details. Cache keys are now generated from the request’s absolute URL ¶ Previous versions of Django generated cache keys using a request’s path and\nquery string but not the scheme or host. If a Django application was serving\nmultiple subdomains or domains, cache keys could collide. In Django 1.7, cache\nkeys vary by the absolute URL of the request including scheme, host, path, and\nquery string. For example, the URL portion of a cache key is now generated from https://www.example.com/path/to/?key=val rather than /path/to/?key=val .\nThe cache keys generated by Django 1.7 will be different from the keys\ngenerated by older versions of Django. After upgrading to Django 1.7, the first\nrequest to any previously cached URL will be a cache miss. Passing None to Manager.db_manager() ¶ In previous versions of Django, it was possible to use db_manager(using=None) on a model manager instance to obtain a manager\ninstance using default routing behavior, overriding any manually specified\ndatabase routing. In Django 1.7, a value of None passed to db_manager will\nproduce a router that retains any manually assigned database routing – the\nmanager will not be reset. This was necessary to resolve an inconsistency in\nthe way routing information cascaded over joins. See #13724 for more\ndetails. pytz may be required ¶ If your project handles datetimes before 1970 or after 2037 and Django raises\na ValueError when encountering them, you will have to install pytz . You may be affected by this problem if you use Django’s time\nzone-related date formats or django.contrib.syndication . remove() and clear() methods of related managers ¶ The remove() and clear() methods of the related managers created by ForeignKey , GenericForeignKey , and ManyToManyField suffered from a\nnumber of issues. Some operations ran multiple data modifying queries without\nwrapping them in a transaction, and some operations didn’t respect default\nfiltering when it was present (i.e. when the default manager on the related\nmodel implemented a custom get_queryset() ). Fixing the issues introduced some backward incompatible changes: The default implementation of remove() for ForeignKey related managers\nchanged from a series of Model.save() calls to a single QuerySet.update() call. The change means that pre_save and post_save signals aren’t sent anymore. You can use the bulk=False keyword argument to revert to the previous behavior. The remove() and clear() methods for GenericForeignKey related\nmanagers now perform bulk delete. The Model.delete() method isn’t called\non each instance anymore. You can use the bulk=False keyword argument to\nrevert to the previous behavior. The remove() and clear() methods for ManyToManyField related\nmanagers perform nested queries when filtering is involved, which may or\nmay not be an issue depending on your database and your data itself.\nSee this note for more details. Admin login redirection strategy ¶ Historically, the Django admin site passed the request from an unauthorized or\nunauthenticated user directly to the login view, without HTTP redirection. In\nDjango 1.7, this behavior changed to conform to a more traditional workflow\nwhere any unauthorized request to an admin page will be redirected (by HTTP\nstatus code 302) to the login page, with the next parameter set to the\nreferring path. The user will be redirected there after a successful login. Note also that the admin login form has been updated to not contain the this_is_the_login_form field (now unused) and the ValidationError code\nhas been set to the more regular invalid_login key. select_for_update() requires a transaction ¶ Historically, queries that use select_for_update() could be\nexecuted in autocommit mode, outside of a transaction. Before Django\n1.6, Django’s automatic transactions mode allowed this to be used to\nlock records until the next write operation. Django 1.6 introduced\ndatabase-level autocommit; since then, execution in such a context\nvoids the effect of select_for_update() . It is, therefore, assumed\nnow to be an error and raises an exception. This change was made because such errors can be caused by including an\napp which expects global transactions (e.g. ATOMIC_REQUESTS set to True ), or Django’s old autocommit\nbehavior, in a project which runs without them; and further, such\nerrors may manifest as data-corruption bugs. It was also made in\nDjango 1.6.3. This change may cause test failures if you use select_for_update() in a test class which is a subclass of TransactionTestCase rather than TestCase . Contrib middleware removed from default MIDDLEWARE_CLASSES ¶ The app-loading refactor deprecated using models from apps which are not part of the INSTALLED_APPS setting. This exposed an incompatibility between\nthe default INSTALLED_APPS and MIDDLEWARE_CLASSES in the\nglobal defaults ( django.conf.global_settings ). To bring these settings in\nsync and prevent deprecation warnings when doing things like testing reusable\napps with minimal settings, SessionMiddleware , AuthenticationMiddleware , and MessageMiddleware were removed\nfrom the defaults. These classes will still be included in the default settings\ngenerated by startproject . Most projects will not be affected by\nthis change but if you were not previously declaring the MIDDLEWARE_CLASSES in your project settings and relying on the\nglobal default you should ensure that the new defaults are in line with your\nproject’s needs. You should also check for any code that accesses django.conf.global_settings.MIDDLEWARE_CLASSES directly. Miscellaneous ¶ The django.core.files.uploadhandler.FileUploadHandler.new_file() method is now passed an additional content_type_extra parameter. If you\nhave a custom FileUploadHandler that implements new_file() , be sure it accepts this new parameter. ModelFormSet s no longer\ndelete instances when save(commit=False) is called. See can_delete for instructions on how\nto manually delete objects from deleted forms. Loading empty fixtures emits a RuntimeWarning rather than raising CommandError . django.contrib.staticfiles.views.serve() will now raise an Http404 exception instead of ImproperlyConfigured when DEBUG is False . This change removes the need to conditionally add the view to\nyour root URLconf, which in turn makes it safe to reverse by name. It also\nremoves the ability for visitors to generate spurious HTTP 500 errors by\nrequesting static files that don’t exist or haven’t been collected yet. The django.db.models.Model.__eq__() method is now defined in a\nway where instances of a proxy model and its base model are considered\nequal when primary keys match. Previously only instances of exact same\nclass were considered equal on primary key match. The django.db.models.Model.__eq__() method has changed such that\ntwo Model instances without primary key values won’t be considered\nequal (unless they are the same instance). The django.db.models.Model.__hash__() method will now raise TypeError when called on an instance without a primary key value. This is done to\navoid mutable __hash__ values in containers. AutoField columns in SQLite databases will now be\ncreated using the AUTOINCREMENT option, which guarantees monotonic\nincrements. This will cause primary key numbering behavior to change on\nSQLite, becoming consistent with most other SQL databases. This will only\napply to newly created tables. If you have a database created with an older\nversion of Django, you will need to migrate it to take advantage of this\nfeature. For example, you could do the following: Use dumpdata to save your data. Rename the existing database file (keep it as a backup). Run migrate to create the updated schema. Use loaddata to import the fixtures you exported in (1). django.contrib.auth.models.AbstractUser no longer defines a get_absolute_url() method. The old definition\nreturned \"/users/%s/\" % urlquote(self.username) which was arbitrary\nsince applications may or may not define such a url in urlpatterns .\nDefine a get_absolute_url() method on your own custom user object or use ABSOLUTE_URL_OVERRIDES if you want a URL for your user. The static asset-serving functionality of the django.test.LiveServerTestCase class has been simplified: Now it’s\nonly able to serve content already present in STATIC_ROOT when\ntests are run. The ability to transparently serve all the static assets\n(similarly to what one gets with DEBUG = True at\ndevelopment-time) has been moved to a new class that lives in the staticfiles application (the one actually in charge of such feature): django.contrib.staticfiles.testing.StaticLiveServerTestCase . In other\nwords, LiveServerTestCase itself is less powerful but at the same time\nhas less magic. Rationale behind this is removal of dependency of non-contrib code on\ncontrib applications. The old cache URI syntax (e.g. \"locmem://\" ) is no longer supported. It\nstill worked, even though it was not documented or officially supported. If\nyou’re still using it, please update to the current CACHES syntax. The default ordering of Form fields in case of inheritance has changed to\nfollow normal Python MRO. Fields are now discovered by iterating through the\nMRO in reverse with the topmost class coming last. This only affects you if\nyou relied on the default field ordering while having fields defined on both\nthe current class and on a parent Form . The required argument of SelectDateWidget has been removed.\nThis widget now respects the form field’s is_required attribute like\nother widgets. Widget.is_hidden is now a read-only property, getting its value by\nintrospecting the presence of input_type == 'hidden' . select_related() now chains in the\nsame way as other similar calls like prefetch_related . That is, select_related('foo', 'bar') is equivalent to select_related('foo').select_related('bar') . Previously the latter would\nhave been equivalent to select_related('bar') . GeoDjango dropped support for GEOS < 3.1. The init_connection_state method of database backends now executes in\nautocommit mode (unless you set AUTOCOMMIT to False ). If you maintain a custom database backend, you should check\nthat method. The django.db.backends.BaseDatabaseFeatures.allows_primary_key_0 attribute has been renamed to allows_auto_pk_0 to better describe it.\nIt’s True for all database backends included with Django except MySQL\nwhich does allow primary keys with value 0. It only forbids autoincrement primary keys with value 0. Shadowing model fields defined in a parent model has been forbidden as this\ncreates ambiguity in the expected model behavior. In addition, clashing\nfields in the model inheritance hierarchy result in a system check error.\nFor example, if you use multi-inheritance, you need to define custom primary\nkey fields on parent models, otherwise the default id fields will clash.\nSee Multiple inheritance for details. django.utils.translation.parse_accept_lang_header() now returns\nlowercase locales, instead of the case as it was provided. As locales should\nbe treated case-insensitive this allows us to speed up locale detection. django.utils.translation.get_language_from_path() and django.utils.translation.trans_real.get_supported_language_variant() now no longer have a supported argument. The shortcut view in django.contrib.contenttypes.views now supports\nprotocol-relative URLs (e.g. //example.com ). GenericRelation now supports an\noptional related_query_name argument. Setting related_query_name adds\na relation from the related object back to the content type for filtering,\nordering and other query operations. When running tests on PostgreSQL, the USER will need read access\nto the built-in postgres database. This is in lieu of the previous\nbehavior of connecting to the actual non-test database. As part of the System check framework , fields,\nmodels, and model managers all implement a check() method that is registered with the check framework. If you have an existing\nmethod called check() on one of these objects, you will need to rename it. As noted above in the “Cache” section of “Minor Features”, defining the TIMEOUT argument of the CACHES setting as None will set the cache keys as\n“non-expiring”. Previously, with the memcache backend, a TIMEOUT of 0 would set non-expiring keys,\nbut this was inconsistent with the set-and-expire (i.e. no caching) behavior\nof set(\"key\", \"value\", timeout=0) . If you want non-expiring keys,\nplease update your settings to use None instead of 0 as the latter\nnow designates set-and-expire in the settings as well. The sql* management commands now respect the allow_migrate() method\nof DATABASE_ROUTERS . If you have models synced to non-default\ndatabases, use the --database flag to get SQL for those models\n(previously they would always be included in the output). Decoding the query string from URLs now falls back to the ISO-8859-1 encoding\nwhen the input is not valid UTF-8. With the addition of the django.contrib.auth.middleware.SessionAuthenticationMiddleware to\nthe default project template (pre-1.7.2 only), a database must be created\nbefore accessing a page using runserver . The addition of the schemes argument to URLValidator will appear\nas a backwards-incompatible change if you were previously using a custom\nregular expression to validate schemes. Any scheme not listed in schemes will fail validation, even if the regular expression matches the given URL. Features deprecated in 1.7 ¶ django.core.cache.get_cache ¶ django.core.cache.get_cache has been supplanted by django.core.cache.caches . django.utils.dictconfig / django.utils.importlib ¶ django.utils.dictconfig and django.utils.importlib were copies of\nrespectively logging.config and importlib provided for Python\nversions prior to 2.7. They have been deprecated. django.utils.module_loading.import_by_path ¶ The current django.utils.module_loading.import_by_path function\ncatches AttributeError , ImportError , and ValueError exceptions,\nand re-raises ImproperlyConfigured . Such\nexception masking makes it needlessly hard to diagnose circular import\nproblems, because it makes it look like the problem comes from inside Django.\nIt has been deprecated in favor of import_string() . django.utils.tzinfo ¶ django.utils.tzinfo provided two tzinfo subclasses, LocalTimezone and FixedOffset . They’ve been deprecated in favor of\nmore correct alternatives provided by django.utils.timezone , django.utils.timezone.get_default_timezone() and django.utils.timezone.get_fixed_timezone() . django.utils.unittest ¶ django.utils.unittest provided uniform access to the unittest2 library\non all Python versions. Since unittest2 became the standard library’s unittest module in Python 2.7, and Django 1.7 drops support for older\nPython versions, this module isn’t useful anymore. It has been deprecated. Use unittest instead. django.utils.datastructures.SortedDict ¶ As OrderedDict was added to the standard library in\nPython 2.7, SortedDict is no longer needed and has been deprecated. The two additional, deprecated methods provided by SortedDict ( insert() and value_for_index() ) have been removed. If you relied on these methods to\nalter structures like form fields, you should now treat these OrderedDict s\nas immutable objects and override them to change their content. For example, you might want to override MyFormClass.base_fields (although\nthis attribute isn’t considered a public API) to change the ordering of fields\nfor all MyFormClass instances; or similarly, you could override self.fields from inside MyFormClass.__init__() , to change the fields\nfor a particular form instance. For example (from Django itself): PasswordChangeForm . base_fields = OrderedDict ( ( k , PasswordChangeForm . base_fields [ k ]) for k in [ \"old_password\" , \"new_password1\" , \"new_password2\" ] ) Custom SQL location for models package ¶ Previously, if models were organized in a package ( myapp/models/ ) rather\nthan simply myapp/models.py , Django would look for initial SQL data in myapp/models/sql/ . This bug has been fixed so that Django\nwill search myapp/sql/ as documented. After this issue was fixed, migrations\nwere added which deprecates initial SQL data. Thus, while this change still\nexists, the deprecation is irrelevant as the entire feature will be removed in\nDjango 1.9. Reorganization of django.contrib.sites ¶ django.contrib.sites provides reduced functionality when it isn’t in INSTALLED_APPS . The app-loading refactor adds some constraints in\nthat situation. As a consequence, two objects were moved, and the old\nlocations are deprecated: RequestSite now lives in django.contrib.sites.requests . get_current_site() now lives in django.contrib.sites.shortcuts . declared_fieldsets attribute on ModelAdmin ¶ ModelAdmin.declared_fieldsets has been deprecated. Despite being a private\nAPI, it will go through a regular deprecation path. This attribute was mostly\nused by methods that bypassed ModelAdmin.get_fieldsets() but this was\nconsidered a bug and has been addressed. Reorganization of django.contrib.contenttypes ¶ Since django.contrib.contenttypes.generic defined both admin and model\nrelated objects, an import of this module could trigger unexpected side effects.\nAs a consequence, its contents were split into contenttypes submodules and the django.contrib.contenttypes.generic module is deprecated: GenericForeignKey and GenericRelation now live in fields . BaseGenericInlineFormSet and generic_inlineformset_factory() now\nlive in forms . GenericInlineModelAdmin , GenericStackedInline and GenericTabularInline now live in admin . syncdb ¶ The syncdb command has been deprecated in favor of the new migrate command. migrate takes the same arguments as syncdb used to plus a few\nmore, so it’s safe to just change the name you’re calling and nothing else. util modules renamed to utils ¶ The following instances of util.py in the Django codebase have been renamed\nto utils.py in an effort to unify all util and utils references: django.contrib.admin.util django.contrib.gis.db.backends.util django.db.backends.util django.forms.util get_formsets method on ModelAdmin ¶ ModelAdmin.get_formsets has been deprecated in favor of the new get_formsets_with_inlines() , in order to\nbetter handle the case of selectively showing inlines on a ModelAdmin . IPAddressField ¶ The django.db.models.IPAddressField and django.forms.IPAddressField fields have been deprecated in favor of django.db.models.GenericIPAddressField and django.forms.GenericIPAddressField . BaseMemcachedCache._get_memcache_timeout method ¶ The BaseMemcachedCache._get_memcache_timeout() method has been renamed to get_backend_timeout() . Despite being a private API, it will go through the\nnormal deprecation. Natural key serialization options ¶ The --natural and -n options for dumpdata have been\ndeprecated. Use dumpdata --natural-foreign instead. Similarly, the use_natural_keys argument for serializers.serialize() has been deprecated. Use use_natural_foreign_keys instead. Merging of POST and GET arguments into WSGIRequest.REQUEST ¶ It was already strongly suggested that you use GET and POST instead of REQUEST , because the former are more explicit. The property REQUEST is\ndeprecated and will be removed in Django 1.9. django.utils.datastructures.MergeDict class ¶ MergeDict exists primarily to support merging POST and GET arguments into a REQUEST property on WSGIRequest . To merge\ndictionaries, use dict.update() instead. The class MergeDict is\ndeprecated and will be removed in Django 1.9. Language codes zh-cn , zh-tw and fy-nl ¶ The currently used language codes for Simplified Chinese zh-cn ,\nTraditional Chinese zh-tw and (Western) Frysian fy-nl are deprecated\nand should be replaced by the language codes zh-hans , zh-hant and fy respectively. If you use these language codes, you should rename the\nlocale directories and update your settings to reflect these changes. The\ndeprecated language codes will be removed in Django 1.9. django.utils.functional.memoize function ¶ The function memoize is deprecated and should be replaced by the functools.lru_cache decorator (available from Python 3.2 onward). Django ships a backport of this decorator for older Python versions and it’s\navailable at django.utils.lru_cache.lru_cache . The deprecated function will\nbe removed in Django 1.9. Geo Sitemaps ¶ Google has retired support for the Geo Sitemaps format. Hence Django support\nfor Geo Sitemaps is deprecated and will be removed in Django 1.8. Passing callable arguments to queryset methods ¶ Callable arguments for querysets were an undocumented feature that was\nunreliable. It’s been deprecated and will be removed in Django 1.9. Callable arguments were evaluated when a queryset was constructed rather than\nwhen it was evaluated, thus this feature didn’t offer any benefit compared to\nevaluating arguments before passing them to queryset and created confusion that\nthe arguments may have been evaluated at query time. ADMIN_FOR setting ¶ The ADMIN_FOR feature, part of the admindocs, has been removed. You can\nremove the setting from your configuration at your convenience. SplitDateTimeWidget with DateTimeField ¶ SplitDateTimeWidget support in DateTimeField is\ndeprecated, use SplitDateTimeWidget with SplitDateTimeField instead. validate ¶ The validate management command is deprecated in favor of the check command. django.core.management.BaseCommand ¶ requires_model_validation is deprecated in favor of a new requires_system_checks flag. If the latter flag is missing, then the\nvalue of the former flag is used. Defining both requires_system_checks and requires_model_validation results in an error. The check() method has replaced the old validate() method. ModelAdmin validators ¶ The ModelAdmin.validator_class and default_validator_class attributes\nare deprecated in favor of the new checks_class attribute. The ModelAdmin.validate() method is deprecated in favor of ModelAdmin.check() . The django.contrib.admin.validation module is deprecated. django.db.backends.DatabaseValidation.validate_field ¶ This method is deprecated in favor of a new check_field method.\nThe functionality required by check_field() is the same as that provided\nby validate_field() , but the output format is different. Third-party database\nbackends needing this functionality should provide an implementation of check_field() . Loading ssi and url template tags from future library ¶ Django 1.3 introduced {% load ssi from future %} and {% load url from future %} syntax for forward compatibility of the ssi and url template tags. This syntax is now deprecated and\nwill be removed in Django 1.9. You can simply remove the {% load ... from future %} tags. django.utils.text.javascript_quote ¶ javascript_quote() was an undocumented function present in django.utils.text .\nIt was used internally in the javascript_catalog() view\nwhose implementation was changed to make use of json.dumps() instead.\nIf you were relying on this function to provide safe output from untrusted\nstrings, you should use django.utils.html.escapejs or the escapejs template filter.\nIf all you need is to generate valid JavaScript strings, you can simply use json.dumps() . fix_ampersands utils method and template filter ¶ The django.utils.html.fix_ampersands method and the fix_ampersands template filter are deprecated, as the escaping of ampersands is already taken care\nof by Django’s standard HTML escaping features. Combining this with fix_ampersands would either result in double escaping, or, if the output is assumed to be safe,\na risk of introducing XSS vulnerabilities. Along with fix_ampersands , django.utils.html.clean_html is deprecated, an undocumented function that calls fix_ampersands .\nAs this is an accelerated deprecation, fix_ampersands and clean_html will be removed in Django 1.8. Reorganization of database test settings ¶ All database settings with a TEST_ prefix have been deprecated in favor of\nentries in a TEST dictionary in the database\nsettings. The old settings will be supported until Django 1.9. For backwards\ncompatibility with older versions of Django, you can define both versions of\nthe settings as long as they match. FastCGI support ¶ FastCGI support via the runfcgi management command will be removed in\nDjango 1.9. Please deploy your project using WSGI. Moved objects in contrib.sites ¶ Following the app-loading refactor, two objects in django.contrib.sites.models needed to be moved because they must be\navailable without importing django.contrib.sites.models when django.contrib.sites isn’t installed. Import RequestSite from django.contrib.sites.requests and get_current_site() from django.contrib.sites.shortcuts . The old import locations will work until\nDjango 1.9. django.forms.forms.get_declared_fields() ¶ Django no longer uses this functional internally. Even though it’s a private\nAPI, it’ll go through the normal deprecation cycle. Private Query Lookup APIs ¶ Private APIs django.db.models.sql.where.WhereNode.make_atom() and django.db.models.sql.where.Constraint are deprecated in favor of the new custom lookups API . Features removed in 1.7 ¶ These features have reached the end of their deprecation cycle and are removed\nin Django 1.7. See Features deprecated in 1.5 for details, including how to\nremove usage of these features. django.utils.simplejson is removed. django.utils.itercompat.product is removed. INSTALLED_APPS and TEMPLATE_DIRS are no longer corrected from a plain\nstring into a tuple. HttpResponse , SimpleTemplateResponse , TemplateResponse , render_to_response() , index() , and sitemap() no longer take a mimetype argument HttpResponse immediately consumes its content if it’s\nan iterator. The AUTH_PROFILE_MODULE setting, and the get_profile() method on\nthe User model are removed. The cleanup management command is removed. The daily_cleanup.py script is removed. select_related() no longer has a depth keyword argument. The get_warnings_state() / restore_warnings_state() functions from django.test.utils and the save_warnings_state() / restore_warnings_state() django.test.*TestCase are removed. The check_for_test_cookie method in AuthenticationForm is removed. The version of django.contrib.auth.views.password_reset_confirm() that\nsupports base36 encoded user IDs\n( django.contrib.auth.views.password_reset_confirm_uidb36 ) is removed. The django.utils.encoding.StrAndUnicode mix-in is removed.", "keywords": ["users", "feed", "language_cookie_domain", "get_queryset", "manytomanyfield.through_fields", "fileuploadhandler", "allow_migrate", "django.contrib.sessions.backends.cached_db", "django.utils.encoding", "feature", "django.shortcuts.render_to_response", "storage", "commanderror", "pattern", "login", "cleanup", "startup", "this_is_the_login_form", "/users/%s/", "messages", "b", "background", "ssi", "corruption", "functools.lru_cache", "fix_ampersands", "library", "field", "#", "relation", "ansicon", "serialization", "urlquote(self.username", "as_data", "radius", "migrations", "pubdate", "django.forms", "metadata", "get_warnings_state", "unique_together", "+", "coerce", "django_language", "django_settings_module", "backup", "lte", "django.utils.timezone.get_fixed_timezone", "localemiddleware.response_redirect_class", "escapejs", "host", "representation", "range", "transforms", "mro", "lines", "django.db.models", "to/?key", "httpresponse", "wsgirequest", "match", "cache", "compatibility", "datefield", "abstractuser", "javascript_quote", "get_model", "needs", "words", "tool", "heavy", "context.push", "form._errors", "change", "get_wsgi_application", "border", "https", "links", "default_validator_class", "ids", "constructors", "label", "laptops", "presence", "http", "changes", "=", "results", "render_to_response", "refactor", "get_absolute_url", "errorlist", "django.utils.lru_cache.lru_cache", "message", "min", "regressions", "relationship", "months", "lastmod", "manifeststaticfilesstorage", "character", "setup", "django.forms.util", "tables", "tag", "filesystem", "postgres", "admin_for", "button", "zones", "catches", "checks_class", "openlayers", "genericforeignkey", "localtimezone", "process", "fields/__init__.py", "crosses", "debug", "iexact", "choice", "exceptions", "django.db.models.sql.where", "strip_tags", "file_permissions_mode", "following", "type", "value_for_index", "error_messages", "passwordchangeform", "calls", "custom", "kwargs", "objects", "documentation", "django.utils.text", "prefetch", "lookups", ".po", "genericinlinemodeladmin", "discoverrunner", "file", "restore_warnings_state", "cells", "customization", "constraint", "layout", "locmem://", "modules", "urlvalidator", "strategy", "user", "site_title", "language_cookie_path", "template_fragments", "cases", "autocommit", "django.contrib.admin.util", "permission_required", "attribute", "args", "django.contrib.gis", "radio", "csrf_cookie_age", "pickle", "constraints", "django.db.models.signals.post_syncdb", "runtimewarning", "splitdatetimefield", "queryset.update_or_create", "time", "workflow", "tags", "workaround", "risk", "thanks", "date", "render", "setting", "pre-1.7.2", "operators", "responses", "account", "memcache", "app_label", "auth_profile_module", "service", "transform", "things", "update_error_dict", "base_fields", "minor", "password", "grid", "iterator", "accuracy", "logic", "name", "modeladmin.get_changeform_initial_data", "makemigrations", "parameter", "test_runner", "execution", "django.utils.simplejson", "flags", "wizardview.done", "clean_html", "escaping", "backends", "copies", "codebase", "django.contrib.auth", "issue", "problems", "versions", "disjoint", "queries", "locking", "min_num", "get_current_site", "specifiers", "configurations", "functional", "use_natural_primary_keys", "manager", "nt", "wording", "django.contrib.admin", "selectdatewidget", "select_for_update", "django.contrib.contenttypes.generic", "form.cleaned_data", "z", "addresses", "default_permissions", "literals", "return", "reverse", "handlers", "applications", "operator", "util", "as_json", "expressions", "situation", "cursors", "backport", "parent", "search", "modelformset", "modeladmin.check", "textfield", "django.utils.dictconfig", "edge", "blog", "appcommand", "requirement", "datetimefield", "colorization", "django.contrib.staticfiles", "field.choices", "lookuperror", "smtp", "sessionmiddleware", "django.contrib.sites.models", "status", "dirs", "isinstance", "pre_migrate", "plan", "space", "model.save", "url", "error", "collectstatic", "module", "timeout", "code", "error_list", "locmemcache", "html_email_template_name", "subdomains", "period", "decimalfield", "bulk", "regexvalidator", "invalidation", "monotonic", "new_password1", "filter", "style", "behavior", "c", "i", "migration", "class", "link", "access", "false", "django.middleware.locale", "discovery", "django.db.backends.util", "modeladmin.get_formsets", "redirection", "django.utils.html.clean_html", "django.forms.forms.get_declared_fields", "resets", "introspecting", "warnings", "widget", "returns", "geo", "'", "frysian", "javascript", "django.utils.importlib", "attack", "deconstruct", "request", "fy", "database", "flag", "output", "explicit", "input", "django.core.cache.backends.locmem", "importerror", "memoize", "signal", "close", "*", "query", "page", "test", "commands", "postgresql", "migrate", "types", "strings", "locales", "reorganization", "subclass", "burden", "admin", "creation", ".", "http404", "insert", "usage", "k", "registry", "mix", "transactiontestcase", "xml", "wsgi", "asset", "configuration", "requires_model_validation", "auth_user_model", "javascript_catalog", "script", "step", "fixedoffset", "max_length", "django.core.cache.get_cache", "db8::1", "added", "effort", "generic_inlineformset_factory", "django.utils.html.fix_ampersands", "gif", "django.contrib.redirects", "thread", "model.__eq", "django.utils.itercompat.product", "role", "superclass", "django.contrib.sites", "vegetarian", "validation", "containers", "genericrelation", "esperanto", "e", "section", "plain", "increments", "manipulating", "reloads", "django.contrib.auth.views.password_reset_confirm_uidb36", "language_cookie_age", "send_mail", "cn", "sequence", "pop", "django.template.loader.get_template", "cachedstaticfilesstorage", "underscore", "css", "router", "use", "miss", "atom1feed", "environment", "model._meta", "origin", "day_lte", "static_root", "serializability", "solution", "subclasses", "sibling", "releases", "get_formsets_with_inlines", "genericipaddressfield", "core", "charge", "pass", "----------", "expire", "index_together", "django.contrib.sites.requests", "self.fields", "operation", "order", "signature", "params", "default", "html_message", "requestsite", "middleware_classes", "bug", "signals", "shortcuts", "form", "file_upload_directory_permissions", "prefix", "option", "format", "get_formsets", "classes", "help", "characters", "tests", "expression", "cross", "subfields", "equality", "cleaning", "form.errors.as_json", "django.utils.module_loading.import_by_path", "admin.site.register", "add_error", "initial_data", "form.errors", "storage.get_available_name", "considerations", "timezone", "booleanfield", "validationerror", "convenience", "push", "f", "advantage", "scheme", "django.conf.global_settings", "truncatechars_html", "domains", "get_profile", "cursor", "uploadedfile.content_type_extra", "s3", "daily_cleanup.py", "modeladmin.fields", "non_field_error", "limitation", "indentation", "template", "routing", "form.add_error", "header", "onetoonefield", "schema", "way", "staticliveservertestcase", "response_redirect_class", "console", "pyinotify", "execute", "http(s", "formats", "checks", "queryset.as_manager", "origins", "customizations", "checkboxes", "t", "old", "index", "syndication", "concept", "validate", "september", "party", "queryset", "integer", "requires_system_checks", "session", "modeladmin.get_fields", "¶", "maxlength", "command", "id", "internationalization", "parameters", "remove", "generictabularinline", "post", "admindocs", "val", "import_string", "integers", "masking", "linux", "property", "side", "internal_type", "contrib.sites", "can_delete", "content", "primary", "function", "//example.com", "testing", "result", "save(commit", "view", "integrity", "pre_save", "select_related('foo').select_related('bar", "color", "django.contrib.sessions", "ambiguity", "zone", "django.contrib.admin.validation", "number", "chinese", "per", "mimetype", "relations", "permissions", "modelform", "django.contrib.sites.shortcuts", "datetimes", "django.shortcuts.render", "values", "staticfiles", "iso-8859", "django.contrib.sites.middleware", "failures", "directories", "string", "loops", "_", "order_by", "error_class", "windows", "unix", "timeline", "mapping", "model.delete", "favor", "databases", "verbose_name", "managers", "form_dict", "structures", "modeladmin.get_fieldsets", "django.core.files.uploadhandler", "libraries", "location", "table", "inlines", "language", "zh", "save_warnings_state", "models", "shortcomings", "querysets", "predicates", "ipv6", "version", "level", "json", "loading", "metaclasses", "contents", "processor", "appregistrynotready", "atomic_requests", "queryset.values", "labels", "response_gone_class", "deprecation", "portion", "django", "series", "select_related('bar", "django.contrib.auth.middleware", "myapp", "rfc", "n’t", "autodiscover", "formset_factory", "fields", "django.contrib.messages", "utilities", "entry", "dumpdata", "alternatives", "field.clean", "set", "development", "power", "1.6.6", "schemes", "input_type", "lowercase", "db", "operating", "test_suite", "icontains", "urlpatterns", "value", "jsonresponse", "sync", "assertion", "line", "codes", "limit_choices_to", "improperlyconfigured", "policy", "hierarchy", "related_query_name", "multivaluefield", "data", "browser", "facilitate", "seed_cache", "implementation", "columns", "handler", "myformclass.base_fields", "container", "modelname", "messagemiddleware", "backend", "json.dumps", "logging.config", "base36", "queryset.update", "runsql", "identifier", "add", "modeladmin.get_search_fields", "errordict", "file_upload_permissions", "security", "regression", "standalone", "shortcut", "self", "paths", "instance", "need", "typeerror", "uri", "effects", "today", "localization", "geometries", "makemessages", "django.contrib.syndication", "levels", "handling", "simpletemplateresponse", "django.utils.tzinfo", "consequence", "corners", "sitemaps", "basecommand", "serializers.serialize", "validators", "constant", "require_all_fields", "vista", "modeladmin", "forgery", "wsgihandler", "respect", "functionality", "database_routers", "site_header", "basegenericinlineformset", "bugs", "assertredirects", "docs", "related_name", "manager.db_manager", "ipaddressfield", "issues", "decorator", "externals", "assets", "constructor", "joins", "pizza", "traditional", "instances", "structure", "statement", "inheriting", "inconsistency", "authenticationmiddleware", "tzinfo", "installed_apps", "part", "fixtures", "dependency", "chains", "django.utils.translation.parse_accept_lang_header", "myformclass", "pywin32", "object", "references", "load", "textarea", "redirectfallbackmiddleware", "rationale", "senders", "ampersands", "valueerror", "django.utils.datastructures", "localemiddleware", "absolute_url_overrides", "charfield", "battery", "manytomanyfield", "management", "response", "dictionary", "syncdb", "hints", "rollbacks", "vendors", "requests", "whitespace", "sql", "example@[2001", "instructions", "compilemessages", "level_tag", "rendering", "keyword", "register", "unittest2", "s", "csrf", "ordering", "currentsitemiddleware", "abstractbaseuser", "max", "context.flatten", "drawbacks", "matches", "check_field", "root", "rest", "notes", "redirect", "directory_permissions_mode", "controls", "life", "turn", "set(\"key", "runpython", "effect", "staging", "init_connection_state", "system", "apps", "authenticationform.confirm_login_allowed", "inheritance", "django.db.backends", "django.contrib.contenttypes", "runfcgi", "changelist", "solutions", "migrating", "filtering", "values_list", "welcome", "modeladmin.declared_fieldsets", "second", "use_natural_foreign_keys", "items", "--natural", "loaddata", "production", "widgets", "routers", "storages", "dict.update", "comparisons", "removal", "definition", "sorteddict", "strandunicode", "autofield", "check", "difference", "voids", "ordereddict", "features", "forms", "site", "’s", "selectdatewidget.months", "uploads", "consistency", "incompatibility", "styles.55e7cbb9ba48.css", "addition", "food", "example", "denial", "lists", "django.contrib.contenttypes.views", "app", "care", "django.test.*testcase", "use_natural_keys", "requirements", "locations", "column", "pytz", "list", "delay", "django.utils.translation.trans_real.get_supported_language_variant", "staticfiles.json", "genericstackedinline", "orm", "form.clean", "autoincrement", "detection", "runserver", "handle_app_config", "utils", "hans", "django.utils.timezone", "confusion", "email", "stack", "google", "historically", "filefield.upload_to", "phase", "determines", "model", "variable", "year", "idea", "apis", "place", "django.forms.utils", "systems", "emailbackend", "findstatic", "element", "application", "dry", "encoding", "select_related('foo", "submodules", "dictionaries", "django.contrib.auth.models", "conflicts", "attributes", "approach", "foodqueryset", "django.db.models.signals.pre_syncdb", "testcase", "check_for_test_cookie", "title", "form.errors.as_data", "release", "ability", "redirects", "django.contrib.auth.views.password_reset_confirm", "django.utils.timezone.get_default_timezone", "fileuploadhandler.new_file", "urlconf", "amazon", "geos", "language_session_key", "translation", "syntax", "subdirectory", "modifying", "nl", "conditionalgetmiddleware", "django.contrib.gis.db.backends.util", "django.core.cache.caches", "benefit", "rollback", "keys", "case", "principle", "attributeerror", "lookup", "ftp(s", "errors", "html", "tuple", "server", "str", "arguments", "upload", "session_cache_alias", "raising", "init", "package", "middleware", "xss", "one", "end", "translations", "entries", "improvements", "records", "invalid_login", "contrib", "sqlite", "importlib", "startproject", "delete", "tw", "autodetect", "adminsite", "assertnumqueries", "bar", "get_template", "httprequest.scheme", "kind", "checkboxselectmultiple", "path", "inverse_match", "contenttypes", "functions", "key", "operations", "appconfig", "lieu", "pizzas", "none", "django.apps.apps", "authenticationform", "problem", "improved", "meta", "get", "patterns", "infrastructure", "session_cookie_secure", "framework", "caches", "symlink", "django.test.utils", "new", "true", "templateresponse", "hyphen", "sitemap", "entrymanager", "urls", "api", "sessions", "allows_auto_pk_0", "support", "wherenode.make_atom", "modeladmin.view_on_site", "cookies", "descending", "mode", "projects", "splitdatetimewidget", "transactions", "connection", "-", "merging", "transformations", "id_for_label", "context", "basememcachedcache._get_memcache_timeout", "cycle", "permission", "alternative", "files", "import", "blocktrans", "d", "mergedict", "rename", "basedatabasefeatures.allows_primary_key_0", "directory", ">", "%", "defaults", "call", "foreignkey", "checkbox", "information", "images", "in", "python", "pythonpath", "touches", "methods", "options", "times", "exception", "django.core.handlers.wsgi", "client", "details", "method", "singleton", "geodjango", "datefields", "settings", "transaction", "argument", "radioselect", "cookie", "note", "body", "databasevalidation.validate_field", "visitors", "fastcgi", "vulnerabilities", "scenarios", "templates", "buttons", "admin_order_field", "modeladmin.list_display_links", "beginning", "sql/", "text", "typedchoicefield", "project", "abstractbaseuser.get_session_auth_hash", "parts"], "type": "documentation"},
{"title": "Django 1.4 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.4/", "content": "Django 1.4 release notes ¶ March 23, 2012 Welcome to Django 1.4! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 1.3 or older versions. We’ve\nalso dropped some features, which are detailed in our deprecation plan , and we’ve begun the deprecation process\nfor some features . Overview ¶ The biggest new feature in Django 1.4 is support for time zones when\nhandling date/times. When enabled, this Django will store date/times in UTC,\nuse timezone-aware objects internally, and translate them to users’ local\ntimezones for display. If you’re upgrading an existing project to Django 1.4, switching to the timezone\naware mode may take some care: the new mode disallows some rather sloppy\nbehavior that used to be accepted. We encourage anyone who’s upgrading to check\nout the timezone migration guide and the timezone FAQ for useful pointers. Other notable new features in Django 1.4 include: A number of ORM improvements, including SELECT FOR UPDATE support ,\nthe ability to bulk insert large datasets for improved performance, and QuerySet.prefetch_related , a method to batch-load related objects\nin areas where select_related() doesn’t work. Some nice security additions, including improved password hashing (featuring PBKDF2 and bcrypt support), new tools for cryptographic\nsigning , several CSRF improvements , and simple clickjacking\nprotection . An updated default project layout and manage.py that removes the “magic”\nfrom prior versions. And for those who don’t like the new layout, you can\nuse custom project and app templates instead! Support for in-browser testing frameworks (like Selenium ). … and a whole lot more; see below ! Wherever possible we try to introduce new features in a backwards-compatible\nmanner per our API stability policy policy.\nHowever, as with previous releases, Django 1.4 ships with some minor backwards incompatible changes ; people\nupgrading from previous versions of Django should read that list carefully. Python compatibility ¶ Django 1.4 has dropped support for Python 2.4. Python 2.5 is now the minimum\nrequired Python version. Django is tested and supported on Python 2.5, 2.6 and\n2.7. This change should affect only a small number of Django users, as most\noperating-system vendors today are shipping Python 2.5 or newer as their default\nversion. If you’re still using Python 2.4, however, you’ll need to stick to\nDjango 1.3 until you can upgrade. Per our support policy , Django 1.3 will continue to receive security\nsupport until the release of Django 1.5. Django does not support Python 3.x at this time. At some point before the\nrelease of Django 1.4, we plan to publish a document outlining our full\ntimeline for deprecating Python 2.x and moving to Python 3.x. What’s new in Django 1.4 ¶ Support for time zones ¶ In previous versions, Django used “naive” date/times (that is, date/times\nwithout an associated time zone), leaving it up to each developer to interpret\nwhat a given date/time “really means”. This can cause all sorts of subtle\ntimezone-related bugs. In Django 1.4, you can now switch Django into a more correct, time-zone aware\nmode. In this mode, Django stores date and  time information in UTC in the\ndatabase, uses time-zone-aware datetime objects internally and translates them\nto the end user’s time zone in templates and forms. Reasons for using this\nfeature include: Customizing date and time display for users around the world. Storing datetimes in UTC for database portability and interoperability.\n(This argument doesn’t apply to PostgreSQL, because it already stores\ntimestamps with time zone information in Django 1.3.) Avoiding data corruption problems around DST transitions. Time zone support is enabled by default in new projects created with startproject . If you want to use this feature in an existing\nproject, read the migration guide . If you\nencounter problems, there’s a helpful FAQ . Support for in-browser testing frameworks ¶ Django 1.4 supports integration with in-browser testing frameworks like Selenium . The new django.test.LiveServerTestCase base class lets you\ntest the interactions between your site’s front and back ends more\ncomprehensively. See the documentation for more details and\nconcrete examples. Updated default project layout and manage.py ¶ Django 1.4 ships with an updated default project layout and manage.py file\nfor the startproject management command. These fix some issues with\nthe previous manage.py handling of Python import paths that caused double\nimports, trouble moving from development to deployment, and other\ndifficult-to-debug path issues. The previous manage.py called functions that are now deprecated, and thus\nprojects upgrading to Django 1.4 should update their manage.py . (The\nold-style manage.py will continue to work as before until Django 1.6. In\n1.5 it will raise DeprecationWarning ). The new recommended manage.py file should look like this: #!/usr/bin/env python import os , sys if __name__ == \"__main__\" : os . environ . setdefault ( \"DJANGO_SETTINGS_MODULE\" , \"{{ project_name }}.settings\" ) from django.core.management import execute_from_command_line execute_from_command_line ( sys . argv ) {{ project_name }} should be replaced with the Python package name of the\nactual project. If settings, URLconfs and apps within the project are imported or referenced\nusing the project name prefix (e.g. myproject.settings , ROOT_URLCONF = \"myproject.urls\" , etc.), the new manage.py will need to be moved one\ndirectory up, so it is outside the project package rather than adjacent to settings.py and urls.py . For instance, with the following layout: manage.py\nmysite/\n    __init__.py\n    settings.py\n    urls.py\n    myapp/\n        __init__.py\n        models.py You could import mysite.settings , mysite.urls , and mysite.myapp ,\nbut not settings , urls , or myapp as top-level modules. Anything imported as a top-level module can be placed adjacent to the new manage.py . For instance, to decouple myapp from the project module and\nimport it as just myapp , place it outside the mysite/ directory: manage.py\nmyapp/\n    __init__.py\n    models.py\nmysite/\n    __init__.py\n    settings.py\n    urls.py If the same code is imported inconsistently (some places with the project\nprefix, some places without it), the imports will need to be cleaned up when\nswitching to the new manage.py . Custom project and app templates ¶ The startapp and startproject management commands\nnow have a --template option for specifying a path or URL to a custom app\nor project template. For example, Django will use the /path/to/my_project_template directory\nwhen you run the following command: django-admin.py startproject --template = /path/to/my_project_template myproject You can also now provide a destination directory as the second\nargument to both startapp and startproject : django-admin.py startapp myapp /path/to/new/app\ndjango-admin.py startproject myproject /path/to/new/project For more information, see the startapp and startproject documentation. Improved WSGI support ¶ The startproject management command now adds a wsgi.py module to the initial project layout, containing a simple WSGI application that\ncan be used for deploying with WSGI app\nservers . The built-in development server now supports using an\nexternally-defined WSGI callable, which makes it possible to run runserver with the same WSGI configuration that is used for deployment. The new WSGI_APPLICATION setting lets you configure which WSGI callable runserver uses. (The runfcgi management command also internally wraps the WSGI\ncallable configured via WSGI_APPLICATION .) SELECT FOR UPDATE support ¶ Django 1.4 includes a QuerySet.select_for_update() method, which generates a SELECT ... FOR UPDATE SQL query. This will lock rows until the end of the\ntransaction, meaning other transactions cannot modify or delete rows matched by\na FOR UPDATE query. For more details, see the documentation for select_for_update() . Model.objects.bulk_create in the ORM ¶ This method lets you create multiple objects more efficiently. It can result in\nsignificant performance increases if you have many objects. Django makes use of this internally, meaning some operations (such as database\nsetup for test suites) have seen a performance benefit as a result. See the bulk_create() docs for more\ninformation. QuerySet.prefetch_related ¶ Similar to select_related() but with a\ndifferent strategy and broader scope, prefetch_related() has been added to QuerySet . This method returns a new QuerySet that will prefetch each of the specified related lookups in a\nsingle batch as soon as the query begins to be evaluated. Unlike select_related , it does the joins in Python, not in the database, and\nsupports many-to-many relationships, GenericForeignKey and more. This\nallows you to fix a very common performance problem in which your code ends up\ndoing O(n) database queries (or worse) if objects on your primary QuerySet each have many related objects that you also need to fetch. Improved password hashing ¶ Django’s auth system ( django.contrib.auth ) stores passwords using a one-way\nalgorithm. Django 1.3 uses the SHA1 algorithm, but increasing processor speeds\nand theoretical attacks have revealed that SHA1 isn’t as secure as we’d like.\nThus, Django 1.4 introduces a new password storage system: by default Django now\nuses the PBKDF2 algorithm (as recommended by NIST ). You can also easily choose\na different algorithm (including the popular bcrypt algorithm). For more\ndetails, see How Django stores passwords . HTML5 doctype ¶ We’ve switched the admin and other bundled templates to use the HTML5\ndoctype. While Django will be careful to maintain compatibility with older\nbrowsers, this change means that you can use any HTML5 features you need in\nadmin pages without having to lose HTML validity or override the provided\ntemplates to change the doctype. List filters in admin interface ¶ Prior to Django 1.4, the admin app let you specify\nchange list filters by specifying a field lookup, but it didn’t allow you to\ncreate custom filters. This has been rectified with a simple API (previously\nused internally and known as “FilterSpec”). For more details, see the\ndocumentation for list_filter . Multiple sort in admin interface ¶ The admin change list now supports sorting on multiple columns. It respects all\nelements of the ordering attribute, and\nsorting on multiple columns by clicking on headers is designed to mimic the\nbehavior of desktop GUIs. We also added a get_ordering() method for specifying the\nordering dynamically (i.e., depending on the request). New ModelAdmin methods ¶ We added a save_related() method to ModelAdmin to ease customization of how\nrelated objects are saved in the admin. Two other new ModelAdmin methods, get_list_display() and get_list_display_links() enable dynamic customization of fields and links displayed on the admin\nchange list. Admin inlines respect user permissions ¶ Admin inlines now only allow those actions for which the user has\npermission. For ManyToMany relationships with an auto-created intermediate\nmodel (which does not have its own permissions), the change permission for the\nrelated model determines if the user has the permission to add, change or\ndelete relationships. Tools for cryptographic signing ¶ Django 1.4 adds both a low-level API for signing values and a high-level API\nfor setting and reading signed cookies, one of the most common uses of\nsigning in web applications. See the cryptographic signing docs for more\ninformation. Cookie-based session backend ¶ Django 1.4 introduces a cookie-based session backend that uses the tools for cryptographic signing to store the session data in\nthe client’s browser. Warning Session data is signed and validated by the server, but it’s not\nencrypted. This means a user can view any data stored in the\nsession but cannot change it. Please read the documentation for\nfurther clarification before using this backend. See the cookie-based session backend docs for\nmore information. New form wizard ¶ The previous FormWizard from django.contrib.formtools has been\nreplaced with a new implementation based on the class-based views\nintroduced in Django 1.3. It features a pluggable storage API and doesn’t\nrequire the wizard to pass around hidden fields for every previous step. Django 1.4 ships with a session-based storage backend and a cookie-based\nstorage backend. The latter uses the tools for cryptographic signing also introduced in\nDjango 1.4 to store the wizard’s state in the user’s cookies. reverse_lazy ¶ A lazily evaluated version of reverse() was added to allow using URL\nreversals before the project’s URLconf gets loaded. Translating URL patterns ¶ Django can now look for a language prefix in the URLpattern when using the new i18n_patterns() helper function.\nIt’s also now possible to define translatable URL patterns using django.utils.translation.ugettext_lazy() . See Internationalization: in URL patterns for more information about the language prefix\nand how to internationalize URL patterns. Contextual translation support for {% trans %} and {% blocktrans %} ¶ The contextual translation support introduced in\nDjango 1.3 via the pgettext function has been extended to the trans and blocktrans template tags using the new context keyword. Customizable SingleObjectMixin URLConf kwargs ¶ Two new attributes, pk_url_kwarg and slug_url_kwarg ,\nhave been added to SingleObjectMixin to\nenable the customization of URLconf keyword arguments used for single\nobject generic views. Assignment template tags ¶ A new assignment_tag helper function was added to template.Library to\nease the creation of template tags that store data in a specified context\nvariable. *args and **kwargs support for template tag helper functions ¶ The simple_tag , inclusion_tag and newly\nintroduced assignment_tag template helper functions may now accept any\nnumber of positional or keyword arguments. For example: @register . simple_tag def my_tag ( a , b , * args , ** kwargs ): warning = kwargs [ \"warning\" ] profile = kwargs [ \"profile\" ] ... return ... Then, in the template, any number of arguments may be passed to the template tag.\nFor example: {% my_tag 123 \"abcd\" book.title warning = message | lower profile = user.profile %} No wrapping of exceptions in TEMPLATE_DEBUG mode ¶ In previous versions of Django, whenever the TEMPLATE_DEBUG setting\nwas True , any exception raised during template rendering (even exceptions\nunrelated to template syntax) were wrapped in TemplateSyntaxError and\nre-raised. This was done in order to provide detailed template source location\ninformation in the debug 500 page. In Django 1.4, exceptions are no longer wrapped. Instead, the original\nexception is annotated with the source information. This means that catching\nexceptions from template rendering is now consistent regardless of the value of TEMPLATE_DEBUG , and there’s no need to catch and unwrap TemplateSyntaxError in order to catch other errors. truncatechars template filter ¶ This new filter truncates a string to be no longer than the specified\nnumber of characters. Truncated strings end with a translatable ellipsis\nsequence (”…”). See the documentation for truncatechars for\nmore details. static template tag ¶ The staticfiles contrib app has a new static template tag to refer to files saved with the STATICFILES_STORAGE storage backend. It uses the storage backend’s url method and therefore supports advanced features such as serving\nfiles from a cloud service . CachedStaticFilesStorage storage backend ¶ The staticfiles contrib app now has a django.contrib.staticfiles.storage.CachedStaticFilesStorage backend\nthat caches the files it saves (when running the collectstatic management command) by appending the MD5 hash of the file’s content to the\nfilename. For example, the file css/styles.css would also be saved as css/styles.55e7cbb9ba48.css Simple clickjacking protection ¶ We’ve added a middleware to provide easy protection against clickjacking using the X-Frame-Options header. It’s not enabled by default for backwards compatibility reasons, but\nyou’ll almost certainly want to enable it to help\nplug that security hole for browsers that support the header. CSRF improvements ¶ We’ve made various improvements to our CSRF features, including the ensure_csrf_cookie() decorator, which can\nhelp with AJAX-heavy sites; protection for PUT and DELETE requests; and the CSRF_COOKIE_SECURE and CSRF_COOKIE_PATH settings, which can\nimprove the security and usefulness of CSRF protection. See the CSRF\ndocs for more information. Error report filtering ¶ We added two function decorators, sensitive_variables() and sensitive_post_parameters() , to allow\ndesignating the local variables and POST parameters that may contain sensitive\ninformation and should be filtered out of error reports. All POST parameters are now systematically filtered out of error reports for\ncertain views ( login , password_reset_confirm , password_change and add_view in django.contrib.auth.views , as well as user_change_password in the admin app) to prevent the leaking of sensitive\ninformation such as user passwords. You can override or customize the default filtering by writing a custom\nfilter . For more information see the docs on Filtering error reports . Extended IPv6 support ¶ Django 1.4 can now better handle IPv6 addresses with the new GenericIPAddressField model field, GenericIPAddressField form field and\nthe validators validate_ipv46_address and validate_ipv6_address . HTML comparisons in tests ¶ The base classes in django.test now have some helpers to\ncompare HTML without tripping over irrelevant differences in whitespace,\nargument quoting/ordering and closing of self-closing tags. You can either\ncompare HTML directly with the new assertHTMLEqual() and assertHTMLNotEqual() assertions, or use\nthe html=True flag with assertContains() and assertNotContains() to test whether the\nclient’s response contains a given HTML fragment. See the assertions\ndocumentation for more. Two new date format strings ¶ Two new date formats were added for use in template filters,\ntemplate tags and Format localization : e – the name of the timezone of the given datetime object o – the ISO 8601 year number Please make sure to update your custom format files if they contain either e or o in a format\nstring. For example a Spanish localization format previously only escaped the d format character: DATE_FORMAT = r \"j \\de F \\de Y\" But now it needs to also escape e and o : DATE_FORMAT = r \"j \\d\\e F \\d\\e Y\" For more information, see the date documentation. Minor features ¶ Django 1.4 also includes several smaller improvements worth noting: A more usable stacktrace in the technical 500 page. Frames in the\nstack trace that reference Django’s framework code are dimmed out,\nwhile frames in application code are slightly emphasized. This change\nmakes it easier to scan a stacktrace for issues in application code. Tablespace support in PostgreSQL. Customizable names for simple_tag() . In the documentation, a helpful security overview page. The django.contrib.auth.models.check_password function has been moved\nto the django.contrib.auth.hashers module. Importing it from the old\nlocation will still work, but you should update your imports. The collectstatic management command now has a --clear option\nto delete all files at the destination before copying or linking the static\nfiles. It’s now possible to load fixtures containing forward references when using\nMySQL with the InnoDB database engine. A new 403 response handler has been added as 'django.views.defaults.permission_denied' . You can set your own handler by\nsetting the value of django.conf.urls.handler403 . See the\ndocumentation about the 403 (HTTP Forbidden) view for more information. The makemessages command uses a new and more accurate lexer, JsLex , for extracting translatable strings from JavaScript\nfiles. The trans template tag now takes an optional as argument to\nbe able to retrieve a translation string without displaying it but setting\na template context variable instead. The if template tag now supports {% elif %} clauses. If your Django app is behind a proxy, you might find the new SECURE_PROXY_SSL_HEADER setting useful. It solves the problem of your\nproxy “eating” the fact that a request came in via HTTPS. But only use this\nsetting if you know what you’re doing. A new, plain-text, version of the HTTP 500 status code internal error page\nserved when DEBUG is True is now sent to the client when\nDjango detects that the request has originated in JavaScript code.\n( is_ajax() is used for this.) Like its HTML counterpart, it contains a collection of different\npieces of information about the state of the application. This should make it easier to read when debugging interaction with\nclient-side JavaScript. Added the makemessages --no-location option. Changed the locmem cache backend to use pickle.HIGHEST_PROTOCOL for better compatibility with the other\ncache backends. Added support in the ORM for generating SELECT queries containing DISTINCT ON . The distinct() QuerySet method now accepts an optional list of model\nfield names. If specified, then the DISTINCT statement is limited to these\nfields. This is only supported in PostgreSQL. For more details, see the documentation for distinct() . The admin login page will add a password reset link if you include a URL with\nthe name 'admin_password_reset' in your urls.py , so plugging in the\nbuilt-in password reset mechanism and making it available is now much easier.\nFor details, see Adding a password reset feature . The MySQL database backend can now make use of the savepoint feature\nimplemented by MySQL version 5.0.3 or newer with the InnoDB storage engine. It’s now possible to pass initial values to the model forms that are part of\nboth model formsets and inline model formsets as returned from factory\nfunctions modelformset_factory and inlineformset_factory respectively\njust like with regular formsets. However, initial values only apply to extra\nforms, i.e. those which are not bound to an existing model instance. The sitemaps framework can now handle HTTPS links using the new Sitemap.protocol class\nattribute. A new django.test.SimpleTestCase subclass of unittest.TestCase that’s lighter than django.test.TestCase and company. It can be\nuseful in tests that don’t need to hit a database. See Hierarchy of Django unit testing classes . Backwards incompatible changes in 1.4 ¶ SECRET_KEY setting is required ¶ Running Django with an empty or known SECRET_KEY disables many of\nDjango’s security protections and can lead to remote-code-execution\nvulnerabilities. No Django site should ever be run without a SECRET_KEY . In Django 1.4, starting Django with an empty SECRET_KEY will raise a DeprecationWarning . In Django 1.5, it will raise an exception and Django\nwill refuse to start. This is slightly accelerated from the usual deprecation\npath due to the severity of the consequences of running Django with no SECRET_KEY . django.contrib.admin ¶ The included administration app django.contrib.admin has for a long time\nshipped with a default set of static files such as JavaScript, images and\nstylesheets. Django 1.3 added a new contrib app django.contrib.staticfiles to handle such files in a generic way and defined conventions for static\nfiles included in apps. Starting in Django 1.4, the admin’s static files also follow this\nconvention, to make the files easier to deploy. In previous versions of Django,\nit was also common to define an ADMIN_MEDIA_PREFIX setting to point to the\nURL where the admin’s static files live on a web server. This setting has now\nbeen deprecated and replaced by the more general setting STATIC_URL .\nDjango will now expect to find the admin static files under the URL <STATIC_URL>/admin/ . If you’ve previously used a URL path for ADMIN_MEDIA_PREFIX (e.g. /media/ ) simply make sure STATIC_URL and STATIC_ROOT are configured and your web server serves those files correctly. The\ndevelopment server continues to serve the admin files just like before. Read\nthe static files howto for more details. If your ADMIN_MEDIA_PREFIX is set to a specific domain (e.g. http://media.example.com/admin/ ), make sure to also set your STATIC_URL setting to the correct URL – for example, http://media.example.com/ . Warning If you’re implicitly relying on the path of the admin static files within\nDjango’s source code, you’ll need to update that path. The files were moved\nfrom django/contrib/admin/media/ to django/contrib/admin/static/admin/ . Supported browsers for the admin ¶ Django hasn’t had a clear policy on which browsers are supported by the\nadmin app. Our new policy formalizes existing practices: YUI’s A-grade browsers should provide a fully-functional admin experience, with the notable\nexception of Internet Explorer 6, which is no longer supported. Released over 10 years ago, IE6 imposes many limitations on modern web\ndevelopment. The practical implications of this policy are that contributors\nare free to improve the admin without consideration for these limitations. This new policy has no impact on sites you develop using Django. It only\napplies to the Django admin. Feel free to develop apps compatible with any\nrange of browsers. Removed admin icons ¶ As part of an effort to improve the performance and usability of the admin’s\nchange-list sorting interface and horizontal and vertical “filter” widgets, some icon\nfiles were removed and grouped into two sprite files. Specifically: selector-add.gif , selector-addall.gif , selector-remove.gif , selector-removeall.gif , selector_stacked-add.gif and selector_stacked-remove.gif were\ncombined into selector-icons.gif ; and arrow-up.gif and arrow-down.gif were combined into sorting-icons.gif . If you used those icons to customize the admin, then you’ll need to replace\nthem with your own icons or get the files from a previous release. CSS class names in admin forms ¶ To avoid conflicts with other common CSS class names (e.g. “button”), we added\na prefix (“field-”) to all CSS class names automatically generated from the\nform field names in the main admin forms, stacked inline forms and tabular\ninline cells. You’ll need to take that prefix into account in your custom\nstyle sheets or JavaScript files if you previously used plain field names as\nselectors for custom styles or JavaScript transformations. Compatibility with old signed data ¶ Django 1.3 changed the cryptographic signing mechanisms used in a number of\nplaces in Django. While Django 1.3 kept fallbacks that would accept hashes\nproduced by the previous methods, these fallbacks are removed in Django 1.4. So, if you upgrade to Django 1.4 directly from 1.2 or earlier, you may\nlose/invalidate certain pieces of data that have been cryptographically signed\nusing an old method. To avoid this, use Django 1.3 first for a period of time\nto allow the signed data to expire naturally. The affected parts are detailed\nbelow, with 1) the consequences of ignoring this advice and 2) the amount of\ntime you need to run Django 1.3 for the data to expire or become irrelevant. contrib.sessions data integrity check Consequences: The user will be logged out, and session data will be lost. Time period: Defined by SESSION_COOKIE_AGE . contrib.auth password reset hash Consequences: Password reset links from before the upgrade will not work. Time period: Defined by PASSWORD_RESET_TIMEOUT_DAYS . Form-related hashes: these have a much shorter lifetime and are relevant\nonly for the short window where a user might fill in a form generated by the\npre-upgrade Django instance and try to submit it to the upgraded Django\ninstance: contrib.comments form security hash Consequences: The user will see the validation error “Security hash failed.” Time period: The amount of time you expect users to take filling out comment\nforms. FormWizard security hash Consequences: The user will see an error about the form having expired\nand will be sent back to the first page of the wizard, losing the data\nentered so far. Time period: The amount of time you expect users to take filling out the\naffected forms. CSRF check Note: This is actually a Django 1.1 fallback, not Django 1.2,\nand it applies only if you’re upgrading from 1.1. Consequences: The user will see a 403 error with any CSRF-protected POST\nform. Time period: The amount of time you expect user to take filling out\nsuch forms. contrib.auth user password hash-upgrade sequence Consequences: Each user’s password will be updated to a stronger password\nhash when it’s written to the database in 1.4. This means that if you\nupgrade to 1.4 and then need to downgrade to 1.3, version 1.3 won’t be able\nto read the updated passwords. Remedy: Set PASSWORD_HASHERS to use your original password\nhashing when you initially upgrade to 1.4. After you confirm your app works\nwell with Django 1.4 and you won’t have to roll back to 1.3, enable the new\npassword hashes. django.contrib.flatpages ¶ Starting in 1.4, the FlatpageFallbackMiddleware only\nadds a trailing slash and redirects if the resulting URL refers to an existing\nflatpage. For example, requesting /notaflatpageoravalidurl in a previous\nversion would redirect to /notaflatpageoravalidurl/ , which would\nsubsequently raise a 404. Requesting /notaflatpageoravalidurl now will\nimmediately raise a 404. Also, redirects returned by flatpages are now permanent (with 301 status code),\nto match the behavior of CommonMiddleware . Serialization of datetime and time ¶ As a consequence of time-zone support, and according to the ECMA-262\nspecification, we made changes to the JSON serializer: It includes the time zone for aware datetime objects. It raises an exception\nfor aware time objects. It includes milliseconds for datetime and time objects. There is still\nsome precision loss, because Python stores microseconds (6 digits) and JSON\nonly supports milliseconds (3 digits). However, it’s better than discarding\nmicroseconds entirely. We changed the XML serializer to use the ISO8601 format for datetimes.\nThe letter T is used to separate the date part from the time part, instead\nof a space. Time zone information is included in the [+-]HH:MM format. Though the serializers now use these new formats when creating fixtures, they\ncan still load fixtures that use the old format. supports_timezone changed to False for SQLite ¶ The database feature supports_timezone used to be True for SQLite.\nIndeed, if you saved an aware datetime object, SQLite stored a string that\nincluded an UTC offset. However, this offset was ignored when loading the value\nback from the database, which could corrupt the data. In the context of time-zone support, this flag was changed to False , and\ndatetimes are now stored without time-zone information in SQLite. When USE_TZ is False , if you attempt to save an aware datetime\nobject, Django raises an exception. MySQLdb -specific exceptions ¶ The MySQL backend historically has raised MySQLdb.OperationalError when a query triggered an exception. We’ve fixed this bug, and we now raise django.db.DatabaseError instead. If you were testing for MySQLdb.OperationalError , you’ll need to update your except clauses. Database connection’s thread-locality ¶ DatabaseWrapper objects (i.e. the connection objects referenced by django.db.connection and django.db.connections[\"some_alias\"] ) used to\nbe thread-local. They are now global objects in order to be potentially shared\nbetween multiple threads. While the individual connection objects are now\nglobal, the django.db.connections dictionary referencing those objects is\nstill thread-local. Therefore if you just use the ORM or DatabaseWrapper.cursor() then the behavior is still the same as before.\nNote, however, that django.db.connection does not directly reference the\ndefault DatabaseWrapper object anymore and is now a proxy to access that\nobject’s attributes. If you need to access the actual DatabaseWrapper object, use django.db.connections[DEFAULT_DB_ALIAS] instead. As part of this change, all underlying SQLite connections are now enabled for\npotential thread-sharing (by passing the check_same_thread=False attribute\nto pysqlite ). DatabaseWrapper however preserves the previous behavior\nby disabling thread-sharing by default, so this does not affect any existing\ncode that purely relies on the ORM or on DatabaseWrapper.cursor() . Finally, while it’s now possible to pass connections between threads, Django\ndoesn’t make any effort to synchronize access to the underlying backend.\nConcurrency behavior is defined by the underlying backend implementation.\nCheck their documentation for details. COMMENTS_BANNED_USERS_GROUP setting ¶ Django’s comments has historically\nsupported excluding the comments of a special user group, but we’ve never\ndocumented the feature properly and didn’t enforce the exclusion in other parts\nof the app such as the template tags. To fix this problem, we removed the code\nfrom the feed class. If you rely on the feature and want to restore the old behavior, use a custom\ncomment model manager to exclude the user group, like this: from django.conf import settings from django.contrib.comments.managers import CommentManager class BanningCommentManager ( CommentManager ): def get_query_set ( self ): qs = super () . get_query_set () if getattr ( settings , \"COMMENTS_BANNED_USERS_GROUP\" , None ): where = [ \"user_id NOT IN (SELECT user_id FROM auth_user_groups WHERE group_id = %s )\" ] params = [ settings . COMMENTS_BANNED_USERS_GROUP ] qs = qs . extra ( where = where , params = params ) return qs Save this model manager in your custom comment app (e.g., in my_comments_app/managers.py ) and add it your custom comment app model: from django.db import models from django.contrib.comments.models import Comment from my_comments_app.managers import BanningCommentManager class CommentWithTitle ( Comment ): title = models . CharField ( max_length = 300 ) objects = BanningCommentManager () IGNORABLE_404_STARTS and IGNORABLE_404_ENDS settings ¶ Until Django 1.3, it was possible to exclude some URLs from Django’s 404 error reporting by adding prefixes to IGNORABLE_404_STARTS and suffixes to IGNORABLE_404_ENDS . In Django 1.4, these two settings are superseded by IGNORABLE_404_URLS , which is a list of compiled regular\nexpressions. Django won’t send an email for 404 errors on URLs that match any\nof them. Furthermore, the previous settings had some rather arbitrary default values: IGNORABLE_404_STARTS = ( \"/cgi-bin/\" , \"/_vti_bin\" , \"/_vti_inf\" ) IGNORABLE_404_ENDS = ( \"mail.pl\" , \"mailform.pl\" , \"mail.cgi\" , \"mailform.cgi\" , \"favicon.ico\" , \".php\" , ) It’s not Django’s role to decide if your website has a legacy /cgi-bin/ section or a favicon.ico . As a consequence, the default values of IGNORABLE_404_URLS , IGNORABLE_404_STARTS , and IGNORABLE_404_ENDS are all now empty. If you have customized IGNORABLE_404_STARTS or IGNORABLE_404_ENDS , or\nif you want to keep the old default value, you should add the following lines\nin your settings file: import re IGNORABLE_404_URLS = ( # for each <prefix> in IGNORABLE_404_STARTS re . compile ( r \"^<prefix>\" ), # for each <suffix> in IGNORABLE_404_ENDS re . compile ( r \"<suffix>$\" ), ) Don’t forget to escape characters that have a special meaning in a regular\nexpression, such as periods. CSRF protection extended to PUT and DELETE ¶ Previously, Django’s CSRF protection provided\nprotection only against POST requests. Since use of PUT and DELETE methods in\nAJAX applications is becoming more common, we now protect all methods not\ndefined as safe by RFC 2616 – i.e., we exempt GET, HEAD, OPTIONS and TRACE,\nand we enforce protection on everything else. If you’re using PUT or DELETE methods in AJAX applications, please see the instructions about using AJAX and CSRF . Password reset view now accepts subject_template_name ¶ The password_reset view in django.contrib.auth now accepts a subject_template_name parameter, which is passed to the password save form\nas a keyword argument. If you are using this view with a custom password reset\nform, then you will need to ensure your form’s save() method accepts this\nkeyword argument. django.core.template_loaders ¶ This was an alias to django.template.loader since 2005, and we’ve removed it\nwithout emitting a warning due to the length of the deprecation. If your code\nstill referenced this, please use django.template.loader instead. django.db.models.fields.URLField.verify_exists ¶ This functionality has been removed due to intractable performance and\nsecurity issues. Any existing usage of verify_exists should be\nremoved. django.core.files.storage.Storage.open ¶ The open method of the base Storage class used to take an obscure parameter mixin that allowed you to dynamically change the base classes of the\nreturned file object. This has been removed. In the rare case you relied on the mixin parameter, you can easily achieve the same by overriding the open method, like this: from django.core.files import File from django.core.files.storage import FileSystemStorage class Spam ( File ): \"\"\" Spam, spam, spam, spam and spam. \"\"\" def ham ( self ): return \"eggs\" class SpamStorage ( FileSystemStorage ): \"\"\" A custom file storage backend. \"\"\" def open ( self , name , mode = \"rb\" ): return Spam ( open ( self . path ( name ), mode )) YAML deserializer now uses yaml.safe_load ¶ yaml.load is able to construct any Python object, which may trigger\narbitrary code execution if you process a YAML document that comes from an\nuntrusted source. This feature isn’t necessary for Django’s YAML deserializer,\nwhose primary use is to load fixtures consisting of simple objects. Even though\nfixtures are trusted data, the YAML deserializer now uses yaml.safe_load for additional security. Session cookies now have the httponly flag by default ¶ Session cookies now include the httponly attribute by default to\nhelp reduce the impact of potential XSS attacks. As a consequence of\nthis change, session cookie data, including sessionid , is no longer\naccessible from JavaScript in many browsers. For strict backwards\ncompatibility, use SESSION_COOKIE_HTTPONLY = False in your\nsettings file. The urlize filter no longer escapes every URL ¶ When a URL contains a %xx sequence, where xx are two hexadecimal\ndigits, urlize now assumes that the URL is already escaped and\ndoesn’t apply URL escaping again. This is wrong for URLs whose unquoted form\ncontains a %xx sequence, but such URLs are very unlikely to happen in the\nwild, because they would confuse browsers too. assertTemplateUsed and assertTemplateNotUsed as context manager ¶ It’s now possible to check whether a template was used within a block of\ncode with assertTemplateUsed() and assertTemplateNotUsed() . And they\ncan be used as a context manager: with self . assertTemplateUsed ( \"index.html\" ): render_to_string ( \"index.html\" ) with self . assertTemplateNotUsed ( \"base.html\" ): render_to_string ( \"index.html\" ) See the assertion documentation for more. Database connections after running the test suite ¶ The default test runner no longer restores the database connections after\ntests’ execution. This prevents the production database from being exposed to\npotential threads that would still be running and attempting to create new\nconnections. If your code relied on connections to the production database being created\nafter tests’ execution, then you can restore the previous behavior by\nsubclassing DjangoTestRunner and overriding its teardown_databases() method. Output of manage.py help ¶ manage.py help now groups available commands by application.\nIf you depended on the output of this command – if you parsed it, for example\n– then you’ll need to update your code. To get a list of all available\nmanagement commands in a script, use manage.py help --commands instead. extends template tag ¶ Previously, the extends tag used a buggy method of parsing arguments,\nwhich could lead to it erroneously considering an argument as a string literal\nwhen it wasn’t. It now uses parser.compile_filter , like other tags. The internals of the tag aren’t part of the official stable API, but in the\ninterests of full disclosure, the ExtendsNode.__init__ definition has\nchanged, which may break any custom tags that use this class. Loading some incomplete fixtures no longer works ¶ Prior to 1.4, a default value was inserted for fixture objects that were missing\na specific date or datetime value when auto_now or auto_now_add was set for the\nfield. This was something that should not have worked, and in 1.4 loading such\nincomplete fixtures will fail. Because fixtures are a raw import, they should\nexplicitly specify all field values, regardless of field options on the model. Development Server Multithreading ¶ The development server is now is multithreaded by default. Use the runserver --nothreading option to disable the use of threading in the\ndevelopment server: django-admin.py runserver --nothreading Attributes disabled in markdown when safe mode set ¶ Prior to Django 1.4, attributes were included in any markdown output regardless\nof safe mode setting of the filter. With version > 2.1 of the Python-Markdown\nlibrary, an enable_attributes option was added. When the safe argument is\npassed to the markdown filter, both the safe_mode=True and enable_attributes=False options are set. If using a version of the\nPython-Markdown library less than 2.1, a warning is issued that the output is\ninsecure. FormMixin get_initial returns an instance-specific dictionary ¶ In Django 1.3, the get_initial method of the django.views.generic.edit.FormMixin class was returning the\nclass initial dictionary. This has been fixed to return a copy of this\ndictionary, so form instances can modify their initial data without messing\nwith the class variable. Features deprecated in 1.4 ¶ Old styles of calling cache_page decorator ¶ Some legacy ways of calling cache_page() have been deprecated. Please see the documentation for the correct way to use\nthis decorator. Support for PostgreSQL versions older than 8.2 ¶ Django 1.3 dropped support for PostgreSQL versions older than 8.0, and we\nsuggested using a more recent version because of performance improvements\nand, more importantly, the end of upstream support periods for 8.0 and 8.1\nwas near (November 2010). Django 1.4 takes that policy further and sets 8.2 as the minimum PostgreSQL\nversion it officially supports. Request exceptions are now always logged ¶ When we added logging support in Django in 1.3, the\nadmin error email support was moved into the django.utils.log.AdminEmailHandler , attached to the 'django.request' logger. In order to maintain the established behavior of\nerror emails, the 'django.request' logger was called only when DEBUG was False . To increase the flexibility of error logging for requests, the 'django.request' logger is now called regardless of the value of DEBUG , and the default settings file for new projects now includes a\nseparate filter attached to django.utils.log.AdminEmailHandler to\nprevent admin error emails in DEBUG mode: LOGGING = { # ... \"filters\" : { \"require_debug_false\" : { \"()\" : \"django.utils.log.RequireDebugFalse\" , } }, \"handlers\" : { \"mail_admins\" : { \"level\" : \"ERROR\" , \"filters\" : [ \"require_debug_false\" ], \"class\" : \"django.utils.log.AdminEmailHandler\" , } }, } If your project was created prior to this change, your LOGGING setting will not include this new filter. In order to maintain\nbackwards-compatibility, Django will detect that your 'mail_admins' handler\nconfiguration includes no 'filters' section and will automatically add\nthis filter for you and issue a pending-deprecation warning. This will become a\ndeprecation warning in Django 1.5, and in Django 1.6 the\nbackwards-compatibility shim will be removed entirely. The existence of any 'filters' key under the 'mail_admins' handler will\ndisable this backward-compatibility shim and deprecation warning. django.conf.urls.defaults ¶ Until Django 1.3, the include() , patterns() , and url() functions,\nplus handler404 and handler500 were located in a django.conf.urls.defaults module. In Django 1.4, they live in django.conf.urls . django.contrib.databrowse ¶ Databrowse has not seen active development for some time, and this does not show\nany sign of changing. There had been a suggestion for a GSOC project to\nintegrate the functionality of databrowse into the admin, but no progress was\nmade. While Databrowse has been deprecated, an enhancement of django.contrib.admin providing a similar feature set is still possible. The code that powers Databrowse is licensed under the same terms as Django\nitself, so it’s available to be adopted by an individual or group as\na third-party project. django.core.management.setup_environ ¶ This function temporarily modified sys.path in order to make the parent\n“project” directory importable under the old flat startproject layout. This function is now deprecated, as its path workarounds are no longer\nneeded with the new manage.py and default project layout. This function was never documented or part of the public API, but it was widely\nrecommended for use in setting up a “Django environment” for a user script.\nThese uses should be replaced by setting the DJANGO_SETTINGS_MODULE environment variable or using django.conf.settings.configure() . django.core.management.execute_manager ¶ This function was previously used by manage.py to execute a management\ncommand. It is identical to django.core.management.execute_from_command_line , except that it first\ncalls setup_environ , which is now deprecated. As such, execute_manager is also deprecated; execute_from_command_line can be used instead. Neither\nof these functions is documented as part of the public API, but a deprecation\npath is needed due to use in existing manage.py files. is_safe and needs_autoescape attributes of template filters ¶ Two flags, is_safe and needs_autoescape , define how each template filter\ninteracts with Django’s auto-escaping behavior. They used to be attributes of\nthe filter function: @register . filter def noop ( value ): return value noop . is_safe = True However, this technique caused some problems in combination with decorators,\nespecially @stringfilter .\nNow, the flags are keyword arguments of @register.filter : @register . filter ( is_safe = True ) def noop ( value ): return value See filters and auto-escaping for more information. Wildcard expansion of application names in INSTALLED_APPS ¶ Until Django 1.3, INSTALLED_APPS accepted wildcards in application\nnames, like django.contrib.* . The expansion was performed by a\nfilesystem-based implementation of from <package> import * . Unfortunately,\nthis can’t be done reliably. This behavior was never documented. Since it is unpythonic, it was removed in\nDjango 1.4. If you relied on it, you must edit your settings file to list all\nyour applications explicitly. HttpRequest.raw_post_data renamed to HttpRequest.body ¶ This attribute was confusingly named HttpRequest.raw_post_data , but it\nactually provided the body of the HTTP request. It’s been renamed to HttpRequest.body , and HttpRequest.raw_post_data has been deprecated. django.contrib.sitemaps bug fix with potential performance implications ¶ In previous versions, Paginator objects used in sitemap classes were\ncached, which could result in stale site maps. We’ve removed the caching, so\neach request to a site map now creates a new Paginator object and calls the items() method of the Sitemap subclass. Depending on what your items() method is doing, this may have a negative performance impact.\nTo mitigate the performance impact, consider using the caching\nframework within your Sitemap subclass. Versions of Python-Markdown earlier than 2.1 ¶ Versions of Python-Markdown earlier than 2.1 do not support the option to\ndisable attributes. As a security issue, earlier versions of this library will\nnot be supported by the markup contrib app in 1.5 under an accelerated\ndeprecation timeline.", "keywords": ["simple_tag", "\\d\\e", "users", "feed", "ham", "rows", "feature", "usefulness", "storage", "stability", "login", "my_tag", "validate_ipv6_address", "b", "formsets", "auth_user_groups", "corruption", "library", "flatpages", "field", "#", "django.db.connections[\"some_alias", "runner", "validate_ipv46_address", "serialization", "eggs", "get_ordering", "text", "+", "django_settings_module", "stores", "meaning", "emails", "howto", "user_change_password", "range", "lines", "cache", "compatibility", "sha1", "django.db.connections", "change", "https", "literal", "http://media.example.com/", "links", "ignorable_404_urls", "suite", "django.core.template_loaders", "django.conf.settings.configure", "shim", "stacktrace", "destination", "hash", "http", "changes", "=", "head", "engine", "message", "formwizard", "managers.py", "lexer", "fact", "character", "password_change", "date_format", "setup", "tag", "contributors", "filesystem", "sorts", "button", "zones", "django.utils.translation.ugettext_lazy", "argv", "batch", "ajax", "spamstorage", "genericforeignkey", "hashing", "hole", "process", "places", "fallback", "debug", "safe_mode", "wrapping", "mysite.settings", "queryset.prefetch_related", "collection", "interactions", "administration", "savepoint", "serializers", "people", "custom", "kwargs", "usability", "objects", "documentation", "lookups", "flatpagefallbackmiddleware", "databasewrapper.cursor", "file", "implications", "customization", "cells", "layout", "bulk_create", "spam", "modules", "exclusion", "fix", "reversals", "strategy", "latter", "user", "init__.py", "selector-add.gif", "fragment", "handler404", "attribute", "helper", "args", "mechanism", "pickle", "multithreading", "warning", "icons", "verify_exists", "time", "styles", "mm", "tags", "save", "date", "clickjacking", "startapp", "setting", "ignorable_404_ends", "faq", "add_view", "account", "service", "leaking", "interacts", "databrowse", "/_vti_bin", "password", "csrf_cookie_secure", "individual", "name", "parameter", "interests", "selector-addall.gif", "execution", "world", "flags", "impact", "backends", "reference", "project_name", "web", "django.contrib.auth", "escaping", "issue", "upgrade", "problems", "versions", "django.contrib.formtools", "queries", "simpletestcase", "dst", "manager", "check_same_thread", "django.contrib.admin", "select_for_update", "uses", "slug_url_kwarg", "addresses", "return", "reverse", "frames", "applications", "static_url", "django.contrib.comments.managers", "handlers", "expressions", "transitions", "consideration", "use_tz", "parent", "letter", "@register.filter", "examples", "django.contrib.staticfiles", "additions", "/notaflatpageoravalidurl/", "commonmiddleware", "locmem", "django.contrib.auth.models.check_password", "setdefault", "status", "relationships", "plan", "interoperability", "abcd", "proxy", "space", "url", "error", "module", "code", "base.html", "databasewrapper", "algorithm", "period", "auth", "pages", "filter", "style", "behavior", "false", "link", "display", "migration", "class", "manage.py", "access", "speeds", "workarounds", "milliseconds", "ignorable_404_starts", "group", "customizing", "iso8601", "names", "javascript", "x", "pbkdf2", "years", "request", "mysqldb", "myproject.settings", "database", "flag", "block", "django.conf.urls.handler403", "output", "*", "query", "page", "test", "commands", "postgresql", "stylesheets", "selector-removeall.gif", "index.html", "strings", "elements", "threading", "subclass", "wsgi_application", "wild", "admin", "creation", "admin/", "datasets", "book.title", "usage", "mixin", "xml", "my_project_template", "wsgi", "configuration", "forbidden", "effort", "step", "script", "max_length", "thread", "role", "validation", "advice", "flexibility", "truncatechars", "disclosure", "limitations", "include", "running", "e", "section", "sheets", "djangotestrunner", "developer", "suffix", "source", "specification", "sequence", "staticfiles_storage", "cachedstaticfilesstorage", "css", "use", "environment", "november", "clarification", "static_root", "adminemailhandler", "a", "imports", "selector_stacked-remove.gif", "performance", "protection", "wildcards", "releases", "genericipaddressfield", "sensitive_variables", "order", "j", "params", "default", "httprequest.body", "sharing", "--nothreading", "doctype", "django.test", "get_list_display_links", "alias", "bug", "comment", "form", "prefix", "option", "format", "/cgi", "classes", "characters", "tests", "locality", "expression", "help", "environ", "convention", "bcrypt", "mail_admins", "browsers", "fixture", "timezone", "styles.css", "commentmanager", "f", "contrib.auth", "getattr", "company", "existence", "combination", "timestamps", "template", "sys.path", "header", "interaction", "way", "xx", "internet", "frameworks", "formats", "django.contrib.auth.views", "servers", "protections", "comments", "t", "user_id", "microseconds", "party", "queryset", "periods", "session", "group_id", "o", "reports", "¶", "command", "templatesyntaxerror", "internationalization", "django.conf.urls.defaults", "post", "parameters", "commentwithtitle", "precision", "side", "suites", "assertcontains", "content", "function", "selector-remove.gif", "django.template.loader", "views", "testing", "result", "view", "integrity", "zone", "simple", "number", "lot", "singleobjectmixin", "yui", "maps", "permissions", "fallbacks", "def", "point", "datetimes", "values", "staticfiles", "admin_media_prefix", "django.contrib", "[", "string", "session_cookie_age", "_", "urls.py", "env", "overview", "timeline", "databaseerror", "my_comments_app", "auto", "connections", "trouble", "gsoc", "unit", "location", "nist", "language", "models", "copy", "require_debug_false", "ipv6", "version", "ways", "level", "json", "prefixes", "yaml", "loading", "deserializer", "processor", "handler500", "counterpart", "tablespace", "deprecation", "get_list_display", "minimum", "sort", "django", "on", "session_cookie_httponly", "urlpattern", "myapp", "banningcommentmanager", "profile", "n’t", "filename", "pk_url_kwarg", "rfc", "fields", "disable", "password_hashers", "bin/", "set", "my_comments_app.managers", "development", "operating", "value", "legacy", "sorting-icons.gif", "assertion", "^<prefix", "mysite.urls", "policy", "hierarchy", "flatpage", "columns", "data", "browser", "implementation", "extendsnode.__init", "scope", "handler", "datetime", "lifetime", "base", "backend", "guide", "django.core.management.execute_from_command_line", "inline", "assertions", "security", "magic", "contrib.comments", "get_initial", "paths", "need", "instance", "self", "today", "execute_manager", "localization", "makemessages", "django.views.generic.edit", "handling", "interface", "consequence", "sitemaps", "mechanisms", "validators", "portability", "|", "report", "modeladmin", "trace", "respect", "severity", "\\de", "static_url>/admin/", "functionality", "markdown", "suffix>$", "bugs", "closing", "docs", "issues", "decorator", "digits", "noop", "joins", "needs_autoescape", "instances", "deprecationwarning", "iso", "sensitive_post_parameters", "statement", "i18n_patterns", "jslex", "execute_from_command_line", "areas", "part", "fixtures", "filesystemstorage", "references", "object", "load", "teardown_databases", "march", "deployment", "/media/", "domain", "charfield", "management", "response", "operationalerror", "sys", "django.contrib.auth.hashers", "website", "internals", "sql", "whitespace", "dictionary", "instructions", "vendors", "requests", "reset", "consequences", "terms", "ie6", "rendering", "keyword", "arrow-up.gif", "selector_stacked-add.gif", "csrf", "django.utils.log", "ordering", "logger", "cache_page", "yaml.safe_load", "variables", "integration", "decorators", "inclusion_tag", "notes", "system", "apps", "runfcgi", "django.contrib.staticfiles.storage", "practices", "remedy", "manner", "urlfield.verify_exists", "clauses", "sessionid", "filtering", "signing", "o(n", "welcome", "password_reset_timeout_days", "items", "innodb", "production", "widgets", "comparisons", "serializer", "definition", "5.0.3", "headers", "-specific", "slash", "django.db.connection", "check", "html5", "features", "forms", "site", "styles.55e7cbb9ba48.css", "explorer", "get_query_set", "example", "care", "subject_template_name", "app", "window", "progress", "list", "pieces", "loss", "orm", "utc", "runserver", "secure_proxy_ssl_header", "is_safe", "email", "enhancement", "stack", "re", "icon", "map", "paginator", "md5", "model", "variable", "password_reset_confirm", "hashes", "wizard", "year", "reasons", "guis", "timezones", "callable", "urlconfs", "bin", "application", "inlineformset_factory", "asserttemplatenotused", "actions", "conflicts", "increases", "attributes", "@stringfilter", "formmixin", "testcase", "title", "release", "ability", "encounter", "differences", "redirects", "urlconf", "y", "ensure_csrf_cookie", "django-admin.py", "translation", "syntax", "r", "select", "benefit", "admin_password_reset", "assertnotcontains", "case", "sitemap.protocol", "length", "experience", "lookup", "assignment", "suggestion", "enable_attributes", "technique", "html", "errors", "is_ajax", "server", "factory", "arguments", "conventions", "django.conf.urls", "passwords", "package", "static", "middleware", "xss", "end", "improvements", "contrib", "sqlite", "startproject", "arrow-down.gif", "django.contrib.comments.models", "delete", "secret_key", "assignment_tag", "grade", "amount", "django.db.connections[default_db_alias", "validity", "mailform.cgi", "helpers", "path", "functions", "key", "operations", "trans", "update", "none", "selectors", "filters", "problem", "improved", "sign", "get", "patterns", "concurrency", "logging", "asserthtmlnotequal", "framework", "new", "true", "django.core.management.execute_manager", "sitemap", "urls", "caching", "api", "parts", "support", "cookies", "mode", "projects", "document", "transactions", "yaml.load", "myproject.urls", "connection", "transformations", "context", "filterspec", "permission", "offset", "threads", "import", "files", "blocktrans", "put", "mysql", "directory", "%", "compile", "information", "distinct", "images", "python", "ellipsis", "methods", "options", "optional", "times", "exception", "extends", "upgrading", "client", "details", "method", "django.db", "settings", "ships", "argument", "transaction", "list_filter", "cookie", "note", "sites", "state", "body", "attacks", "tools", "mysite.myapp", "asserthtmlequal", "django.core.files", "vulnerabilities", "/path", "highest_protocol", "templates", "pointers", "expansion", "selenium", "contrib.sessions", "project", "exceptions"], "type": "documentation"},
{"title": "Writing your first Django app, part 2 | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/intro/tutorial02/", "content": "Writing your first Django app, part 2 ¶ This tutorial begins where Tutorial 1 left off.\nWe’ll set up the database, create your first model, and get a quick\nintroduction to Django’s automatically-generated admin site. Where to get help: If you’re having trouble going through this tutorial, please head over to\nthe Getting Help section of the FAQ. Database setup ¶ Now, open up mysite/settings.py . It’s a normal Python module with\nmodule-level variables representing Django settings. By default, the DATABASES configuration uses SQLite. If you’re new\nto databases, or you’re just interested in trying Django, this is the easiest\nchoice. SQLite is included in Python, so you won’t need to install anything\nelse to support your database. When starting your first real project, however,\nyou may want to use a more scalable database like PostgreSQL, to avoid\ndatabase-switching headaches down the road. If you wish to use another database, see details to customize and get\nyour database running . While you’re editing mysite/settings.py , set TIME_ZONE to\nyour time zone. Also, note the INSTALLED_APPS setting at the top of the file. That\nholds the names of all Django applications that are activated in this Django\ninstance. Apps can be used in multiple projects, and you can package and\ndistribute them for use by others in their projects. By default, INSTALLED_APPS contains the following apps, all of which\ncome with Django: django.contrib.admin – The admin site. You’ll use it shortly. django.contrib.auth – An authentication system. django.contrib.contenttypes – A framework for content types. django.contrib.sessions – A session framework. django.contrib.messages – A messaging framework. django.contrib.staticfiles – A framework for managing\nstatic files. These applications are included by default as a convenience for the common case. Some of these applications make use of at least one database table, though,\nso we need to create the tables in the database before we can use them. To do\nthat, run the following command: /  $ python manage.py migrate ...\\> py manage.py migrate The migrate command looks at the INSTALLED_APPS setting\nand creates any necessary database tables according to the database settings\nin your mysite/settings.py file and the database migrations shipped\nwith the app (we’ll cover those later). You’ll see a message for each\nmigration it applies. If you’re interested, run the command-line client for your\ndatabase and type \\dt (PostgreSQL), SHOW TABLES; (MariaDB, MySQL), .tables (SQLite), or SELECT TABLE_NAME FROM USER_TABLES; (Oracle) to\ndisplay the tables Django created. For the minimalists Like we said above, the default applications are included for the common\ncase, but not everybody needs them. If you don’t need any or all of them,\nfeel free to comment-out or delete the appropriate line(s) from INSTALLED_APPS before running migrate . The migrate command will only run migrations for apps in INSTALLED_APPS . Creating models ¶ Now we’ll define your models – essentially, your database layout, with\nadditional metadata. Philosophy A model is the single, definitive source of information about your data. It\ncontains the essential fields and behaviors of the data you’re storing.\nDjango follows the DRY Principle . The goal is to define your\ndata model in one place and automatically derive things from it. This includes the migrations - unlike in Ruby On Rails, for example, migrations\nare entirely derived from your models file, and are essentially a\nhistory that Django can roll through to update your database schema to\nmatch your current models. In our poll app, we’ll create two models: Question and Choice . A Question has a question and a publication date. A Choice has two\nfields: the text of the choice and a vote tally. Each Choice is associated\nwith a Question . These concepts are represented by Python classes. Edit the polls/models.py file so it looks like this: polls/models.py ¶ from django.db import models class Question ( models . Model ): question_text = models . CharField ( max_length = 200 ) pub_date = models . DateTimeField ( \"date published\" ) class Choice ( models . Model ): question = models . ForeignKey ( Question , on_delete = models . CASCADE ) choice_text = models . CharField ( max_length = 200 ) votes = models . IntegerField ( default = 0 ) Here, each model is represented by a class that subclasses django.db.models.Model . Each model has a number of class variables,\neach of which represents a database field in the model. Each field is represented by an instance of a Field class – e.g., CharField for character fields and DateTimeField for datetimes. This tells Django what\ntype of data each field holds. The name of each Field instance (e.g. question_text or pub_date ) is the field’s name, in machine-friendly\nformat. You’ll use this value in your Python code, and your database will use\nit as the column name. You can use an optional first positional argument to a Field to designate a human-readable name. That’s used\nin a couple of introspective parts of Django, and it doubles as documentation.\nIf this field isn’t provided, Django will use the machine-readable name. In this\nexample, we’ve only defined a human-readable name for Question.pub_date .\nFor all other fields in this model, the field’s machine-readable name will\nsuffice as its human-readable name. Some Field classes have required arguments. CharField , for example, requires that you give it a max_length . That’s used not only in the\ndatabase schema, but in validation, as we’ll soon see. A Field can also have various optional arguments; in\nthis case, we’ve set the default value of votes to 0. Finally, note a relationship is defined, using ForeignKey . That tells Django each Choice is\nrelated to a single Question . Django supports all the common database\nrelationships: many-to-one, many-to-many, and one-to-one. Activating models ¶ That small bit of model code gives Django a lot of information. With it, Django\nis able to: Create a database schema ( CREATE TABLE statements) for this app. Create a Python database-access API for accessing Question and Choice objects. But first we need to tell our project that the polls app is installed. Philosophy Django apps are “pluggable”: You can use an app in multiple projects, and\nyou can distribute apps, because they don’t have to be tied to a given\nDjango installation. To include the app in our project, we need to add a reference to its\nconfiguration class in the INSTALLED_APPS setting. The PollsConfig class is in the polls/apps.py file, so its dotted path\nis 'polls.apps.PollsConfig' . Edit the mysite/settings.py file and\nadd that dotted path to the INSTALLED_APPS setting. It’ll look like\nthis: mysite/settings.py ¶ INSTALLED_APPS = [ \"polls.apps.PollsConfig\" , \"django.contrib.admin\" , \"django.contrib.auth\" , \"django.contrib.contenttypes\" , \"django.contrib.sessions\" , \"django.contrib.messages\" , \"django.contrib.staticfiles\" , ] Now Django knows to include the polls app. Let’s run another command: /  $ python manage.py makemigrations polls ...\\> py manage.py makemigrations polls You should see something similar to the following: Migrations for 'polls':\n  polls/migrations/0001_initial.py\n    + Create model Question\n    + Create model Choice By running makemigrations , you’re telling Django that you’ve made\nsome changes to your models (in this case, you’ve made new ones) and that\nyou’d like the changes to be stored as a migration . Migrations are how Django stores changes to your models (and thus your\ndatabase schema) - they’re files on disk. You can read the migration for your\nnew model if you like; it’s the file polls/migrations/0001_initial.py .\nDon’t worry, you’re not expected to read them every time Django makes one, but\nthey’re designed to be human-editable in case you want to manually tweak how\nDjango changes things. There’s a command that will run the migrations for you and manage your database\nschema automatically - that’s called migrate , and we’ll come to it in a\nmoment - but first, let’s see what SQL that migration would run. The sqlmigrate command takes migration names and returns their SQL: /  $ python manage.py sqlmigrate polls 0001 ...\\> py manage.py sqlmigrate polls 0001 You should see something similar to the following (we’ve reformatted it for\nreadability): BEGIN ; -- -- Create model Question -- CREATE TABLE \"polls_question\" ( \"id\" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY , \"question_text\" varchar ( 200 ) NOT NULL , \"pub_date\" timestamp with time zone NOT NULL ); -- -- Create model Choice -- CREATE TABLE \"polls_choice\" ( \"id\" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY , \"choice_text\" varchar ( 200 ) NOT NULL , \"votes\" integer NOT NULL , \"question_id\" bigint NOT NULL ); ALTER TABLE \"polls_choice\" ADD CONSTRAINT \"polls_choice_question_id_c5b4b260_fk_polls_question_id\" FOREIGN KEY ( \"question_id\" ) REFERENCES \"polls_question\" ( \"id\" ) DEFERRABLE INITIALLY DEFERRED ; CREATE INDEX \"polls_choice_question_id_c5b4b260\" ON \"polls_choice\" ( \"question_id\" ); COMMIT ; Note the following: The exact output will vary depending on the database you are using. The\nexample above is generated for PostgreSQL. Table names are automatically generated by combining the name of the app\n( polls ) and the lowercase name of the model – question and choice . (You can override this behavior.) Primary keys (IDs) are added automatically. (You can override this, too.) By convention, Django appends \"_id\" to the foreign key field name.\n(Yes, you can override this, as well.) The foreign key relationship is made explicit by a FOREIGN KEY constraint. Don’t worry about the DEFERRABLE parts; it’s telling\nPostgreSQL to not enforce the foreign key until the end of the transaction. It’s tailored to the database you’re using, so database-specific field types\nsuch as auto_increment (MySQL), bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (PostgreSQL), or integer primary key autoincrement (SQLite)\nare handled for you automatically. Same goes for the quoting of field names\n– e.g., using double quotes or single quotes. The sqlmigrate command doesn’t actually run the migration on your\ndatabase - instead, it prints it to the screen so that you can see what SQL\nDjango thinks is required. It’s useful for checking what Django is going to\ndo or if you have database administrators who require SQL scripts for\nchanges. If you’re interested, you can also run python manage.py check ; this checks for any problems in\nyour project without making migrations or touching the database. Now, run migrate again to create those model tables in your database: /  $ python manage.py migrate Operations to perform: Apply all migrations: admin, auth, contenttypes, polls, sessions Running migrations: Rendering model states... DONE Applying polls.0001_initial... OK ...\\> py manage.py migrate Operations to perform: Apply all migrations: admin, auth, contenttypes, polls, sessions Running migrations: Rendering model states... DONE Applying polls.0001_initial... OK The migrate command takes all the migrations that haven’t been\napplied (Django tracks which ones are applied using a special table in your\ndatabase called django_migrations ) and runs them against your database -\nessentially, synchronizing the changes you made to your models with the schema\nin the database. Migrations are very powerful and let you change your models over time, as you\ndevelop your project, without the need to delete your database or tables and\nmake new ones - it specializes in upgrading your database live, without\nlosing data. We’ll cover them in more depth in a later part of the tutorial,\nbut for now, remember the three-step guide to making model changes: Change your models (in models.py ). Run python manage.py makemigrations to create\nmigrations for those changes Run python manage.py migrate to apply those changes to\nthe database. The reason that there are separate commands to make and apply migrations is\nbecause you’ll commit migrations to your version control system and ship them\nwith your app; they not only make your development easier, they’re also\nusable by other developers and in production. Read the django-admin documentation for full\ninformation on what the manage.py utility can do. Playing with the API ¶ Now, let’s hop into the interactive Python shell and play around with the free\nAPI Django gives you. To invoke the Python shell, use this command: /  $ python manage.py shell ...\\> py manage.py shell We’re using this instead of simply typing “python”, because manage.py sets the DJANGO_SETTINGS_MODULE environment variable, which gives\nDjango the Python import path to your mysite/settings.py file. Once you’re in the shell, explore the database API : >>> from polls.models import Choice , Question # Import the model classes we just wrote. # No questions are in the system yet. >>> Question . objects . all () <QuerySet []> # Create a new Question. # Support for time zones is enabled in the default settings file, so # Django expects a datetime with tzinfo for pub_date. Use timezone.now() # instead of datetime.datetime.now() and it will do the right thing. >>> from django.utils import timezone >>> q = Question ( question_text = \"What's new?\" , pub_date = timezone . now ()) # Save the object into the database. You have to call save() explicitly. >>> q . save () # Now it has an ID. >>> q . id 1 # Access model field values via Python attributes. >>> q . question_text \"What's new?\" >>> q . pub_date datetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=datetime.timezone.utc) # Change values by changing the attributes, then calling save(). >>> q . question_text = \"What's up?\" >>> q . save () # objects.all() displays all the questions in the database. >>> Question . objects . all () <QuerySet [<Question: Question object (1)>]> Wait a minute. <Question: Question object (1)> isn’t a helpful\nrepresentation of this object. Let’s fix that by editing the Question model\n(in the polls/models.py file) and adding a __str__() method to both Question and Choice : polls/models.py ¶ from django.db import models class Question ( models . Model ): # ... def __str__ ( self ): return self . question_text class Choice ( models . Model ): # ... def __str__ ( self ): return self . choice_text It’s important to add __str__() methods to your\nmodels, not only for your own convenience when dealing with the interactive\nprompt, but also because objects’ representations are used throughout Django’s\nautomatically-generated admin. Let’s also add a custom method to this model: polls/models.py ¶ import datetime from django.db import models from django.utils import timezone class Question ( models . Model ): # ... def was_published_recently ( self ): return self . pub_date >= timezone . now () - datetime . timedelta ( days = 1 ) Note the addition of import datetime and from django.utils import timezone , to reference Python’s standard datetime module and Django’s\ntime-zone-related utilities in django.utils.timezone , respectively. If\nyou aren’t familiar with time zone handling in Python, you can learn more in\nthe time zone support docs . Save these changes and start a new Python interactive shell by running python manage.py shell again: >>> from polls.models import Choice , Question # Make sure our __str__() addition worked. >>> Question . objects . all () <QuerySet [<Question: What's up?>]> # Django provides a rich database lookup API that's entirely driven by # keyword arguments. >>> Question . objects . filter ( id = 1 ) <QuerySet [<Question: What's up?>]> >>> Question . objects . filter ( question_text__startswith = \"What\" ) <QuerySet [<Question: What's up?>]> # Get the question that was published this year. >>> from django.utils import timezone >>> current_year = timezone . now () . year >>> Question . objects . get ( pub_date__year = current_year ) <Question: What's up?> # Request an ID that doesn't exist, this will raise an exception. >>> Question . objects . get ( id = 2 ) Traceback (most recent call last): ... DoesNotExist : Question matching query does not exist. # Lookup by a primary key is the most common case, so Django provides a # shortcut for primary-key exact lookups. # The following is identical to Question.objects.get(id=1). >>> Question . objects . get ( pk = 1 ) <Question: What's up?> # Make sure our custom method worked. >>> q = Question . objects . get ( pk = 1 ) >>> q . was_published_recently () True # Give the Question a couple of Choices. The create call constructs a new # Choice object, does the INSERT statement, adds the choice to the set # of available choices and returns the new Choice object. Django creates # a set (defined as \"choice_set\") to hold the \"other side\" of a ForeignKey # relation (e.g. a question's choice) which can be accessed via the API. >>> q = Question . objects . get ( pk = 1 ) # Display any choices from the related object set -- none so far. >>> q . choice_set . all () <QuerySet []> # Create three choices. >>> q . choice_set . create ( choice_text = \"Not much\" , votes = 0 ) <Choice: Not much> >>> q . choice_set . create ( choice_text = \"The sky\" , votes = 0 ) <Choice: The sky> >>> c = q . choice_set . create ( choice_text = \"Just hacking again\" , votes = 0 ) # Choice objects have API access to their related Question objects. >>> c . question <Question: What's up?> # And vice versa: Question objects get access to Choice objects. >>> q . choice_set . all () <QuerySet [<Choice: Not much>, <Choice: The sky>, <Choice: Just hacking again>]> >>> q . choice_set . count () 3 # The API automatically follows relationships as far as you need. # Use double underscores to separate relationships. # This works as many levels deep as you want; there's no limit. # Find all Choices for any question whose pub_date is in this year # (reusing the 'current_year' variable we created above). >>> Choice . objects . filter ( question__pub_date__year = current_year ) <QuerySet [<Choice: Not much>, <Choice: The sky>, <Choice: Just hacking again>]> # Let's delete one of the choices. Use delete() for that. >>> c = q . choice_set . filter ( choice_text__startswith = \"Just hacking\" ) >>> c . delete () For more information on model relations, see Accessing related objects . For more on how to use double underscores to perform\nfield lookups via the API, see Field lookups . For\nfull details on the database API, see our Database API reference . Introducing the Django Admin ¶ Philosophy Generating admin sites for your staff or clients to add, change, and delete\ncontent is tedious work that doesn’t require much creativity. For that\nreason, Django entirely automates creation of admin interfaces for models. Django was written in a newsroom environment, with a very clear separation\nbetween “content publishers” and the “public” site. Site managers use the\nsystem to add news stories, events, sports scores, etc., and that content is\ndisplayed on the public site. Django solves the problem of creating a\nunified interface for site administrators to edit content. The admin isn’t intended to be used by site visitors. It’s for site\nmanagers. Creating an admin user ¶ First we’ll need to create a user who can login to the admin site. Run the\nfollowing command: /  $ python manage.py createsuperuser ...\\> py manage.py createsuperuser Enter your desired username and press enter. Username: admin You will then be prompted for your desired email address: Email address: admin@example.com The final step is to enter your password. You will be asked to enter your\npassword twice, the second time as a confirmation of the first. Password: **********\nPassword (again): *********\nSuperuser created successfully. Start the development server ¶ The Django admin site is activated by default. Let’s start the development\nserver and explore it. If the server is not running start it like so: /  $ python manage.py runserver ...\\> py manage.py runserver Now, open a web browser and go to “/admin/” on your local domain – e.g., http://127.0.0.1:8000/admin/ . You should see the admin’s login screen: Since translation is turned on by default, if\nyou set LANGUAGE_CODE , the login screen will be displayed in the\ngiven language (if Django has appropriate translations). Enter the admin site ¶ Now, try logging in with the superuser account you created in the previous step.\nYou should see the Django admin index page: You should see a few types of editable content: groups and users. They are\nprovided by django.contrib.auth , the authentication framework shipped\nby Django. Make the poll app modifiable in the admin ¶ But where’s our poll app? It’s not displayed on the admin index page. Only one more thing to do: we need to tell the admin that Question objects\nhave an admin interface. To do this, open the polls/admin.py file, and\nedit it to look like this: polls/admin.py ¶ from django.contrib import admin from .models import Question admin . site . register ( Question ) Explore the free admin functionality ¶ Now that we’ve registered Question , Django knows that it should be displayed on\nthe admin index page: Click “Questions”. Now you’re at the “change list” page for questions. This page\ndisplays all the questions in the database and lets you choose one to change it.\nThere’s the “What’s up?” question we created earlier: Click the “What’s up?” question to edit it: Things to note here: The form is automatically generated from the Question model. The different model field types ( DateTimeField , CharField ) correspond to the appropriate HTML\ninput widget. Each type of field knows how to display itself in the Django\nadmin. Each DateTimeField gets free JavaScript\nshortcuts. Dates get a “Today” shortcut and calendar popup, and times get\na “Now” shortcut and a convenient popup that lists commonly entered times. The bottom part of the page gives you a couple of options: Save – Saves changes and returns to the change-list page for this type of\nobject. Save and continue editing – Saves changes and reloads the admin page for\nthis object. Save and add another – Saves changes and loads a new, blank form for this\ntype of object. Delete – Displays a delete confirmation page. If the value of “Date published” doesn’t match the time when you created the\nquestion in Tutorial 1 , it probably\nmeans you forgot to set the correct value for the TIME_ZONE setting.\nChange it, reload the page and check that the correct value appears. Change the “Date published” by clicking the “Today” and “Now” shortcuts. Then\nclick “Save and continue editing.” Then click “History” in the upper right.\nYou’ll see a page listing all changes made to this object via the Django admin,\nwith the timestamp and username of the person who made the change: When you’re comfortable with the models API and have familiarized yourself with\nthe admin site, read part 3 of this tutorial to learn\nabout how to add more views to our polls app.", "keywords": ["users", "editable", "integerfield", "underscores", "tally", "login", "field", "#", "relation", "migrations", "metadata", "polls.models", "django_settings_module", "stores", "representation", "django.db.models", "calendar", "change", "migrations/0001_initial.py", "ids", "=", "changes", "administrators", "sqlmigrate", "message", "installation", "relationship", "shell", "clients", "character", "setup", "tables", "\\dt", "zones", "choice", "staff", "press", "following", "type", "stories", "custom", "objects", "documentation", "lookups", "file", "constraint", "layout", "work", "user", "states", "headaches", "developers", "time", "doesnotexist", "save", "date", "setting", "question.objects.get(id=1", "faq", "account", "polls", "things", ".models", "password", "name", "makemigrations", "polls_choice_question_id_c5b4b260_fk_polls_question_id", "reference", "web", "django.contrib.auth", "creativity", "problems", "quoting", "django.contrib.admin", "behaviors", "applications", "minimalists", "tutorial", "datetimefield", "question", "django.contrib.staticfiles", "question_text", "username", "relationships", "module", "publication", "code", "bigint", "auth", "filter", "behavior", "c", "access", "manage.py", "migration", "class", "i", "show", "widget", "unlike", "returns", "names", "javascript", "database", "output", "input", "*", "query", "page", "commands", "postgresql", "migrate", "count", "types", "py", "line(s", "admin", "creation", "scripts", "admin/", "insert", "configuration", "limit", "step", "max_length", "ruby", "choice_text__startswith", "by", "rails", "validation", "create", "foreign", "section", "question.pub_date", "/", "source", "concepts", "representations", "use", "environment", "commit", "enter", "default", "choices", "form", "choice_text", "shortcuts", "polls_question", "format", "classes", "help", "convention", "timezone", "convenience", "confirmation", "createsuperuser", "mysite", "schema", "varchar", "traceback", "checks", "interfaces", "index", "datetime.datetime.now", "queryset", "session", "¶", "command", "news", "id", "disk", "side", "content", "primary", "views", "goal", "django.contrib.sessions", "control", "zone", "popup", "number", "lot", "timezone.now", "right", "relations", "datetimes", "values", "django.contrib", "thing", "current_year", "databases", "timestamp", "trouble", "managers", "table", "language", "models", "history", "dates", "version", "human", "level", "machine", "django", "n’t", "fields", "django.contrib.messages", "utilities", "sports", "set", "development", "lowercase", "value", "events", "line", "bit", "data", "browser", "datetime", "guide", "out", "person", "pub_date__year", "self", "need", "instance", "vote", "pub_date", "today", "handling", "levels", "interface", "readability", "alter", "functionality", "publishers", "datetime.datetime(2012", "timedelta", "docs", "superuser", "choice_set", "statement", "tzinfo", "installed_apps", "part", "references", "object", "couple", "domain", "groups", "begin", "charfield", "sql", "utility", "keyword", "minute", "others", "top", "variables", "questions", "django.contrib.contenttypes", "system", "apps", "settings.py", "address", "production", "question_id", "check", "site", "’s", "addition", "lists", "example", "app", "column", "accessing", "list", "auto_increment", "autoincrement", "runserver", "displays", "django.utils.timezone", "polls_choice", "email", "model", "variable", "year", "place", "dry", "identity", "attributes", "road", "pollsconfig", "sky", "newsroom", "philosophy", "translation", "deferrable", ".tables", "http://127.0.0.1:8000", "ones", "keys", "case", "principle", "authentication", "lookup", "null", "html", "screen", "polls.apps", "server", "str", "arguments", "introduction", "quotes", "separation", "reload", "end", "translations", "sqlite", "matching", "delete", "polls.0001_initial", "path", "contenttypes", "depth", "key", "operations", "none", "problem", "mariadb", "reason", "q", "framework", "prompt", "\\", "api", "sessions", "support", "apps.py", "projects", "django.utils", "votes", "files", "import", "d", "mysql", "statements", "call", "foreignkey", "information", "python", "methods", "options", "scores", "times", "exception", "client", "details", "method", "django.db", "settings", "transaction", "argument", "days", "/admin/", "sites", "oracle", "visitors", "moment", "text", "project", "parts"], "type": "documentation"},
{"title": "Coding style | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/internals/contributing/writing-code/coding-style/", "content": "Coding style ¶ Please follow these coding standards when writing code for inclusion in Django. Pre-commit checks ¶ pre-commit is a framework for managing pre-commit\nhooks. These hooks help to identify simple issues before committing code for\nreview. By checking for these issues before code review it allows the reviewer\nto focus on the change itself, and it can also help to reduce the number of CI\nruns. To use the tool, first install pre-commit and then the git hooks: /  $ python -m pip install pre-commit $ pre-commit install ...\\> py -m pip install pre-commit ...\\> pre-commit install On the first commit pre-commit will install the hooks, these are\ninstalled in their own environments and will take a short while to\ninstall on the first run. Subsequent checks will be significantly faster.\nIf an error is found an appropriate error message will be displayed.\nIf the error was with black or isort then the tool will go ahead and\nfix them for you. Review the changes and re-stage for commit if you are happy\nwith them. Python style ¶ All files should be formatted using the black auto-formatter. This\nwill be run by pre-commit if that is configured. The project repository includes an .editorconfig file. We recommend using\na text editor with EditorConfig support to avoid indentation and\nwhitespace issues. The Python files use 4 spaces for indentation and the HTML\nfiles use 2 spaces. Unless otherwise specified, follow PEP 8 . Use flake8 to check for problems in this area. Note that our .flake8 file contains some excluded files (deprecated modules we don’t\ncare about cleaning up and some third-party code that Django vendors) as well\nas some excluded errors that we don’t consider as gross violations. Remember\nthat PEP 8 is only a guide, so respect the style of the surrounding code\nas a primary goal. An exception to PEP 8 is our rules on line lengths. Don’t limit lines of\ncode to 79 characters if it means the code looks significantly uglier or is\nharder to read. We allow up to 88 characters as this is the line length used\nby black . This check is included when you run flake8 . Documentation,\ncomments, and docstrings should be wrapped at 79 characters, even though PEP 8 suggests 72. String variable interpolation may use %-formatting , f-strings , or str.format() as appropriate, with the goal of\nmaximizing code readability. Final judgments of readability are left to the Merger’s discretion. As a\nguide, f-strings should use only plain variable and property access, with\nprior local variable assignment for more complex cases: # Allowed f \"hello { user } \" f \"hello { user . name } \" f \"hello { self . user . name } \" # Disallowed f \"hello { get_user () } \" f \"you are { user . age * 365.25 } days old\" # Allowed with local variable assignment user = get_user () f \"hello { user } \" user_days_old = user . age * 365.25 f \"you are { user_days_old } days old\" f-strings should not be used for any string that may require translation,\nincluding error and logging messages. In general format() is more\nverbose, so the other formatting methods are preferred. Don’t waste time doing unrelated refactoring of existing code to adjust the\nformatting method. Avoid use of “we” in comments, e.g. “Loop over” rather than “We loop over”. Use underscores, not camelCase, for variable, function and method names\n(i.e. poll.get_unique_voters() , not poll.getUniqueVoters() ). Use InitialCaps for class names (or for factory functions that\nreturn classes). In docstrings, follow the style of existing docstrings and PEP 257 . In tests, use assertRaisesMessage() and assertWarnsMessage() instead of assertRaises() and assertWarns() so you can check the\nexception or warning message. Use assertRaisesRegex() and assertWarnsRegex() only if you need regular\nexpression matching. Use assertIs(…, True/False) for testing\nboolean values, rather than assertTrue() and assertFalse() , so you can check the actual boolean\nvalue, not the truthiness of the expression. In test docstrings, state the expected behavior that each test demonstrates.\nDon’t include preambles such as “Tests that” or “Ensures that”. Reserve ticket references for obscure issues where the ticket has additional\ndetails that can’t be easily described in docstrings or comments. Include the\nticket number at the end of a sentence like this: def test_foo (): \"\"\" A test docstring looks like this (#123456). \"\"\" ... Imports ¶ Use isort to automate import sorting using the guidelines below. Quick start: /  $ python -m pip install \"isort >= 5.1.0\" $ isort . ...\\> py -m pip install \"isort >= 5.1.0\" ...\\> isort . This runs isort recursively from your current directory, modifying any\nfiles that don’t conform to the guidelines. If you need to have imports out\nof order (to avoid a circular import, for example) use a comment like this: import module # isort:skip Put imports in these groups: future, standard library, third-party libraries,\nother Django components, local Django component, try/excepts. Sort lines in\neach group alphabetically by the full module name. Place all import module statements before from module import objects in each section. Use absolute\nimports for other Django components and relative imports for local components. On each line, alphabetize the items with the upper case items grouped before\nthe lowercase items. Break long lines using parentheses and indent continuation lines by 4 spaces.\nInclude a trailing comma after the last import and put the closing\nparenthesis on its own line. Use a single blank line between the last import and any module level code,\nand use two blank lines above the first function or class. For example (comments are for explanatory purposes only): django/contrib/admin/example.py ¶ # future from __future__ import unicode_literals # standard library import json from itertools import chain # third-party import bcrypt # Django from django.http import Http404 from django.http.response import ( Http404 , HttpResponse , HttpResponseNotAllowed , StreamingHttpResponse , cookie , ) # local Django from .models import LogEntry # try/except try : import yaml except ImportError : yaml = None CONSTANT = \"foo\" class Example : ... Use convenience imports whenever available. For example, do this from django.views import View instead of: from django.views.generic.base import View Template style ¶ Follow the below rules in Django template code. {% extends %} should be the first non-comment line. Do this: {% extends \"base.html\" %} {% block content %} < h1 class = \"font-semibold text-xl\" > {{ pages.title }} </ h1 > {% endblock content %} Or this: {# This is a comment #} {% extends \"base.html\" %} {% block content %} < h1 class = \"font-semibold text-xl\" > {{ pages.title }} </ h1 > {% endblock content %} Don’t do this: {% load i18n %} {% extends \"base.html\" %} {% block content %} < h1 class = \"font-semibold text-xl\" > {{ pages.title }} </ h1 > {% endblock content %} Put exactly one space between {{ , variable contents, and }} . Do this: {{ user }} Don’t do this: {{ user }} In {% load ... %} , list libraries in alphabetical order. Do this: {% load i18n l10 tz %} Don’t do this: {% load l10 i18n tz %} Put exactly one space between {% , tag contents, and %} . Do this: {% load humanize %} Don’t do this: {% load humanize %} Put the {% block %} tag name in the {% endblock %} tag if it is not\non the same line. Do this: {% block header %} Code goes here {% endblock header %} Don’t do this: {% block header %} Code goes here {% endblock %} Inside curly braces, separate tokens by single spaces, except for around the . for attribute access and the | for a filter. Do this: {% if user.name | lower == \"admin\" %} Don’t do this: {% if user . name | lower == \"admin\" %} {{ user.name | upper }} Within a template using {% extends %} , avoid indenting top-level {% block %} tags. Do this: {% extends \"base.html\" %} {% block content %} Don’t do this: {% extends \"base.html\" %} {% block content %} ... View style ¶ In Django views, the first parameter in a view function should be called request . Do this: def my_view ( request , foo ): ... Don’t do this: def my_view ( req , foo ): ... Model style ¶ Field names should be all lowercase, using underscores instead of\ncamelCase. Do this: class Person ( models . Model ): first_name = models . CharField ( max_length = 20 ) last_name = models . CharField ( max_length = 40 ) Don’t do this: class Person ( models . Model ): FirstName = models . CharField ( max_length = 20 ) Last_Name = models . CharField ( max_length = 40 ) The class Meta should appear after the fields are defined, with\na single blank line separating the fields and the class definition. Do this: class Person ( models . Model ): first_name = models . CharField ( max_length = 20 ) last_name = models . CharField ( max_length = 40 ) class Meta : verbose_name_plural = \"people\" Don’t do this: class Person ( models . Model ): class Meta : verbose_name_plural = \"people\" first_name = models . CharField ( max_length = 20 ) last_name = models . CharField ( max_length = 40 ) The order of model inner classes and standard methods should be as\nfollows (noting that these are not all required): All database fields Custom manager attributes class Meta def __str__() def save() def get_absolute_url() Any custom methods If choices is defined for a given model field, define each choice as a\nmapping, with an all-uppercase name as a class attribute on the model.\nExample: class MyModel ( models . Model ): DIRECTION_UP = \"U\" DIRECTION_DOWN = \"D\" DIRECTION_CHOICES = { DIRECTION_UP : \"Up\" , DIRECTION_DOWN : \"Down\" , } Alternatively, consider using Enumeration types : class MyModel ( models . Model ): class Direction ( models . TextChoices ): UP = \"U\" , \"Up\" DOWN = \"D\" , \"Down\" Use of django.conf.settings ¶ Modules should not in general use settings stored in django.conf.settings at the top level (i.e. evaluated when the module is imported). The explanation\nfor this is as follows: Manual configuration of settings (i.e. not relying on the DJANGO_SETTINGS_MODULE environment variable) is allowed and possible\nas follows: from django.conf import settings settings . configure ({}, SOME_SETTING = \"foo\" ) However, if any setting is accessed before the settings.configure line,\nthis will not work. (Internally, settings is a LazyObject which\nconfigures itself automatically when the settings are accessed if it has not\nalready been configured). So, if there is a module containing some code as follows: from django.conf import settings from django.urls import get_callable default_foo_view = get_callable ( settings . FOO_VIEW ) …then importing this module will cause the settings object to be configured.\nThat means that the ability for third parties to import the module at the top\nlevel is incompatible with the ability to configure the settings object\nmanually, or makes it very difficult in some circumstances. Instead of the above code, a level of laziness or indirection must be used,\nsuch as django.utils.functional.LazyObject , django.utils.functional.lazy() or lambda . Miscellaneous ¶ Mark all strings for internationalization; see the i18n\ndocumentation for details. Remove import statements that are no longer used when you change code. flake8 will identify these imports for you. If an unused import needs\nto remain for backwards-compatibility, mark the end of with # NOQA to\nsilence the flake8 warning. Systematically remove all trailing whitespaces from your code as those\nadd unnecessary bytes, add visual clutter to the patches and can also\noccasionally cause unnecessary merge conflicts. Some IDE’s can be\nconfigured to automatically remove them and most VCS tools can be set to\nhighlight them in diff outputs. Please don’t put your name in the code you contribute. Our policy is to\nkeep contributors’ names in the AUTHORS file distributed with Django\n– not scattered throughout the codebase itself. Feel free to include a\nchange to the AUTHORS file in your patch if you make more than a\nsingle trivial change. JavaScript style ¶ For details about the JavaScript code style used by Django, see JavaScript code .", "keywords": ["verbose", "underscores", "reviewer", "messages", "ci", "5.1.0", "library", "humanize", "field", "#", "editorconfig", "django_settings_module", "lambda", "lines", "stage", "httpresponse", "compatibility", "needs", "ide", "tool", "change", "django.urls", "disallowed", "changes", "=", "get_absolute_url", "message", "tag", "contributors", "assertwarnsregex", "pip", "choice", "first_name", "people", "custom", "objects", "documentation", "file", "l10", "modules", "user", "cases", "violations", "noqa", "attribute", "lazyobject", "warning", "time", "tags", "install", "save", "setting", "purposes", "excepts", "components", "itertools", ".models", "name", "httpresponsenotallowed", "parameter", "codebase", "age", "problems", "interpolation", "assertis", "manager", "return", "foo", "environments", "truthiness", "mymodel", "assertwarns", "merger", "continuation", "pre", "space", "guidelines", "error", "module", "code", "base.html", "user.name", "assertwarnsmessage", "filter", "style", "false", "behavior", "access", "class", "group", "configure", "names", "javascript", "u", "str.format", "settings.configure", "request", "formatting", "database", "block", "importerror", "docstrings", "test", "sentence", "types", "strings", "py", "admin", "xl", "http404", "direction", "assertfalse", "configuration", "max_length", "standards", "git", "django.http.response", "section", "/", "django.utils.functional.lazy", "follow", "component", "use", "poll.get_unique_voters", "default_foo_view", "environment", "editor", "commit", "direction_down", "get_user", "imports", "explanation", "repository", "enumeration", "discretion", "order", "choices", "inclusion", "comment", "format", "classes", "characters", "tests", "expression", "comma", "laziness", "bcrypt", "black", "area", "merge", "convenience", "f", "chain", "indentation", "template", "header", "checks", "uppercase", "comments", "party", "streaminghttpresponse", "¶", "bytes", "internationalization", "spaces", "property", "poll.getuniquevoters", "review", "content", "function", "parenthesis", "views", "testing", "goal", "view", "run", "whitespaces", "number", "def", "tz", "values", "string", "assertraisesregex", "django.views.generic.base", "mapping", "auto", "libraries", "models", "level", "json", "yaml", "reserve", "contents", "refactoring", "django", "lengths", "n’t", "fields", "parentheses", "lowercase", "value", "vcs", "line", "policy", "pep", "guide", "person", "patch", "self", "outputs", "camelcase", "readability", "|", "closing", "issues", "test_foo", "asserttrue", "references", "patches", "load", "ticket", "groups", "charfield", "diff", "indirection", "assertraisesmessage", "whitespace", "vendors", "authors", "braces", "tokens", "try", "ensures", "logentry", "rules", "items", "definition", "check", "example", "care", "hooks", "i18n", "list", "parties", "while", "unicode_literals", "re", "variable", "model", "foo_view", "conflicts", ".flake8", "formatter", "ability", "up", "translation", "circumstances", "sorting", "case", "h1", "length", "assignment", "html", "errors", "future", "factory", "str", "assertraises", "judgments", "django.conf.settings", "initialcaps", "end", "contrib", "textchoices", "matching", "last_name", "mark", "functions", "my_view", "none", "firstname", "meta", "down", "clutter", "framework", "\\", "isort", "support", "-", "preambles", "django.views", "runs", "files", "import", "d", "put", "statements", "directory", "%", "python", "flake8", "methods", "exception", "details", "method", "settings", "days", "user_days_old", "endblock", "cookie", "tools", "text", "project"], "type": "documentation"},
{"title": "How to use Django with uWSGI | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/deployment/wsgi/uwsgi/", "content": "How to use Django with uWSGI ¶ uWSGI is a fast, self-healing and developer/sysadmin-friendly application\ncontainer server coded in pure C. See also The uWSGI docs offer a tutorial covering Django, nginx, and uWSGI (one\npossible deployment setup of many). The docs below are focused on how to\nintegrate Django with uWSGI. Prerequisite: uWSGI ¶ The uWSGI wiki describes several installation procedures . Using pip, the\nPython package manager, you can install any uWSGI version with a single\ncommand. For example: # Install current stable version. $ python -m pip install uwsgi # Or install LTS ( long term support ) . $ python -m pip install https://projects.unbit.it/downloads/uwsgi-lts.tar.gz uWSGI model ¶ uWSGI operates on a client-server model. Your web server (e.g., nginx, Apache)\ncommunicates with a django-uwsgi “worker” process to serve dynamic content. Configuring and starting the uWSGI server for Django ¶ uWSGI supports multiple ways to configure the process. See uWSGI’s configuration documentation . Here’s an example command to start a uWSGI server: uwsgi --chdir = /path/to/your/project \\ --module = mysite.wsgi:application \\ --env DJANGO_SETTINGS_MODULE = mysite.settings \\ --master --pidfile = /tmp/project-master.pid \\ --socket = 127 .0.0.1:49152 \\ # can also be a file --processes = 5 \\ # number of worker processes --uid = 1000 --gid = 2000 \\ # if root, uwsgi can drop privileges --harakiri = 20 \\ # respawn processes taking more than 20 seconds --max-requests = 5000 \\ # respawn processes after serving 5000 requests --vacuum \\ # clear environment on exit --home = /path/to/virtual/env \\ # optional path to a virtual environment --daemonize = /var/log/uwsgi/yourproject.log # background the process This assumes you have a top-level project package named mysite , and\nwithin it a module mysite/wsgi.py that contains a WSGI application object. This is the layout you’ll have if you ran django-admin startproject mysite (using your own project name in place of mysite ) with\na recent version of Django. If this file doesn’t exist, you’ll need to create\nit. See the How to deploy with WSGI documentation for the default\ncontents you should put in this file and what else you can add to it. The Django-specific options here are: chdir : The path to the directory that needs to be on Python’s import\npath – i.e., the directory containing the mysite package. module : The WSGI module to use – probably the mysite.wsgi module\nthat startproject creates. env : Should probably contain at least DJANGO_SETTINGS_MODULE . home : Optional path to your project virtual environment. Example ini configuration file: [uwsgi] chdir = /path/to/your/project module = mysite.wsgi:application master = True pidfile = /tmp/project-master.pid vacuum = True max-requests = 5000 daemonize = /var/log/uwsgi/yourproject.log Example ini configuration file usage: uwsgi --ini uwsgi.ini Fixing UnicodeEncodeError for file uploads If you get a UnicodeEncodeError when uploading files with file names\nthat contain non-ASCII characters, make sure uWSGI is configured to accept\nnon-ASCII file names by adding this to your uwsgi.ini : env = LANG=en_US.UTF-8 See the Files section of the Unicode reference guide for\ndetails. See the uWSGI docs on managing the uWSGI process for information on\nstarting, stopping and reloading the uWSGI workers.", "keywords": ["--gid", "number", "daemonize", "processes", "module", "background", "apache", "uploads", "example", "#", "--max", "env", "names", "seconds", "procedures", "django_settings_module", "lts", "mysite.wsgi", "privileges", "exit", "version", "yourproject.log", "ways", "level", "c.", "contents", "model", "en_us.utf-8", "chdir", "place", "home", "application", "vacuum", "ini", "usage", "django", "--env", "wsgi", "configuration", "=", "https://projects.unbit.it/downloads/uwsgi-lts.tar.gz", "communicates", "installation", "log", "setup", "section", "pip", "developer", "process", "container", "healing", "guide", "mysite.settings", "environment", "server", "wsgi.py", "package", "unicodeencodeerror", "self", "master", "--pidfile", "documentation", "file", "startproject", "nginx", "layout", "pidfile", "default", "path", "unicode", "prerequisite", "term", "docs", "characters", "sysadmin", "worker", "uwsgi", "wiki", "lang", "\\", "support", "object", "deployment", "--processes", "import", "name", "files", "directory", "mysite", "workers", "requests", "reference", "information", "web", "python", "options", "optional", "client", "max", "manager", "details", "root", "¶", "command", "tutorial", "content", "project"], "type": "documentation"},
{"title": "How to deploy with WSGI | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/deployment/wsgi/", "content": "How to deploy with WSGI ¶ Django’s primary deployment platform is WSGI , the Python standard for web\nservers and applications. Django’s startproject management command sets up a minimal default\nWSGI configuration for you, which you can tweak as needed for your project,\nand direct any WSGI-compliant application server to use. Django includes getting-started documentation for the following WSGI servers: How to use Django with Gunicorn How to use Django with uWSGI How to use Django with Apache and mod_wsgi How to authenticate against Django’s user database from Apache The application object ¶ The key concept of deploying with WSGI is the application callable which\nthe application server uses to communicate with your code. It’s commonly\nprovided as an object named application in a Python module accessible to\nthe server. The startproject command creates a file <project_name>/wsgi.py that contains such an application callable. It’s used both by Django’s development server and in production WSGI\ndeployments. WSGI servers obtain the path to the application callable from their\nconfiguration. Django’s built-in server, namely the runserver command, reads it from the WSGI_APPLICATION setting. By default, it’s\nset to <project_name>.wsgi.application , which points to the application callable in <project_name>/wsgi.py . Configuring the settings module ¶ When the WSGI server loads your application, Django needs to import the\nsettings module — that’s where your entire application is defined. Django uses the DJANGO_SETTINGS_MODULE environment variable to\nlocate the appropriate settings module. It must contain the dotted path to the\nsettings module. You can use a different value for development and production;\nit all depends on how you organize your settings. If this variable isn’t set, the default wsgi.py sets it to mysite.settings , where mysite is the name of your project. That’s how runserver discovers the default settings file by default. Note Since environment variables are process-wide, this doesn’t work when you\nrun multiple Django sites in the same process. This happens with mod_wsgi. To avoid this problem, use mod_wsgi’s daemon mode with each site in its\nown daemon process, or override the value from the environment by\nenforcing os.environ[\"DJANGO_SETTINGS_MODULE\"] = \"mysite.settings\" in\nyour wsgi.py . Applying WSGI middleware ¶ To apply WSGI middleware you can wrap the application\nobject. For instance you could add these lines at the bottom of wsgi.py : from helloworld.wsgi import HelloWorldApplication application = HelloWorldApplication ( application ) You could also replace the Django WSGI application with a custom WSGI\napplication that later delegates to the Django WSGI application, if you want\nto combine a Django application with a WSGI application of another framework.", "keywords": ["os.environ[\"django_settings_module", "server", "object", "mode", "deployment", "platform", "variable", "production", "deployments", "wsgi_application", "callable", "middleware", "name", "import", "instance", "custom", "application", "documentation", "management", "bottom", "file", "mysite", "django", "module", "wsgi", "code", "configuration", "startproject", "=", "site", "web", "python", "apache", "’s", "servers", "standard", "default", "n’t", "user", "delegates", "path", "development", "concept", "variables", "settings", "value", "problem", "helloworldapplication", "¶", "command", "mod_wsgi", "applications", "sites", "runserver", "django_settings_module", "framework", "process", "database", "setting", "uwsgi", "project_name>.wsgi.application", "gunicorn", "project_name>/wsgi.py", "helloworld.wsgi", "use", "daemon", "lines", "mysite.settings", "project", "environment"], "type": "documentation"},
{"title": "How to deploy with ASGI | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/deployment/asgi/", "content": "How to deploy with ASGI ¶ As well as WSGI, Django also supports deploying on ASGI , the emerging Python\nstandard for asynchronous web servers and applications. Django’s startproject management command sets up a default ASGI\nconfiguration for you, which you can tweak as needed for your project, and\ndirect any ASGI-compliant application server to use. Django includes getting-started documentation for the following ASGI servers: How to use Django with Daphne How to use Django with Hypercorn How to use Django with Uvicorn The application object ¶ Like WSGI, ASGI has you supply an application callable which\nthe application server uses to communicate with your code. It’s commonly\nprovided as an object named application in a Python module accessible to\nthe server. The startproject command creates a file <project_name>/asgi.py that contains such an application callable. It’s not used by the development server ( runserver ), but can be used by\nany ASGI server either in development or in production. ASGI servers usually take the path to the application callable as a string;\nfor most Django projects, this will look like myproject.asgi:application . Warning While Django’s default ASGI handler will run all your code in a synchronous\nthread, if you choose to run your own async handler you must be aware of\nasync-safety. Do not call blocking synchronous functions or libraries in any async code.\nDjango prevents you from doing this with the parts of Django that are not\nasync-safe, but the same may not be true of third-party apps or Python\nlibraries. Configuring the settings module ¶ When the ASGI server loads your application, Django needs to import the\nsettings module — that’s where your entire application is defined. Django uses the DJANGO_SETTINGS_MODULE environment variable to locate\nthe appropriate settings module. It must contain the dotted path to the\nsettings module. You can use a different value for development and production;\nit all depends on how you organize your settings. If this variable isn’t set, the default asgi.py sets it to mysite.settings , where mysite is the name of your project. Applying ASGI middleware ¶ To apply ASGI middleware, or to embed Django in another ASGI application, you\ncan wrap Django’s application object in the asgi.py file. For example: from some_asgi_library import AmazingMiddleware application = AmazingMiddleware ( application )", "keywords": ["server", "object", "projects", "variable", "project_name>/asgi.py", "production", "middleware", "import", "name", "amazingmiddleware", "daphne", "application", "documentation", "management", "file", "mysite", "django", "hypercorn", "wsgi", "code", "configuration", "module", "startproject", "myproject.asgi", "web", "python", "’s", "n’t", "servers", "standard", "default", "safety", "asgi", "string", "thread", "path", "example", "development", "functions", "party", "environment", "settings", "value", "¶", "command", "applications", "django_settings_module", "uvicorn", "apps", "handler", "libraries", "some_asgi_library", "use", "mysite.settings", "async", "project", "parts"], "type": "documentation"},
{"title": "Django 1.2 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/1.2/", "content": "Django 1.2 release notes ¶ May 17, 2010. Welcome to Django 1.2! Nearly a year in the making, Django 1.2 packs an impressive list of new\nfeatures and lots of bug fixes. These release notes cover\nthe new features, as well as important changes you’ll want to be aware of when\nupgrading from Django 1.1 or older versions. Overview ¶ Django 1.2 introduces several large, important new features, including: Support for multiple database connections in a single Django instance. Model validation inspired by Django’s form validation. Vastly improved protection against Cross-Site Request Forgery (CSRF). A new user “messages” framework with support for\ncookie- and session-based message for both anonymous and authenticated users. Hooks for object-level permissions , permissions for anonymous users ,\nand more flexible username requirements . Customization of email sending via email backends . New “smart” if template tag which supports\ncomparison operators. These are just the highlights; full details and a complete list of features may be found below . See also Django Advent covered the release of Django 1.2 with a series of\narticles and tutorials that cover some of the new features in depth. Wherever possible these features have been introduced in a backwards-compatible\nmanner per our API stability policy policy. However, a handful of features have changed in ways that, for some users, will be\nbackwards-incompatible. The big changes are: Support for Python 2.3 has been dropped. See the full notes\nbelow. The new CSRF protection framework is not backwards-compatible with\nthe old system. Users of the old system will not be affected until\nthe old system is removed in Django 1.4. However, upgrading to the new CSRF protection framework requires a few\nimportant backwards-incompatible changes, detailed in CSRF Protection ,\nbelow. Authors of custom Field subclasses should be\naware that a number of methods have had a change in prototype, detailed\nunder get_db_prep_*() methods on Field , below. The internals of template tags have changed somewhat; authors of custom\ntemplate tags that need to store state (e.g. custom control flow tags)\nshould ensure that their code follows the new rules for stateful template\ntags The user_passes_test() , login_required() , and permission_required() , decorators\nfrom django.contrib.auth only apply to functions and no longer\nwork on methods. There’s a simple one-line fix detailed below . Again, these are just the big features that will affect the most users. Users\nupgrading from previous versions of Django are heavily encouraged to consult\nthe complete list of backwards-incompatible changes and the list of deprecated\nfeatures . Python compatibility ¶ While not a new feature, it’s important to note that Django 1.2\nintroduces the first shift in our Python compatibility policy since\nDjango’s initial public debut. Previous Django releases were tested\nand supported on 2.x Python versions from 2.3 up; Django 1.2, however,\ndrops official support for Python 2.3. As such, the minimum Python\nversion required for Django is now 2.4, and Django is tested and\nsupported on Python 2.4, 2.5 and 2.6, and will be supported on the\nas-yet-unreleased Python 2.7. This change should affect only a small number of Django users, as most\noperating-system vendors today are shipping Python 2.4 or newer as\ntheir default version. If you’re still using Python 2.3, however,\nyou’ll need to stick to Django 1.1 until you can upgrade; per our support policy , Django 1.1 will\ncontinue to receive security support until the release of Django 1.3. A roadmap for Django’s overall 2.x Python support, and eventual\ntransition to Python 3.x, is currently being developed, and will be\nannounced prior to the release of Django 1.3. What’s new in Django 1.2 ¶ Support for multiple databases ¶ Django 1.2 adds the ability to use more than one database in your Django project. Queries can be issued at a\nspecific database with the using() method on QuerySet objects.\nIndividual objects can be saved to a specific database by providing a using argument when you call save() . Model validation ¶ Model instances now have support for validating their own data , and both model and form fields now accept configurable\nlists of validators specifying reusable, encapsulated\nvalidation behavior. Note, however, that validation must still be performed\nexplicitly. Simply invoking a model instance’s save() method will not\nperform any validation of the instance’s data. Improved CSRF protection ¶ Django now has much improved protection against Cross-Site Request Forgery\n(CSRF) attacks . This type of attack occurs when a malicious\nwebsite contains a link, a form button or some JavaScript that is intended to\nperform some action on your website, using the credentials of a logged-in user\nwho visits the malicious site in their browser. A related type of attack, “login\nCSRF,” where an attacking site tricks a user’s browser into logging into a site\nwith someone else’s credentials, is also covered. Messages framework ¶ Django now includes a robust and configurable messages framework with built-in support for cookie- and session-based\nmessaging, for both anonymous and authenticated clients. The messages framework\nreplaces the deprecated user message API and allows you to temporarily store\nmessages in one request and retrieve them for display in a subsequent request\n(usually the next one). Object-level permissions ¶ A foundation for specifying permissions at the per-object level has been added.\nAlthough there is no implementation of this in core, a custom authentication\nbackend can provide this implementation and it will be used by django.contrib.auth.models.User . See the authentication docs for more information. Permissions for anonymous users ¶ If you provide a custom auth backend with supports_anonymous_user set to True , AnonymousUser will check the backend for permissions, just like\nUser already did.  This is useful for centralizing permission handling - apps\ncan always delegate the question of whether something is allowed or not to\nthe authorization/authentication backend. See the authentication\ndocs for more details. Relaxed requirements for usernames ¶ The built-in User model’s username field now allows a wider range\nof characters, including @ , + , . and - characters. Email backends ¶ You can now configure the way that Django sends email . Instead of using SMTP to send all email, you\ncan now choose a configurable email backend to send messages. If your\nhosting provider uses a sandbox or some other non-SMTP technique for\nsending mail, you can now construct an email backend that will allow\nDjango’s standard mail sending methods to use\nthose facilities. This also makes it easier to debug mail sending. Django ships with\nbackend implementations that allow you to send email to a file , to the console , or to memory . You can even configure all\nemail to be thrown away . “Smart” if tag ¶ The if tag has been upgraded to be much more powerful. First, we’ve\nadded support for comparison operators. No longer will you have to type: {% ifnotequal a b %} ... {% endifnotequal %} You can now do this: {% if a != b %} ... {% endif %} There’s really no reason to use {% ifequal %} or {% ifnotequal %} anymore, unless you’re the nostalgic type. The operators supported are == , != , < , > , <= , >= , in and not in , all of which work like the Python operators, in addition\nto and , or and not , which were already supported. Also, filters may now be used in the if expression. For example: < div {% if user.email | lower == message.recipient | lower %} class = \"highlight\" {% endif %} > {{ message }} </ div > Template caching ¶ In previous versions of Django, every time you rendered a template, it\nwould be reloaded from disk. In Django 1.2, you can use a cached\ntemplate loader to load templates once, then\ncache the result for every subsequent render. This can lead to a\nsignificant performance improvement if your templates are broken into\nlots of smaller subtemplates (using the {% extends %} or {% include %} tags). As a side effect, it is now much easier to support non-Django template\nlanguages. Class-based template loaders ¶ As part of the changes made to introduce Template caching and following\na general trend in Django, the template loaders API has been modified\nto use template loading mechanisms that are encapsulated in Python classes as\nopposed to functions, the only method available until Django 1.1. All the template loaders shipped with Django have\nbeen ported to the new API but they still implement the function-based API and\nthe template core machinery still accepts function-based loaders (builtin or\nthird party) so there is no immediate need to modify your TEMPLATE_LOADERS setting in existing projects, things will keep working if you leave it\nuntouched up to and including the Django 1.3 release. If you have developed your own custom template loaders we suggest to consider\nporting them to a class-based implementation because the code for backwards\ncompatibility with function-based loaders starts its deprecation process in\nDjango 1.2 and will be removed in Django 1.4.  There is a description of the\nAPI these loader classes must implement in the template API reference and you\ncan also examine the source code of the loaders shipped with Django. Natural keys in fixtures ¶ Fixtures can now refer to remote objects using Natural keys . This lookup scheme is an\nalternative to the normal primary-key based object references in a\nfixture, improving readability and resolving problems referring to\nobjects whose primary key value may not be predictable or known. Fast failure for tests ¶ Both the test subcommand of django-admin.py and the runtests.py script used to run Django’s own test suite now support a --failfast option. When specified, this option causes the test runner to\nexit after encountering a failure instead of continuing with the test run. In\naddition, the handling of Ctrl-C during a test run has been improved to\ntrigger a graceful exit from the test run that reports details of the tests that\nwere run before the interruption. BigIntegerField ¶ Models can now use a 64-bit BigIntegerField type. Improved localization ¶ Django’s internationalization framework has been expanded\nwith locale-aware formatting and form processing. That means, if enabled, dates\nand numbers on templates will be displayed using the format specified for the\ncurrent locale. Django will also use localized formats when parsing data in\nforms. See Format localization for more details. readonly_fields in ModelAdmin ¶ django.contrib.admin.ModelAdmin.readonly_fields has been added to\nenable non-editable fields in add/change pages for models and inlines. Field\nand calculated values can be displayed alongside editable fields. Customizable syntax highlighting ¶ You can now use a DJANGO_COLORS environment variable to modify or\ndisable the colors used by django-admin.py to provide syntax\nhighlighting . Syndication feeds as views ¶ Syndication feeds can now be used directly as\nviews in your URLconf . This means that you can\nmaintain complete control over the URL structure of your feeds. Like any other\nview, feeds views are passed a request object, so you can do anything you\nwould normally do with a view, like user based access control, or making a feed\na named URL. GeoDjango ¶ The most significant new feature for GeoDjango in 1.2 is support for multiple spatial databases.  As a result,\nthe following spatial database backends are now included: django.contrib.gis.db.backends.postgis django.contrib.gis.db.backends.mysql django.contrib.gis.db.backends.oracle django.contrib.gis.db.backends.spatialite GeoDjango now supports the rich capabilities added in the PostGIS 1.5 release.\nNew features include support for the geography type and enabling of distance queries with non-point geometries on geographic coordinate systems. Support for 3D geometry fields was added, and may be enabled\nby setting the dim keyword to 3 in your GeometryField .\nThe Extent3D aggregate\nand extent3d() GeoQuerySet method were added as a part of this feature. The force_rhr() , reverse_geom() , and geohash() GeoQuerySet methods are new. The GEOS interface was updated to use thread-safe C library functions when\navailable on the platform. The GDAL interface now allows the user to set a spatial_filter on the features returned\nwhen iterating over a Layer . Finally, GeoDjango’s documentation is now\nincluded with Django’s and is no longer hosted separately at geodjango.org . JavaScript-assisted handling of inline related objects in the admin ¶ If a user has JavaScript enabled in their browser, the interface for\ninline objects in the admin now allows inline objects to be\ndynamically added and removed. Users without JavaScript-enabled\nbrowsers will see no change in the behavior of inline objects. New now template tag format specifier characters: c and u ¶ The argument to the now has gained two new format characters: c to specify that a datetime value should be formatted in ISO 8601\nformat, and u that allows output of the microseconds part of a\ndatetime or time value. These are also available in others parts like the date and time template filters, the humanize template tag library\nand the new format localization framework. Backwards-incompatible changes in 1.2 ¶ Wherever possible the new features above have been introduced in a\nbackwards-compatible manner per our API stability policy policy. This means that practically all existing\ncode which worked with Django 1.1 will continue to work with Django\n1.2; such code will, however, begin issuing warnings (see below for\ndetails). However, a handful of features have changed in ways that, for some\nusers, will be immediately backwards-incompatible. Those changes are\ndetailed below. CSRF Protection ¶ We’ve made large changes to the way CSRF protection works, detailed in the CSRF documentation . Here are the major changes you\nshould be aware of: CsrfResponseMiddleware and CsrfMiddleware have been deprecated and\nwill be removed completely in Django 1.4, in favor of a template tag that\nshould be inserted into forms. All contrib apps use a csrf_protect decorator to protect the view. This\nrequires the use of the csrf_token template tag in the template. If you\nhave used custom templates for contrib views, you MUST READ THE UPGRADE\nINSTRUCTIONS to fix those templates. Documentation removed The upgrade notes have been removed in current Django docs. Please refer\nto the docs for Django 1.3 or older to find these instructions. CsrfViewMiddleware is included in MIDDLEWARE_CLASSES by\ndefault. This turns on CSRF protection by default, so views that accept\nPOST requests need to be written to work with the middleware. Instructions\non how to do this are found in the CSRF docs. All of the CSRF has moved from contrib to core (with backwards\ncompatible imports in the old locations, which are deprecated and\nwill cease to be supported in Django 1.4). get_db_prep_*() methods on Field ¶ Prior to Django 1.2, a custom Field had the option of defining\nseveral functions to support conversion of Python values into\ndatabase-compatible values. A custom field might look something like: class CustomModelField ( models . Field ): ... def db_type ( self ): ... def get_db_prep_save ( self , value ): ... def get_db_prep_value ( self , value ): ... def get_db_prep_lookup ( self , lookup_type , value ): ... In 1.2, these three methods have undergone a change in prototype, and\ntwo extra methods have been introduced: class CustomModelField ( models . Field ): ... def db_type ( self , connection ): ... def get_prep_value ( self , value ): ... def get_prep_lookup ( self , lookup_type , value ): ... def get_db_prep_save ( self , value , connection ): ... def get_db_prep_value ( self , value , connection , prepared = False ): ... def get_db_prep_lookup ( self , lookup_type , value , connection , prepared = False ): ... These changes are required to support multiple databases – db_type and get_db_prep_* can no longer make any assumptions\nregarding the database for which it is preparing. The connection argument now provides the preparation methods with the specific\nconnection for which the value is being prepared. The two new methods exist to differentiate general data-preparation\nrequirements from requirements that are database-specific. The prepared argument is used to indicate to the database-preparation\nmethods whether generic value preparation has been performed. If\nan unprepared (i.e., prepared=False ) value is provided to the get_db_prep_*() calls, they should invoke the corresponding get_prep_*() calls to perform generic data preparation. We’ve provided conversion functions that will transparently\nconvert functions adhering to the old prototype into functions\ncompatible with the new prototype. However, these conversion functions\nwill be removed in Django 1.4, so you should upgrade your Field definitions to use the new prototype as soon as possible. If your get_db_prep_*() methods made no use of the database\nconnection, you should be able to upgrade by renaming get_db_prep_value() to get_prep_value() and get_db_prep_lookup() to get_prep_lookup() . If you require\ndatabase specific conversions, then you will need to provide an\nimplementation get_db_prep_* that uses the connection argument to resolve database-specific values. Stateful template tags ¶ Template tags that store rendering state on their Node subclass\nhave always been vulnerable to thread-safety and other issues; as of\nDjango 1.2, however, they may also cause problems when used with the\nnew cached template loader . All of the built-in Django template tags are safe to use with the cached\nloader, but if you’re using custom template tags that come from third\nparty packages, or from your own code, you should ensure that the Node implementation for each tag is thread-safe. For more\ninformation, see template tag thread safety considerations . You may also need to update your templates if you were relying on the\nimplementation of Django’s template tags not being thread safe. The cycle tag is the most likely to be affected in this way,\nespecially when used in conjunction with the include tag.\nConsider the following template fragment: {% for object in object_list %} {% include \"subtemplate.html\" %} {% endfor %} with a subtemplate.html that reads: {% cycle 'even' 'odd' %} Using the non-thread-safe, pre-Django 1.2 renderer, this would output: even odd even odd ... Using the thread-safe Django 1.2 renderer, you will instead get: even even even even ... This is because each rendering of the include tag is an\nindependent rendering. When the cycle tag was not thread safe,\nthe state of the cycle tag would leak between multiple\nrenderings of the same include . Now that the cycle tag\nis thread safe, this leakage no longer occurs. user_passes_test , login_required and permission_required ¶ django.contrib.auth.decorators provides the decorators login_required , permission_required and user_passes_test . Previously it was possible to use these\ndecorators both on functions (where the first argument is ‘request’)\nand on methods (where the first argument is ‘self’, and the second\nargument is ‘request’). Unfortunately, flaws were discovered in the\ncode supporting this: it only works in limited circumstances, and\nproduces errors that are very difficult to debug when it does not\nwork. For this reason, the ‘auto adapt’ behavior has been removed, and if\nyou are using these decorators on methods, you will need to manually\napply django.utils.decorators.method_decorator() to convert the\ndecorator to one that works with methods. For example, you would\nchange code from this: class MyClass ( object ): @login_required def my_view ( self , request ): pass to this: from django.utils.decorators import method_decorator class MyClass ( object ): @method_decorator ( login_required ) def my_view ( self , request ): pass or: from django.utils.decorators import method_decorator login_required_m = method_decorator ( login_required ) class MyClass ( object ): @login_required_m def my_view ( self , request ): pass For those of you who’ve been following the development trunk, this\nchange also applies to other decorators introduced since 1.1,\nincluding csrf_protect , cache_control and anything created\nusing decorator_from_middleware . if tag changes ¶ Due to new features in the if template tag, it no longer\naccepts ‘and’, ‘or’ and ‘not’ as valid variable names. Previously,\nthese strings could be used as variable names. Now, the keyword status\nis always enforced, and template code such as {% if not %} or {% if and %} will throw a TemplateSyntaxError . Also, in is a\nnew keyword and so is not a valid variable name in this tag. LazyObject ¶ LazyObject is an undocumented-but-often-used utility class used for lazily\nwrapping other objects of unknown type. In Django 1.1 and earlier, it handled introspection in a non-standard way,\ndepending on wrapped objects implementing a public method named get_all_members() . Since this could easily lead to name clashes, it has been\nchanged to use the standard Python introspection method, involving __members__ and __dir__() . If you used LazyObject in your own code\nand implemented the get_all_members() method for wrapped objects, you’ll need\nto make a couple of changes: First, if your class does not have special requirements for introspection (i.e.,\nyou have not implemented __getattr__() or other methods that allow for\nattributes not discoverable by normal mechanisms), you can simply remove the get_all_members() method. The default implementation on LazyObject will\ndo the right thing. If you have more complex requirements for introspection, first rename the get_all_members() method to __dir__() . This is the standard\nintrospection method for Python 2.6 and above. If you require support for Python\nversions earlier than 2.6, add the following code to the class: __members__ = property ( lambda self : self . __dir__ ()) __dict__ on model instances ¶ Historically, the __dict__ attribute of a model instance has only contained\nattributes corresponding to the fields on a model. In order to support multiple database configurations, Django 1.2 has\nadded a _state attribute to object instances. This attribute will\nappear in __dict__ for a model instance. If your code relies on\niterating over __dict__ to obtain a list of fields, you must now\nbe prepared to handle or filter out the _state attribute. Test runner exit status code ¶ The exit status code of the test runners ( tests/runtests.py and python manage.py test ) no longer represents the number of failed tests, because a\nfailure of 256 or more tests resulted in a wrong exit status code. The exit\nstatus code for the test runner is now 0 for success (no failing tests) and 1\nfor any number of test failures. If needed, the number of test failures can be\nfound at the end of the test runner’s output. Cookie encoding ¶ To fix bugs with cookies in Internet Explorer, Safari, and possibly\nother browsers, our encoding of cookie values was changed so that the\ncomma and semicolon are treated as non-safe characters, and are\ntherefore encoded as \\054 and \\073 respectively.  This could\nproduce backwards incompatibilities, especially if you are storing\ncomma or semi-colon in cookies and have JavaScript code that parses\nand manipulates cookie values client-side. ModelForm.is_valid() and ModelForm.errors ¶ Much of the validation work for ModelForms has been moved down to the model\nlevel. As a result, the first time you call ModelForm.is_valid() , access ModelForm.errors or otherwise trigger form validation, your model will be\ncleaned in-place. This conversion used to happen when the model was saved. If\nyou need an unmodified instance of your model, you should pass a copy to the ModelForm constructor. BooleanField on MySQL ¶ In previous versions of Django, a model’s BooleanField under MySQL\nwould return its value as either 1 or 0 , instead of True or False ; for most people this wasn’t a problem because bool is a subclass of int in Python. In Django 1.2, however, BooleanField on MySQL correctly returns a real bool .  The only\ntime this should ever be an issue is if you were expecting the repr of a BooleanField to print 1 or 0 . Changes to the interpretation of max_num in FormSets ¶ As part of enhancements made to the handling of FormSets, the default\nvalue and interpretation of the max_num parameter to the django.forms.formsets.formset_factory() and django.forms.models.modelformset_factory() functions has changed slightly. This\nchange also affects the way the max_num argument is used for\ninline admin objects. Previously, the default value for max_num was 0 (zero).\nFormSets then used the boolean value of max_num to determine if a\nlimit was to be imposed on the number of generated forms. The default\nvalue of 0 meant that there was no default limit on the number of\nforms in a FormSet. Starting with 1.2, the default value for max_num has been changed\nto None , and FormSets will differentiate between a value of None and a value of 0 . A value of None indicates that no\nlimit on the number of forms is to be imposed; a value of 0 indicates that a maximum of 0 forms should be imposed. This doesn’t\nnecessarily mean that no forms will be displayed – see the ModelFormSet documentation for more\ndetails. If you were manually specifying a value of 0 for max_num , you\nwill need to update your FormSet and/or admin definitions. See also JavaScript-assisted handling of inline related objects in the admin email_re ¶ An undocumented regular expression for validating email addresses has been moved\nfrom django.form.fields to django.core.validators . You will need to\nupdate your imports if you are using it. Features deprecated in 1.2 ¶ Finally, Django 1.2 deprecates some features from earlier releases.\nThese features are still supported, but will be gradually phased out\nover the next few release cycles. Code taking advantage of any of the features below will raise a PendingDeprecationWarning in Django 1.2. This warning will be\nsilent by default, but may be turned on using Python’s warnings module, or by running Python with a -Wd or -Wall flag. In Django 1.3, these warnings will become a DeprecationWarning ,\nwhich is not silent. In Django 1.4 support for these features will\nbe removed entirely. See also For more details, see the documentation Django’s release process and our deprecation timeline .` Specifying databases ¶ Prior to Django 1.2, Django used a number of settings to control\naccess to a single database. Django 1.2 introduces support for\nmultiple databases, and as a result the way you define database\nsettings has changed. Any existing Django settings file will continue to work as expected\nuntil Django 1.4. Until then, old-style database settings will be\nautomatically translated to the new-style format. In the old-style (pre 1.2) format, you had a number of DATABASE_ settings in your settings file. For example: DATABASE_NAME = \"test_db\" DATABASE_ENGINE = \"postgresql_psycopg2\" DATABASE_USER = \"myusername\" DATABASE_PASSWORD = \"s3krit\" These settings are now in a dictionary named DATABASES . Each item in the dictionary corresponds to a\nsingle database connection, with the name 'default' describing the\ndefault database connection. The setting names have also been\nshortened. The previous sample settings would now look like this: DATABASES = { \"default\" : { \"NAME\" : \"test_db\" , \"ENGINE\" : \"django.db.backends.postgresql_psycopg2\" , \"USER\" : \"myusername\" , \"PASSWORD\" : \"s3krit\" , } } This affects the following settings: Old setting New Setting DATABASE_ENGINE ENGINE DATABASE_HOST HOST DATABASE_NAME NAME DATABASE_OPTIONS OPTIONS DATABASE_PASSWORD PASSWORD DATABASE_PORT PORT DATABASE_USER USER TEST_DATABASE_CHARSET TEST_CHARSET TEST_DATABASE_COLLATION TEST_COLLATION TEST_DATABASE_NAME TEST_NAME These changes are also required if you have manually created a database\nconnection using DatabaseWrapper() from your database backend of choice. In addition to the change in structure, Django 1.2 removes the special\nhandling for the built-in database backends. All database backends\nmust now be specified by a fully qualified module name (i.e., django.db.backends.postgresql_psycopg2 , rather than just postgresql_psycopg2 ). postgresql database backend ¶ The psycopg1 library has not been updated since October 2005. As a\nresult, the postgresql database backend, which uses this library,\nhas been deprecated. If you are currently using the postgresql backend, you should\nmigrate to using the postgresql_psycopg2 backend. To update your\ncode, install the psycopg2 library and change the ENGINE setting to use django.db.backends.postgresql_psycopg2 . CSRF response-rewriting middleware ¶ CsrfResponseMiddleware , the middleware that automatically inserted\nCSRF tokens into POST forms in outgoing pages, has been deprecated\nin favor of a template tag method (see above), and will be removed\ncompletely in Django 1.4. CsrfMiddleware , which includes the\nfunctionality of CsrfResponseMiddleware and CsrfViewMiddleware , has likewise been deprecated. Also, the CSRF module has moved from contrib to core, and the old\nimports are deprecated, as described in the upgrading notes. Documentation removed The upgrade notes have been removed in current Django docs. Please refer\nto the docs for Django 1.3 or older to find these instructions. SMTPConnection ¶ The SMTPConnection class has been deprecated in favor of a generic\nemail backend API. Old code that explicitly instantiated an instance\nof an SMTPConnection: from django.core.mail import SMTPConnection connection = SMTPConnection () messages = get_notification_email () connection . send_messages ( messages ) …should now call get_connection() to\ninstantiate a generic email connection: from django.core.mail import get_connection connection = get_connection () messages = get_notification_email () connection . send_messages ( messages ) Depending on the value of the EMAIL_BACKEND setting, this\nmay not return an SMTP connection. If you explicitly require an SMTP\nconnection with which to send email, you can explicitly request an\nSMTP connection: from django.core.mail import get_connection connection = get_connection ( \"django.core.mail.backends.smtp.EmailBackend\" ) messages = get_notification_email () connection . send_messages ( messages ) If your call to construct an instance of SMTPConnection required\nadditional arguments, those arguments can be passed to the get_connection() call: connection = get_connection ( \"django.core.mail.backends.smtp.EmailBackend\" , hostname = \"localhost\" , port = 1234 ) User Messages API ¶ The API for storing messages in the user Message model (via user.message_set.create ) is now deprecated and will be removed in Django\n1.4 according to the standard release process . To upgrade your code, you need to replace any instances of this: user . message_set . create ( \"a message\" ) …with the following: from django.contrib import messages messages . add_message ( request , messages . INFO , \"a message\" ) Additionally, if you make use of the method, you need to replace the\nfollowing: for message in user . get_and_delete_messages (): ... …with: from django.contrib import messages for message in messages . get_messages ( request ): ... For more information, see the full messages documentation . You should begin to\nupdate your code to use the new API immediately. Date format helper functions ¶ django.utils.translation.get_date_formats() and django.utils.translation.get_partial_date_formats() have been deprecated\nin favor of the appropriate calls to django.utils.formats.get_format() ,\nwhich is locale-aware when USE_L10N is set to True , and falls\nback to default settings if set to False . To get the different date formats, instead of writing this: from django.utils.translation import get_date_formats date_format , datetime_format , time_format = get_date_formats () …use: from django.utils import formats date_format = formats . get_format ( \"DATE_FORMAT\" ) datetime_format = formats . get_format ( \"DATETIME_FORMAT\" ) time_format = formats . get_format ( \"TIME_FORMAT\" ) Or, when directly formatting a date value: from django.utils import formats value_formatted = formats . date_format ( value , \"DATETIME_FORMAT\" ) The same applies to the globals found in django.forms.fields : DEFAULT_DATE_INPUT_FORMATS DEFAULT_TIME_INPUT_FORMATS DEFAULT_DATETIME_INPUT_FORMATS Use django.utils.formats.get_format() to get the appropriate formats. Function-based test runners ¶ Django 1.2 changes the test runner tools to use a class-based\napproach. Old style function-based test runners will still work, but\nshould be updated to use the new class-based runners . Feed in django.contrib.syndication.feeds ¶ The django.contrib.syndication.feeds.Feed class has been\nreplaced by the django.contrib.syndication.views.Feed class.\nThe old feeds.Feed class is deprecated, and will be removed in\nDjango 1.4. The new class has an almost identical API, but allows instances to be\nused as views. For example, consider the use of the old framework in\nthe following URLconf : from django.conf.urls.defaults import * from myproject.feeds import LatestEntries , LatestEntriesByCategory feeds = { \"latest\" : LatestEntries , \"categories\" : LatestEntriesByCategory , } urlpatterns = patterns ( \"\" , # ... ( r \"^feeds/(?P<url>.*)/$\" , \"django.contrib.syndication.views.feed\" , { \"feed_dict\" : feeds }, ), # ... ) Using the new Feed class, these feeds can be deployed directly as views: from django.conf.urls.defaults import * from myproject.feeds import LatestEntries , LatestEntriesByCategory urlpatterns = patterns ( \"\" , # ... ( r \"^feeds/latest/$\" , LatestEntries ()), ( r \"^feeds/categories/(?P<category_id>\\d+)/$\" , LatestEntriesByCategory ()), # ... ) If you currently use the feed() view, the LatestEntries class would\noften not need to be modified apart from subclassing the new Feed class. The exception is if\nDjango was automatically working out the name of the template to use to render\nthe feed’s description and title elements (if you were not specifying the title_template and description_template attributes). You should ensure\nthat you always specify title_template and description_template attributes, or provide item_title() and item_description() methods. However, LatestEntriesByCategory uses the get_object() method\nwith the bits argument to specify a specific category to show. In\nthe new Feed class, get_object() method takes a request and arguments from the\nURL, so it would look like this: from django.contrib.syndication.views import Feed from django.shortcuts import get_object_or_404 from myproject.models import Category class LatestEntriesByCategory ( Feed ): def get_object ( self , request , category_id ): return get_object_or_404 ( Category , id = category_id ) # ... Additionally, the get_feed() method on Feed classes now take\ndifferent arguments, which may impact you if you use the Feed classes directly. Instead of just taking an optional url argument,\nit now takes two arguments: the object returned by its own get_object() method, and the current request object. To take into account Feed classes not being initialized for each\nrequest, the __init__() method now takes no arguments by default.\nPreviously it would have taken the slug from the URL and the request object. In accordance with RSS best practices , RSS feeds will now include\nan atom:link element. You may need to update your tests to take\nthis into account. For more information, see the full syndication framework\ndocumentation . Technical message IDs ¶ Up to version 1.1 Django used technical message IDs\nto provide localizers the possibility to translate date and time formats. They\nwere translatable translation strings that could\nbe recognized because they were all upper case (for example DATETIME_FORMAT , DATE_FORMAT , TIME_FORMAT ).\nThey have been deprecated in favor of the new Format localization infrastructure that allows localizers to specify that information in a formats.py file in the corresponding django/conf/locale/<locale name>/ directory. GeoDjango ¶ To allow support for multiple databases, the GeoDjango database internals were\nchanged substantially.  The largest backwards-incompatible change is that\nthe module django.contrib.gis.db.backend was renamed to django.contrib.gis.db.backends , where the full-fledged spatial database backends now exist.  The\nfollowing sections provide information on the most-popular APIs that\nwere affected by these changes. SpatialBackend ¶ Prior to the creation of the separate spatial backends, the django.contrib.gis.db.backend.SpatialBackend object was\nprovided as an abstraction to introspect on the capabilities of\nthe spatial database.  All of the attributes and routines provided by SpatialBackend are now a part of the ops attribute of the\ndatabase backend. The old module django.contrib.gis.db.backend is still provided\nfor backwards-compatibility access to a SpatialBackend object,\nwhich is just an alias to the ops module of the default spatial database connection. Users that were relying on undocumented modules and objects\nwithin django.contrib.gis.db.backend , rather the abstractions\nprovided by SpatialBackend , are required to modify their code.\nFor example, the following import which would work in 1.1 and\nbelow: from django.contrib.gis.db.backend.postgis import PostGISAdaptor Would need to be changed: from django.db import connection PostGISAdaptor = connection . ops . Adapter SpatialRefSys and GeometryColumns models ¶ In previous versions of GeoDjango, django.contrib.gis.db.models had SpatialRefSys and GeometryColumns models for querying\nthe OGC spatial metadata tables spatial_ref_sys and geometry_columns ,\nrespectively. While these aliases are still provided, they are only for the default database connection and exist only if the default connection\nis using a supported spatial database backend. Note Because the table structure of the OGC spatial metadata tables\ndiffers across spatial databases, the SpatialRefSys and GeometryColumns models can no longer be associated with\nthe gis application name.  Thus, no models will be returned\nwhen using the get_models method in the following example: >>> from django.db.models import get_app , get_models >>> get_models ( get_app ( \"gis\" )) [] To get the correct SpatialRefSys and GeometryColumns for your spatial database use the methods provided by the spatial backend: >>> from django.db import connections >>> SpatialRefSys = connections [ \"my_spatialite\" ] . ops . spatial_ref_sys () >>> GeometryColumns = connections [ \"my_postgis\" ] . ops . geometry_columns () Note When using the models returned from the spatial_ref_sys() and geometry_columns() method, you’ll still need to use the\ncorrect database alias when querying on the non-default connection.\nIn other words, to ensure that the models in the example above\nuse the correct database: sr_qs = SpatialRefSys . objects . using ( \"my_spatialite\" ) . filter ( ... ) gc_qs = GeometryColumns . objects . using ( \"my_postgis\" ) . filter ( ... ) Language code no ¶ The currently used language code for Norwegian Bokmål no is being\nreplaced by the more common language code nb . Function-based template loaders ¶ Django 1.2 changes the template loading mechanism to use a class-based\napproach. Old style function-based template loaders will still work, but should\nbe updated to use the new class-based template loaders.", "keywords": ["users", "supports_anonymous_user", "feed", "routines", "bigintegerfield", "safari", "feature", "stability", "formset", "login", "item_title", "messages", "formsets", "lots", "library", "humanize", "field", "#", "runner", "django.utils.decorators", "metadata", "handful", "pendingdeprecationwarning", "bits", "numbers", "django.utils.formats.get_format", "host", "lambda", "action", "range", "localizers", "get_prep_value", "compatibility", "platform", "words", "change", "colon", "spatial_filter", "coordinate", "suite", "s3krit", "ids", "changes", "=", "deprecates", "engine", "message", "categories", "ops", "latestentries", "clients", "date_format", "django.utils.translation.get_date_formats", "cookie-", "tables", "tag", "button", "django.contrib.auth.decorators", "dir", "database_engine", "db_type", "process", "debug", "choice", "login_required_m", "following", "type", "processing", "postgresql_psycopg2", "spatial_ref_sys", "calls", "custom", "people", "sr_qs", "objects", "documentation", "file", "customization", "work", "modules", "improvement", "fix", "django.contrib.gis.db.models", "user", "django.utils.translation", "fragment", "machinery", "get_prep", "permission_required", "attribute", "helper", "lazyobject", "mechanism", "csrf_protect", "maximum", "packages", "warning", "time", "tags", "save", "making", "render", "date", "setting", "operators", "account", "\\073", "things", "geometrycolumns", "may", "csrfmiddleware", "password", "name", "parameter", "my_spatialite", "feeds", "test_database_collation", "backends", "reference", "django.contrib.auth", "issue", "upgrade", "problems", "versions", "queries", "configurations", "django.contrib.admin", "addresses", "return", "memory", "test_database_charset", "modelformset", "question", "failure", "get_object_or_404", "store", "smtp", "category", "username", "status", "aliases", "pre", "bool", "url", "geometry", "module", "code", "databasewrapper", "auth", "safety", "pages", "filter", "style", "behavior", "c", "link", "display", "class", "access", "subtemplate.html", "info", "false", "i", "warnings", "names", "advent", "javascript", "geography", "u", "attack", "modelform.is_valid", "request", "formatting", "user.message_set.create", "database", "flag", "output", "*", "latest/$", "test", "postgresql", "use_l10n", "strings", "elements", "subclass", "admin", "spatialrefsys", "creation", "django.contrib.gis.db.backends", ".", "foundation", "adapter", "script", "limit", "category_id", "thread", "accordance", "validation", "include", "modelforms", "geoqueryset", "source", "mail", "use", "environment", "bokmål", "credentials", "imports", "subclasses", "performance", "protection", "message.recipient", "releases", "core", "pass", "reverse_geom", "order", "default", "loader", "alias", "atom", "bug", "form", "option", "format", "latestentriesbycategory", "expression", "characters", "classes", "tests", "comma", "^feeds/(?p", "cross", "add_message", "browsers", "fixture", "considerations", "booleanfield", "feed_dict", "advantage", "scheme", "get_models", "django.contrib.gis.db.backends.postgis", "user.email", "csrfviewmiddleware", "template", "rss", "way", "internet", "console", "formats", "endfor", "gdal", "email_re", "modeladmin.readonly_fields", "old", "syndication", "microseconds", "possibility", "party", "trunk", "queryset", "runners", "session", "¶", "prototype", "sandbox", "templatesyntaxerror", "internationalization", "django.conf.urls.defaults", "disk", "post", "october", "int", "property", "side", "tutorials", "subtemplates", "function", "implementations", "views", "result", "view", "control", "run", "number", "cycles", "permissions", "modelform", "def", "values", "enhancements", "failures", "@login_required_m", "django.contrib", "_", "user_passes_test", "introspection", "database_password", "aggregate", "overview", "timeline", "smtpconnection", "thing", "locale/<locale", "favor", "auto", "connections", "databases", "smart", "debut", "get_notification_email", "django.forms.fields", "inlines", "table", "language", "facilities", "models", "copy", "myusername", "exit", "version", "ways", "level", "anonymoususer", "loading", "get_date_formats", "hostname", "transition", "deprecation", "@method_decorator", "django", "series", "csrfresponsemiddleware", "n’t", "div", "fields", "conversions", "email_backend", "languages", "fixes", "development", "operating", "colors", "urlpatterns", "gc_qs", "value", "get_and_delete_messages", "line", "bit", "django.shortcuts", "policy", "corresponds", "data", "browser", "implementation", "messaging", "item", "datetime", "subcommand", "enabling", "backend", "node", "get_connection", "layer", "inline", "clashes", "psycopg1", "highlight", "add", "security", "self", "need", "instance", "members", "today", "localization", "geometries", "handling", "interface", "readability", "mechanisms", "validators", "django.contrib.syndication.feeds", "|", "extent3d", "modeladmin", "forgery", "functionality", "item_description", "bugs", "docs", "django.contrib.gis.db.backends.oracle", "issues", "decorator", "decorator_from_middleware", "ogc", "constructor", "^feeds", "object_list", "assumptions", "instances", "iso", "deprecationwarning", "structure", "runtests.py", "get_app", "part", "fixtures", "abstractions", "references", "object", "couple", "highlights", "database_options", "response", "internals", "loaders", "website", "interpretation", "instructions", "utility", "dictionary", "vendors", "authors", "requests", "locale", "tokens", "modelform.errors", "rendering", "keyword", "norwegian", "csrf", "get_db_prep_value", "conversion", "ctrl", "others", "rules", "decorators", "notes", "django.contrib.gis.db.backends.spatialite", "effect", "interruption", "system", "apps", "port", "practices", "my_postgis", "myclass", "manner", "conf", "django.core.mail", "postgisadaptor", "lookup_type", "usernames", "test_database_name", "features", "site", "forms", "categories/(?p", "addition", "lists", "example", "explorer", "test_db", "hooks", "requirements", "locations", "list", "sample", "get_all_members", "send_messages", "get_db_prep", "email", "preparation", "get_feed", "incompatibilities", "django.utils.translation.get_partial_date_formats", "model", "variable", "year", "sections", "apis", "place", "systems", "django.forms.models.modelformset_factory", "emailbackend", "django.core.validators", "element", "application", "encoding", "flow", "login_required", "django.contrib.auth.models", "attributes", "approach", "django.contrib.gis.db.backend.postgis", "title", "release", "ability", "globals", "localhost", "template_loaders", "urlconf", "url>.*)/$", "django-admin.py", "geos", "custommodelfield", "syntax", "translation", "capabilities", "circumstances", "default_time_input_formats", "get_prep_lookup", "trend", "keys", "adapt", "case", "get_object", "authentication", "lookup", "authorization", "conjunction", "slug", "using", "technique", "errors", "datetime_format", "arguments", "init", "middleware", "django.form.fields", "end", "contrib", "comparison", "depth", "functions", "key", "abstraction", "renderer", "success", "my_view", "none", "django.contrib.syndication.views", "filters", "highlighting", "method_decorator", "problem", "roadmap", "myproject.models", "renderings", "patterns", "definitions", "infrastructure", "reason", "spatialbackend", "framework", "provider", "leakage", "django.utils.decorators.method_decorator", "semicolon", "new", "true", "api", "geometryfield", "support", "description", "cookies", "projects", "django.db.backends.postgresql_psycopg2", "max_num", "-", "connection", "repr", "django.utils", "cycle", "permission", "alternative", "django.contrib.gis.db.backends.mysql", "import", "django.contrib.gis.db.backend", "d", "django.forms.formsets.formset_factory", "mysql", "directory", "%", "call", "get_messages", "information", "flaws", "python", "methods", "options", "geometry_columns", "exception", "upgrading", "client", "details", "shift", "method", "geodjango", "myproject.feeds", "settings", "argument", "articles", "cookie", "note", "state", "attacks", "tools", "distance", "templates", "project", "parts"], "type": "documentation"},
{"title": "Django 3.0.1 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/3.0.1/", "content": "Django 3.0.1 release notes ¶ December 18, 2019 Django 3.0.1 fixes a security issue and several bugs in 3.0. CVE-2019-19844: Potential account hijack via password reset form ¶ By submitting a suitably crafted email address making use of Unicode\ncharacters, that compared equal to an existing user email when lower-cased for\ncomparison, an attacker could be sent a password reset token for the matched\naccount. In order to avoid this vulnerability, password reset requests now compare the\nsubmitted email using the stricter, recommended algorithm for case-insensitive\ncomparison of two identifiers from Unicode Technical Report 36, section\n2.11.2(B)(2) . Upon a match, the email containing the reset token will be\nsent to the email address on record rather than the submitted address. Bugfixes ¶ Fixed a regression in Django 3.0 by restoring the ability to use Django\ninside Jupyter and other environments that force an async context, by adding\nan option to disable Async safety mechanism with DJANGO_ALLOW_ASYNC_UNSAFE environment variable ( #31056 ). Fixed a regression in Django 3.0 where RegexPattern , used by re_path() , returned positional arguments to be passed to\nthe view when all optional named groups were missing ( #31061 ). Reallowed, following a regression in Django 3.0, Window expressions to be used in\nconditions outside of queryset filters, e.g. in When conditions ( #31060 ). Fixed a data loss possibility in SplitArrayField . When using with ArrayField(BooleanField()) , all values after the first True value\nwere marked as checked instead of preserving passed values ( #31073 ).", "keywords": ["hijack", "jupyter", "arguments", "variable", "view", "bugfixes", "password", "security", "regression", "context", "groups", "comparison", "django", "vulnerability", "requests", "regexpattern", "reset", "conditions", "splitarrayfield", "values", "release", "order", "algorithm", "issue", "ability", "safety", "user", "report", "cve-2019", "unicode", "identifiers", "window", "possibility", "form", "record", "bugs", "option", "mechanism", "queryset", "filters", "loss", "characters", "re_path", "value", "section", "¶", "attacker", "django_allow_async_unsafe", "expressions", "case", "address", "technical", "environments", "data", "december", "arrayfield(booleanfield", "3.0.1", "use", "email", "account", "match", "environment"], "type": "documentation"},
{"title": "Unit tests | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/internals/contributing/writing-code/unit-tests/", "content": "Unit tests ¶ Django comes with a test suite of its own, in the tests directory of the\ncode base. It’s our policy to make sure all tests pass at all times. We appreciate any and all contributions to the test suite! The Django tests all use the testing infrastructure that ships with Django for\ntesting applications. See Writing and running tests for an explanation of\nhow to write new tests. Running the unit tests ¶ Quickstart ¶ First, fork Django on GitHub . Second, create and activate a virtual environment. If you’re not familiar with\nhow to do that, read our contributing tutorial . Next, clone your fork, install some requirements, and run the tests: /  $ git clone https://github.com/YourGitHubName/django.git django-repo $ cd django-repo/tests $ python -m pip install -e .. $ python -m pip install -r requirements/py3.txt $ ./runtests.py ...\\> git clone https://github.com/YourGitHubName/django.git django-repo ...\\> cd django-repo\\tests ...\\> py -m pip install -e .. ...\\> py -m pip install -r requirements\\py3.txt ...\\> runtests.py Installing the requirements will likely require some operating system packages\nthat your computer doesn’t have installed. You can usually figure out which\npackage to install by doing a web search for the last line or so of the error\nmessage. Try adding your operating system to the search query if needed. If you have trouble installing the requirements, you can skip that step. See Running all the tests for details on installing the optional\ntest dependencies. If you don’t have an optional dependency installed, the\ntests that require it will be skipped. Running the tests requires a Django settings module that defines the databases\nto use. To help you get started, Django provides and uses a sample settings\nmodule that uses the SQLite database. See Using another settings module to\nlearn how to use a different settings module to run the tests with a different\ndatabase. Having problems? See Troubleshooting for some common issues. Running tests using tox ¶ Tox is a tool for running tests in different virtual\nenvironments. Django includes a basic tox.ini that automates some checks\nthat our build server performs on pull requests. To run the unit tests and\nother checks (such as import sorting , the documentation spelling checker , and code formatting ), install and run the tox command from any place in the Django source tree: /  $ python -m pip install tox $ tox ...\\> py -m pip install tox ...\\> tox By default, tox runs the test suite with the bundled test settings file for\nSQLite, black , blacken-docs , flake8 , isort , and the\ndocumentation spelling checker. In addition to the system dependencies noted\nelsewhere in this documentation, the command python3 must be on your path\nand linked to the appropriate version of Python. A list of default environments\ncan be seen as follows: /  $ tox -l py3 black blacken-docs flake8>=3.7.0 docs isort>=5.1.0 ...\\> tox -l py3 black blacken-docs flake8> =3.7.0 docs isort> =5.1.0 Testing other Python versions and database backends ¶ In addition to the default environments, tox supports running unit tests\nfor other versions of Python and other database backends. Since Django’s test\nsuite doesn’t bundle a settings file for database backends other than SQLite,\nhowever, you must create and provide your own test settings . For example, to run the tests on Python 3.10\nusing PostgreSQL: /  $ tox -e py310-postgres -- --settings = my_postgres_settings ...\\> tox -e py310-postgres -- --settings=my_postgres_settings This command sets up a Python 3.10 virtual environment, installs Django’s\ntest suite dependencies (including those for PostgreSQL), and calls runtests.py with the supplied arguments (in this case, --settings=my_postgres_settings ). The remainder of this documentation shows commands for running tests without tox , however, any option passed to runtests.py can also be passed to tox by prefixing the argument list with -- , as above. Tox also respects the DJANGO_SETTINGS_MODULE environment\nvariable, if set. For example, the following is equivalent to the command\nabove: $ DJANGO_SETTINGS_MODULE = my_postgres_settings tox -e py310-postgres Windows users should use: ...\\> set DJANGO_SETTINGS_MODULE = my_postgres_settings ...\\> tox -e py310-postgres Running the JavaScript tests ¶ Django includes a set of JavaScript unit tests for\nfunctions in certain contrib apps. The JavaScript tests aren’t run by default\nusing tox because they require Node.js to be installed and aren’t\nnecessary for the majority of patches. To run the JavaScript tests using tox : /  $ tox -e javascript ...\\> tox -e javascript This command runs npm install to ensure test requirements are up to\ndate and then runs npm test . Running tests using django-docker-box ¶ django-docker-box allows you to run the Django’s test suite across all\nsupported databases and python versions. See the django-docker-box project\npage for installation and usage instructions. Using another settings module ¶ The included settings module ( tests/test_sqlite.py ) allows you to run the\ntest suite using SQLite. If you want to run the tests using a different\ndatabase, you’ll need to define your own settings file. Some tests, such as\nthose for contrib.postgres , are specific to a particular database backend\nand will be skipped if run with a different backend. Some tests are skipped or\nexpected failures on a particular database backend (see DatabaseFeatures.django_test_skips and DatabaseFeatures.django_test_expected_failures on each backend). To run the tests with different settings, ensure that the module is on your PYTHONPATH and pass the module with --settings . The DATABASES setting in any test settings module needs to define\ntwo databases: A default database. This database should use the backend that\nyou want to use for primary testing. A database with the alias other . The other database is used to test\nthat queries can be directed to different databases. This database should use\nthe same backend as the default , and it must have a different name. If you’re using a backend that isn’t SQLite, you will need to provide other\ndetails for each database: The USER option needs to specify an existing user account\nfor the database. That user needs permission to execute CREATE DATABASE so that the test database can be created. The PASSWORD option needs to provide the password for\nthe USER that has been specified. Test databases get their names by prepending test_ to the value of the NAME settings for the databases defined in DATABASES .\nThese test databases are deleted when the tests are finished. You will also need to ensure that your database uses UTF-8 as the default\ncharacter set. If your database server doesn’t use UTF-8 as a default charset,\nyou will need to include a value for CHARSET in the\ntest settings dictionary for the applicable database. Running only some of the tests ¶ Django’s entire test suite takes a while to run, and running every single test\ncould be redundant if, say, you just added a test to Django that you want to\nrun quickly without running everything else. You can run a subset of the unit\ntests by appending the names of the test modules to runtests.py on the\ncommand line. For example, if you’d like to run tests only for generic relations and\ninternationalization, type: /  $ ./runtests.py --settings = path.to.settings generic_relations i18n ...\\> runtests.py --settings=path.to.settings generic_relations i18n How do you find out the names of individual tests? Look in tests/ — each\ndirectory name there is the name of a test. If you want to run only a particular class of tests, you can specify a list of\npaths to individual test classes. For example, to run the TranslationTests of the i18n module, type: /  $ ./runtests.py --settings = path.to.settings i18n.tests.TranslationTests ...\\> runtests.py --settings=path.to.settings i18n.tests.TranslationTests Going beyond that, you can specify an individual test method like this: /  $ ./runtests.py --settings = path.to.settings i18n.tests.TranslationTests.test_lazy_objects ...\\> runtests.py --settings=path.to.settings i18n.tests.TranslationTests.test_lazy_objects You can run tests starting at a specified top-level module with --start-at option. For example: /  $ ./runtests.py --start-at = wsgi ...\\> runtests.py --start-at=wsgi You can also run tests starting after a specified top-level module with --start-after option. For example: /  $ ./runtests.py --start-after = wsgi ...\\> runtests.py --start-after=wsgi Note that the --reverse option doesn’t impact on --start-at or --start-after options. Moreover these options cannot be used with test\nlabels. Running the Selenium tests ¶ Some tests require Selenium and a web browser. To run these tests, you must\ninstall the selenium package and run the tests with the --selenium=<BROWSERS> option. For example, if you have Firefox and Google\nChrome installed: /  $ ./runtests.py --selenium = firefox,chrome ...\\> runtests.py --selenium=firefox,chrome See the selenium.webdriver package for the list of available browsers. Specifying --selenium automatically sets --tags=selenium to run only\nthe tests that require selenium. Some browsers (e.g. Chrome or Firefox) support headless testing, which can be\nfaster and more stable. Add the --headless option to enable this mode. For testing changes to the admin UI, the selenium tests can be run with the --screenshots option enabled. Screenshots will be saved to the tests/screenshots/ directory. To define when screenshots should be taken during a selenium test, the test\nclass must use the @django.test.selenium.screenshot_cases decorator with a\nlist of supported screenshot types ( \"desktop_size\" , \"mobile_size\" , \"small_screen_size\" , \"rtl\" , \"dark\" , and \"high_contrast\" ). It\ncan then call self.take_screenshot(\"unique-screenshot-name\") at the desired\npoint to generate the screenshots. For example: from django.test.selenium import SeleniumTestCase , screenshot_cases from django.urls import reverse class SeleniumTests ( SeleniumTestCase ): @screenshot_cases ([ \"desktop_size\" , \"mobile_size\" , \"rtl\" , \"dark\" , \"high_contrast\" ]) def test_login_button_centered ( self ): self . selenium . get ( self . live_server_url + reverse ( \"admin:login\" )) self . take_screenshot ( \"login\" ) ... This generates multiple screenshots of the login page - one for a desktop\nscreen, one for a mobile screen, one for right-to-left languages on desktop,\none for the dark mode on desktop, and one for high contrast mode on desktop\nwhen using chrome. Changed in Django 5.1: The --screenshots option and @screenshot_cases decorator were\nadded. Running all the tests ¶ If you want to run the full suite of tests, you’ll need to install a number of\ndependencies: aiosmtpd argon2-cffi 19.2.0+ asgiref 3.8.1+ (required) bcrypt colorama 0.4.6+ docutils 0.19+ geoip2 Jinja2 2.11+ numpy Pillow 6.2.1+ PyYAML pywatchman redis 3.4+ setuptools python-memcached , plus a supported Python binding gettext ( gettext on Windows ) selenium 4.8.0+ sqlparse 0.3.1+ (required) tblib 1.5.0+ You can find these dependencies in pip requirements files inside the tests/requirements directory of the Django source tree and install them\nlike so: /  $ python -m pip install -r tests/requirements/py3.txt ...\\> py -m pip install -r tests\\requirements\\py3.txt If you encounter an error during the installation, your system might be missing\na dependency for one or more of the Python packages. Consult the failing\npackage’s documentation or search the web with the error message that you\nencounter. You can also install the database adapter(s) of your choice using oracle.txt , mysql.txt , or postgres.txt . If you want to test the memcached or Redis cache backends, you’ll also need to\ndefine a CACHES setting that points at your memcached or Redis\ninstance respectively. To run the GeoDjango tests, you will need to set up a spatial database\nand install the Geospatial libraries . Each of these dependencies is optional. If you’re missing any of them, the\nassociated tests will be skipped. To run some of the autoreload tests, you’ll need to install the Watchman service. Code coverage ¶ Contributors are encouraged to run coverage on the test suite to identify areas\nthat need additional tests. The coverage tool installation and use is described\nin testing code coverage . To run coverage on the Django test suite using the standard test settings: /  $ coverage run ./runtests.py --settings = test_sqlite ...\\> coverage run runtests.py --settings=test_sqlite After running coverage, combine all coverage statistics by running: /  $ coverage combine ...\\> coverage combine After that generate the html report by running: /  $ coverage html ...\\> coverage html When running coverage for the Django tests, the included .coveragerc settings file  defines coverage_html as the output directory for the report\nand also excludes several directories not relevant to the results\n(test code or external code included in Django). Contrib apps ¶ Tests for contrib apps can be found in the tests/ directory, typically\nunder <app_name>_tests . For example, tests for contrib.auth are located\nin tests/auth_tests . Troubleshooting ¶ Test suite hangs or shows failures on main branch ¶ Ensure you have the latest point release of a supported Python version , since there are often bugs in earlier versions\nthat may cause the test suite to fail or hang. On macOS (High Sierra and newer versions), you might see this message\nlogged, after which the tests hang: objc[42074]: +[__NSPlaceholderDate initialize] may have been in progress in another thread when fork() was called. To avoid this set a OBJC_DISABLE_INITIALIZE_FORK_SAFETY environment\nvariable, for example: $ OBJC_DISABLE_INITIALIZE_FORK_SAFETY = YES ./runtests.py Or add export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES to your shell’s\nstartup file (e.g. ~/.profile ). Many test failures with UnicodeEncodeError ¶ If the locales package is not installed, some tests will fail with a UnicodeEncodeError . You can resolve this on Debian-based systems, for example, by running: $ apt-get install locales $ dpkg-reconfigure locales You can resolve this for macOS systems by configuring your shell’s locale: $ export LANG = \"en_US.UTF-8\" $ export LC_ALL = \"en_US.UTF-8\" Run the locale command to confirm the change. Optionally, add those export\ncommands to your shell’s startup file (e.g. ~/.bashrc for Bash) to avoid\nhaving to retype them. Tests that only fail in combination ¶ In case a test passes when run in isolation but fails within the whole suite,\nwe have some tools to help analyze the problem. The --bisect option of runtests.py will run the failing test while\nhalving the test set it is run together with on each iteration, often making\nit possible to identify a small number of tests that may be related to the\nfailure. For example, suppose that the failing test that works on its own is ModelTest.test_eq , then using: /  $ ./runtests.py --bisect basic.tests.ModelTest.test_eq ...\\> runtests.py --bisect basic.tests.ModelTest.test_eq will try to determine a test that interferes with the given one. First, the\ntest is run with the first half of the test suite. If a failure occurs, the\nfirst half of the test suite is split in two groups and each group is then run\nwith the specified test. If there is no failure with the first half of the test\nsuite, the second half of the test suite is run with the specified test and\nsplit appropriately as described earlier. The process repeats until the set of\nfailing tests is minimized. The --pair option runs the given test alongside every other test from the\nsuite, letting you check if another test has side-effects that cause the\nfailure. So: /  $ ./runtests.py --pair basic.tests.ModelTest.test_eq ...\\> runtests.py --pair basic.tests.ModelTest.test_eq will pair test_eq with every test label. With both --bisect and --pair , if you already suspect which cases\nmight be responsible for the failure, you may limit tests to be cross-analyzed\nby specifying further test labels after\nthe first one: /  $ ./runtests.py --pair basic.tests.ModelTest.test_eq queries transactions ...\\> runtests.py --pair basic.tests.ModelTest.test_eq queries transactions You can also try running any set of tests in a random or reverse order using\nthe --shuffle and --reverse options. This can help verify that\nexecuting tests in a different order does not cause any trouble: /  $ ./runtests.py basic --shuffle $ ./runtests.py basic --reverse ...\\> runtests.py basic --shuffle ...\\> runtests.py basic --reverse Seeing the SQL queries run during a test ¶ If you wish to examine the SQL being run in failing tests, you can turn on SQL logging using the --debug-sql option. If you\ncombine this with --verbosity=2 , all SQL queries will be output: /  $ ./runtests.py basic --debug-sql ...\\> runtests.py basic --debug-sql Seeing the full traceback of a test failure ¶ By default tests are run in parallel with one process per core. When the tests\nare run in parallel, however, you’ll only see a truncated traceback for any\ntest failures. You can adjust this behavior with the --parallel option: /  $ ./runtests.py basic --parallel = 1 ...\\> runtests.py basic --parallel=1 You can also use the DJANGO_TEST_PROCESSES environment variable for\nthis purpose. Tips for writing tests ¶ Isolating model registration ¶ To avoid polluting the global apps registry and prevent\nunnecessary table creation, models defined in a test method should be bound to\na temporary Apps instance. To do this, use the isolate_apps() decorator: from django.db import models from django.test import SimpleTestCase from django.test.utils import isolate_apps class TestModelDefinition ( SimpleTestCase ): @isolate_apps ( \"app_label\" ) def test_model_definition ( self ): class TestModel ( models . Model ): pass ... Setting app_label Models defined in a test method with no explicit app_label are automatically assigned the\nlabel of the app in which their test class is located. In order to make sure the models defined within the context of isolate_apps() instances are correctly\ninstalled, you should pass the set of targeted app_label as arguments: tests/app_label/tests.py ¶ from django.db import models from django.test import SimpleTestCase from django.test.utils import isolate_apps class TestModelDefinition ( SimpleTestCase ): @isolate_apps ( \"app_label\" , \"other_app_label\" ) def test_model_definition ( self ): # This model automatically receives app_label='app_label' class TestModel ( models . Model ): pass class OtherAppModel ( models . Model ): class Meta : app_label = \"other_app_label\" ...", "keywords": ["users", "box", "6.2.1", "login", "startup", "basic.tests", "pillow", "5.1.0", "tests\\requirements\\py3.txt", "#", "./runtests.py", "django_settings_module", "lc_all", "--bisect", "python3", "subset", "cache", "tool", "django.urls", "sierra", "change", "app_label='app_label", "suite", "ui", "label", "screenshot", "test_model_definition", "=", "changes", "prevent", "results", "message", "installation", "shell", "character", "contributors", "postgres", "pip", "--debug", "process", "tox.ini", "fork", "choice", "docker", "charset", "following", "type", "documentation", "generic_relations", "high_contrast", "file", "desktop_size", "modules", "user", "cases", "packages", "tox", "install", "date", "setting", "account", "self.take_screenshot(\"unique", "app_label", "other_app_label", "service", "--selenium=<browsers", "password", "name", "backends", "web", "contrib.postgres", "seleniumtests", "problems", "versions", "queries", "simpletestcase", "majority", "github", "applications", "tutorial", "environments", "search", "isolation", "live_server_url", "test_sqlite.py", "failure", "--tags", "test_eq", "tree", "error", "module", "code", "django_test_processes", "isolate_apps", "behavior", "class", "group", "pull", "names", "javascript", "contributions", "--shuffle", "formatting", "database", "output", "query", "page", "test", "commands", "postgresql", "types", "geoip2", "locales", "py", "@screenshot_cases", "admin", "creation", "usage", "registry", "wsgi", "step", "seleniumtestcase", "thread", "writing", "git", "create", "branch", "/", "source", "3.8.1", "high", "use", "cffi", "flake8>=3.7.0", "environment", "rtl", "testmodeldefinition", "gettext", "explanation", "--pair", "core", "pass", "statistics", "order", "default", "npm", "alias", "spelling", "pywatchman", "option", "objc[42074", "classes", "tests", "py3", "computer", "bcrypt", "browsers", "lang", "checker", "contrib.auth", "--parallel=1", "combination", "isort>=5.1.0", "traceback", "utf-8", "checks", "aiosmtpd", "remainder", "macos", "¶", "command", "internationalization", "path.to.settings", "side", "py3.txt", "testing", "number", "right", "relations", "def", "point", "failures", "tblib", "directories", "_", "windows", "test_sqlite", "-r", "bash", "@django.test.selenium.screenshot_cases", "databases", "jinja2", "trouble", "unit", "libraries", "table", "models", "version", "level", "screenshots", ".coveragerc", "labels", "nsplaceholderdate", "django", "screenshot_cases", "--headless", "languages", "set", "node.js", "operating", "modeltest.test_eq", "databasefeatures.django_test_skips", "value", "line", "policy", "browser", "base", "backend", "tips", "unicodeencodeerror", "paths", "self", "instance", "effects", "desktop", "report", "coverage", "redis", "auth_tests", "bugs", "docs", "ensure", "issues", "decorator", "dpkg", "instances", "runtests.py", "areas", "geospatial", "dependency", "patches", "argon2", "colorama", "groups", "@isolate_apps", "databasefeatures.django_test_expected_failures", "instructions", "sql", "requests", "my_postgres_settings", "points", "locale", "app_name>_tests", "contrast", "small_screen_size", "registration", "reconfigure", "otherappmodel", "translationtests", "system", "apps", "initialize", "watchman", "dependencies", "autoreload", "cd", "py310", "addition", "example", "app", "progress", "i18n", "requirements", "parallel", "list", "sample", "export", "while", "--settings", "google", "variable", "debian", "model", "place", "systems", "release", "--start", "0.3.1", "sorting", "case", "objc_disable_initialize_fork_safety", "i18n.tests", "html", "screen", "server", "arguments", "package", "sqlite", "contrib", "path", "functions", "build", "chrome", "0.4.6", "problem", "meta", "19.2.0", "infrastructure", "django.test.utils", "quickstart", "caches", "\\", "isort", "support", "mode", "transactions", "-", "context", "permission", "import", "files", "iteration", "directory", "at", "python", "flake8", "pythonpath", "--selenium", "options", "times", "purpose", "firefox", "details", "method", "geodjango", "half", "settings", "ships", "argument", "django.db", "clone", "note", "tools", "testmodel", "selenium", "project"], "type": "documentation"},
{"title": "FAQ: Using Django | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/faq/usage/", "content": "FAQ: Using Django ¶ Why do I get an error about importing DJANGO_SETTINGS_MODULE ? ¶ Make sure that: The environment variable DJANGO_SETTINGS_MODULE is set to a\nfully-qualified Python module (i.e. mysite.settings ). Said module is on sys.path ( import mysite.settings should work). The module doesn’t contain syntax errors. I can’t stand your template language. Do I have to use it? ¶ We happen to think our template engine is the best thing since chunky bacon,\nbut we recognize that choosing a template language runs close to religion.\nThere’s nothing about Django that requires using the template language, so\nif you’re attached to Jinja2, Mako, or whatever, feel free to use those. Do I have to use your model/database layer? ¶ Nope. Just like the template system, the model/database layer is decoupled from\nthe rest of the framework. The one exception is: If you use a different database library, you won’t get to\nuse Django’s automatically-generated admin site. That app is coupled to the\nDjango database layer. How do I use image and file fields? ¶ Using a FileField or an ImageField in a model takes a few steps: In your settings file, you’ll need to define MEDIA_ROOT as\nthe full path to a directory where you’d like Django to store uploaded\nfiles. (For performance, these files are not stored in the database.)\nDefine MEDIA_URL as the base public URL of that directory.\nMake sure that this directory is writable by the web server’s user\naccount. Add the FileField or ImageField to your model, defining the upload_to option to specify a\nsubdirectory of MEDIA_ROOT to use for uploaded files. All that will be stored in your database is a path to the file\n(relative to MEDIA_ROOT ). You’ll most likely want to use the\nconvenience url attribute\nprovided by Django. For example, if your ImageField is called mug_shot , you can get\nthe absolute path to your image in a template with {{ object.mug_shot.url }} . How do I make a variable available to all my templates? ¶ Sometimes your templates all need the same thing. A common example would be\ndynamically generated menus. At first glance, it seems logical to add a common\ndictionary to the template context. The best way to do this in Django is to use a RequestContext . Details on\nhow to do this are here: Using RequestContext .", "keywords": ["server", "variable", "model", "imagefield", "context", "admin", "filefield", "import", "files", "performance", "image", "template", "religion", "sys.path", "directory", "file", "url", "dictionary", "error", "django", "module", "media_url", "mysite.settings", "way", "glance", "chunky", "site", "web", "python", "fields", "engine", "library", "user", "requestcontext", "path", "convenience", "example", "app", "exception", "object.mug_shot.url", "upload_to", "mako", "attribute", "syntax", "subdirectory", "details", "option", "thing", "nope", "rest", "settings", "menus", "¶", "jinja2", "layer", "django_settings_module", "system", "framework", "define", "database", "templates", "faq", "language", "steps", "account", "errors", "bacon", "environment"], "type": "documentation"},
{"title": "How to install Django on Windows | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/windows/", "content": "How to install Django on Windows ¶ This document will guide you through installing Python 3.13 and Django on\nWindows. It also provides instructions for setting up a virtual environment,\nwhich makes it easier to work on Python projects. This is meant as a beginner’s\nguide for users working on Django projects and does not reflect how Django\nshould be installed when developing changes for Django itself. The steps in this guide have been tested with Windows 10. In other\nversions, the steps would be similar. You will need to be familiar with using\nthe Windows command prompt. Install Python ¶ Django is a Python web framework, thus requiring Python to be installed on your\nmachine. At the time of writing, Python 3.13 is the latest version. To install Python on your machine go to https://www.python.org/downloads/ . The\nwebsite should offer you a download button for the latest Python version.\nDownload the executable installer and run it. Check the boxes next to “Install\nlauncher for all users (recommended)” then click “Install Now”. After installation, open the command prompt and check that the Python version\nmatches the version you installed by executing: ...\\> py --version py is not recognized or found Depending on how you’ve installed Python (such as via the Microsoft Store), py may not be available in the command prompt. You will then need to use python instead of py when entering\ncommands. See also For more details, see Using Python on Windows documentation. About pip ¶ pip is a package manager for Python and is included by default with the\nPython installer. It helps to install and uninstall Python packages\n(such as Django!). For the rest of the installation, we’ll use pip to\ninstall Python packages from the command line. Setting up a virtual environment ¶ It is best practice to provide a dedicated environment for each Django project\nyou create. There are many options to manage environments and packages within\nthe Python ecosystem, some of which are recommended in the Python\ndocumentation .\nPython itself comes with venv for managing\nenvironments which we will use for this guide. To create a virtual environment for your project, open a new command prompt,\nnavigate to the folder where you want to create your project and then enter the\nfollowing: ...\\> py -m venv project-name This will create a folder called ‘project-name’ if it does not already exist\nand set up the virtual environment. To activate the environment, run: ...\\> project-name\\Scripts\\activate.bat The virtual environment will be activated and you’ll see “(project-name)” next\nto the command prompt to designate that. Each time you start a new command\nprompt, you’ll need to activate the environment again. Install Django ¶ Django can be installed easily using pip within your virtual environment. In the command prompt, ensure your virtual environment is active, and execute\nthe following command: ...\\> py -m pip install Django This will download and install the latest Django release. After the installation has completed, you can verify your Django installation\nby executing django-admin --version in the command prompt. See Get your database running for information on database installation\nwith Django. Colored terminal output ¶ A quality-of-life feature adds colored (rather than monochrome) output to the\nterminal. In modern terminals this should work for both CMD and PowerShell. If\nfor some reason this needs to be disabled, set the environmental variable DJANGO_COLORS to nocolor . On older Windows versions, or legacy terminals, colorama 0.4.6+ must be\ninstalled to enable syntax coloring: ...\\> py -m pip install \"colorama >= 0.4.6\" See Syntax coloring for more information on color settings. Common pitfalls ¶ If django-admin only displays the help text no matter what arguments\nit is given, there is probably a problem with the file association in\nWindows. Check if there is more than one environment variable set for\nrunning Python scripts in PATH . This usually occurs when there is more\nthan one Python version installed. If you are connecting to the internet behind a proxy, there might be problems\nin running the command py -m pip install Django . Set the environment\nvariables for proxy configuration in the command prompt as follows: ...\\> set http_proxy = http://username:password@proxyserver:proxyport ...\\> set https_proxy = https://username:password@proxyserver:proxyport In general, Django assumes that UTF-8 encoding is used for I/O. This may\ncause problems if your system is set to use a different encoding. Recent\nversions of Python allow setting the PYTHONUTF8 environment\nvariable in order to force a UTF-8 encoding. Windows 10 also provides a\nsystem-wide setting by checking Use Unicode UTF-8 for worldwide language support in Language ‣ Administrative Language Settings\n‣ Change system locale in system settings.", "keywords": ["users", "store", "color", "feature", "proxy", "name\\scripts\\activate.bat", "http_proxy", "nocolor", "windows", "https_proxy", "launcher", "terminal", "venv", "association", "database", "output", "language", "steps", "commands", "version", "django_colors", "variable", "machine", "py", "change", "admin", "scripts", "encoding", "django", "configuration", "changes", "=", "release", "download", "writing", "installation", "syntax", "practice", "legacy", "button", "line", "pip", "o.", "administrative", "microsoft", "use", "guide", "quality", "https://www.python.org/downloads/", "environment", "arguments", "following", "package", "coloring", "documentation", "file", "powershell", "order", "default", "https://username", "pythonutf8", "path", "unicode", "0.4.6", "help", "problem", "packages", "time", "prompt", "install", "framework", "ecosystem", "reason", "proxyport", "setting", "\\", "support", "projects", "document", "-", "colorama", "name", "website", "instructions", "cmd", "internet", "locale", "information", "utf-8", "web", "python", "--version", "problems", "versions", "boxes", "options", "details", "manager", "variables", "rest", "settings", "¶", "folder", "command", "life", "pitfalls", "system", "environments", "‣", "beginner", "text", "installer", "project", "terminals"], "type": "documentation"},
{"title": "Generic editing views | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/generic-editing/", "content": "Generic editing views ¶ The following views are described on this page and provide a foundation for\nediting content: django.views.generic.edit.FormView django.views.generic.edit.CreateView django.views.generic.edit.UpdateView django.views.generic.edit.DeleteView See also The messages framework contains SuccessMessageMixin , which\nfacilitates presenting messages about successful form submissions. Note Some of the examples on this page assume that an Author model has been\ndefined as follows in myapp/models.py : from django.db import models from django.urls import reverse class Author ( models . Model ): name = models . CharField ( max_length = 200 ) def get_absolute_url ( self ): return reverse ( \"author-detail\" , kwargs = { \"pk\" : self . pk }) FormView ¶ class django.views.generic.edit. FormView ¶ A view that displays a form. On error, redisplays the form with validation\nerrors; on success, redirects to a new URL. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.base.TemplateResponseMixin django.views.generic.edit.BaseFormView django.views.generic.edit.FormMixin django.views.generic.edit.ProcessFormView django.views.generic.base.View Example myapp/forms.py : from django import forms class ContactForm ( forms . Form ): name = forms . CharField () message = forms . CharField ( widget = forms . Textarea ) def send_email ( self ): # send email using the self.cleaned_data dictionary pass Example myapp/views.py : from myapp.forms import ContactForm from django.views.generic.edit import FormView class ContactFormView ( FormView ): template_name = \"contact.html\" form_class = ContactForm success_url = \"/thanks/\" def form_valid ( self , form ): # This method is called when valid form data has been POSTed. # It should return an HttpResponse. form . send_email () return super () . form_valid ( form ) Example myapp/contact.html : < form method = \"post\" > {% csrf_token %} {{ form.as_p }} < input type = \"submit\" value = \"Send message\" > </ form > class django.views.generic.edit. BaseFormView ¶ A base view for displaying a form. It is not intended to be used directly,\nbut rather as a parent class of the django.views.generic.edit.FormView or other views displaying a\nform. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.edit.FormMixin django.views.generic.edit.ProcessFormView CreateView ¶ class django.views.generic.edit. CreateView ¶ A view that displays a form for creating an object, redisplaying the form\nwith validation errors (if there are any) and saving the object. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.detail.SingleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.edit.BaseCreateView django.views.generic.edit.ModelFormMixin django.views.generic.edit.FormMixin django.views.generic.detail.SingleObjectMixin django.views.generic.edit.ProcessFormView django.views.generic.base.View Attributes template_name_suffix ¶ The CreateView page displayed to a GET request uses a template_name_suffix of '_form' . For\nexample, changing this attribute to '_create_form' for a view\ncreating objects for the example Author model would cause the\ndefault template_name to be 'myapp/author_create_form.html' . object ¶ When using CreateView you have access to self.object , which is\nthe object being created. If the object hasn’t been created yet, the\nvalue will be None . Example myapp/views.py : from django.views.generic.edit import CreateView from myapp.models import Author class AuthorCreateView ( CreateView ): model = Author fields = [ \"name\" ] Example myapp/author_form.html : < form method = \"post\" > {% csrf_token %} {{ form.as_p }} < input type = \"submit\" value = \"Save\" > </ form > class django.views.generic.edit. BaseCreateView ¶ A base view for creating a new object instance. It is not intended to be\nused directly, but rather as a parent class of the django.views.generic.edit.CreateView . Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.edit.ModelFormMixin django.views.generic.edit.ProcessFormView Methods get ( request , * args , ** kwargs ) ¶ Sets the current object instance ( self.object ) to None . post ( request , * args , ** kwargs ) ¶ Sets the current object instance ( self.object ) to None . UpdateView ¶ class django.views.generic.edit. UpdateView ¶ A view that displays a form for editing an existing object, redisplaying\nthe form with validation errors (if there are any) and saving changes to\nthe object. This uses a form automatically generated from the object’s\nmodel class (unless a form class is manually specified). Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.detail.SingleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.edit.BaseUpdateView django.views.generic.edit.ModelFormMixin django.views.generic.edit.FormMixin django.views.generic.detail.SingleObjectMixin django.views.generic.edit.ProcessFormView django.views.generic.base.View Attributes template_name_suffix ¶ The UpdateView page displayed to a GET request uses a template_name_suffix of '_form' . For\nexample, changing this attribute to '_update_form' for a view\nupdating objects for the example Author model would cause the\ndefault template_name to be 'myapp/author_update_form.html' . object ¶ When using UpdateView you have access to self.object , which is\nthe object being updated. Example myapp/views.py : from django.views.generic.edit import UpdateView from myapp.models import Author class AuthorUpdateView ( UpdateView ): model = Author fields = [ \"name\" ] template_name_suffix = \"_update_form\" Example myapp/author_update_form.html : < form method = \"post\" > {% csrf_token %} {{ form.as_p }} < input type = \"submit\" value = \"Update\" > </ form > class django.views.generic.edit. BaseUpdateView ¶ A base view for updating an existing object instance. It is not intended to\nbe used directly, but rather as a parent class of the django.views.generic.edit.UpdateView . Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.edit.ModelFormMixin django.views.generic.edit.ProcessFormView Methods get ( request , * args , ** kwargs ) ¶ Sets the current object instance ( self.object ). post ( request , * args , ** kwargs ) ¶ Sets the current object instance ( self.object ). DeleteView ¶ class django.views.generic.edit. DeleteView ¶ A view that displays a confirmation page and deletes an existing object.\nThe given object will only be deleted if the request method is POST . If\nthis view is fetched via GET , it will display a confirmation page that\nshould contain a form that POSTs to the same URL. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.detail.SingleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.edit.BaseDeleteView django.views.generic.edit.DeletionMixin django.views.generic.edit.FormMixin django.views.generic.base.ContextMixin django.views.generic.detail.BaseDetailView django.views.generic.detail.SingleObjectMixin django.views.generic.base.View Attributes form_class ¶ Inherited from BaseDeleteView . The\nform class that will be used to confirm the request. By default django.forms.Form , resulting in an empty form that is always\nvalid. By providing your own Form subclass, you can add additional\nrequirements, such as a confirmation checkbox, for example. template_name_suffix ¶ The DeleteView page displayed to a GET request uses a template_name_suffix of '_confirm_delete' . For\nexample, changing this attribute to '_check_delete' for a view\ndeleting objects for the example Author model would cause the\ndefault template_name to be 'myapp/author_check_delete.html' . Example myapp/views.py : from django.urls import reverse_lazy from django.views.generic.edit import DeleteView from myapp.models import Author class AuthorDeleteView ( DeleteView ): model = Author success_url = reverse_lazy ( \"author-list\" ) Example myapp/author_confirm_delete.html : < form method = \"post\" > {% csrf_token %} < p > Are you sure you want to delete \" {{ object }} \"? </ p > {{ form }} < input type = \"submit\" value = \"Confirm\" > </ form > class django.views.generic.edit. BaseDeleteView ¶ A base view for deleting an object instance. It is not intended to be used\ndirectly, but rather as a parent class of the django.views.generic.edit.DeleteView . Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.edit.DeletionMixin django.views.generic.edit.FormMixin django.views.generic.detail.BaseDetailView", "keywords": ["submissions", "views", "examples", "basedeleteview", "view", "contextmixin", "/thanks/", "singleobjectmixin", "messages", "url", "error", "def", "update_form", "forms", "form.as_p", "access", "class", "example", "_", "contactform", "#", "django.views.generic.base", "requirements", "list", "widget", "django.forms", "'", "request", "processformview", "template_name_suffix", "input", "mro", "email", "models", "*", "page", "httpresponse", "model", "send_email", "subclass", "django.urls", "contact.html", "check_delete", "foundation", "attributes", "formmixin", "django", "editing", "=", "myapp", "changes", "max_length", "fields", "get_absolute_url", "message", "singleobjecttemplateresponsemixin", "author_confirm_delete.html", "validation", "p", "successmessagemixin", "value", "self.object", "formview", "django.views.generic.detail", "data", "authorupdateview", "ancestors", "base", "errors", "author_create_form.html", "myapp.forms", "author", "type", "self", "instance", "kwargs", "objects", "pass", "django.views.generic.edit", "authordeleteview", "updateview", "views.py", "create_form", "basecreateview", "default", "success", "update", "form", "attribute", "contactformview", "form_class", "none", "args", "get", "authorcreateview", "framework", "save", "baseupdateview", "deleteview", "myapp.models", "self.cleaned_data", "object", "textarea", "confirmation", "import", "name", "success_url", "charfield", "reverse_lazy", "author_check_delete.html", "%", "pk", "checkbox", "createview", "posted", "methods", "template_name", "confirm_delete", "modelformmixin", "method", "django.db", "¶", "return", "reverse", "baseformview", "post", "deletionmixin", "author_update_form.html", "detail", "parent", "content"], "type": "documentation"},
{"title": "Generic display views | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/generic-display/", "content": "Generic display views ¶ The two following generic class-based views are designed to display data. On\nmany projects they are typically the most commonly used views. DetailView ¶ class django.views.generic.detail. DetailView ¶ While this view is executing, self.object will contain the object that\nthe view is operating upon. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.detail.SingleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.detail.BaseDetailView django.views.generic.detail.SingleObjectMixin django.views.generic.base.View Method Flowchart setup() dispatch() http_method_not_allowed() get_template_names() get_slug_field() get_queryset() get_object() get_context_object_name() get_context_data() get() render_to_response() Example myapp/views.py : from django.utils import timezone from django.views.generic.detail import DetailView from articles.models import Article class ArticleDetailView ( DetailView ): model = Article def get_context_data ( self , ** kwargs ): context = super () . get_context_data ( ** kwargs ) context [ \"now\" ] = timezone . now () return context Example myapp/urls.py : from django.urls import path from article.views import ArticleDetailView urlpatterns = [ path ( \"<slug:slug>/\" , ArticleDetailView . as_view (), name = \"article-detail\" ), ] Example myapp/article_detail.html : < h1 > {{ object.headline }} </ h1 > < p > {{ object.content }} </ p > < p > Reporter: {{ object.reporter }} </ p > < p > Published: {{ object.pub_date | date }} </ p > < p > Date: {{ now | date }} </ p > class django.views.generic.detail. BaseDetailView ¶ A base view for displaying a single object. It is not intended to be used\ndirectly, but rather as a parent class of the django.views.generic.detail.DetailView or other views representing\ndetails of a single object. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.detail.SingleObjectMixin django.views.generic.base.View Methods get ( request , * args , ** kwargs ) ¶ Adds object to the context. ListView ¶ class django.views.generic.list. ListView ¶ A page representing a list of objects. While this view is executing, self.object_list will contain the list of\nobjects (usually, but not necessarily a queryset) that the view is\noperating upon. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.list.MultipleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.list.BaseListView django.views.generic.list.MultipleObjectMixin django.views.generic.base.View Method Flowchart setup() dispatch() http_method_not_allowed() get_template_names() get_queryset() get_context_object_name() get_context_data() get() render_to_response() Example views.py : from django.utils import timezone from django.views.generic.list import ListView from articles.models import Article class ArticleListView ( ListView ): model = Article paginate_by = 100 # if pagination is desired def get_context_data ( self , ** kwargs ): context = super () . get_context_data ( ** kwargs ) context [ \"now\" ] = timezone . now () return context Example myapp/urls.py : from django.urls import path from article.views import ArticleListView urlpatterns = [ path ( \"\" , ArticleListView . as_view (), name = \"article-list\" ), ] Example myapp/article_list.html : < h1 > Articles </ h1 > < ul > {% for article in object_list %} < li > {{ article.pub_date | date }} - {{ article.headline }} </ li > {% empty %} < li > No articles yet. </ li > {% endfor %} </ ul > If you’re using pagination, you can adapt the example template from\nthe pagination docs . class django.views.generic.list. BaseListView ¶ A base view for displaying a list of objects. It is not intended to be used\ndirectly, but rather as a parent class of the django.views.generic.list.ListView or other views representing\nlists of objects. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.list.MultipleObjectMixin django.views.generic.base.View Methods get ( request , * args , ** kwargs ) ¶ Adds object_list to the context. If allow_empty is True then display an empty list. If allow_empty is\nFalse then raise a 404 error.", "keywords": ["baselistview", "views", "get_queryset", "view", "slug>/", "singleobjectmixin", "error", "display", "class", "example", "#", "lists", "django.views.generic.base", "articles.models", "paginate_by", "list", "articlelistview", "article.views", "object.reporter", "request", "mro", "*", "page", "model", "dispatch", "django.urls", "multipleobjecttemplateresponsemixin", "article", "articledetailview", "attributes", "=", "myapp", "pagination", "render_to_response", "basedetailview", "singleobjecttemplateresponsemixin", "p", "setup", "self.object", "object.pub_date", "django.views.generic.detail", "data", "get_object", "h1", "ancestors", "base", "article_detail.html", "ul", "self", "kwargs", "objects", "flowchart", "views.py", "li", "|", "path", "args", "docs", "get", "object_list", "date", "object.content", "timezone", "templateresponsemixin", "get_slug_field", "get_template_names", "projects", "object", "django.utils", "context", "listview", "import", "name", "template", "%", "as_view", "reporter", "endfor", "multipleobjectmixin", "methods", "get_context_object_name", "details", "django.views.generic.list", "self.object_list", "method", "queryset", "¶", "return", "articles", "detail", "get_context_data", "parent", "detailview"], "type": "documentation"},
{"title": "Middleware | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/http/middleware/", "content": "Middleware ¶ Middleware is a framework of hooks into Django’s request/response processing.\nIt’s a light, low-level “plugin” system for globally altering Django’s input\nor output. Each middleware component is responsible for doing some specific function. For\nexample, Django includes a middleware component, AuthenticationMiddleware , that\nassociates users with requests using sessions. This document explains how middleware works, how you activate middleware, and\nhow to write your own middleware. Django ships with some built-in middleware\nyou can use right out of the box. They’re documented in the built-in\nmiddleware reference . Writing your own middleware ¶ A middleware factory is a callable that takes a get_response callable and\nreturns a middleware. A middleware is a callable that takes a request and\nreturns a response, just like a view. A middleware can be written as a function that looks like this: def simple_middleware ( get_response ): # One-time configuration and initialization. def middleware ( request ): # Code to be executed for each request before # the view (and later middleware) are called. response = get_response ( request ) # Code to be executed for each request/response after # the view is called. return response return middleware Or it can be written as a class whose instances are callable, like this: class SimpleMiddleware : def __init__ ( self , get_response ): self . get_response = get_response # One-time configuration and initialization. def __call__ ( self , request ): # Code to be executed for each request before # the view (and later middleware) are called. response = self . get_response ( request ) # Code to be executed for each request/response after # the view is called. return response The get_response callable provided by Django might be the actual view (if\nthis is the last listed middleware) or it might be the next middleware in the\nchain. The current middleware doesn’t need to know or care what exactly it is,\njust that it represents whatever comes next. The above is a slight simplification – the get_response callable for the\nlast middleware in the chain won’t be the actual view but rather a wrapper\nmethod from the handler which takes care of applying view middleware , calling the view with appropriate URL arguments, and\napplying template-response and exception middleware. Middleware can either support only synchronous Python (the default), only\nasynchronous Python, or both. See Asynchronous support for details of how to\nadvertise what you support, and know what kind of request you are getting. Middleware can live anywhere on your Python path. __init__(get_response) ¶ Middleware factories must accept a get_response argument. You can also\ninitialize some global state for the middleware. Keep in mind a couple of\ncaveats: Django initializes your middleware with only the get_response argument,\nso you can’t define __init__() as requiring any other arguments. Unlike the __call__() method which is called once per request, __init__() is called only once , when the web server starts. Marking middleware as unused ¶ It’s sometimes useful to determine at startup time whether a piece of\nmiddleware should be used. In these cases, your middleware’s __init__() method may raise MiddlewareNotUsed . Django will\nthen remove that middleware from the middleware process and log a debug message\nto the django.request logger when DEBUG is True . Activating middleware ¶ To activate a middleware component, add it to the MIDDLEWARE list in\nyour Django settings. In MIDDLEWARE , each middleware component is represented by a string:\nthe full Python path to the middleware factory’s class or function name. For\nexample, here’s the default value created by django-admin startproject : MIDDLEWARE = [ \"django.middleware.security.SecurityMiddleware\" , \"django.contrib.sessions.middleware.SessionMiddleware\" , \"django.middleware.common.CommonMiddleware\" , \"django.middleware.csrf.CsrfViewMiddleware\" , \"django.contrib.auth.middleware.AuthenticationMiddleware\" , \"django.contrib.messages.middleware.MessageMiddleware\" , \"django.middleware.clickjacking.XFrameOptionsMiddleware\" , ] A Django installation doesn’t require any middleware — MIDDLEWARE can be empty, if you’d like — but it’s strongly suggested that you at least use CommonMiddleware . The order in MIDDLEWARE matters because a middleware can depend on\nother middleware. For instance, AuthenticationMiddleware stores the\nauthenticated user in the session; therefore, it must run after SessionMiddleware . See Middleware ordering for some common hints about ordering of Django\nmiddleware classes. Middleware order and layering ¶ During the request phase, before calling the view, Django applies middleware in\nthe order it’s defined in MIDDLEWARE , top-down. You can think of it like an onion: each middleware class is a “layer” that\nwraps the view, which is in the core of the onion. If the request passes\nthrough all the layers of the onion (each one calls get_response to pass\nthe request in to the next layer), all the way to the view at the core, the\nresponse will then pass through every layer (in reverse order) on the way back\nout. If one of the layers decides to short-circuit and return a response without\never calling its get_response , none of the layers of the onion inside that\nlayer (including the view) will see the request or the response. The response\nwill only return through the same layers that the request passed in through. Other middleware hooks ¶ Besides the basic request/response middleware pattern described earlier, you\ncan add three other special methods to class-based middleware: process_view() ¶ process_view ( request , view_func , view_args , view_kwargs ) ¶ request is an HttpRequest object. view_func is\nthe Python function that Django is about to use. (It’s the actual function\nobject, not the name of the function as a string.) view_args is a list of\npositional arguments that will be passed to the view, and view_kwargs is a\ndictionary of keyword arguments that will be passed to the view. Neither view_args nor view_kwargs include the first view argument\n( request ). process_view() is called just before Django calls the view. It should return either None or an HttpResponse object. If it returns None , Django will continue processing this request,\nexecuting any other process_view() middleware and, then, the appropriate\nview. If it returns an HttpResponse object, Django won’t\nbother calling the appropriate view; it’ll apply response middleware to that HttpResponse and return the result. Note Accessing request.POST inside\nmiddleware before the view runs or in process_view() will prevent any\nview running after the middleware from being able to modify the\nupload handlers for the request ,\nand should normally be avoided. The CsrfViewMiddleware class can be\nconsidered an exception, as it provides the csrf_exempt() and csrf_protect() decorators which allow\nviews to explicitly control at what point the CSRF validation should occur. process_exception() ¶ process_exception ( request , exception ) ¶ request is an HttpRequest object. exception is an Exception object raised by the view function. Django calls process_exception() when a view raises an exception. process_exception() should return either None or an HttpResponse object. If it returns an HttpResponse object, the template response and response\nmiddleware will be applied and the resulting response returned to the\nbrowser. Otherwise, default exception handling kicks in. Again, middleware are run in reverse order during the response phase, which\nincludes process_exception . If an exception middleware returns a response,\nthe process_exception methods of the middleware classes above that\nmiddleware won’t be called at all. process_template_response() ¶ process_template_response ( request , response ) ¶ request is an HttpRequest object. response is\nthe TemplateResponse object (or equivalent)\nreturned by a Django view or by a middleware. process_template_response() is called just after the view has finished\nexecuting, if the response instance has a render() method, indicating that\nit is a TemplateResponse or equivalent. It must return a response object that implements a render method. It could\nalter the given response by changing response.template_name and response.context_data , or it could create and return a brand-new TemplateResponse or equivalent. You don’t need to explicitly render responses – responses will be\nautomatically rendered once all template response middleware has been\ncalled. Middleware are run in reverse order during the response phase, which\nincludes process_template_response() . Dealing with streaming responses ¶ Unlike HttpResponse , StreamingHttpResponse does not have a content attribute. As a result, middleware can no longer assume that all responses\nwill have a content attribute. If they need access to the content, they\nmust test for streaming responses and adjust their behavior accordingly: if response . streaming : response . streaming_content = wrap_streaming_content ( response . streaming_content ) else : response . content = alter_content ( response . content ) Note streaming_content should be assumed to be too large to hold in memory.\nResponse middleware may wrap it in a new generator, but must not consume\nit. Wrapping is typically implemented as follows: def wrap_streaming_content ( content ): for chunk in content : yield alter_content ( chunk ) StreamingHttpResponse allows both synchronous and\nasynchronous iterators. The wrapping function must match. Check StreamingHttpResponse.is_async if your middleware needs to\nsupport both types of iterator. Exception handling ¶ Django automatically converts exceptions raised by the view or by middleware\ninto an appropriate HTTP response with an error status code. Certain\nexceptions are converted to 4xx status codes, while an unknown\nexception is converted to a 500 status code. This conversion takes place before and after each middleware (you can think of\nit as the thin film in between each layer of the onion), so that every\nmiddleware can always rely on getting some kind of HTTP response back from\ncalling its get_response callable. Middleware don’t need to worry about\nwrapping their call to get_response in a try/except and handling an\nexception that might have been raised by a later middleware or the view. Even\nif the very next middleware in the chain raises an Http404 exception, for example, your middleware won’t see\nthat exception; instead it will get an HttpResponse object with a status_code of 404. You can set DEBUG_PROPAGATE_EXCEPTIONS to True to skip this\nconversion and propagate exceptions upward. Asynchronous support ¶ Middleware can support any combination of synchronous and asynchronous\nrequests. Django will adapt requests to fit the middleware’s requirements if it\ncannot support both, but at a performance penalty. By default, Django assumes that your middleware is capable of handling only\nsynchronous requests. To change these assumptions, set the following attributes\non your middleware factory function or class: sync_capable is a boolean indicating if the middleware can handle\nsynchronous requests. Defaults to True . async_capable is a boolean indicating if the middleware can handle\nasynchronous requests. Defaults to False . If your middleware has both sync_capable = True and async_capable = True , then Django will pass it the request without\nconverting it. In this case, you can work out if your middleware will receive\nasync requests by checking if the get_response object you are passed is a\ncoroutine function, using asgiref.sync.iscoroutinefunction . The django.utils.decorators module contains sync_only_middleware() , async_only_middleware() , and sync_and_async_middleware() decorators that\nallow you to apply these flags to middleware factory functions. The returned callable must match the sync or async nature of the get_response method. If you have an asynchronous get_response , you must\nreturn a coroutine function ( async def ). process_view , process_template_response and process_exception methods, if they are provided, should also be adapted to match the sync/async\nmode. However, Django will individually adapt them as required if you do not,\nat an additional performance penalty. Here’s an example of how to create a middleware function that supports both: from asgiref.sync import iscoroutinefunction from django.utils.decorators import sync_and_async_middleware @sync_and_async_middleware def simple_middleware ( get_response ): # One-time configuration and initialization goes here. if iscoroutinefunction ( get_response ): async def middleware ( request ): # Do something here! response = await get_response ( request ) return response else : def middleware ( request ): # Do something here! response = get_response ( request ) return response return middleware Note If you declare a hybrid middleware that supports both synchronous and\nasynchronous calls, the kind of call you get may not match the underlying\nview. Django will optimize the middleware call stack to have as few\nsync/async transitions as possible. Thus, even if you are wrapping an async view, you may be called in sync\nmode if there is other, synchronous middleware between you and the view. When using an asynchronous class-based middleware, you must ensure that\ninstances are correctly marked as coroutine functions: from asgiref.sync import iscoroutinefunction , markcoroutinefunction class AsyncMiddleware : async_capable = True sync_capable = False def __init__ ( self , get_response ): self . get_response = get_response if iscoroutinefunction ( self . get_response ): markcoroutinefunction ( self ) async def __call__ ( self , request ): response = await self . get_response ( request ) # Some logic ... return response Upgrading pre-Django 1.10-style middleware ¶ class django.utils.deprecation. MiddlewareMixin ¶ Django provides django.utils.deprecation.MiddlewareMixin to ease creating\nmiddleware classes that are compatible with both MIDDLEWARE and the\nold MIDDLEWARE_CLASSES , and support synchronous and asynchronous requests.\nAll middleware classes included with Django are compatible with both settings. The mixin provides an __init__() method that requires a get_response argument and stores it in self.get_response . The __call__() method: Calls self.process_request(request) (if defined). Calls self.get_response(request) to get the response from later\nmiddleware and the view. Calls self.process_response(request, response) (if defined). Returns the response. If used with MIDDLEWARE_CLASSES , the __call__() method will\nnever be used; Django calls process_request() and process_response() directly. In most cases, inheriting from this mixin will be sufficient to make an\nold-style middleware compatible with the new system with sufficient\nbackwards-compatibility. The new short-circuiting semantics will be harmless or\neven beneficial to the existing middleware. In a few cases, a middleware class\nmay need some changes to adjust to the new semantics. These are the behavioral differences between using MIDDLEWARE and MIDDLEWARE_CLASSES : Under MIDDLEWARE_CLASSES , every middleware will always have its process_response method called, even if an earlier middleware\nshort-circuited by returning a response from its process_request method. Under MIDDLEWARE , middleware behaves more like an onion:\nthe layers that a response goes through on the way out are the same layers\nthat saw the request on the way in. If a middleware short-circuits, only\nthat middleware and the ones before it in MIDDLEWARE will see the\nresponse. Under MIDDLEWARE_CLASSES , process_exception is applied to\nexceptions raised from a middleware process_request method. Under MIDDLEWARE , process_exception applies only to exceptions\nraised from the view (or from the render method of a TemplateResponse ). Exceptions raised from\na middleware are converted to the appropriate HTTP response and then passed\nto the next middleware. Under MIDDLEWARE_CLASSES , if a process_response method raises\nan exception, the process_response methods of all earlier middleware are\nskipped and a 500 Internal Server Error HTTP response is always\nreturned (even if the exception raised was e.g. an Http404 ). Under MIDDLEWARE , an exception\nraised from a middleware will immediately be converted to the appropriate\nHTTP response, and then the next middleware in line will see that\nresponse. Middleware are never skipped due to a middleware raising an\nexception.", "keywords": ["function", "matters", "users", "views", "box", "result", "view", "commonmiddleware", "sessionmiddleware", "factories", "status", "wrapper", "pattern", "pre", "startup", "view_args", "url", "nature", "error", "def", "module", "code", "point", "string", "behavior", "false", "access", "class", "example", "care", "#", "async_only_middleware", "style", "hooks", "self.get_response", "async_capable", "requirements", "init__(get_response", "response.template_name", "list", "accessing", "asyncmiddleware", "simplemiddleware", "response.context_data", "returns", "django.utils.decorators", "request", "stores", "sync_only_middleware", "output", "input", "view_func", "semantics", "stack", "httpresponse", "compatibility", "level", "types", "phase", "markcoroutinefunction", "place", "callable", "short", "http404", "mixin", "attributes", "django", "http", "configuration", "=", "indicating", "changes", "n’t", "securitymiddleware", "kicks", "differences", "iscoroutinefunction", "message", "process_response", "installation", "validation", "circuits", "view_kwargs", "value", "sync", "simplification", "brand", "line", "codes", "ones", "case", "component", "process", "browser", "debug", "handler", "process_view", "messagemiddleware", "django.utils.deprecation", "wrapping", "middlewaremixin", "layer", "server", "factory", "get_response", "arguments", "chunk", "upload", "processing", "middlewarenotused", "init", "process_template_response", "middleware", "iterators", "self", "one", "instance", "performance", "onion", "generator", "calls", "mind", "core", "initialization", "startproject", "simple_middleware", "order", "default", "user", "kind", "path", "cases", "self.get_response(request", "functions", "django.middleware.security", "middleware_classes", "layers", "attribute", "asgiref.sync.iscoroutinefunction", "none", "classes", "csrf_protect", "process_exception", "time", "streaming_content", "down", "executing", "framework", "render", "assumptions", "instances", "true", "templateresponse", "responses", "authenticationmiddleware", "alter_content", "sessions", "support", "mode", "starts", "document", "django.middleware.common", "object", "chain", "circuit", "-", "couple", "film", "caveats", "self.process_request(request", "iterator", "django.middleware.csrf", "wrap_streaming_content", "logic", "layering", "import", "name", "csrfviewmiddleware", "httprequest", "csrf_exempt", "template", "combination", "response", "async", "penalty", "dictionary", "defaults", "hints", "call", "requests", "flags", "way", "reference", "web", "python", "try", "methods", "csrf", "logger", "exception", "conversion", "details", "method", "top", "status_code", "debug_propagate_exceptions", "decorators", "session", "settings", "streaminghttpresponse", "argument", "piece", "¶", "return", "streaming", "behaves", "handlers", "note", "post", "state", "memory", "sync_and_async_middleware", "transitions", "system", "internal", "coroutine", "content", "exceptions"], "type": "documentation"},
{"title": "Writing and running tests | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/testing/overview/", "content": "Writing and running tests ¶ See also The testing tutorial , the testing tools\nreference , and the advanced testing topics . This document is split into two primary sections. First, we explain how to write\ntests with Django. Then, we explain how to run them. Writing tests ¶ Django’s unit tests use a Python standard library module: unittest . This\nmodule defines tests using a class-based approach. Here is an example which subclasses from django.test.TestCase ,\nwhich is a subclass of unittest.TestCase that runs each test inside a\ntransaction to provide isolation: from django.test import TestCase from myapp.models import Animal class AnimalTestCase ( TestCase ): def setUp ( self ): Animal . objects . create ( name = \"lion\" , sound = \"roar\" ) Animal . objects . create ( name = \"cat\" , sound = \"meow\" ) def test_animals_can_speak ( self ): \"\"\"Animals that can speak are correctly identified\"\"\" lion = Animal . objects . get ( name = \"lion\" ) cat = Animal . objects . get ( name = \"cat\" ) self . assertEqual ( lion . speak (), 'The lion says \"roar\"' ) self . assertEqual ( cat . speak (), 'The cat says \"meow\"' ) When you run your tests , the default behavior of the\ntest utility is to find all the test case classes (that is, subclasses of unittest.TestCase ) in any file whose name begins with test ,\nautomatically build a test suite out of those test case classes, and run that\nsuite. For more details about unittest , see the Python documentation. Where should the tests live? The default startapp template creates a tests.py file in the\nnew application. This might be fine if you only have a few tests, but as\nyour test suite grows you’ll likely want to restructure it into a tests\npackage so you can split your tests into different submodules such as test_models.py , test_views.py , test_forms.py , etc. Feel free to\npick whatever organizational scheme you like. See also Using the Django test runner to test reusable applications . Warning If your tests rely on database access such as creating or querying models,\nbe sure to create your test classes as subclasses of django.test.TestCase rather than unittest.TestCase . Using unittest.TestCase avoids the cost of running each test in a\ntransaction and flushing the database, but if your tests interact with\nthe database their behavior will vary based on the order that the test\nrunner executes them. This can lead to unit tests that pass when run in\nisolation but fail when run in a suite. Running tests ¶ Once you’ve written tests, run them using the test command of\nyour project’s manage.py utility: $ ./manage.py test Test discovery is based on the unittest module’s built-in test\ndiscovery .  By default, this will discover tests in\nany file named test*.py under the current working directory. You can specify particular tests to run by supplying any number of “test\nlabels” to ./manage.py test . Each test label can be a full Python dotted\npath to a package, module, TestCase subclass, or test method. For instance: # Run all the tests in the animals.tests module $ ./manage.py test animals.tests # Run all the tests found within the 'animals' package $ ./manage.py test animals # Run just one test case class $ ./manage.py test animals.tests.AnimalTestCase # Run just one test method $ ./manage.py test animals.tests.AnimalTestCase.test_animals_can_speak You can also provide a path to a directory to discover tests below that\ndirectory: $ ./manage.py test animals/ You can specify a custom filename pattern match using the -p (or --pattern ) option, if your test files are named differently from the test*.py pattern: $ ./manage.py test --pattern = \"tests_*.py\" If you press Ctrl-C while the tests are running, the test runner will\nwait for the currently running test to complete and then exit gracefully.\nDuring a graceful exit the test runner will output details of any test\nfailures, report on how many tests were run and how many errors and failures\nwere encountered, and destroy any test databases as usual. Thus pressing Ctrl-C can be very useful if you forget to pass the --failfast option, notice that some tests are unexpectedly failing and\nwant to get details on the failures without waiting for the full test run to\ncomplete. If you do not want to wait for the currently running test to finish, you\ncan press Ctrl-C a second time and the test run will halt immediately,\nbut not gracefully. No details of the tests run before the interruption will\nbe reported, and any test databases created by the run will not be destroyed. Test with warnings enabled It’s a good idea to run your tests with Python warnings enabled: python -Wa manage.py test . The -Wa flag tells Python to\ndisplay deprecation warnings. Django, like many other Python libraries,\nuses these warnings to flag when features are going away. It also might\nflag areas in your code that aren’t strictly wrong but could benefit\nfrom a better implementation. The test database ¶ Tests that require a database (namely, model tests) will not use your “real”\n(production) database. Separate, blank databases are created for the tests. Regardless of whether the tests pass or fail, the test databases are destroyed\nwhen all the tests have been executed. You can prevent the test databases from being destroyed by using the test --keepdb option. This will preserve the test database between\nruns. If the database does not exist, it will first be created. Any migrations\nwill also be applied in order to keep it up to date. As described in the previous section, if a test run is forcefully interrupted,\nthe test database may not be destroyed. On the next run, you’ll be asked\nwhether you want to reuse or destroy the database. Use the test --noinput option to suppress that prompt and automatically destroy the\ndatabase. This can be useful when running tests on a continuous integration\nserver where tests may be interrupted by a timeout, for example. The default test database names are created by prepending test_ to the\nvalue of each NAME in DATABASES . When using SQLite, the\ntests will use an in-memory database by default (i.e., the database will be\ncreated in memory, bypassing the filesystem entirely!). The TEST dictionary in DATABASES offers a number of settings\nto configure your test database. For example, if you want to use a different\ndatabase name, specify NAME in the TEST dictionary for any given database in DATABASES . On PostgreSQL, USER will also need read access to the built-in postgres database. Aside from using a separate database, the test runner will otherwise\nuse all of the same database settings you have in your settings file: ENGINE , USER , HOST , etc. The\ntest database is created by the user specified by USER , so you’ll\nneed to make sure that the given user account has sufficient privileges to\ncreate a new database on the system. For fine-grained control over the character encoding of your test\ndatabase, use the CHARSET TEST option. If you’re using\nMySQL, you can also use the COLLATION option to\ncontrol the particular collation used by the test database. See the settings documentation for details of these\nand other advanced settings. If using an SQLite in-memory database with SQLite, shared cache is enabled, so you can write tests\nwith ability to share the database between threads. Finding data from your production database when running tests? If your code attempts to access the database when its modules are compiled,\nthis will occur before the test database is set up, with potentially\nunexpected results. For example, if you have a database query in\nmodule-level code and a real database exists, production data could pollute\nyour tests. It is a bad idea to have such import-time database queries in\nyour code anyway - rewrite your code so that it doesn’t do this. This also applies to customized implementations of ready() . See also The advanced multi-db testing topics . Order in which tests are executed ¶ In order to guarantee that all TestCase code starts with a clean database,\nthe Django test runner reorders tests in the following way: All TestCase subclasses are run first. Then, all other Django-based tests (test case classes based on SimpleTestCase , including TransactionTestCase ) are run with no particular\nordering guaranteed nor enforced among them. Then any other unittest.TestCase tests (including doctests) that may\nalter the database without restoring it to its original state are run. Note The new ordering of tests may reveal unexpected dependencies on test case\nordering. This is the case with doctests that relied on state left in the\ndatabase by a given TransactionTestCase test, they\nmust be updated to be able to run independently. Note Failures detected when loading tests are ordered before all of the above\nfor quicker feedback. This includes things like test modules that couldn’t\nbe found or that couldn’t be loaded due to syntax errors. You may randomize and/or reverse the execution order inside groups using the test --shuffle and --reverse options. This\ncan help with ensuring your tests are independent from each other. Rollback emulation ¶ Any initial data loaded in migrations will only be available in TestCase tests and not in TransactionTestCase tests, and additionally only on\nbackends where transactions are supported (the most important exception being\nMyISAM). This is also true for tests which rely on TransactionTestCase such as LiveServerTestCase and StaticLiveServerTestCase . Django can reload that data for you on a per-testcase basis by\nsetting the serialized_rollback option to True in the body of the TestCase or TransactionTestCase , but note that this will slow down\nthat test suite by approximately 3x. Third-party apps or those developing against MyISAM will need to set this;\nin general, however, you should be developing your own projects against a\ntransactional database and be using TestCase for most tests, and thus\nnot need this setting. The initial serialization is usually very quick, but if you wish to exclude\nsome apps from this process (and speed up test runs slightly), you may add\nthose apps to TEST_NON_SERIALIZED_APPS . To prevent serialized data from being loaded twice, setting serialized_rollback=True disables the post_migrate signal when flushing the test\ndatabase. Other test conditions ¶ Regardless of the value of the DEBUG setting in your configuration\nfile, all Django tests run with DEBUG =False. This is to ensure that\nthe observed output of your code matches what will be seen in a production\nsetting. Caches are not cleared after each test, and running manage.py test fooapp can insert data from the tests into the cache of a live system if you run your\ntests in production because, unlike databases, a separate “test cache” is not\nused. This behavior may change in the future. Understanding the test output ¶ When you run your tests, you’ll see a number of messages as the test runner\nprepares itself. You can control the level of detail of these messages with the verbosity option on the command line: Creating test database...\nCreating table myapp_animal\nCreating table myapp_mineral This tells you that the test runner is creating a test database, as described\nin the previous section. Once the test database has been created, Django will run your tests.\nIf everything goes well, you’ll see something like this: ----------------------------------------------------------------------\nRan 22 tests in 0 .221s\n\nOK If there are test failures, however, you’ll see full details about which tests\nfailed: ====================================================================== FAIL: test_was_published_recently_with_future_poll ( polls.tests.PollMethodTests ) ----------------------------------------------------------------------\nTraceback ( most recent call last ) : File \"/dev/mysite/polls/tests.py\" , line 16 , in test_was_published_recently_with_future_poll self.assertIs ( future_poll.was_published_recently () , False ) AssertionError: True is not False\n\n----------------------------------------------------------------------\nRan 1 test in 0 .003s\n\nFAILED ( failures = 1 ) A full explanation of this error output is beyond the scope of this document,\nbut it’s pretty intuitive. You can consult the documentation of Python’s unittest library for details. Note that the return code for the test-runner script is 1 for any number of\nfailed tests (whether the failure was caused by an error, a failed assertion,\nor an unexpected success). If all the tests pass, the return code is 0. This\nfeature is useful if you’re using the test-runner script in a shell script and\nneed to test for success or failure at that level. Speeding up the tests ¶ Running tests in parallel ¶ As long as your tests are properly isolated, you can run them in parallel to\ngain a speed up on multi-core hardware. See test --parallel . Password hashing ¶ The default password hasher is rather slow by design. If you’re authenticating\nmany users in your tests, you may want to use a custom settings file and set\nthe PASSWORD_HASHERS setting to a faster hashing algorithm: PASSWORD_HASHERS = [ \"django.contrib.auth.hashers.MD5PasswordHasher\" , ] Don’t forget to also include in PASSWORD_HASHERS any hashing\nalgorithm used in fixtures, if any. Preserving the test database ¶ The test --keepdb option preserves the test database between test\nruns. It skips the create and destroy actions which can greatly decrease the\ntime to run tests. Avoiding disk access for media files ¶ The InMemoryStorage is a convenient way to\nprevent disk access for media files. All data is kept in memory, then it gets\ndiscarded after tests run.", "keywords": ["implementations", "users", "failure", "testing", "feature", "production", "control", "run", "pattern", "pollmethodtests", "number", "messages", "error", "timeout", "module", "conditions", "code", "features", "algorithm", "tests_*.py", "failures", "library", "false", "behavior", "c", "access", "class", "example", "_", "discovery", "#", "runner", "parallel", "serialization", "warnings", "migrations", "collation", "3x", "names", "databases", "animaltestcase", "self.assertis", "roar", "topics", "reorders", "unit", "fooapp", "database", "flag", "host", "emulation", "libraries", "privileges", "output", "animals", "animal", "signal", "table", "models", "match", "query", "test", "exit", "postgresql", "cache", "assertionerror", "level", "model", "subclass", "sections", "idea", "submodules", "suite", "application", "labels", "encoding", "deprecation", "actions", "label", "approach", "django", "transactiontestcase", "testcase", "configuration", "=", "ability", "n’t", "filename", "script", "results", "engine", "password_hashers", "disk", "hardware", "myisam", "shell", "syntax", "character", "create", "value", "section", "filesystem", "postgres", "media", "assertion", "line", "animals.tests", "rollback", "hashing", "case", "implementation", "data", "process", "/dev", "debug", "scope", ".003s", "errors", "cost", "future", "server", "charset", ".221s", "doctests", "package", "-wa", "explanation", "subclasses", "self", "instance", "custom", "defines", "objects", "documentation", "file", "sqlite", "myapp_animal", "speed", "verbosity", "order", "modules", "default", "myapp_mineral", "user", "lion", "path", "django.test", "success", "feedback", "option", "classes", "tests", "time", "test*.py", "-p", "prompt", "basis", "caches", "date", "./manage.py", "startapp", "setting", "test_forms.py", "true", "account", "test_was_published_recently_with_future_poll", "areas", "fixtures", "myapp.models", "scheme", "polls", "projects", "document", "things", "transactions", "serialized_rollback", "groups", "runs", "cat", "password", "threads", "import", "name", "files", "template", "django.contrib.auth.hashers", "mysql", "directory", "utility", "dictionary", "execution", "traceback", "call", "mysite", "way", "staticliveservertestcase", "backends", "reference", "python", "options", "ordering", "exception", "simpletestcase", "details", "ctrl", "party", "method", "integration", "settings", "transaction", "test_views.py", "¶", "sound", "test_models.py", "command", "ran", "return", "applications", "note", "state", "memory", "body", "tutorial", "--failfast", "interruption", "tools", "system", "apps", "detail", "hasher", "isolation", "design", "polls.tests", "dependencies", "project"], "type": "documentation"},
{"title": "Templates | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/templates/", "content": "Templates ¶ Being a web framework, Django needs a convenient way to generate HTML\ndynamically. The most common approach relies on templates. A template contains\nthe static parts of the desired HTML output as well as some special syntax\ndescribing how dynamic content will be inserted. For a hands-on example of\ncreating HTML pages with templates, see Tutorial 3 . A Django project can be configured with one or several template engines (or\neven zero if you don’t use templates). Django ships built-in backends for its\nown template system, creatively called the Django template language (DTL), and\nfor the popular alternative Jinja2 . Backends for other template languages may\nbe available from third-parties. You can also write your own custom backend,\nsee Custom template backend Django defines a standard API for loading and rendering templates regardless\nof the backend. Loading consists of finding the template for a given identifier\nand preprocessing it, usually compiling it to an in-memory representation.\nRendering means interpolating the template with context data and returning the\nresulting string. The Django template language is Django’s own\ntemplate system. Until Django 1.8 it was the only built-in option available.\nIt’s a good template library even though it’s fairly opinionated and sports a\nfew idiosyncrasies. If you don’t have a pressing reason to choose another\nbackend, you should use the DTL, especially if you’re writing a pluggable\napplication and you intend to distribute templates. Django’s contrib apps that\ninclude templates, like django.contrib.admin ,\nuse the DTL. For historical reasons, both the generic support for template engines and the\nimplementation of the Django template language live in the django.template namespace. Warning The template system isn’t safe against untrusted template authors. For\nexample, a site shouldn’t allow its users to provide their own templates,\nsince template authors can do things like perform XSS attacks and access\nproperties of template variables that may contain sensitive information. The Django template language ¶ Syntax ¶ About this section This is an overview of the Django template language’s syntax. For details\nsee the language syntax reference . A Django template is a text document or a Python string marked-up using the\nDjango template language. Some constructs are recognized and interpreted by the\ntemplate engine. The main ones are variables and tags. A template is rendered with a context. Rendering replaces variables with their\nvalues, which are looked up in the context, and executes tags. Everything else\nis output as is. The syntax of the Django template language involves four constructs. Variables ¶ A variable outputs a value from the context, which is a dict-like object\nmapping keys to values. Variables are surrounded by {{ and }} like this: My first name is {{ first_name }} . My last name is {{ last_name }} . With a context of {'first_name': 'John', 'last_name': 'Doe'} , this template\nrenders to: My first name is John. My last name is Doe. Dictionary lookup, attribute lookup and list-index lookups are implemented with\na dot notation: {{ my_dict.key }} {{ my_object.attribute }} {{ my_list.0 }} If a variable resolves to a callable, the template system will call it with no\narguments and use its result instead of the callable. Tags ¶ Tags provide arbitrary logic in the rendering process. This definition is deliberately vague. For example, a tag can output content,\nserve as a control structure e.g. an “if” statement or a “for” loop, grab\ncontent from a database, or even enable access to other template tags. Tags are surrounded by {% and %} like this: {% csrf_token %} Most tags accept arguments: {% cycle 'odd' 'even' %} Some tags require beginning and ending tags: {% if user.is_authenticated %} Hello, {{ user.username }} . {% endif %} A reference of built-in tags is\navailable as well as instructions for writing custom tags . Filters ¶ Filters transform the values of variables and tag arguments. They look like this: {{ django | title }} With a context of {'django': 'the web framework for perfectionists with deadlines'} , this template renders to: The Web Framework For Perfectionists With Deadlines Some filters take an argument: {{ my_date | date :\"Y-m-d\" }} A reference of built-in filters is\navailable as well as instructions for writing custom filters . Comments ¶ Comments look like this: {# this won't be rendered #} A {% comment %} tag provides multi-line comments. Components ¶ About this section This is an overview of the Django template language’s APIs. For details\nsee the API reference . Engine ¶ django.template.Engine encapsulates an instance of the Django\ntemplate system. The main reason for instantiating an Engine directly is to use the Django template\nlanguage outside of a Django project. django.template.backends.django.DjangoTemplates is a thin wrapper\nadapting django.template.Engine to Django’s template backend API. Template ¶ django.template.Template represents a compiled template. Templates are\nobtained with Engine.get_template() or Engine.from_string() . Likewise django.template.backends.django.Template is a thin wrapper\nadapting django.template.Template to the common template API. Context ¶ django.template.Context holds some metadata in addition to the context\ndata. It is passed to Template.render() for rendering a template. django.template.RequestContext is a subclass of Context that stores the current HttpRequest and runs template context processors. The common API doesn’t have an equivalent concept. Context data is passed in a\nplain dict and the current HttpRequest is passed\nseparately if needed. Loaders ¶ Template loaders are responsible for locating templates, loading them, and\nreturning Template objects. Django provides several built-in template loaders and supports custom template loaders . Context processors ¶ Context processors are functions that receive the current HttpRequest as an argument and return a dict of\ndata to be added to the rendering context. Their main use is to add common data shared by all templates to the context\nwithout repeating code in every view. Django provides many built-in context processors ,\nand you can implement your own additional context processors, too. Support for template engines ¶ Configuration ¶ Templates engines are configured with the TEMPLATES setting. It’s a\nlist of configurations, one for each engine. The default value is empty. The settings.py generated by the startproject command defines a\nmore useful value: TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"DIRS\" : [], \"APP_DIRS\" : True , \"OPTIONS\" : { # ... some options here ... }, }, ] BACKEND is a dotted Python path to a template\nengine class implementing Django’s template backend API. The built-in backends\nare django.template.backends.django.DjangoTemplates and django.template.backends.jinja2.Jinja2 . Since most engines load templates from files, the top-level configuration for\neach engine contains two common settings: DIRS defines a list of directories where the\nengine should look for template source files, in search order. APP_DIRS tells whether the engine should\nlook for templates inside installed applications. Each backend defines a\nconventional name for the subdirectory inside applications where its\ntemplates should be stored. While uncommon, it’s possible to configure several instances of the same\nbackend with different options. In that case you should define a unique NAME for each engine. OPTIONS contains backend-specific settings. Usage ¶ The django.template.loader module defines two functions to load templates. get_template ( template_name , using = None ) [source] ¶ This function loads the template with the given name and returns a Template object. The exact type of the return value depends on the backend that loaded the\ntemplate. Each backend has its own Template class. get_template() tries each template engine in order until one succeeds.\nIf the template cannot be found, it raises TemplateDoesNotExist . If the template is found but\ncontains invalid syntax, it raises TemplateSyntaxError . How templates are searched and loaded depends on each engine’s backend and\nconfiguration. If you want to restrict the search to a particular template engine, pass\nthe engine’s NAME in the using argument. select_template ( template_name_list , using = None ) [source] ¶ select_template() is just like get_template() , except it takes a\nlist of template names. It tries each name in order and returns the first\ntemplate that exists. If loading a template fails, the following two exceptions, defined in django.template , may be raised: exception TemplateDoesNotExist ( msg , tried = None , backend = None , chain = None ) [source] ¶ This exception is raised when a template cannot be found. It accepts the\nfollowing optional arguments for populating the template postmortem on the debug page: backend The template backend instance from which the exception originated. tried A list of sources that were tried when finding the template. This is\nformatted as a list of tuples containing (origin, status) , where origin is an origin-like object and status is a string with the reason the template wasn’t found. chain A list of intermediate TemplateDoesNotExist exceptions raised when trying to load a template. This is used by\nfunctions, such as get_template() , that\ntry to load a given template from multiple engines. exception TemplateSyntaxError ( msg ) [source] ¶ This exception is raised when a template was found but contains errors. Template objects returned by get_template() and select_template() must provide a render() method with the following signature: Template. render ( context = None , request = None ) ¶ Renders this template with a given context. If context is provided, it must be a dict . If it isn’t\nprovided, the engine will render the template with an empty context. If request is provided, it must be an HttpRequest .\nThen the engine must make it, as well as the CSRF token, available in the\ntemplate. How this is achieved is up to each backend. Here’s an example of the search algorithm. For this example the TEMPLATES setting is: TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"DIRS\" : [ \"/home/html/example.com\" , \"/home/html/default\" , ], }, { \"BACKEND\" : \"django.template.backends.jinja2.Jinja2\" , \"DIRS\" : [ \"/home/html/jinja2\" , ], }, ] If you call get_template('story_detail.html') , here are the files Django\nwill look for, in order: /home/html/example.com/story_detail.html ( 'django' engine) /home/html/default/story_detail.html ( 'django' engine) /home/html/jinja2/story_detail.html ( 'jinja2' engine) If you call select_template(['story_253_detail.html', 'story_detail.html']) ,\nhere’s what Django will look for: /home/html/example.com/story_253_detail.html ( 'django' engine) /home/html/default/story_253_detail.html ( 'django' engine) /home/html/jinja2/story_253_detail.html ( 'jinja2' engine) /home/html/example.com/story_detail.html ( 'django' engine) /home/html/default/story_detail.html ( 'django' engine) /home/html/jinja2/story_detail.html ( 'jinja2' engine) When Django finds a template that exists, it stops looking. Use django.template.loader.select_template() for more flexibility You can use select_template() for flexible\ntemplate loading. For example, if you’ve written a news story and want\nsome stories to have custom templates, use something like select_template(['story_%s_detail.html' % story.id, 'story_detail.html']) . That’ll allow you to use a custom template for an\nindividual story, with a fallback template for stories that don’t have\ncustom templates. It’s possible – and preferable – to organize templates in subdirectories\ninside each directory containing templates. The convention is to make a\nsubdirectory for each Django app, with subdirectories within those\nsubdirectories as needed. Do this for your own sanity. Storing all templates in the root level of a\nsingle directory gets messy. To load a template that’s within a subdirectory, use a slash, like so: get_template ( \"news/story_detail.html\" ) Using the same TEMPLATES option as above, this will attempt to load\nthe following templates: /home/html/example.com/news/story_detail.html ( 'django' engine) /home/html/default/news/story_detail.html ( 'django' engine) /home/html/jinja2/news/story_detail.html ( 'jinja2' engine) In addition, to cut down on the repetitive nature of loading and rendering\ntemplates, Django provides a shortcut function which automates the process. render_to_string ( template_name , context = None , request = None , using = None ) [source] ¶ render_to_string() loads a template like get_template() and\ncalls its render() method immediately. It takes the following\narguments. template_name The name of the template to load and render. If it’s a list of template\nnames, Django uses select_template() instead of get_template() to find the template. context A dict to be used as the template’s context for rendering. request An optional HttpRequest that will be available\nduring the template’s rendering process. using An optional template engine NAME . The\nsearch for the template will be restricted to that engine. Usage example: from django.template.loader import render_to_string rendered = render_to_string ( \"my_template.html\" , { \"foo\" : \"bar\" }) See also the render() shortcut which calls render_to_string() and feeds the result into an HttpResponse suitable for returning from a view. Finally, you can use configured engines directly: engines ¶ Template engines are available in django.template.engines : from django.template import engines django_engine = engines [ \"django\" ] template = django_engine . from_string ( \"Hello {{ name }}!\" ) The lookup key — 'django' in this example — is the engine’s NAME . Built-in backends ¶ class DjangoTemplates [source] ¶ Set BACKEND to 'django.template.backends.django.DjangoTemplates' to configure a Django\ntemplate engine. When APP_DIRS is True , DjangoTemplates engines look for templates in the templates subdirectory of installed\napplications. This generic name was kept for backwards-compatibility. DjangoTemplates engines accept the following OPTIONS : 'autoescape' : a boolean that controls whether HTML autoescaping is\nenabled. It defaults to True . Warning Only set it to False if you’re rendering non-HTML templates! 'context_processors' : a list of dotted Python paths to callables that\nare used to populate the context when a template is rendered with a request.\nThese callables take a request object as their argument and return a dict of items to be merged into the context. It defaults to an empty list. See RequestContext for more information. 'debug' : a boolean that turns on/off template debug mode. If it is True , the fancy error page will display a detailed report for any\nexception raised during template rendering. This report contains the\nrelevant snippet of the template with the appropriate line highlighted. It defaults to the value of the DEBUG setting. 'loaders' : a list of dotted Python paths to template loader classes.\nEach Loader class knows how to import templates from a particular\nsource. Optionally, a tuple can be used instead of a string. The first item\nin the tuple should be the Loader class name, and subsequent items are\npassed to the Loader during initialization. The default depends on the values of DIRS and APP_DIRS . See Loader types for details. 'string_if_invalid' : the output, as a string, that the template system\nshould use for invalid (e.g. misspelled) variables. It defaults to an empty string. See How invalid variables are handled for details. 'file_charset' : the charset used to read template files on disk. It defaults to 'utf-8' . 'libraries' : A dictionary of labels and dotted Python paths of template\ntag modules to register with the template engine. This can be used to add\nnew libraries or provide alternate labels for existing ones. For example: OPTIONS = { \"libraries\" : { \"myapp_tags\" : \"path.to.myapp.tags\" , \"admin.urls\" : \"django.contrib.admin.templatetags.admin_urls\" , }, } Libraries can be loaded by passing the corresponding dictionary key to\nthe {% load %} tag. 'builtins' : A list of dotted Python paths of template tag modules to\nadd to built-ins . For example: OPTIONS = { \"builtins\" : [ \"myapp.builtins\" ], } Tags and filters from built-in libraries can be used without first calling\nthe {% load %} tag. class Jinja2 [source] ¶ Requires Jinja2 to be installed: /  $ python -m pip install Jinja2 ...\\> py -m pip install Jinja2 Set BACKEND to 'django.template.backends.jinja2.Jinja2' to configure a Jinja2 engine. When APP_DIRS is True , Jinja2 engines\nlook for templates in the jinja2 subdirectory of installed applications. The most important entry in OPTIONS is 'environment' . It’s a dotted Python path to a callable returning a Jinja2\nenvironment. It defaults to 'jinja2.Environment' . Django invokes that\ncallable and passes other options as keyword arguments. Furthermore, Django\nadds defaults that differ from Jinja2’s for a few options: 'autoescape' : True 'loader' : a loader configured for DIRS and APP_DIRS 'auto_reload' : settings.DEBUG 'undefined' : DebugUndefined if settings.DEBUG else Undefined Jinja2 engines also accept the following OPTIONS : 'context_processors' : a list of dotted Python paths to callables that\nare used to populate the context when a template is rendered with a request.\nThese callables take a request object as their argument and return a dict of items to be merged into the context. It defaults to an empty list. Using context processors with Jinja2 templates is discouraged. Context processors are useful with Django templates because Django templates\ndon’t support calling functions with arguments. Since Jinja2 doesn’t have\nthat limitation, it’s recommended to put the function that you would use as a\ncontext processor in the global variables available to the template using jinja2.Environment as described below. You can then call that function in\nthe template: {{ function ( request ) }} Some Django templates context processors return a fixed value. For Jinja2\ntemplates, this layer of indirection isn’t necessary since you can add\nconstants directly in jinja2.Environment . The original use case for adding context processors for Jinja2 involved: Making an expensive computation that depends on the request. Needing the result in every template. Using the result multiple times in each template. Unless all of these conditions are met, passing a function to the template is\nmore in line with the design of Jinja2. The default configuration is purposefully kept to a minimum. If a template is\nrendered with a request (e.g. when using render() ),\nthe Jinja2 backend adds the globals request , csrf_input , and csrf_token to the context. Apart from that, this backend doesn’t create a\nDjango-flavored environment. It doesn’t know about Django filters and tags.\nIn order to use Django-specific APIs, you must configure them into the\nenvironment. For example, you can create myproject/jinja2.py with this content: from django.templatetags.static import static from django.urls import reverse from jinja2 import Environment def environment ( ** options ): env = Environment ( ** options ) env . globals . update ( { \"static\" : static , \"url\" : reverse , } ) return env and set the 'environment' option to 'myproject.jinja2.environment' . Then you could use the following constructs in Jinja2 templates: < img src = \" {{ static ( 'path/to/company-logo.png' ) }} \" alt = \"Company Logo\" > < a href = \" {{ url ( 'admin:index' ) }} \" > Administration </ a > The concepts of tags and filters exist both in the Django template language\nand in Jinja2 but they’re used differently. Since Jinja2 supports passing\narguments to callables in templates, many features that require a template tag\nor filter in Django templates can be achieved by calling a function in Jinja2\ntemplates, as shown in the example above. Jinja2’s global namespace removes the\nneed for template context processors. The Django template language doesn’t have\nan equivalent of Jinja2 tests.", "keywords": ["users", "library", "#", "m", "metadata", "loop", "representation", "httpresponse", "myapp_tags", "compatibility", "constructs", "django.urls", "=", "engine", "story_253_detail.html", "href", "tag", "pip", "jinja2.py", "process", "fallback", "debug", "administration", "john", "first_name", "charset", "autoescape", "type", "stories", "custom", "objects", "lookups", "modules", "processors", "django.template.loader.select_template", "tags", "date", "render", "components", "things", "logic", "name", "backends", "reference", "web", "configurations", "jinja2.environment", "django.contrib.admin", "return", "logo", "reverse", "applications", "memory", "tutorial", "computation", "foo", "search", "/home", "my_template.html", "callables", "sanity", "status", "wrapper", "dirs", "nature", "url", "error", "conditions", "module", "code", "algorithm", "replaces", "pages", "filter", "false", "access", "class", "admin.urls", "app_dirs", "names", "'", "snippet", "request", "string_if_invalid", "database", "output", "*", "page", "types", "py", "subclass", "django.template.engines", "usage", "configuration", "render_to_string", "flexibility", "section", "/", "source", "concepts", "user.username", "use", "hands", "sources", "debugundefined", "environment", "origin", "img", "my_dict.key", "engines", "order", "signature", "default", "loader", "comment", "select_template", "option", "properties", "classes", "tests", "convention", "chain", "doe", "company", "src", "limitation", "template", "way", "utf-8", "template_name", "idiosyncrasies", "comments", "index", "builtins", "concept", "odd", "notation", "¶", "command", "django.template.backends.jinja2.jinja2", "templatesyntaxerror", "news", "disk", "content", "function", "my_list.0", "result", "view", "control", "engine.from_string", "values", "engine.get_template", "directories", "string", "env", "overview", "mapping", "jinja2", "libraries", "language", "get_template('story_detail.html", "level", "loading", "processor", "template_name_list", "labels", "namespace", "minimum", "django", "n’t", "entry", "languages", "template.render", "set", "context_processors", "value", "line", "subdirectories", "data", "implementation", "path.to.myapp.tags", "item", "backend", "layer", "identifier", "shortcut", "paths", "need", "instance", "djangotemplates", "initialization", "constants", "|", "report", "instances", "story", "structure", "statement", "django.template", "my_date", "object", "load", "templatedoesnotexist", "example.com", "httprequest", "dot", "indirection", "loaders", "instructions", "dictionary", "authors", "rendering", "keyword", "csrf", "story_detail.html", "variables", "root", "system", "apps", "renders", "items", "definition", "slash", "grab", "site", "features", "addition", "example", "ins", "app", "list", "parties", "perfectionists", "deadlines", "dtl", "reasons", "apis", "callable", "application", "approach", "title", "globals", "y", "syntax", "subdirectory", "ones", "keys", "case", "equivalent", "boolean", "lookup", "html", "errors", "django.contrib.admin.templatetags.admin_urls", "tuple", "arguments", "static", "xss", "postmortem", "msg", "contrib", "tuples", "last_name", "bar", "get_template", "csrf_input", "path", "functions", "key", "none", "filters", "select_template(['story_253_detail.html", "reason", "framework", "true", "dict", "\\", "api", "parts", "support", "mode", "document", "context", "cycle", "alternative", "files", "import", "d", "directory", "%", "defaults", "information", "python", "requestcontext", "options", "undefined", "times", "exception", "details", "method", "myapp.builtins", "settings", "ships", "argument", "attacks", "design", "templates", "beginning", "text", "project", "exceptions"], "type": "documentation"},
{"title": "Clickjacking Protection | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/clickjacking/", "content": "Clickjacking Protection ¶ The clickjacking middleware and decorators provide easy-to-use protection\nagainst clickjacking .  This type of attack occurs when a malicious site\ntricks a user into clicking on a concealed element of another site which they\nhave loaded in a hidden frame or iframe. An example of clickjacking ¶ Suppose an online store has a page where a logged in user can click “Buy Now” to\npurchase an item. A user has chosen to stay logged into the store all the time\nfor convenience. An attacker site might create an “I Like Ponies” button on one\nof their own pages, and load the store’s page in a transparent iframe such that\nthe “Buy Now” button is invisibly overlaid on the “I Like Ponies” button. If the\nuser visits the attacker’s site, clicking “I Like Ponies” will cause an\ninadvertent click on the “Buy Now” button and an unknowing purchase of the item. Preventing clickjacking ¶ Modern browsers honor the X-Frame-Options HTTP header that indicates whether\nor not a resource is allowed to load within a frame or iframe. If the response\ncontains the header with a value of SAMEORIGIN then the browser will only\nload the resource in a frame if the request originated from the same site. If\nthe header is set to DENY then the browser will block the resource from\nloading in a frame no matter which site made the request. Django provides a few ways to include this header in responses from your site: A middleware that sets the header in all responses. A set of view decorators that can be used to override the middleware or to\nonly set the header for certain views. The X-Frame-Options HTTP header will only be set by the middleware or view\ndecorators if it is not already present in the response. How to use it ¶ Setting X-Frame-Options for all responses ¶ To set the same X-Frame-Options value for all responses in your site, put 'django.middleware.clickjacking.XFrameOptionsMiddleware' to MIDDLEWARE : MIDDLEWARE = [ ... , \"django.middleware.clickjacking.XFrameOptionsMiddleware\" , ... , ] This middleware is enabled in the settings file generated by startproject . By default, the middleware will set the X-Frame-Options header to DENY for every outgoing HttpResponse . If you want any other value for\nthis header instead, set the X_FRAME_OPTIONS setting: X_FRAME_OPTIONS = \"SAMEORIGIN\" When using the middleware there may be some views where you do not want the X-Frame-Options header set. For those cases, you can use a view decorator\nthat tells the middleware not to set the header: from django.http import HttpResponse from django.views.decorators.clickjacking import xframe_options_exempt @xframe_options_exempt def ok_to_load_in_a_frame ( request ): return HttpResponse ( \"This page is safe to load in a frame on any site.\" ) Note If you want to submit a form or access a session cookie within a frame or\niframe, you may need to modify the CSRF_COOKIE_SAMESITE or SESSION_COOKIE_SAMESITE settings. Changed in Django 5.0: Support for wrapping asynchronous view functions was added to the @xframe_options_exempt decorator. Setting X-Frame-Options per view ¶ To set the X-Frame-Options header on a per view basis, Django provides these\ndecorators: from django.http import HttpResponse from django.views.decorators.clickjacking import xframe_options_deny from django.views.decorators.clickjacking import xframe_options_sameorigin @xframe_options_deny def view_one ( request ): return HttpResponse ( \"I won't display in any frame!\" ) @xframe_options_sameorigin def view_two ( request ): return HttpResponse ( \"Display in a frame if it's from the same origin as me.\" ) Note that you can use the decorators in conjunction with the middleware. Use of\na decorator overrides the middleware. Changed in Django 5.0: Support for wrapping asynchronous view functions was added to the @xframe_options_deny and @xframe_options_sameorigin decorators. Limitations ¶ The X-Frame-Options header will only protect against clickjacking in modern browsers .", "keywords": ["ways", "views", "xframe_options_deny", "-", "origin", "view", "store", "type", "xframe_options_exempt", "sameorigin", "middleware", "import", "element", "protection", "django.middleware.clickjacking", "suppose", "response", "header", "file", "httpresponse", "django", "startproject", "def", "http", "xframe_options_sameorigin", "=", "site", "inadvertent", "x_frame_options", "frame", "default", "ok_to_load_in_a_frame", "pages", "user", "ponies", "access", "example", "options", "set", "cases", "functions", "buy", "resource", "view_one", "form", "limitations", "purchase", "decorators", "session", "value", "settings", "decorator", "¶", "return", "iframe", "attacker", "button", "time", "x", "attack", "cookie", "session_cookie_samesite", "request", "basis", "browser", "clickjacking", "clicking", "csrf_cookie_samesite", "item", "conjunction", "browsers", "responses", "use", "page", "convenience", "support"], "type": "documentation"},
{"title": "Writing views | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/http/views/", "content": "Writing views ¶ A view function, or view for short, is a Python function that takes a\nweb request and returns a web response. This response can be the HTML contents\nof a web page, or a redirect, or a 404 error, or an XML document, or an image .\n. . or anything, really. The view itself contains whatever arbitrary logic is\nnecessary to return that response. This code can live anywhere you want, as long\nas it’s on your Python path. There’s no other requirement–no “magic,” so to\nspeak. For the sake of putting the code somewhere , the convention is to\nput views in a file called views.py , placed in your project or\napplication directory. A simple view ¶ Here’s a view that returns the current date and time, as an HTML document: from django.http import HttpResponse import datetime def current_datetime ( request ): now = datetime . datetime . now () html = '<html lang=\"en\"><body>It is now %s .</body></html>' % now return HttpResponse ( html ) Let’s step through this code one line at a time: First, we import the class HttpResponse from the django.http module, along with Python’s datetime library. Next, we define a function called current_datetime . This is the view\nfunction. Each view function takes an HttpRequest object as its first parameter, which is typically named request . Note that the name of the view function doesn’t matter; it doesn’t have to\nbe named in a certain way in order for Django to recognize it. We’re\ncalling it current_datetime here, because that name clearly indicates\nwhat it does. The view returns an HttpResponse object that\ncontains the generated response. Each view function is responsible for\nreturning an HttpResponse object. (There are\nexceptions, but we’ll get to those later.) Django’s Time Zone Django includes a TIME_ZONE setting that defaults to America/Chicago . This probably isn’t where you live, so you might want\nto change it in your settings file. Mapping URLs to views ¶ So, to recap, this view function returns an HTML page that includes the current\ndate and time. To display this view at a particular URL, you’ll need to create a URLconf ; see URL dispatcher for instructions. Returning errors ¶ Django provides help for returning HTTP error codes. There are subclasses of HttpResponse for a number of common HTTP status codes\nother than 200 (which means “OK” ). You can find the full list of available\nsubclasses in the request/response documentation. Return an instance of one of those subclasses instead of a\nnormal HttpResponse in order to signify an error. For\nexample: from django.http import HttpResponse , HttpResponseNotFound def my_view ( request ): # ... if foo : return HttpResponseNotFound ( \"<h1>Page not found</h1>\" ) else : return HttpResponse ( \"<h1>Page was found</h1>\" ) There isn’t a specialized subclass for every possible HTTP response code,\nsince many of them aren’t going to be that common. However, as documented in\nthe HttpResponse documentation, you can also pass the\nHTTP status code into the constructor for HttpResponse to create a return class for any status code you like. For example: from django.http import HttpResponse def my_view ( request ): # ... # Return a \"created\" (201) response code. return HttpResponse ( status = 201 ) Because 404 errors are by far the most common HTTP error, there’s an easier way\nto handle those errors. The Http404 exception ¶ class django.http. Http404 ¶ When you return an error such as HttpResponseNotFound ,\nyou’re responsible for defining the HTML of the resulting error page: return HttpResponseNotFound ( \"<h1>Page not found</h1>\" ) For convenience, and because it’s a good idea to have a consistent 404 error page\nacross your site, Django provides an Http404 exception. If you raise Http404 at any point in a view function, Django will catch it and return the\nstandard error page for your application, along with an HTTP error code 404. Example usage: from django.http import Http404 from django.shortcuts import render from polls.models import Poll def detail ( request , poll_id ): try : p = Poll . objects . get ( pk = poll_id ) except Poll . DoesNotExist : raise Http404 ( \"Poll does not exist\" ) return render ( request , \"polls/detail.html\" , { \"poll\" : p }) In order to show customized HTML when Django returns a 404, you can create an\nHTML template named 404.html and place it in the top level of your\ntemplate tree. This template will then be served when DEBUG is set\nto False . When DEBUG is True , you can provide a message to Http404 and\nit will appear in the standard 404 debug template. Use these messages for\ndebugging purposes; they generally aren’t suitable for use in a production 404\ntemplate. Customizing error views ¶ The default error views in Django should suffice for most web applications,\nbut can easily be overridden if you need any custom behavior. Specify the\nhandlers as seen below in your URLconf (setting them anywhere else will have no\neffect). The page_not_found() view is overridden by handler404 : handler404 = \"mysite.views.my_custom_page_not_found_view\" The server_error() view is overridden by handler500 : handler500 = \"mysite.views.my_custom_error_view\" The permission_denied() view is overridden by handler403 : handler403 = \"mysite.views.my_custom_permission_denied_view\" The bad_request() view is overridden by handler400 : handler400 = \"mysite.views.my_custom_bad_request_view\" See also Use the CSRF_FAILURE_VIEW setting to override the CSRF error\nview. Testing custom error views ¶ To test the response of a custom error handler, raise the appropriate exception\nin a test view. For example: from django.core.exceptions import PermissionDenied from django.http import HttpResponse from django.test import SimpleTestCase , override_settings from django.urls import path def response_error_handler ( request , exception = None ): return HttpResponse ( \"Error handler content\" , status = 403 ) def permission_denied_view ( request ): raise PermissionDenied urlpatterns = [ path ( \"403/\" , permission_denied_view ), ] handler403 = response_error_handler # ROOT_URLCONF must specify the module that contains handler403 = ... @override_settings ( ROOT_URLCONF = __name__ ) class CustomErrorHandlerTests ( SimpleTestCase ): def test_handler_renders_template_response ( self ): response = self . client . get ( \"/403/\" ) # Make assertions on the response here. For example: self . assertContains ( response , \"Error handler content\" , status_code = 403 ) Async views ¶ As well as being synchronous functions, views can also be asynchronous\n(“async”) functions, normally defined using Python’s async def syntax.\nDjango will automatically detect these and run them in an async context.\nHowever, you will need to use an async server based on ASGI to get their\nperformance benefits. Here’s an example of an async view: import datetime from django.http import HttpResponse async def current_datetime ( request ): now = datetime . datetime . now () html = '<html lang=\"en\"><body>It is now %s .</body></html>' % now return HttpResponse ( html ) You can read more about Django’s async support, and how to best use async\nviews, in Asynchronous support .", "keywords": ["function", "views", "bad_request", "view", "production", "zone", "status", "number", "tree", "url", "messages", "error", "def", "module", "code", "point", "current_datetime", "site", "lang=\"en\"><body", "customerrorhandlertests", "library", "false", "behavior", "class", "recap", "example", "#", "django.http", "mapping", "list", "403/", "mysite.views.my_custom_permission_denied_view", "'", "polls.models", "request", "page_not_found", "poll", "page", "httpresponse", "test", "level", "contents", "subclass", "django.urls", "idea", "handler500", "image", "application", "benefits", "http404", "usage", "django", "xml", "http", "django.core.exceptions", "=", "n’t", "asgi", "message", "urlconf", "permissiondenied", "p", "syntax", "sake", "line", "httpresponsenotfound", "django.shortcuts", "chicago", "codes", "mysite.views.my_custom_bad_request_view", "h1", "found</h1", "debug", "handler", "datetime", "use", "errors", "html", "mysite.views.my_custom_error_view", "server", "the", "assertions", "magic", "subclasses", "self", "instance", "custom", "performance", "objects", "documentation", "test_handler_renders_template_response", "file", "handler403", "root_urlconf", "handler400", "order", "default", "requirement", "path", "functions", "handler404", "my_view", "none", "help", "america", "time", "doesnotexist", "constructor", "convention", "date", "render", "setting", "purposes", "urls", "@override_settings", "convenience", "permission_denied_view", "support", "polls", "object", "document", "context", "logic", "import", "name", "httprequest", "async", "template", "response", "parameter", "detail.html", "directory", ">", "%", "defaults", "instructions", "pk", "way", "server_error", "404.html", "web", "python", "dispatcher", "csrf", "exception", "poll_id", "simpletestcase", "client", "status_code", "settings", "redirect", "¶", "return", "mysite.views.my_custom_page_not_found_view", "response_error_handler", "handlers", "applications", "effect", "detail", "foo", "assertcontains", "content", "project", "exceptions"], "type": "documentation"},
{"title": "Model Form Functions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/forms/models/", "content": "Model Form Functions ¶ Model Form API reference. For introductory material about model forms, see the Creating forms from models topic guide. modelform_factory ¶ modelform_factory ( model , form = ModelForm , fields = None , exclude = None , formfield_callback = None , widgets = None , localized_fields = None , labels = None , help_texts = None , error_messages = None , field_classes = None ) [source] ¶ Returns a ModelForm class for the given model .\nYou can optionally pass a form argument to use as a starting point for\nconstructing the ModelForm . fields is an optional list of field names. If provided, only the named\nfields will be included in the returned fields. exclude is an optional list of field names. If provided, the named\nfields will be excluded from the returned fields, even if they are listed\nin the fields argument. formfield_callback is a callable that takes a model field and returns\na form field. widgets is a dictionary of model field names mapped to a widget. localized_fields is a list of names of fields which should be localized. labels is a dictionary of model field names mapped to a label. help_texts is a dictionary of model field names mapped to a help text. error_messages is a dictionary of model field names mapped to a\ndictionary of error messages. field_classes is a dictionary of model field names mapped to a form\nfield class. See ModelForm factory function for example usage. You must provide the list of fields explicitly, either via keyword arguments fields or exclude , or the corresponding attributes on the form’s\ninner Meta class. See Selecting the fields to use for more\ninformation. Omitting any definition of the fields to use will result in\nan ImproperlyConfigured exception. modelformset_factory ¶ modelformset_factory ( model , form = ModelForm , formfield_callback = None , formset = BaseModelFormSet , extra = 1 , can_delete = False , can_order = False , max_num = None , fields = None , exclude = None , widgets = None , validate_max = False , localized_fields = None , labels = None , help_texts = None , error_messages = None , min_num = None , validate_min = False , field_classes = None , absolute_max = None , can_delete_extra = True , renderer = None , edit_only = False ) [source] ¶ Returns a FormSet class for the given model class. Arguments model , form , fields , exclude , formfield_callback , widgets , localized_fields , labels , help_texts , error_messages , and field_classes are all passed\nthrough to modelform_factory() . Arguments formset , extra , can_delete , can_order , max_num , validate_max , min_num , validate_min , absolute_max , can_delete_extra , and renderer are passed\nthrough to formset_factory() . See formsets for details. The edit_only argument allows preventing new objects creation . See Model formsets for example usage. inlineformset_factory ¶ inlineformset_factory ( parent_model , model , form = ModelForm , formset = BaseInlineFormSet , fk_name = None , fields = None , exclude = None , extra = 3 , can_order = False , can_delete = True , max_num = None , formfield_callback = None , widgets = None , validate_max = False , localized_fields = None , labels = None , help_texts = None , error_messages = None , min_num = None , validate_min = False , field_classes = None , absolute_max = None , can_delete_extra = True , renderer = None , edit_only = False ) [source] ¶ Returns an InlineFormSet using modelformset_factory() with\ndefaults of formset= BaseInlineFormSet , can_delete=True , and extra=3 . If your model has more than one ForeignKey to\nthe parent_model , you must specify a fk_name . See Inline formsets for example usage.", "keywords": ["starting", "function", "factory", "inline", "arguments", "max_num", "model", "modelformset_factory", "fk_name", "error_messages", "widgets", "can_order", "creation", "api", "formset", "labels", "definition", "objects", "inlineformset_factory", "absolute_max", "usage", "attributes", "localized_fields", "dictionary", "label", "modelform", "error", "messages", "basemodelformset", "point", "defaults", "=", "formsets", "reference", "forms", "information", "foreignkey", "formset_factory", "fields", "keyword", "false", "formfield_callback", "class", "example", "field", "functions", "min_num", "exception", "renderer", "form", "details", "none", "list", "widget", "help", "returns", "argument", "¶", "names", "meta", "baseinlineformset", "text", "source", "modelform_factory", "improperlyconfigured", "field_classes", "exclude", "parent_model", "inlineformset", "can_delete", "extra=3", "models", "guide", "topic", "help_texts", "material"], "type": "documentation"},
{"title": "Formset Functions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/forms/formsets/", "content": "Formset Functions ¶ Formset API reference. For introductory material about formsets, see the Formsets topic guide. formset_factory ¶ formset_factory ( form , formset = BaseFormSet , extra = 1 , can_order = False , can_delete = False , max_num = None , validate_max = False , min_num = None , validate_min = False , absolute_max = None , can_delete_extra = True , renderer = None ) [source] ¶ Returns a FormSet class for the given form class. See formsets for example usage.", "keywords": ["max_num", "formset", "absolute_max", "usage", "=", "formsets", "reference", "formset_factory", "baseformset", "false", "class", "example", "min_num", "functions", "guide", "renderer", "form", "none", "returns", "¶", "source", "can_delete", "api", "topic", "material"], "type": "documentation"},
{"title": "Model _meta API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/meta/", "content": "Model _meta API ¶ class Options [source] ¶ The model _meta API is at the core of the Django ORM. It enables other\nparts of the system such as lookups, queries, forms, and the admin to\nunderstand the capabilities of each model. The API is accessible through\nthe _meta attribute of each model class, which is an instance of an django.db.models.options.Options object. Methods that it provides can be used to: Retrieve all field instances of a model Retrieve a single field instance of a model by name Field access API ¶ Retrieving a single field instance of a model by name ¶ Options. get_field ( field_name ) [source] ¶ Returns the field instance given a name of a field. field_name can be the name of a field on the model, a field\non an abstract or inherited model, or a field defined on another\nmodel that points to the model. In the latter case, the field_name will be (in order of preference) the related_query_name set by the user, the related_name set by the user, or\nthe name automatically generated by Django. Hidden fields cannot be retrieved\nby name. If a field with the given name is not found a FieldDoesNotExist exception will be\nraised. >>> from django.contrib.auth.models import User # A field on the model >>> User . _meta . get_field ( \"username\" ) <django.db.models.fields.CharField: username> # A field from another model that has a relation with the current model >>> User . _meta . get_field ( \"logentry\" ) <ManyToOneRel: admin.logentry> # A non existent field >>> User . _meta . get_field ( \"does_not_exist\" ) Traceback (most recent call last): ... FieldDoesNotExist : User has no field named 'does_not_exist' Retrieving all field instances of a model ¶ Options. get_fields ( include_parents = True , include_hidden = False ) [source] ¶ Returns a tuple of fields associated with a model. get_fields() accepts\ntwo parameters that can be used to control which fields are returned: include_parents True by default. Recursively includes fields defined on parent\nclasses. If set to False , get_fields() will only search for\nfields declared directly on the current model. Fields from models that\ndirectly inherit from abstract models or proxy classes are considered\nto be local, not on the parent. include_hidden False by default. If set to True , get_fields() will include hidden fields . >>> from django.contrib.auth.models import User >>> User . _meta . get_fields () (<ManyToOneRel: admin.logentry>, <django.db.models.fields.AutoField: id>, <django.db.models.fields.CharField: password>, <django.db.models.fields.DateTimeField: last_login>, <django.db.models.fields.BooleanField: is_superuser>, <django.db.models.fields.CharField: username>, <django.db.models.fields.CharField: first_name>, <django.db.models.fields.CharField: last_name>, <django.db.models.fields.EmailField: email>, <django.db.models.fields.BooleanField: is_staff>, <django.db.models.fields.BooleanField: is_active>, <django.db.models.fields.DateTimeField: date_joined>, <django.db.models.fields.related.ManyToManyField: groups>, <django.db.models.fields.related.ManyToManyField: user_permissions>) # Also include hidden fields. >>> User . _meta . get_fields ( include_hidden = True ) (<ManyToOneRel: auth.user_groups>, <ManyToOneRel: auth.user_user_permissions>, <ManyToOneRel: admin.logentry>, <django.db.models.fields.AutoField: id>, <django.db.models.fields.CharField: password>, <django.db.models.fields.DateTimeField: last_login>, <django.db.models.fields.BooleanField: is_superuser>, <django.db.models.fields.CharField: username>, <django.db.models.fields.CharField: first_name>, <django.db.models.fields.CharField: last_name>, <django.db.models.fields.EmailField: email>, <django.db.models.fields.BooleanField: is_staff>, <django.db.models.fields.BooleanField: is_active>, <django.db.models.fields.DateTimeField: date_joined>, <django.db.models.fields.related.ManyToManyField: groups>, <django.db.models.fields.related.ManyToManyField: user_permissions>)", "keywords": ["get_fields", "fielddoesnotexist", "auth.user_user_permissions", "username", "proxy", "emailfield", "autofield", "forms", "false", "access", "_", "class", "field", "#", "is_active", "relation", "returns", "orm", "retrieve", "django.db.models.fields", "email", "models", "model", "get_field", "admin.logentry", "admin", "django.contrib.auth.models", "does_not_exist", "django", "=", "fields", "date_joined", "capabilities", "source", "case", "related_query_name", "include_parents", "tuple", "first_name", "instance", "auth.user_groups", "lookups", "core", "order", "default", "user", "manytoonerel", "attribute", "related_name", "classes", "meta", "instances", "true", "django.db.models.options", "booleanfield", "api", "object", "last_login", "field_name", "preference", "password", "groups", "import", "name", "charfield", "d", "manytomanyfield", ">", "call", "traceback", "is_superuser", "methods", "options", "queries", "exception", "logentry", "¶", "parameters", "system", "parent", "include_hidden", "existent", "datetimefield", "parts"], "type": "documentation"},
{"title": "Making queries | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/db/queries/", "content": "Making queries ¶ Once you’ve created your data models , Django\nautomatically gives you a database-abstraction API that lets you create,\nretrieve, update and delete objects. This document explains how to use this\nAPI. Refer to the data model reference for full\ndetails of all the various model lookup options. Throughout this guide (and in the reference), we’ll refer to the following\nmodels, which comprise a blog application: from datetime import date from django.db import models class Blog ( models . Model ): name = models . CharField ( max_length = 100 ) tagline = models . TextField () def __str__ ( self ): return self . name class Author ( models . Model ): name = models . CharField ( max_length = 200 ) email = models . EmailField () def __str__ ( self ): return self . name class Entry ( models . Model ): blog = models . ForeignKey ( Blog , on_delete = models . CASCADE ) headline = models . CharField ( max_length = 255 ) body_text = models . TextField () pub_date = models . DateField () mod_date = models . DateField ( default = date . today ) authors = models . ManyToManyField ( Author ) number_of_comments = models . IntegerField ( default = 0 ) number_of_pingbacks = models . IntegerField ( default = 0 ) rating = models . IntegerField ( default = 5 ) def __str__ ( self ): return self . headline Creating objects ¶ To represent database-table data in Python objects, Django uses an intuitive\nsystem: A model class represents a database table, and an instance of that\nclass represents a particular record in the database table. To create an object, instantiate it using keyword arguments to the model class,\nthen call save() to save it to the database. Assuming models live in a models.py file inside a blog Django app, here\nis an example: >>> from blog.models import Blog >>> b = Blog ( name = \"Beatles Blog\" , tagline = \"All the latest Beatles news.\" ) >>> b . save () This performs an INSERT SQL statement behind the scenes. Django doesn’t hit\nthe database until you explicitly call save() . The save() method has no return value. See also save() takes a number of advanced options not\ndescribed here. See the documentation for save() for complete details. To create and save an object in a single step, use the create() method. Saving changes to objects ¶ To save changes to an object that’s already in the database, use save() . Given a Blog instance b5 that has already been saved to the database,\nthis example changes its name and updates its record in the database: >>> b5 . name = \"New name\" >>> b5 . save () This performs an UPDATE SQL statement behind the scenes. Django doesn’t hit\nthe database until you explicitly call save() . Saving ForeignKey and ManyToManyField fields ¶ Updating a ForeignKey field works exactly the same\nway as saving a normal field – assign an object of the right type to the field\nin question. This example updates the blog attribute of an Entry instance entry , assuming appropriate instances of Entry and Blog are already saved to the database (so we can retrieve them below): >>> from blog.models import Blog , Entry >>> entry = Entry . objects . get ( pk = 1 ) >>> cheese_blog = Blog . objects . get ( name = \"Cheddar Talk\" ) >>> entry . blog = cheese_blog >>> entry . save () Updating a ManyToManyField works a little\ndifferently – use the add() method on the field\nto add a record to the relation. This example adds the Author instance joe to the entry object: >>> from blog.models import Author >>> joe = Author . objects . create ( name = \"Joe\" ) >>> entry . authors . add ( joe ) To add multiple records to a ManyToManyField in one\ngo, include multiple arguments in the call to add() , like this: >>> john = Author . objects . create ( name = \"John\" ) >>> paul = Author . objects . create ( name = \"Paul\" ) >>> george = Author . objects . create ( name = \"George\" ) >>> ringo = Author . objects . create ( name = \"Ringo\" ) >>> entry . authors . add ( john , paul , george , ringo ) Django will complain if you try to assign or add an object of the wrong type. Retrieving objects ¶ To retrieve objects from your database, construct a QuerySet via a Manager on your model class. A QuerySet represents a collection of objects\nfrom your database. It can have zero, one or many filters . Filters narrow\ndown the query results based on the given parameters. In SQL terms, a QuerySet equates to a SELECT statement,\nand a filter is a limiting clause such as WHERE or LIMIT . You get a QuerySet by using your model’s Manager . Each model has at least one Manager , and it’s called objects by default. Access it directly via the\nmodel class, like so: >>> Blog . objects <django.db.models.manager.Manager object at ...> >>> b = Blog ( name = \"Foo\" , tagline = \"Bar\" ) >>> b . objects Traceback: ... AttributeError: \"Manager isn't accessible via Blog instances.\" Note Managers are accessible only via model classes, rather than from model\ninstances, to enforce a separation between “table-level” operations and\n“record-level” operations. The Manager is the main source of QuerySets for\na model. For example, Blog.objects.all() returns a QuerySet that contains all Blog objects in\nthe database. Retrieving all objects ¶ The simplest way to retrieve objects from a table is to get all of them. To do\nthis, use the all() method on a Manager : >>> all_entries = Entry . objects . all () The all() method returns a QuerySet of all the objects in the database. Retrieving specific objects with filters ¶ The QuerySet returned by all() describes all objects in the\ndatabase table. Usually, though, you’ll need to select only a subset of the\ncomplete set of objects. To create such a subset, you refine the initial QuerySet , adding filter conditions. The two\nmost common ways to refine a QuerySet are: filter(**kwargs) Returns a new QuerySet containing objects\nthat match the given lookup parameters. exclude(**kwargs) Returns a new QuerySet containing objects\nthat do not match the given lookup parameters. The lookup parameters ( **kwargs in the above function definitions) should\nbe in the format described in Field lookups below. For example, to get a QuerySet of blog entries\nfrom the year 2006, use filter() like\nso: Entry . objects . filter ( pub_date__year = 2006 ) With the default manager class, it is the same as: Entry . objects . all () . filter ( pub_date__year = 2006 ) Chaining filters ¶ The result of refining a QuerySet is itself a QuerySet , so it’s possible to chain\nrefinements together. For example: >>> Entry . objects . filter ( headline__startswith = \"What\" ) . exclude ( ... pub_date__gte = datetime . date . today () ... ) . filter ( pub_date__gte = datetime . date ( 2005 , 1 , 30 )) This takes the initial QuerySet of all entries\nin the database, adds a filter, then an exclusion, then another filter. The\nfinal result is a QuerySet containing all\nentries with a headline that starts with “What”, that were published between\nJanuary 30, 2005, and the current day. Filtered QuerySet s are unique ¶ Each time you refine a QuerySet , you get a\nbrand-new QuerySet that is in no way bound to\nthe previous QuerySet . Each refinement creates\na separate and distinct QuerySet that can be\nstored, used and reused. Example: >>> q1 = Entry . objects . filter ( headline__startswith = \"What\" ) >>> q2 = q1 . exclude ( pub_date__gte = datetime . date . today ()) >>> q3 = q1 . filter ( pub_date__gte = datetime . date . today ()) These three QuerySets are separate. The first is a base QuerySet containing all entries that contain a\nheadline starting with “What”. The second is a subset of the first, with an\nadditional criteria that excludes records whose pub_date is today or in the\nfuture. The third is a subset of the first, with an additional criteria that\nselects only the records whose pub_date is today or in the future. The\ninitial QuerySet ( q1 ) is unaffected by the\nrefinement process. QuerySet s are lazy ¶ QuerySets are lazy – the act of creating a QuerySet doesn’t involve any database\nactivity. You can stack filters together all day long, and Django won’t\nactually run the query until the QuerySet is evaluated . Take a look at this example: >>> q = Entry . objects . filter ( headline__startswith = \"What\" ) >>> q = q . filter ( pub_date__lte = datetime . date . today ()) >>> q = q . exclude ( body_text__icontains = \"food\" ) >>> print ( q ) Though this looks like three database hits, in fact it hits the database only\nonce, at the last line ( print(q) ). In general, the results of a QuerySet aren’t fetched from the database\nuntil you “ask” for them. When you do, the QuerySet is evaluated by accessing the\ndatabase. For more details on exactly when evaluation takes place, see When QuerySets are evaluated . Retrieving a single object with get() ¶ filter() will always give you a QuerySet , even if only a single object matches\nthe query - in this case, it will be a QuerySet containing a single element. If you know there is only one object that matches your query, you can use the get() method on a Manager which returns the object directly: >>> one_entry = Entry . objects . get ( pk = 1 ) You can use any query expression with get() , just like with filter() - again, see Field lookups below. Note that there is a difference between using get() , and using filter() with a slice of [0] . If\nthere are no results that match the query, get() will raise a DoesNotExist exception. This exception is an attribute of the model class that the query is\nbeing performed on - so in the code above, if there is no Entry object with\na primary key of 1, Django will raise Entry.DoesNotExist . Similarly, Django will complain if more than one item matches the get() query. In this case, it will raise MultipleObjectsReturned , which again is an\nattribute of the model class itself. Other QuerySet methods ¶ Most of the time you’ll use all() , get() , filter() and exclude() when you need to look up\nobjects from the database. However, that’s far from all there is; see the QuerySet API Reference for a complete list of all the\nvarious QuerySet methods. Limiting QuerySet s ¶ Use a subset of Python’s array-slicing syntax to limit your QuerySet to a certain number of results. This\nis the equivalent of SQL’s LIMIT and OFFSET clauses. For example, this returns the first 5 objects ( LIMIT 5 ): >>> Entry . objects . all ()[: 5 ] This returns the sixth through tenth objects ( OFFSET 5 LIMIT 5 ): >>> Entry . objects . all ()[ 5 : 10 ] Negative indexing (i.e. Entry.objects.all()[-1] ) is not supported. Generally, slicing a QuerySet returns a new QuerySet – it doesn’t evaluate the query. An\nexception is if you use the “step” parameter of Python slice syntax. For\nexample, this would actually execute the query in order to return a list of\nevery second object of the first 10: >>> Entry . objects . all ()[: 10 : 2 ] Further filtering or ordering of a sliced queryset is prohibited due to the\nambiguous nature of how that might work. To retrieve a single object rather than a list\n(e.g. SELECT foo FROM bar LIMIT 1 ), use an index instead of a slice. For\nexample, this returns the first Entry in the database, after ordering\nentries alphabetically by headline: >>> Entry . objects . order_by ( \"headline\" )[ 0 ] This is roughly equivalent to: >>> Entry . objects . order_by ( \"headline\" )[ 0 : 1 ] . get () Note, however, that the first of these will raise IndexError while the\nsecond will raise DoesNotExist if no objects match the given criteria. See get() for more details. Field lookups ¶ Field lookups are how you specify the meat of an SQL WHERE clause. They’re\nspecified as keyword arguments to the QuerySet methods filter() , exclude() and get() . Basic lookups keyword arguments take the form field__lookuptype=value .\n(That’s a double-underscore). For example: >>> Entry . objects . filter ( pub_date__lte = \"2006-01-01\" ) translates (roughly) into the following SQL: SELECT * FROM blog_entry WHERE pub_date <= '2006-01-01' ; How this is possible Python has the ability to define functions that accept arbitrary name-value\narguments whose names and values are evaluated at runtime. For more\ninformation, see Keyword Arguments in the official Python tutorial. The field specified in a lookup has to be the name of a model field. There’s\none exception though, in case of a ForeignKey you\ncan specify the field name suffixed with _id . In this case, the value\nparameter is expected to contain the raw value of the foreign model’s primary\nkey. For example: >>> Entry . objects . filter ( blog_id = 4 ) If you pass an invalid keyword argument, a lookup function will raise TypeError . The database API supports about two dozen lookup types; a complete reference\ncan be found in the field lookup reference . To give you\na taste of what’s available, here’s some of the more common lookups you’ll\nprobably use: exact An “exact” match. For example: >>> Entry . objects . get ( headline__exact = \"Cat bites dog\" ) Would generate SQL along these lines: SELECT ... WHERE headline = 'Cat bites dog' ; If you don’t provide a lookup type – that is, if your keyword argument\ndoesn’t contain a double underscore – the lookup type is assumed to be exact . For example, the following two statements are equivalent: >>> Blog . objects . get ( id__exact = 14 ) # Explicit form >>> Blog . objects . get ( id = 14 ) # __exact is implied This is for convenience, because exact lookups are the common case. iexact A case-insensitive match. So, the query: >>> Blog . objects . get ( name__iexact = \"beatles blog\" ) Would match a Blog titled \"Beatles Blog\" , \"beatles blog\" , or\neven \"BeAtlES blOG\" . contains Case-sensitive containment test. For example: Entry . objects . get ( headline__contains = \"Lennon\" ) Roughly translates to this SQL: SELECT ... WHERE headline LIKE '%Lennon%' ; Note this will match the headline 'Today Lennon honored' but not 'today lennon honored' . There’s also a case-insensitive version, icontains . startswith , endswith Starts-with and ends-with search, respectively. There are also\ncase-insensitive versions called istartswith and iendswith . Again, this only scratches the surface. A complete reference can be found in the field lookup reference . Lookups that span relationships ¶ Django offers a powerful and intuitive way to “follow” relationships in\nlookups, taking care of the SQL JOIN s for you automatically, behind the\nscenes. To span a relationship, use the field name of related fields\nacross models, separated by double underscores, until you get to the field you\nwant. This example retrieves all Entry objects with a Blog whose name is 'Beatles Blog' : >>> Entry . objects . filter ( blog__name = \"Beatles Blog\" ) This spanning can be as deep as you’d like. It works backwards, too. While it can be customized , by default you refer to a “reverse”\nrelationship in a lookup using the lowercase name of the model. This example retrieves all Blog objects which have at least one Entry whose headline contains 'Lennon' : >>> Blog . objects . filter ( entry__headline__contains = \"Lennon\" ) If you are filtering across multiple relationships and one of the intermediate\nmodels doesn’t have a value that meets the filter condition, Django will treat\nit as if there is an empty (all values are NULL ), but valid, object there.\nAll this means is that no error will be raised. For example, in this filter: Blog . objects . filter ( entry__authors__name = \"Lennon\" ) (if there was a related Author model), if there was no author associated with an entry, it would be treated as if there was also no name attached, rather than raising an error because of the missing author .\nUsually this is exactly what you want to have happen. The only case where it\nmight be confusing is if you are using isnull . Thus: Blog . objects . filter ( entry__authors__name__isnull = True ) will return Blog objects that have an empty name on the author and\nalso those which have an empty author on the entry . If you don’t want\nthose latter objects, you could write: Blog . objects . filter ( entry__authors__isnull = False , entry__authors__name__isnull = True ) Spanning multi-valued relationships ¶ When spanning a ManyToManyField or a reverse ForeignKey (such as from Blog to Entry ),\nfiltering on multiple attributes raises the question of whether to require each\nattribute to coincide in the same related object. We might seek blogs that have\nan entry from 2008 with “Lennon” in its headline, or we might seek blogs that\nmerely have any entry from 2008 as well as some newer or older entry with “Lennon” in its headline. To select all blogs containing at least one entry from 2008 having “Lennon” in its headline (the same entry satisfying both conditions), we would write: Blog . objects . filter ( entry__headline__contains = \"Lennon\" , entry__pub_date__year = 2008 ) Otherwise, to perform a more permissive query selecting any blogs with merely some entry with “Lennon” in its headline and some entry from 2008, we\nwould write: Blog . objects . filter ( entry__headline__contains = \"Lennon\" ) . filter ( entry__pub_date__year = 2008 ) Suppose there is only one blog that has both entries containing “Lennon” and\nentries from 2008, but that none of the entries from 2008 contained “Lennon” .\nThe first query would not return any blogs, but the second query would return\nthat one blog. (This is because the entries selected by the second filter may\nor may not be the same as the entries in the first filter. We are filtering the Blog items with each filter statement, not the Entry items.) In short,\nif each condition needs to match the same related object, then each should be\ncontained in a single filter() call. Note As the second (more permissive) query chains multiple filters, it performs\nmultiple joins to the primary model, potentially yielding duplicates. >>> from datetime import date >>> beatles = Blog . objects . create ( name = \"Beatles Blog\" ) >>> pop = Blog . objects . create ( name = \"Pop Music Blog\" ) >>> Entry . objects . create ( ... blog = beatles , ... headline = \"New Lennon Biography\" , ... pub_date = date ( 2008 , 6 , 1 ), ... ) <Entry: New Lennon Biography> >>> Entry . objects . create ( ... blog = beatles , ... headline = \"New Lennon Biography in Paperback\" , ... pub_date = date ( 2009 , 6 , 1 ), ... ) <Entry: New Lennon Biography in Paperback> >>> Entry . objects . create ( ... blog = pop , ... headline = \"Best Albums of 2008\" , ... pub_date = date ( 2008 , 12 , 15 ), ... ) <Entry: Best Albums of 2008> >>> Entry . objects . create ( ... blog = pop , ... headline = \"Lennon Would Have Loved Hip Hop\" , ... pub_date = date ( 2020 , 4 , 1 ), ... ) <Entry: Lennon Would Have Loved Hip Hop> >>> Blog . objects . filter ( ... entry__headline__contains = \"Lennon\" , ... entry__pub_date__year = 2008 , ... ) <QuerySet [<Blog: Beatles Blog>]> >>> Blog . objects . filter ( ... entry__headline__contains = \"Lennon\" , ... ) . filter ( ... entry__pub_date__year = 2008 , ... ) <QuerySet [<Blog: Beatles Blog>, <Blog: Beatles Blog>, <Blog: Pop Music Blog]> Note The behavior of filter() for queries\nthat span multi-value relationships, as described above, is not implemented\nequivalently for exclude() . Instead,\nthe conditions in a single exclude() call will not necessarily refer to the same item. For example, the following query would exclude blogs that contain both entries with “Lennon” in the headline and entries published in 2008: Blog . objects . exclude ( entry__headline__contains = \"Lennon\" , entry__pub_date__year = 2008 , ) However, unlike the behavior when using filter() , this will not limit blogs\nbased on entries that satisfy both conditions. In order to do that, i.e.\nto select all blogs that do not contain entries published with “Lennon” that were published in 2008, you need to make two queries: Blog . objects . exclude ( entry__in = Entry . objects . filter ( headline__contains = \"Lennon\" , pub_date__year = 2008 , ), ) Filters can reference fields on the model ¶ In the examples given so far, we have constructed filters that compare\nthe value of a model field with a constant. But what if you want to compare\nthe value of a model field with another field on the same model? Django provides F expressions to allow such\ncomparisons. Instances of F() act as a reference to a model field within a\nquery. These references can then be used in query filters to compare the values\nof two different fields on the same model instance. For example, to find a list of all blog entries that have had more comments\nthan pingbacks, we construct an F() object to reference the pingback count,\nand use that F() object in the query: >>> from django.db.models import F >>> Entry . objects . filter ( number_of_comments__gt = F ( \"number_of_pingbacks\" )) Django supports the use of addition, subtraction, multiplication,\ndivision, modulo, and power arithmetic with F() objects, both with constants\nand with other F() objects. To find all the blog entries with more than twice as many comments as pingbacks, we modify the query: >>> Entry . objects . filter ( number_of_comments__gt = F ( \"number_of_pingbacks\" ) * 2 ) To find all the entries where the rating of the entry is less than the\nsum of the pingback count and comment count, we would issue the\nquery: >>> Entry . objects . filter ( rating__lt = F ( \"number_of_comments\" ) + F ( \"number_of_pingbacks\" )) You can also use the double underscore notation to span relationships in\nan F() object. An F() object with a double underscore will introduce\nany joins needed to access the related object. For example, to retrieve all\nthe entries where the author’s name is the same as the blog name, we could\nissue the query: >>> Entry . objects . filter ( authors__name = F ( \"blog__name\" )) For date and date/time fields, you can add or subtract a timedelta object. The following would return all entries\nthat were modified more than 3 days after they were published: >>> from datetime import timedelta >>> Entry . objects . filter ( mod_date__gt = F ( \"pub_date\" ) + timedelta ( days = 3 )) The F() objects support bitwise operations by .bitand() , .bitor() , .bitxor() , .bitrightshift() , and .bitleftshift() . For example: >>> F ( \"somefield\" ) . bitand ( 16 ) Oracle Oracle doesn’t support bitwise XOR operation. Expressions can reference transforms ¶ Django supports using transforms in expressions. For example, to find all Entry objects published in the same year as they\nwere last modified: >>> from django.db.models import F >>> Entry . objects . filter ( pub_date__year = F ( \"mod_date__year\" )) To find the earliest year an entry was published, we can issue the query: >>> from django.db.models import Min >>> Entry . objects . aggregate ( first_published_year = Min ( \"pub_date__year\" )) This example finds the value of the highest rated entry and the total number\nof comments on all entries for each year: >>> from django.db.models import OuterRef , Subquery , Sum >>> Entry . objects . values ( \"pub_date__year\" ) . annotate ( ... top_rating = Subquery ( ... Entry . objects . filter ( ... pub_date__year = OuterRef ( \"pub_date__year\" ), ... ) ... . order_by ( \"-rating\" ) ... . values ( \"rating\" )[: 1 ] ... ), ... total_comments = Sum ( \"number_of_comments\" ), ... ) The pk lookup shortcut ¶ For convenience, Django provides a pk lookup shortcut, which stands for\n“primary key”. In the example Blog model, the primary key is the id field, so these\nthree statements are equivalent: >>> Blog . objects . get ( id__exact = 14 ) # Explicit form >>> Blog . objects . get ( id = 14 ) # __exact is implied >>> Blog . objects . get ( pk = 14 ) # pk implies id__exact The use of pk isn’t limited to __exact queries – any query term\ncan be combined with pk to perform a query on the primary key of a model: # Get blogs entries with id 1, 4 and 7 >>> Blog . objects . filter ( pk__in = [ 1 , 4 , 7 ]) # Get all blog entries with id > 14 >>> Blog . objects . filter ( pk__gt = 14 ) pk lookups also work across joins. For example, these three statements are\nequivalent: >>> Entry . objects . filter ( blog__id__exact = 3 ) # Explicit form >>> Entry . objects . filter ( blog__id = 3 ) # __exact is implied >>> Entry . objects . filter ( blog__pk = 3 ) # __pk implies __id__exact Escaping percent signs and underscores in LIKE statements ¶ The field lookups that equate to LIKE SQL statements ( iexact , contains , icontains , startswith , istartswith , endswith and iendswith ) will automatically escape the two special characters used in LIKE statements – the percent sign and the underscore. (In a LIKE statement, the percent sign signifies a multiple-character wildcard and the\nunderscore signifies a single-character wildcard.) This means things should work intuitively, so the abstraction doesn’t leak.\nFor example, to retrieve all the entries that contain a percent sign, use the\npercent sign as any other character: >>> Entry . objects . filter ( headline__contains = \"%\" ) Django takes care of the quoting for you; the resulting SQL will look something\nlike this: SELECT ... WHERE headline LIKE '%\\%%' ; Same goes for underscores. Both percentage signs and underscores are handled\nfor you transparently. Caching and QuerySet s ¶ Each QuerySet contains a cache to minimize\ndatabase access. Understanding how it works will allow you to write the most\nefficient code. In a newly created QuerySet , the cache is\nempty. The first time a QuerySet is evaluated\n– and, hence, a database query happens – Django saves the query results in\nthe QuerySet ’s cache and returns the results\nthat have been explicitly requested (e.g., the next element, if the QuerySet is being iterated over). Subsequent\nevaluations of the QuerySet reuse the cached\nresults. Keep this caching behavior in mind, because it may bite you if you don’t use\nyour QuerySet s correctly. For example, the\nfollowing will create two QuerySet s, evaluate\nthem, and throw them away: >>> print ([ e . headline for e in Entry . objects . all ()]) >>> print ([ e . pub_date for e in Entry . objects . all ()]) That means the same database query will be executed twice, effectively doubling\nyour database load. Also, there’s a possibility the two lists may not include\nthe same database records, because an Entry may have been added or deleted\nin the split second between the two requests. To avoid this problem, save the QuerySet and\nreuse it: >>> queryset = Entry . objects . all () >>> print ([ p . headline for p in queryset ]) # Evaluate the query set. >>> print ([ p . pub_date for p in queryset ]) # Reuse the cache from the evaluation. When QuerySet s are not cached ¶ Querysets do not always cache their results.  When evaluating only part of\nthe queryset, the cache is checked, but if it is not populated then the items\nreturned by the subsequent query are not cached. Specifically, this means that limiting the queryset using an array slice or an\nindex will not populate the cache. For example, repeatedly getting a certain index in a queryset object will query\nthe database each time: >>> queryset = Entry . objects . all () >>> print ( queryset [ 5 ]) # Queries the database >>> print ( queryset [ 5 ]) # Queries the database again However, if the entire queryset has already been evaluated, the cache will be\nchecked instead: >>> queryset = Entry . objects . all () >>> [ entry for entry in queryset ] # Queries the database >>> print ( queryset [ 5 ]) # Uses cache >>> print ( queryset [ 5 ]) # Uses cache Here are some examples of other actions that will result in the entire queryset\nbeing evaluated and therefore populate the cache: >>> [ entry for entry in queryset ] >>> bool ( queryset ) >>> entry in queryset >>> list ( queryset ) Note Simply printing the queryset will not populate the cache. This is because\nthe call to __repr__() only returns a slice of the entire queryset. Asynchronous queries ¶ If you are writing asynchronous views or code, you cannot use the ORM for\nqueries in quite the way we have described above, as you cannot call blocking synchronous code from asynchronous code - it will block up the event loop\n(or, more likely, Django will notice and raise a SynchronousOnlyOperation to stop that from happening). Fortunately, you can do many queries using Django’s asynchronous query APIs.\nEvery method that might block - such as get() or delete() - has an\nasynchronous variant ( aget() or adelete() ), and when you iterate over\nresults, you can use asynchronous iteration ( async for ) instead. Query iteration ¶ The default way of iterating over a query - with for - will result in a\nblocking database query behind the scenes as Django loads the results at\niteration time. To fix this, you can swap to async for : async for entry in Authors . objects . filter ( name__startswith = \"A\" ): ... Be aware that you also can’t do other things that might iterate over the\nqueryset, such as wrapping list() around it to force its evaluation (you\ncan use async for in a comprehension, if you want it). Because QuerySet methods like filter() and exclude() do not\nactually run the query - they set up the queryset to run when it’s iterated\nover - you can use those freely in asynchronous code. For a guide to which\nmethods can keep being used like this, and which have asynchronous versions,\nread the next section. QuerySet and manager methods ¶ Some methods on managers and querysets - like get() and first() - force\nexecution of the queryset and are blocking. Some, like filter() and exclude() , don’t force execution and so are safe to run from asynchronous\ncode. But how are you supposed to tell the difference? While you could poke around and see if there is an a -prefixed version of\nthe method (for example, we have aget() but not afilter() ), there is a\nmore logical way - look up what kind of method it is in the QuerySet reference . In there, you’ll find the methods on QuerySets grouped into two sections: Methods that return new querysets : These are the non-blocking ones,\nand don’t have asynchronous versions. You’re free to use these in any\nsituation, though read the notes on defer() and only() before you use\nthem. Methods that do not return querysets : These are the blocking ones, and\nhave asynchronous versions - the asynchronous name for each is noted in its\ndocumentation, though our standard pattern is to add an a prefix. Using this distinction, you can work out when you need to use asynchronous\nversions, and when you don’t. For example, here’s a valid asynchronous query: user = await User . objects . filter ( username = my_input ) . afirst () filter() returns a queryset, and so it’s fine to keep chaining it inside an\nasynchronous environment, whereas first() evaluates and returns a model\ninstance - thus, we change to afirst() , and use await at the front of\nthe whole expression in order to call it in an asynchronous-friendly way. Note If you forget to put the await part in, you may see errors like “coroutine object has no attribute x” or “<coroutine …>” strings in\nplace of your model instances. If you ever see these, you are missing an await somewhere to turn that coroutine into a real value. Transactions ¶ Transactions are not currently supported with asynchronous queries and\nupdates. You will find that trying to use one raises SynchronousOnlyOperation . If you wish to use a transaction, we suggest you write your ORM code inside a\nseparate, synchronous function and then call that using sync_to_async - see Asynchronous support for more. Querying JSONField ¶ Lookups implementation is different in JSONField ,\nmainly due to the existence of key transformations. To demonstrate, we will use\nthe following example model: from django.db import models class Dog ( models . Model ): name = models . CharField ( max_length = 200 ) data = models . JSONField ( null = True ) def __str__ ( self ): return self . name Storing and querying for None ¶ As with other fields, storing None as the field’s value will store it as\nSQL NULL . While not recommended, it is possible to store JSON scalar null instead of SQL NULL by using Value(None, JSONField()) . Whichever of the values is stored, when retrieved from the database, the Python\nrepresentation of the JSON scalar null is the same as SQL NULL , i.e. None . Therefore, it can be hard to distinguish between them. This only applies to None as the top-level value of the field. If None is inside a list or dict , it will always be interpreted\nas JSON null . When querying, None value will always be interpreted as JSON null . To\nquery for SQL NULL , use isnull : >>> Dog . objects . create ( name = \"Max\" , data = None ) # SQL NULL. <Dog: Max> >>> Dog . objects . create ( name = \"Archie\" , data = Value ( None , JSONField ())) # JSON null. <Dog: Archie> >>> Dog . objects . filter ( data = None ) <QuerySet [<Dog: Archie>]> >>> Dog . objects . filter ( data = Value ( None , JSONField ())) <QuerySet [<Dog: Archie>]> >>> Dog . objects . filter ( data__isnull = True ) <QuerySet [<Dog: Max>]> >>> Dog . objects . filter ( data__isnull = False ) <QuerySet [<Dog: Archie>]> Unless you are sure you wish to work with SQL NULL values, consider setting null=False and providing a suitable default for empty values, such as default=dict . Note Storing JSON scalar null does not violate null=False . Key, index, and path transforms ¶ To query based on a given dictionary key, use that key as the lookup name: >>> Dog . objects . create ( ... name = \"Rufus\" , ... data = { ... \"breed\" : \"labrador\" , ... \"owner\" : { ... \"name\" : \"Bob\" , ... \"other_pets\" : [ ... { ... \"name\" : \"Fishy\" , ... } ... ], ... }, ... }, ... ) <Dog: Rufus> >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : None }) <Dog: Meg> >>> Dog . objects . filter ( data__breed = \"collie\" ) <QuerySet [<Dog: Meg>]> Multiple keys can be chained together to form a path lookup: >>> Dog . objects . filter ( data__owner__name = \"Bob\" ) <QuerySet [<Dog: Rufus>]> If the key is an integer, it will be interpreted as an index transform in an\narray: >>> Dog . objects . filter ( data__owner__other_pets__0__name = \"Fishy\" ) <QuerySet [<Dog: Rufus>]> If the key you wish to query by clashes with the name of another lookup, use\nthe contains lookup instead. To query for missing keys, use the isnull lookup: >>> Dog . objects . create ( name = \"Shep\" , data = { \"breed\" : \"collie\" }) <Dog: Shep> >>> Dog . objects . filter ( data__owner__isnull = True ) <QuerySet [<Dog: Shep>]> Note The lookup examples given above implicitly use the exact lookup.\nKey, index, and path transforms can also be chained with: icontains , endswith , iendswith , iexact , regex , iregex , startswith , istartswith , lt , lte , gt , and gte , as well as with Containment and key lookups . KT() expressions ¶ class KT ( lookup ) ¶ Represents the text value of a key, index, or path transform of JSONField . You can use the double underscore\nnotation in lookup to chain dictionary key and index transforms. For example: >>> from django.db.models.fields.json import KT >>> Dog . objects . create ( ... name = \"Shep\" , ... data = { ... \"owner\" : { \"name\" : \"Bob\" }, ... \"breed\" : [ \"collie\" , \"lhasa apso\" ], ... }, ... ) <Dog: Shep> >>> Dogs . objects . annotate ( ... first_breed = KT ( \"data__breed__1\" ), owner_name = KT ( \"data__owner__name\" ) ... ) . filter ( first_breed__startswith = \"lhasa\" , owner_name = \"Bob\" ) <QuerySet [<Dog: Shep>]> Note Due to the way in which key-path queries work, exclude() and filter() are not guaranteed to\nproduce exhaustive sets. If you want to include objects that do not have\nthe path, add the isnull lookup. Warning Since any string could be a key in a JSON object, any lookup other than\nthose listed below will be interpreted as a key lookup. No errors are\nraised. Be extra careful for typing mistakes, and always check your queries\nwork as you intend. MariaDB and Oracle users Using order_by() on key, index, or\npath transforms will sort the objects using the string representation of\nthe values. This is because MariaDB and Oracle Database do not provide a\nfunction that converts JSON values into their equivalent SQL values. Oracle users On Oracle Database, using None as the lookup value in an exclude() query will return objects\nthat do not have null as the value at the given path, including objects\nthat do not have the path. On other database backends, the query will\nreturn objects that have the path and the value is not null . PostgreSQL users On PostgreSQL, if only one key or index is used, the SQL operator -> is\nused. If multiple operators are used then the #> operator is used. SQLite users On SQLite, \"true\" , \"false\" , and \"null\" string values will\nalways be interpreted as True , False , and JSON null respectively. Containment and key lookups ¶ contains ¶ The contains lookup is overridden on JSONField . The returned\nobjects are those where the given dict of key-value pairs are all\ncontained in the top-level of the field. For example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" , \"owner\" : \"Bob\" }) <Dog: Rufus> >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) <Dog: Meg> >>> Dog . objects . create ( name = \"Fred\" , data = {}) <Dog: Fred> >>> Dog . objects . filter ( data__contains = { \"owner\" : \"Bob\" }) <QuerySet [<Dog: Rufus>, <Dog: Meg>]> >>> Dog . objects . filter ( data__contains = { \"breed\" : \"collie\" }) <QuerySet [<Dog: Meg>]> Oracle and SQLite contains is not supported on Oracle and SQLite. contained_by ¶ This is the inverse of the contains lookup - the\nobjects returned will be those where the key-value pairs on the object are a\nsubset of those in the value passed. For example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" , \"owner\" : \"Bob\" }) <Dog: Rufus> >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) <Dog: Meg> >>> Dog . objects . create ( name = \"Fred\" , data = {}) <Dog: Fred> >>> Dog . objects . filter ( data__contained_by = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) <QuerySet [<Dog: Meg>, <Dog: Fred>]> >>> Dog . objects . filter ( data__contained_by = { \"breed\" : \"collie\" }) <QuerySet [<Dog: Fred>]> Oracle and SQLite contained_by is not supported on Oracle and SQLite. has_key ¶ Returns objects where the given key is in the top-level of the data. For\nexample: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" }) <Dog: Rufus> >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) <Dog: Meg> >>> Dog . objects . filter ( data__has_key = \"owner\" ) <QuerySet [<Dog: Meg>]> has_keys ¶ Returns objects where all of the given keys are in the top-level of the data.\nFor example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" }) <Dog: Rufus> >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) <Dog: Meg> >>> Dog . objects . filter ( data__has_keys = [ \"breed\" , \"owner\" ]) <QuerySet [<Dog: Meg>]> has_any_keys ¶ Returns objects where any of the given keys are in the top-level of the data.\nFor example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" }) <Dog: Rufus> >>> Dog . objects . create ( name = \"Meg\" , data = { \"owner\" : \"Bob\" }) <Dog: Meg> >>> Dog . objects . filter ( data__has_any_keys = [ \"owner\" , \"breed\" ]) <QuerySet [<Dog: Rufus>, <Dog: Meg>]> Complex lookups with Q objects ¶ Keyword argument queries – in filter() ,\netc. – are “AND”ed together. If you need to execute more complex queries (for\nexample, queries with OR statements), you can use Q objects . A Q object ( django.db.models.Q ) is an object\nused to encapsulate a collection of keyword arguments. These keyword arguments\nare specified as in “Field lookups” above. For example, this Q object encapsulates a single LIKE query: from django.db.models import Q Q ( question__startswith = \"What\" ) Q objects can be combined using the & , | , and ^ operators. When\nan operator is used on two Q objects, it yields a new Q object. For example, this statement yields a single Q object that represents the\n“OR” of two \"question__startswith\" queries: Q ( question__startswith = \"Who\" ) | Q ( question__startswith = \"What\" ) This is equivalent to the following SQL WHERE clause: WHERE question LIKE 'Who%' OR question LIKE 'What%' You can compose statements of arbitrary complexity by combining Q objects\nwith the & , | , and ^ operators and use parenthetical grouping.\nAlso, Q objects can be negated using the ~ operator, allowing for\ncombined lookups that combine both a normal query and a negated ( NOT )\nquery: Q ( question__startswith = \"Who\" ) | ~ Q ( pub_date__year = 2005 ) Each lookup function that takes keyword-arguments\n(e.g. filter() , exclude() , get() ) can also be passed one or more Q objects as positional (not-named) arguments. If you provide multiple Q object arguments to a lookup function, the arguments will be “AND”ed\ntogether. For example: Poll . objects . get ( Q ( question__startswith = \"Who\" ), Q ( pub_date = date ( 2005 , 5 , 2 )) | Q ( pub_date = date ( 2005 , 5 , 6 )), ) … roughly translates into the SQL: SELECT * from polls WHERE question LIKE 'Who%' AND ( pub_date = '2005-05-02' OR pub_date = '2005-05-06' ) Lookup functions can mix the use of Q objects and keyword arguments. All\narguments provided to a lookup function (be they keyword arguments or Q objects) are “AND”ed together. However, if a Q object is provided, it must\nprecede the definition of any keyword arguments. For example: Poll . objects . get ( Q ( pub_date = date ( 2005 , 5 , 2 )) | Q ( pub_date = date ( 2005 , 5 , 6 )), question__startswith = \"Who\" , ) … would be a valid query, equivalent to the previous example; but: # INVALID QUERY Poll . objects . get ( question__startswith = \"Who\" , Q ( pub_date = date ( 2005 , 5 , 2 )) | Q ( pub_date = date ( 2005 , 5 , 6 )), ) … would not be valid. See also The OR lookups examples in Django’s\nunit tests show some possible uses of Q . Comparing objects ¶ To compare two model instances, use the standard Python comparison operator,\nthe double equals sign: == . Behind the scenes, that compares the primary\nkey values of two models. Using the Entry example above, the following two statements are equivalent: >>> some_entry == other_entry >>> some_entry . id == other_entry . id If a model’s primary key isn’t called id , no problem. Comparisons will\nalways use the primary key, whatever it’s called. For example, if a model’s\nprimary key field is called name , these two statements are equivalent: >>> some_obj == other_obj >>> some_obj . name == other_obj . name Deleting objects ¶ The delete method, conveniently, is named delete() . This method immediately deletes the\nobject and returns the number of objects deleted and a dictionary with\nthe number of deletions per object type. Example: >>> e . delete () (1, {'blog.Entry': 1}) You can also delete objects in bulk. Every QuerySet has a delete() method, which deletes all\nmembers of that QuerySet . For example, this deletes all Entry objects with a pub_date year of\n2005: >>> Entry . objects . filter ( pub_date__year = 2005 ) . delete () (5, {'webapp.Entry': 5}) Keep in mind that this will, whenever possible, be executed purely in SQL, and\nso the delete() methods of individual object instances will not necessarily\nbe called during the process. If you’ve provided a custom delete() method\non a model class and want to ensure that it is called, you will need to\n“manually” delete instances of that model (e.g., by iterating over a QuerySet and calling delete() on each\nobject individually) rather than using the bulk delete() method of a QuerySet . When Django deletes an object, by default it emulates the behavior of the SQL\nconstraint ON DELETE CASCADE – in other words, any objects which had\nforeign keys pointing at the object to be deleted will be deleted along with\nit. For example: b = Blog . objects . get ( pk = 1 ) # This will delete the Blog and all of its Entry objects. b . delete () This cascade behavior is customizable via the on_delete argument to the ForeignKey . Note that delete() is the only QuerySet method that is not exposed on a Manager itself. This is a safety mechanism to\nprevent you from accidentally requesting Entry.objects.delete() , and\ndeleting all the entries. If you do want to delete all the objects, then\nyou have to explicitly request a complete query set: Entry . objects . all () . delete () Copying model instances ¶ Although there is no built-in method for copying model instances, it is\npossible to easily create new instance with all fields’ values copied. In the\nsimplest case, you can set pk to None and _state.adding to True . Using our\nblog example: blog = Blog ( name = \"My blog\" , tagline = \"Blogging is easy\" ) blog . save () # blog.pk == 1 blog . pk = None blog . _state . adding = True blog . save () # blog.pk == 2 Things get more complicated if you use inheritance. Consider a subclass of Blog : class ThemeBlog ( Blog ): theme = models . CharField ( max_length = 200 ) django_blog = ThemeBlog ( name = \"Django\" , tagline = \"Django is easy\" , theme = \"python\" ) django_blog . save () # django_blog.pk == 3 Due to how inheritance works, you have to set both pk and id to None , and _state.adding to True : django_blog . pk = None django_blog . id = None django_blog . _state . adding = True django_blog . save () # django_blog.pk == 4 This process doesn’t copy relations that aren’t part of the model’s database\ntable. For example, Entry has a ManyToManyField to Author . After\nduplicating an entry, you must set the many-to-many relations for the new\nentry: entry = Entry . objects . all ()[ 0 ] # some previous entry old_authors = entry . authors . all () entry . pk = None entry . _state . adding = True entry . save () entry . authors . set ( old_authors ) For a OneToOneField , you must duplicate the related object and assign it\nto the new object’s field to avoid violating the one-to-one unique constraint.\nFor example, assuming entry is already duplicated as above: detail = EntryDetail . objects . all ()[ 0 ] detail . pk = None detail . _state . adding = True detail . entry = entry detail . save () Updating multiple objects at once ¶ Sometimes you want to set a field to a particular value for all the objects in\na QuerySet . You can do this with the update() method. For example: # Update all the headlines with pub_date in 2007. Entry . objects . filter ( pub_date__year = 2007 ) . update ( headline = \"Everything is the same\" ) You can only set non-relation fields and ForeignKey fields using this method. To update a non-relation field, provide the new value\nas a constant. To update ForeignKey fields, set the\nnew value to be the new model instance you want to point to. For example: >>> b = Blog . objects . get ( pk = 1 ) # Change every Entry so that it belongs to this Blog. >>> Entry . objects . update ( blog = b ) The update() method is applied instantly and returns the number of rows\nmatched by the query (which may not be equal to the number of rows updated if\nsome rows already have the new value). The only restriction on the QuerySet being updated is that it can only\naccess one database table: the model’s main table. You can filter based on\nrelated fields, but you can only update columns in the model’s main\ntable. Example: >>> b = Blog . objects . get ( pk = 1 ) # Update all the headlines belonging to this Blog. >>> Entry . objects . filter ( blog = b ) . update ( headline = \"Everything is the same\" ) Be aware that the update() method is converted directly to an SQL\nstatement. It is a bulk operation for direct updates. It doesn’t run any save() methods on your models, or emit the pre_save or post_save signals (which are a consequence of calling save() ), or honor the auto_now field option.\nIf you want to save every item in a QuerySet and make sure that the save() method is called on\neach instance, you don’t need any special function to handle that. Loop over\nthem and call save() : for item in my_queryset : item . save () Calls to update can also use F expressions to\nupdate one field based on the value of another field in the model. This is\nespecially useful for incrementing counters based upon their current value. For\nexample, to increment the pingback count for every entry in the blog: >>> Entry . objects . update ( number_of_pingbacks = F ( \"number_of_pingbacks\" ) + 1 ) However, unlike F() objects in filter and exclude clauses, you can’t\nintroduce joins when you use F() objects in an update – you can only\nreference fields local to the model being updated. If you attempt to introduce\na join with an F() object, a FieldError will be raised: # This will raise a FieldError >>> Entry . objects . update ( headline = F ( \"blog__name\" )) Related objects ¶ When you define a relationship in a model (i.e., a ForeignKey , OneToOneField , or ManyToManyField ), instances of that model will have\na convenient API to access the related object(s). Using the models at the top of this page, for example, an Entry object e can get its associated Blog object by accessing the blog attribute: e.blog . (Behind the scenes, this functionality is implemented by Python descriptors . This shouldn’t really matter to\nyou, but we point it out here for the curious.) Django also creates API accessors for the “other” side of the relationship –\nthe link from the related model to the model that defines the relationship.\nFor example, a Blog object b has access to a list of all related Entry objects via the entry_set attribute: b.entry_set.all() . All examples in this section use the sample Blog , Author and Entry models defined at the top of this page. One-to-many relationships ¶ Forward ¶ If a model has a ForeignKey , instances of that model\nwill have access to the related (foreign) object via an attribute of the model. Example: >>> e = Entry . objects . get ( id = 2 ) >>> e . blog # Returns the related Blog object. You can get and set via a foreign-key attribute. As you may expect, changes to\nthe foreign key aren’t saved to the database until you call save() . Example: >>> e = Entry . objects . get ( id = 2 ) >>> e . blog = some_blog >>> e . save () If a ForeignKey field has null=True set (i.e.,\nit allows NULL values), you can assign None to remove the relation.\nExample: >>> e = Entry . objects . get ( id = 2 ) >>> e . blog = None >>> e . save () # \"UPDATE blog_entry SET blog_id = NULL ...;\" Forward access to one-to-many relationships is cached the first time the\nrelated object is accessed. Subsequent accesses to the foreign key on the same\nobject instance are cached. Example: >>> e = Entry . objects . get ( id = 2 ) >>> print ( e . blog ) # Hits the database to retrieve the associated Blog. >>> print ( e . blog ) # Doesn't hit the database; uses cached version. Note that the select_related() QuerySet method recursively prepopulates the\ncache of all one-to-many relationships ahead of time. Example: >>> e = Entry . objects . select_related () . get ( id = 2 ) >>> print ( e . blog ) # Doesn't hit the database; uses cached version. >>> print ( e . blog ) # Doesn't hit the database; uses cached version. Following relationships “backward” ¶ If a model has a ForeignKey , instances of the\nforeign-key model will have access to a Manager that\nreturns all instances of the first model. By default, this Manager is named FOO_set , where FOO is the\nsource model name, lowercased. This Manager returns QuerySets , which can be filtered and manipulated as described in the\n“Retrieving objects” section above. Example: >>> b = Blog . objects . get ( id = 1 ) >>> b . entry_set . all () # Returns all Entry objects related to Blog. # b.entry_set is a Manager that returns QuerySets. >>> b . entry_set . filter ( headline__contains = \"Lennon\" ) >>> b . entry_set . count () You can override the FOO_set name by setting the related_name parameter in the ForeignKey definition. For example, if the Entry model was altered to blog = ForeignKey(Blog, on_delete=models.CASCADE, related_name='entries') , the above example code would look like this: >>> b = Blog . objects . get ( id = 1 ) >>> b . entries . all () # Returns all Entry objects related to Blog. # b.entries is a Manager that returns QuerySets. >>> b . entries . filter ( headline__contains = \"Lennon\" ) >>> b . entries . count () Using a custom reverse manager ¶ By default the RelatedManager used\nfor reverse relations is a subclass of the default manager for that model. If you would like to specify a different manager for a given\nquery you can use the following syntax: from django.db import models class Entry ( models . Model ): # ... objects = models . Manager () # Default Manager entries = EntryManager () # Custom Manager b = Blog . objects . get ( id = 1 ) b . entry_set ( manager = \"entries\" ) . all () If EntryManager performed default filtering in its get_queryset() method, that filtering would apply to the all() call. Specifying a custom reverse manager also enables you to call its custom\nmethods: b . entry_set ( manager = \"entries\" ) . is_published () Interaction with prefetching When calling prefetch_related() with\na reverse relation, the default manager will be used. If you want to\nprefetch related objects using a custom reverse manager, use Prefetch() . For example: from django.db.models import Prefetch prefetch_manager = Prefetch ( \"entry_set\" , queryset = Entry . entries . all ()) Blog . objects . prefetch_related ( prefetch_manager ) Additional methods to handle related objects ¶ In addition to the QuerySet methods defined in\n“Retrieving objects” above, the ForeignKey Manager has additional methods used to handle the\nset of related objects. A synopsis of each is below, and complete details can\nbe found in the related objects reference . add(obj1, obj2, ...) Adds the specified model objects to the related object set. create(**kwargs) Creates a new object, saves it and puts it in the related object set.\nReturns the newly created object. remove(obj1, obj2, ...) Removes the specified model objects from the related object set. clear() Removes all objects from the related object set. set(objs) Replace the set of related objects. To assign the members of a related set, use the set() method with an\niterable of object instances. For example, if e1 and e2 are Entry instances: b = Blog . objects . get ( id = 1 ) b . entry_set . set ([ e1 , e2 ]) If the clear() method is available, any preexisting objects will be\nremoved from the entry_set before all objects in the iterable (in this\ncase, a list) are added to the set. If the clear() method is not available, all objects in the iterable will be added without removing any\nexisting elements. Each “reverse” operation described in this section has an immediate effect on\nthe database. Every addition, creation and deletion is immediately and\nautomatically saved to the database. Many-to-many relationships ¶ Both ends of a many-to-many relationship get automatic API access to the other\nend. The API works similar to a “backward” one-to-many relationship, above. One difference is in the attribute naming: The model that defines the ManyToManyField uses the attribute name of that\nfield itself, whereas the “reverse” model uses the lowercased model name of the\noriginal model, plus '_set' (just like reverse one-to-many relationships). An example makes this easier to understand: e = Entry . objects . get ( id = 3 ) e . authors . all () # Returns all Author objects for this Entry. e . authors . count () e . authors . filter ( name__contains = \"John\" ) a = Author . objects . get ( id = 5 ) a . entry_set . all () # Returns all Entry objects for this Author. Like ForeignKey , ManyToManyField can specify related_name . In the above example,\nif the ManyToManyField in Entry had specified related_name='entries' , then each Author instance would have an entries attribute instead of entry_set . Another difference from one-to-many relationships is that in addition to model\ninstances,  the add() , set() , and remove() methods on many-to-many\nrelationships accept primary key values. For example, if e1 and e2 are Entry instances, then these set() calls work identically: a = Author . objects . get ( id = 5 ) a . entry_set . set ([ e1 , e2 ]) a . entry_set . set ([ e1 . pk , e2 . pk ]) One-to-one relationships ¶ One-to-one relationships are very similar to many-to-one relationships. If you\ndefine a OneToOneField on your model, instances of\nthat model will have access to the related object via an attribute of the\nmodel. For example: class EntryDetail ( models . Model ): entry = models . OneToOneField ( Entry , on_delete = models . CASCADE ) details = models . TextField () ed = EntryDetail . objects . get ( id = 2 ) ed . entry # Returns the related Entry object. The difference comes in “reverse” queries. The related model in a one-to-one\nrelationship also has access to a Manager object, but\nthat Manager represents a single object, rather than\na collection of objects: e = Entry . objects . get ( id = 2 ) e . entrydetail # returns the related EntryDetail object If no object has been assigned to this relationship, Django will raise\na DoesNotExist exception. Instances can be assigned to the reverse relationship in the same way as\nyou would assign the forward relationship: e . entrydetail = ed How are the backward relationships possible? ¶ Other object-relational mappers require you to define relationships on both\nsides. The Django developers believe this is a violation of the DRY (Don’t\nRepeat Yourself) principle, so Django only requires you to define the\nrelationship on one end. But how is this possible, given that a model class doesn’t know which other\nmodel classes are related to it until those other model classes are loaded? The answer lies in the app registry . When Django\nstarts, it imports each application listed in INSTALLED_APPS , and\nthen the models module inside each application. Whenever a new model class\nis created, Django adds backward-relationships to any related models. If the\nrelated models haven’t been imported yet, Django keeps tracks of the\nrelationships and adds them when the related models eventually are imported. For this reason, it’s particularly important that all the models you’re using\nbe defined in applications listed in INSTALLED_APPS . Otherwise,\nbackwards relations may not work properly. Queries over related objects ¶ Queries involving related objects follow the same rules as queries involving\nnormal value fields. When specifying the value for a query to match, you may\nuse either an object instance itself, or the primary key value for the object. For example, if you have a Blog object b with id=5 , the following\nthree queries would be identical: Entry . objects . filter ( blog = b ) # Query using object instance Entry . objects . filter ( blog = b . id ) # Query using id from instance Entry . objects . filter ( blog = 5 ) # Query using id directly Falling back to raw SQL ¶ If you find yourself needing to write an SQL query that is too complex for\nDjango’s database-mapper to handle, you can fall back on writing SQL by hand.\nDjango has a couple of options for writing raw SQL queries; see Performing raw SQL queries . Finally, it’s important to note that the Django database layer is merely an\ninterface to your database. You can access your database via other tools,\nprogramming languages or database frameworks; there’s nothing Django-specific\nabout your database.", "keywords": ["users", "has_key", "deleting", "get_queryset", "rows", "act", "who%", "integerfield", "underscores", "pattern", "apso", "emailfield", "relational", "b", "activity", "preexisting", "hip", "field", "#", "outerref", "fielderror", "relation", "record", "data__contains", "yourself", "fishy", "paperback", "division", "loop", "q1", "lte", "forward", "create(**kwargs", "regex", "blog_entry", "representation", "transforms", "lines", "match", "django.db.models", "programming", "subset", "backward", "cache", "datefield", "contained_by", "pk__gt", "archie", "data__has_keys", "words", "change", "pk__in", "\\%%", "^", "number_of_pingbacks", "=", "changes", "tracks", "blog_id", "results", "min", "relationship", "subquery", "fact", "somefield", "copying", "character", "entry__authors__isnull", "e1", "like", "sets", "process", "evaluations", "iexact", "wrapping", "collection", "john", "django.db.models.fields.json", "following", "type", "filter(**kwargs", "ringo", "talk", "variant", "await", "kwargs", "storing", "objects", "documentation", "invalid", "lookups", "custom", "prefetch", "mind", "file", "headline__contains", "synopsis", "constraint", "work", "collie", "exclusion", "hop", "user", "subtraction", "mistakes", "lennon", "name__contains", "sides", "attribute", "mechanism", "scenes", "number_of_comments__gt", "developers", "name__iexact", "time", "endswith", "doesnotexist", "save", "date", "relatedmanager", "operators", "bitand", "polls", "entry__pub_date__year", "transform", "things", "auto_now", "name", "signs", "mod_date__year", "multipleobjectsreturned", "parameter", "one_entry", "execution", "escaping", "backends", "reference", "january", "entry__in", "versions", "quoting", "queries", "entry.objects.all()[-1", "meat", "slice", "manager", "uses", "clear", "return", "reverse", "deletion", "operator", "applications", "data__owner__name", "tutorial", "expressions", "foo", "situation", "value(none", "search", "blog__pk", "textfield", "counters", "[:", "blog", "lhasa", "question", "examples", "top_rating", "cheese_blog", "username", "relationships", "comprehension", "bool", "join", "nature", "error", "conditions", "code", "bulk", "safety", "filter", "behavior", "array", "i", "class", "access", "clause", "grouping", "link", "returns", "names", "'", "retrieve", "paul", "x", "database", "*", "query", "page", "test", "postgresql", "count", "types", "owner_name", "strings", "elements", "subclass", "adelete", "creation", ".", "registry", "limit", "step", "e.blog", "max_length", "istartswith", "data__has_any_keys", "field__lookuptype", ".bitrightshift", "create", "synchronousonlyoperation", "afilter", "mappers", "e", "section", "source", "pop", "my_queryset", "underscore", "evaluation", "aget", "use", "data__breed", "environment", "sum", "author", "a", "blogs", "criteria", "mod_date__gt", "operation", "order", "indexerror", "default", "blog.models", "containment", "albums", "comment", "form", "signals", "prefix", "fred", "option", "format", "b.entries", "classes", "expression", "characters", "tests", "percent", "day", "question__startswith", "other_pets", "data__contained_by", "entry__headline__contains", "annotate", "convenience", "entrydetail", "f", "starts", "dozen", ".bitand", ".bitor", "pingback", "entry_set", "existence", "percentage", "foreignkey(blog", "onetoonefield", "traceback", "interaction", "way", "gte", "taste", "print(q", "surface", "biography", "comments", "index", "possibility", "notation", "queryset", "integer", "has_any_keys", "repeat", "¶", "news", "parameters", "blog__name", "headline", "rufus", "side", "blogging", "labrador", "number_of_comments", "span", "function", "views", "result", "pre_save", "select_related", "number", "rating__lt", "jsonfield", "foo_set", "relations", "values", "first_breed__startswith", "string", "_", "order_by", "kt", "related_name='entries", "split", "defer", "b.entry_set.all", "managers", "unit", "event", "hand", "exclude", "table", "models", "querysets", "some_entry", "version", "ways", "level", "json", "b.entry_set", "owner", "q2", "condition", "prefetching", "refinement", "django", "n’t", "gt", "fields", "print", "joe", "entry", "languages", "set", "lowercase", "power", "p", "icontains", "value", "deletions", "rating", "line", "or", "data__breed__1", "columns", "data", "implementation", "wildcard", "item", "violation", "datetime", "base", "guide", "layer", "pub_date__year", "clashes", "add", "authors__name", "iterable", "entry.objects.delete", "updates", "shortcut", "self", "instance", "mod_date", "typeerror", "members", "xor", "pub_date", "today", "q3", "theme", "constants", "consequence", "interface", "beatles", "constant", "blog__id__exact", "|", "functionality", "front", "timedelta", "related_name", "joins", "other_entry", "instances", "statement", "part", "chains", "references", "object", "load", "couple", "dog", "entry__authors__name__isnull", "remove(obj1", "themeblog", "charfield", "manytomanyfield", "sql", "dictionary", "requests", "authors", "terms", "pairs", "headlines", "total_comments", "keyword", "pub_date__lte", "ed", "s", ".bitxor", "accessors", "naming", "ordering", "old_authors", "max", "force", "matches", "spanning", "top", "rules", "george", "notes", "cheddar", "best", "effect", "detail", "system", "inheritance", "clauses", "meg", "filtering", "async", "obj2", "second", "items", "distinction", "comparisons", "bob", "tagline", "definition", "difference", "other_obj", "sync_to_async", "addition", "food", "example", "care", "pingbacks", "lists", "app", "entry__authors__name", "e2", "data__isnull", "webapp", "list", "sample", "orm", "answer", "first_breed", "poll", "headline__exact", "email", "inverse", "all_entries", "dogs", "model", "lennon%", "bites", "year", "sections", "apis", "place", "descriptors", "element", "application", "dry", "pub_date__gte", "actions", "attributes", "isnull", "ability", "syntax", "blog__id", "restriction", "select", "brand", "ones", "works", "keys", "startswith", "case", "attributeerror", "equivalent", "principle", "lookup", "null", "indexing", "runtime", "iendswith", "look", "errors", "future", "str", "modulo", "arguments", "lt", "separation", "mapper", "end", "entries", "records", "sqlite", "comparison", "delete", "bar", "kind", "object(s", "path", "duplicates", "iregex", "functions", "key", "abstraction", "operations", "music", "term", "update", "bitwise", "none", "breed", "filters", "problem", "and”ed", "sign", "mariadb", "get", "arithmetic", "definitions", "reason", "q", "shep", "new", "true", "dict", "caching", "entrymanager", "api", "blog.objects.all", "support", "headline__startswith", "complexity", "document", "transactions", "refinements", "my_input", "transformations", "multiplication", "cat", "offset", "data__has_key", "import", "cascade", "d", "iteration", "statements", "%", ">", "some_blog", "call", "b5", "pk", "foreignkey", "information", "python", "methods", "options", "exception", "details", "method", "django.db", "transaction", "argument", "days", "note", "state", "oracle", "tools", "coroutine", "text"], "type": "documentation"},
{"title": "Models | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/db/models/", "content": "Models ¶ A model is the single, definitive source of information about your data. It\ncontains the essential fields and behaviors of the data you’re storing.\nGenerally, each model maps to a single database table. The basics: Each model is a Python class that subclasses django.db.models.Model . Each attribute of the model represents a database field. With all of this, Django gives you an automatically-generated\ndatabase-access API; see Making queries . Quick example ¶ This example model defines a Person , which has a first_name and last_name : from django.db import models class Person ( models . Model ): first_name = models . CharField ( max_length = 30 ) last_name = models . CharField ( max_length = 30 ) first_name and last_name are fields of the model. Each field is\nspecified as a class attribute, and each attribute maps to a database column. The above Person model would create a database table like this: CREATE TABLE myapp_person ( \"id\" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY , \"first_name\" varchar ( 30 ) NOT NULL , \"last_name\" varchar ( 30 ) NOT NULL ); Some technical notes: The name of the table, myapp_person , is automatically derived from\nsome model metadata but can be overridden. See Table names for more\ndetails. An id field is added automatically, but this behavior can be\noverridden. See Automatic primary key fields . The CREATE TABLE SQL in this example is formatted using PostgreSQL\nsyntax, but it’s worth noting Django uses SQL tailored to the database\nbackend specified in your settings file . Using models ¶ Once you have defined your models, you need to tell Django you’re going to use those models. Do this by editing your settings file and changing the INSTALLED_APPS setting to add the name of the module that contains\nyour models.py . For example, if the models for your application live in the module myapp.models (the package structure that is created for an\napplication by the manage.py startapp script), INSTALLED_APPS should read, in part: INSTALLED_APPS = [ # ... \"myapp\" , # ... ] When you add new apps to INSTALLED_APPS , be sure to run manage.py migrate , optionally making migrations\nfor them first with manage.py makemigrations . Fields ¶ The most important part of a model – and the only required part of a model –\nis the list of database fields it defines. Fields are specified by class\nattributes. Be careful not to choose field names that conflict with the models API like clean , save , or delete . Example: from django.db import models class Musician ( models . Model ): first_name = models . CharField ( max_length = 50 ) last_name = models . CharField ( max_length = 50 ) instrument = models . CharField ( max_length = 100 ) class Album ( models . Model ): artist = models . ForeignKey ( Musician , on_delete = models . CASCADE ) name = models . CharField ( max_length = 100 ) release_date = models . DateField () num_stars = models . IntegerField () Field types ¶ Each field in your model should be an instance of the appropriate Field class. Django uses the field class types to\ndetermine a few things: The column type, which tells the database what kind of data to store (e.g. INTEGER , VARCHAR , TEXT ). The default HTML widget to use when rendering a form\nfield (e.g. <input type=\"text\"> , <select> ). The minimal validation requirements, used in Django’s admin and in\nautomatically-generated forms. Django ships with dozens of built-in field types; you can find the complete list\nin the model field reference . You can easily write\nyour own fields if Django’s built-in ones don’t do the trick; see How to create custom model fields . Field options ¶ Each field takes a certain set of field-specific arguments (documented in the model field reference ). For example, CharField (and its subclasses) require a max_length argument which specifies the size\nof the VARCHAR database field used to store the data. There’s also a set of common arguments available to all field types. All are\noptional. They’re fully explained in the reference , but here’s a quick summary of the most often-used\nones: null If True , Django will store empty values as NULL in the database.\nDefault is False . blank If True , the field is allowed to be blank. Default is False . Note that this is different than null . null is purely database-related, whereas blank is validation-related. If a field has blank=True , form validation will\nallow entry of an empty value. If a field has blank=False , the field will be required. choices A sequence of 2-value tuples, a mapping , an enumeration type , or a callable (that\nexpects no arguments and returns any of the previous formats), to use as\nchoices for this field. If this is given, the default form widget will be a\nselect box instead of the standard text field and will limit choices to the\nchoices given. A choices list looks like this: YEAR_IN_SCHOOL_CHOICES = [ ( \"FR\" , \"Freshman\" ), ( \"SO\" , \"Sophomore\" ), ( \"JR\" , \"Junior\" ), ( \"SR\" , \"Senior\" ), ( \"GR\" , \"Graduate\" ), ] Note A new migration is created each time the order of choices changes. The first element in each tuple is the value that will be stored in the\ndatabase. The second element is displayed by the field’s form widget. Given a model instance, the display value for a field with choices can\nbe accessed using the get_FOO_display() method. For example: from django.db import models class Person ( models . Model ): SHIRT_SIZES = { \"S\" : \"Small\" , \"M\" : \"Medium\" , \"L\" : \"Large\" , } name = models . CharField ( max_length = 60 ) shirt_size = models . CharField ( max_length = 1 , choices = SHIRT_SIZES ) >>> p = Person ( name = \"Fred Flintstone\" , shirt_size = \"L\" ) >>> p . save () >>> p . shirt_size 'L' >>> p . get_shirt_size_display () 'Large' You can also use enumeration classes to define choices in a concise\nway: from django.db import models class Runner ( models . Model ): MedalType = models . TextChoices ( \"MedalType\" , \"GOLD SILVER BRONZE\" ) name = models . CharField ( max_length = 60 ) medal = models . CharField ( blank = True , choices = MedalType , max_length = 10 ) Further examples are available in the model field reference . Changed in Django 5.0: Support for mappings and callables was added. default The default value for the field. This can be a value or a callable\nobject. If callable it will be called every time a new object is\ncreated. db_default The database-computed default value for the field. This can be a literal\nvalue or a database function. If both db_default and Field.default are set, default will\ntake precedence when creating instances in Python code. db_default will\nstill be set at the database level and will be used when inserting rows\noutside of the ORM or when adding a new field in a migration. help_text Extra “help” text to be displayed with the form widget. It’s useful for\ndocumentation even if your field isn’t used on a form. primary_key If True , this field is the primary key for the model. If you don’t specify primary_key=True for\nany fields in your model, Django will automatically add an IntegerField to hold the primary key, so you don’t need to set primary_key=True on any of your fields\nunless you want to override the default primary-key behavior. For more,\nsee Automatic primary key fields . The primary key field is read-only. If you change the value of the primary\nkey on an existing object and then save it, a new object will be created\nalongside the old one. For example: from django.db import models class Fruit ( models . Model ): name = models . CharField ( max_length = 100 , primary_key = True ) >>> fruit = Fruit . objects . create ( name = \"Apple\" ) >>> fruit . name = \"Pear\" >>> fruit . save () >>> Fruit . objects . values_list ( \"name\" , flat = True ) <QuerySet ['Apple', 'Pear']> unique If True , this field must be unique throughout the table. Again, these are just short descriptions of the most common field options. Full\ndetails can be found in the common model field option reference . Automatic primary key fields ¶ By default, Django gives each model an auto-incrementing primary key with the\ntype specified per app in AppConfig.default_auto_field or globally in the DEFAULT_AUTO_FIELD setting. For example: id = models . BigAutoField ( primary_key = True ) If you’d like to specify a custom primary key, specify primary_key=True on one of your fields. If Django\nsees you’ve explicitly set Field.primary_key , it won’t add the automatic id column. Each model requires exactly one field to have primary_key=True (either explicitly declared or automatically added). Verbose field names ¶ Each field type, except for ForeignKey , ManyToManyField and OneToOneField , takes an optional first positional\nargument – a verbose name. If the verbose name isn’t given, Django will\nautomatically create it using the field’s attribute name, converting underscores\nto spaces. In this example, the verbose name is \"person's first name\" : first_name = models . CharField ( \"person's first name\" , max_length = 30 ) In this example, the verbose name is \"first name\" : first_name = models . CharField ( max_length = 30 ) ForeignKey , ManyToManyField and OneToOneField require the first argument to be a\nmodel class, so use the verbose_name keyword argument: poll = models . ForeignKey ( Poll , on_delete = models . CASCADE , verbose_name = \"the related poll\" , ) sites = models . ManyToManyField ( Site , verbose_name = \"list of sites\" ) place = models . OneToOneField ( Place , on_delete = models . CASCADE , verbose_name = \"related place\" , ) The convention is not to capitalize the first letter of the verbose_name . Django will automatically capitalize the first\nletter where it needs to. Relationships ¶ Clearly, the power of relational databases lies in relating tables to each\nother. Django offers ways to define the three most common types of database\nrelationships: many-to-one, many-to-many and one-to-one. Many-to-one relationships ¶ To define a many-to-one relationship, use django.db.models.ForeignKey .\nYou use it just like any other Field type: by\nincluding it as a class attribute of your model. ForeignKey requires a positional argument: the class\nto which the model is related. For example, if a Car model has a Manufacturer – that is, a Manufacturer makes multiple cars but each Car only has one Manufacturer – use the following definitions: from django.db import models class Manufacturer ( models . Model ): # ... pass class Car ( models . Model ): manufacturer = models . ForeignKey ( Manufacturer , on_delete = models . CASCADE ) # ... You can also create recursive relationships (an\nobject with a many-to-one relationship to itself) and relationships to\nmodels not yet defined ; see the model field\nreference for details. It’s suggested, but not required, that the name of a ForeignKey field ( manufacturer in the example\nabove) be the name of the model, lowercase. You can call the field whatever you\nwant. For example: class Car ( models . Model ): company_that_makes_it = models . ForeignKey ( Manufacturer , on_delete = models . CASCADE , ) # ... See also ForeignKey fields accept a number of extra\narguments which are explained in the model field reference . These options help define how the relationship\nshould work; all are optional. For details on accessing backwards-related objects, see the Following relationships backward example . For sample code, see the Many-to-one relationship model example . Many-to-many relationships ¶ To define a many-to-many relationship, use ManyToManyField . You use it just like any other Field type: by including it as a class attribute of\nyour model. ManyToManyField requires a positional argument: the\nclass to which the model is related. For example, if a Pizza has multiple Topping objects – that is, a Topping can be on multiple pizzas and each Pizza has multiple toppings\n– here’s how you’d represent that: from django.db import models class Topping ( models . Model ): # ... pass class Pizza ( models . Model ): # ... toppings = models . ManyToManyField ( Topping ) As with ForeignKey , you can also create recursive relationships (an object with a\nmany-to-many relationship to itself) and relationships to models not yet\ndefined . It’s suggested, but not required, that the name of a ManyToManyField ( toppings in the example above)\nbe a plural describing the set of related model objects. It doesn’t matter which model has the ManyToManyField , but you should only put it in one\nof the models – not both. Generally, ManyToManyField instances should go in\nthe object that’s going to be edited on a form. In the above example, toppings is in Pizza (rather than Topping having a pizzas ManyToManyField ) because it’s more natural to think\nabout a pizza having toppings than a topping being on multiple pizzas. The way\nit’s set up above, the Pizza form would let users select the toppings. See also See the Many-to-many relationship model example for a full example. ManyToManyField fields also accept a number of\nextra arguments which are explained in the model field reference . These options help define how the relationship\nshould work; all are optional. Extra fields on many-to-many relationships ¶ When you’re only dealing with many-to-many relationships such as mixing and\nmatching pizzas and toppings, a standard ManyToManyField is all you need. However, sometimes\nyou may need to associate data with the relationship between two models. For example, consider the case of an application tracking the musical groups\nwhich musicians belong to. There is a many-to-many relationship between a person\nand the groups of which they are a member, so you could use a ManyToManyField to represent this relationship.\nHowever, there is a lot of detail about the membership that you might want to\ncollect, such as the date at which the person joined the group. For these situations, Django allows you to specify the model that will be used\nto govern the many-to-many relationship. You can then put extra fields on the\nintermediate model. The intermediate model is associated with the ManyToManyField using the through argument to point to the model\nthat will act as an intermediary. For our musician example, the code would look\nsomething like this: from django.db import models class Person ( models . Model ): name = models . CharField ( max_length = 128 ) def __str__ ( self ): return self . name class Group ( models . Model ): name = models . CharField ( max_length = 128 ) members = models . ManyToManyField ( Person , through = \"Membership\" ) def __str__ ( self ): return self . name class Membership ( models . Model ): person = models . ForeignKey ( Person , on_delete = models . CASCADE ) group = models . ForeignKey ( Group , on_delete = models . CASCADE ) date_joined = models . DateField () invite_reason = models . CharField ( max_length = 64 ) When you set up the intermediary model, you explicitly specify foreign\nkeys to the models that are involved in the many-to-many relationship. This\nexplicit declaration defines how the two models are related. There are a few restrictions on the intermediate model: Your intermediate model must contain one - and only one - foreign key\nto the source model (this would be Group in our example), or you must\nexplicitly specify the foreign keys Django should use for the relationship\nusing ManyToManyField.through_fields .\nIf you have more than one foreign key and through_fields is not\nspecified, a validation error will be raised. A similar restriction applies\nto the foreign key to the target model (this would be Person in our\nexample). For a model which has a many-to-many relationship to itself through an\nintermediary model, two foreign keys to the same model are permitted, but\nthey will be treated as the two (different) sides of the many-to-many\nrelationship. If there are more than two foreign keys though, you\nmust also specify through_fields as above, or a validation error\nwill be raised. Now that you have set up your ManyToManyField to use\nyour intermediary model ( Membership , in this case), you’re ready to start\ncreating some many-to-many relationships. You do this by creating instances of\nthe intermediate model: >>> ringo = Person . objects . create ( name = \"Ringo Starr\" ) >>> paul = Person . objects . create ( name = \"Paul McCartney\" ) >>> beatles = Group . objects . create ( name = \"The Beatles\" ) >>> m1 = Membership ( ... person = ringo , ... group = beatles , ... date_joined = date ( 1962 , 8 , 16 ), ... invite_reason = \"Needed a new drummer.\" , ... ) >>> m1 . save () >>> beatles . members . all () <QuerySet [<Person: Ringo Starr>]> >>> ringo . group_set . all () <QuerySet [<Group: The Beatles>]> >>> m2 = Membership . objects . create ( ... person = paul , ... group = beatles , ... date_joined = date ( 1960 , 8 , 1 ), ... invite_reason = \"Wanted to form a band.\" , ... ) >>> beatles . members . all () <QuerySet [<Person: Ringo Starr>, <Person: Paul McCartney>]> You can also use add() , create() , or set() to create\nrelationships, as long as you specify through_defaults for any required\nfields: >>> beatles . members . add ( john , through_defaults = { \"date_joined\" : date ( 1960 , 8 , 1 )}) >>> beatles . members . create ( ... name = \"George Harrison\" , through_defaults = { \"date_joined\" : date ( 1960 , 8 , 1 )} ... ) >>> beatles . members . set ( ... [ john , paul , ringo , george ], through_defaults = { \"date_joined\" : date ( 1960 , 8 , 1 )} ... ) You may prefer to create instances of the intermediate model directly. If the custom through table defined by the intermediate model does not enforce\nuniqueness on the (model1, model2) pair, allowing multiple values, the remove() call will\nremove all intermediate model instances: >>> Membership . objects . create ( ... person = ringo , ... group = beatles , ... date_joined = date ( 1968 , 9 , 4 ), ... invite_reason = \"You've been gone for a month and we miss you.\" , ... ) >>> beatles . members . all () <QuerySet [<Person: Ringo Starr>, <Person: Paul McCartney>, <Person: Ringo Starr>]> >>> # This deletes both of the intermediate model instances for Ringo Starr >>> beatles . members . remove ( ringo ) >>> beatles . members . all () <QuerySet [<Person: Paul McCartney>]> The clear() method can be used to remove all many-to-many relationships for an instance: >>> # Beatles have broken up >>> beatles . members . clear () >>> # Note that this deletes the intermediate model instances >>> Membership . objects . all () <QuerySet []> Once you have established the many-to-many relationships, you can issue\nqueries. Just as with normal many-to-many relationships, you can query using\nthe attributes of the many-to-many-related model: # Find all the groups with a member whose name starts with 'Paul' >>> Group . objects . filter ( members__name__startswith = \"Paul\" ) <QuerySet [<Group: The Beatles>]> As you are using an intermediate model, you can also query on its attributes: # Find all the members of the Beatles that joined after 1 Jan 1961 >>> Person . objects . filter ( ... group__name = \"The Beatles\" , membership__date_joined__gt = date ( 1961 , 1 , 1 ) ... ) <QuerySet [<Person: Ringo Starr]> If you need to access a membership’s information you may do so by directly\nquerying the Membership model: >>> ringos_membership = Membership . objects . get ( group = beatles , person = ringo ) >>> ringos_membership . date_joined datetime.date(1962, 8, 16) >>> ringos_membership . invite_reason 'Needed a new drummer.' Another way to access the same information is by querying the many-to-many reverse relationship from a Person object: >>> ringos_membership = ringo . membership_set . get ( group = beatles ) >>> ringos_membership . date_joined datetime.date(1962, 8, 16) >>> ringos_membership . invite_reason 'Needed a new drummer.' One-to-one relationships ¶ To define a one-to-one relationship, use OneToOneField . You use it just like any other Field type: by including it as a class attribute of your model. This is most useful on the primary key of an object when that object “extends”\nanother object in some way. OneToOneField requires a positional argument: the\nclass to which the model is related. For example, if you were building a database of “places”, you would\nbuild pretty standard stuff such as address, phone number, etc. in the\ndatabase. Then, if you wanted to build a database of restaurants on\ntop of the places, instead of repeating yourself and replicating those\nfields in the Restaurant model, you could make Restaurant have\na OneToOneField to Place (because a\nrestaurant “is a” place; in fact, to handle this you’d typically use inheritance , which involves an implicit\none-to-one relation). As with ForeignKey , a recursive relationship can be defined and references to as-yet\nundefined models can be made. See also See the One-to-one relationship model example for a full example. OneToOneField fields also accept an optional parent_link argument. OneToOneField classes used to automatically become\nthe primary key on a model. This is no longer true (although you can manually\npass in the primary_key argument if you like).\nThus, it’s now possible to have multiple fields of type OneToOneField on a single model. Models across files ¶ It’s perfectly OK to relate a model to one from another app. To do this, import\nthe related model at the top of the file where your model is defined. Then,\nrefer to the other model class wherever needed. For example: from django.db import models from geography.models import ZipCode class Restaurant ( models . Model ): # ... zip_code = models . ForeignKey ( ZipCode , on_delete = models . SET_NULL , blank = True , null = True , ) Field name restrictions ¶ Django places some restrictions on model field names: A field name cannot be a Python reserved word, because that would result\nin a Python syntax error. For example: class Example(models.Model):\n    pass = models.IntegerField() # 'pass' is a reserved word! A field name cannot contain more than one underscore in a row, due to\nthe way Django’s query lookup syntax works. For example: class Example ( models . Model ): foo__bar = models . IntegerField () # 'foo__bar' has two underscores! A field name cannot end with an underscore, for similar reasons. These limitations can be worked around, though, because your field name doesn’t\nnecessarily have to match your database column name. See the db_column option. SQL reserved words, such as join , where or select , are allowed as\nmodel field names, because Django escapes all database table names and column\nnames in every underlying SQL query. It uses the quoting syntax of your\nparticular database engine. Custom field types ¶ If one of the existing model fields cannot be used to fit your purposes, or if\nyou wish to take advantage of some less common database column types, you can\ncreate your own field class. Full coverage of creating your own fields is\nprovided in How to create custom model fields . Meta options ¶ Give your model metadata by using an inner class Meta , like so: from django.db import models class Ox ( models . Model ): horn_length = models . IntegerField () class Meta : ordering = [ \"horn_length\" ] verbose_name_plural = \"oxen\" Model metadata is “anything that’s not a field”, such as ordering options\n( ordering ), database table name ( db_table ), or\nhuman-readable singular and plural names ( verbose_name and verbose_name_plural ). None are required, and adding class Meta to a model is completely optional. A complete list of all possible Meta options can be found in the model\noption reference . Model attributes ¶ objects The most important attribute of a model is the Manager . It’s the interface through which\ndatabase query operations are provided to Django models and is used to retrieve the instances from the database. If no\ncustom Manager is defined, the default name is objects . Managers are only accessible via\nmodel classes, not the model instances. Model methods ¶ Define custom methods on a model to add custom “row-level” functionality to your\nobjects. Whereas Manager methods are intended to do\n“table-wide” things, model methods should act on a particular model instance. This is a valuable technique for keeping business logic in one place – the\nmodel. For example, this model has a few custom methods: from django.db import models class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) last_name = models . CharField ( max_length = 50 ) birth_date = models . DateField () def baby_boomer_status ( self ): \"Returns the person's baby-boomer status.\" import datetime if self . birth_date < datetime . date ( 1945 , 8 , 1 ): return \"Pre-boomer\" elif self . birth_date < datetime . date ( 1965 , 1 , 1 ): return \"Baby boomer\" else : return \"Post-boomer\" @property def full_name ( self ): \"Returns the person's full name.\" return f \" { self . first_name } { self . last_name } \" The last method in this example is a property . The model instance reference has a complete list\nof methods automatically given to each model .\nYou can override most of these – see overriding predefined model methods ,\nbelow – but there are a couple that you’ll almost always want to define: __str__() A Python “magic method” that returns a string representation of any\nobject. This is what Python and Django will use whenever a model\ninstance needs to be coerced and displayed as a plain string. Most\nnotably, this happens when you display an object in an interactive\nconsole or in the admin. You’ll always want to define this method; the default isn’t very helpful\nat all. get_absolute_url() This tells Django how to calculate the URL for an object. Django uses\nthis in its admin interface, and any time it needs to figure out a URL\nfor an object. Any object that has a URL that uniquely identifies it should define this\nmethod. Overriding predefined model methods ¶ There’s another set of model methods that\nencapsulate a bunch of database behavior that you’ll want to customize. In\nparticular you’ll often want to change the way save() and delete() work. You’re free to override these methods (and any other model method) to alter\nbehavior. A classic use-case for overriding the built-in methods is if you want something\nto happen whenever you save an object. For example (see save() for documentation of the parameters it accepts): from django.db import models class Blog ( models . Model ): name = models . CharField ( max_length = 100 ) tagline = models . TextField () def save ( self , ** kwargs ): do_something () super () . save ( ** kwargs ) # Call the \"real\" save() method. do_something_else () You can also prevent saving: from django.db import models class Blog ( models . Model ): name = models . CharField ( max_length = 100 ) tagline = models . TextField () def save ( self , ** kwargs ): if self . name == \"Yoko Ono's blog\" : return # Yoko shall never have her own blog! else : super () . save ( ** kwargs ) # Call the \"real\" save() method. It’s important to remember to call the superclass method – that’s\nthat super().save(**kwargs) business – to ensure that the object still\ngets saved into the database. If you forget to call the superclass method, the\ndefault behavior won’t happen and the database won’t get touched. It’s also important that you pass through the arguments that can be\npassed to the model method – that’s what the **kwargs bit does. Django\nwill, from time to time, extend the capabilities of built-in model methods,\nadding new keyword arguments. If you use **kwargs in your method\ndefinitions, you are guaranteed that your code will automatically support those\narguments when they are added. If you wish to update a field value in the save() method, you may\nalso want to have this field added to the update_fields keyword argument.\nThis will ensure the field is saved when update_fields is specified. For\nexample: from django.db import models from django.utils.text import slugify class Blog ( models . Model ): name = models . CharField ( max_length = 100 ) slug = models . TextField () def save ( self , ** kwargs ): self . slug = slugify ( self . name ) if ( update_fields := kwargs . get ( \"update_fields\" ) ) is not None and \"name\" in update_fields : kwargs [ \"update_fields\" ] = { \"slug\" } . union ( update_fields ) super () . save ( ** kwargs ) See Specifying which fields to save for more details. Overridden model methods are not called on bulk operations Note that the delete() method for an object is not\nnecessarily called when deleting objects in bulk using a\nQuerySet or as a result of a cascading delete . To ensure customized\ndelete logic gets executed, you can use pre_delete and/or post_delete signals. Unfortunately, there isn’t a workaround when creating or updating objects in bulk,\nsince none of save() , pre_save , and post_save are called. Executing custom SQL ¶ Another common pattern is writing custom SQL statements in model methods and\nmodule-level methods. For more details on using raw SQL, see the documentation\non using raw SQL . Model inheritance ¶ Model inheritance in Django works almost identically to the way normal\nclass inheritance works in Python, but the basics at the beginning of the page\nshould still be followed. That means the base class should subclass django.db.models.Model . The only decision you have to make is whether you want the parent models to be\nmodels in their own right (with their own database tables), or if the parents\nare just holders of common information that will only be visible through the\nchild models. There are three styles of inheritance that are possible in Django. Often, you will just want to use the parent class to hold information that\nyou don’t want to have to type out for each child model. This class isn’t\ngoing to ever be used in isolation, so Abstract base classes are\nwhat you’re after. If you’re subclassing an existing model (perhaps something from another\napplication entirely) and want each model to have its own database table, Multi-table inheritance is the way to go. Finally, if you only want to modify the Python-level behavior of a model,\nwithout changing the models fields in any way, you can use Proxy models . Abstract base classes ¶ Abstract base classes are useful when you want to put some common\ninformation into a number of other models. You write your base class\nand put abstract=True in the Meta class. This model will then not be used to create any database\ntable. Instead, when it is used as a base class for other models, its\nfields will be added to those of the child class. An example: from django.db import models class CommonInfo ( models . Model ): name = models . CharField ( max_length = 100 ) age = models . PositiveIntegerField () class Meta : abstract = True class Student ( CommonInfo ): home_group = models . CharField ( max_length = 5 ) The Student model will have three fields: name , age and home_group . The CommonInfo model cannot be used as a normal Django\nmodel, since it is an abstract base class. It does not generate a database\ntable or have a manager, and cannot be instantiated or saved directly. Fields inherited from abstract base classes can be overridden with another\nfield or value, or be removed with None . For many uses, this type of model inheritance will be exactly what you want.\nIt provides a way to factor out common information at the Python level, while\nstill only creating one database table per child model at the database level. Meta inheritance ¶ When an abstract base class is created, Django makes any Meta inner class you declared in the base class available as an\nattribute. If a child class does not declare its own Meta class, it will inherit the parent’s Meta . If the child wants to\nextend the parent’s Meta class, it can subclass it. For example: from django.db import models class CommonInfo ( models . Model ): # ... class Meta : abstract = True ordering = [ \"name\" ] class Student ( CommonInfo ): # ... class Meta ( CommonInfo . Meta ): db_table = \"student_info\" Django does make one adjustment to the Meta class of an\nabstract base class: before installing the Meta attribute, it sets abstract=False . This means that children of abstract\nbase classes don’t automatically become abstract classes themselves. To make\nan abstract base class that inherits from another abstract base class, you need\nto explicitly set abstract=True on the child. Some attributes won’t make sense to include in the Meta class of an\nabstract base class. For example, including db_table would mean that all\nthe child classes (the ones that don’t specify their own Meta ) would use\nthe same database table, which is almost certainly not what you want. Due to the way Python inheritance works, if a child class inherits from\nmultiple abstract base classes, only the Meta options\nfrom the first listed class will be inherited by default. To inherit Meta options from multiple abstract base classes, you must\nexplicitly declare the Meta inheritance. For example: from django.db import models class CommonInfo ( models . Model ): name = models . CharField ( max_length = 100 ) age = models . PositiveIntegerField () class Meta : abstract = True ordering = [ \"name\" ] class Unmanaged ( models . Model ): class Meta : abstract = True managed = False class Student ( CommonInfo , Unmanaged ): home_group = models . CharField ( max_length = 5 ) class Meta ( CommonInfo . Meta , Unmanaged . Meta ): pass Be careful with related_name and related_query_name ¶ If you are using related_name or related_query_name on a ForeignKey or ManyToManyField , you must always specify a unique reverse name and query\nname for the field. This would normally cause a problem in abstract base\nclasses, since the fields on this class are included into each of the child\nclasses, with exactly the same values for the attributes (including related_name and related_query_name ) each time. To work around this problem, when you are using related_name or related_query_name in an abstract base\nclass (only), part of the value should contain '%(app_label)s' and '%(class)s' . '%(class)s' is replaced by the lowercased name of the child class that\nthe field is used in. '%(app_label)s' is replaced by the lowercased name of the app the child\nclass is contained within. Each installed application name must be unique and\nthe model class names within each app must also be unique, therefore the\nresulting name will end up being different. For example, given an app common/models.py : from django.db import models class Base ( models . Model ): m2m = models . ManyToManyField ( OtherModel , related_name = \" %(app_label)s _ %(class)s _related\" , related_query_name = \" %(app_label)s _ %(class)s s\" , ) class Meta : abstract = True class ChildA ( Base ): pass class ChildB ( Base ): pass Along with another app rare/models.py : from common.models import Base class ChildB ( Base ): pass The reverse name of the common.ChildA.m2m field will be common_childa_related and the reverse query name will be common_childas .\nThe reverse name of the common.ChildB.m2m field will be common_childb_related and the reverse query name will be common_childbs . Finally, the reverse name of the rare.ChildB.m2m field\nwill be rare_childb_related and the reverse query name will be rare_childbs . It’s up to you how you use the '%(class)s' and '%(app_label)s' portion to construct your related name or related query name\nbut if you forget to use it, Django will raise errors when you perform system\nchecks (or run migrate ). If you don’t specify a related_name attribute for a field in an abstract base class, the default reverse name will\nbe the name of the child class followed by '_set' , just as it normally\nwould be if you’d declared the field directly on the child class. For example,\nin the above code, if the related_name attribute was omitted, the reverse name for the m2m field would be childa_set in the ChildA case and childb_set for the ChildB field. Multi-table inheritance ¶ The second type of model inheritance supported by Django is when each model in\nthe hierarchy is a model all by itself. Each model corresponds to its own\ndatabase table and can be queried and created individually. The inheritance\nrelationship introduces links between the child model and each of its parents\n(via an automatically-created OneToOneField ).\nFor example: from django.db import models class Place ( models . Model ): name = models . CharField ( max_length = 50 ) address = models . CharField ( max_length = 80 ) class Restaurant ( Place ): serves_hot_dogs = models . BooleanField ( default = False ) serves_pizza = models . BooleanField ( default = False ) All of the fields of Place will also be available in Restaurant ,\nalthough the data will reside in a different database table. So these are both\npossible: >>> Place . objects . filter ( name = \"Bob's Cafe\" ) >>> Restaurant . objects . filter ( name = \"Bob's Cafe\" ) If you have a Place that is also a Restaurant , you can get from the Place object to the Restaurant object by using the lowercase version of\nthe model name: >>> p = Place . objects . get ( id = 12 ) # If p is a Restaurant object, this will give the child class: >>> p . restaurant <Restaurant: ...> However, if p in the above example was not a Restaurant (it had been\ncreated directly as a Place object or was the parent of some other class),\nreferring to p.restaurant would raise a Restaurant.DoesNotExist exception. The automatically-created OneToOneField on Restaurant that links it to Place looks like this: place_ptr = models . OneToOneField ( Place , on_delete = models . CASCADE , parent_link = True , primary_key = True , ) You can override that field by declaring your own OneToOneField with parent_link=True on Restaurant . Meta and multi-table inheritance ¶ In the multi-table inheritance situation, it doesn’t make sense for a child\nclass to inherit from its parent’s Meta class. All the Meta options\nhave already been applied to the parent class and applying them again would\nnormally only lead to contradictory behavior (this is in contrast with the\nabstract base class case, where the base class doesn’t exist in its own\nright). So a child model does not have access to its parent’s Meta class. However, there are a few limited cases where the child\ninherits behavior from the parent: if the child does not specify an ordering attribute or a get_latest_by attribute, it will inherit\nthese from its parent. If the parent has an ordering and you don’t want the child to have any natural\nordering, you can explicitly disable it: class ChildModel ( ParentModel ): # ... class Meta : # Remove parent's ordering effect ordering = [] Inheritance and reverse relations ¶ Because multi-table inheritance uses an implicit OneToOneField to link the child and\nthe parent, it’s possible to move from the parent down to the child,\nas in the above example. However, this uses up the name that is the\ndefault related_name value for ForeignKey and ManyToManyField relations.  If you\nare putting those types of relations on a subclass of the parent model, you must specify the related_name attribute on each such field. If you forget, Django will raise a validation\nerror. For example, using the above Place class again, let’s create another\nsubclass with a ManyToManyField : class Supplier ( Place ): customers = models . ManyToManyField ( Place ) This results in the error: Reverse query name for 'Supplier.customers' clashes with reverse query name for 'Supplier.place_ptr'. HINT: Add or change a related_name argument to the definition for 'Supplier.customers' or 'Supplier.place_ptr'. Adding related_name to the customers field as follows would resolve the\nerror: models.ManyToManyField(Place, related_name='provider') . Specifying the parent link field ¶ As mentioned, Django will automatically create a OneToOneField linking your child\nclass back to any non-abstract parent models. If you want to control the\nname of the attribute linking back to the parent, you can create your\nown OneToOneField and set parent_link=True to indicate that your field is the link back to the parent class. Proxy models ¶ When using multi-table inheritance , a new\ndatabase table is created for each subclass of a model. This is usually the\ndesired behavior, since the subclass needs a place to store any additional\ndata fields that are not present on the base class. Sometimes, however, you\nonly want to change the Python behavior of a model – perhaps to change the\ndefault manager, or add a new method. This is what proxy model inheritance is for: creating a proxy for the\noriginal model. You can create, delete and update instances of the proxy model\nand all the data will be saved as if you were using the original (non-proxied)\nmodel. The difference is that you can change things like the default model\nordering or the default manager in the proxy, without having to alter the\noriginal. Proxy models are declared like normal models. You tell Django that it’s a\nproxy model by setting the proxy attribute of\nthe Meta class to True . For example, suppose you want to add a method to the Person model. You can do it like this: from django.db import models class Person ( models . Model ): first_name = models . CharField ( max_length = 30 ) last_name = models . CharField ( max_length = 30 ) class MyPerson ( Person ): class Meta : proxy = True def do_something ( self ): # ... pass The MyPerson class operates on the same database table as its parent Person class. In particular, any new instances of Person will also be\naccessible through MyPerson , and vice-versa: >>> p = Person . objects . create ( first_name = \"foobar\" ) >>> MyPerson . objects . get ( first_name = \"foobar\" ) <MyPerson: foobar> You could also use a proxy model to define a different default ordering on\na model. You might not always want to order the Person model, but regularly\norder by the last_name attribute when you use the proxy: class OrderedPerson ( Person ): class Meta : ordering = [ \"last_name\" ] proxy = True Now normal Person queries will be unordered\nand OrderedPerson queries will be ordered by last_name . Proxy models inherit Meta attributes in the same way as regular\nmodels . QuerySet s still return the model that was requested ¶ There is no way to have Django return, say, a MyPerson object whenever you\nquery for Person objects. A queryset for Person objects will return\nthose types of objects. The whole point of proxy objects is that code relying\non the original Person will use those and your own code can use the\nextensions you included (that no other code is relying on anyway). It is not\na way to replace the Person (or any other) model everywhere with something\nof your own creation. Base class restrictions ¶ A proxy model must inherit from exactly one non-abstract model class. You\ncan’t inherit from multiple non-abstract models as the proxy model doesn’t\nprovide any connection between the rows in the different database tables. A\nproxy model can inherit from any number of abstract model classes, providing\nthey do not define any model fields. A proxy model may also inherit from any\nnumber of proxy models that share a common non-abstract parent class. Proxy model managers ¶ If you don’t specify any model managers on a proxy model, it inherits the\nmanagers from its model parents. If you define a manager on the proxy model,\nit will become the default, although any managers defined on the parent\nclasses will still be available. Continuing our example from above, you could change the default manager used\nwhen you query the Person model like this: from django.db import models class NewManager ( models . Manager ): # ... pass class MyPerson ( Person ): objects = NewManager () class Meta : proxy = True If you wanted to add a new manager to the Proxy, without replacing the\nexisting default, you can use the techniques described in the custom\nmanager documentation: create a base class\ncontaining the new managers and inherit that after the primary base class: # Create an abstract class for the new manager. class ExtraManagers ( models . Model ): secondary = NewManager () class Meta : abstract = True class MyPerson ( Person , ExtraManagers ): class Meta : proxy = True You probably won’t need to do this very often, but, when you do, it’s\npossible. Differences between proxy inheritance and unmanaged models ¶ Proxy model inheritance might look fairly similar to creating an unmanaged\nmodel, using the managed attribute on a\nmodel’s Meta class. With careful setting of Meta.db_table you could create an unmanaged model that\nshadows an existing model and adds Python methods to it. However, that would be\nvery repetitive and fragile as you need to keep both copies synchronized if you\nmake any changes. On the other hand, proxy models are intended to behave exactly like the model\nthey are proxying for. They are always in sync with the parent model since they\ndirectly inherit its fields and managers. The general rules are: If you are mirroring an existing model or database table and don’t want\nall the original database table columns, use Meta.managed=False .\nThat option is normally useful for modeling database views and tables\nnot under the control of Django. If you are wanting to change the Python-only behavior of a model, but\nkeep all the same fields as in the original, use Meta.proxy=True .\nThis sets things up so that the proxy model is an exact copy of the\nstorage structure of the original model when data is saved. Multiple inheritance ¶ Just as with Python’s subclassing, it’s possible for a Django model to inherit\nfrom multiple parent models. Keep in mind that normal Python name resolution\nrules apply. The first base class that a particular name (e.g. Meta ) appears in will be the one that is used; for example, this\nmeans that if multiple parents contain a Meta class,\nonly the first one is going to be used, and all others will be ignored. Generally, you won’t need to inherit from multiple parents. The main use-case\nwhere this is useful is for “mix-in” classes: adding a particular extra\nfield or method to every class that inherits the mix-in. Try to keep your\ninheritance hierarchies as simple and straightforward as possible so that you\nwon’t have to struggle to work out where a particular piece of information is\ncoming from. Note that inheriting from multiple models that have a common id primary\nkey field will raise an error. To properly use multiple inheritance, you can\nuse an explicit AutoField in the base models: class Article ( models . Model ): article_id = models . AutoField ( primary_key = True ) ... class Book ( models . Model ): book_id = models . AutoField ( primary_key = True ) ... class BookReview ( Book , Article ): pass Or use a common ancestor to hold the AutoField . This\nrequires using an explicit OneToOneField from each\nparent model to the common ancestor to avoid a clash between the fields that\nare automatically generated and inherited by the child: class Piece ( models . Model ): pass class Article ( Piece ): article_piece = models . OneToOneField ( Piece , on_delete = models . CASCADE , parent_link = True ) ... class Book ( Piece ): book_piece = models . OneToOneField ( Piece , on_delete = models . CASCADE , parent_link = True ) ... class BookReview ( Book , Article ): pass Field name “hiding” is not permitted ¶ In normal Python class inheritance, it is permissible for a child class to\noverride any attribute from the parent class. In Django, this isn’t usually\npermitted for model fields. If a non-abstract model base class has a field\ncalled author , you can’t create another model field or define\nan attribute called author in any class that inherits from that base class. This restriction doesn’t apply to model fields inherited from an abstract\nmodel. Such fields may be overridden with another field or value, or be removed\nby setting field_name = None . Warning Model managers are inherited from abstract base classes. Overriding an\ninherited field which is referenced by an inherited Manager may cause subtle bugs. See custom\nmanagers and model inheritance . Note Some fields define extra attributes on the model, e.g. a ForeignKey defines an extra attribute with _id appended to the field name, as well as related_name and related_query_name on the foreign model. These extra attributes cannot be overridden unless the field that defines\nit is changed or removed so that it no longer defines the extra attribute. Overriding fields in a parent model leads to difficulties in areas such as\ninitializing new instances (specifying which field is being initialized in Model.__init__ ) and serialization. These are features which normal Python\nclass inheritance doesn’t have to deal with in quite the same way, so the\ndifference between Django model inheritance and Python class inheritance isn’t\narbitrary. This restriction only applies to attributes which are Field instances. Normal Python attributes\ncan be overridden if you wish. It also only applies to the name of the\nattribute as Python sees it: if you are manually specifying the database\ncolumn name, you can have the same column name appearing in both a child and\nan ancestor model for multi-table inheritance (they are columns in two\ndifferent database tables). Django will raise a FieldError if you override\nany model field in any ancestor model. Note that because of the way fields are resolved during class definition, model\nfields inherited from multiple abstract parent models are resolved in a strict\ndepth-first order. This contrasts with standard Python MRO, which is resolved\nbreadth-first in cases of diamond shaped inheritance. This difference only\naffects complex model hierarchies, which (as per the advice above) you should\ntry to avoid. Organizing models in a package ¶ The manage.py startapp command creates an application\nstructure that includes a models.py file. If you have many models,\norganizing them in separate files may be useful. To do so, create a models package. Remove models.py and create a myapp/models/ directory with an __init__.py file and the files to\nstore your models. You must import the models in the __init__.py file. For example, if you had organic.py and synthetic.py in the models directory: myapp/models/__init__.py ¶ from .organic import Person from .synthetic import Robot Explicitly importing each model rather than using from .models import * has the advantages of not cluttering the namespace, making code more readable,\nand keeping code analysis tools useful. See also The Models Reference Covers all the model related APIs including model fields, related\nobjects, and QuerySet .", "keywords": ["users", "appconfig.default_auto_field", "box", "rows", "manytomanyfield.through_fields", "integerfield", "m1", "verbose", "student", "storage", "underscores", "pattern", "relational", "bronze", "model.__init", "default_auto_field", "meta.proxy", "analysis", "field", "#", "robot", "fielderror", "relation", "m", "runner", "serialization", "silver", "intermediary", "migrations", "metadata", "foo__bar", "membership__date_joined__gt", "l", "full_name", "representation", "mro", "django.db.models", "member", "datefield", "parents", "words", "type=\"text", "model2", "links", "serves_hot_dogs", "=", "changes", "get_absolute_url", "engine", "relationship", "fact", "toppings", "m2", "tables", "yoko", "foobar", "childb_set", "places", "through_fields", "john", "first_name", "uniqueness", "type", "ringo", "custom", "kwargs", "objects", "documentation", "django.utils.text", "mind", "file", "album", "work", "hiding", "cases", "fruit", ".synthetic", "sides", "attribute", "size", "warning", "time", "trick", "styles", "inherit", "workaround", "save", "date", "startapp", "setting", "purposes", "membership", "things", ".models", "field.default", "senior", "logic", "name", "birth_date", "makemigrations", "get_foo_display", "copies", "reference", "age", "parent_link", "queries", "manager", "clear", "uses", "children", "behaviors", "return", "piece", "normal", "situation", "define", "parent", "isolation", "shirt_size", "subclassing", "letter", "textfield", "parentmodel", "blog", "examples", "callables", "through_defaults", "model1", "status", "relationships", "pre", "proxy", "join", "url", "error", "module", "code", "bigint", "ringos_membership", "bulk", "commoninfo", "filter", "behavior", "access", "class", "i", "migration", "display", "link", "meta.managed", "group", "widget", "zipcode", "returns", "names", "paul", "year_in_school_choices", "app_label)s", "junior", "database", "input", "business", "instrument", "*", "query", "page", "postgresql", "common_childas", "migrate", "starr", "types", "subclass", "datetime.date(1962", "book_piece", "admin", "creation", "clash", "customers", "pair", "boomer", "mix", "student_info", "script", "horn_length", "max_length", "by", "group__name", "superclass", "do_something_else", "validation", "advice", "lies", "create", "limitations", "slugify", "source", "basics", "sequence", "underscore", "use", "graduate", "harrison", "adjustment", "field.primary_key", "cafe", "author", "subclasses", "enumeration", "extensions", "pass", "common.models", "order", "default", "post_delete", "choices", "home_group", "form", "signals", "fred", "option", "classes", "help", "convention", "hierarchies", "booleanfield", "advantage", "f", "get_latest_by", "childmodel", "gr", "mappings", "onetoonefield", "varchar", "way", "supplier", "formats", "console", "checks", "fr", "class)s", "queryset", "childa.m2", "integer", "¶", "command", "supplier.place_ptr", "spaces", "remove", "parameters", "mccartney", "property", "difficulties", "positiveintegerfield", "car", "primary", "stuff", "function", "apple", "baby", "views", "@property", "result", "control", "p.restaurant", "number", "lot", "childb.m2", "manytomanyfield(place", "right", "relations", "def", "point", "freshman", "values", "extramanagers", "num_stars", "string", "_", "geography.models", "mapping", "super().save(**kwargs", "musicians", "auto", "databases", "models/__init__.py", "verbose_name", "managers", "hand", "table", "medaltype", "models", "phone", "copy", "version", "ways", "level", "article", "namespace", "concise", "portion", "django", "myapp", "n’t", "fields", "orderedperson", "summary", "entry", "article_id", "set", "othermodel", "power", "lowercase", "p", "book", "bunch", "value", "topping", "sync", "bit", "musician", "baby_boomer_status", "hierarchy", "related_query_name", "columns", "data", "datetime", "base", "backend", "person", "clashes", "zip_code", "related_name='provider", "add", "declaration", "self", "instance", "members", "set_null", "primary_key", "interface", "beatles", "descriptions", "functionality", "coverage", "bugs", "related_name", "ox", "pizza", "instances", "structure", "inheriting", "installed_apps", "part", "areas", "references", "object", "holders", "couple", "restaurants", "groups", "charfield", "manytomanyfield", "precedence", "sql", "update_fields", "situations", "contrast", "keyword", "s", "ordering", "jr", "child", "resolution", "others", "top", "rules", "george", "notes", "serves_pizza", "effect", "detail", "system", "apps", "address", "restaurant", "inheritance", "oxen", "childa", "restrictions", "values_list", "example(models", "bookreview", "bob", "tagline", "definition", "autofield", "target", "difference", "newmanager", "forms", "site", "ancestor", "’s", "features", "diamond", "example", "app", "month", "requirements", "column", "list", "sample", "orm", "medal", "breadth", "poll", "sophomore", "drummer", "article_piece", "model", "word", "reasons", "techniques", "place", "apis", "element", "application", "identity", "attributes", "members__name__startswith", "differences", "sense", "syntax", "date_joined", "capabilities", "restriction", "ones", "manufacturer", "works", "keys", "case", "lookup", "null", "slug", "rare", "technique", "html", "errors", "tuple", "artist", "str", "arguments", "package", "db_default", "one", "singular", "textchoices", "matching", "tuples", "delete", "last_name", "decision", "kind", ".organic", "key", "cars", "gold", "operations", "pizzas", "none", "jan", "problem", "meta", "supplier.customers", "definitions", "company_that_makes_it", "myperson", "true", "api", "support", "myapp.models", "book_id", "hint", "db_column", "connection", "vice", "field_name", "dozens", "saving", "myapp_person", "import", "cascade", "files", "d", "sr", "statements", "directory", ">", "union", "%", "call", "foreignkey", "information", "row", "in", "python", "bigautofield", "flintstone", "methods", "options", "exception", "details", "method", "django.db", "settings", "argument", "sites", "tools", "band", "beginning", "ono", "text", "advantages"], "type": "documentation"},
{"title": "Migrations | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/migrations/", "content": "Migrations ¶ Migrations are Django’s way of propagating changes you make to your models\n(adding a field, deleting a model, etc.) into your database schema. They’re\ndesigned to be mostly automatic, but you’ll need to know when to make\nmigrations, when to run them, and the common problems you might run into. The Commands ¶ There are several commands which you will use to interact with migrations\nand Django’s handling of database schema: migrate , which is responsible for applying and unapplying\nmigrations. makemigrations , which is responsible for creating new migrations\nbased on the changes you have made to your models. sqlmigrate , which displays the SQL statements for a migration. showmigrations , which lists a project’s migrations and their\nstatus. You should think of migrations as a version control system for your database\nschema. makemigrations is responsible for packaging up your model changes\ninto individual migration files - analogous to commits - and migrate is\nresponsible for applying those to your database. The migration files for each app live in a “migrations” directory inside\nof that app, and are designed to be committed to, and distributed as part\nof, its codebase. You should be making them once on your development machine\nand then running the same migrations on your colleagues’ machines, your\nstaging machines, and eventually your production machines. Note It is possible to override the name of the package which contains the\nmigrations on a per-app basis by modifying the MIGRATION_MODULES setting. Migrations will run the same way on the same dataset and produce consistent\nresults, meaning that what you see in development and staging is, under the\nsame circumstances, exactly what will happen in production. Django will make migrations for any change to your models or fields - even\noptions that don’t affect the database - as the only way it can reconstruct\na field correctly is to have all the changes in the history, and you might\nneed those options in some data migrations later on (for example, if you’ve\nset custom validators). Backend Support ¶ Migrations are supported on all backends that Django ships with, as well\nas any third-party backends if they have programmed in support for schema\nalteration (done via the SchemaEditor class). However, some databases are more capable than others when it comes to\nschema migrations; some of the caveats are covered below. PostgreSQL ¶ PostgreSQL is the most capable of all the databases here in terms of schema\nsupport. MySQL ¶ MySQL lacks support for transactions around schema alteration operations,\nmeaning that if a migration fails to apply you will have to manually unpick\nthe changes in order to try again (it’s impossible to roll back to an\nearlier point). MySQL 8.0 introduced significant performance enhancements for DDL operations , making them more efficient and reducing the need for full\ntable rebuilds. However, it cannot guarantee a complete absence of locks or\ninterruptions. In situations where locks are still necessary, the duration of\nthese operations will be proportionate to the number of rows involved. Finally, MySQL has a relatively small limit on the combined size of all columns\nan index covers. This means that indexes that are possible on other backends\nwill fail to be created under MySQL. SQLite ¶ SQLite has very little built-in schema alteration support, and so Django\nattempts to emulate it by: Creating a new table with the new schema Copying the data across Dropping the old table Renaming the new table to match the original name This process generally works well, but it can be slow and occasionally\nbuggy. It is not recommended that you run and migrate SQLite in a\nproduction environment unless you are very aware of the risks and\nits limitations; the support Django ships with is designed to allow\ndevelopers to use SQLite on their local machines to develop less complex\nDjango projects without the need for a full database. Workflow ¶ Django can create migrations for you. Make changes to your models - say, add a\nfield and remove a model - and then run makemigrations : $ python manage.py makemigrations\nMigrations for 'books' : books/migrations/0003_auto.py: ~ Alter field author on book Your models will be scanned and compared to the versions currently\ncontained in your migration files, and then a new set of migrations\nwill be written out. Make sure to read the output to see what makemigrations thinks you have changed - it’s not perfect, and for\ncomplex changes it might not be detecting what you expect. Once you have your new migration files, you should apply them to your\ndatabase to make sure they work as expected: $ python manage.py migrate\nOperations to perform: Apply all migrations: books\nRunning migrations: Rendering model states... DONE Applying books.0003_auto... OK Once the migration is applied, commit the migration and the models change\nto your version control system as a single commit - that way, when other\ndevelopers (or your production servers) check out the code, they’ll\nget both the changes to your models and the accompanying migration at the\nsame time. If you want to give the migration(s) a meaningful name instead of a generated\none, you can use the makemigrations --name option: $ python manage.py makemigrations --name changed_my_model your_app_label Version control ¶ Because migrations are stored in version control, you’ll occasionally\ncome across situations where you and another developer have both committed\na migration to the same app at the same time, resulting in two migrations\nwith the same number. Don’t worry - the numbers are just there for developers’ reference, Django\njust cares that each migration has a different name. Migrations specify which\nother migrations they depend on - including earlier migrations in the same\napp - in the file, so it’s possible to detect when there’s two new migrations\nfor the same app that aren’t ordered. When this happens, Django will prompt you and give you some options. If it\nthinks it’s safe enough, it will offer to automatically linearize the two\nmigrations for you. If not, you’ll have to go in and modify the migrations\nyourself - don’t worry, this isn’t difficult, and is explained more in Migration files below. Transactions ¶ On databases that support DDL transactions (SQLite and PostgreSQL), all\nmigration operations will run inside a single transaction by default. In\ncontrast, if a database doesn’t support DDL transactions (e.g. MySQL, Oracle)\nthen all operations will run without a transaction. You can prevent a migration from running in a transaction by setting the atomic attribute to False . For example: from django.db import migrations class Migration ( migrations . Migration ): atomic = False It’s also possible to execute parts of the migration inside a transaction using atomic() or by passing atomic=True to RunPython . See Non-atomic migrations for more details. Dependencies ¶ While migrations are per-app, the tables and relationships implied by\nyour models are too complex to be created for one app at a time. When you make\na migration that requires something else to run - for example, you add a ForeignKey in your books app to your authors app - the resulting\nmigration will contain a dependency on a migration in authors . This means that when you run the migrations, the authors migration runs\nfirst and creates the table the ForeignKey references, and then the migration\nthat makes the ForeignKey column runs afterward and creates the constraint.\nIf this didn’t happen, the migration would try to create the ForeignKey column without the table it’s referencing existing and your database would\nthrow an error. This dependency behavior affects most migration operations where you\nrestrict to a single app. Restricting to a single app (either in makemigrations or migrate ) is a best-efforts promise, and not\na guarantee; any other apps that need to be used to get dependencies correct\nwill be. Apps without migrations must not have relations ( ForeignKey , ManyToManyField , etc.) to apps with migrations. Sometimes it may work, but\nit’s not supported. Swappable dependencies ¶ django.db.migrations. swappable_dependency ( value ) ¶ The swappable_dependency() function is used in migrations to declare\n“swappable” dependencies on migrations in the app of the swapped-in model,\ncurrently, on the first migration of this app. As a consequence, the swapped-in\nmodel should be created in the initial migration. The argument value is a\nstring \"<app label>.<model>\" describing an app label and a model name, e.g. \"myapp.MyModel\" . By using swappable_dependency() , you inform the migration framework that\nthe migration relies on another migration which sets up a swappable model,\nallowing for the possibility of substituting the model with a different\nimplementation in the future. This is typically used for referencing models\nthat are subject to customization or replacement, such as the custom user\nmodel ( settings.AUTH_USER_MODEL , which defaults to \"auth.User\" ) in\nDjango’s authentication system. Migration files ¶ Migrations are stored as an on-disk format, referred to here as\n“migration files”. These files are actually normal Python files with an\nagreed-upon object layout, written in a declarative style. A basic migration file looks like this: from django.db import migrations , models class Migration ( migrations . Migration ): dependencies = [( \"migrations\" , \"0001_initial\" )] operations = [ migrations . DeleteModel ( \"Tribble\" ), migrations . AddField ( \"Author\" , \"rating\" , models . IntegerField ( default = 0 )), ] What Django looks for when it loads a migration file (as a Python module) is\na subclass of django.db.migrations.Migration called Migration . It then\ninspects this object for four attributes, only two of which are used\nmost of the time: dependencies , a list of migrations this one depends on. operations , a list of Operation classes that define what this\nmigration does. The operations are the key; they are a set of declarative instructions which\ntell Django what schema changes need to be made. Django scans them and\nbuilds an in-memory representation of all of the schema changes to all apps,\nand uses this to generate the SQL which makes the schema changes. That in-memory structure is also used to work out what the differences are\nbetween your models and the current state of your migrations; Django runs\nthrough all the changes, in order, on an in-memory set of models to come\nup with the state of your models last time you ran makemigrations . It\nthen uses these models to compare against the ones in your models.py files\nto work out what you have changed. You should rarely, if ever, need to edit migration files by hand, but\nit’s entirely possible to write them manually if you need to. Some of the\nmore complex operations are not autodetectable and are only available via\na hand-written migration, so don’t be scared about editing them if you have to. Custom fields ¶ You can’t modify the number of positional arguments in an already migrated\ncustom field without raising a TypeError . The old migration will call the\nmodified __init__ method with the old signature. So if you need a new\nargument, please create a keyword argument and add something like assert 'argument_name' in kwargs in the constructor. Model managers ¶ You can optionally serialize managers into migrations and have them available\nin RunPython operations. This is done\nby defining a use_in_migrations attribute on the manager class: class MyManager ( models . Manager ): use_in_migrations = True class MyModel ( models . Model ): objects = MyManager () If you are using the from_queryset() function to\ndynamically generate a manager class, you need to inherit from the generated\nclass to make it importable: class MyManager ( MyBaseManager . from_queryset ( CustomQuerySet )): use_in_migrations = True class MyModel ( models . Model ): objects = MyManager () Please refer to the notes about Historical models in migrations to see\nthe implications that come along. Initial migrations ¶ Migration. initial ¶ The “initial migrations” for an app are the migrations that create the first\nversion of that app’s tables. Usually an app will have one initial migration,\nbut in some cases of complex model interdependencies it may have two or more. Initial migrations are marked with an initial = True class attribute on the\nmigration class. If an initial class attribute isn’t found, a migration\nwill be considered “initial” if it is the first migration in the app (i.e. if\nit has no dependencies on any other migration in the same app). When the migrate --fake-initial option is used, these initial\nmigrations are treated specially. For an initial migration that creates one or\nmore tables ( CreateModel operation), Django checks that all of those tables\nalready exist in the database and fake-applies the migration if so. Similarly,\nfor an initial migration that adds one or more fields ( AddField operation),\nDjango checks that all of the respective columns already exist in the database\nand fake-applies the migration if so. Without --fake-initial , initial\nmigrations are treated no differently from any other migration. History consistency ¶ As previously discussed, you may need to linearize migrations manually when two\ndevelopment branches are joined. While editing migration dependencies, you can\ninadvertently create an inconsistent history state where a migration has been\napplied but some of its dependencies haven’t. This is a strong indication that\nthe dependencies are incorrect, so Django will refuse to run migrations or make\nnew migrations until it’s fixed. When using multiple databases, you can use the allow_migrate() method of database routers to control which databases makemigrations checks for consistent history. Adding migrations to apps ¶ New apps come preconfigured to accept migrations, and so you can add migrations\nby running makemigrations once you’ve made some changes. If your app already has models and database tables, and doesn’t have migrations\nyet (for example, you created it against a previous Django version), you’ll\nneed to convert it to use migrations by running: $ python manage.py makemigrations your_app_label This will make a new initial migration for your app. Now, run python manage.py migrate --fake-initial , and Django will detect that you have an\ninitial migration and that the tables it wants to create already exist, and\nwill mark the migration as already applied. (Without the migrate --fake-initial flag, the command would error out because the tables it wants\nto create already exist.) Note that this only works given two things: You have not changed your models since you made their tables. For migrations\nto work, you must make the initial migration first and then make changes,\nas Django compares changes against migration files, not the database. You have not manually edited your database - Django won’t be able to detect\nthat your database doesn’t match your models, you’ll just get errors when\nmigrations try to modify those tables. Reversing migrations ¶ Migrations can be reversed with migrate by passing the number of the\nprevious migration. For example, to reverse migration books.0003 : /  $ python manage.py migrate books 0002 Operations to perform: Target specific migration: 0002_auto, from books Running migrations: Rendering model states... DONE Unapplying books.0003_auto... OK ...\\> py manage.py migrate books 0002 Operations to perform: Target specific migration: 0002_auto, from books Running migrations: Rendering model states... DONE Unapplying books.0003_auto... OK If you want to reverse all migrations applied for an app, use the name zero : /  $ python manage.py migrate books zero Operations to perform: Unapply all migrations: books Running migrations: Rendering model states... DONE Unapplying books.0002_auto... OK Unapplying books.0001_initial... OK ...\\> py manage.py migrate books zero Operations to perform: Unapply all migrations: books Running migrations: Rendering model states... DONE Unapplying books.0002_auto... OK Unapplying books.0001_initial... OK A migration is irreversible if it contains any irreversible operations.\nAttempting to reverse such migrations will raise IrreversibleError : /  $ python manage.py migrate books 0002 Operations to perform: Target specific migration: 0002_auto, from books Running migrations: Rendering model states... DONE Unapplying books.0003_auto...Traceback (most recent call last): django.db.migrations.exceptions.IrreversibleError: Operation <RunSQL  sql='DROP TABLE demo_books'> in books.0003_auto is not reversible ...\\> py manage.py migrate books 0002 Operations to perform: Target specific migration: 0002_auto, from books Running migrations: Rendering model states... DONE Unapplying books.0003_auto...Traceback (most recent call last): django.db.migrations.exceptions.IrreversibleError: Operation <RunSQL  sql='DROP TABLE demo_books'> in books.0003_auto is not reversible Historical models ¶ When you run migrations, Django is working from historical versions of your\nmodels stored in the migration files. If you write Python code using the RunPython operation, or if you have allow_migrate methods on your database routers, you need to use these\nhistorical model versions rather than importing them directly. Warning If you import models directly rather than using the historical models,\nyour migrations may work initially but will fail in the future when you\ntry to rerun old migrations (commonly, when you set up a new installation\nand run through all the migrations to set up the database). This means that historical model problems may not be immediately obvious.\nIf you run into this kind of failure, it’s OK to edit the migration to use\nthe historical models rather than direct imports and commit those changes. Because it’s impossible to serialize arbitrary Python code, these historical\nmodels will not have any custom methods that you have defined. They will,\nhowever, have the same fields, relationships, managers (limited to those with use_in_migrations = True ) and Meta options (also versioned, so they may\nbe different from your current ones). Warning This means that you will NOT have custom save() methods called on objects\nwhen you access them in migrations, and you will NOT have any custom\nconstructors or instance methods. Plan appropriately! References to functions in field options such as upload_to and limit_choices_to and model manager declarations with managers having use_in_migrations = True are serialized in migrations, so the functions and\nclasses will need to be kept around for as long as there is a migration\nreferencing them. Any custom model fields will also need to be kept, since these are imported directly by migrations. In addition, the concrete base classes of the model are stored as pointers, so\nyou must always keep base classes around for as long as there is a migration\nthat contains a reference to them. On the plus side, methods and managers from\nthese base classes inherit normally, so if you absolutely need access to these\nyou can opt to move them into a superclass. To remove old references, you can squash migrations or, if there aren’t many references, copy them into the migration files. Considerations when removing model fields ¶ Similar to the “references to historical functions” considerations described in\nthe previous section, removing custom model fields from your project or\nthird-party app will cause a problem if they are referenced in old migrations. To help with this situation, Django provides some model field attributes to\nassist with model field deprecation using the system checks framework . Add the system_check_deprecated_details attribute to your model field\nsimilar to the following: class IPAddressField ( Field ): system_check_deprecated_details = { \"msg\" : ( \"IPAddressField has been deprecated. Support for it (except \" \"in historical migrations) will be removed in Django 1.9.\" ), \"hint\" : \"Use GenericIPAddressField instead.\" , # optional \"id\" : \"fields.W900\" , # pick a unique ID for your field. } After a deprecation period of your choosing (two or three feature releases for\nfields in Django itself), change the system_check_deprecated_details attribute to system_check_removed_details and update the dictionary similar\nto: class IPAddressField ( Field ): system_check_removed_details = { \"msg\" : ( \"IPAddressField has been removed except for support in \" \"historical migrations.\" ), \"hint\" : \"Use GenericIPAddressField instead.\" , \"id\" : \"fields.E900\" , # pick a unique ID for your field. } You should keep the field’s methods that are required for it to operate in\ndatabase migrations such as __init__() , deconstruct() , and get_internal_type() . Keep this stub field for as long as any migrations\nwhich reference the field exist. For example, after squashing migrations and\nremoving the old ones, you should be able to remove the field completely. Data Migrations ¶ As well as changing the database schema, you can also use migrations to change\nthe data in the database itself, in conjunction with the schema if you want. Migrations that alter data are usually called “data migrations”; they’re best\nwritten as separate migrations, sitting alongside your schema migrations. Django can’t automatically generate data migrations for you, as it does with\nschema migrations, but it’s not very hard to write them. Migration files in\nDjango are made up of Operations , and\nthe main operation you use for data migrations is RunPython . To start, make an empty migration file you can work from (Django will put\nthe file in the right place, suggest a name, and add dependencies for you): python manage.py makemigrations --empty yourappname Then, open up the file; it should look something like this: # Generated by Django A.B on YYYY-MM-DD HH:MM from django.db import migrations class Migration ( migrations . Migration ): dependencies = [ ( \"yourappname\" , \"0001_initial\" ), ] operations = [] Now, all you need to do is create a new function and have RunPython use it. RunPython expects a callable as its argument\nwhich takes two arguments - the first is an app registry that has the historical versions of all your models\nloaded into it to match where in your history the migration sits, and the\nsecond is a SchemaEditor , which you can use to\nmanually effect database schema changes (but beware, doing this can confuse\nthe migration autodetector!) Let’s write a migration that populates our new name field with the combined\nvalues of first_name and last_name (we’ve come to our senses and\nrealized that not everyone has first and last names). All we need to do is use\nthe historical model and iterate over the rows: from django.db import migrations def combine_names ( apps , schema_editor ): # We can't import the Person model directly as it may be a newer # version than this migration expects. We use the historical version. Person = apps . get_model ( \"yourappname\" , \"Person\" ) for person in Person . objects . all (): person . name = f \" { person . first_name } { person . last_name } \" person . save () class Migration ( migrations . Migration ): dependencies = [ ( \"yourappname\" , \"0001_initial\" ), ] operations = [ migrations . RunPython ( combine_names ), ] Once that’s done, we can run python manage.py migrate as normal and the\ndata migration will run in place alongside other migrations. You can pass a second callable to RunPython to run whatever logic you\nwant executed when migrating backwards. If this callable is omitted, migrating\nbackwards will raise an exception. Accessing models from other apps ¶ When writing a RunPython function that uses models from apps other than the\none in which the migration is located, the migration’s dependencies attribute should include the latest migration of each app that is involved,\notherwise you may get an error similar to: LookupError: No installed app with label 'myappname' when you try to retrieve the model in the RunPython function using apps.get_model() . In the following example, we have a migration in app1 which needs to use\nmodels in app2 . We aren’t concerned with the details of move_m1 other\nthan the fact it will need to access models from both apps. Therefore we’ve\nadded a dependency that specifies the last migration of app2 : class Migration ( migrations . Migration ): dependencies = [ ( \"app1\" , \"0001_initial\" ), # added dependency to enable using models from app2 in move_m1 ( \"app2\" , \"0004_foobar\" ), ] operations = [ migrations . RunPython ( move_m1 ), ] More advanced migrations ¶ If you’re interested in the more advanced migration operations, or want\nto be able to write your own, see the migration operations reference and the “how-to” on writing migrations . Squashing migrations ¶ You are encouraged to make migrations freely and not worry about how many you\nhave; the migration code is optimized to deal with hundreds at a time without\nmuch slowdown. However, eventually you will want to move back from having\nseveral hundred migrations to just a few, and that’s where squashing comes in. Squashing is the act of reducing an existing set of many migrations down to\none (or sometimes a few) migrations which still represent the same changes. Django does this by taking all of your existing migrations, extracting their Operation s and putting them all in sequence, and then running an optimizer\nover them to try and reduce the length of the list - for example, it knows\nthat CreateModel and DeleteModel cancel each other out,\nand it knows that AddField can be\nrolled into CreateModel . Once the operation sequence has been reduced as much as possible - the amount\npossible depends on how closely intertwined your models are and if you have\nany RunSQL or RunPython operations (which can’t\nbe optimized through unless they are marked as elidable ) - Django will then\nwrite it back out into a new set of migration files. These files are marked to say they replace the previously-squashed migrations,\nso they can coexist with the old migration files, and Django will intelligently\nswitch between them depending where you are in the history. If you’re still\npart-way through the set of migrations that you squashed, it will keep using\nthem until it hits the end and then switch to the squashed history, while new\ninstalls will use the new squashed migration and skip all the old ones. This enables you to squash and not mess up systems currently in production\nthat aren’t fully up-to-date yet. The recommended process is to squash, keeping\nthe old files, commit and release, wait until all systems are upgraded with\nthe new release (or if you’re a third-party project, ensure your users upgrade\nreleases in order without skipping any), and then remove the old files, commit\nand do a second release. The command that backs all this is squashmigrations - pass it the\napp label and migration name you want to squash up to, and it’ll get to work: $ ./manage.py squashmigrations myapp 0004 Will squash the following migrations: - 0001_initial - 0002_some_change - 0003_another_change - 0004_undo_something\nDo you wish to proceed? [ y/N ] y\nOptimizing... Optimized from 12 operations to 7 operations.\nCreated new squashed migration /home/andrew/Programs/DjangoTest/test/migrations/0001_squashed_0004_undo_something.py You should commit this migration but leave the old ones in place ; the new migration will be used for new installs. Once you are sure all instances of the codebase have applied the migrations you squashed, you can delete them. Use the squashmigrations --squashed-name option if you want to set\nthe name of the squashed migration rather than use an autogenerated one. Note that model interdependencies in Django can get very complex, and squashing\nmay result in migrations that do not run; either mis-optimized (in which case\nyou can try again with --no-optimize , though you should also report an issue),\nor with a CircularDependencyError , in which case you can manually resolve it. To manually resolve a CircularDependencyError , break out one of\nthe ForeignKeys in the circular dependency loop into a separate\nmigration, and move the dependency on the other app with it. If you’re unsure,\nsee how makemigrations deals with the problem when asked to create\nbrand new migrations from your models. In a future release of Django, squashmigrations will be updated to attempt to resolve these errors\nitself. Once you’ve squashed your migration, you should then commit it alongside the\nmigrations it replaces and distribute this change to all running instances\nof your application, making sure that they run migrate to store the change\nin their database. You must then transition the squashed migration to a normal migration by: Deleting all the migration files it replaces. Updating all migrations that depend on the deleted migrations to depend on\nthe squashed migration instead. Removing the replaces attribute in the Migration class of the\nsquashed migration (this is how Django tells that it is a squashed migration). Note Once you’ve squashed a migration, you should not then re-squash that squashed\nmigration until you have fully transitioned it to a normal migration. Pruning references to deleted migrations If it is likely that you may reuse the name of a deleted migration in the\nfuture, you should remove references to it from Django’s migrations table\nwith the migrate --prune option. Serializing values ¶ Migrations are Python files containing the old definitions of your models\n- thus, to write them, Django must take the current state of your models and\nserialize them out into a file. While Django can serialize most things, there are some things that we just\ncan’t serialize out into a valid Python representation - there’s no Python\nstandard for how a value can be turned back into code ( repr() only works\nfor basic values, and doesn’t specify import paths). Django can serialize the following: int , float , bool , str , bytes , None , NoneType list , set , tuple , dict , range . datetime.date , datetime.time , and datetime.datetime instances\n(include those that are timezone-aware) decimal.Decimal instances enum.Enum and enum.Flag instances uuid.UUID instances functools.partial() and functools.partialmethod instances\nwhich have serializable func , args , and keywords values. Pure and concrete path objects from pathlib . Concrete paths are\nconverted to their pure path equivalent, e.g. pathlib.PosixPath to pathlib.PurePosixPath . os.PathLike instances, e.g. os.DirEntry , which are\nconverted to str or bytes using os.fspath() . LazyObject instances which wrap a serializable value. Enumeration types (e.g. TextChoices or IntegerChoices ) instances. Any Django field Any function or method reference (e.g. datetime.datetime.today ) (must be\nin module’s top-level scope) Functions may be decorated if wrapped properly, i.e. using functools.wraps() The functools.cache() and functools.lru_cache() decorators are\nexplicitly supported Unbound methods used from within the class body Any class reference (must be in module’s top-level scope) Anything with a custom deconstruct() method ( see below ) Changed in Django 5.0: Serialization support for functions decorated with functools.cache() or functools.lru_cache() was added. Django cannot serialize: Nested classes Arbitrary class instances (e.g. MyClass(4.3, 5.7) ) Lambdas Custom serializers ¶ You can serialize other types by writing a custom serializer. For example, if\nDjango didn’t serialize Decimal by default, you could do\nthis: from decimal import Decimal from django.db.migrations.serializer import BaseSerializer from django.db.migrations.writer import MigrationWriter class DecimalSerializer ( BaseSerializer ): def serialize ( self ): return repr ( self . value ), { \"from decimal import Decimal\" } MigrationWriter . register_serializer ( Decimal , DecimalSerializer ) The first argument of MigrationWriter.register_serializer() is a type or\niterable of types that should use the serializer. The serialize() method of your serializer must return a string of how the\nvalue should appear in migrations and a set of any imports that are needed in\nthe migration. Adding a deconstruct() method ¶ You can let Django serialize your own custom class instances by giving the class\na deconstruct() method. It takes no arguments, and should return a tuple\nof three things (path, args, kwargs) : path should be the Python path to the class, with the class name included\nas the last part (for example, myapp.custom_things.MyClass ). If your\nclass is not available at the top level of a module it is not serializable. args should be a list of positional arguments to pass to your class’ __init__ method. Everything in this list should itself be serializable. kwargs should be a dict of keyword arguments to pass to your class’ __init__ method. Every value should itself be serializable. Note This return value is different from the deconstruct() method for custom fields which returns a\ntuple of four items. Django will write out the value as an instantiation of your class with the\ngiven arguments, similar to the way it writes out references to Django fields. To prevent a new migration from being created each time makemigrations is run, you should also add a __eq__() method to\nthe decorated class. This function will be called by Django’s migration\nframework to detect changes between states. As long as all of the arguments to your class’ constructor are themselves\nserializable, you can use the @deconstructible class decorator from django.utils.deconstruct to add the deconstruct() method: from django.utils.deconstruct import deconstructible @deconstructible class MyCustomClass : def __init__ ( self , foo = 1 ): self . foo = foo ... def __eq__ ( self , other ): return self . foo == other . foo The decorator adds logic to capture and preserve the arguments on their\nway into your constructor, and then returns those arguments exactly when\ndeconstruct() is called. Supporting multiple Django versions ¶ If you are the maintainer of a third-party app with models, you may need to\nship migrations that support multiple Django versions. In this case, you should\nalways run makemigrations with the lowest Django version you wish\nto support . The migrations system will maintain backwards-compatibility according to the\nsame policy as the rest of Django, so migration files generated on Django X.Y\nshould run unchanged on Django X.Y+1. The migrations system does not promise\nforwards-compatibility, however. New features may be added, and migration files\ngenerated with newer versions of Django may not work on older versions. See also The Migrations Operations Reference Covers the schema operations API, special operations, and writing your\nown operations. The Writing Migrations “how-to” Explains how to structure and write database migrations for different\nscenarios you might encounter.", "keywords": ["users", "rows", "allow_migrate", "feature", "act", "integerfield", "circulardependencyerror", "declarations", "migrationwriter", "forwards", "register_serializer", "functools.lru_cache", "foreignkeys", "field", "#", "serialization", "django.db.migrations.serializer", "migrations", "numbers", "loop", "representation", "range", "ddl", "compatibility", "get_model", "change", "swappable_dependency", "constructors", "label", "changes", "=", "results", "sqlmigrate", "installation", "n", "fact", "tables", "os.fspath", "process", "nonetype", "migration(s", "posixpath", "branches", "migrationwriter.register_serializer", "combine_names", "first_name", "functools.cache", "type", "django.db.migrations", "w900", "custom", "kwargs", "objects", "books.0003", "hundreds", "file", "implications", "customization", "constraint", "guarantee", "layout", "user", "baseserializer", "cases", "lambdas", "--no", "--fake", "attribute", "states", "args", "lazyobject", "addfield", "size", "developers", "time", "workflow", "mm", "basis", "date", "move_m1", "0002_some_change", "things", "mybasemanager", "ship", "logic", "pureposixpath", "migrations/0001_squashed_0004_undo_something.py", "name", "makemigrations", "codebase", "backends", "reference", "issue", "problems", "versions", "dataset", "manager", "return", "memory", "situation", "foo", "duration", "argument_name", "commits", "mymodel", "failure", "lookuperror", "djangotest", "status", "serialize", "relationships", "bool", "error", "module", "code", "books.0002_auto", "period", "auth", "replaces", "createmodel", "false", "behavior", "style", "access", "migration", "class", "manage.py", "i", "names", "deconstruct", "schema_editor", "database", "flag", "output", "apps.get_model", "test", "commands", "postgresql", "migrate", "types", "py", "subclass", "django.db.migrations.exceptions", "registry", "auth_user_model", "limit", "your_app_label", "writing", "superclass", "upload_to", "instantiation", "limitations", "running", "section", "/", "developer", "sequence", "migrations/0003_auto.py", "system_check_deprecated_details", "replacement", "environment", "pathlike", "commit", "author", "imports", "label>.<model", "performance", "mymanager", "releases", "irreversibleerror", "tribble", "enumeration", "operation", "order", "signature", "0004_undo_something", "default", "django.utils.deconstruct", "option", "format", "classes", "considerations", "caveats", "schema", "traceback", "way", "checks", "servers", "index", "possibility", "promise", "party", "0003_another_change", "¶", "bytes", "command", "id", "x.y+1", "disk", "installs", "myappname", "int", "atomic", "side", "function", "uuid", "control", "enum", "indexes", "indication", "number", "relations", "/", "point", "values", "enhancements", "string", "slowdown", "_", "databases", "customqueryset", "interdependencies", "senses", "managers", "hh", "hand", "table", "alteration", "models", "history", "version", "choosing", "level", "absence", "machine", "deprecation", "django", "myapp", "mis", "n’t", "fields", "set", "development", "book", "value", "rating", "limit_choices_to", "policy", "columns", "data", "implementation", "scope", "base", "backend", "machines", "person", "efforts", "runsql", "optimizing", "locks", "paths", "need", "instance", "self", "colleagues", "typeerror", "schemaeditor", "handling", "consequence", "alter", "validators", "direntry", "ipaddressfield", "decorator", "integerchoices", "constructor", "./manage.py", "instances", "structure", "system_check_removed_details", "part", "dependency", "references", "object", "risks", "manytomanyfield", "sql", "instructions", "authors", "terms", "situations", "contrast", "keyword", "others", "decorators", "rest", "notes", "optimizer", "autodetector", "runpython", "effect", "staging", "system", "apps", "sql='drop", "myclass", "iterate", "dependencies", "functools.wraps", "second", "items", "production", "routers", "programs", "serializer", "decimal", "changed_my_model", "features", "django.db.migrations.writer", "consistency", "’s", "addition", "deletemodel", "example", "app", "func", "column", "list", "books.0003_auto", "get_internal_type", "model", "unapplying", "place", "systems", "application", "attributes", "rebuilds", "release", "differences", "y", "squashing", "circumstances", "books.0001_initial", "brand", "ones", "works", "case", "length", "authentication", "conjunction", "x.y", "andrew", "decimalserializer", "errors", "datetime.datetime.today", "showmigrations", "future", "tuple", "str", "arguments", "myapp.custom_things", "package", "init", "pathlib", "one", "stub", "end", "msg", "sqlite", "textchoices", "last_name", "amount", "standard", "kind", "path", "e900", "functions", "key", "operations", "none", "use_in_migrations", "problem", "0004_foobar", "app1", "definitions", "app2", "framework", "dict", "\\", "dd", "api", "support", "hint", "transactions", "yyyy", "-", "files", "import", "squashmigrations", "d", "optimize", "statements", "directory", "mysql", "call", "foreignkey", "python", "yourappname", "functools.partial", "methods", "books", "options", "optional", "exception", "unapply", "details", "method", "django.db", "settings", "ships", "transaction", "argument", "maintainer", "body", "state", "oracle", "interruptions", "scenarios", "pointers", "a.b", "project", "parts"], "type": "documentation"},
{"title": "Models and databases | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/db/", "content": "Models and databases ¶ A model is the single, definitive source of information about your data. It\ncontains the essential fields and behaviors of the data you’re storing.\nGenerally, each model maps to a single database table. Models Making queries Aggregation Search Managers Performing raw SQL queries Database transactions Multiple databases Tablespaces Database access optimization Database instrumentation Fixtures Examples of model relationship API usage", "keywords": ["transactions", "examples", "model", "optimization", "usage", "sql", "aggregation", "information", "tablespaces", "fields", "access", "relationship", "behaviors", "databases", "source", "instrumentation", "managers", "data", "database", "search", "table", "models", "api", "fixtures"], "type": "documentation"},
{"title": "Cryptographic signing | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/signing/", "content": "Cryptographic signing ¶ The golden rule of web application security is to never trust data from\nuntrusted sources. Sometimes it can be useful to pass data through an\nuntrusted medium. Cryptographically signed values can be passed through an\nuntrusted channel safe in the knowledge that any tampering will be detected. Django provides both a low-level API for signing values and a high-level API\nfor setting and reading signed cookies, one of the most common uses of\nsigning in web applications. You may also find signing useful for the following: Generating “recover my account” URLs for sending to users who have\nlost their password. Ensuring data stored in hidden form fields has not been tampered with. Generating one-time secret URLs for allowing temporary access to a\nprotected resource, for example a downloadable file that a user has\npaid for. Protecting SECRET_KEY and SECRET_KEY_FALLBACKS ¶ When you create a new Django project using startproject , the settings.py file is generated automatically and gets a random SECRET_KEY value. This value is the key to securing signed\ndata – it is vital you keep this secure, or attackers could use it to\ngenerate their own signed values. SECRET_KEY_FALLBACKS can be used to rotate secret keys. The\nvalues will not be used to sign data, but if specified, they will be used to\nvalidate signed data and must be kept secure. Using the low-level API ¶ Django’s signing methods live in the django.core.signing module.\nTo sign a value, first instantiate a Signer instance: >>> from django.core.signing import Signer >>> signer = Signer () >>> value = signer . sign ( \"My string\" ) >>> value 'My string:GdMGD6HNQ_qdgxYP8yBZAdAIV1w' The signature is appended to the end of the string, following the colon.\nYou can retrieve the original value using the unsign method: >>> original = signer . unsign ( value ) >>> original 'My string' If you pass a non-string value to sign , the value will be forced to string\nbefore being signed, and the unsign result will give you that string\nvalue: >>> signed = signer . sign ( 2.5 ) >>> original = signer . unsign ( signed ) >>> original '2.5' If you wish to protect a list, tuple, or dictionary you can do so using the sign_object() and unsign_object() methods: >>> signed_obj = signer . sign_object ({ \"message\" : \"Hello!\" }) >>> signed_obj 'eyJtZXNzYWdlIjoiSGVsbG8hIn0:Xdc-mOFDjs22KsQAqfVfi8PQSPdo3ckWJxPWwQOFhR4' >>> obj = signer . unsign_object ( signed_obj ) >>> obj {'message': 'Hello!'} See Protecting complex data structures for more details. If the signature or value have been altered in any way, a django.core.signing.BadSignature exception will be raised: >>> from django.core import signing >>> value += \"m\" >>> try : ... original = signer . unsign ( value ) ... except signing . BadSignature : ... print ( \"Tampering detected!\" ) ... By default, the Signer class uses the SECRET_KEY setting to\ngenerate signatures. You can use a different secret by passing it to the Signer constructor: >>> signer = Signer ( key = \"my-other-secret\" ) >>> value = signer . sign ( \"My string\" ) >>> value 'My string:EkfQJafvGyiofrdGnuthdxImIJw' class Signer ( * , key = None , sep = ':' , salt = None , algorithm = None , fallback_keys = None ) [source] ¶ Returns a signer which uses key to generate signatures and sep to\nseparate values. sep cannot be in the URL safe base64 alphabet . This alphabet contains alphanumeric characters, hyphens,\nand underscores. algorithm must be an algorithm supported by hashlib , it defaults to 'sha256' . fallback_keys is a list\nof additional values used to validate signed data, defaults to SECRET_KEY_FALLBACKS . Using the salt argument ¶ If you do not wish for every occurrence of a particular string to have the same\nsignature hash, you can use the optional salt argument to the Signer class. Using a salt will seed the signing hash function with both the salt and\nyour SECRET_KEY : >>> signer = Signer () >>> signer . sign ( \"My string\" ) 'My string:GdMGD6HNQ_qdgxYP8yBZAdAIV1w' >>> signer . sign_object ({ \"message\" : \"Hello!\" }) 'eyJtZXNzYWdlIjoiSGVsbG8hIn0:Xdc-mOFDjs22KsQAqfVfi8PQSPdo3ckWJxPWwQOFhR4' >>> signer = Signer ( salt = \"extra\" ) >>> signer . sign ( \"My string\" ) 'My string:Ee7vGi-ING6n02gkcJ-QLHg6vFw' >>> signer . unsign ( \"My string:Ee7vGi-ING6n02gkcJ-QLHg6vFw\" ) 'My string' >>> signer . sign_object ({ \"message\" : \"Hello!\" }) 'eyJtZXNzYWdlIjoiSGVsbG8hIn0:-UWSLCE-oUAHzhkHviYz3SOZYBjFKllEOyVZNuUtM-I' >>> signer . unsign_object ( ... \"eyJtZXNzYWdlIjoiSGVsbG8hIn0:-UWSLCE-oUAHzhkHviYz3SOZYBjFKllEOyVZNuUtM-I\" ... ) {'message': 'Hello!'} Using salt in this way puts the different signatures into different\nnamespaces.  A signature that comes from one namespace (a particular salt\nvalue) cannot be used to validate the same plaintext string in a different\nnamespace that is using a different salt setting. The result is to prevent an\nattacker from using a signed string generated in one place in the code as input\nto another piece of code that is generating (and verifying) signatures using a\ndifferent salt. Unlike your SECRET_KEY , your salt argument does not need to stay\nsecret. Verifying timestamped values ¶ TimestampSigner is a subclass of Signer that appends a signed\ntimestamp to the value. This allows you to confirm that a signed value was\ncreated within a specified period of time: >>> from datetime import timedelta >>> from django.core.signing import TimestampSigner >>> signer = TimestampSigner () >>> value = signer . sign ( \"hello\" ) >>> value 'hello:1NMg5H:oPVuCqlJWmChm1rA2lyTUtelC-c' >>> signer . unsign ( value ) 'hello' >>> signer . unsign ( value , max_age = 10 ) SignatureExpired: Signature age 15.5289158821 > 10 seconds >>> signer . unsign ( value , max_age = 20 ) 'hello' >>> signer . unsign ( value , max_age = timedelta ( seconds = 20 )) 'hello' class TimestampSigner ( * , key = None , sep = ':' , salt = None , algorithm = 'sha256' ) [source] ¶ sign ( value ) [source] ¶ Sign value and append current timestamp to it. unsign ( value , max_age = None ) [source] ¶ Checks if value was signed less than max_age seconds ago,\notherwise raises SignatureExpired . The max_age parameter can\naccept an integer or a datetime.timedelta object. sign_object ( obj , serializer = JSONSerializer , compress = False ) ¶ Encode, optionally compress, append current timestamp, and sign complex\ndata structure (e.g. list, tuple, or dictionary). unsign_object ( signed_obj , serializer = JSONSerializer , max_age = None ) ¶ Checks if signed_obj was signed less than max_age seconds ago,\notherwise raises SignatureExpired . The max_age parameter can\naccept an integer or a datetime.timedelta object. Protecting complex data structures ¶ If you wish to protect a list, tuple or dictionary you can do so using the Signer.sign_object() and unsign_object() methods, or signing module’s dumps() or loads() functions (which are shortcuts for TimestampSigner(salt='django.core.signing').sign_object()/unsign_object() ).\nThese use JSON serialization under the hood. JSON ensures that even if your SECRET_KEY is stolen an attacker will not be able to execute\narbitrary commands by exploiting the pickle format: >>> from django.core import signing >>> signer = signing . TimestampSigner () >>> value = signer . sign_object ({ \"foo\" : \"bar\" }) >>> value 'eyJmb28iOiJiYXIifQ:1kx6R3:D4qGKiptAqo5QW9iv4eNLc6xl4RwiFfes6oOcYhkYnc' >>> signer . unsign_object ( value ) {'foo': 'bar'} >>> value = signing . dumps ({ \"foo\" : \"bar\" }) >>> value 'eyJmb28iOiJiYXIifQ:1kx6Rf:LBB39RQmME-SRvilheUe5EmPYRbuDBgQp2tCAi7KGLk' >>> signing . loads ( value ) {'foo': 'bar'} Because of the nature of JSON (there is no native distinction between lists\nand tuples) if you pass in a tuple, you will get a list from signing.loads(object) : >>> from django.core import signing >>> value = signing . dumps (( \"a\" , \"b\" , \"c\" )) >>> signing . loads ( value ) ['a', 'b', 'c'] dumps ( obj , key = None , salt = 'django.core.signing' , serializer = JSONSerializer , compress = False ) [source] ¶ Returns URL-safe, signed base64 compressed JSON string. Serialized object\nis signed using TimestampSigner . loads ( string , key = None , salt = 'django.core.signing' , serializer = JSONSerializer , max_age = None , fallback_keys = None ) [source] ¶ Reverse of dumps() , raises BadSignature if signature fails.\nChecks max_age (in seconds) if given.", "keywords": ["function", "users", "result", "knowledge", "verifying", "distinction", "xdc", "underscores", "signing", "serializer", "hello:1nmg5h", "url", "nature", "module", "code", "values", "secret", "algorithm", "period", "secret_key_fallbacks", "string", "c", "access", "class", "example", "i", "lists", "django.core", "alphabet", "m", "signed_obj", "serialization", "list", "mofdjs22ksqaqfvfi8pqspdo3ckwjxpwwqofhr4", "sep", "returns", "'", "seconds", "ekfqjafvgyiofrdgnuthdximijw", "timestamp", "timestampsigner(salt='django.core.signing').sign_object()/unsign_object", "+", "base64", "ing6n02gkcj", "structures", "input", "*", "medium", "commands", "level", "json", "hyphens", "subclass", "colon", "eyjtzxnzywdlijoisgvsbg8hin0:-uwslce", "place", "application", "namespace", "django", "hash", "=", "fields", "print", "ee7vgi", "message", "occurrence", "value", "jsonserializer", "eyjmb28ioijiyxiifq:1kx6r3", "source", "keys", "channel", "data", "salt", "dumps", "sources", "hashlib", "sha256", "tuple", "srvilheue5empyrbudbgqp2tcai7kglk", "following", "sign_object", "security", "tampering", "badsignature", "eyjmb28ioijiyxiifq:1kx6rf", "qlhg6vfw", "instance", "end", "datetime.timedelta", "file", "startproject", "tuples", "timestampsigner", "signature", "secret_key", "default", "signing.loads(object", "bar", "user", "attackers", "functions", "key", "max_age", "form", "ouahzhkhviyz3sozybjfklleoyvznuutm", "shortcuts", "timedelta", "none", "pickle", "format", "characters", "sign", "time", "constructor", "opvucqljwmchm1ra2lytutelc", "signatures", "signer", "structure", "urls", "account", "api", "loads", "cookies", "object", "signer.sign_object", "-", "password", "import", "hood", "parameter", "rule", "namespaces", "defaults", "dictionary", "way", "unsign", "web", "d4qgkiptaqo5qw9iv4enlc6xl4rwiffes6oocyhkync", "checks", "django.core.signing", "age", "signatureexpired", "methods", "resource", "exception", "details", "method", "integer", "uses", "argument", "piece", "¶", "obj", "attacker", "encode", "reverse", "applications", "foo", "gdmgd6hnq_qdgxyp8ybzadaiv1w", "project"], "type": "documentation"},
{"title": "Signals | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/signals/", "content": "Signals ¶ A list of all the signals that Django sends. All built-in signals are sent\nusing the send() method. See also See the documentation on the signal dispatcher for\ninformation regarding how to register for and receive signals. The authentication framework sends signals when\na user is logged in / out . Model signals ¶ The django.db.models.signals module defines a set of signals sent by the\nmodel system. Warning Signals can make your code harder to maintain. Consider implementing a\nhelper method on a custom manager , to\nboth update your models and perform additional logic, or else overriding model methods before using\nmodel signals. Warning Many of these signals are sent by various model methods like __init__() or save() that you can\noverride in your own code. If you override these methods on your model, you must call the parent class’\nmethods for these signals to be sent. Note also that Django stores signal handlers as weak references by default,\nso if your handler is a local function, it may be garbage collected.  To\nprevent this, pass weak=False when you call the signal’s connect() . Note Model signals sender model can be lazily referenced when connecting a\nreceiver by specifying its full application label. For example, an Question model defined in the polls application could be referenced\nas 'polls.Question' . This sort of reference can be quite handy when\ndealing with circular import dependencies and swappable models. pre_init ¶ django.db.models.signals. pre_init ¶ Whenever you instantiate a Django model, this signal is sent at the beginning\nof the model’s __init__() method. Arguments sent with this signal: sender The model class that just had an instance created. args A list of positional arguments passed to __init__() . kwargs A dictionary of keyword arguments passed to __init__() . For example, the tutorial has this line: q = Question ( question_text = \"What's new?\" , pub_date = timezone . now ()) The arguments sent to a pre_init handler would be: Argument Value sender Question (the class itself) args [] (an empty list because there were no positional\narguments passed to __init__() ) kwargs {'question_text': \"What's new?\", 'pub_date': datetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=datetime.timezone.utc)} post_init ¶ django.db.models.signals. post_init ¶ Like pre_init, but this one is sent when the __init__() method finishes. Arguments sent with this signal: sender As above: the model class that just had an instance created. instance The actual instance of the model that’s just been created. Note instance._state isn’t set\nbefore sending the post_init signal, so _state attributes\nalways have their default values. For example, _state.db is None . Warning For performance reasons, you shouldn’t perform queries in receivers of pre_init or post_init signals because they would be executed for\neach instance returned during queryset iteration. pre_save ¶ django.db.models.signals. pre_save ¶ This is sent at the beginning of a model’s save() method. Arguments sent with this signal: sender The model class. instance The actual instance being saved. raw A boolean; True if the model is saved exactly as presented\n(i.e. when loading a fixture ). One should not\nquery/modify other records in the database as the database might not be in\na consistent state yet. using The database alias being used. update_fields The set of fields to update as passed to Model.save() , or None if update_fields wasn’t passed to save() . post_save ¶ django.db.models.signals. post_save ¶ Like pre_save , but sent at the end of the save() method. Arguments sent with this signal: sender The model class. instance The actual instance being saved. created A boolean; True if a new record was created. raw A boolean; True if the model is saved exactly as presented\n(i.e. when loading a fixture ). One should not\nquery/modify other records in the database as the database might not be in\na consistent state yet. using The database alias being used. update_fields The set of fields to update as passed to Model.save() , or None if update_fields wasn’t passed to save() . pre_delete ¶ django.db.models.signals. pre_delete ¶ Sent at the beginning of a model’s delete() method and a queryset’s delete() method. Arguments sent with this signal: sender The model class. instance The actual instance being deleted. using The database alias being used. origin The origin of the deletion being the instance of a Model or QuerySet class. post_delete ¶ django.db.models.signals. post_delete ¶ Like pre_delete , but sent at the end of a model’s delete() method and a queryset’s delete() method. Arguments sent with this signal: sender The model class. instance The actual instance being deleted. Note that the object will no longer be in the database, so be very\ncareful what you do with this instance. using The database alias being used. origin The origin of the deletion being the instance of a Model or QuerySet class. m2m_changed ¶ django.db.models.signals. m2m_changed ¶ Sent when a ManyToManyField is changed on a model\ninstance. Strictly speaking, this is not a model signal since it is sent by the ManyToManyField , but since it complements the pre_save / post_save and pre_delete / post_delete when it comes to tracking changes to models, it is included here. Arguments sent with this signal: sender The intermediate model class describing the ManyToManyField . This class is automatically\ncreated when a many-to-many field is defined; you can access it using the through attribute on the many-to-many field. instance The instance whose many-to-many relation is updated. This can be an\ninstance of the sender , or of the class the ManyToManyField is related to. action A string indicating the type of update that is done on the relation.\nThis can be one of the following: \"pre_add\" Sent before one or more objects are added to the relation. \"post_add\" Sent after one or more objects are added to the relation. \"pre_remove\" Sent before one or more objects are removed from the relation. \"post_remove\" Sent after one or more objects are removed from the relation. \"pre_clear\" Sent before the relation is cleared. \"post_clear\" Sent after the relation is cleared. reverse Indicates which side of the relation is updated (i.e., if it is the\nforward or reverse relation that is being modified). model The class of the objects that are added to, removed from or cleared\nfrom the relation. pk_set For the pre_add and post_add actions, this is a set of primary key\nvalues that will be, or have been, added to the relation. This may be a\nsubset of the values submitted to be added, since inserts must filter\nexisting values in order to avoid a database IntegrityError . For the pre_remove and post_remove actions, this is a set of\nprimary key values that was submitted to be removed from the relation. This\nis not dependent on whether the values actually will be, or have been,\nremoved. In particular, non-existent values may be submitted, and will\nappear in pk_set , even though they have no effect on the database. For the pre_clear and post_clear actions, this is None . using The database alias being used. For example, if a Pizza can have multiple Topping objects, modeled\nlike this: class Topping ( models . Model ): # ... pass class Pizza ( models . Model ): # ... toppings = models . ManyToManyField ( Topping ) If we connected a handler like this: from django.db.models.signals import m2m_changed def toppings_changed ( sender , ** kwargs ): # Do something pass m2m_changed . connect ( toppings_changed , sender = Pizza . toppings . through ) and then did something like this: >>> p = Pizza . objects . create ( ... ) >>> t = Topping . objects . create ( ... ) >>> p . toppings . add ( t ) the arguments sent to a m2m_changed handler ( toppings_changed in\nthe example above) would be: Argument Value sender Pizza.toppings.through (the intermediate m2m class) instance p (the Pizza instance being modified) action \"pre_add\" (followed by a separate signal with \"post_add\" ) reverse False ( Pizza contains the ManyToManyField , so this call\nmodifies the forward relation) model Topping (the class of the objects added to the Pizza ) pk_set {t.id} (since only Topping t was added to the relation) using \"default\" (since the default router sends writes here) And if we would then do something like this: >>> t . pizza_set . remove ( p ) the arguments sent to a m2m_changed handler would be: Argument Value sender Pizza.toppings.through (the intermediate m2m class) instance t (the Topping instance being modified) action \"pre_remove\" (followed by a separate signal with \"post_remove\" ) reverse True ( Pizza contains the ManyToManyField , so this call\nmodifies the reverse relation) model Pizza (the class of the objects removed from the Topping ) pk_set {p.id} (since only Pizza p was removed from the\nrelation) using \"default\" (since the default router sends writes here) class_prepared ¶ django.db.models.signals. class_prepared ¶ Sent whenever a model class has been “prepared” – that is, once a model has\nbeen defined and registered with Django’s model system. Django uses this\nsignal internally; it’s not generally used in third-party applications. Since this signal is sent during the app registry population process, and AppConfig.ready() runs after the app\nregistry is fully populated, receivers cannot be connected in that method.\nOne possibility is to connect them AppConfig.__init__() instead, taking\ncare not to import models or trigger calls to the app registry. Arguments that are sent with this signal: sender The model class which was just prepared. Management signals ¶ Signals sent by django-admin . pre_migrate ¶ django.db.models.signals. pre_migrate ¶ Sent by the migrate command before it starts to install an\napplication. It’s not emitted for applications that lack a models module. Arguments sent with this signal: sender An AppConfig instance for the application about to\nbe migrated/synced. app_config Same as sender . verbosity Indicates how much information manage.py is printing on screen. See\nthe --verbosity flag for details. Functions which listen for pre_migrate should adjust what they\noutput to the screen based on the value of this argument. interactive If interactive is True , it’s safe to prompt the user to input\nthings on the command line. If interactive is False , functions\nwhich listen for this signal should not try to prompt for anything. For example, the django.contrib.auth app only prompts to create a\nsuperuser when interactive is True . stdout A stream-like object where verbose output should be redirected. using The alias of database on which a command will operate. plan The migration plan that is going to be used for the migration run. While\nthe plan is not public API, this allows for the rare cases when it is\nnecessary to know the plan. A plan is a list of 2-tuples with the first\nitem being the instance of a migration class and the second item showing\nif the migration was rolled back ( True ) or applied ( False ). apps An instance of Apps containing the state of the\nproject before the migration run. It should be used instead of the global apps registry to retrieve the models you\nwant to perform operations on. post_migrate ¶ django.db.models.signals. post_migrate ¶ Sent at the end of the migrate (even if no migrations are run) and flush commands. It’s not emitted for applications that lack a models module. Handlers of this signal must not perform database schema alterations as doing\nso may cause the flush command to fail if it runs during the migrate command. Arguments sent with this signal: sender An AppConfig instance for the application that was\njust installed. app_config Same as sender . verbosity Indicates how much information manage.py is printing on screen. See\nthe --verbosity flag for details. Functions which listen for post_migrate should adjust what they\noutput to the screen based on the value of this argument. interactive If interactive is True , it’s safe to prompt the user to input\nthings on the command line. If interactive is False , functions\nwhich listen for this signal should not try to prompt for anything. For example, the django.contrib.auth app only prompts to create a\nsuperuser when interactive is True . stdout A stream-like object where verbose output should be redirected. using The database alias used for synchronization. Defaults to the default database. plan The migration plan that was used for the migration run. While the plan is\nnot public API, this allows for the rare cases when it is necessary to\nknow the plan. A plan is a list of 2-tuples with the first item being\nthe instance of a migration class and the second item showing if the\nmigration was rolled back ( True ) or applied ( False ). apps An instance of Apps containing the state of the\nproject after the migration run. It should be used instead of the global apps registry to retrieve the models you\nwant to perform operations on. For example, you could register a callback in an AppConfig like this: from django.apps import AppConfig from django.db.models.signals import post_migrate def my_callback ( sender , ** kwargs ): # Your specific logic here pass class MyAppConfig ( AppConfig ): ... def ready ( self ): post_migrate . connect ( my_callback , sender = self ) Note If you provide an AppConfig instance as the sender\nargument, please ensure that the signal is registered in ready() . AppConfig s are recreated for\ntests that run with a modified set of INSTALLED_APPS (such as\nwhen settings are overridden) and such signals should be connected for each\nnew AppConfig instance. Request/response signals ¶ Signals sent by the core framework when processing a request. Warning Signals can make your code harder to maintain. Consider using a\nmiddleware before using request/response\nsignals. request_started ¶ django.core.signals. request_started ¶ Sent when Django begins processing an HTTP request. Arguments sent with this signal: sender The handler class – e.g. django.core.handlers.wsgi.WsgiHandler – that\nhandled the request. environ The environ dictionary provided to the request. request_finished ¶ django.core.signals. request_finished ¶ Sent when Django finishes delivering an HTTP response to the client. Arguments sent with this signal: sender The handler class, as above. got_request_exception ¶ django.core.signals. got_request_exception ¶ This signal is sent whenever Django encounters an exception while processing an incoming HTTP request. Arguments sent with this signal: sender Unused (always None ). request The HttpRequest object. Test signals ¶ Signals only sent when running tests . setting_changed ¶ django.test.signals. setting_changed ¶ This signal is sent when the value of a setting is changed through the django.test.TestCase.settings() context manager or the django.test.override_settings() decorator/context manager. It’s actually sent twice: when the new value is applied (“setup”) and when the\noriginal value is restored (“teardown”). Use the enter argument to\ndistinguish between the two. You can also import this signal from django.core.signals to avoid importing\nfrom django.test in non-test situations. Arguments sent with this signal: sender The settings handler. setting The name of the setting. value The value of the setting after the change. For settings that initially\ndon’t exist, in the “teardown” phase, value is None . enter A boolean; True if the setting is applied, False if restored. template_rendered ¶ django.test.signals. template_rendered ¶ Sent when the test system renders a template. This signal is not emitted during\nnormal operation of a Django server – it is only available during testing. Arguments sent with this signal: sender The Template object which was rendered. template Same as sender context The Context with which the template was\nrendered. Database Wrappers ¶ Signals sent by the database wrapper when a database connection is\ninitiated. connection_created ¶ django.db.backends.signals. connection_created ¶ Sent when the database wrapper makes the initial connection to the\ndatabase.  This is particularly useful if you’d like to send any post\nconnection commands to the SQL backend. Arguments sent with this signal: sender The database wrapper class – i.e. django.db.backends.postgresql.DatabaseWrapper or django.db.backends.mysql.DatabaseWrapper , etc. connection The database connection that was opened. This can be used in a\nmultiple-database configuration to differentiate connection signals\nfrom different databases.", "keywords": ["function", "question", "question_text", "testing", "pre_save", "send", "run", "verbose", "population", "receiver", "wrapper", "pre_migrate", "finishes", "plan", "model.save", "app_config", "def", "module", "code", "databasewrapper", "values", "my_callback", "post_migrate", "string", "false", "class", "sender", "example", "_", "field", "#", "pizza_set", "app", "care", "migration", "relation", "m", "record", "list", "migrations", "'", "django.apps", "databases", "appconfig.__init", "request", "stores", "database", "flag", "output", "action", "signal", "models", "query", "test", "subset", "commands", "migrate", "phase", "model", "receivers", "reasons", "admin", "change", "pk_set", "application", "actions", "attributes", "label", "registry", "django.db.backends.signals", "sort", "django", "t.id", "django.test.override_settings", "http", "configuration", "=", "changes", "n’t", "fields", "pre_init", "stream", "set", "django.db.models.signals", "p", "pre_remove", "toppings", "value", "topping", "m2", "setup", "line", "wrappers", "post_init", "boolean", "process", "authentication", "router", "post_add", "handler", "prompts", "item", "django.test.signals", "django.db.backends.postgresql", "backend", "out", "pre_add", "post_save", "screen", "post_remove", "django.test.testcase.settings", "server", "arguments", "origin", "django.db.backends.mysql", "type", "init", "alterations", "middleware", "one", "calls", "custom", "instance", "kwargs", "performance", "documentation", "end", "objects", "self", "pub_date", "records", "core", "tuples", "delete", "verbosity", "operation", "order", "default", "user", "post_delete", "unused", "got_request_exception", "pre_clear", "cases", "functions", "wsgihandler", "alias", "operations", "synchronization", "appconfig", "update", "signals", "helper", "attribute", "datetime.datetime(2012", "args", "none", "garbage", "callback", "tests", "decorator", "warning", "environ", "superuser", "writes", "pizza", "framework", "save", "pizza.toppings.through", "setting", "fixture", "timezone", "tzinfo", "api", "installed_apps", "references", "polls", "object", "things", "-", "connection", "context", "runs", "logic", "teardown", "import", "name", "httprequest", "template", "iteration", "manytomanyfield", "management", "response", "dictionary", "defaults", "call", "schema", "sent", "update_fields", "django.core.signals", "sql", "information", "reference", "situations", "django.contrib.auth", "methods", "keyword", "trigger", "dispatcher", "queries", "t", "exception", "possibility", "client", "manager", "details", "inserts", "method", "queryset", "party", "settings", "argument", "integrityerror", "¶", "command", "reverse", "handlers", "note", "deletion", "connect", "state", "applications", "tutorial", "effect", "connection_created", "system", "apps", "pre_delete", "parent", "side", "beginning", "toppings_changed", "dependencies", "project"], "type": "documentation"},
{"title": "File handling | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/files/", "content": "File handling ¶ The File object The File class The ContentFile class The ImageFile class Additional methods on files attached to objects File storage API Getting the default storage class The FileSystemStorage class The InMemoryStorage class The Storage class Uploaded Files and Upload Handlers Uploaded files Built-in upload handlers Writing custom upload handlers", "keywords": ["custom", "object", "file", "upload", "imagefile", "contentfile", "default", "files", "storage", "uploaded", "¶", "api", "methods", "objects", "filesystemstorage", "handlers", "class"], "type": "documentation"},
{"title": "System check framework | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/checks/", "content": "System check framework ¶ The system check framework is a set of static checks for validating Django\nprojects. It detects common problems and provides hints for how to fix them.\nThe framework is extensible so you can easily add your own checks. Checks can be triggered explicitly via the check command. Checks are\ntriggered implicitly before most commands, including runserver and migrate . For performance reasons, checks are not run as part of the\nWSGI stack that is used in deployment. If you need to run system checks on your\ndeployment server, trigger them explicitly using check . Serious errors will prevent Django commands (such as runserver ) from\nrunning at all. Minor problems are reported to the console. If you have inspected\nthe cause of a warning and are happy to ignore it, you can hide specific warnings\nusing the SILENCED_SYSTEM_CHECKS setting in your project settings file. A full list of all checks that can be raised by Django can be found in the System check reference . Writing your own checks ¶ The framework is flexible and allows you to write functions that perform\nany other kind of check you may require. The following is an example stub\ncheck function: from django.core.checks import Error , register @register () def example_check ( app_configs , ** kwargs ): errors = [] # ... your check logic here if check_failed : errors . append ( Error ( \"an error\" , hint = \"A hint.\" , obj = checked_object , id = \"myapp.E001\" , ) ) return errors The check function must accept an app_configs argument; this argument is\nthe list of applications that should be inspected. If None , the check must\nbe run on all installed apps in the project. The check will receive a databases keyword argument. This is a list of\ndatabase aliases whose connections may be used to inspect database level\nconfiguration. If databases is None , the check must not use any\ndatabase connections. The **kwargs argument is required for future expansion. Messages ¶ The function must return a list of messages. If no problems are found as a result\nof the check, the check function must return an empty list. The warnings and errors raised by the check method must be instances of CheckMessage . An instance of CheckMessage encapsulates a single reportable\nerror or warning. It also provides context and hints applicable to the\nmessage, and a unique identifier that is used for filtering purposes. The concept is very similar to messages from the message framework or the logging framework .\nMessages are tagged with a level indicating the severity of the message. There are also shortcuts to make creating messages with common levels easier.\nWhen using these classes you can omit the level argument because it is\nimplied by the class name. Debug Info Warning Error Critical Registering and labeling checks ¶ Lastly, your check function must be registered explicitly with system check\nregistry. Checks should be registered in a file that’s loaded when your\napplication is loaded; for example, in the AppConfig.ready() method. register ( *tags)(function ) ¶ You can pass as many tags to register as you want in order to label your\ncheck. Tagging checks is useful since it allows you to run only a certain\ngroup of checks. For example, to register a compatibility check, you would\nmake the following call: from django.core.checks import register , Tags @register ( Tags . compatibility ) def my_check ( app_configs , ** kwargs ): # ... perform compatibility checks and collect errors return errors You can register “deployment checks” that are only relevant to a production\nsettings file like this: @register ( Tags . security , deploy = True ) def my_check ( app_configs , ** kwargs ): ... These checks will only be run if the check --deploy option is used. You can also use register as a function rather than a decorator by\npassing a callable object (usually a function) as the first argument\nto register . The code below is equivalent to the code above: def my_check ( app_configs , ** kwargs ): ... register ( my_check , Tags . security , deploy = True ) Field, model, manager, template engine, and database checks ¶ In some cases, you won’t need to register your check function – you can\npiggyback on an existing registration. Fields, models, model managers, template engines, and database backends all\nimplement a check() method that is already registered with the check\nframework. If you want to add extra checks, you can extend the implementation\non the base class, perform any extra checks you need, and append any messages\nto those generated by the base class. It’s recommended that you delegate each\ncheck to separate methods. Consider an example where you are implementing a custom field named RangedIntegerField . This field adds min and max arguments to the\nconstructor of IntegerField . You may want to add a check to ensure that users\nprovide a min value that is less than or equal to the max value. The following\ncode snippet shows how you can implement this check: from django.core import checks from django.db import models class RangedIntegerField ( models . IntegerField ): def __init__ ( self , min = None , max = None , ** kwargs ): super () . __init__ ( ** kwargs ) self . min = min self . max = max def check ( self , ** kwargs ): # Call the superclass errors = super () . check ( ** kwargs ) # Do some custom checks and add messages to `errors`: errors . extend ( self . _check_min_max_values ( ** kwargs )) # Return all errors and warnings return errors def _check_min_max_values ( self , ** kwargs ): if self . min is not None and self . max is not None and self . min > self . max : return [ checks . Error ( \"min greater than max.\" , hint = \"Decrease min or increase max.\" , obj = self , id = \"myapp.E001\" , ) ] # When no error, return an empty list return [] If you wanted to add checks to a model manager, you would take the same\napproach on your subclass of Manager . If you want to add a check to a model class, the approach is almost the same:\nthe only difference is that the check is a classmethod, not an instance method: class MyModel ( models . Model ): @classmethod def check ( cls , ** kwargs ): errors = super () . check ( ** kwargs ) # ... your own checks ... return errors Changed in Django 5.1: In older versions, template engines didn’t implement a check() method. Writing tests ¶ Messages are comparable. That allows you to easily write tests: from django.core.checks import Error errors = checked_object . check () expected_errors = [ Error ( \"an error\" , hint = \"A hint.\" , obj = checked_object , id = \"myapp.E001\" , ) ] self . assertEqual ( errors , expected_errors ) Writing integration tests ¶ Given the need to register certain checks when the application loads, it can be\nuseful to test their integration within the system checks framework. This can\nbe accomplished by using the call_command() function. For example, this test demonstrates that the SITE_ID setting must be\nan integer, a built-in check from the sites framework : from django.core.management import call_command from django.core.management.base import SystemCheckError from django.test import SimpleTestCase , modify_settings , override_settings class SystemCheckIntegrationTest ( SimpleTestCase ): @override_settings ( SITE_ID = \"non_integer\" ) @modify_settings ( INSTALLED_APPS = { \"prepend\" : \"django.contrib.sites\" }) def test_non_integer_site_id ( self ): message = \"(sites.E101) The SITE_ID setting must be an integer.\" with self . assertRaisesMessage ( SystemCheckError , message ): call_command ( \"check\" ) Consider the following check which issues a warning on deployment if a custom\nsetting named ENABLE_ANALYTICS is not set to True : from django.conf import settings from django.core.checks import Warning , register @register ( \"myapp\" , deploy = True ) def check_enable_analytics_is_true_on_deploy ( app_configs , ** kwargs ): errors = [] if getattr ( settings , \"ENABLE_ANALYTICS\" , None ) is not True : errors . append ( Warning ( \"The ENABLE_ANALYTICS setting should be set to True in deployment.\" , id = \"myapp.W001\" , ) ) return errors Given that this check will not raise a SystemCheckError , the presence of\nthe warning message in the stderr output can be asserted like so: from io import StringIO from django.core.management import call_command from django.test import SimpleTestCase , override_settings class EnableAnalyticsDeploymentCheckTest ( SimpleTestCase ): @override_settings ( ENABLE_ANALYTICS = None ) def test_when_set_to_none ( self ): stderr = StringIO () call_command ( \"check\" , \"-t\" , \"myapp\" , \"--deploy\" , stderr = stderr ) message = ( \"(myapp.W001) The ENABLE_ANALYTICS setting should be set \" \"to True in deployment.\" ) self . assertIn ( message , stderr . getvalue ())", "keywords": ["function", "users", "mymodel", "result", "production", "integerfield", "aliases", "messages", "error", "def", "check", "difference", "code", "classmethod", "info", "i", "class", "example", "field", "#", "django.core", "systemcheckerror", "group", "warnings", "list", "databases", "connections", "snippet", "stringio", "runserver", "managers", "w001", "database", "check_failed", "output", "*", "models", "stack", "test", "commands", "compatibility", "migrate", "level", "django.core.checks", "model", "@register", "subclass", "reasons", "silenced_system_checks", "application", "registry", "presence", "approach", "django", "wsgi", "configuration", "=", "myapp", "fields", "engine", "check_enable_analytics_is_true_on_deploy", "message", "min", "set", "superclass", "django.contrib.sites", "e001", "call_command", "critical", "value", "modify_settings", "append", "test_non_integer_site_id", "rangedintegerfield", "implementation", "debug", "base", "errors", "assertin", "server", "arguments", "identifier", "following", "security", "init", "engines", "check_min_max_values", "self", "need", "performance", "stub", "kwargs", "instance", "custom", "stderr", "app_configs", "file", "levels", "order", "labeling", "kind", "severity", "cases", "functions", "none", "option", "classes", "tests", "decorator", "warning", "constructor", "tags", "framework", "instances", "setting", "checkmessage", "purposes", "@override_settings", "loads", "part", "installed_apps", "hint", "projects", "object", "e101", "getattr", "registering", "enableanalyticsdeploymentchecktest", "deployment", "context", "logic", "decrease", "import", "checked_object", "name", "d", "expected_errors", "template", "tags)(function", "assertraisesmessage", "hints", "call", "site_id", "prepend", "my_check", "console", "reference", "backends", "super", "cause", "checks", "systemcheckintegrationtest", "problems", "keyword", "register", "methods", "versions", "@modify_settings", "io", "simpletestcase", "concept", "max", "manager", "@classmethod", "method", "registration", "integer", "integration", "settings", "argument", "obj", "¶", "command", "return", "getvalue", "applications", "sites", "system", "apps", "expansion", "project"], "type": "documentation"},
{"title": "The syndication feed framework | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/syndication/", "content": "The syndication feed framework ¶ Django comes with a high-level syndication-feed-generating framework for\ncreating RSS and Atom feeds. To create any syndication feed, all you have to do is write a short\nPython class. You can create as many feeds as you want. Django also comes with a lower-level feed-generating API. Use this if\nyou want to generate feeds outside of a web context, or in some other\nlower-level way. The high-level framework ¶ Overview ¶ The high-level feed-generating framework is supplied by the Feed class. To create a\nfeed, write a Feed class\nand point to an instance of it in your URLconf . Feed classes ¶ A Feed class is a Python\nclass that represents a syndication feed. A feed can be simple (e.g.,\na “site news” feed, or a basic feed displaying the latest entries of a\nblog) or more complex (e.g., a feed displaying all the blog entries in\na particular category, where the category is variable). Feed classes subclass django.contrib.syndication.views.Feed .\nThey can live anywhere in your codebase. Instances of Feed classes\nare views which can be used in your URLconf . A simple example ¶ This simple example, taken from a hypothetical police beat news site describes\na feed of the latest five news items: from django.contrib.syndication.views import Feed from django.urls import reverse from policebeat.models import NewsItem class LatestEntriesFeed ( Feed ): title = \"Police beat site news\" link = \"/sitenews/\" description = \"Updates on changes and additions to police beat central.\" def items ( self ): return NewsItem . objects . order_by ( \"-pub_date\" )[: 5 ] def item_title ( self , item ): return item . title def item_description ( self , item ): return item . description # item_link is only needed if NewsItem has no get_absolute_url method. def item_link ( self , item ): return reverse ( \"news-item\" , args = [ item . pk ]) To connect a URL to this feed, put an instance of the Feed object in\nyour URLconf . For example: from django.urls import path from myproject.feeds import LatestEntriesFeed urlpatterns = [ # ... path ( \"latest/feed/\" , LatestEntriesFeed ()), # ... ] Note: The Feed class subclasses django.contrib.syndication.views.Feed . title , link and description correspond to the\nstandard RSS <title> , <link> and <description> elements,\nrespectively. items() is, a method that returns a list of objects that should be\nincluded in the feed as <item> elements. Although this example returns NewsItem objects using Django’s object-relational mapper , items() doesn’t have to return model instances.\nAlthough you get a few bits of functionality “for free” by using Django\nmodels, items() can return any type of object you want. If you’re creating an Atom feed, rather than an RSS feed, set the subtitle attribute instead of the description attribute.\nSee Publishing Atom and RSS feeds in tandem , later, for an example. One thing is left to do. In an RSS feed, each <item> has a <title> , <link> and <description> . We need to tell the framework what data to put\ninto those elements. For the contents of <title> and <description> , Django tries\ncalling the methods item_title() and item_description() on\nthe Feed class. They are passed\na single parameter, item , which is the object itself. These are\noptional; by default, the string representation of the object is used for\nboth. If you want to do any special formatting for either the title or\ndescription, Django templates can be used\ninstead. Their paths can be specified with the title_template and description_template attributes on the Feed class. The templates are\nrendered for each item and are passed two template context variables: {{ obj }} – The current object (one of whichever objects you\nreturned in items() ). {{ site }} – A django.contrib.sites.models.Site object\nrepresenting the current site. This is useful for {{ site.domain }} or {{ site.name }} . If you do not have the Django sites\nframework installed, this will be set to a RequestSite object. See the RequestSite section of the sites framework documentation for more. See a complex example below that uses a description template. Feed. get_context_data ( ** kwargs ) ¶ There is also a way to pass additional information to title and description\ntemplates, if you need to supply more than the two variables mentioned\nbefore. You can provide your implementation of get_context_data method\nin your Feed subclass. For example: from mysite.models import Article from django.contrib.syndication.views import Feed class ArticlesFeed ( Feed ): title = \"My articles\" description_template = \"feeds/articles.html\" def items ( self ): return Article . objects . order_by ( \"-pub_date\" )[: 5 ] def get_context_data ( self , ** kwargs ): context = super () . get_context_data ( ** kwargs ) context [ \"foo\" ] = \"bar\" return context And the template: Something about {{ foo }} : {{ obj.description }} This method will be called once per each item in the list returned by items() with the following keyword arguments: item : the current item. For backward compatibility reasons, the name\nof this context variable is {{ obj }} . obj : the object returned by get_object() . By default this is not\nexposed to the templates to avoid confusion with {{ obj }} (see above),\nbut you can use it in your implementation of get_context_data() . site : current site as described above. request : current request. The behavior of get_context_data() mimics that of generic views - you’re supposed to call super() to retrieve context data from parent class, add your data\nand return the modified dictionary. To specify the contents of <link> , you have two options. For each item\nin items() , Django first tries calling the item_link() method on the Feed class. In a similar way to\nthe title and description, it is passed it a single parameter, item . If that method doesn’t exist, Django tries executing a get_absolute_url() method on that object. Both get_absolute_url() and item_link() should return the\nitem’s URL as a normal Python string. As with get_absolute_url() , the\nresult of item_link() will be included directly in the URL, so you\nare responsible for doing all necessary URL quoting and conversion to\nASCII inside the method itself. A complex example ¶ The framework also supports more complex feeds, via arguments. For example, a website could offer an RSS feed of recent crimes for every\npolice beat in a city. It’d be silly to create a separate Feed class for each police beat; that\nwould violate the DRY principle and would couple data to\nprogramming logic. Instead, the syndication framework lets you access the\narguments passed from your URLconf so feeds can output\nitems based on information in the feed’s URL. The police beat feeds could be accessible via URLs like this: /beats/613/rss/ – Returns recent crimes for beat 613. /beats/1424/rss/ – Returns recent crimes for beat 1424. These can be matched with a URLconf line such as: path ( \"beats/<int:beat_id>/rss/\" , BeatFeed ()), Like a view, the arguments in the URL are passed to the get_object() method along with the request object. Here’s the code for these beat-specific feeds: from django.contrib.syndication.views import Feed class BeatFeed ( Feed ): description_template = \"feeds/beat_description.html\" def get_object ( self , request , beat_id ): return Beat . objects . get ( pk = beat_id ) def title ( self , obj ): return \"Police beat central: Crimes for beat %s \" % obj . beat def link ( self , obj ): return obj . get_absolute_url () def description ( self , obj ): return \"Crimes recently reported in police beat %s \" % obj . beat def items ( self , obj ): return Crime . objects . filter ( beat = obj ) . order_by ( \"-crime_date\" )[: 30 ] To generate the feed’s <title> , <link> and <description> , Django\nuses the title() , link() and description() methods. In\nthe previous example, they were string class attributes, but this example\nillustrates that they can be either strings or methods. For each of title , link and description , Django follows this\nalgorithm: First, it tries to call a method, passing the obj argument, where obj is the object returned by get_object() . Failing that, it tries to call a method with no arguments. Failing that, it uses the class attribute. Also note that items() also follows the same algorithm – first, it\ntries items(obj) , then items() , then finally an items class attribute (which should be a list). We are using a template for the item descriptions. It can be as minimal as\nthis: {{ obj.description }} However, you are free to add formatting as desired. The ExampleFeed class below gives full documentation on methods and\nattributes of Feed classes. Specifying the type of feed ¶ By default, feeds produced in this framework use RSS 2.0. To change that, add a feed_type attribute to your Feed class, like so: from django.utils.feedgenerator import Atom1Feed class MyFeed ( Feed ): feed_type = Atom1Feed Note that you set feed_type to a class object, not an instance. Currently available feed types are: django.utils.feedgenerator.Rss201rev2Feed (RSS 2.01. Default.) django.utils.feedgenerator.RssUserland091Feed (RSS 0.91.) django.utils.feedgenerator.Atom1Feed (Atom 1.0.) Enclosures ¶ To specify enclosures, such as those used in creating podcast feeds, use the item_enclosures hook or, alternatively and if you only have a single\nenclosure per item, the item_enclosure_url , item_enclosure_length , and item_enclosure_mime_type hooks. See the ExampleFeed class below for\nusage examples. Language ¶ Feeds created by the syndication framework automatically include the\nappropriate <language> tag (RSS 2.0) or xml:lang attribute (Atom). By\ndefault, this is django.utils.translation.get_language() . You can change it\nby setting the language class attribute. URLs ¶ The link method/attribute can return either an absolute path (e.g. \"/blog/\" ) or a URL with the fully-qualified domain and protocol (e.g. \"https://www.example.com/blog/\" ). If link doesn’t return the domain,\nthe syndication framework will insert the domain of the current site, according\nto your SITE_ID setting . Atom feeds require a <link rel=\"self\"> that defines the feed’s current\nlocation. The syndication framework populates this automatically, using the\ndomain of the current site according to the SITE_ID setting. Publishing Atom and RSS feeds in tandem ¶ Some developers like to make available both Atom and RSS versions of their\nfeeds. To do that, you can create a subclass of your Feed class and set the feed_type to something different. Then update your URLconf to add the extra versions. Here’s a full example: from django.contrib.syndication.views import Feed from policebeat.models import NewsItem from django.utils.feedgenerator import Atom1Feed class RssSiteNewsFeed ( Feed ): title = \"Police beat site news\" link = \"/sitenews/\" description = \"Updates on changes and additions to police beat central.\" def items ( self ): return NewsItem . objects . order_by ( \"-pub_date\" )[: 5 ] class AtomSiteNewsFeed ( RssSiteNewsFeed ): feed_type = Atom1Feed subtitle = RssSiteNewsFeed . description Note In this example, the RSS feed uses a description while the Atom\nfeed uses a subtitle . That’s because Atom feeds don’t provide for\na feed-level “description,” but they do provide for a “subtitle.” If you provide a description in your Feed class, Django will not automatically put that into the subtitle element, because a\nsubtitle and description are not necessarily the same thing. Instead, you\nshould define a subtitle attribute. In the above example, we set the Atom feed’s subtitle to the RSS feed’s description , because it’s quite short already. And the accompanying URLconf: from django.urls import path from myproject.feeds import AtomSiteNewsFeed , RssSiteNewsFeed urlpatterns = [ # ... path ( \"sitenews/rss/\" , RssSiteNewsFeed ()), path ( \"sitenews/atom/\" , AtomSiteNewsFeed ()), # ... ] Feed class reference ¶ class views. Feed ¶ This example illustrates all possible attributes and methods for a Feed class: from django.contrib.syndication.views import Feed from django.utils import feedgenerator class ExampleFeed ( Feed ): # FEED TYPE -- Optional. This should be a class that subclasses # django.utils.feedgenerator.SyndicationFeed. This designates # which type of feed this should be: RSS 2.0, Atom 1.0, etc. If # you don't specify feed_type, your feed will be RSS 2.0. This # should be a class, not an instance of the class. feed_type = feedgenerator . Rss201rev2Feed # TEMPLATE NAMES -- Optional. These should be strings # representing names of Django templates that the system should # use in rendering the title and description of your feed items. # Both are optional. If a template is not specified, the # item_title() or item_description() methods are used instead. title_template = None description_template = None # LANGUAGE -- Optional. This should be a string specifying a language # code. Defaults to django.utils.translation.get_language(). language = \"de\" # TITLE -- One of the following three is required. The framework # looks for them in this order. def title ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the feed's title as a normal Python string. \"\"\" def title ( self ): \"\"\" Returns the feed's title as a normal Python string. \"\"\" title = \"foo\" # Hard-coded title. # LINK -- One of the following three is required. The framework # looks for them in this order. def link ( self , obj ): \"\"\" # Takes the object returned by get_object() and returns the URL # of the HTML version of the feed as a normal Python string. \"\"\" def link ( self ): \"\"\" Returns the URL of the HTML version of the feed as a normal Python string. \"\"\" link = \"/blog/\" # Hard-coded URL. # FEED_URL -- One of the following three is optional. The framework # looks for them in this order. def feed_url ( self , obj ): \"\"\" # Takes the object returned by get_object() and returns the feed's # own URL as a normal Python string. \"\"\" def feed_url ( self ): \"\"\" Returns the feed's own URL as a normal Python string. \"\"\" feed_url = \"/blog/rss/\" # Hard-coded URL. # GUID -- One of the following three is optional. The framework looks # for them in this order. This property is only used for Atom feeds # (where it is the feed-level ID element). If not provided, the feed # link is used as the ID. def feed_guid ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the globally unique ID for the feed as a normal Python string. \"\"\" def feed_guid ( self ): \"\"\" Returns the feed's globally unique ID as a normal Python string. \"\"\" feed_guid = \"/foo/bar/1234\" # Hard-coded guid. # DESCRIPTION -- One of the following three is required. The framework # looks for them in this order. def description ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the feed's description as a normal Python string. \"\"\" def description ( self ): \"\"\" Returns the feed's description as a normal Python string. \"\"\" description = \"Foo bar baz.\" # Hard-coded description. # AUTHOR NAME --One of the following three is optional. The framework # looks for them in this order. def author_name ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the feed's author's name as a normal Python string. \"\"\" def author_name ( self ): \"\"\" Returns the feed's author's name as a normal Python string. \"\"\" author_name = \"Sally Smith\" # Hard-coded author name. # AUTHOR EMAIL --One of the following three is optional. The framework # looks for them in this order. def author_email ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the feed's author's email as a normal Python string. \"\"\" def author_email ( self ): \"\"\" Returns the feed's author's email as a normal Python string. \"\"\" author_email = \"test@example.com\" # Hard-coded author email. # AUTHOR LINK --One of the following three is optional. The framework # looks for them in this order. In each case, the URL should include # the scheme (such as \"https://\") and domain name. def author_link ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the feed's author's URL as a normal Python string. \"\"\" def author_link ( self ): \"\"\" Returns the feed's author's URL as a normal Python string. \"\"\" author_link = \"https://www.example.com/\" # Hard-coded author URL. # CATEGORIES -- One of the following three is optional. The framework # looks for them in this order. In each case, the method/attribute # should return an iterable object that returns strings. def categories ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the feed's categories as iterable over strings. \"\"\" def categories ( self ): \"\"\" Returns the feed's categories as iterable over strings. \"\"\" categories = [ \"python\" , \"django\" ] # Hard-coded list of categories. # COPYRIGHT NOTICE -- One of the following three is optional. The # framework looks for them in this order. def feed_copyright ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the feed's copyright notice as a normal Python string. \"\"\" def feed_copyright ( self ): \"\"\" Returns the feed's copyright notice as a normal Python string. \"\"\" feed_copyright = \"Copyright (c) 2007, Sally Smith\" # Hard-coded copyright notice. # TTL -- One of the following three is optional. The framework looks # for them in this order. Ignored for Atom feeds. def ttl ( self , obj ): \"\"\" Takes the object returned by get_object() and returns the feed's TTL (Time To Live) as a normal Python string. \"\"\" def ttl ( self ): \"\"\" Returns the feed's TTL as a normal Python string. \"\"\" ttl = 600 # Hard-coded Time To Live. # ITEMS -- One of the following three is required. The framework looks # for them in this order. def items ( self , obj ): \"\"\" Takes the object returned by get_object() and returns a list of items to publish in this feed. \"\"\" def items ( self ): \"\"\" Returns a list of items to publish in this feed. \"\"\" items = [ \"Item 1\" , \"Item 2\" ] # Hard-coded items. # GET_OBJECT -- This is required for feeds that publish different data # for different URL parameters. (See \"A complex example\" above.) def get_object ( self , request , * args , ** kwargs ): \"\"\" Takes the current request and the arguments from the URL, and returns an object represented by this feed. Raises django.core.exceptions.ObjectDoesNotExist on error. \"\"\" # ITEM TITLE AND DESCRIPTION -- If title_template or # description_template are not defined, these are used instead. Both are # optional, by default they will use the string representation of the # item. def item_title ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's title as a normal Python string. \"\"\" def item_title ( self ): \"\"\" Returns the title for every item in the feed. \"\"\" item_title = \"Breaking News: Nothing Happening\" # Hard-coded title. def item_description ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's description as a normal Python string. \"\"\" def item_description ( self ): \"\"\" Returns the description for every item in the feed. \"\"\" item_description = \"A description of the item.\" # Hard-coded description. def get_context_data ( self , ** kwargs ): \"\"\" Returns a dictionary to use as extra context if either description_template or item_template are used. Default implementation preserves the old behavior of using {'obj': item, 'site': current_site} as the context. \"\"\" # ITEM LINK -- One of these three is required. The framework looks for # them in this order. # First, the framework tries the two methods below, in # order. Failing that, it falls back to the get_absolute_url() # method on each item returned by items(). def item_link ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's URL. \"\"\" def item_link ( self ): \"\"\" Returns the URL for every item in the feed. \"\"\" # ITEM_GUID -- The following method is optional. If not provided, the # item's link is used by default. def item_guid ( self , obj ): \"\"\" Takes an item, as return by items(), and returns the item's ID. \"\"\" # ITEM_GUID_IS_PERMALINK -- The following method is optional. If # provided, it sets the 'isPermaLink' attribute of an item's # GUID element. This method is used only when 'item_guid' is # specified. def item_guid_is_permalink ( self , obj ): \"\"\" Takes an item, as returned by items(), and returns a boolean. \"\"\" item_guid_is_permalink = False # Hard coded value # ITEM AUTHOR NAME -- One of the following three is optional. The # framework looks for them in this order. def item_author_name ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's author's name as a normal Python string. \"\"\" def item_author_name ( self ): \"\"\" Returns the author name for every item in the feed. \"\"\" item_author_name = \"Sally Smith\" # Hard-coded author name. # ITEM AUTHOR EMAIL --One of the following three is optional. The # framework looks for them in this order. # # If you specify this, you must specify item_author_name. def item_author_email ( self , obj ): \"\"\" Takes an item, as returned by items(), and returns the item's author's email as a normal Python string. \"\"\" def item_author_email ( self ): \"\"\" Returns the author email for every item in the feed. \"\"\" item_author_email = \"test@example.com\" # Hard-coded author email. # ITEM AUTHOR LINK -- One of the following three is optional. The # framework looks for them in this order. In each case, the URL should # include the scheme (such as \"https://\") and domain name. # # If you specify this, you must specify item_author_name. def item_author_link ( self , obj ): \"\"\" Takes an item, as returned by items(), and returns the item's author's URL as a normal Python string. \"\"\" def item_author_link ( self ): \"\"\" Returns the author URL for every item in the feed. \"\"\" item_author_link = \"https://www.example.com/\" # Hard-coded author URL. # ITEM ENCLOSURES -- One of the following three is optional. The # framework looks for them in this order. If one of them is defined, # ``item_enclosure_url``, ``item_enclosure_length``, and # ``item_enclosure_mime_type`` will have no effect. def item_enclosures ( self , item ): \"\"\" Takes an item, as returned by items(), and returns a list of ``django.utils.feedgenerator.Enclosure`` objects. \"\"\" def item_enclosures ( self ): \"\"\" Returns the ``django.utils.feedgenerator.Enclosure`` list for every item in the feed. \"\"\" item_enclosures = [] # Hard-coded enclosure list # ITEM ENCLOSURE URL -- One of these three is required if you're # publishing enclosures and you're not using ``item_enclosures``. The # framework looks for them in this order. def item_enclosure_url ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's enclosure URL. \"\"\" def item_enclosure_url ( self ): \"\"\" Returns the enclosure URL for every item in the feed. \"\"\" item_enclosure_url = \"/foo/bar.mp3\" # Hard-coded enclosure link. # ITEM ENCLOSURE LENGTH -- One of these three is required if you're # publishing enclosures and you're not using ``item_enclosures``. The # framework looks for them in this order. In each case, the returned # value should be either an integer, or a string representation of the # integer, in bytes. def item_enclosure_length ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's enclosure length. \"\"\" def item_enclosure_length ( self ): \"\"\" Returns the enclosure length for every item in the feed. \"\"\" item_enclosure_length = 32000 # Hard-coded enclosure length. # ITEM ENCLOSURE MIME TYPE -- One of these three is required if you're # publishing enclosures and you're not using ``item_enclosures``. The # framework looks for them in this order. def item_enclosure_mime_type ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's enclosure MIME type. \"\"\" def item_enclosure_mime_type ( self ): \"\"\" Returns the enclosure MIME type for every item in the feed. \"\"\" item_enclosure_mime_type = \"audio/mpeg\" # Hard-coded enclosure MIME type. # ITEM PUBDATE -- It's optional to use one of these three. This is a # hook that specifies how to get the pubdate for a given item. # In each case, the method/attribute should return a Python # datetime.datetime object. def item_pubdate ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's pubdate. \"\"\" def item_pubdate ( self ): \"\"\" Returns the pubdate for every item in the feed. \"\"\" item_pubdate = datetime . datetime ( 2005 , 5 , 3 ) # Hard-coded pubdate. # ITEM UPDATED -- It's optional to use one of these three. This is a # hook that specifies how to get the updateddate for a given item. # In each case, the method/attribute should return a Python # datetime.datetime object. def item_updateddate ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's updateddate. \"\"\" def item_updateddate ( self ): \"\"\" Returns the updateddate for every item in the feed. \"\"\" item_updateddate = datetime . datetime ( 2005 , 5 , 3 ) # Hard-coded updateddate. # ITEM CATEGORIES -- It's optional to use one of these three. This is # a hook that specifies how to get the list of categories for a given # item. In each case, the method/attribute should return an iterable # object that returns strings. def item_categories ( self , item ): \"\"\" Takes an item, as returned by items(), and returns the item's categories. \"\"\" def item_categories ( self ): \"\"\" Returns the categories for every item in the feed. \"\"\" item_categories = [ \"python\" , \"django\" ] # Hard-coded categories. # ITEM COPYRIGHT NOTICE (only applicable to Atom feeds) -- One of the # following three is optional. The framework looks for them in this # order. def item_copyright ( self , obj ): \"\"\" Takes an item, as returned by items(), and returns the item's copyright notice as a normal Python string. \"\"\" def item_copyright ( self ): \"\"\" Returns the copyright notice for every item in the feed. \"\"\" item_copyright = \"Copyright (c) 2007, Sally Smith\" # Hard-coded copyright notice. # ITEM COMMENTS URL -- It's optional to use one of these three. This is # a hook that specifies how to get the URL of a page for comments for a # given item. def item_comments ( self , obj ): \"\"\" Takes an item, as returned by items(), and returns the item's comments URL as a normal Python string. \"\"\" def item_comments ( self ): \"\"\" Returns the comments URL for every item in the feed. \"\"\" item_comments = \"https://www.example.com/comments\" # Hard-coded comments URL The low-level framework ¶ Behind the scenes, the high-level RSS framework uses a lower-level framework\nfor generating feeds’ XML. This framework lives in a single module: django/utils/feedgenerator.py . You use this framework on your own, for lower-level feed generation. You can\nalso create custom feed generator subclasses for use with the feed_type Feed option. SyndicationFeed classes ¶ The feedgenerator module contains a base class: django.utils.feedgenerator.SyndicationFeed and several subclasses: django.utils.feedgenerator.RssUserland091Feed django.utils.feedgenerator.Rss201rev2Feed django.utils.feedgenerator.Atom1Feed Each of these three classes knows how to render a certain type of feed as XML.\nThey share this interface: SyndicationFeed.__init__() Initialize the feed with the given dictionary of metadata, which applies to\nthe entire feed. Required keyword arguments are: title link description There’s also a bunch of other optional keywords: language author_email author_name author_link subtitle categories feed_url feed_copyright feed_guid ttl Any extra keyword arguments you pass to __init__ will be stored in self.feed for use with custom feed generators . All parameters should be strings, except categories , which should be a\nsequence of strings. Beware that some control characters\nare not allowed in XML documents. If your content has some of them, you might encounter a ValueError when producing the feed. SyndicationFeed.add_item() Add an item to the feed with the given parameters. Required keyword arguments are: title link description Optional keyword arguments are: author_email author_name author_link pubdate comments unique_id enclosures categories item_copyright ttl updateddate Extra keyword arguments will be stored for custom feed generators . All parameters, if given, should be strings, except: pubdate should be a Python datetime object. updateddate should be a Python datetime object. enclosures should be a list of django.utils.feedgenerator.Enclosure instances. categories should be a sequence of strings. SyndicationFeed.write() Outputs the feed in the given encoding to outfile, which is a file-like object. SyndicationFeed.writeString() Returns the feed as a string in the given encoding. For example, to create an Atom 1.0 feed and print it to standard output: >>> from django.utils import feedgenerator >>> from datetime import datetime >>> f = feedgenerator . Atom1Feed ( ... title = \"My Blog\" , ... link = \"https://www.example.com/\" , ... description = \"In which I write about what I ate today.\" , ... language = \"en\" , ... author_name = \"Myself\" , ... feed_url = \"https://example.com/atom.xml\" , ... ) >>> f . add_item ( ... title = \"Hot dog today\" , ... link = \"https://www.example.com/entries/1/\" , ... pubdate = datetime . now (), ... description = \"<p>Today I had a Vienna Beef hot dog. It was pink, plump and perfect.</p>\" , ... ) >>> print ( f . writeString ( \"UTF-8\" )) <?xml version=\"1.0\" encoding=\"UTF-8\"?> <feed xmlns=\"http://www.w3.org/2005/Atom\" xml:lang=\"en\"> ... </feed> Custom feed generators ¶ If you need to produce a custom feed format, you’ve got a couple of options. If the feed format is totally custom, you’ll want to subclass SyndicationFeed and completely replace the write() and writeString() methods. However, if the feed format is a spin-off of RSS or Atom (i.e. GeoRSS , Apple’s iTunes podcast format , etc.), you’ve got a better choice. These types of\nfeeds typically add extra elements and/or attributes to the underlying format,\nand there are a set of methods that SyndicationFeed calls to get these extra\nattributes. Thus, you can subclass the appropriate feed generator class\n( Atom1Feed or Rss201rev2Feed ) and extend these callbacks. They are: SyndicationFeed.root_attributes(self) Return a dict of attributes to add to the root feed element\n( feed / channel ). SyndicationFeed.add_root_elements(self, handler) Callback to add elements inside the root feed element\n( feed / channel ). handler is an XMLGenerator from Python’s built-in SAX library;\nyou’ll call methods on it to add to the XML document in process. SyndicationFeed.item_attributes(self, item) Return a dict of attributes to add to each item ( item / entry )\nelement. The argument, item , is a dictionary of all the data passed to SyndicationFeed.add_item() . SyndicationFeed.add_item_elements(self, handler, item) Callback to add elements to each item ( item / entry ) element. handler and item are as above. Warning If you override any of these methods, be sure to call the superclass methods\nsince they add the required elements for each feed format. For example, you might start implementing an iTunes RSS feed generator like so: class iTunesFeed ( Rss201rev2Feed ): def root_attributes ( self ): attrs = super () . root_attributes () attrs [ \"xmlns:itunes\" ] = \"http://www.itunes.com/dtds/podcast-1.0.dtd\" return attrs def add_root_elements ( self , handler ): super () . add_root_elements ( handler ) handler . addQuickElement ( \"itunes:explicit\" , \"clean\" ) There’s a lot more work to be done for a complete custom feed class, but the\nabove example should demonstrate the basic idea.", "keywords": ["feed", "crime", "updateddate", "xmlns", "relational", "item_title", "policebeat.models", "library", "#", "beef", "pubdate", "metadata", "https://www.example.com/", "bits", "representation", "programming", "compatibility", "django.urls", "hook", "django.core.exceptions", "changes", "=", "get_absolute_url", "categories", "tag", "process", "django.utils.translation.get_language", "datetime.datetime", "choice", "/blog/", "type", "custom", "kwargs", "objects", "documentation", "generator", "write", "file", "vienna", "work", "mpeg", "police", "articles.html", "callbacks", "attribute", "args", "scenes", "developers", "time", "feed_copyright", "setting", "ispermalink", "podcast", "enclosures", "logic", "item_pubdate", "name", "parameter", "feeds", "--one", "codebase", "reference", "item_guid", "web", "quoting", "versions", "return", "perfect.</p", "reverse", "foo", "parent", "blog", "[:", "examples", "additions", "django.contrib.sites.models", "category", "https://www.example.com/comments", "url", "error", "item_enclosure_url", "module", "code", "/beats/613", "algorithm", "filter", "behavior", "c", "link", "class", "test@example.com", "returns", "names", "request", "formatting", "output", "*", "page", "types", "sally", "strings", "elements", "subclass", "crimes", "usage", "xml", "itunesfeed", "superclass", "feed_url", "section", "sequence", "articlesfeed", "use", "atom1feed", "newsitem", "author", "author_email", "add_root_elements", "baz", "subclasses", "order", "default", "requestsite", "atom", "enclosure", "option", "item_author_link", "format", "callback", "classes", "characters", "rss/", "item_link", "bar.mp3", "lang", "beat_id>/rss/", "f", "scheme", "root_attributes", "item_copyright", "https://", "template", "rss", "way", "super", "comments", "syndication", "integer", "¶", "bytes", "news", "id", "parameters", "get_context_data", "property", "xmlgenerator", "content", "keywords", "apple", "protocol", "views", "result", "view", "item_enclosures", "control", "lot", "version=\"1.0", "beat_id", "rsssitenewsfeed", "def", "point", "myself", "string", "order_by", "city", "overview", "thing", "mime", "https://www.example.com/entries/1/", "location", "language", "models", "version", "level", "guid", "contents", "latestentriesfeed", "article", "django", "n’t", "print", "feedgenerator.py", "entry", "set", "mysite.models", "item_guid_is_permalink", "bunch", "value", "rssuserland091feed", "django.utils.feedgenerator", "line", "channel", "data", "implementation", "item", "handler", "datetime", "base", "author_name", "beats/<int", "self", "paths", "instance", "objectdoesnotexist", "item_enclosure_length", "today", "item_categories", "interface", "items(obj", "descriptions", "functionality", "item_description", "instances", "sax", "subtitle", "object", "spin", "couple", "domain", "author_link", "valueerror", "dog", "addquickelement", "self.feed", "website", "off", "dictionary", "keyword", "conversion", "attrs", "notice", "breaking", "variables", "root", "obj", "effect", "https://example.com/atom.xml", "system", "item_updateddate", "feed_guid", "items", "beatfeed", "item_comments", "site", "tandem", "example", "hooks", "list", "beat", "utils", "itunes", "outfile", "rss201rev2feed", "live", "examplefeed", "email", "item_author_name", "model", "variable", "reasons", "idea", "confusion", "element", "dry", "encoding", "attributes", "title", "add_item", "obj.description", "urlconf", "mimics", "item_author_email", "sitenews", "case", "principle", "boolean", "length", "get_object", "ttl", "html", "generators", "arguments", "init", "site.name", "syndicationfeed.__init", "mapper", "generation", "entries", "https://www.example.com/blog/", "-pub_date", "myfeed", "bar", "path", "feed_type", "current_site", "none", "django.contrib.syndication.views", "feedgenerator", "framework", "dict", "urls", "publishing", "api", "description", "document", "/sitenews/", "django.utils", "context", "syndicationfeed", "import", "documents", "unique_id", "defaults", "pk", "site_id", "information", "python", "syndicationfeed.add_item", "copyright", "methods", "options", "optional", "item_enclosure_mime_type", "lang=\"en", "-crime_date", "method", "myproject.feeds", "argument", "articles", "/foo", "note", "sites", "smith", "templates", "atomsitenewsfeed"], "type": "documentation"},
{"title": "The redirects app | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/redirects/", "content": "The redirects app ¶ Django comes with an optional redirects application. It lets you store\nredirects in a database and handles the redirecting for you. It uses the HTTP\nresponse status code 301 Moved Permanently by default. Installation ¶ To install the redirects app, follow these steps: Ensure that the django.contrib.sites framework is installed . Add 'django.contrib.redirects' to your INSTALLED_APPS setting. Add 'django.contrib.redirects.middleware.RedirectFallbackMiddleware' to your MIDDLEWARE setting. Run the command manage.py migrate . How it works ¶ manage.py migrate creates a django_redirect table in your database. This\nis a lookup table with site_id , old_path and new_path fields. The RedirectFallbackMiddleware does all of the work. Each time any Django application raises a 404\nerror, this middleware checks the redirects database for the requested\nURL as a last resort. Specifically, it checks for a redirect with the\ngiven old_path with a site ID that corresponds to the SITE_ID setting. If it finds a match, and new_path is not empty, it redirects to new_path using a 301 (“Moved Permanently”) redirect. You can subclass RedirectFallbackMiddleware and set response_redirect_class to django.http.HttpResponseRedirect to use a 302 Moved Temporarily redirect instead. If it finds a match, and new_path is empty, it sends a 410 (“Gone”)\nHTTP header and empty (content-less) response. If it doesn’t find a match, the request continues to be processed as\nusual. The middleware only gets activated for 404s – not for 500s or responses of any\nother status code. Note that the order of MIDDLEWARE matters. Generally, you can put RedirectFallbackMiddleware at the\nend of the list, because it’s a last resort. For more on middleware, read the middleware docs . How to add, change and delete redirects ¶ Via the admin interface ¶ If you’ve activated the automatic Django admin interface, you should see a\n“Redirects” section on the admin index page. Edit redirects as you edit any\nother object in the system. Via the Python API ¶ class models. Redirect ¶ Redirects are represented by a standard Django model ,\nwhich lives in django/contrib/redirects/models.py . You can access\nredirect objects via the Django database API .\nFor example: >>> from django.conf import settings >>> from django.contrib.redirects.models import Redirect >>> # Add a new redirect. >>> redirect = Redirect . objects . create ( ... site_id = 1 , ... old_path = \"/contact-us/\" , ... new_path = \"/contact/\" , ... ) >>> # Change a redirect. >>> redirect . new_path = \"/contact-details/\" >>> redirect . save () >>> redirect <Redirect: /contact-us/ ---> /contact-details/> >>> # Delete a redirect. >>> Redirect . objects . filter ( site_id = 1 , old_path = \"/contact-us/\" ) . delete () (1, {'redirects.Redirect': 1}) Middleware ¶ class middleware. RedirectFallbackMiddleware ¶ You can change the HttpResponse classes used\nby the middleware by creating a subclass of RedirectFallbackMiddleware and overriding response_gone_class and/or response_redirect_class . response_gone_class ¶ The HttpResponse class used when a Redirect is not found for the\nrequested path or has a blank new_path value. Defaults to HttpResponseGone . response_redirect_class ¶ The HttpResponse class that handles the redirect. Defaults to HttpResponsePermanentRedirect .", "keywords": ["matters", "us/", "status", "url", "error", "code", "site", "404s", "filter", "class", "example", "#", "app", "/contact/", "list", "request", "database", "table", "steps", "models", "match", "redirecting", "page", "httpresponse", "migrate", "/contact", "model", "subclass", "change", "admin", "application", "response_gone_class", "django", "http", "=", "redirects", "fields", "django.contrib.redirects", "installation", "django.contrib.sites", "500s", "value", "via", "section", "django_redirect", "lookup", "middleware", "objects", "end", "contrib", "delete", "work", "order", "interface", "default", "path", "new_path", "docs", "classes", "resort", "time", "framework", "setting", "responses", "api", "installed_apps", "object", "redirectfallbackmiddleware", "django.contrib.redirects.models", "edit", "import", "old_path", "httpresponsegone", "response", "gone", "header", "defaults", "site_id", "response_redirect_class", "python", "index", "settings", "¶", "redirect", "command", "id", "system", "content"], "type": "documentation"},
{"title": "Validators | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/validators/", "content": "Validators ¶ These validators are available from the django.contrib.postgres.validators module. KeysValidator ¶ class KeysValidator ( keys , strict = False , messages = None ) [source] ¶ Validates that the given keys are contained in the value. If strict is True , then it also checks that there are no other keys present. The messages passed should be a dict containing the keys missing_keys and/or extra_keys . Note Note that this checks only for the existence of a given key, not that\nthe value of a key is non-empty. Range validators ¶ RangeMaxValueValidator ¶ class RangeMaxValueValidator ( limit_value , message = None ) [source] ¶ Validates that the upper bound of the range is not greater than limit_value . RangeMinValueValidator ¶ class RangeMinValueValidator ( limit_value , message = None ) [source] ¶ Validates that the lower bound of the range is not less than the limit_value .", "keywords": ["django.contrib.postgres.validators", "existence", "bound", "messages", "module", "checks", "validators", "keysvalidator", "message", "class", "key", "validates", "none", "value", "¶", "source", "keys", "extra_keys", "limit_value", "range", "rangemaxvaluevalidator", "rangeminvaluevalidator", "missing_keys"], "type": "documentation"},
{"title": "django.contrib.postgres | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/", "content": "django.contrib.postgres ¶ PostgreSQL has a number of features which are not shared by the other databases\nDjango supports. This optional module contains model fields and form fields for\na number of PostgreSQL specific data types. Note Django is, and will continue to be, a database-agnostic web framework. We\nwould encourage those writing reusable applications for the Django\ncommunity to write database-agnostic code where practical. However, we\nrecognize that real world projects written using Django need not be\ndatabase-agnostic. In fact, once a project reaches a given size changing\nthe underlying data store is already a significant challenge and is likely\nto require changing the code base in some ways to handle differences\nbetween the data stores. Django provides support for a number of data types which will\nonly work with PostgreSQL. There is no fundamental reason why (for example)\na contrib.mysql module does not exist, except that PostgreSQL has the\nrichest feature set of the supported databases so its users have the most\nto gain. PostgreSQL specific aggregation functions General-purpose aggregation functions Aggregate functions for statistics Usage examples PostgreSQL specific database constraints ExclusionConstraint PostgreSQL specific query expressions ArraySubquery() expressions PostgreSQL specific model fields Indexing these fields ArrayField HStoreField Range Fields PostgreSQL specific form fields and widgets Fields Widgets PostgreSQL specific database functions RandomUUID TransactionNow PostgreSQL specific model indexes BloomIndex BrinIndex BTreeIndex GinIndex GistIndex HashIndex SpGistIndex OpClass() expressions PostgreSQL specific lookups Trigram similarity Unaccent Database migration operations Creating extension using migrations CreateExtension BloomExtension BtreeGinExtension BtreeGistExtension CITextExtension CryptoExtension HStoreExtension TrigramExtension UnaccentExtension Managing collations using migrations Concurrent index operations Adding constraints without enforcing validation Full text search The search lookup SearchVector SearchQuery SearchRank SearchHeadline Changing the search configuration Weighting queries Performance Trigram similarity Validators KeysValidator Range validators", "keywords": ["users", "examples", "arrayfield", "store", "feature", "widgets", "indexes", "number", "module", "code", "features", "challenge", "unaccent", "hstoreextension", "keysvalidator", "migration", "example", "brinindex", "migrations", "databases", "stores", "database", "community", "range", "query", "postgresql", "ways", "types", "model", "usage", "django", "trigram", "searchrank", "trigramextension", "configuration", "differences", "fields", "concurrent", "set", "validation", "fact", "searchvector", "spgistindex", "exclusionconstraint", "data", "managing", "lookup", "base", "indexing", "randomuuid", "ginindex", "citextextension", "performance", "lookups", "cryptoextension", "aggregation", "statistics", "extension", "validators", "functions", "btreeginextension", "operations", "form", "contrib.mysql", "size", "opclass", "constraints", "bloomindex", "reason", "framework", "similarity", "searchheadline", "gistindex", "hstorefield", "support", "projects", "hashindex", "world", "searchquery", "web", "collations", "weighting", "index", "purpose", "transactionnow", "arraysubquery", "¶", "applications", "expressions", "search", "btreeindex", "createextension", "btreegistextension", "unaccentextension", "text", "project", "bloomextension"], "type": "documentation"},
{"title": "OGR Inspection | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/ogrinspect/", "content": "OGR Inspection ¶ ogrinspect ¶ ogrinspect ( data_source , model_name , ** kwargs ) [source] mapping ¶ mapping ( data_source , geom_name = 'geom' , layer_key = 0 , multi_geom = False ) [source] ¶", "keywords": ["layer_key", "model_name", "source", "geom", "multi_geom", "'", "=", "ogrinspect", "mapping", "false", "*", "geom_name", "¶", "kwargs", "data_source", "inspection", "ogr"], "type": "documentation"},
{"title": "LayerMapping data import utility | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/layermapping/", "content": "LayerMapping data import utility ¶ The LayerMapping class provides a way to map the contents of\nvector spatial data files (e.g. shapefiles) into GeoDjango models. This utility grew out of the author’s personal needs to eliminate\nthe code repetition that went into pulling geometries and fields out of\na vector layer, converting to another coordinate system (e.g. WGS84), and\nthen inserting into a GeoDjango model. Note Use of LayerMapping requires GDAL. Warning GIS data sources, like shapefiles, may be very large.  If you find\nthat LayerMapping is using too much memory, set DEBUG to False in your settings.  When DEBUG is set to True , Django automatically logs every SQL query – and when SQL statements contain geometries, this may\nconsume more memory than is typical. Example ¶ You need a GDAL-supported data source, like a shapefile (here we’re using\na simple polygon shapefile, test_poly.shp , with three features): >>> from django.contrib.gis.gdal import DataSource >>> ds = DataSource ( \"test_poly.shp\" ) >>> layer = ds [ 0 ] >>> print ( layer . fields ) # Exploring the fields in the layer, we only want the 'str' field. ['float', 'int', 'str'] >>> print ( len ( layer )) # getting the number of features in the layer (should be 3) 3 >>> print ( layer . geom_type ) # Should be 'Polygon' Polygon >>> print ( layer . srs ) # WGS84 in WKT GEOGCS[\"GCS_WGS_1984\", DATUM[\"WGS_1984\", SPHEROID[\"WGS_1984\",6378137,298.257223563]], PRIMEM[\"Greenwich\",0], UNIT[\"Degree\",0.017453292519943295]] Now we define our corresponding Django model (make sure to use migrate ): from django.contrib.gis.db import models class TestGeo ( models . Model ): name = models . CharField ( max_length = 25 ) # corresponds to the 'str' field poly = models . PolygonField ( srid = 4269 ) # we want our model in a different SRID def __str__ ( self ): return \"Name: %s \" % self . name Use LayerMapping to extract all the features and place them in the\ndatabase: >>> from django.contrib.gis.utils import LayerMapping >>> from geoapp.models import TestGeo >>> mapping = { ... \"name\" : \"str\" , # The 'name' model field maps to the 'str' layer field. ... \"poly\" : \"POLYGON\" , # For geometry fields use OGC name. ... } # The mapping is a dictionary >>> lm = LayerMapping ( TestGeo , \"test_poly.shp\" , mapping ) >>> lm . save ( verbose = True ) # Save the layermap, imports the data. Saved: Name: 1 Saved: Name: 2 Saved: Name: 3 Here, LayerMapping transformed the three geometries from the shapefile\nin their original spatial reference system (WGS84) to the spatial reference\nsystem of the GeoDjango model (NAD83).  If no spatial reference system is\ndefined for the layer, use the source_srs keyword with a SpatialReference object to specify one. LayerMapping API ¶ class LayerMapping ( model , data_source , mapping , layer = 0 , source_srs = None , encoding = None , transaction_mode = 'commit_on_success' , transform = True , unique = True , using = 'default' ) [source] ¶ The following are the arguments and keywords that may be used during\ninstantiation of LayerMapping objects. Argument Description model The geographic model, not an instance. data_source The path to the OGR-supported data source file\n(e.g., a shapefile).  Also accepts django.contrib.gis.gdal.DataSource instances. mapping A dictionary: keys are strings corresponding to\nthe model field, and values correspond to\nstring field names for the OGR feature, or if the\nmodel field is a geographic then it should\ncorrespond to the OGR geometry type,\ne.g., 'POINT' , 'LINESTRING' , 'POLYGON' . Keyword Arguments layer The index of the layer to use from the Data Source\n(defaults to 0) source_srs Use this to specify the source SRS manually (for\nexample, some shapefiles don’t come with a '.prj' file).  An integer SRID, WKT or PROJ strings, and django.contrib.gis.gdal.SpatialReference objects are accepted. encoding Specifies the character set encoding of the strings\nin the OGR data source.  For example, 'latin-1' , 'utf-8' , and 'cp437' are all valid encoding\nparameters. transaction_mode May be 'commit_on_success' (default) or 'autocommit' . transform Setting this to False will disable coordinate\ntransformations.  In other words, geometries will\nbe inserted into the database unmodified from their\noriginal state in the data source. unique Setting this to the name, or a tuple of names,\nfrom the given  model will create models unique\nonly to the given name(s). Geometries from\neach feature will be added into the collection\nassociated with the unique model.  Forces\nthe transaction mode to be 'autocommit' . using Sets the database to use when importing spatial data.\nDefault is 'default' . save() Keyword Arguments ¶ LayerMapping. save ( verbose = False , fid_range = False , step = False , progress = False , silent = False , stream = sys.stdout , strict = False ) [source] ¶ The save() method also accepts keywords.  These keywords are\nused for controlling output logging, error handling, and for importing\nspecific feature ranges. Save Keyword Arguments Description fid_range May be set with a slice or tuple of\n(begin, end) feature ID’s to map from\nthe data source.  In other words, this\nkeyword enables the user to selectively\nimport a subset range of features in the\ngeographic data source. progress When this keyword is set, status information\nwill be printed giving the number of features\nprocessed and successfully saved.  By default,\nprogress information will be printed every 1000\nfeatures processed, however, this default may\nbe overridden by setting this keyword with an\ninteger for the desired interval. silent By default, non-fatal error notifications are\nprinted to sys.stdout , but this keyword may\nbe set to disable these notifications. step If set with an integer, transactions will\noccur at every step interval. For example, if step=1000 , a commit would occur after the\n1,000th feature, the 2,000th feature etc. stream Status information will be written to this file\nhandle.  Defaults to using sys.stdout , but\nany object with a write method is supported. strict Execution of the model mapping will cease upon\nthe first error encountered.  The default value\n( False )\nbehavior is to attempt to continue. verbose If set, information will be printed\nsubsequent to each model save\nexecuted on the database. Troubleshooting ¶ Running out of memory ¶ As noted in the warning at the top of this section, Django stores all SQL\nqueries when DEBUG=True .  Set DEBUG=False in your settings, and this\nshould stop excessive memory use when running LayerMapping scripts. MySQL: max_allowed_packet error ¶ If you encounter the following error when using LayerMapping and MySQL: OperationalError: (1153, \"Got a packet bigger than 'max_allowed_packet' bytes\") Then the solution is to increase the value of the max_allowed_packet setting in your MySQL configuration.  For example, the default value may\nbe something low like one megabyte – the setting may be modified in MySQL’s\nconfiguration file ( my.cnf ) in the [mysqld] section: max_allowed_packet = 10M", "keywords": ["keywords", "testgeo", "feature", "status", "number", "saved", "maps", "error", "geometry", "code", "point", "features", "values", "’s", "false", "string", "behavior", "nad83", "class", "example", "field", "#", "progress", "shapefiles", "source_srs", "m", "mapping", "spatialreference", "names", "test_poly.shp", "database", "srs", "output", "mysqld", "range", "models", "query", "subset", "migrate", "vector", "fid_range", "contents", "strings", "model", "needs", "datasource", "words", "wgs84", "gis", "coordinate", "scripts", "max_allowed_packet", "encoding", "django", "spheroid[\"wgs_1984\",6378137,298.257223563", "layermap", "configuration", "=", "interval", "step", "max_length", "fields", "print", "geoapp.models", "stream", "set", "instantiation", "notifications", "character", "sys.stdout", "value", "section", "wkt", "ranges", "sets", "source", "keys", "name(s", "data", "proj", "debug", "use", "sources", "collection", "layer", "tuple", "str", "arguments", "commit", "ds", "author", "type", "solution", "self", "instance", "objects", "end", "file", "e.g.", "megabyte", "geometries", "handling", "default", "user", "path", "handle", "polygonfield", "none", "ogc", "specifies", "warning", "my.cnf", "cp437", "logging", "save", "setting", "true", "django.contrib.gis.db", "api", "description", "mode", "object", "transform", "transactions", ".prj", "transformations", "len", "import", "files", "name", "charfield", "operationalerror", "statements", "mysql", "%", "utility", "sql", "dictionary", "defaults", "execution", "way", "reference", "utf-8", "layermapping", "gdal", "information", "keyword", "queries", "index", "repetition", "slice", "commit_on_success", "geodjango", "method", "forces", "integer", "top", "packet", "settings", "transaction", "shapefile", "argument", "¶", "return", "bytes", "id", "note", "parameters", "primem[\"greenwich\",0", "memory", "datum[\"wgs_1984", "django.contrib.gis.gdal", "state", "system", "int", "srid", "polygon", "ogr"], "type": "documentation"},
{"title": "GeoDjango Utilities | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/utils/", "content": "GeoDjango Utilities ¶ The django.contrib.gis.utils module contains various utilities that are\nuseful in creating geospatial web applications. LayerMapping data import utility Example LayerMapping API Troubleshooting OGR Inspection ogrinspect mapping GeoJSON Serializer", "keywords": ["example", "utility", "module", "data", "troubleshooting", "geodjango", "mapping", "web", "layermapping", "geojson", "import", "¶", "utilities", "api", "ogr", "serializer", "inspection", "applications"], "type": "documentation"},
{"title": "GeoJSON Serializer | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/serializers/", "content": "GeoJSON Serializer ¶ GeoDjango provides a specific serializer for the GeoJSON format. See Serializing Django objects for more information on serialization. The geojson serializer is not meant for round-tripping data, as it has no\ndeserializer equivalent. For example, you cannot use loaddata to\nreload the output produced by this serializer. If you plan to reload the\noutputted data, use the plain json serializer instead. In addition to the options of the json serializer, the geojson serializer accepts the following additional option when it is called by serializers.serialize() : geometry_field : A string containing the name of a geometry field to use\nfor the geometry key of the GeoJSON feature. This is only needed when you\nhave a model with more than one geometry field and you don’t want to use the\nfirst defined geometry field (by default, the first geometry field is picked). id_field : A string containing the name of a field to use for the id key of the GeoJSON feature. By default, the primary key of objects is used. srid : The SRID to use for the geometry content. Defaults to 4326\n(WGS 84). The fields option can be used to limit fields that\nwill be present in the properties key, as it works with all other\nserializers. Example: from django.core.serializers import serialize from my_app.models import City serialize ( \"geojson\" , City . objects . all (), geometry_field = \"point\" , fields = [ \"name\" ]) Would output: { \"type\" : \"FeatureCollection\" , \"crs\" : { \"type\" : \"name\" , \"properties\" : { \"name\" : \"EPSG:4326\" }}, \"features\" : [ { \"type\" : \"Feature\" , \"id\" : 1 , \"geometry\" : { \"type\" : \"Point\" , \"coordinates\" : [ - 87.650175 , 41.850385 ]}, \"properties\" : { \"name\" : \"Chicago\" }, } ], } When the fields parameter is not specified, the geojson serializer adds\na pk key to the properties dictionary with the primary key of the\nobject as the value.", "keywords": ["object", "json", "deserializer", "model", "type", "loaddata", "feature", "serializers", "epsg:4326", "import", "name", "d", "reload", "objects", "serializer", "parameter", "defaults", "django", "geometry", "pk", "point", "tripping", "information", "default", "fields", "serializers.serialize", "string", "geometry_field", "addition", "i", "example", "options", "field", "key", "id_field", "city", "serialization", "geodjango", "geojson", "option", "format", "properties", "value", "¶", "wgs", "chicago", "coordinates", "django.core.serializers", "data", "featurecollection", "output", "serializing", "my_app.models", "srid", "content"], "type": "documentation"},
{"title": "Geographic Feeds | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/feeds/", "content": "Geographic Feeds ¶ GeoDjango has its own Feed subclass that may embed location information\nin RSS/Atom feeds formatted according to either the Simple GeoRSS or W3C Geo standards.  Because GeoDjango’s syndication API is a superset of\nDjango’s, please consult Django’s syndication documentation for details on general usage. Example ¶ API Reference ¶ Feed Subclass ¶ class Feed [source] ¶ In addition to methods provided by the django.contrib.syndication.views.Feed base class, GeoDjango’s Feed class provides the following overrides. Note that these overrides\nmay be done in multiple ways: from django.contrib.gis.feeds import Feed class MyFeed ( Feed ): # First, as a class attribute. geometry = ... item_geometry = ... # Also a function with no arguments def geometry ( self ): ... def item_geometry ( self ): ... # And as a function with a single argument def geometry ( self , obj ): ... def item_geometry ( self , item ): ... geometry ( obj ) ¶ Takes the object returned by get_object() and returns the feed’s geometry. Typically this is a GEOSGeometry instance, or can be a tuple\nto represent a point or a box. For example: class ZipcodeFeed ( Feed ): def geometry ( self , obj ): # Can also return: `obj.poly`, and `obj.poly.centroid`. return obj . poly . extent # tuple like: (X0, Y0, X1, Y1). item_geometry ( item ) ¶ Set this to return the geometry for each item in the feed. This can be a GEOSGeometry instance, or a tuple that represents a point coordinate or\nbounding box. For example: class ZipcodeFeed ( Feed ): def item_geometry ( self , obj ): # Returns the polygon. return obj . poly SyndicationFeed Subclasses ¶ The following django.utils.feedgenerator.SyndicationFeed subclasses\nare available: class GeoRSSFeed [source] ¶ class GeoAtom1Feed [source] ¶ class W3CGeoFeed [source] ¶ Note W3C Geo formatted feeds only support PointField geometries.", "keywords": ["function", "ways", "object", "tuple", "feed", "django.contrib.gis.feeds", "arguments", "item_geometry", "box", "subclass", "x0", "syndicationfeed", "geographic", "import", "self", "obj.poly.centroid", "instance", "extent", "coordinate", "bounding", "documentation", "subclasses", "georssfeed", "feeds", "rss", "usage", "y1", "overrides", "myfeed", "django", "geometry", "def", "point", "geometries", "information", "reference", "pointfield", "standards", "methods", "addition", "w3c", "example", "class", "#", "x1", "set", "geosgeometry", "atom", "syndication", "zipcodefeed", "y0", "details", "attribute", "geodjango", "django.contrib.syndication.views", "geo", "argument", "¶", "obj", "returns", "django.utils.feedgenerator", "note", "source", "w3cgeofeed", "georss", "get_object", "geoatom1feed", "location", "item", "base", "superset", "api", "polygon"], "type": "documentation"},
{"title": "GeoDjango Database API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/db-api/", "content": "GeoDjango Database API ¶ Spatial Backends ¶ GeoDjango currently provides the following spatial database backends: django.contrib.gis.db.backends.postgis django.contrib.gis.db.backends.mysql django.contrib.gis.db.backends.oracle django.contrib.gis.db.backends.spatialite MySQL Spatial Limitations ¶ Django supports spatial functions operating on real geometries available in\nmodern MySQL versions. However, the spatial functions are not as rich as other\nbackends like PostGIS. Raster Support ¶ RasterField is currently only implemented for the PostGIS backend. Spatial\nlookups are available for raster fields, but spatial database functions and\naggregates aren’t implemented for raster fields. Creating and Saving Models with Geometry Fields ¶ Here is an example of how to create a geometry object (assuming the Zipcode model): >>> from zipcode.models import Zipcode >>> z = Zipcode ( code = 77096 , poly = \"POLYGON(( 10 10, 10 20, 20 20, 20 15, 10 10))\" ) >>> z . save () GEOSGeometry objects may also be used to save geometric models: >>> from django.contrib.gis.geos import GEOSGeometry >>> poly = GEOSGeometry ( \"POLYGON(( 10 10, 10 20, 20 20, 20 15, 10 10))\" ) >>> z = Zipcode ( code = 77096 , poly = poly ) >>> z . save () Moreover, if the GEOSGeometry is in a different coordinate system (has a\ndifferent SRID value) than that of the field, then it will be implicitly\ntransformed into the SRID of the model’s field, using the spatial database’s\ntransform procedure: >>> poly_3084 = GEOSGeometry ( ... \"POLYGON(( 10 10, 10 20, 20 20, 20 15, 10 10))\" , srid = 3084 ... ) # SRID 3084 is 'NAD83(HARN) / Texas Centric Lambert Conformal' >>> z = Zipcode ( code = 78212 , poly = poly_3084 ) >>> z . save () >>> from django.db import connection >>> print ( ... connection . queries [ - 1 ][ \"sql\" ] ... ) # printing the last SQL statement executed (requires DEBUG=True) INSERT INTO \"geoapp_zipcode\" (\"code\", \"poly\") VALUES (78212, ST_Transform(ST_GeomFromWKB('\\\\001 ... ', 3084), 4326)) Thus, geometry parameters may be passed in using the GEOSGeometry object, WKT\n(Well Known Text [ 1 ] ), HEXEWKB (PostGIS specific – a WKB geometry in\nhexadecimal [ 2 ] ), and GeoJSON (see RFC 7946 ). Essentially, if the\ninput is not a GEOSGeometry object, the geometry field will attempt to\ncreate a GEOSGeometry instance from the input. For more information creating GEOSGeometry objects, refer to the GEOS tutorial . Creating and Saving Models with Raster Fields ¶ When creating raster models, the raster field will implicitly convert the input\ninto a GDALRaster using lazy-evaluation.\nThe raster field will therefore accept any input that is accepted by the GDALRaster constructor. Here is an example of how to create a raster object from a raster file volcano.tif (assuming the Elevation model): >>> from elevation.models import Elevation >>> dem = Elevation ( name = \"Volcano\" , rast = \"/path/to/raster/volcano.tif\" ) >>> dem . save () GDALRaster objects may also be used to save\nraster models: >>> from django.contrib.gis.gdal import GDALRaster >>> rast = GDALRaster ( ... { ... \"width\" : 10 , ... \"height\" : 10 , ... \"name\" : \"Canyon\" , ... \"srid\" : 4326 , ... \"scale\" : [ 0.1 , - 0.1 ], ... \"bands\" : [{ \"data\" : range ( 100 )}], ... } ... ) >>> dem = Elevation ( name = \"Canyon\" , rast = rast ) >>> dem . save () Note that this equivalent to: >>> dem = Elevation . objects . create ( ... name = \"Canyon\" , ... rast = { ... \"width\" : 10 , ... \"height\" : 10 , ... \"name\" : \"Canyon\" , ... \"srid\" : 4326 , ... \"scale\" : [ 0.1 , - 0.1 ], ... \"bands\" : [{ \"data\" : range ( 100 )}], ... }, ... ) Spatial Lookups ¶ GeoDjango’s lookup types may be used with any manager method like filter() , exclude() , etc.  However, the lookup types unique to\nGeoDjango are only available on spatial fields. Filters on ‘normal’ fields (e.g. CharField )\nmay be chained with those on geographic fields. Geographic lookups accept\ngeometry and raster input on both sides and input types can be mixed freely. The general structure of geographic lookups is described below. A complete\nreference can be found in the spatial lookup reference . Geometry Lookups ¶ Geographic queries with geometries take the following general form (assuming\nthe Zipcode model used in the GeoDjango Model API ): >>> qs = Zipcode.objects.filter(<field>__<lookup_type>=<parameter>)\n>>> qs = Zipcode.objects.exclude(...) For example: >>> qs = Zipcode . objects . filter ( poly__contains = pnt ) >>> qs = Elevation . objects . filter ( poly__contains = rst ) In this case, poly is the geographic field, contains is the spatial lookup type, pnt is the parameter (which may be a GEOSGeometry object or a string of\nGeoJSON , WKT, or HEXEWKB), and rst is a GDALRaster object. Raster Lookups ¶ The raster lookup syntax is similar to the syntax for geometries. The only\ndifference is that a band index can be specified as additional input. If no band\nindex is specified, the first band is used by default (index 0 ). In that\ncase the syntax is identical to the syntax for geometry lookups. To specify the band index, an additional parameter can be specified on both\nsides of the lookup. On the left hand side, the double underscore syntax is\nused to pass a band index. On the right hand side, a tuple of the raster and\nband index can be specified. This results in the following general form for lookups involving rasters\n(assuming the Elevation model used in the GeoDjango Model API ): >>> qs = Elevation.objects.filter(<field>__<lookup_type>=<parameter>)\n>>> qs = Elevation.objects.filter(<field>__<band_index>__<lookup_type>=<parameter>)\n>>> qs = Elevation.objects.filter(<field>__<lookup_type>=(<raster_input, <band_index>) For example: >>> qs = Elevation . objects . filter ( rast__contains = geom ) >>> qs = Elevation . objects . filter ( rast__contains = rst ) >>> qs = Elevation . objects . filter ( rast__1__contains = geom ) >>> qs = Elevation . objects . filter ( rast__contains = ( rst , 1 )) >>> qs = Elevation . objects . filter ( rast__1__contains = ( rst , 1 )) On the left hand side of the example, rast is the geographic raster field\nand contains is the spatial lookup type. On the right\nhand side, geom is a geometry input and rst is a GDALRaster object. The band index defaults to 0 in the first two queries and is set to 1 on the others. While all spatial lookups can be used with raster objects on both sides, not all\nunderlying operators natively accept raster input. For cases where the operator\nexpects geometry input, the raster is automatically converted to a geometry.\nIt’s important to keep this in mind when interpreting the lookup results. The type of raster support is listed for all lookups in the compatibility\ntable . Lookups involving rasters are currently\nonly available for the PostGIS backend. Distance Queries ¶ Introduction ¶ Distance calculations with spatial data is tricky because, unfortunately,\nthe Earth is not flat.  Some distance queries with fields in a geographic\ncoordinate system may have to be expressed differently because of\nlimitations in PostGIS.  Please see the Selecting an SRID section\nin the GeoDjango Model API documentation for more details. Distance Lookups ¶ Availability : PostGIS, MariaDB, MySQL, Oracle, SpatiaLite, PGRaster (Native) The following distance lookups are available: distance_lt distance_lte distance_gt distance_gte dwithin (except MariaDB and MySQL) Note For measuring , rather than querying on distances, use the Distance function. Distance lookups take a tuple parameter comprising: A geometry or raster to base calculations from; and A number or Distance object containing the distance. If a Distance object is used,\nit may be expressed in any units (the SQL generated will use units\nconverted to those of the field); otherwise, numeric parameters are assumed\nto be in the units of the field. Note In PostGIS, ST_Distance_Sphere does not limit the geometry types\ngeographic distance queries are performed with. [ 3 ] However,\nthese queries may take a long time, as great-circle distances must be\ncalculated on the fly for every row in the query.  This is because the\nspatial index on traditional geometry fields cannot be used. For much better performance on WGS84 distance queries, consider using geography columns in your database instead because\nthey are able to use their spatial index in distance queries.\nYou can tell GeoDjango to use a geography column by setting geography=True in your field definition. For example, let’s say we have a SouthTexasCity model (from the GeoDjango distance tests ) on a projected coordinate system valid for cities in southern Texas: from django.contrib.gis.db import models class SouthTexasCity ( models . Model ): name = models . CharField ( max_length = 30 ) # A projected coordinate system (only valid for South Texas!) # is used, units are in meters. point = models . PointField ( srid = 32140 ) Then distance queries may be performed as follows: >>> from django.contrib.gis.geos import GEOSGeometry >>> from django.contrib.gis.measure import D # ``D`` is a shortcut for ``Distance`` >>> from geoapp.models import SouthTexasCity # Distances will be calculated from this point, which does not have to be projected. >>> pnt = GEOSGeometry ( \"POINT(-96.876369 29.905320)\" , srid = 4326 ) # If numeric parameter, units of field (meters in this case) are assumed. >>> qs = SouthTexasCity . objects . filter ( point__distance_lte = ( pnt , 7000 )) # Find all Cities within 7 km, > 20 miles away, and > 100 chains away (an obscure unit) >>> qs = SouthTexasCity . objects . filter ( point__distance_lte = ( pnt , D ( km = 7 ))) >>> qs = SouthTexasCity . objects . filter ( point__distance_gte = ( pnt , D ( mi = 20 ))) >>> qs = SouthTexasCity . objects . filter ( point__distance_gte = ( pnt , D ( chain = 100 ))) Raster queries work the same way by replacing the geometry field point with\na raster field, or the pnt object with a raster object, or both. To specify\nthe band index of a raster input on the right hand side, a 3-tuple can be\npassed to the lookup as follows: >>> qs = SouthTexasCity . objects . filter ( point__distance_gte = ( rst , 2 , D ( km = 7 ))) Where the band with index 2 (the third band) of the raster rst would be\nused for the lookup. Compatibility Tables ¶ Spatial Lookups ¶ The following table provides a summary of what spatial lookups are available\nfor each spatial database backend. The PostGIS Raster (PGRaster) lookups are\ndivided into the three categories described in the raster lookup details : native support N , bilateral native support B ,\nand geometry conversion support C . Lookup Type PostGIS Oracle MariaDB MySQL [ 4 ] SpatiaLite PGRaster bbcontains X X X X N bboverlaps X X X X N contained X X X X N contains X X X X X B contains_properly X B coveredby X X X B covers X X X B crosses X X X X C disjoint X X X X X B distance_gt X X X X X N distance_gte X X X X X N distance_lt X X X X X N distance_lte X X X X X N dwithin X X X B equals X X X X X C exact X X X X X B intersects X X X X X B isempty X isvalid X X X X overlaps X X X X X B relate X X X X C same_as X X X X X B touches X X X X X B within X X X X X B left X C right X C overlaps_left X B overlaps_right X B overlaps_above X C overlaps_below X C strictly_above X C strictly_below X C Database functions ¶ The following table provides a summary of what geography-specific database\nfunctions are available on each spatial backend. Function PostGIS Oracle MariaDB MySQL SpatiaLite Area X X X X X AsGeoJSON X X X X X AsGML X X X AsKML X X AsSVG X X AsWKB X X X X X AsWKT X X X X X Azimuth X X (LWGEOM/RTTOPO) BoundingCircle X X X (≥ 5.1) Centroid X X X X X ClosestPoint X X Difference X X X X X Distance X X X X X Envelope X X X X X ForcePolygonCW X X FromWKB X X X X X FromWKT X X X X X GeoHash X X X (LWGEOM/RTTOPO) Intersection X X X X X IsEmpty X IsValid X X X X Length X X X X X LineLocatePoint X X MakeValid X X (LWGEOM/RTTOPO) MemSize X NumGeometries X X X X X NumPoints X X X X X Perimeter X X X PointOnSurface X X X X Reverse X X X Scale X X SnapToGrid X X SymDifference X X X X X Transform X X X Translate X X Union X X X X X Aggregate Functions ¶ The following table provides a summary of what GIS-specific aggregate functions\nare available on each spatial backend. Please note that MariaDB does not\nsupport any of these aggregates, and is thus excluded from the table. Aggregate PostGIS Oracle MySQL SpatiaLite Collect X X (≥ 8.0.24) X Extent X X X Extent3D X MakeLine X X Union X X X Footnotes [ 1 ] See Open Geospatial Consortium, Inc., OpenGIS Simple Feature Specification For SQL , Document 99-049 (May 5, 1999), at  Ch. 3.2.5, p. 3-11 (SQL Textual Representation of Geometry). [ 2 ] See PostGIS EWKB, EWKT and Canonical Forms , PostGIS documentation at Ch. 4.1.2. [ 3 ] See PostGIS documentation on ST_DistanceSphere . [ 4 ] Refer MySQL Spatial Limitations section for more details.", "keywords": ["function", "translate", "bboverlaps", "rasterfield", "circle", "open", "feature", "dem", "mi", "hexewkb", "django.contrib.gis.measure", "texas", "simple", "aswkb", "extent", "number", "closestpoint", "definition", "native", "right", "st_distance_sphere", "procedure", "rttopo", "geometry", "b", "difference", "code", "point", "forcepolygoncw", "numgeometries", "values", "numpoints", "forms", "zipcode.objects.exclude", "postgis", "filter", "string", "c", "class", "example", "field", "#", "geoapp_zipcode", "bbcontains", "geosgeometry", "miles", "≥", "inc.", "aggregate", "raster", "column", "geojson", "zipcode", "ewkt", "availability", "rast", "geography", "x", "isempty", "text", "coveredby", "textual", "asgml", "elevation.objects.filter(<field>__<lookup_type>=(<raster_input", "south", "zipcode.objects.filter(<field>__<lookup_type>=<parameter", "rast__1__contains", "unit", "wkb", "database", "hand", "input", "table", "distances", "range", "representation", "selecting", "models", "query", "elevation.models", "bands", "p.", "compatibility", "snaptogrid", "types", "volcano", "model", "lambert", "wgs84", "gis", "coordinate", "width", ".", "insert", "point(-96.876369", "southtexascity", "django", "=", "rfc", "dwithin", "max_length", "results", "fields", "print", "cities", "geoapp.models", "summary", "isvalid", "categories", "point__distance_lte", "makevalid", "n", "geos", "syntax", "limitations", "overlaps_left", "value", "tables", "section", "distance_lt", "wkt", "earth", "relate", "height", "case", "columns", "data", "km", "length", "lookup", "debug", "underscore", "ewkb", "evaluation", "envelope", "backend", "tuple", "pgraster", "pnt", "introduction", "type", "scale", "shortcut", "instance", "performance", "objects", "documentation", "point__distance_gte", "lookups", "geohash", "mind", "file", "geometries", "same_as", "gdalraster", "poly__contains", "default", "pointfield", "comprising", "consortium", "extent3d", "cases", "functions", "collect", "sides", "form", "conformal", "filters", "django.contrib.gis.db.backends.oracle", "tests", "st_distancesphere", "strictly_above", "canonical", "makeline", "mariadb", "time", "constructor", "spatial", "zipcode.models", "geom", "meters", "overlaps_above", "save", "azimuth", "linelocatepoint", "structure", "statement", "canyon", "operators", "django.contrib.gis.db", "rasters", "area", "api", "rst", "fromwkb", "support", "chains", "geospatial", "distance_lte", "object", "transform", "document", "chain", "connection", "may", "units", "memsize", "overlaps_below", "django.contrib.gis.db.backends.postgis", "django.contrib.gis.db.backends.mysql", "saving", "symdifference", "fromwkt", "geographic", "import", "name", "specification", "charfield", "d", "parameter", "elevation.objects.filter(<field>__<band_index>__<lookup_type>=<parameter", "calculations", "mysql", "aggregates", "union", "sql", "distance_gt", "django.contrib.gis.geos", "way", "backends", "information", "reference", "fly", "row", "centroid", "strictly_below", "versions", "hexadecimal", "asgeojson", "disjoint", "overlaps_right", "queries", "elevation", "index", "footnotes", "rast__contains", "conversion", "ch", "manager", "details", "others", "geodjango", "method", "aswkt", "4.1.2", "poly_3084", "qs", "¶", "z", "spatialite", "reverse", "operator", "django.contrib.gis.db.backends.spatialite", "parameters", "note", "intersection", "known", "tutorial", "oracle", "system", "centric", "perimeter", "lwgeom", "pointonsurface", "band", "side", "distance", "srid", "polygon", "boundingcircle", "assvg"], "type": "documentation"},
{"title": "GeoDjango’s admin site | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/admin/", "content": "GeoDjango’s admin site ¶ GISModelAdmin ¶ class GISModelAdmin [source] ¶ gis_widget ¶ The widget class to be used for GeometryField . Defaults to OSMWidget . gis_widget_kwargs ¶ The keyword arguments that would be passed to the gis_widget .\nDefaults to an empty dictionary.", "keywords": ["osmwidget", "source", "defaults", "dictionary", "arguments", "site", "geodjango", "widget", "gis_widget_kwargs", "admin", "keyword", "¶", "geometryfield", "gismodeladmin", "gis_widget", "class"], "type": "documentation"},
{"title": "GeoDjango | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/", "content": "GeoDjango ¶ GeoDjango intends to be a world-class geographic web framework. Its goal is to\nmake it as easy as possible to build GIS web applications and harness the power\nof spatially enabled data. GeoDjango Tutorial Introduction Setting Up Geographic Data Geographic Models Importing Spatial Data Spatial Queries Putting your data on the map GeoDjango Installation Overview Requirements Installation Troubleshooting Platform-specific instructions GeoDjango Model API Spatial Field Types Spatial Field Options Geometry Field Options GeoDjango Database API Spatial Backends Creating and Saving Models with Geometry Fields Creating and Saving Models with Raster Fields Spatial Lookups Distance Queries Compatibility Tables GeoDjango Forms API Field arguments Form field classes Form widgets GIS QuerySet API Reference Spatial Lookups Distance Lookups Geographic Database Functions Area AsGeoJSON AsGML AsKML AsSVG AsWKB AsWKT Azimuth BoundingCircle Centroid ClosestPoint Difference Distance Envelope ForcePolygonCW FromWKB FromWKT GeoHash GeometryDistance Intersection IsEmpty IsValid Length LineLocatePoint MakeValid MemSize NumGeometries NumPoints Perimeter PointOnSurface Reverse Scale SnapToGrid SymDifference Transform Translate Union Measurement Objects Example Supported units Measurement API GEOS API Background Tutorial Geometry Objects Geometry Collections Prepared Geometries Geometry Factories I/O Objects Settings Exceptions GDAL API Overview Vector Data Source Objects OGR Geometries Coordinate System Objects Raster Data Objects Settings Exceptions Geolocation with GeoIP2 Example API Reference Methods Settings Exceptions GeoDjango Utilities LayerMapping data import utility OGR Inspection GeoJSON Serializer GeoDjango Management Commands inspectdb ogrinspect GeoDjango’s admin site GISModelAdmin Geographic Feeds Example API Reference Geographic Sitemaps Example Reference Testing GeoDjango apps PostGIS GeoDjango tests Deploying GeoDjango", "keywords": ["creating", "translate", "testing", "goal", "geolocation", "factories", "aswkb", "closestpoint", "serializer", "collections", "geometry", "forcepolygoncw", "difference", "background", "troubleshooting", "numgeometries", "forms", "numpoints", "site", "class", "example", "field", "requirements", "overview", "raster", "geojson", "isempty", "inspection", "geometrydistance", "database", "models", "commands", "map", "compatibility", "snaptogrid", "types", "vector", "geoip2", "model", "platform", "admin", "gis", "coordinate", "fields", "utilities", "isvalid", "installation", "makevalid", "power", "tables", "source", "data", "length", "envelope", "arguments", "introduction", "scale", "gismodeladmin", "objects", "lookups", "geohash", "geometries", "sitemaps", "measurement", "functions", "form", "inspectdb", "classes", "tests", "spatial", "azimuth", "framework", "linelocatepoint", "area", "api", "fromwkb", "transform", "memsize", "units", "saving", "symdifference", "fromwkt", "geographic", "import", "management", "feeds", "union", "instructions", "utility", "world", "backends", "reference", "web", "gdal", "layermapping", "centroid", "methods", "options", "queries", "aswkt", "geodjango", "queryset", "settings", "¶", "reverse", "applications", "intersection", "tutorial", "perimeter", "pointonsurface", "system", "apps", "distance", "asgeojson", "ogr", "boundingcircle", "assvg", "exceptions"], "type": "documentation"},
{"title": "The flatpages app | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/flatpages/", "content": "The flatpages app ¶ Django comes with an optional “flatpages” application. It lets you store “flat”\nHTML content in a database and handles the management for you via Django’s\nadmin interface and a Python API. A flatpage is an object with a URL, title and content. Use it for one-off,\nspecial-case pages, such as “About” or “Privacy Policy” pages, that you want to\nstore in a database but for which you don’t want to develop a custom Django\napplication. A flatpage can use a custom template or a default, systemwide flatpage\ntemplate. It can be associated with one, or multiple, sites. The content field may optionally be left blank if you prefer to put your\ncontent in a custom template. Installation ¶ To install the flatpages app, follow these steps: Install the sites framework by adding 'django.contrib.sites' to your INSTALLED_APPS setting,\nif it’s not already in there. Also make sure you’ve correctly set SITE_ID to the ID of the\nsite the settings file represents. This will usually be 1 (i.e. SITE_ID = 1 , but if you’re using the sites framework to manage\nmultiple sites, it could be the ID of a different site. Add 'django.contrib.flatpages' to your INSTALLED_APPS setting. Then either: Add an entry in your URLconf. For example: urlpatterns = [ path ( \"pages/\" , include ( \"django.contrib.flatpages.urls\" )), ] or: Add 'django.contrib.flatpages.middleware.FlatpageFallbackMiddleware' to your MIDDLEWARE setting. Run the command manage.py migrate . How it works ¶ manage.py migrate creates two tables in your database: django_flatpage and django_flatpage_sites . django_flatpage is a lookup table that maps\na URL to a title and bunch of text content. django_flatpage_sites associates a flatpage with a site. Using the URLconf ¶ There are several ways to include the flat pages in your URLconf. You can\ndedicate a particular path to flat pages: urlpatterns = [ path ( \"pages/\" , include ( \"django.contrib.flatpages.urls\" )), ] You can also set it up as a “catchall” pattern. In this case, it is important\nto place the pattern at the end of the other urlpatterns: from django.contrib.flatpages import views # Your other patterns here urlpatterns += [ re_path ( r \"^(?P<url>.*/)$\" , views . flatpage ), ] Warning If you set APPEND_SLASH to False , you must remove the slash\nin the catchall pattern or flatpages without a trailing slash will not be\nmatched. Another common setup is to use flat pages for a limited set of known pages and\nto hard code the urls, so you can reference them with the url template\ntag: from django.contrib.flatpages import views urlpatterns += [ path ( \"about-us/\" , views . flatpage , { \"url\" : \"/about-us/\" }, name = \"about\" ), path ( \"license/\" , views . flatpage , { \"url\" : \"/license/\" }, name = \"license\" ), ] Using the middleware ¶ The FlatpageFallbackMiddleware can do all of the work. class FlatpageFallbackMiddleware [source] ¶ Each time any Django application raises a 404 error, this middleware\nchecks the flatpages database for the requested URL as a last resort.\nSpecifically, it checks for a flatpage with the given URL with a site ID\nthat corresponds to the SITE_ID setting. If it finds a match, it follows this algorithm: If the flatpage has a custom template, it loads that template.\nOtherwise, it loads the template flatpages/default.html . It passes that template a single context variable, flatpage ,\nwhich is the flatpage object. It uses RequestContext in rendering the\ntemplate. The middleware will only add a trailing slash and redirect (by looking\nat the APPEND_SLASH setting) if the resulting URL refers to\na valid flatpage. Redirects are permanent (301 status code). If it doesn’t find a match, the request continues to be processed as usual. The middleware only gets activated for 404s – not for 500s or responses\nof any other status code. Flatpages will not apply view middleware Because the FlatpageFallbackMiddleware is applied only after\nURL resolution has failed and produced a 404, the response it\nreturns will not apply any view middleware methods. Only requests which are successfully routed to a view via\nnormal URL resolution apply view middleware. Note that the order of MIDDLEWARE matters. Generally, you can put FlatpageFallbackMiddleware at the\nend of the list. This means it will run first when processing the response, and\nensures that any other response-processing middleware see the real flatpage\nresponse rather than the 404. For more on middleware, read the middleware docs . Ensure that your 404 template works Note that the FlatpageFallbackMiddleware only steps in once another view has successfully produced a 404 response.\nIf another view or middleware class attempts to produce a 404 but ends up\nraising an exception instead, the response will become an HTTP 500\n(“Internal Server Error”) and the FlatpageFallbackMiddleware will not attempt to serve a flat page. How to add, change and delete flatpages ¶ Warning Permissions to add or edit flatpages should be restricted to trusted users.\nFlatpages are defined by raw HTML and are not sanitized by Django. As a\nconsequence, a malicious flatpage can lead to various security\nvulnerabilities, including permission escalation. Via the admin interface ¶ If you’ve activated the automatic Django admin interface, you should see a\n“Flatpages” section on the admin index page. Edit flatpages as you edit any\nother object in the system. The FlatPage model has an enable_comments field that isn’t used by contrib.flatpages , but that could be useful for your project or third-party\napps. It doesn’t appear in the admin interface, but you can add it by\nregistering a custom ModelAdmin for FlatPage : from django.contrib import admin from django.contrib.flatpages.admin import FlatPageAdmin from django.contrib.flatpages.models import FlatPage from django.utils.translation import gettext_lazy as _ # Define a new FlatPageAdmin class FlatPageAdmin ( FlatPageAdmin ): fieldsets = [ ( None , { \"fields\" : [ \"url\" , \"title\" , \"content\" , \"sites\" ]}), ( _ ( \"Advanced options\" ), { \"classes\" : [ \"collapse\" ], \"fields\" : [ \"enable_comments\" , \"registration_required\" , \"template_name\" , ], }, ), ] # Re-register FlatPageAdmin admin . site . unregister ( FlatPage ) admin . site . register ( FlatPage , FlatPageAdmin ) Via the Python API ¶ class FlatPage [source] ¶ Flatpages are represented by a standard Django model ,\nwhich lives in django/contrib/flatpages/models.py . You can access\nflatpage objects via the Django database API . Check for duplicate flatpage URLs. If you add or modify flatpages via your own code, you will likely want to\ncheck for duplicate flatpage URLs within the same site. The flatpage form\nused in the admin performs this validation check, and can be imported from django.contrib.flatpages.forms.FlatpageForm and used in your own\nviews. Flatpage templates ¶ By default, flatpages are rendered via the template flatpages/default.html , but you can override that for a\nparticular flatpage: in the admin, a collapsed fieldset titled\n“Advanced options” (clicking will expand it) contains a field for\nspecifying a template name. If you’re creating a flat page via the\nPython API you can set the template name as the field template_name on the FlatPage object. Creating the flatpages/default.html template is your responsibility;\nin your template directory, create a flatpages directory containing a\nfile default.html . Flatpage templates are passed a single context variable, flatpage ,\nwhich is the flatpage object. Here’s a sample flatpages/default.html template: <!DOCTYPE html> < html lang = \"en\" > < head > < title > {{ flatpage.title }} </ title > </ head > < body > {{ flatpage.content }} </ body > </ html > Since you’re already entering raw HTML into the admin page for a flatpage,\nboth flatpage.title and flatpage.content are marked as not requiring automatic HTML escaping in the\ntemplate. Getting a list of FlatPage objects in your templates ¶ The flatpages app provides a template tag that allows you to iterate\nover all of the available flatpages on the current site . Like all custom template tags, you’ll need to load its custom\ntag library before you can use\nit. After loading the library, you can retrieve all current flatpages\nvia the get_flatpages tag: {% load flatpages %} {% get_flatpages as flatpages %} < ul > {% for page in flatpages %} < li >< a href = \" {{ page.url }} \" > {{ page.title }} </ a ></ li > {% endfor %} </ ul > Displaying registration_required flatpages ¶ By default, the get_flatpages template tag will only show\nflatpages that are marked registration_required = False . If you\nwant to display registration-protected flatpages, you need to specify\nan authenticated user using a for clause. For example: {% get_flatpages for someuser as about_pages %} If you provide an anonymous user, get_flatpages will behave\nthe same as if you hadn’t provided a user – i.e., it will only show you\npublic flatpages. Limiting flatpages by base URL ¶ An optional argument, starts_with , can be applied to limit the\nreturned pages to those beginning with a particular base URL. This\nargument may be passed as a string, or as a variable to be resolved\nfrom the context. For example: {% get_flatpages '/about/' as about_pages %} {% get_flatpages about_prefix as about_pages %} {% get_flatpages '/about/' for someuser as about_pages %} Integrating with django.contrib.sitemaps ¶ class FlatPageSitemap [source] ¶ The sitemaps.FlatPageSitemap class looks at all\npublicly visible flatpages defined for the current SITE_ID (see the sites documentation ) and creates an entry in the sitemap. These entries\ninclude only the location attribute – not lastmod , changefreq or priority . Example ¶ Here’s an example of a URLconf using FlatPageSitemap : from django.contrib.flatpages.sitemaps import FlatPageSitemap from django.contrib.sitemaps.views import sitemap from django.urls import path urlpatterns = [ # ... # the sitemap path ( \"sitemap.xml\" , sitemap , { \"sitemaps\" : { \"flatpages\" : FlatPageSitemap }}, name = \"django.contrib.sitemaps.views.sitemap\" , ), ]", "keywords": ["matters", "users", "views", "view", "us/", "/license/", "changefreq", "status", "pattern", "url", "slash", "error", "permissions", "check", "code", "site", "algorithm", "404s", "pages", "django.contrib", "library", "false", "someuser", "string", "flatpages", "example", "field", "#", "class", "app", "_", "clause", "list", "sample", "unregister", "returns", "text", "request", "database", "table", "location", "steps", "enable_comments", "match", "page", "re", "flatpage.content", "migrate", "ways", "django.contrib.flatpages.middleware", "variable", "model", "contrib.flatpages", "change", "admin", "django.urls", "application", "django", "http", "flatpageadmin", "title", "=", "django.contrib.flatpages.models", "redirects", "systemwide", "fields", "head", "entry", "urlconf", "installation", "django.contrib.sites", "set", "validation", "get_flatpages", "lastmod", "href", "bunch", "urlpatterns", "setup", "500s", "tables", "tag", "url>.*/)$", "escalation", "via", "section", "starts_with", "source", "works", "policy", "flatpage", "case", "lookup", "flatpagesitemap", "base", "html", "server", "django.contrib.flatpages.forms", "^(?p", "security", "django.contrib.flatpages.sitemaps", "ul", "middleware", "custom", "objects", "end", "documentation", "flatpagefallbackmiddleware", "entries", "file", "contrib", "work", "default.html", "order", "interface", "consequence", "default", "sitemaps", "user", "li", "django.utils.translation", "path", "modeladmin", "doctype", "django.contrib.sitemaps", "form", "attribute", "none", "docs", "classes", "re_path", "django.contrib.flatpages", "resort", "warning", "gettext_lazy", "time", "patterns", "tags", "framework", "setting", "responses", "lang", "sitemap", "urls", "fieldset", "api", "installed_apps", "priority", "object", "load", "django.contrib.sitemaps.views", "context", "edit", "permission", "privacy", "import", "name", "template", "management", "response", "off", "directory", "%", "site_id", "requests", "page.title", "attempts", "endfor", "python", "flatpage.title", "requestcontext", "methods", "template_name", "options", "index", "django_flatpage", "exception", "resolution", "party", "registration", "django.contrib.sitemaps.views.sitemap", "license", "settings", "responsibility", "argument", "¶", "command", "id", "sites", "body", "internal", "system", "catchall", "apps", "clicking", "vulnerabilities", "templates", "fieldsets", "django_flatpage_sites", "content", "project"], "type": "documentation"},
{"title": "User authentication in Django | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/auth/", "content": "User authentication in Django ¶ Django comes with a user authentication system. It handles user accounts,\ngroups, permissions and cookie-based user sessions. This section of the\ndocumentation explains how the default implementation works out of the box, as\nwell as how to extend and customize it to\nsuit your project’s needs. Overview ¶ The Django authentication system handles both authentication and authorization.\nBriefly, authentication verifies a user is who they claim to be, and\nauthorization determines what an authenticated user is allowed to do. Here the\nterm authentication is used to refer to both tasks. The auth system consists of: Users Permissions: Binary (yes/no) flags designating whether a user may perform\na certain task. Groups: A generic way of applying labels and permissions to more than one\nuser. A configurable password hashing system Forms and view tools for logging in users, or restricting content A pluggable backend system The authentication system in Django aims to be very generic and doesn’t provide\nsome features commonly found in web authentication systems. Solutions for some\nof these common problems have been implemented in third-party packages: Password strength checking Throttling of login attempts Authentication against third-parties (OAuth, for example) Object-level permissions Installation ¶ Authentication support is bundled as a Django contrib module in django.contrib.auth . By default, the required configuration is already\nincluded in the settings.py generated by django-admin startproject , these consist of two items listed in your INSTALLED_APPS setting: 'django.contrib.auth' contains the core of the authentication framework,\nand its default models. 'django.contrib.contenttypes' is the Django content type system , which allows permissions to be associated with\nmodels you create. and these items in your MIDDLEWARE setting: SessionMiddleware manages sessions across requests. AuthenticationMiddleware associates\nusers with requests using sessions. With these settings in place, running the command manage.py migrate creates\nthe necessary database tables for auth related models and permissions for any\nmodels defined in your installed apps. Usage ¶ Using Django’s default implementation Working with User objects Permissions and authorization Authentication in web requests Managing users in the admin API reference for the default implementation Customizing Users and authentication Password management in Django", "keywords": ["users", "accounts", "box", "view", "binary", "items", "sessionmiddleware", "login", "permissions", "module", "forms", "features", "auth", "example", "overview", "customizing", "parties", "database", "strength", "models", "migrate", "level", "needs", "place", "systems", "labels", "usage", "django", "configuration", "installation", "briefly", "tables", "section", "oauth", "implementation", "authentication", "authorization", "backend", "task", "type", "middleware", "documentation", "contrib", "core", "consist", "startproject", "default", "user", "associates", "term", "packages", "framework", "setting", "authenticationmiddleware", "api", "installed_apps", "sessions", "support", "object", "groups", "password", "management", "flags", "requests", "way", "attempts", "reference", "web", "django.contrib.auth", "problems", "party", "throttling", "settings", "¶", "command", "cookie", "tasks", "django.contrib.contenttypes", "system", "tools", "apps", "no", "solutions", "content", "project"], "type": "documentation"},
{"title": "The Django admin documentation generator | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/admin/admindocs/", "content": "The Django admin documentation generator ¶ Django’s admindocs app pulls documentation from the\ndocstrings of models, views, template tags, and template filters for any app in INSTALLED_APPS and makes that documentation available from the Django admin . Overview ¶ To activate the admindocs , you will need to do\nthe following: Add django.contrib.admindocs to your INSTALLED_APPS . Add path('admin/doc/', include('django.contrib.admindocs.urls')) to\nyour urlpatterns . Make sure it’s included before the 'admin/' entry, so that requests to /admin/doc/ don’t get\nhandled by the latter entry. Install the docutils 0.19+ package. Optional: Using the admindocs bookmarklets requires django.contrib.admindocs.middleware.XViewMiddleware to be installed. Once those steps are complete, you can start browsing the documentation by\ngoing to your admin interface and clicking the “Documentation” link in the\nupper right of the page. Documentation helpers ¶ The following special markup can be used in your docstrings to easily create\nhyperlinks to other components: Django Component reStructuredText roles Models :model:`app_label.ModelName` Views :view:`app_label.view_name` Template tags :tag:`tagname` Template filters :filter:`filtername` Templates :template:`path/to/template.html` Model reference ¶ The models section of the admindocs page describes each model in the\nsystem along with all the fields, properties, and methods available on it.\nRelationships to other models appear as hyperlinks. Descriptions are pulled\nfrom help_text attributes on fields or from docstrings on model methods. A model with useful documentation might look like this: class BlogEntry ( models . Model ): \"\"\" Stores a single blog entry, related to :model:`blog.Blog` and :model:`auth.User`. \"\"\" slug = models . SlugField ( help_text = \"A short label, generally used in URLs.\" ) author = models . ForeignKey ( User , models . SET_NULL , blank = True , null = True , ) blog = models . ForeignKey ( Blog , models . CASCADE ) ... def publish ( self ): \"\"\"Makes the blog entry live on the site.\"\"\" ... View reference ¶ Each URL in your site has a separate entry in the admindocs page, and\nclicking on a given URL will show you the corresponding view. Helpful things\nyou can document in your view function docstrings include: A short description of what the view does. The context , or a list of variables available in the view’s template. The name of the template or templates that are used for that view. For example: from django.shortcuts import render from myapp.models import MyModel def my_view ( request , slug ): \"\"\" Display an individual :model:`myapp.MyModel`. **Context** ``mymodel`` An instance of :model:`myapp.MyModel`. **Template:** :template:`myapp/my_template.html` \"\"\" context = { \"mymodel\" : MyModel . objects . get ( slug = slug )} return render ( request , \"myapp/my_template.html\" , context ) Template tags and filters reference ¶ The tags and filters admindocs sections describe all the tags and\nfilters that come with Django (in fact, the built-in tag reference and built-in filter reference documentation come directly from those\npages). Any tags or filters that you create or are added by a third-party app\nwill show up in these sections as well. Template reference ¶ While admindocs does not include a place to document templates by\nthemselves, if you use the :template:`path/to/template.html` syntax in a\ndocstring the resulting page will verify the path of that template with\nDjango’s template loaders . This can be a handy way to\ncheck if the specified template exists and to show where on the filesystem that\ntemplate is stored. Included Bookmarklets ¶ One bookmarklet is available from the admindocs page: Documentation for this page Jumps you from any page to the documentation for the view that generates\nthat page. Using this bookmarklet requires that XViewMiddleware is installed and that\nyou are logged into the Django admin as a User with is_staff set to True .", "keywords": ["function", "mymodel", "my_template.html", "views", "view", "relationships", "right", "url", "def", "docutils", "site", "pages", "filter", "link", "class", "example", ":*", "app", "overview", "list", "template.html", "xviewmiddleware", "request", "bookmarklet", "stores", "steps", "*", "models", "docstrings", "page", "include('django.contrib.admindocs.urls", "blogentry", "model", "sections", "admin", "place", "admin/", "attributes", "label", "django", "help_text", "slugfield", "filter:`filtername", "=", "myapp", "n’t", "fields", "entry", "fact", "syntax", "urlpatterns", "django.contrib.admindocs", "tag", "section", "filesystem", "component", "slug", "modelname", "following", "author", "package", "self", "instance", "generator", "documentation", "set_null", "publish", "interface", "user", "descriptions", "helpers", "path", "markup", "template:`path", "my_view", "properties", "filters", "bookmarklets", "restructuredtext", "django.contrib.admindocs.middleware", "tags", "render", "true", "components", "urls", "installed_apps", "description", "myapp.models", "things", "document", "context", "individual", "import", "cascade", "name", "template", "path('admin", "loaders", "foreignkey", "way", "reference", "methods", "optional", "party", "variables", "¶", "return", "hyperlinks", "admindocs", "system", "model:`auth", "templates", "blog"], "type": "documentation"},
{"title": "django.urls functions for use in URLconfs | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/urls/", "content": "django.urls functions for use in URLconfs ¶ path() ¶ path ( route , view , kwargs = None , name = None ) ¶ Returns an element for inclusion in urlpatterns . For example: from django.urls import include , path urlpatterns = [ path ( \"index/\" , views . index , name = \"main-view\" ), path ( \"bio/<username>/\" , views . bio , name = \"bio\" ), path ( \"articles/<slug:title>/\" , views . article , name = \"article-detail\" ), path ( \"articles/<slug:title>/<int:section>/\" , views . section , name = \"article-section\" ), path ( \"blog/\" , include ( \"blog.urls\" )), ... , ] route ¶ The route argument should be a string or gettext_lazy() (see Translating URL patterns ) that contains a URL pattern. The string\nmay contain angle brackets (like <username> above) to capture part of the\nURL and send it as a keyword argument to the view. The angle brackets may\ninclude a converter specification (like the int part of <int:section> )\nwhich limits the characters matched and may also change the type of the\nvariable passed to the view. For example, <int:section> matches a string\nof decimal digits and converts the value to an int . When processing a request, Django starts at the first pattern in urlpatterns and makes its way down the list, comparing the requested URL\nagainst each pattern until it finds one that matches. See How Django processes a request for more details. Patterns don’t match GET and POST parameters, or the domain name. For example,\nin a request to https://www.example.com/myapp/ , the URLconf will look for myapp/ . In a request to https://www.example.com/myapp/?page=3 , the\nURLconf will also look for myapp/ . view ¶ The view argument is a view function or the result of as_view() for class-based views. It can\nalso be a django.urls.include() . When Django finds a matching pattern, it calls the specified view function with\nan HttpRequest object as the first argument and any\n“captured” values from the route as keyword arguments. kwargs ¶ The kwargs argument allows you to pass additional arguments to the view\nfunction or method. See Passing extra options to view functions for an example. name ¶ Naming your URL lets you refer to it unambiguously from elsewhere in Django,\nespecially from within templates. This powerful feature allows you to make\nglobal changes to the URL patterns of your project while only touching a single\nfile. See Naming URL patterns for why the name argument is useful. re_path() ¶ re_path ( route , view , kwargs = None , name = None ) ¶ Returns an element for inclusion in urlpatterns . For example: from django.urls import include , re_path urlpatterns = [ re_path ( r \"^index/$\" , views . index , name = \"index\" ), re_path ( r \"^bio/(?P<username>\\w+)/$\" , views . bio , name = \"bio\" ), re_path ( r \"^blog/\" , include ( \"blog.urls\" )), ... , ] The route argument should be a string or gettext_lazy() (see Translating URL patterns ) that contains a regular expression compatible\nwith Python’s re module. Strings typically use raw string syntax\n( r'' ) so that they can contain sequences like \\d without the need to\nescape the backslash with another backslash. When a match is made, captured\ngroups from the regular expression are passed to the view – as named arguments\nif the groups are named, and as positional arguments otherwise. The values are\npassed as strings, without any type conversion. When a route ends with $ the whole requested URL, matching against path_info , must match the regular expression\npattern ( re.fullmatch() is used). The view , kwargs and name arguments are the same as for path() . include() ¶ include ( module , namespace = None ) [source] ¶ include ( pattern_list ) include ( (pattern_list , app_namespace) , namespace=None ) A function that takes a full Python import path to another URLconf module\nthat should be “included” in this place. Optionally, the application\nnamespace and instance namespace where the entries will be included\ninto can also be specified. Usually, the application namespace should be specified by the included\nmodule. If an application namespace is set, the namespace argument\ncan be used to set a different instance namespace. include() also accepts as an argument either an iterable that returns\nURL patterns or a 2-tuple containing such iterable plus the names of the\napplication namespaces. Parameters : module – URLconf module (or module name) namespace ( str ) – Instance namespace for the URL entries being included pattern_list – Iterable of path() and/or re_path() instances. app_namespace ( str ) – Application namespace for the URL entries being included See Including other URLconfs and URL namespaces and included URLconfs . register_converter() ¶ register_converter ( converter , type_name ) [source] ¶ The function for registering a converter for use in path() route s. The converter argument is a converter class, and type_name is the\nconverter name to use in path patterns. See Registering custom path converters for an example. Deprecated since version 5.1: Overriding existing converters is deprecated. django.conf.urls functions for use in URLconfs ¶ static() ¶ static. static ( prefix , view = django.views.static.serve , ** kwargs ) ¶ Helper function to return a URL pattern for serving files in debug mode: from django.conf import settings from django.conf.urls.static import static urlpatterns = [ # ... the rest of your URLconf goes here ... ] + static ( settings . MEDIA_URL , document_root = settings . MEDIA_ROOT ) handler400 ¶ handler400 ¶ A callable, or a string representing the full Python import path to the view\nthat should be called if the HTTP client has sent a request that caused an error\ncondition and a response with a status code of 400. By default, this is django.views.defaults.bad_request() . If you\nimplement a custom view, be sure it accepts request and exception arguments and returns an HttpResponseBadRequest . handler403 ¶ handler403 ¶ A callable, or a string representing the full Python import path to the view\nthat should be called if the user doesn’t have the permissions required to\naccess a resource. By default, this is django.views.defaults.permission_denied() . If you\nimplement a custom view, be sure it accepts request and exception arguments and returns an HttpResponseForbidden . handler404 ¶ handler404 ¶ A callable, or a string representing the full Python import path to the view\nthat should be called if none of the URL patterns match. By default, this is django.views.defaults.page_not_found() . If you\nimplement a custom view, be sure it accepts request and exception arguments and returns an HttpResponseNotFound . handler500 ¶ handler500 ¶ A callable, or a string representing the full Python import path to the view\nthat should be called in case of server errors. Server errors happen when you\nhave runtime errors in view code. By default, this is django.views.defaults.server_error() . If you\nimplement a custom view, be sure it accepts a request argument and returns\nan HttpResponseServerError .", "keywords": ["function", "views", "result", "view", "feature", "s.", "username", "status", "pattern", "django.views.static.serve", "url", "permissions", "error", "django.views.defaults.server_error", "module", "code", "values", "string", "class", "example", "#", "list", "section>/", "names", "request", "route", "django.views.defaults.page_not_found", "*", "match", "re", "re.fullmatch", "version", "strings", "variable", "^bio/(?p", "django.urls", "place", "handler500", "urlconfs", "element", "article", "application", "namespace", "sequences", "path_info", "condition", "media_url", "django", "http", "=", "changes", "n’t", "brackets", "urlconf", "register_converter", "converter", "app_namespace", "syntax", "r", "urlpatterns", "django.urls.include", "value", "section", "httpresponsenotfound", "source", "converters", "specification", "case", "debug", "httpresponseforbidden", "use", "runtime", "errors", "^index/$", "tuple", "server", "str", "arguments", "django.conf.urls", "iterable", "type", "static", "need", "instance", "kwargs", "custom", "entries", "file", "bio/<username>/", "handler403", "matching", "blog.urls", "handler400", "default", "user", "type_name", "path", "functions", "inclusion", "handler404", "helper", "none", "bio", "expression", "characters", "re_path", "httpresponsebadrequest", "gettext_lazy", "digits", "get", "patterns", "title>/", "instances", "part", "mode", "object", "pattern_list", "backslash", "domain", "groups", "import", "name", "httprequest", "files", "response", "articles/<slug", "namespaces", "^blog/", "way", "as_view", "python", "keyword", "naming", "options", "index", "exception", "resource", "client", "conversion", "details", "\\d", "method", "rest", "title>/<int", "settings", "argument", "¶", "angle", "post", "parameters", "detail", "int", "templates", "project"], "type": "documentation"},
{"title": "GeoDjango Model API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/model-api/", "content": "GeoDjango Model API ¶ This document explores the details of the GeoDjango Model API.  Throughout this\nsection, we’ll be using the following geographic model of a ZIP code and\nof a Digital Elevation Model as our examples: from django.contrib.gis.db import models class Zipcode ( models . Model ): code = models . CharField ( max_length = 5 ) poly = models . PolygonField () class Elevation ( models . Model ): name = models . CharField ( max_length = 100 ) rast = models . RasterField () Spatial Field Types ¶ Spatial fields consist of a series of geometry field types and one raster field\ntype. Each of the geometry field types correspond to the OpenGIS Simple\nFeatures specification [ 1 ] . There is no such standard for raster data. GeometryField ¶ class GeometryField [source] ¶ The base class for geometry fields. PointField ¶ class PointField [source] ¶ Stores a Point . LineStringField ¶ class LineStringField [source] ¶ Stores a LineString . PolygonField ¶ class PolygonField [source] ¶ Stores a Polygon . MultiPointField ¶ class MultiPointField [source] ¶ Stores a MultiPoint . MultiLineStringField ¶ class MultiLineStringField [source] ¶ Stores a MultiLineString . MultiPolygonField ¶ class MultiPolygonField [source] ¶ Stores a MultiPolygon . GeometryCollectionField ¶ class GeometryCollectionField [source] ¶ Stores a GeometryCollection . RasterField ¶ class RasterField [source] ¶ Stores a GDALRaster . RasterField is currently only implemented for the PostGIS backend. Spatial Field Options ¶ In addition to the regular Field options available for\nDjango model fields, spatial fields have the following additional options.\nAll are optional. srid ¶ BaseSpatialField. srid ¶ Sets the SRID [ 2 ] (Spatial Reference System Identity) of the geometry field to\nthe given value. Defaults to 4326 (also known as WGS84 , units are in degrees\nof longitude and latitude). Selecting an SRID ¶ Choosing an appropriate SRID for your model is an important decision that the\ndeveloper should consider carefully.  The SRID is an integer specifier that\ncorresponds to the projection system that will be used to interpret the data\nin the spatial database. [ 3 ] Projection systems give the context to the\ncoordinates that specify a location.  Although the details of geodesy are\nbeyond the scope of this documentation, the general problem is that the earth\nis spherical and representations of the earth (e.g., paper maps, web maps)\nare not. Most people are familiar with using latitude and longitude to reference a\nlocation on the earth’s surface.  However, latitude and longitude are angles,\nnot distances. In other words, while the shortest path between two points on\na flat surface is a straight line, the shortest path between two points on a curved\nsurface (such as the earth) is an arc of a great circle . [ 4 ] Thus,\nadditional computation is required to obtain distances in planar units (e.g.,\nkilometers and miles).  Using a geographic coordinate system may introduce\ncomplications for the developer later on. For example, SpatiaLite does not have\nthe capability to perform distance calculations between geometries using\ngeographic coordinate systems, e.g. constructing a query to  find all points\nwithin 5 miles of a county boundary stored as WGS84. [ 5 ] Portions of the earth’s surface may projected onto a two-dimensional, or\nCartesian, plane.  Projected coordinate systems are especially convenient\nfor region-specific applications, e.g., if you know that your database will\nonly cover geometries in North Kansas , then you may consider using projection\nsystem specific to that region.  Moreover, projected coordinate systems are\ndefined in Cartesian units (such as meters or feet), easing distance\ncalculations. Note If you wish to perform arbitrary distance queries using non-point\ngeometries in WGS84 in PostGIS and you want decent performance, enable the GeometryField.geography keyword so that geography database\ntype is used instead. Additional Resources: spatialreference.org : A Django-powered database of spatial reference\nsystems. The State Plane Coordinate System : A website covering the various\nprojection systems used in the United States.  Much of the U.S. spatial\ndata encountered will be in one of these coordinate systems rather than\nin a geographic coordinate system such as WGS84. spatial_index ¶ BaseSpatialField. spatial_index ¶ Defaults to True .  Creates a spatial index for the given geometry\nfield. Note This is different from the db_index field option because spatial\nindexes are created in a different manner than regular database\nindexes.  Specifically, spatial indexes are typically created using\na variant of the R-Tree, while regular database indexes typically\nuse B-Trees. Geometry Field Options ¶ There are additional options available for Geometry fields. All the following\noptions are optional. dim ¶ GeometryField. dim ¶ This option may be used for customizing the coordinate dimension of the\ngeometry field.  By default, it is set to 2, for representing two-dimensional\ngeometries.  For spatial backends that support it, it may be set to 3 for\nthree-dimensional support. Note At this time 3D support is limited to the PostGIS and SpatiaLite backends. geography ¶ GeometryField. geography ¶ If set to True , this option will create a database column of\ntype geography, rather than geometry.  Please refer to the geography type section below for more\ndetails. Note Geography support is limited to PostGIS and will force the SRID to be 4326. Geography Type ¶ The geography type provides native support for spatial features represented\nwith geographic coordinates (e.g., WGS84 longitude/latitude). [ 6 ] Unlike the plane used by a geometry type, the geography type uses a spherical\nrepresentation of its data.  Distance and measurement operations\nperformed on a geography column automatically employ great circle arc\ncalculations and return linear units.  In other words, when ST_Distance is called on two geographies, a value in meters is returned (as opposed\nto degrees if called on a geometry column in WGS84). Because geography calculations involve more mathematics, only a subset of the\nPostGIS spatial lookups are available for the geography type. Practically,\nthis means that in addition to the distance lookups only the following additional spatial lookups are\navailable for geography columns: bboverlaps coveredby covers intersects If you need to use a spatial lookup or aggregate that doesn’t support the\ngeography type as input, you can use the Cast database function to convert the\ngeography column to a geometry type in the query: from django.contrib.gis.db.models import PointField from django.db.models.functions import Cast Zipcode . objects . annotate ( geom = Cast ( \"geography_field\" , PointField ())) . filter ( geom__within = poly ) For more information, the PostGIS documentation contains a helpful section on\ndetermining when to use geography data type over geometry data type . Footnotes [ 1 ] OpenGIS Consortium, Inc., Simple Feature Specification For SQL . [ 2 ] See id. at Ch. 2.3.8, p. 39 (Geometry Values and Spatial Reference Systems). [ 3 ] Typically, SRID integer corresponds to an EPSG ( European Petroleum Survey Group ) identifier.  However, it may also be associated with custom projections defined in spatial database’s spatial reference systems table. [ 4 ] Terry A. Slocum, Robert B. McMaster, Fritz C. Kessler, & Hugh H. Howard, Thematic Cartography and Geographic Visualization (Prentice Hall, 2nd edition), at Ch. 7.1.3. [ 5 ] This limitation does not apply to PostGIS. [ 6 ] Please refer to the PostGIS Geography Type documentation for more details.", "keywords": ["function", "examples", "rasterfield", "kilometers", "circle", "bboverlaps", "a.", "feature", "survey", "simple", "indexes", "tree", "multilinestringfield", "maps", "mathematics", "geometry", "b", "code", "point", "srid", "features", "kansas", "values", "robert", "postgis", "filter", "addition", "class", "example", "field", "miles", "inc.", "group", "aggregate", "raster", "column", "zipcode", "longitude", "rast", "geography", "degrees", "petroleum", "coveredby", "stores", "database", "location", "distances", "representation", "input", "table", "models", "query", "kessler", "subset", "p.", "types", "c.", "model", "words", "projections", "wgs84", "systems", "coordinate", "django.db.models.functions", ".", "boundary", "identity", "u.s.", "series", "django", "h.", "=", "dim", "max_length", "fields", "3d", "geometrycollection", "planar", "cartography", "arc", "7.1.3", "r", "epsg", "value", "section", "paper", "cast", "line", "d.", "howard", "developer", "source", "coordinates", "earth", "specification", "representations", "corresponds", "columns", "data", "fritz", "lookup", "resources", "scope", "base", "backend", "cartesian", "multipoint", "geography_field", "identifier", "type", "db_index", "variant", "people", "performance", "2.3.8", "custom", "digital", "documentation", "objects", "lookups", "geometries", "complications", "terry", "gdalraster", "region", "decision", "standard", "pointfield", "default", "django.contrib.gis.db.models", "consortium", "linestringfield", "hugh", "latitude", "path", "trees", "measurement", "visualization", "operations", "polygonfield", "multipolygonfield", "multipolygon", "states", "option", "portions", "st_distance", "problem", "slocum", "time", "spatial", "capability", "meters", "plane", "geom", "united", "true", "annotate", "django.contrib.gis.db", "geometryfield", "api", "support", "angles", "document", "linestring", "geographies", "units", "context", "north", "multipointfield", "geographic", "import", "name", "charfield", "thematic", "multilinestring", "limitation", "calculations", "website", "defaults", "sql", "b.", "edition", "points", "geom__within", "backends", "reference", "information", "web", "european", "intersects", "spatial_index", "basespatialfield", "keyword", "surface", "options", "projection", "queries", "elevation", "index", "dimension", "footnotes", "ch", "details", "geometrycollectionfield", "geodjango", "integer", "county", "spatialite", "¶", "prentice", "applications", "note", "state", "computation", "system", "feet", "mcmaster", "distance", "manner", "zip", "polygon", "hall", "geodesy"], "type": "documentation"},
{"title": "Editing mixins | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/mixins-editing/", "content": "Editing mixins ¶ The following mixins are used to construct Django’s editing views: django.views.generic.edit.FormMixin django.views.generic.edit.ModelFormMixin django.views.generic.edit.ProcessFormView django.views.generic.edit.DeletionMixin Note Examples of how these are combined into editing views can be found at\nthe documentation on Generic editing views . FormMixin ¶ class django.views.generic.edit. FormMixin ¶ A mixin class that provides facilities for creating and displaying forms. Mixins django.views.generic.base.ContextMixin Methods and Attributes initial ¶ A dictionary containing initial data for the form. form_class ¶ The form class to instantiate. success_url ¶ The URL to redirect to when the form is successfully processed. prefix ¶ The prefix for the generated form. get_initial () ¶ Retrieve initial data for the form. By default, returns a copy of initial . get_form_class () ¶ Retrieve the form class to instantiate. By default form_class . get_form ( form_class = None ) ¶ Instantiate an instance of form_class using get_form_kwargs() .\nIf form_class isn’t provided get_form_class() will be used. get_form_kwargs () ¶ Build the keyword arguments required to instantiate the form. The initial argument is set to get_initial() . If the\nrequest is a POST or PUT , the request data ( request.POST and request.FILES ) will also be provided. get_prefix () ¶ Determine the prefix for the generated form.\nReturns prefix by default. get_success_url () ¶ Determine the URL to redirect to when the form is successfully\nvalidated. Returns success_url by default. form_valid ( form ) ¶ Redirects to get_success_url() . form_invalid ( form ) ¶ Renders a response, providing the invalid form as context. get_context_data ( ** kwargs ) ¶ Calls get_form() and adds the result to the context data with the\nname ‘form’. ModelFormMixin ¶ class django.views.generic.edit. ModelFormMixin ¶ A form mixin that works on ModelForms , rather than a standalone form. Since this is a subclass of SingleObjectMixin , instances of this\nmixin have access to the model and queryset attributes,\ndescribing the type of object that the ModelForm is manipulating. If you specify both the fields and form_class attributes, an ImproperlyConfigured exception will be\nraised. Mixins django.views.generic.edit.FormMixin django.views.generic.detail.SingleObjectMixin Methods and Attributes model ¶ A model class. Can be explicitly provided, otherwise will be determined\nby examining self.object or queryset . fields ¶ A list of names of fields. This is interpreted the same way as the Meta.fields attribute of ModelForm . This is a required attribute if you are generating the form class\nautomatically (e.g. using model ). Omitting this attribute will\nresult in an ImproperlyConfigured exception. success_url ¶ The URL to redirect to when the form is successfully processed. success_url may contain dictionary string formatting, which\nwill be interpolated against the object’s field attributes. For\nexample, you could use success_url=\"/polls/{slug}/\" to\nredirect to a URL composed out of the slug field on a model. get_form_class () ¶ Retrieve the form class to instantiate. If form_class is provided,\nthat class will be used. Otherwise, a ModelForm will be\ninstantiated using the model associated with the queryset , or\nwith the model ,\ndepending on which attribute is provided. get_form_kwargs () ¶ Add the current instance ( self.object ) to the standard get_form_kwargs() . get_success_url () ¶ Determine the URL to redirect to when the form is successfully\nvalidated. Returns django.views.generic.edit.ModelFormMixin.success_url if it is\nprovided; otherwise, attempts to use the get_absolute_url() of the\nobject. form_valid ( form ) ¶ Saves the form instance, sets the current object for the view, and\nredirects to get_success_url() . form_invalid ( form ) ¶ Renders a response, providing the invalid form as context. ProcessFormView ¶ class django.views.generic.edit. ProcessFormView ¶ A mixin that provides basic HTTP GET and POST workflow. Note This is named ‘ProcessFormView’ and inherits directly from django.views.generic.base.View , but breaks if used\nindependently, so it is more of a mixin. Extends django.views.generic.base.View Methods and Attributes get ( request , * args , ** kwargs ) ¶ Renders a response using a context created with get_context_data() . post ( request , * args , ** kwargs ) ¶ Constructs a form, checks the form for validity, and handles it\naccordingly. put ( * args , ** kwargs ) ¶ The PUT action is also handled and passes all parameters through to post() . DeletionMixin ¶ class django.views.generic.edit. DeletionMixin ¶ Enables handling of the DELETE HTTP action. Methods and Attributes success_url ¶ The url to redirect to when the nominated object has been\nsuccessfully deleted. success_url may contain dictionary string formatting, which will be\ninterpolated against the object’s field attributes. For example, you\ncould use success_url=\"/parent/{parent_id}/\" to redirect to a URL\ncomposed out of the parent_id field on a model. delete ( request , * args , ** kwargs ) ¶ Retrieves the target object and calls its delete() method, then\nredirects to the success URL. get_success_url () ¶ Returns the url to redirect to when the nominated object has been\nsuccessfully deleted. Returns success_url by\ndefault.", "keywords": ["success_url=\"/polls/{slug}/", "views", "examples", "result", "view", "contextmixin", "singleobjectmixin", "url", "modelform", "target", "forms", "enables", "generic", "string", "access", "class", "example", "field", "django.views.generic.base", "modelformmixin.success_url", "list", "returns", "names", "retrieve", "request", "formatting", "processformview", "action", "facilities", "*", "copy", "get_success_url", "success_url=\"/parent/{parent_id}/", "model", "subclass", "get_form", "mixin", "attributes", "django", "formmixin", "editing", "http", "=", "n’t", "redirects", "fields", "get_absolute_url", "get_form_class", "get_form_kwargs", "modelforms", "self.object", "improperlyconfigured", "django.views.generic.detail", "data", "mixins", "parent_id", "get_prefix", "arguments", "type", "get_initial", "instance", "kwargs", "documentation", "django.views.generic.edit", "delete", "handling", "default", "validity", "success", "form", "attribute", "form_class", "prefix", "none", "args", "get", "instances", "object", "context", "files", "name", "success_url", "put", "response", "dictionary", "meta.fields", "way", "methods", "keyword", "modelformmixin", "exception", "extends", "method", "queryset", "argument", "¶", "note", "post", "parameters", "deletionmixin", "determine", "get_context_data", "renders"], "type": "documentation"},
{"title": "Built-in Views | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/views/", "content": "Built-in Views ¶ Several of Django’s built-in views are documented in Writing views as well as elsewhere in the documentation. Serving files in development ¶ static. serve ( request , path , document_root , show_indexes = False ) ¶ There may be files other than your project’s static assets that, for\nconvenience, you’d like to have Django serve for you in local development.\nThe serve() view can be used to serve any directory\nyou give it. (This view is not hardened for production use and should be\nused only as a development aid; you should serve these files in production\nusing a real front-end web server). The most likely example is user-uploaded content in MEDIA_ROOT . django.contrib.staticfiles is intended for static assets and has no\nbuilt-in handling for user-uploaded files, but you can have Django serve your MEDIA_ROOT by appending something like this to your URLconf: from django.conf import settings from django.urls import re_path from django.views.static import serve # ... the rest of your URLconf goes here ... if settings . DEBUG : urlpatterns += [ re_path ( r \"^media/(?P<path>.*)$\" , serve , { \"document_root\" : settings . MEDIA_ROOT , }, ), ] Note, the snippet assumes your MEDIA_URL has a value of 'media/' . This will call the serve() view,\npassing in the path from the URLconf and the (required) document_root parameter. Since it can become a bit cumbersome to define this URL pattern, Django\nships with a small URL helper function static() that takes as parameters the prefix such as MEDIA_URL and a dotted\npath to a view, such as 'django.views.static.serve' . Any other function\nparameter will be transparently passed to the view. Error views ¶ Django comes with a few views by default for handling HTTP errors. To override\nthese with your own custom views, see Customizing error views . The 404 (page not found) view ¶ defaults. page_not_found ( request , exception , template_name = '404.html' ) ¶ When you raise Http404 from within a view, Django loads a\nspecial view devoted to handling 404 errors. By default, it’s the view django.views.defaults.page_not_found() , which either produces a “Not\nFound” message or loads and renders the template 404.html if you created it\nin your root template directory. The default 404 view will pass two variables to the template: request_path ,\nwhich is the URL that resulted in the error, and exception , which is a\nuseful representation of the exception that triggered the view (e.g. containing\nany message passed to a specific Http404 instance). Three things to note about 404 views: The 404 view is also called if Django doesn’t find a match after\nchecking every regular expression in the URLconf. The 404 view is passed a RequestContext and\nwill have access to variables supplied by your template context\nprocessors (e.g. MEDIA_URL ). If DEBUG is set to True (in your settings module), then\nyour 404 view will never be used, and your URLconf will be displayed\ninstead, with some debug information. The 500 (server error) view ¶ defaults. server_error ( request , template_name = '500.html' ) ¶ Similarly, Django executes special-case behavior in the case of runtime errors\nin view code. If a view results in an exception, Django will, by default, call\nthe view django.views.defaults.server_error , which either produces a\n“Server Error” message or loads and renders the template 500.html if you\ncreated it in your root template directory. The default 500 view passes no variables to the 500.html template and is\nrendered with an empty Context to lessen the chance of additional errors. If DEBUG is set to True (in your settings module), then\nyour 500 view will never be used, and the traceback will be displayed\ninstead, with some debug information. The 403 (HTTP Forbidden) view ¶ defaults. permission_denied ( request , exception , template_name = '403.html' ) ¶ In the same vein as the 404 and 500 views, Django has a view to handle 403\nForbidden errors. If a view results in a 403 exception then Django will, by\ndefault, call the view django.views.defaults.permission_denied . This view loads and renders the template 403.html in your root template\ndirectory, or if this file does not exist, instead serves the text\n“403 Forbidden”, as per RFC 9110 Section 15.5.4 (the HTTP 1.1\nSpecification). The template context contains exception , which is the\nstring representation of the exception that triggered the view. django.views.defaults.permission_denied is triggered by a PermissionDenied exception. To deny access in a\nview you can use code like this: from django.core.exceptions import PermissionDenied def edit ( request , pk ): if not request . user . is_staff : raise PermissionDenied # ... The 400 (bad request) view ¶ defaults. bad_request ( request , exception , template_name = '400.html' ) ¶ When a SuspiciousOperation is raised in Django,\nit may be handled by a component of Django (for example resetting the session\ndata). If not specifically handled, Django will consider the current request a\n‘bad request’ instead of a server error. django.views.defaults.bad_request , is otherwise very similar to the server_error view, but returns with the status code 400 indicating that\nthe error condition was the result of a client operation. By default, nothing\nrelated to the exception that triggered the view is passed to the template\ncontext, as the exception message might contain sensitive information like\nfilesystem paths. bad_request views are also only used when DEBUG is False .", "keywords": ["function", "views", "django.contrib.staticfiles", "bad_request", "result", "view", "production", "status", "pattern", "django.views.static.serve", "url", "error", "django.views.defaults.server_error", "module", "code", "403.html", "false", "behavior", "string", "access", "example", "#", "show_indexes", "customizing", "returns", "snippet", "request", "page_not_found", "django.views.defaults.page_not_found", "representation", "several", "page", "match", "suspiciousoperation", "django.urls", "http404", "path>.*)$", "condition", "media_url", "django", "aid", "http", "forbidden", "=", "django.core.exceptions", "rfc", "400.html", "message", "urlconf", "permissiondenied", "development", "urlpatterns", "value", "section", "filesystem", "bit", "specification", "case", "component", "data", "debug", "use", "runtime", "errors", "server", "static", "paths", "custom", "instance", "documentation", "end", "file", "handling", "operation", "default", "user", "path", "document_root", "processors", "helper", "prefix", "expression", "re_path", "500.html", "assets", "true", "vein", "loads", "convenience", "things", "media_root", "context", "edit", "files", "import", "template", "parameter", "directory", "defaults", "traceback", "pk", "server_error", "404.html", "information", "web", "serve", "chance", "requestcontext", "template_name", "exception", "client", "variables", "^media/(?p", "rest", "settings", "ships", "root", "session", "¶", "parameters", "text", "content", "project"], "type": "documentation"},
{"title": "Cross Site Request Forgery protection | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/csrf/", "content": "Cross Site Request Forgery protection ¶ The CSRF middleware and template tag provides easy-to-use protection against Cross Site Request Forgeries . This type of attack occurs when a malicious\nwebsite contains a link, a form button or some JavaScript that is intended to\nperform some action on your website, using the credentials of a logged-in user\nwho visits the malicious site in their browser. A related type of attack,\n‘login CSRF’, where an attacking site tricks a user’s browser into logging into\na site with someone else’s credentials, is also covered. The first defense against CSRF attacks is to ensure that GET requests (and other\n‘safe’ methods, as defined by RFC 9110 Section 9.2.1 ) are side effect free.\nRequests via ‘unsafe’ methods, such as POST, PUT, and DELETE, can then be\nprotected by the steps outlined in How to use Django’s CSRF protection . How it works ¶ The CSRF protection is based on the following things: A CSRF cookie that is a random secret value, which other sites will not have\naccess to. CsrfViewMiddleware sends this cookie with the response whenever django.middleware.csrf.get_token() is called. It can also send it in\nother cases. For security reasons, the value of the secret is changed each\ntime a user logs in. A hidden form field with the name ‘csrfmiddlewaretoken’, present in all\noutgoing POST forms. In order to protect against BREACH attacks, the value of this field is\nnot simply the secret. It is scrambled differently with each response using\na mask. The mask is generated randomly on every call to get_token() , so\nthe form field value is different each time. This part is done by the csrf_token template tag. For all incoming requests that are not using HTTP GET, HEAD, OPTIONS or\nTRACE, a CSRF cookie must be present, and the ‘csrfmiddlewaretoken’ field\nmust be present and correct. If it isn’t, the user will get a 403 error. When validating the ‘csrfmiddlewaretoken’ field value, only the secret,\nnot the full token, is compared with the secret in the cookie value.\nThis allows the use of ever-changing tokens. While each request may use its\nown token, the secret remains common to all. This check is done by CsrfViewMiddleware . CsrfViewMiddleware verifies the Origin header , if provided by the\nbrowser, against the current host and the CSRF_TRUSTED_ORIGINS setting. This provides protection against cross-subdomain attacks. In addition, for HTTPS requests, if the Origin header isn’t provided, CsrfViewMiddleware performs strict referer checking. This means that\neven if a subdomain can set or modify cookies on your domain, it can’t force\na user to post to your application since that request won’t come from your\nown exact domain. This also addresses a man-in-the-middle attack that’s possible under HTTPS\nwhen using a session independent secret, due to the fact that HTTP Set-Cookie headers are (unfortunately) accepted by clients even when\nthey are talking to a site under HTTPS. (Referer checking is not done for\nHTTP requests because the presence of the Referer header isn’t reliable\nenough under HTTP.) If the CSRF_COOKIE_DOMAIN setting is set, the referer is compared\nagainst it. You can allow cross-subdomain requests by including a leading\ndot. For example, CSRF_COOKIE_DOMAIN = '.example.com' will allow POST\nrequests from www.example.com and api.example.com . If the setting is\nnot set, then the referer must match the HTTP Host header. Expanding the accepted referers beyond the current host or cookie domain can\nbe done with the CSRF_TRUSTED_ORIGINS setting. This ensures that only forms that have originated from trusted domains can be\nused to POST data back. It deliberately ignores GET requests (and other requests that are defined as\n‘safe’ by RFC 9110 Section 9.2.1 ). These requests ought never to have any\npotentially dangerous side effects, and so a CSRF attack with a GET request\nought to be harmless. RFC 9110 Section 9.2.1 defines POST, PUT, and DELETE\nas ‘unsafe’, and all other methods are also assumed to be unsafe, for maximum\nprotection. The CSRF protection cannot protect against man-in-the-middle attacks, so use HTTPS with HTTP Strict Transport Security . It also assumes validation of\nthe HOST header and that there aren’t any cross-site scripting vulnerabilities on your site\n(because XSS vulnerabilities already let an attacker do anything a CSRF\nvulnerability allows and much worse). Removing the Referer header To avoid disclosing the referrer URL to third-party sites, you might want\nto disable the referer on your site’s <a> tags. For example, you\nmight use the <meta name=\"referrer\" content=\"no-referrer\"> tag or\ninclude the Referrer-Policy: no-referrer header. Due to the CSRF\nprotection’s strict referer checking on HTTPS requests, those techniques\ncause a CSRF failure on requests with ‘unsafe’ methods. Instead, use\nalternatives like <a rel=\"noreferrer\" ...>\" for links to third-party\nsites. Limitations ¶ Subdomains within a site will be able to set cookies on the client for the whole\ndomain. By setting the cookie and using a corresponding token, subdomains will\nbe able to circumvent the CSRF protection. The only way to avoid this is to\nensure that subdomains are controlled by trusted users (or, are at least unable\nto set cookies). Note that even without CSRF, there are other vulnerabilities,\nsuch as session fixation, that make giving subdomains to untrusted parties a bad\nidea, and these vulnerabilities cannot easily be fixed with current browsers. Utilities ¶ The examples below assume you are using function-based views. If you\nare working with class-based views, you can refer to Decorating\nclass-based views . csrf_exempt ( view ) [source] ¶ This decorator marks a view as being exempt from the protection ensured by\nthe middleware. Example: from django.http import HttpResponse from django.views.decorators.csrf import csrf_exempt @csrf_exempt def my_view ( request ): return HttpResponse ( \"Hello world\" ) Changed in Django 5.0: Support for wrapping asynchronous view functions was added. csrf_protect ( view ) ¶ Decorator that provides the protection of CsrfViewMiddleware to a view. Usage: from django.shortcuts import render from django.views.decorators.csrf import csrf_protect @csrf_protect def my_view ( request ): c = {} # ... return render ( request , \"a_template.html\" , c ) Changed in Django 5.0: Support for wrapping asynchronous view functions was added. requires_csrf_token ( view ) ¶ Normally the csrf_token template tag will not work if CsrfViewMiddleware.process_view or an equivalent like csrf_protect has not run. The view decorator requires_csrf_token can be used to\nensure the template tag does work. This decorator works similarly to csrf_protect , but never rejects an incoming request. Example: from django.shortcuts import render from django.views.decorators.csrf import requires_csrf_token @requires_csrf_token def my_view ( request ): c = {} # ... return render ( request , \"a_template.html\" , c ) Changed in Django 5.0: Support for wrapping asynchronous view functions was added. ensure_csrf_cookie ( view ) ¶ This decorator forces a view to send the CSRF cookie. Changed in Django 5.0: Support for wrapping asynchronous view functions was added. Settings ¶ A number of settings can be used to control Django’s CSRF behavior: CSRF_COOKIE_AGE CSRF_COOKIE_DOMAIN CSRF_COOKIE_HTTPONLY CSRF_COOKIE_NAME CSRF_COOKIE_PATH CSRF_COOKIE_SAMESITE CSRF_COOKIE_SECURE CSRF_FAILURE_VIEW CSRF_HEADER_NAME CSRF_TRUSTED_ORIGINS CSRF_USE_SESSIONS Frequently Asked Questions ¶ Is posting an arbitrary CSRF token pair (cookie and POST data) a vulnerability? ¶ No, this is by design. Without a man-in-the-middle attack, there is no way for\nan attacker to send a CSRF token cookie to a victim’s browser, so a successful\nattack would need to obtain the victim’s browser’s cookie via XSS or similar,\nin which case an attacker usually doesn’t need CSRF attacks. Some security audit tools flag this as a problem but as mentioned before, an\nattacker cannot steal a user’s browser’s CSRF cookie. “Stealing” or modifying your own token using Firebug, Chrome dev tools, etc. isn’t a vulnerability. Is it a problem that Django’s CSRF protection isn’t linked to a session by default? ¶ No, this is by design. Not linking CSRF protection to a session allows using\nthe protection on sites such as a pastebin that allow submissions from\nanonymous users which don’t have a session. If you wish to store the CSRF token in the user’s session, use the CSRF_USE_SESSIONS setting. Why might a user encounter a CSRF validation failure after logging in? ¶ For security reasons, CSRF tokens are rotated each time a user logs in. Any\npage with a form generated before a login will have an old, invalid CSRF token\nand need to be reloaded. This might happen if a user uses the back button after\na login or if they log in a different browser tab.", "keywords": ["function", "a_template.html", "users", "submissions", "views", "failure", "examples", "fixation", "view", "number", "login", "referers", "headers", "url", "error", "def", "check", "subdomains", "site", "secret", "forms", "forgeries", "behavior", "referer", "link", "access", "addition", "field", "example", "class", "c", "#", "token", "rel=\"noreferrer", "javascript", "attack", "parties", "request", "defense", "host", "subdomain", "action", "firebug", "steps", "scripting", "decorating", "referrer", "httpresponse", "page", "csrf_cookie_path", "transport", "name=\"referrer", "reasons", "idea", "techniques", "https", "links", "application", "mask", "pair", "usage", "presence", "django", "vulnerability", "http", "csrf_header_name", "=", "rfc", "n’t", "head", "utilities", "alternatives", "set", "dev", "validation", "pastebin", "fact", "tab", "csrfviewmiddleware.process_view", "clients", "limitations", "value", "tag", "section", "button", "source", "policy", "case", "equivalent", "data", "browser", "csrf_cookie_name", "use", "get_token", "credentials", "origin", "type", "security", "middleware", "xss", "protection", "defines", "effects", "man", "delete", "order", "default", "user", "forgery", "cases", "trace", "functions", "chrome", "form", "my_view", "csrf_protect", "problem", "decorator", "requires_csrf_token", "csrf_trusted_origins", "cross", "content=\"no", "get", "time", "tags", ".example.com", "render", "csrf_cookie_samesite", "setting", "browsers", "checking", "part", "support", "cookies", "domains", "things", "victim", "domain", "csrf_cookie_secure", "import", "name", "csrfviewmiddleware", "dot", "put", "template", "response", "website", "header", "call", "world", "requests", "csrf_use_sessions", "way", "tokens", "audit", "strict", "methods", "csrf", "options", "client", "csrf_cookie_domain", "party", "breach", "session", "settings", "¶", "return", "attacker", "cookie", "questions", "post", "sites", "effect", "attacks", "tools", "vulnerabilities", "side", "design", "no"], "type": "documentation"},
{"title": "Design philosophies | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/misc/design-philosophies/", "content": "Design philosophies ¶ This document explains some of the fundamental philosophies Django’s developers\nhave used in creating the framework. Its goal is to explain the past and guide\nthe future. Overall ¶ Loose coupling ¶ A fundamental goal of Django’s stack is loose coupling and tight cohesion .\nThe various layers of the framework shouldn’t “know” about each other unless\nabsolutely necessary. For example, the template system knows nothing about web requests, the database\nlayer knows nothing about data display and the view system doesn’t care which\ntemplate system a programmer uses. Although Django comes with a full stack for convenience, the pieces of the\nstack are independent of another wherever possible. Less code ¶ Django apps should use as little code as possible; they should lack boilerplate.\nDjango should take full advantage of Python’s dynamic capabilities, such as\nintrospection. Quick development ¶ The point of a web framework in the 21st century is to make the tedious aspects\nof web development fast. Django should allow for incredibly quick web\ndevelopment. Don’t repeat yourself (DRY) ¶ Every distinct concept and/or piece of data should live in one, and only one,\nplace. Redundancy is bad. Normalization is good. The framework, within reason, should deduce as much as possible from as little\nas possible. See also The discussion of DRY on the Portland Pattern Repository Explicit is better than implicit ¶ This is a core Python principle listed in PEP 20 , and it means Django\nshouldn’t do too much “magic.” Magic shouldn’t happen unless there’s a really\ngood reason for it. Magic is worth using only if it creates a huge convenience\nunattainable in other ways, and it isn’t implemented in a way that confuses\ndevelopers who are trying to learn how to use the feature. Consistency ¶ The framework should be consistent at all levels. Consistency applies to\neverything from low-level (the Python coding style used) to high-level (the\n“experience” of using Django). Models ¶ Explicit is better than implicit ¶ Fields shouldn’t assume certain behaviors based solely on the name of the\nfield. This requires too much knowledge of the system and is prone to errors.\nInstead, behaviors should be based on keyword arguments and, in some cases, on\nthe type of the field. Include all relevant domain logic ¶ Models should encapsulate every aspect of an “object,” following Martin\nFowler’s Active Record design pattern. This is why both the data represented by a model and information about\nit (its human-readable name, options like default ordering, etc.) are\ndefined in the model class; all the information needed to understand a\ngiven model should be stored in the model. Database API ¶ The core goals of the database API are: SQL efficiency ¶ It should execute SQL statements as few times as possible, and it should\noptimize statements internally. This is why developers need to call save() explicitly, rather than the\nframework saving things behind the scenes silently. This is also why the select_related() QuerySet method exists. It’s an\noptional performance booster for the common case of selecting “every related\nobject.” Terse, powerful syntax ¶ The database API should allow rich, expressive statements in as little syntax\nas possible. It should not rely on importing other modules or helper objects. Joins should be performed automatically, behind the scenes, when necessary. Every object should be able to access every related object, systemwide. This\naccess should work both ways. Option to drop into raw SQL easily, when needed ¶ The database API should realize it’s a shortcut but not necessarily an\nend-all-be-all. The framework should make it easy to write custom SQL – entire\nstatements, or just custom WHERE clauses as custom parameters to API calls. URL design ¶ Loose coupling ¶ URLs in a Django app should not be coupled to the underlying Python code. Tying\nURLs to Python function names is a Bad And Ugly Thing. Along these lines, the Django URL system should allow URLs for the same app to\nbe different in different contexts. For example, one site may put stories at /stories/ , while another may use /news/ . Infinite flexibility ¶ URLs should be as flexible as possible. Any conceivable URL design should be\nallowed. Encourage best practices ¶ The framework should make it just as easy (or even easier) for a developer to\ndesign pretty URLs than ugly ones. File extensions in web-page URLs should be avoided. Vignette-style commas in URLs deserve severe punishment. Definitive URLs ¶ Technically, foo.com/bar and foo.com/bar/ are two different URLs, and\nsearch-engine robots (and some web traffic-analyzing tools) would treat them as\nseparate pages. Django should make an effort to “normalize” URLs so that\nsearch-engine robots don’t get confused. This is the reasoning behind the APPEND_SLASH setting. Template system ¶ Separate logic from presentation ¶ We see a template system as a tool that controls presentation and\npresentation-related logic – and that’s it. The template system shouldn’t\nsupport functionality that goes beyond this basic goal. Discourage redundancy ¶ The majority of dynamic websites use some sort of common sitewide design –\na common header, footer, navigation bar, etc. The Django template system should\nmake it easy to store those elements in a single place, eliminating duplicate\ncode. This is the philosophy behind template inheritance . Be decoupled from HTML ¶ The template system shouldn’t be designed so that it only outputs HTML. It\nshould be equally good at generating other text-based formats, or just plain\ntext. XML should not be used for template languages ¶ Using an XML engine to parse templates introduces a whole new world of human\nerror in editing templates – and incurs an unacceptable level of overhead in\ntemplate processing. Assume designer competence ¶ The template system shouldn’t be designed so that templates necessarily are\ndisplayed nicely in WYSIWYG editors such as Dreamweaver. That is too severe of\na limitation and wouldn’t allow the syntax to be as nice as it is. Django\nexpects template authors are comfortable editing HTML directly. Treat whitespace obviously ¶ The template system shouldn’t do magic things with whitespace. If a template\nincludes whitespace, the system should treat the whitespace as it treats text\n– just display it. Any whitespace that’s not in a template tag should be\ndisplayed. Don’t invent a programming language ¶ The goal is not to invent a programming language. The goal is to offer just\nenough programming-esque functionality, such as branching and looping, that is\nessential for making presentation-related decisions. The Django Template\nLanguage (DTL) aims to avoid advanced logic. Safety and security ¶ The template system, out of the box, should forbid the inclusion of malicious\ncode – such as commands that delete database records. This is another reason the template system doesn’t allow arbitrary Python code. Extensibility ¶ The template system should recognize that advanced template authors may want\nto extend its technology. This is the philosophy behind custom template tags and filters. Views ¶ Simplicity ¶ Writing a view should be as simple as writing a Python function. Developers\nshouldn’t have to instantiate a class when a function will do. Use request objects ¶ Views should have access to a request object – an object that stores metadata\nabout the current request. The object should be passed directly to a view\nfunction, rather than the view function having to access the request data from\na global variable. This makes it light, clean and easy to test views by passing\nin “fake” request objects. Loose coupling ¶ A view shouldn’t care about which template system the developer uses – or even\nwhether a template system is used at all. Differentiate between GET and POST ¶ GET and POST are distinct; developers should explicitly use one or the other.\nThe framework should make it easy to distinguish between GET and POST data. Cache Framework ¶ The core goals of Django’s cache framework are: Less code ¶ A cache should be as fast as possible.  Hence, all framework code surrounding\nthe cache backend should be kept to the absolute minimum, especially for get() operations. Consistency ¶ The cache API should provide a consistent interface across the different\ncache backends. Extensibility ¶ The cache API should be extensible at the application level based on the\ndeveloper’s needs (for example, see Cache key transformation ).", "keywords": ["function", "views", "goal", "box", "view", "knowledge", "websites", "feature", "select_related", "pattern", "url", "efficiency", "error", "code", "point", "site", "consistency", "safety", "pages", "style", "access", "display", "example", "field", "class", "app", "introspection", "record", "pieces", "thing", "names", "aspect", "metadata", "request", "past", "traffic", "stores", "database", "explicit", "technology", "language", "lines", "models", "stack", "page", "programming", "commands", "wysiwyg", "cache", "ways", "level", "elements", "model", "variable", "needs", "dtl", "tool", "decisions", "robots", "place", "martin", "application", "dry", "minimum", "sort", "django", "navigation", "xml", "effort", "fields", "engine", "languages", "development", "editors", "contexts", "flexibility", "philosophy", "syntax", "capabilities", "reasoning", "redundancy", "tag", "separate", "/stories/", "developer", "ones", "discussion", "case", "principle", "pep", "data", "experience", "fowler", "backend", "errors", "html", "commas", "layer", "future", "technically", "arguments", "normalization", "type", "processing", "security", "magic", "goals", "shortcut", "repository", "calls", "performance", "custom", "stories", "objects", "end", "vignette", "active", "designer", "/news/", "file", "core", "extensions", "records", "levels", "cohesion", "aspects", "modules", "interface", "default", "bar", "cases", "functionality", "inclusion", "operations", "layers", "helper", "option", "scenes", "filters", "developers", "ugly", "transformation", "portland", "get", "sitewide", "joins", "tags", "reason", "framework", "save", "setting", "urls", "foo.com/bar", "api", "advantage", "convenience", "support", "simplicity", "loose", "document", "object", "things", "domain", "foo.com/bar/", "logic", "name", "extensibility", "limitation", "template", "booster", "statements", "header", "sql", "footer", "whitespace", "world", "requests", "authors", "way", "formats", "information", "backends", "web", "python", "keyword", "quick", "discourage", "options", "times", "ordering", "punishment", "concept", "assume", "majority", "method", "queryset", "definitive", "piece", "¶", "coupling", "behaviors", "parameters", "post", "system", "apps", "practices", "programmer", "tools", "search", "inheritance", "competence", "design", "templates", "presentation", "overhead", "dreamweaver", "text", "philosophies", "century"], "type": "documentation"},
{"title": "Single object mixins | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/mixins-single-object/", "content": "Single object mixins ¶ SingleObjectMixin ¶ class django.views.generic.detail. SingleObjectMixin ¶ Provides a mechanism for looking up an object associated with the\ncurrent HTTP request. Methods and Attributes model ¶ The model that this view will display data for. Specifying model = Foo is effectively the same as specifying queryset = Foo.objects.all() , where objects stands for Foo ’s default manager . queryset ¶ A QuerySet that represents the objects. If provided, the value of queryset supersedes the value provided for model . Warning queryset is a class attribute with a mutable value so care\nmust be taken when using it directly. Before using it, either call\nits all() method or\nretrieve it with get_queryset() which takes care of the\ncloning behind the scenes. slug_field ¶ The name of the field on the model that contains the slug. By default, slug_field is 'slug' . slug_url_kwarg ¶ The name of the URLConf keyword argument that contains the slug. By\ndefault, slug_url_kwarg is 'slug' . pk_url_kwarg ¶ The name of the URLConf keyword argument that contains the primary key.\nBy default, pk_url_kwarg is 'pk' . context_object_name ¶ Designates the name of the variable to use in the context. query_pk_and_slug ¶ If True , causes get_object() to perform its lookup using\nboth the primary key and the slug. Defaults to False . This attribute can help mitigate insecure direct object reference attacks. When applications allow access to individual objects by a\nsequential primary key, an attacker could brute-force guess all URLs;\nthereby obtaining a list of all objects in the application. If users\nwith access to individual objects should be prevented from obtaining\nthis list, setting query_pk_and_slug to True will help prevent\nthe guessing of URLs as each URL will require two correct,\nnon-sequential arguments. Using a unique slug may serve the same\npurpose, but this scheme allows you to have non-unique slugs. get_object ( queryset = None ) ¶ Returns the single object that this view will display. If queryset is provided, that queryset will be used as the source of objects;\notherwise, get_queryset() will be used. get_object() looks\nfor a pk_url_kwarg argument in the arguments to the view; if\nthis argument is found, this method performs a primary-key based lookup\nusing that value. If this argument is not found, it looks for a slug_url_kwarg argument, and performs a slug lookup using the slug_field . When query_pk_and_slug is True , get_object() will\nperform its lookup using both the primary key and the slug. get_queryset () ¶ Returns the queryset that will be used to retrieve the object that\nthis view will display. By default, get_queryset() returns the\nvalue of the queryset attribute if it is set, otherwise\nit constructs a QuerySet by calling\nthe all() method on the model attribute’s default manager. get_context_object_name ( obj ) ¶ Return the context variable name that will be used to contain the\ndata that this view is manipulating. If context_object_name is\nnot set, the context name will be constructed from the model_name of the model that the queryset is composed from. For example, the model Article would have context object named 'article' . get_context_data ( ** kwargs ) ¶ Returns context data for displaying the object. The base implementation of this method requires that the self.object attribute be set by the view (even if None ). Be sure to do this if\nyou are using this mixin without one of the built-in views that does so. It returns a dictionary with these contents: object : The object that this view is displaying\n( self.object ). context_object_name : self.object will also be stored under\nthe name returned by get_context_object_name() , which defaults\nto the lowercased version of the model name. Context variables override values from template context processors Any variables from get_context_data() take precedence over\ncontext variables from context processors . For example, if your view\nsets the model attribute to User , the default context\nobject name of user would override the user variable from\nthe django.contrib.auth.context_processors.auth() context\nprocessor. Use get_context_object_name() to avoid a clash. get_slug_field () ¶ Returns the name of a slug field to be used to look up by slug. By\ndefault this returns the value of slug_field . SingleObjectTemplateResponseMixin ¶ class django.views.generic.detail. SingleObjectTemplateResponseMixin ¶ A mixin class that performs template-based response rendering for views\nthat operate upon a single object instance. Requires that the view it is\nmixed with provides self.object , the object instance that the view is\noperating on. self.object will usually be, but is not required to be,\nan instance of a Django model. It may be None if the view is in the\nprocess of constructing a new instance. Extends TemplateResponseMixin Methods and Attributes template_name_field ¶ The field on the current object instance that can be used to determine\nthe name of a candidate template. If either template_name_field itself or the value of the template_name_field on the current\nobject instance is None , the object will not be used for a\ncandidate template name. template_name_suffix ¶ The suffix to append to the auto-generated candidate template name.\nDefault suffix is _detail . get_template_names () ¶ Returns a list of candidate template names. Returns the following list: the value of template_name on the view (if provided) the contents of the template_name_field field on the\nobject instance that the view is operating upon (if available) <app_label>/<model_name><template_name_suffix>.html", "keywords": ["users", "get_queryset", "views", "view", "singleobjectmixin", "url", "query_pk_and_slug", "values", "false", "access", "class", "example", "care", "field", "list", "returns", "names", "auto", "request", "template_name_suffix", "*", "version", "contents", "template_name_field", "model", "variable", "processor", "clash", "article", "application", "mixin", "attributes", "django", "http", "=", "pk_url_kwarg", "cloning", "urlconf", "singleobjecttemplateresponsemixin", "value", "self.object", "guessing", "suffix", "source", "django.views.generic.detail", "data", "get_object", "implementation", "lookup", "process", "slug", "use", "base", "arguments", "a", "instance", "foo.objects.all", "kwargs", "objects", "default", "user", "processors", "slugs", "key", "attribute", "none", "mechanism", "scenes", "warning", "django.contrib.auth.context_processors.auth", "urls", "templateresponsemixin", "get_slug_field", "scheme", "get_template_names", "object", "context", "name", "template", "response", "precedence", "candidate", "defaults", "dictionary", "reference", "supersedes", "methods", "get_context_object_name", "purpose", "extends", "manager", "force", "method", "queryset", "variables", "slug_url_kwarg", "argument", "¶", "obj", "attacker", "return", "applications", "slug_field", "model_name", "detail", "foo", "attacks", "get_context_data"], "type": "documentation"},
{"title": "Simple mixins | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/mixins-simple/", "content": "Simple mixins ¶ ContextMixin ¶ class django.views.generic.base. ContextMixin ¶ Attributes extra_context ¶ A dictionary to include in the context. This is a convenient way of\nspecifying some context in as_view() . Example usage: from django.views.generic import TemplateView TemplateView . as_view ( extra_context = { \"title\" : \"Custom Title\" }) Methods get_context_data ( ** kwargs ) ¶ Returns a dictionary representing the template context. The keyword\narguments provided will make up the returned context. Example usage: def get_context_data ( self , ** kwargs ): context = super () . get_context_data ( ** kwargs ) context [ \"number\" ] = random . randrange ( 1 , 100 ) return context The template context of all class-based generic views include a view variable that points to the View instance. Use alters_data where appropriate Note that having the view instance in the template context may\nexpose potentially hazardous methods to template authors.  To\nprevent methods like this from being called in the template, set alters_data=True on those methods.  For more information, read\nthe documentation on rendering a template context . TemplateResponseMixin ¶ class django.views.generic.base. TemplateResponseMixin ¶ Provides a mechanism to construct a TemplateResponse , given\nsuitable context. The template to use is configurable and can be\nfurther customized by subclasses. Attributes template_name ¶ The full name of a template to use as defined by a string. Not defining\na template_name will raise a django.core.exceptions.ImproperlyConfigured exception. template_engine ¶ The NAME of a template engine to use for\nloading the template. template_engine is passed as the using keyword argument to response_class . Default is None , which\ntells Django to search for the template in all configured engines. response_class ¶ The response class to be returned by render_to_response method.\nDefault is TemplateResponse . The template and context\nof TemplateResponse instances can be altered later (e.g. in template response middleware ). If you need custom template loading or custom context object\ninstantiation, create a TemplateResponse subclass and assign it to response_class . content_type ¶ The content type to use for the response. content_type is passed\nas a keyword argument to response_class . Default is None –\nmeaning that Django uses 'text/html' . Methods render_to_response ( context , ** response_kwargs ) ¶ Returns a self.response_class instance. If any keyword arguments are provided, they will be passed to the\nconstructor of the response class. Calls get_template_names() to obtain the list of template names\nthat will be searched looking for an existent template. get_template_names () ¶ Returns a list of template names to search for when rendering the\ntemplate. The first template that is found will be used. The default implementation will return a list containing template_name (if it is specified).", "keywords": ["get_template_names", "object", "views", "arguments", "loading", "view", "variable", "type", "context", "subclass", "engines", "self.response_class", "contextmixin", "import", "self", "subclasses", "custom", "kwargs", "templateview", "template", "number", "instance", "documentation", "name", "response", "usage", "attributes", "middleware", "dictionary", "django", "authors", "way", "as_view", "=", "title", "information", "django.core.exceptions", "default", "randrange", "render_to_response", "response_kwargs", "engine", "methods", "keyword", "string", "template_name", "class", "example", "response_class", "django.views.generic.base", "exception", "instantiation", "none", "mechanism", "method", "list", "returns", "argument", "¶", "names", "note", "constructor", "content_type", "alters_data", "get_context_data", "implementation", "instances", "mixins", "templateresponse", "*", "text", "html", "content", "calls", "existent"], "type": "documentation"},
{"title": "Model index reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/indexes/", "content": "Model index reference ¶ Index classes ease creating database indexes. They can be added using the Meta.indexes option. This document\nexplains the API references of Index which includes the index\noptions . Referencing built-in indexes Indexes are defined in django.db.models.indexes , but for convenience\nthey’re imported into django.db.models . The standard convention is\nto use from django.db import models and refer to the indexes as models.<IndexClass> . Index options ¶ class Index ( * expressions , fields = () , name = None , db_tablespace = None , opclasses = () , condition = None , include = None ) [source] ¶ Creates an index (B-Tree) in the database. expressions ¶ Index. expressions ¶ Positional argument *expressions allows creating functional indexes on\nexpressions and database functions. For example: Index ( Lower ( \"title\" ) . desc (), \"pub_date\" , name = \"lower_title_date_idx\" ) creates an index on the lowercased value of the title field in descending\norder and the pub_date field in the default ascending order. Another example: Index ( F ( \"height\" ) * F ( \"weight\" ), Round ( \"weight\" ), name = \"calc_idx\" ) creates an index on the result of multiplying fields height and weight and the weight rounded to the nearest integer. Index.name is required when using *expressions . Restrictions on Oracle Oracle requires functions referenced in an index to be marked as DETERMINISTIC . Django doesn’t validate this but Oracle will error. This\nmeans that functions such as Random() aren’t accepted. Restrictions on PostgreSQL PostgreSQL requires functions and operators referenced in an index to be\nmarked as IMMUTABLE . Django doesn’t validate this but PostgreSQL will\nerror. This means that functions such as Concat() aren’t accepted. MySQL and MariaDB Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither\nsupports them. fields ¶ Index. fields ¶ A list or tuple of the name of the fields on which the index is desired. By default, indexes are created with an ascending order for each column. To\ndefine an index with a descending order for a column, add a hyphen before the\nfield’s name. For example Index(fields=['headline', '-pub_date']) would create SQL with (headline, pub_date DESC) . MariaDB Index ordering isn’t supported on MariaDB < 10.8. In that case, a\ndescending index is created as a normal index. name ¶ Index. name ¶ The name of the index. If name isn’t provided Django will auto-generate a\nname. For compatibility with different databases, index names cannot be longer\nthan 30 characters and shouldn’t start with a number (0-9) or underscore (_). Partial indexes in abstract base classes You must always specify a unique name for an index. As such, you\ncannot normally specify a partial index on an abstract base class, since\nthe Meta.indexes option is\ninherited by subclasses, with exactly the same values for the attributes\n(including name ) each time. To work around name collisions, part of the\nname may contain '%(app_label)s' and '%(class)s' , which are\nreplaced, respectively, by the lowercased app label and class name of the\nconcrete model. For example Index(fields=['title'], name='%(app_label)s_%(class)s_title_index') . db_tablespace ¶ Index. db_tablespace ¶ The name of the database tablespace to use for\nthis index. For single field indexes, if db_tablespace isn’t provided, the\nindex is created in the db_tablespace of the field. If Field.db_tablespace isn’t specified (or if the index uses multiple\nfields), the index is created in tablespace specified in the db_tablespace option inside the model’s class Meta . If neither of those tablespaces are set, the index is created\nin the same tablespace as the table. See also For a list of PostgreSQL-specific indexes, see django.contrib.postgres.indexes . opclasses ¶ Index. opclasses ¶ The names of the PostgreSQL operator classes to use for\nthis index. If you require a custom operator class, you must provide one for\neach field in the index. For example, GinIndex(name='json_index', fields=['jsonfield'], opclasses=['jsonb_path_ops']) creates a gin index on jsonfield using jsonb_path_ops . opclasses are ignored for databases besides PostgreSQL. Index.name is required when using opclasses . condition ¶ Index. condition ¶ If the table is very large and your queries mostly target a subset of rows,\nit may be useful to restrict an index to that subset. Specify a condition as a Q . For example, condition=Q(pages__gt=400) indexes records with more than 400 pages. Index.name is required when using condition . Restrictions on PostgreSQL PostgreSQL requires functions referenced in the condition to be marked as\nIMMUTABLE. Django doesn’t validate this but PostgreSQL will error. This\nmeans that functions such as Date functions and Concat aren’t accepted. If you store\ndates in DateTimeField , comparison to datetime objects may require the tzinfo argument\nto be provided because otherwise the comparison could result in a mutable\nfunction due to the casting Django does for lookups . Restrictions on SQLite SQLite imposes restrictions on how a partial index can be constructed. Oracle Oracle does not support partial indexes. Instead, partial indexes can be\nemulated by using functional indexes together with Case expressions. MySQL and MariaDB The condition argument is ignored with MySQL and MariaDB as neither\nsupports conditional indexes. include ¶ Index. include ¶ A list or tuple of the names of the fields to be included in the covering index\nas non-key columns. This allows index-only scans to be used for queries that\nselect only included fields ( include ) and filter only by indexed\nfields ( fields ). For example: Index ( name = \"covering_index\" , fields = [ \"headline\" ], include = [ \"pub_date\" ]) will allow filtering on headline , also selecting pub_date , while\nfetching data only from the index. Using include will produce a smaller index than using a multiple column\nindex but with the drawback that non-key columns can not be used for sorting or\nfiltering. include is ignored for databases besides PostgreSQL. Index.name is required when using include . See the PostgreSQL documentation for more details about covering indexes . Restrictions on PostgreSQL PostgreSQL supports covering B-Tree and GiST indexes . PostgreSQL 14+ also supports\ncovering SP-GiST indexes .", "keywords": ["function", "result", "rows", "django.db.models.indexes", "indexes", "drawback", "number", "tree", "jsonfield", "multiplying", "error", "models.<indexclass", "b", "values", "pages", "class", "example", "field", "_", "app", "immutable", "column", "list", "names", "q(pages__gt=400", "desc", "auto", "databases", "fields=['jsonfield", "app_label)s", "database", "table", "lower", "index(fields=['title", "*", "models", "dates", "subset", "postgresql", "index(fields=['headline", "compatibility", "model", "calc_idx", "tablespace", "attributes", "condition", "label", "django", "=", "title", "n’t", "fields", "gist", "include", "value", "weight", "lower_title_date_idx", "source", "height", "case", "columns", "data", "underscore", "base", "tuple", "deterministic", "subclasses", "custom", "random", "opclasses=['jsonb_path_ops", "objects", "documentation", "lookups", "pub_date", "records", "gin", "sqlite", "comparison", "order", "index.name", "default", "round", "name='%(app_label)s_%(class)s_title_index", "sp", "functions", "concat", "none", "option", "classes", "characters", "meta", "mariadb", "collisions", "time", "convention", "opclasses", "django.contrib.postgres.indexes", "q", "date", "jsonb_path_ops", "operators", "hyphen", "api", "convenience", "part", "tzinfo", "f", "supports", "references", "db_tablespace", "document", "scans", "import", "name", "field.db_tablespace", "mysql", "%", "sql", "covering_index", "reference", "tablespaces", "ascending", "meta.indexes", "ginindex(name='json_index", "options", "queries", "index", "ordering", "class)s", "details", "integer", "argument", "¶", "operator", "expressions", "oracle", "headline", "filtering", "datetimefield", "restrictions"], "type": "documentation"},
{"title": "PostgreSQL specific database constraints | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/constraints/", "content": "PostgreSQL specific database constraints ¶ PostgreSQL supports additional data integrity constraints available from the django.contrib.postgres.constraints module. They are added in the model Meta.constraints option. ExclusionConstraint ¶ class ExclusionConstraint ( * , name , expressions , index_type = None , condition = None , deferrable = None , include = None , violation_error_code = None , violation_error_message = None ) [source] ¶ Creates an exclusion constraint in the database. Internally, PostgreSQL\nimplements exclusion constraints using indexes. The default index type is GiST . To use them,\nyou need to activate the btree_gist extension on PostgreSQL.\nYou can install it using the BtreeGistExtension migration\noperation. If you attempt to insert a new row that conflicts with an existing row, an IntegrityError is raised. Similarly, when update\nconflicts with an existing row. Exclusion constraints are checked during the model validation . name ¶ ExclusionConstraint. name ¶ See BaseConstraint.name . expressions ¶ ExclusionConstraint. expressions ¶ An iterable of 2-tuples. The first element is an expression or string. The\nsecond element is an SQL operator represented as a string. To avoid typos, you\nmay use RangeOperators which maps the\noperators with strings. For example: expressions = [ ( \"timespan\" , RangeOperators . ADJACENT_TO ), ( F ( \"room\" ), RangeOperators . EQUAL ), ] Restrictions on operators. Only commutative operators can be used in exclusion constraints. The OpClass() expression can\nbe used to specify a custom operator class for the constraint expressions.\nFor example: expressions = [ ( OpClass ( \"circle\" , name = \"circle_ops\" ), RangeOperators . OVERLAPS ), ] creates an exclusion constraint on circle using circle_ops . index_type ¶ ExclusionConstraint. index_type ¶ The index type of the constraint. Accepted values are GIST or SPGIST .\nMatching is case insensitive. If not provided, the default index type is GIST . condition ¶ ExclusionConstraint. condition ¶ A Q object that specifies the condition to restrict\na constraint to a subset of rows. For example, condition=Q(cancelled=False) . These conditions have the same database restrictions as django.db.models.Index.condition . deferrable ¶ ExclusionConstraint. deferrable ¶ Set this parameter to create a deferrable exclusion constraint. Accepted values\nare Deferrable.DEFERRED or Deferrable.IMMEDIATE . For example: from django.contrib.postgres.constraints import ExclusionConstraint from django.contrib.postgres.fields import RangeOperators from django.db.models import Deferrable ExclusionConstraint ( name = \"exclude_overlapping_deferred\" , expressions = [ ( \"timespan\" , RangeOperators . OVERLAPS ), ], deferrable = Deferrable . DEFERRED , ) By default constraints are not deferred. A deferred constraint will not be\nenforced until the end of the transaction. An immediate constraint will be\nenforced immediately after every command. Warning Deferred exclusion constraints may lead to a performance penalty . include ¶ ExclusionConstraint. include ¶ A list or tuple of the names of the fields to be included in the covering\nexclusion constraint as non-key columns. This allows index-only scans to be\nused for queries that select only included fields\n( include ) and filter only by indexed fields\n( expressions ). include is supported for GiST indexes. PostgreSQL 14+ also supports include for SP-GiST indexes. violation_error_code ¶ New in Django 5.0. ExclusionConstraint. violation_error_code ¶ The error code used when ValidationError is raised during model validation . Defaults to None . violation_error_message ¶ The error message used when ValidationError is raised during model validation . Defaults to BaseConstraint.violation_error_message . Examples ¶ The following example restricts overlapping reservations in the same room, not\ntaking canceled reservations into account: from django.contrib.postgres.constraints import ExclusionConstraint from django.contrib.postgres.fields import DateTimeRangeField , RangeOperators from django.db import models from django.db.models import Q class Room ( models . Model ): number = models . IntegerField () class Reservation ( models . Model ): room = models . ForeignKey ( \"Room\" , on_delete = models . CASCADE ) timespan = DateTimeRangeField () cancelled = models . BooleanField ( default = False ) class Meta : constraints = [ ExclusionConstraint ( name = \"exclude_overlapping_reservations\" , expressions = [ ( \"timespan\" , RangeOperators . OVERLAPS ), ( \"room\" , RangeOperators . EQUAL ), ], condition = Q ( cancelled = False ), ), ] In case your model defines a range using two fields, instead of the native\nPostgreSQL range types, you should write an expression that uses the equivalent\nfunction (e.g. TsTzRange() ), and use the delimiters for the field. Most\noften, the delimiters will be '[)' , meaning that the lower bound is\ninclusive and the upper bound is exclusive. You may use the RangeBoundary that provides an\nexpression mapping for the range boundaries . For example: from django.contrib.postgres.constraints import ExclusionConstraint from django.contrib.postgres.fields import ( DateTimeRangeField , RangeBoundary , RangeOperators , ) from django.db import models from django.db.models import Func , Q class TsTzRange ( Func ): function = \"TSTZRANGE\" output_field = DateTimeRangeField () class Reservation ( models . Model ): room = models . ForeignKey ( \"Room\" , on_delete = models . CASCADE ) start = models . DateTimeField () end = models . DateTimeField () cancelled = models . BooleanField ( default = False ) class Meta : constraints = [ ExclusionConstraint ( name = \"exclude_overlapping_reservations\" , expressions = [ ( TsTzRange ( \"start\" , \"end\" , RangeBoundary ()), RangeOperators . OVERLAPS , ), ( \"room\" , RangeOperators . EQUAL ), ], condition = Q ( cancelled = False ), ), ]", "keywords": ["function", "delimiters", "examples", "rows", "circle", "integrity", "integerfield", "indexes", "equal", "number", "error", "conditions", "module", "code", "values", "string", "class", "migration", "example", "datetimerangefield", "field", "func", "list", "mapping", "names", "database", "range", "*", "models", "subset", "postgresql", "types", "strings", "model", "tstzrange", "typos", "reservation", "element", "rangeoperators", "conflicts", "bound", "condition", "violation_error_message", "django", "=", "fields", "message", "gist", "set", "validation", "btree_gist", "deferrable", "baseconstraint.name", "source", "reservations", "case", "exclusionconstraint", "columns", "data", "boundaries", "room", "django.contrib.postgres.constraints", "tuple", "iterable", "type", "violation_error_code", "custom", "performance", "end", "output_field", "matching", "constraint", "tuples", "extension", "operation", "exclusion", "default", "sp", "index_type", "update", "start", "none", "option", "expression", "opclass", "constraints", "meta", "q", "new", "baseconstraint.violation_error_message", "operators", "account", "booleanfield", "validationerror", "f", "object", "scans", "exclude_overlapping_reservations", "import", "name", "cascade", "parameter", "penalty", "sql", "defaults", "foreignkey", "row", "rangeboundary", "queries", "index", "covering", "transaction", "integrityerror", "¶", "command", "operator", "django.contrib.postgres.fields", "expressions", "timespan", "btreegistextension", "adjacent_to", "circle_ops", "datetimefield", "restrictions"], "type": "documentation"},
{"title": "Glossary | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/glossary/", "content": "Glossary ¶ concrete model ¶ A non-abstract ( abstract=False ) model. field ¶ An attribute on a model ; a given field usually maps directly to\na single database column. See Models . generic view ¶ A higher-order view function that provides an abstract/generic\nimplementation of a common idiom or pattern found in view development. See Class-based views . model ¶ Models store your application’s data. See Models . MTV ¶ “Model-template-view”; a software pattern, similar in style to MVC, but\na better description of the way Django does things. See the FAQ entry . MVC ¶ Model-view-controller ; a software pattern. Django follows MVC\nto some extent . project ¶ A Python package – i.e. a directory of code – that contains all the\nsettings for an instance of Django. This would include database\nconfiguration, Django-specific options and application-specific\nsettings. property ¶ Also known as “managed attributes”, and a feature of Python since\nversion 2.2. This is a neat way to implement attributes whose usage\nresembles attribute access, but whose implementation uses method calls. See property . queryset ¶ An object representing some set of rows to be fetched from the database. See Making queries . slug ¶ A short label for something, containing only letters, numbers,\nunderscores or hyphens. They’re generally used in URLs. For\nexample, in a typical blog entry URL: https://www.djangoproject.com/weblog/2008/apr/12/ spring / the last bit ( spring ) is the slug. template ¶ A chunk of text that acts as formatting for representing data. A\ntemplate helps to abstract the presentation of data from the data\nitself. See Templates . view ¶ A function responsible for rendering a page.", "keywords": ["function", "object", "things", "views", "chunk", "rows", "model", "view", "hyphens", "feature", "package", "calls", ".", "pattern", "application", "template", "extent", "instance", "underscores", "usage", "directory", "attributes", "label", "mvc", "blog", "django", "url", "way", "code", "=", "configuration", "order", "python", "page", "mtv", "style", "entry", "access", "class", "options", "field", "development", "set", "queries", "example", "attribute", "column", "method", "letters", "urls", "settings", "¶", "spring", "bit", "idiom", "numbers", "implementation", "data", "database", "property", "glossary", "software", "faq", "controller", "slug", "presentation", "templates", "models", "text", "project", "description", "version"], "type": "documentation"},
{"title": "Django 4.2 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/4.2/", "content": "Django 4.2 release notes ¶ April 3, 2023 Welcome to Django 4.2! These release notes cover the new features , as well as\nsome backwards incompatible changes you’ll\nwant to be aware of when upgrading from Django 4.1 or earlier. We’ve begun the deprecation process for some features . See the How to upgrade Django to a newer version guide if you’re updating an existing\nproject. Django 4.2 is designated as a long-term support release . It will receive security updates for at least\nthree years after its release. Support for the previous LTS, Django 3.2, will\nend in April 2024. Python compatibility ¶ Django 4.2 supports Python 3.8, 3.9, 3.10, 3.11, and 3.12 (as of 4.2.8). We highly recommend and only officially support the latest release of each\nseries. What’s new in Django 4.2 ¶ Psycopg 3 support ¶ Django now supports psycopg version 3.1.8 or higher. To update your code,\ninstall the psycopg library , you don’t need to change the ENGINE as django.db.backends.postgresql supports both libraries. Support for psycopg2 is likely to be deprecated and removed at some point\nin the future. Be aware that psycopg 3 introduces some breaking changes over psycopg2 .\nAs a consequence, you may need to make some changes to account for differences from psycopg2 . Comments on columns and tables ¶ The new Field.db_comment and Meta.db_table_comment options allow creating comments on columns and tables, respectively. For\nexample: from django.db import models class Question ( models . Model ): text = models . TextField ( db_comment = \"Poll question\" ) pub_date = models . DateTimeField ( db_comment = \"Date and time when the question was published\" , ) class Meta : db_table_comment = \"Poll questions\" class Answer ( models . Model ): question = models . ForeignKey ( Question , on_delete = models . CASCADE , db_comment = \"Reference to a question\" , ) answer = models . TextField ( db_comment = \"Question answer\" ) class Meta : db_table_comment = \"Question answers\" Also, the new AlterModelTableComment operation allows changing table comments defined in the Meta.db_table_comment . Mitigation for the BREACH attack ¶ GZipMiddleware now includes a mitigation for\nthe BREACH attack. It will add up to 100 random bytes to gzip responses to make\nBREACH attacks harder. Read more about the mitigation technique in the Heal\nThe Breach (HTB) paper . In-memory file storage ¶ The new django.core.files.storage.InMemoryStorage class provides a\nnon-persistent storage useful for speeding up tests by avoiding disk access. Custom file storages ¶ The new STORAGES setting allows configuring multiple custom file\nstorage backends. It also controls storage engines for managing files (the \"default\" key) and static files (the \"staticfiles\" key). The old DEFAULT_FILE_STORAGE and STATICFILES_STORAGE settings are\ndeprecated as of this release. Minor features ¶ django.contrib.admin ¶ The light or dark color theme of the admin can now be toggled in the UI, as\nwell as being set to follow the system setting. The admin’s font stack now prefers system UI fonts and no longer requires\ndownloading fonts. Additionally, CSS variables are available to more easily\noverride the default font families. The admin/delete_confirmation.html template now\nhas some additional blocks and scripting hooks to ease customization. The chosen options of filter_horizontal and filter_vertical widgets are now\nfilterable. The admin/base.html template now has a new block nav-breadcrumbs which contains the navigation landmark and the breadcrumbs block. ModelAdmin.list_editable now uses atomic transactions when making\nedits. jQuery is upgraded from version 3.6.0 to 3.6.4. django.contrib.auth ¶ The default iteration count for the PBKDF2 password hasher is increased from\n390,000 to 600,000. UserCreationForm now saves many-to-many\nform fields for a custom user model. The new BaseUserCreationForm is now the\nrecommended base class for customizing the user creation form. django.contrib.gis ¶ The GeoJSON serializer now outputs the id key for serialized features, which defaults to the primary key of\nobjects. The GDALRaster class now supports pathlib.Path . The GeoIP2 class now supports .mmdb files downloaded from DB-IP. The OpenLayers template widget no longer includes inline CSS (which also\nremoves the former map_css block) to better comply with a strict Content\nSecurity Policy. OpenLayersWidget is now based on\nOpenLayers 7.2.2 (previously 4.6.5). The new isempty lookup and IsEmpty() expression allow filtering empty geometries on PostGIS. The new FromWKB() and FromWKT() functions allow creating geometries from Well-known binary (WKB) and\nWell-known text (WKT) representations. django.contrib.postgres ¶ The new trigram_strict_word_similar lookup, and the TrigramStrictWordSimilarity() and TrigramStrictWordDistance() expressions allow\nusing trigram strict word similarity. The arrayfield.overlap lookup now supports QuerySet.values() and values_list() as a right-hand side. django.contrib.sitemaps ¶ The new Sitemap.get_languages_for_item() method allows customizing the\nlist of languages for which the item is displayed. django.contrib.staticfiles ¶ ManifestStaticFilesStorage now\nhas experimental support for replacing paths to JavaScript modules in import and export statements with their hashed counterparts. If you\nwant to try it, subclass ManifestStaticFilesStorage and set the support_js_module_import_aggregation attribute to True . The new ManifestStaticFilesStorage.manifest_hash attribute provides\na hash over all files in the manifest and changes whenever one of the files\nchanges. Database backends ¶ The new \"assume_role\" option is now supported in OPTIONS on\nPostgreSQL to allow specifying the session role . The new \"server_side_binding\" option is now supported in OPTIONS on PostgreSQL with psycopg 3.1.8+ to allow using server-side binding cursors . Error Reporting ¶ The debug page now shows exception notes and fine-grained error locations on Python 3.11+. Session cookies are now treated as credentials and therefore hidden and\nreplaced with stars ( ********** ) in error reports. Forms ¶ ModelForm now accepts the new Meta option formfield_callback to customize form fields. modelform_factory() now respects the formfield_callback attribute of the form ’s Meta . Internationalization ¶ Added support and translations for the Central Kurdish (Sorani) language. Logging ¶ The django.db.backends logger now logs transaction management queries\n( BEGIN , COMMIT , and ROLLBACK ) at the DEBUG level. Management Commands ¶ makemessages command now supports locales with private sub-tags\nsuch as nl_NL-x-informal . The new makemigrations --update option merges model changes into\nthe latest migration and optimizes the resulting operations. Migrations ¶ Migrations now support serialization of enum.Flag objects. Models ¶ QuerySet now extensively supports filtering against Window functions with the exception of disjunctive filter lookups\nagainst window functions when performing aggregation. prefetch_related() now supports Prefetch objects with sliced querysets. Registering lookups on Field instances is now supported. The new robust argument for on_commit() allows performing actions that can fail after a database transaction is\nsuccessfully committed. The new KT() expression represents\nthe text value of a key, index, or path transform of JSONField . Now now supports microsecond precision\non MySQL and millisecond precision on SQLite. F() expressions that output BooleanField can now be negated using ~F() (inversion operator). Model now provides asynchronous versions of some methods that use the\ndatabase, using an a prefix: adelete() , arefresh_from_db() , and asave() . Related managers now provide asynchronous versions of methods that change a\nset of related objects, using an a prefix: aadd() , aclear() , aremove() , and aset() . CharField.max_length is no\nlonger required to be set on PostgreSQL, which supports unlimited VARCHAR columns. Requests and Responses ¶ StreamingHttpResponse now supports async iterators\nwhen Django is served via ASGI. Tests ¶ The test --debug-sql option now formats SQL queries with sqlparse . The RequestFactory , AsyncRequestFactory , Client , and AsyncClient classes now support the headers parameter, which accepts a dictionary of header names and values. This allows\na more natural syntax for declaring headers. # Before: self . client . get ( \"/home/\" , HTTP_ACCEPT_LANGUAGE = \"fr\" ) await self . async_client . get ( \"/home/\" , ACCEPT_LANGUAGE = \"fr\" ) # After: self . client . get ( \"/home/\" , headers = { \"accept-language\" : \"fr\" }) await self . async_client . get ( \"/home/\" , headers = { \"accept-language\" : \"fr\" }) Utilities ¶ The new encoder parameter for django.utils.html.json_script() function allows customizing a JSON encoder class. The private internal vendored copy of urllib.parse.urlsplit() now strips '\\r' , '\\n' , and '\\t' (see CVE 2022-0391 and bpo-43882 ).\nThis is to protect projects that may be incorrectly using the internal url_has_allowed_host_and_scheme() function, instead of using one of the\ndocumented functions for handling URL redirects. The Django functions were\nnot affected. The new django.utils.http.content_disposition_header() function returns\na Content-Disposition HTTP header value as specified by RFC 6266 . Validators ¶ The list of common passwords used by CommonPasswordValidator is updated\nto the most recent version. Backwards incompatible changes in 4.2 ¶ Database backend API ¶ This section describes changes that may be needed in third-party database\nbackends. DatabaseFeatures.allows_group_by_pk is removed as it only remained to\naccommodate a MySQL extension that has been supplanted by proper functional\ndependency detection in MySQL 5.7.15. Note that DatabaseFeatures.allows_group_by_selected_pks is still supported and\nshould be enabled if your backend supports functional dependency detection in GROUP BY clauses as specified by the SQL:1999 standard. inspectdb now uses display_size from DatabaseIntrospection.get_table_description() rather than internal_size for CharField . Dropped support for MariaDB 10.3 ¶ Upstream support for MariaDB 10.3 ends in May 2023. Django 4.2 supports MariaDB\n10.4 and higher. Dropped support for MySQL 5.7 ¶ Upstream support for MySQL 5.7 ends in October 2023. Django 4.2 supports MySQL\n8 and higher. Dropped support for PostgreSQL 11 ¶ Upstream support for PostgreSQL 11 ends in November 2023. Django 4.2 supports\nPostgreSQL 12 and higher. Setting update_fields in Model.save() may now be required ¶ In order to avoid updating unnecessary columns, QuerySet.update_or_create() now passes update_fields to the Model.save() calls. As a consequence, any\nfields modified in the custom save() methods should be added to the update_fields keyword argument before calling super() . See Overriding predefined model methods for more details. Dropped support for raw aggregations on MySQL ¶ MySQL 8+ allows functional dependencies on GROUP BY columns, so the\npre-Django 4.2 workaround of grouping by primary keys of the main table is\nremoved. As a consequence, using RawSQL() aggregations is no longer\nsupported on MySQL as there is no way to determine if such aggregations are\nneeded or valid in the GROUP BY clause. Use Aggregation functions instead. Miscellaneous ¶ The undocumented django.http.multipartparser.parse_header() function is\nremoved. Use django.utils.http.parse_header_parameters() instead. {% blocktranslate asvar … %} result is now marked as\nsafe for (HTML) output purposes. The autofocus HTML attribute in the admin search box is removed as it can\nbe confusing for screen readers. The makemigrations --check option no longer creates missing\nmigration files. The alias argument for Expression.get_group_by_cols() is removed. The minimum supported version of sqlparse is increased from 0.2.2 to\n0.3.1. The undocumented negated parameter of the Exists expression is removed. The is_summary argument of the undocumented Query.add_annotation() method is removed. The minimum supported version of SQLite is increased from 3.9.0 to 3.21.0. The minimum supported version of asgiref is increased from 3.5.2 to\n3.6.0. UserCreationForm now rejects usernames\nthat differ only in case. If you need the previous behavior, use BaseUserCreationForm instead. The minimum supported version of mysqlclient is increased from 1.4.0 to\n1.4.3. The minimum supported version of argon2-cffi is increased  from 19.1.0 to\n19.2.0. The minimum supported version of Pillow is increased from 6.2.0 to 6.2.1. The minimum supported version of jinja2 is increased from 2.9.2 to\n2.11.0. The minimum supported version of redis-py is increased from\n3.0.0 to 3.4.0. Manually instantiated WSGIRequest objects must be provided a file-like\nobject for wsgi.input . Previously, Django was more lax than the expected\nbehavior as specified by the WSGI specification. Support for PROJ < 5 is removed. EmailBackend now verifies a hostname and certificates . If you need the\nprevious behavior that is less restrictive and not recommended, subclass EmailBackend and override the ssl_context property. Features deprecated in 4.2 ¶ index_together option is deprecated in favor of indexes ¶ The Meta.index_together option is deprecated in favor of the indexes option. Migrating existing index_together should be handled as a migration. For\nexample: class Author ( models . Model ): rank = models . IntegerField () name = models . CharField ( max_length = 30 ) class Meta : index_together = [[ \"rank\" , \"name\" ]] Should become: class Author ( models . Model ): rank = models . IntegerField () name = models . CharField ( max_length = 30 ) class Meta : indexes = [ models . Index ( fields = [ \"rank\" , \"name\" ])] Running the makemigrations command will generate a migration\ncontaining a RenameIndex operation\nwhich will rename the existing index. Next, consider squashing migrations to\nremove index_together from historical migrations. The AlterIndexTogether migration operation is now officially supported only\nfor pre-Django 4.2 migration files. For backward compatibility reasons, it’s\nstill part of the public API, and there’s no plan to deprecate or remove it,\nbut it should not be used for new migrations. Use AddIndex and RemoveIndex operations instead. Passing encoded JSON string literals to JSONField is deprecated ¶ JSONField and its associated lookups and aggregates used to allow passing\nJSON encoded string literals which caused ambiguity on whether string literals\nwere already encoded from database backend’s perspective. During the deprecation period string literals will be attempted to be JSON\ndecoded and a warning will be emitted on success that points at passing\nnon-encoded forms instead. Code that used to pass JSON encoded string literals: Document . objects . bulk_create ( Document ( data = Value ( \"null\" )), Document ( data = Value ( \"[]\" )), Document ( data = Value ( '\"foo-bar\"' )), ) Document . objects . annotate ( JSONBAgg ( \"field\" , default = Value ( \"[]\" )), ) Should become: Document . objects . bulk_create ( Document ( data = Value ( None , JSONField ())), Document ( data = []), Document ( data = \"foo-bar\" ), ) Document . objects . annotate ( JSONBAgg ( \"field\" , default = []), ) From Django 5.1+ string literals will be implicitly interpreted as JSON string\nliterals. Miscellaneous ¶ The BaseUserManager.make_random_password() method is deprecated. See recipes and best practices for using Python’s secrets module to generate passwords. The length_is template filter is deprecated in favor of length and the == operator within an {% if %} tag. For example {% if value | length == 4 %} … {% endif %} {% if value | length == 4 %} True {% else %} False {% endif %} instead of: {% if value | length_is : 4 %} … {% endif %} {{ value | length_is : 4 }} django.contrib.auth.hashers.SHA1PasswordHasher , django.contrib.auth.hashers.UnsaltedSHA1PasswordHasher , and django.contrib.auth.hashers.UnsaltedMD5PasswordHasher are deprecated. django.contrib.postgres.fields.CICharField is deprecated in favor of CharField(db_collation=\"…\") with a case-insensitive non-deterministic\ncollation. django.contrib.postgres.fields.CIEmailField is deprecated in favor of EmailField(db_collation=\"…\") with a case-insensitive non-deterministic\ncollation. django.contrib.postgres.fields.CITextField is deprecated in favor of TextField(db_collation=\"…\") with a case-insensitive non-deterministic\ncollation. django.contrib.postgres.fields.CIText mixin is deprecated. The map_height and map_width attributes of BaseGeometryWidget are\ndeprecated, use CSS to size map widgets instead. SimpleTestCase.assertFormsetError() is deprecated in favor of assertFormSetError() . TransactionTestCase.assertQuerysetEqual() is deprecated in favor of assertQuerySetEqual() . Passing positional arguments to Signer and TimestampSigner is\ndeprecated in favor of keyword-only arguments. The DEFAULT_FILE_STORAGE setting is deprecated in favor of STORAGES[\"default\"] . The STATICFILES_STORAGE setting is deprecated in favor of STORAGES[\"staticfiles\"] . The django.core.files.storage.get_storage_class() function is deprecated.", "keywords": ["citext", "aggregations", "django.core.files.storage", "box", "manifeststaticfilesstorage.manifest_hash", "integerfield", "storage", "removeindex", "map_width", "pillow", "library", "field", "#", "serialization", "migrations", "7.2.2", "+", "lts", "sqlparse", "wsgirequest", "compatibility", "baseusermanager.make_random_password", "ui", "navigation", "asvar", "hash", "http", "changes", "=", "perspective", "urllib.parse.urlsplit", "engine", "aremove", "manifeststaticfilesstorage", "tables", "tag", "paper", "--debug", "openlayers", "process", "proj", "debug", "alterindextogether", "mysqlclient", "autofocus", "iterators", "calls", "custom", "objects", "lookups", "prefetch", "file", "customization", "gdalraster", "sql:1999", "bulk_create", "modules", "disposition", "unsaltedsha1passwordhasher", "gzipmiddleware", "user", "attribute", "django.contrib.gis", "warning", "queryset.update_or_create", "time", "tags", "workaround", "save", "date", "jquery", "setting", "purposes", "responses", "http_accept_language", "cve", "transform", "may", "password", "support_js_module_import_aggregation", "citextfield", "name", "makemigrations", "parameter", "map_css", "backends", "reference", "django.contrib.auth", ".mmdb", "versions", "queries", "django.contrib.admin", "baseusercreationform", "literals", "operator", "memory", "expressions", "cursors", "search", "textfield", "datetimefield", "question", "jsonbagg", "django.contrib.staticfiles", "pre", "display_size", "plan", "model.save", "url", "error", "module", "code", "base.html", "default_file_storage", "period", "families", "postgis", "filter", "behavior", "rank", "access", "class", "i", "migration", "grouping", "clause", "exists", "assertquerysetequal", "group", "widget", "databasefeatures.allows_group_by_pk", "names", "javascript", "attack", "years", "pbkdf2", "inversion", "modelform_factory", "wkb", "database", "block", "flag", "output", "page", "test", "commands", "postgresql", "count", "locales", "aclear", "py", "admin", "adelete", "creation", "django.utils.html.json_script", "basegeometrywidget", "breadcrumbs", "trigramstrictworddistance", "mixin", "wsgi", "trigram", "max_length", "by", "formfield_callback", "role", "storages[\"staticfiles", "storages[\"default", "section", "certificates", "representations", "specification", "emailfield(db_collation=", "staticfiles_storage", "css", "use", "/home/", "cffi", "credentials", "commit", "author", "engines", "index_together", "operation", "order", "commonpasswordvalidator", "default", "fonts", "form", "prefix", "option", "field.db_comment", "expression", "tests", "classes", "annotate", "psycopg2", "booleanfield", "f", "supports", "fromwkt", "template", "aggregates", "header", "way", "super", "charfield(db_collation=", "fr", "comments", "index", "party", "queryset", "streaminghttpresponse", "session", "reports", "¶", "bytes", "command", "trigram_strict_word_similar", "internationalization", "django.db.backends.postgresql", "delete_confirmation.html", "disk", "sub", "databaseintrospection.get_table_description", "october", "precision", "encoder", "query.add_annotation", "property", "db_comment", "side", "databasefeatures.allows_group_by_selected_pks", "content", "landmark", "function", "ends", "result", "ambiguity", "color", "enum", "indexes", "19.1.0", "jsonfield", "modelform", "point", "\\r", "staticfiles", "values", "string", "kt", "heal", "geojson", "favor", "jinja2", "managers", "hand", "libraries", "table", "language", "models", "querysets", "copy", "blocks", "version", "level", "json", "manifest", "queryset.values", "hostname", "addindex", "deprecation", "minimum", "requestfactory", "django", "series", "\\t", "rfc", "fields", "ip", "utilities", "languages", "set", "db", "mitigation", "value", "--update", "wkt", "django.utils.http.parse_header_parameters", "5.7.15", "openlayerswidget", "policy", "columns", "data", "cicharfield", "april", "item", "base", "backend", "guide", "renameindex", "inmemorystorage", "security", "updates", "trigramstrictwordsimilarity", "paths", "self", "django.utils.http.content_disposition_header", "pub_date", "answers", "reporting", "aggregation", "geometries", "makemessages", "theme", "timestampsigner", "extension", "consequence", "validators", "textfield(db_collation=", "|", "sorani", "redis", "bpo-43882", "readers", "instances", "signer", "simpletestcase.assertformseterror", "part", "dependency", "merges", "rejects", "object", "argon2", "asgiref", "--check", "length_is", "begin", "charfield", "management", "november", "django.contrib.auth.hashers", "sql", "dictionary", "requests", "update_fields", "keyword", "logger", "asyncrequestfactory", "variables", "notes", "questions", "django.contrib.postgres.fields", "system", "practices", "edits", "clauses", "filtering", "async", "dependencies", "values_list", "welcome", "storages", "widgets", "asyncclient", "serializer", "headers", "server_side_binding", "features", "forms", "’s", "psycopg", "example", "window", "hooks", "locations", "list", "collation", "isempty", "detection", "answer", "filter_horizontal", "usercreationform", "export", "upstream", "sitemap.get_languages_for_item", "assertformseterror", "hasher", "stack", "map", "secrets", "model", "word", "reasons", "emailbackend", "actions", "attributes", "altermodeltablecomment", "release", "differences", "meta.db_table_comment", "redirects", "asgi", "expression.get_group_by_cols", "syntax", "rollback", "keys", "case", "length", "lookup", "technique", "html", "screen", "future", "server", "stars", "arguments", "passwords", "pathlib", "rawsql", "translations", "sqlite", "wsgi.input", "standard", "bar", "path", "recipes", "functions", "key", "term", "operations", "success", "inspectdb", "none", "transactiontestcase.assertquerysetequal", "meta", "mariadb", "19.2.0", "counterparts", "url_has_allowed_host_and_scheme", "similarity", "true", "on_commit", "api", "fromwkb", "support", "cookies", "htb", "projects", "transactions", "document", "-", "django.http.multipartparser.parse_header", "kurdish", "nav", "import", "files", "d", "iteration", "statements", "mysql", "%", "foreignkey", "python", "methods", "options", "exception", "client", "details", "method", "breach", "django.db", "settings", "transaction", "argument", "aadd", "attacks", "ciemailfield", "text", "project", "charfield.max_length"], "type": "documentation"},
{"title": "Django 5.0.3 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/5.0.3/", "content": "Django 5.0.3 release notes ¶ March 4, 2024 Django 5.0.3 fixes a security issue with severity “moderate” and several bugs\nin 5.0.2. CVE-2024-27351: Potential regular expression denial-of-service in django.utils.text.Truncator.words() ¶ django.utils.text.Truncator.words() method (with html=True ) and truncatewords_html template filter were subject to a potential\nregular expression denial-of-service attack using a suitably crafted string\n(follow up to CVE 2019-14232 and CVE 2023-43665 ). Bugfixes ¶ Fixed a regression in Django 5.0.2 where intcomma template filter could\nreturn a leading comma for string representation of floats ( #35172 ). Fixed a bug in Django 5.0 that caused a crash of Signal.asend() and asend_robust() when all receivers were asynchronous functions\n( #35174 ). Fixed a regression in Django 5.0.1 where ModelAdmin.lookup_allowed() would prevent filtering against foreign keys using lookups like __isnull when the field was not included in ModelAdmin.list_filter ( #35173 ). Fixed a regression in Django 5.0 that caused a crash of @sensitive_variables and @sensitive_post_parameters decorators on\nfunctions loaded from .pyc files ( #35187 ). Fixed a regression in Django 5.0 that caused a crash when reloading a test\ndatabase and a base queryset for a base manager used prefetch_related() ( #35238 ). Fixed a bug in Django 5.0 where facet filters in the admin would crash on a SimpleListFilter using a queryset without primary keys ( #35198 ).", "keywords": ["cve", "service", "crash", "march", "bugfixes", "facet", "simplelistfilter", "security", "regression", "receivers", "filtering", "admin", "files", "template", "lookups", "5.0.3", "isnull", "django", "=", "release", "issue", "test", "filter", "cve-2024", "string", "severity", "denial", "field", "functions", "django.utils.text.truncator.words", "bug", "intcomma", "manager", "bugs", "method", "queryset", "decorators", "expression", "comma", "@sensitive_variables", "5.0.2", "¶", "signal.asend", ".pyc", "asend_robust", "attack", "keys", "floats", "database", "true", "representation", "base", "html"], "type": "documentation"},
{"title": "Django 4.2.6 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/4.2.6/", "content": "Django 4.2.6 release notes ¶ October 4, 2023 Django 4.2.6 fixes a security issue with severity “moderate” and several bugs\nin 4.2.5. CVE-2023-43665: Denial-of-service possibility in django.utils.text.Truncator ¶ Following the fix for CVE 2019-14232 , the regular expressions used in the\nimplementation of django.utils.text.Truncator ’s chars() and words() methods (with html=True ) were revised and improved. However, these regular\nexpressions still exhibited linear backtracking complexity, so when given a\nvery long, potentially malformed HTML input, the evaluation would still be\nslow, leading to a potential denial of service vulnerability. The chars() and words() methods are used to implement the truncatechars_html and truncatewords_html template\nfilters, which were thus also vulnerable. The input processed by Truncator , when operating in HTML mode, has been\nlimited to the first five million characters in order to avoid potential\nperformance and memory issues. Bugfixes ¶ Fixed a regression in Django 4.2.5 where overriding the deprecated DEFAULT_FILE_STORAGE and STATICFILES_STORAGE settings in tests caused\nthe main STORAGES to mutate ( #34821 ). Fixed a regression in Django 4.2 that caused unnecessary casting of string\nbased fields ( CharField , EmailField , TextField , CICharField , CIEmailField , and CITextField ) used with the __isnull lookup on\nPostgreSQL. As a consequence, indexes using an __isnull expression or\ncondition created before Django 4.2 wouldn’t be used by the query planner,\nleading to a performance regression ( #34840 ). You may need to recreate such indexes created in your database with Django\n4.2 to 4.2.5, as they contain unnecessary ::text casting. Find candidate\nindexes with this query: SELECT indexname , indexdef FROM pg_indexes WHERE indexdef LIKE '%::text IS %NULL' ;", "keywords": ["cve", "service", "truncatechars_html", "mode", "words", "bugfixes", "security", "regression", "storages", "citextfield", "indexes", "performance", "charfield", "template", "django.utils.text", "candidate", "emailfield", "condition", "%", "isnull", "casting", "django", "vulnerability", "cve-2023", "=", "release", "chars", "order", "issue", "fix", "consequence", "fields", "methods", "string", "severity", "denial", "fixes", "_", "pg_indexes", "indexdef", "possibility", "truncator", "bugs", "filters", "expression", "characters", "issues", "settings", "notes", "¶", "tests", "select", "4.2.5", "truncatewords_html", "october", "memory", "expressions", "planner", "implementation", "cicharfield", "database", "staticfiles_storage", "true", "ciemailfield", "input", "evaluation", "lookup", "textfield", "null", "query", "text", "html", "postgresql", "complexity"], "type": "documentation"},
{"title": "Django 4.2.11 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/4.2.11/", "content": "Django 4.2.11 release notes ¶ March 4, 2024 Django 4.2.11 fixes a security issue with severity “moderate” and a regression\nin 4.2.10. CVE-2024-27351: Potential regular expression denial-of-service in django.utils.text.Truncator.words() ¶ django.utils.text.Truncator.words() method (with html=True ) and truncatewords_html template filter were subject to a potential\nregular expression denial-of-service attack using a suitably crafted string\n(follow up to CVE 2019-14232 and CVE 2023-43665 ). Bugfixes ¶ Fixed a regression in Django 4.2.10 where intcomma template filter could\nreturn a leading comma for string representation of floats ( #35172 ).", "keywords": ["cve", "service", "march", "bugfixes", "security", "regression", "template", "django", "=", "release", "issue", "filter", "cve-2024", "string", "severity", "denial", "django.utils.text.truncator.words", "intcomma", "method", "expression", "comma", "¶", "attack", "floats", "true", "representation", "html"], "type": "documentation"},
{"title": "Django 4.1.12 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/4.1.12/", "content": "Django 4.1.12 release notes ¶ October 4, 2023 Django 4.1.12 fixes a security issue with severity “moderate” in 4.1.11. CVE-2023-43665: Denial-of-service possibility in django.utils.text.Truncator ¶ Following the fix for CVE 2019-14232 , the regular expressions used in the\nimplementation of django.utils.text.Truncator ’s chars() and words() methods (with html=True ) were revised and improved. However, these regular\nexpressions still exhibited linear backtracking complexity, so when given a\nvery long, potentially malformed HTML input, the evaluation would still be\nslow, leading to a potential denial of service vulnerability. The chars() and words() methods are used to implement the truncatechars_html and truncatewords_html template\nfilters, which were thus also vulnerable. The input processed by Truncator , when operating in HTML mode, has been\nlimited to the first five million characters in order to avoid potential\nperformance and memory issues.", "keywords": ["cve", "service", "truncatechars_html", "mode", "words", "security", "performance", "template", "django.utils.text", "django", "vulnerability", "cve-2023", "=", "release", "chars", "order", "issue", "fix", "methods", "severity", "denial", "possibility", "truncator", "4.1.11", "filters", "characters", "issues", "¶", "truncatewords_html", "october", "memory", "expressions", "4.1.12", "implementation", "true", "input", "evaluation", "html", "complexity"], "type": "documentation"},
{"title": "Django 3.2.25 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/3.2.25/", "content": "Django 3.2.25 release notes ¶ March 4, 2024 Django 3.2.25 fixes a security issue with severity “moderate” and a regression\nin 3.2.24. CVE-2024-27351: Potential regular expression denial-of-service in django.utils.text.Truncator.words() ¶ django.utils.text.Truncator.words() method (with html=True ) and truncatewords_html template filter were subject to a potential\nregular expression denial-of-service attack using a suitably crafted string\n(follow up to CVE 2019-14232 and CVE 2023-43665 ). Bugfixes ¶ Fixed a regression in Django 3.2.24 where intcomma template filter could\nreturn a leading comma for string representation of floats ( #35172 ).", "keywords": ["cve", "service", "march", "bugfixes", "security", "regression", "template", "django", "=", "release", "issue", "filter", "cve-2024", "string", "severity", "denial", "django.utils.text.truncator.words", "intcomma", "method", "expression", "comma", "notes", "¶", "3.2.25", "attack", "floats", "true", "representation", "html"], "type": "documentation"},
{"title": "Django 3.2.22 release notes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/3.2.22/", "content": "Django 3.2.22 release notes ¶ October 4, 2023 Django 3.2.22 fixes a security issue with severity “moderate” in 3.2.21. CVE-2023-43665: Denial-of-service possibility in django.utils.text.Truncator ¶ Following the fix for CVE 2019-14232 , the regular expressions used in the\nimplementation of django.utils.text.Truncator ’s chars() and words() methods (with html=True ) were revised and improved. However, these regular\nexpressions still exhibited linear backtracking complexity, so when given a\nvery long, potentially malformed HTML input, the evaluation would still be\nslow, leading to a potential denial of service vulnerability. The chars() and words() methods are used to implement the truncatechars_html and truncatewords_html template\nfilters, which were thus also vulnerable. The input processed by Truncator , when operating in HTML mode, has been\nlimited to the first five million characters in order to avoid potential\nperformance and memory issues.", "keywords": ["cve", "service", "truncatechars_html", "mode", "words", "security", "performance", "template", "django.utils.text", "django", "vulnerability", "cve-2023", "=", "release", "chars", "order", "issue", "fix", "methods", "severity", "denial", "possibility", "truncator", "3.2.21", "filters", "characters", "issues", "notes", "¶", "truncatewords_html", "october", "memory", "expressions", "3.2.22", "implementation", "true", "input", "evaluation", "html", "complexity"], "type": "documentation"},
{"title": "Archive of security issues | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/releases/security/", "content": "Archive of security issues ¶ Django’s development team is strongly committed to responsible\nreporting and disclosure of security-related issues, as outlined in Django’s security policies . As part of that commitment, we maintain the following historical list\nof issues which have been fixed and disclosed. For each issue, the\nlist below includes the date, a brief description, the CVE identifier if applicable, a list of affected versions, a link to the full\ndisclosure and links to the appropriate patch(es). Some important caveats apply to this information: Lists of affected versions include only those versions of Django\nwhich had stable, security-supported releases at the time of\ndisclosure. This means older versions (whose security support had\nexpired) and versions which were in pre-release (alpha/beta/RC)\nstates at the time of disclosure may have been affected, but are not\nlisted. The Django project has on occasion issued security advisories,\npointing out potential security problems which can arise from\nimproper configuration or from other issues outside of Django\nitself. Some of these advisories have received CVEs; when that is\nthe case, they are listed here, but as they have no accompanying\npatches or releases, only the description, disclosure and CVE will\nbe listed. Issues under Django’s security process ¶ All security issues have been handled under versions of Django’s security\nprocess. These are listed below. December 4, 2024 - CVE 2024-53907 ¶ Potential denial-of-service in django.utils.html.strip_tags() . Full description Django 5.1 (patch) Django 5.0 (patch) Django 4.2 (patch) December 4, 2024 - CVE 2024-53908 ¶ Potential SQL injection in HasKey(lhs, rhs) on Oracle. Full description Django 5.1 (patch) Django 5.0 (patch) Django 4.2 (patch) September 3, 2024 - CVE 2024-45231 ¶ Potential user email enumeration via response status on password reset. Full description Django 5.1 (patch) Django 5.0 (patch) Django 4.2 (patch) September 3, 2024 - CVE 2024-45230 ¶ Potential denial-of-service vulnerability in django.utils.html.urlize() . Full description Django 5.1 (patch) Django 5.0 (patch) Django 4.2 (patch) August 6, 2024 - CVE 2024-42005 ¶ Potential SQL injection in QuerySet.values() and values_list() . Full description Django 5.0 (patch) Django 4.2 (patch) August 6, 2024 - CVE 2024-41991 ¶ Potential denial-of-service vulnerability in django.utils.html.urlize() and AdminURLFieldWidget . Full description Django 5.0 (patch) Django 4.2 (patch) August 6, 2024 - CVE 2024-41990 ¶ Potential denial-of-service vulnerability in django.utils.html.urlize() . Full description Django 5.0 (patch) Django 4.2 (patch) August 6, 2024 - CVE 2024-41989 ¶ Potential memory exhaustion in django.utils.numberformat.floatformat() . Full description Django 5.0 (patch) Django 4.2 (patch) July 9, 2024 - CVE 2024-39614 ¶ Potential denial-of-service in django.utils.translation.get_supported_language_variant() . Full description Django 5.0 (patch) Django 4.2 (patch) July 9, 2024 - CVE 2024-39330 ¶ Potential directory-traversal in django.core.files.storage.Storage.save() . Full description Django 5.0 (patch) Django 4.2 (patch) July 9, 2024 - CVE 2024-39329 ¶ Username enumeration through timing difference for users with unusable\npasswords. Full description Django 5.0 (patch) Django 4.2 (patch) July 9, 2024 - CVE 2024-38875 ¶ Potential denial-of-service in django.utils.html.urlize() . Full description Django 5.0 (patch) Django 4.2 (patch) March 4, 2024 - CVE 2024-27351 ¶ Potential regular expression denial-of-service in django.utils.text.Truncator.words() . Full description Django 5.0 (patch) Django 4.2 (patch) Django 3.2 (patch) February 6, 2024 - CVE 2024-24680 ¶ Potential denial-of-service in intcomma template filter. Full description Django 5.0 (patch) Django 4.2 (patch) Django 3.2 (patch) November 1, 2023 - CVE 2023-46695 ¶ Potential denial of service vulnerability in UsernameField on Windows. Full description Django 4.2 (patch) Django 4.1 (patch) Django 3.2 (patch) October 4, 2023 - CVE 2023-43665 ¶ Denial-of-service possibility in django.utils.text.Truncator . Full description Django 4.2 (patch) Django 4.1 (patch) Django 3.2 (patch) September 4, 2023 - CVE 2023-41164 ¶ Potential denial of service vulnerability in django.utils.encoding.uri_to_iri() . Full description Django 4.2 (patch) Django 4.1 (patch) Django 3.2 (patch) July 3, 2023 - CVE 2023-36053 ¶ Potential regular expression denial of service vulnerability in EmailValidator / URLValidator . Full description Django 4.2 (patch) Django 4.1 (patch) Django 3.2 (patch) May 3, 2023 - CVE 2023-31047 ¶ Potential bypass of validation when uploading multiple files using one form\nfield. Full description Django 4.2 (patch) Django 4.1 (patch) Django 3.2 (patch) February 14, 2023 - CVE 2023-24580 ¶ Potential denial-of-service vulnerability in file uploads. Full description Django 4.1 (patch) Django 4.0 (patch) Django 3.2 (patch) February 1, 2023 - CVE 2023-23969 ¶ Potential denial-of-service via Accept-Language headers. Full description Django 4.1 (patch) Django 4.0 (patch) Django 3.2 (patch) October 4, 2022 - CVE 2022-41323 ¶ Potential denial-of-service vulnerability in internationalized URLs. Full\ndescription Django 4.1 (patch) Django 4.0 (patch) Django 3.2 (patch) August 3, 2022 - CVE 2022-36359 ¶ Potential reflected file download vulnerability in FileResponse. Full\ndescription Django 4.0 (patch) Django 3.2 (patch) July 4, 2022 - CVE 2022-34265 ¶ Potential SQL injection via Trunc(kind) and Extract(lookup_name) arguments. Full description Django 4.0 (patch) Django 3.2 (patch) April 11, 2022 - CVE 2022-28346 ¶ Potential SQL injection in QuerySet.annotate() , aggregate() , and extra() . Full description Django 4.0 (patch) Django 3.2 (patch) Django 2.2 (patch) April 11, 2022 - CVE 2022-28347 ¶ Potential SQL injection via QuerySet.explain(**options) on PostgreSQL. Full description Django 4.0 (patch) Django 3.2 (patch) Django 2.2 (patch) February 1, 2022 - CVE 2022-22818 ¶ Possible XSS via {% debug %} template tag. Full description Versions affected ¶ Django 4.0 (patch) Django 3.2 (patch) Django 2.2 (patch) February 1, 2022 - CVE 2022-23833 ¶ Denial-of-service possibility in file uploads. Full description Versions affected ¶ Django 4.0 (patch) Django 3.2 (patch) Django 2.2 (patch) January 4, 2022 - CVE 2021-45452 ¶ Potential directory-traversal via Storage.save() . Full description Versions affected ¶ Django 4.0 (patch) Django 3.2 (patch) Django 2.2 (patch) January 4, 2022 - CVE 2021-45116 ¶ Potential information disclosure in dictsort template filter. Full\ndescription Versions affected ¶ Django 4.0 (patch) Django 3.2 (patch) Django 2.2 (patch) January 4, 2022 - CVE 2021-45115 ¶ Denial-of-service possibility in UserAttributeSimilarityValidator . Full\ndescription Versions affected ¶ Django 4.0 (patch) Django 3.2 (patch) Django 2.2 (patch) December 7, 2021 - CVE 2021-44420 ¶ Potential bypass of an upstream access control based on URL paths. Full\ndescription Versions affected ¶ Django 3.2 (patch) Django 3.1 (patch) Django 2.2 (patch) July 1, 2021 - CVE 2021-35042 ¶ Potential SQL injection via unsanitized QuerySet.order_by() input. Full\ndescription Versions affected ¶ Django 3.2 (patch) Django 3.1 (patch) June 2, 2021 - CVE 2021-33203 ¶ Potential directory traversal via admindocs . Full description Versions affected ¶ Django 3.2 (patch) Django 3.1 (patch) Django 2.2 (patch) June 2, 2021 - CVE 2021-33571 ¶ Possible indeterminate SSRF, RFI, and LFI attacks since validators accepted\nleading zeros in IPv4 addresses. Full description Versions affected ¶ Django 3.2 (patch) Django 3.1 (patch) Django 2.2 (patch) May 6, 2021 - CVE 2021-32052 ¶ Header injection possibility since URLValidator accepted newlines in input\non Python 3.9.5+. Full description Versions affected ¶ Django 3.2 (patch) Django 3.1 (patch) Django 2.2 (patch) May 4, 2021 - CVE 2021-31542 ¶ Potential directory-traversal via uploaded files. Full description Versions affected ¶ Django 3.2 (patch) Django 3.1 (patch) Django 2.2 (patch) April 6, 2021 - CVE 2021-28658 ¶ Potential directory-traversal via uploaded files. Full description Versions affected ¶ Django 3.2 (patch) Django 3.1 (patch) Django 3.0 (patch) Django 2.2 (patch) February 19, 2021 - CVE 2021-23336 ¶ Web cache poisoning via django.utils.http.limited_parse_qsl() . Full\ndescription Versions affected ¶ Django 3.2 (patch) Django 3.1 (patch) Django 3.0 (patch) Django 2.2 (patch) February 1, 2021 - CVE 2021-3281 ¶ Potential directory-traversal via archive.extract() . Full description Versions affected ¶ Django 3.1 (patch) Django 3.0 (patch) Django 2.2 (patch) September 1, 2020 - CVE 2020-24584 ¶ Permission escalation in intermediate-level directories of the file system\ncache on Python 3.7+. Full description Versions affected ¶ Django 3.1 (patch) Django 3.0 (patch) Django 2.2 (patch) September 1, 2020 - CVE 2020-24583 ¶ Incorrect permissions on intermediate-level directories on Python 3.7+. Full\ndescription Versions affected ¶ Django 3.1 (patch) Django 3.0 (patch) Django 2.2 (patch) June 3, 2020 - CVE 2020-13596 ¶ Possible XSS via admin ForeignKeyRawIdWidget . Full description Versions affected ¶ Django 3.0 (patch) Django 2.2 (patch) June 3, 2020 - CVE 2020-13254 ¶ Potential data leakage via malformed memcached keys. Full description Versions affected ¶ Django 3.0 (patch) Django 2.2 (patch) March 4, 2020 - CVE 2020-9402 ¶ Potential SQL injection via tolerance parameter in GIS functions and\naggregates on Oracle. Full description Versions affected ¶ Django 3.0 (patch) Django 2.2 (patch) Django 1.11 (patch) February 3, 2020 - CVE 2020-7471 ¶ Potential SQL injection via StringAgg(delimiter) . Full description Versions affected ¶ Django 3.0 (patch) Django 2.2 (patch) Django 1.11 (patch) December 18, 2019 - CVE 2019-19844 ¶ Potential account hijack via password reset form. Full description Versions affected ¶ Django 3.0 (patch) Django 2.2 (patch) Django 1.11 (patch) December 2, 2019 - CVE 2019-19118 ¶ Privilege escalation in the Django admin. Full description Versions affected ¶ Django 3.0 (patch) Django 2.2 (patch) Django 2.1 (patch) August 1, 2019 - CVE 2019-14235 ¶ Potential memory exhaustion in django.utils.encoding.uri_to_iri() . Full\ndescription Versions affected ¶ Django 2.2 (patch) Django 2.1 (patch) Django 1.11 (patch) August 1, 2019 - CVE 2019-14234 ¶ SQL injection possibility in key and index lookups for JSONField / HStoreField . Full description Versions affected ¶ Django 2.2 (patch) Django 2.1 (patch) Django 1.11 (patch) August 1, 2019 - CVE 2019-14233 ¶ Denial-of-service possibility in strip_tags() . Full description Versions affected ¶ Django 2.2 (patch) Django 2.1 (patch) Django 1.11 (patch) August 1, 2019 - CVE 2019-14232 ¶ Denial-of-service possibility in django.utils.text.Truncator . Full\ndescription Versions affected ¶ Django 2.2 (patch) Django 2.1 (patch) Django 1.11 (patch) July 1, 2019 - CVE 2019-12781 ¶ Incorrect HTTP detection with reverse-proxy connecting via HTTPS. Full\ndescription Versions affected ¶ Django 2.2 (patch) Django 2.1 (patch) Django 1.11 (patch) June 3, 2019 - CVE 2019-12308 ¶ XSS via “Current URL” link generated by AdminURLFieldWidget . Full\ndescription Versions affected ¶ Django 2.2 (patch) Django 2.1 (patch) Django 1.11 (patch) June 3, 2019 - CVE 2019-11358 ¶ Prototype pollution in bundled jQuery. Full description Versions affected ¶ Django 2.2 (patch) Django 2.1 (patch) February 11, 2019 - CVE 2019-6975 ¶ Memory exhaustion in django.utils.numberformat.format() . Full description Versions affected ¶ Django 2.1 (patch) Django 2.0 (patch and correction) Django 1.11 (patch) January 4, 2019 - CVE 2019-3498 ¶ Content spoofing possibility in the default 404 page. Full description Versions affected ¶ Django 2.1 (patch) Django 2.0 (patch) Django 1.11 (patch) October 1, 2018 - CVE 2018-16984 ¶ Password hash disclosure to “view only” admin users. Full description Versions affected ¶ Django 2.1 (patch) August 1, 2018 - CVE 2018-14574 ¶ Open redirect possibility in CommonMiddleware . Full description Versions affected ¶ Django 2.1 (patch) Django 2.0 (patch) Django 1.11 (patch) March 6, 2018 - CVE 2018-7537 ¶ Denial-of-service possibility in truncatechars_html and truncatewords_html template filters. Full description Versions affected ¶ Django 2.0 (patch) Django 1.11 (patch) Django 1.8 (patch) March 6, 2018 - CVE 2018-7536 ¶ Denial-of-service possibility in urlize and urlizetrunc template\nfilters. Full description Versions affected ¶ Django 2.0 (patch) Django 1.11 (patch) Django 1.8 (patch) February 1, 2018 - CVE 2018-6188 ¶ Information leakage in AuthenticationForm . Full description Versions affected ¶ Django 2.0 (patch) Django 1.11 (patch) September 5, 2017 - CVE 2017-12794 ¶ Possible XSS in traceback section of technical 500 debug page. Full\ndescription Versions affected ¶ Django 1.11 (patch) Django 1.10 (patch) April 4, 2017 - CVE 2017-7234 ¶ Open redirect vulnerability in django.views.static.serve() . Full\ndescription Versions affected ¶ Django 1.10 (patch) Django 1.9 (patch) Django 1.8 (patch) April 4, 2017 - CVE 2017-7233 ¶ Open redirect and possible XSS attack via user-supplied numeric redirect URLs. Full description Versions affected ¶ Django 1.10 (patch) Django 1.9 (patch) Django 1.8 (patch) November 1, 2016 - CVE 2016-9014 ¶ DNS rebinding vulnerability when DEBUG=True . Full description Versions affected ¶ Django 1.10 (patch) Django 1.9 (patch) Django 1.8 (patch) November 1, 2016 - CVE 2016-9013 ¶ User with hardcoded password created when running tests on Oracle. Full\ndescription Versions affected ¶ Django 1.10 (patch) Django 1.9 (patch) Django 1.8 (patch) September 26, 2016 - CVE 2016-7401 ¶ CSRF protection bypass on a site with Google Analytics. Full description Versions affected ¶ Django 1.9 (patch) Django 1.8 (patch) July 18, 2016 - CVE 2016-6186 ¶ XSS in admin’s add/change related popup. Full description Versions affected ¶ Django 1.9 (patch) Django 1.8 (patch) March 1, 2016 - CVE 2016-2513 ¶ User enumeration through timing difference on password hasher work factor\nupgrade. Full description Versions affected ¶ Django 1.9 (patch) Django 1.8 (patch) March 1, 2016 - CVE 2016-2512 ¶ Malicious redirect and possible XSS attack via user-supplied redirect URLs\ncontaining basic auth. Full description Versions affected ¶ Django 1.9 (patch) Django 1.8 (patch) February 1, 2016 - CVE 2016-2048 ¶ User with “change” but not “add” permission can create objects for ModelAdmin ’s with save_as=True . Full description Versions affected ¶ Django 1.9 (patch) November 24, 2015 - CVE 2015-8213 ¶ Settings leak possibility in date template filter. Full description Versions affected ¶ Django 1.8 (patch) Django 1.7 (patch) August 18, 2015 - CVE 2015-5963 / CVE 2015-5964 ¶ Denial-of-service possibility in logout() view by filling session store. Full description Versions affected ¶ Django 1.8 (patch) Django 1.7 (patch) Django 1.4 (patch) July 8, 2015 - CVE 2015-5145 ¶ Denial-of-service possibility in URL validation. Full description Versions affected ¶ Django 1.8 (patch) July 8, 2015 - CVE 2015-5144 ¶ Header injection possibility since validators accept newlines in input. Full\ndescription Versions affected ¶ Django 1.8 (patch) Django 1.7 (patch) Django 1.4 (patch) July 8, 2015 - CVE 2015-5143 ¶ Denial-of-service possibility by filling session store. Full\ndescription Versions affected ¶ Django 1.8 (patch) Django 1.7 (patch) Django 1.4 (patch) May 20, 2015 - CVE 2015-3982 ¶ Fixed session flushing in the cached_db backend. Full description Versions affected ¶ Django 1.8 (patch) March 18, 2015 - CVE 2015-2317 ¶ Mitigated possible XSS attack via user-supplied redirect URLs. Full\ndescription Versions affected ¶ Django 1.4 (patch) Django 1.6 (patch) Django 1.7 (patch) Django 1.8 (patch) March 18, 2015 - CVE 2015-2316 ¶ Denial-of-service possibility with strip_tags() . Full description Versions affected ¶ Django 1.6 (patch) Django 1.7 (patch) Django 1.8 (patch) March 9, 2015 - CVE 2015-2241 ¶ XSS attack via properties in ModelAdmin.readonly_fields . Full description Versions affected ¶ Django 1.7 (patch) Django 1.8 (patch) January 13, 2015 - CVE 2015-0222 ¶ Database denial-of-service with ModelMultipleChoiceField . Full description Versions affected ¶ Django 1.6 (patch) Django 1.7 (patch) January 13, 2015 - CVE 2015-0221 ¶ Denial-of-service attack against django.views.static.serve() . Full\ndescription Versions affected ¶ Django 1.4 (patch) Django 1.6 (patch) Django 1.7 (patch) January 13, 2015 - CVE 2015-0220 ¶ Mitigated possible XSS attack via user-supplied redirect URLs. Full\ndescription Versions affected ¶ Django 1.4 (patch) Django 1.6 (patch) Django 1.7 (patch) January 13, 2015 - CVE 2015-0219 ¶ WSGI header spoofing via underscore/dash conflation. Full description Versions affected ¶ Django 1.4 (patch) Django 1.6 (patch) Django 1.7 (patch) August 20, 2014 - CVE 2014-0483 ¶ Data leakage via querystring manipulation in admin. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) August 20, 2014 - CVE 2014-0482 ¶ RemoteUserMiddleware session hijacking. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) August 20, 2014 - CVE 2014-0481 ¶ File upload denial of service. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) August 20, 2014 - CVE 2014-0480 ¶ reverse() can generate URLs pointing to other hosts. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) May 18, 2014 - CVE 2014-3730 ¶ Malformed URLs from user input incorrectly validated. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) May 18, 2014 - CVE 2014-1418 ¶ Caches may be allowed to store and serve private data. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) April 21, 2014 - CVE 2014-0474 ¶ MySQL typecasting causes unexpected query results. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) April 21, 2014 - CVE 2014-0473 ¶ Caching of anonymous pages could reveal CSRF token. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) April 21, 2014 - CVE 2014-0472 ¶ Unexpected code execution using reverse() . Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) Django 1.6 (patch) Django 1.7 (patch) September 14, 2013 - CVE 2013-1443 ¶ Denial-of-service via large passwords. Full description Versions affected ¶ Django 1.4 (patch and Python compatibility fix) Django 1.5 (patch) September 10, 2013 - CVE 2013-4315 ¶ Directory-traversal via ssi template tag. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) August 13, 2013 - CVE 2013-6044 ¶ Possible XSS via unvalidated URL redirect schemes. Full description Versions affected ¶ Django 1.4 (patch) Django 1.5 (patch) August 13, 2013 - CVE 2013-4249 ¶ XSS via admin trusting URLField values. Full description Versions affected ¶ Django 1.5 (patch) February 19, 2013 - CVE 2013-0306 ¶ Denial-of-service via formset max_num bypass. Full description Versions affected ¶ Django 1.3 (patch) Django 1.4 (patch) February 19, 2013 - CVE 2013-0305 ¶ Information leakage via admin history log. Full description Versions affected ¶ Django 1.3 (patch) Django 1.4 (patch) February 19, 2013 - CVE 2013-1664 / CVE 2013-1665 ¶ Entity-based attacks against Python XML libraries. Full description Versions affected ¶ Django 1.3 (patch) Django 1.4 (patch) February 19, 2013 - No CVE ¶ Additional hardening of Host header handling. Full description Versions affected ¶ Django 1.3 (patch) Django 1.4 (patch) December 10, 2012 - No CVE 2 ¶ Additional hardening of redirect validation. Full description Versions affected ¶ Django 1.3: (patch) Django 1.4: (patch) December 10, 2012 - No CVE 1 ¶ Additional hardening of Host header handling. Full description Versions affected ¶ Django 1.3 (patch) Django 1.4 (patch) October 17, 2012 - CVE 2012-4520 ¶ Host header poisoning. Full description Versions affected ¶ Django 1.3 (patch) Django 1.4 (patch) July 30, 2012 - CVE 2012-3444 ¶ Denial-of-service via large image files. Full description Versions affected ¶ Django 1.3 (patch) Django 1.4 (patch) July 30, 2012 - CVE 2012-3443 ¶ Denial-of-service via compressed image files. Full description Versions affected ¶ Django 1.3: (patch) Django 1.4: (patch) July 30, 2012 - CVE 2012-3442 ¶ XSS via failure to validate redirect scheme. Full description Versions affected ¶ Django 1.3: (patch) Django 1.4: (patch) September 9, 2011 - CVE 2011-4140 ¶ Potential CSRF via Host header. Full description Versions affected ¶ This notification was an advisory only, so no patches were issued. Django 1.2 Django 1.3 September 9, 2011 - CVE 2011-4139 ¶ Host header cache poisoning. Full description Versions affected ¶ Django 1.2 (patch) Django 1.3 (patch) September 9, 2011 - CVE 2011-4138 ¶ Information leakage/arbitrary request issuance via URLField.verify_exists . Full description Versions affected ¶ Django 1.2: (patch) Django 1.3: (patch) September 9, 2011 - CVE 2011-4137 ¶ Denial-of-service via URLField.verify_exists . Full description Versions affected ¶ Django 1.2 (patch) Django 1.3 (patch) September 9, 2011 - CVE 2011-4136 ¶ Session manipulation when using memory-cache-backed session. Full description Versions affected ¶ Django 1.2 (patch) Django 1.3 (patch) February 8, 2011 - CVE 2011-0698 ¶ Directory-traversal on Windows via incorrect path-separator handling. Full\ndescription Versions affected ¶ Django 1.1 (patch) Django 1.2 (patch) February 8, 2011 - CVE 2011-0697 ¶ XSS via unsanitized names of uploaded files. Full description Versions affected ¶ Django 1.1 (patch) Django 1.2 (patch) February 8, 2011 - CVE 2011-0696 ¶ CSRF via forged HTTP headers. Full description Versions affected ¶ Django 1.1 (patch) Django 1.2 (patch) December 22, 2010 - CVE 2010-4535 ¶ Denial-of-service in password-reset mechanism. Full description Versions affected ¶ Django 1.1 (patch) Django 1.2 (patch) December 22, 2010 - CVE 2010-4534 ¶ Information leakage in administrative interface. Full description Versions affected ¶ Django 1.1 (patch) Django 1.2 (patch) September 8, 2010 - CVE 2010-3082 ¶ XSS via trusting unsafe cookie value. Full description Versions affected ¶ Django 1.2 (patch) October 9, 2009 - CVE 2009-3695 ¶ Denial-of-service via pathological regular expression performance. Full\ndescription Versions affected ¶ Django 1.0 (patch) Django 1.1 (patch) July 28, 2009 - CVE 2009-2659 ¶ Directory-traversal in development server media handler. Full description Versions affected ¶ Django 0.96 (patch) Django 1.0 (patch) September 2, 2008 - CVE 2008-3909 ¶ CSRF via preservation of POST data during admin login. Full description Versions affected ¶ Django 0.91 (patch) Django 0.95 (patch) Django 0.96 (patch) May 14, 2008 - CVE 2008-2302 ¶ XSS via admin login redirect. Full description Versions affected ¶ Django 0.91 (patch) Django 0.95 (patch) Django 0.96 (patch) October 26, 2007 - CVE 2007-5712 ¶ Denial-of-service via arbitrarily-large Accept-Language header. Full\ndescription Versions affected ¶ Django 0.91 (patch) Django 0.95 (patch) Django 0.96 (patch) Issues prior to Django’s security process ¶ Some security issues were handled before Django had a formalized\nsecurity process in use. For these, new releases may not have been\nissued at the time and CVEs may not have been assigned. January 21, 2007 - CVE 2007-0405 ¶ Apparent “caching” of authenticated user. Full description Versions affected ¶ Django 0.95 (patch) August 16, 2006 - CVE 2007-0404 ¶ Filename validation issue in translation framework. Full description Versions affected ¶ Django 0.90 (patch) Django 0.91 (patch) Django 0.95 (patch) (released January 21 2007)", "keywords": ["hijack", "users", "failure", "adminurlfieldwidget", "view", "store", "commonmiddleware", "open", "control", "popup", "potential", "username", "status", "dns", "formset", "login", "february", "django.views.static.serve", "headers", "jsonfield", "zeros", "url", "permissions", "proxy", "correction", "difference", "code", "site", "values", "ssi", "auth", "uploads", "july", "rfi", "advisory", "directories", "bypass", "filter", "privilege", "pages", "link", "lists", "denial", "field", "access", "windows", "conflation", "intcomma", "aggregate", "truncator", "hijacking", "list", "commitment", "archive", "apparent", "names", "detection", "+", "attack", "request", "newlines", "database", "host", "malformed", "input", "rc", "hasher", "libraries", "language", "email", "query", "page", "rhs", "tolerance", "postgresql", "google", "hosts", "cache", "compatibility", "logout", "level", "save_as", "august", "modelmultiplechoicefield", "django.core.files.storage.storage.save", "cached_db", "change", "queryset.values", "admin", "https", "gis", "emailvalidator", "links", "image", "urlfield", "django", "policies", "vulnerability", "fileresponse", "configuration", "http", "traversal", "hash", "=", "wsgi", "xml", "filename", "django.utils.numberformat.floatformat", "results", "download", "patch(es", "schemes", "development", "validation", "translation", "disclosure", "pointing", "log", "value", "escalation", "tag", "section", "usernamefield", "media", "pollution", "foreignkeyrawidwidget", "django.utils.encoding.uri_to_iri", "keys", "case", "poisoning", "process", "april", "dictsort", "debug", "data", "incorrect", "underscore", "separator", "cves", "handler", "use", "issuance", "backend", "django.utils.html.strip_tags", "haskey(lhs", "patch", "history", "hardening", "server", "alpha", "ssrf", "strip_tags", "arguments", "queryset.order_by", "manipulation", "ipv4", "add", "stringagg(delimiter", "upload", "security", "passwords", "entity", "xss", "paths", "performance", "protection", "django.utils.numberformat.format", "objects", "django.utils.text", "releases", "lookups", "enumeration", "reporting", "file", "handling", "work", "beta", "urlvalidator", "fix", "default", "interface", "validators", "user", "remoteusermiddleware", "django.utils.translation.get_supported_language_variant", "path", "occasion", "modeladmin", "functions", "key", "team", "form", "typecasting", "states", "authenticationform", "queryset.annotate", "factor", "filters", "properties", "expression", "issues", "tests", "dash", "mechanism", "time", "injection", "framework", "leakage", "date", "jquery", "caches", "caching", "urls", "account", "hstorefield", "preservation", "part", "support", "description", "scheme", "cve", "service", "truncatechars_html", "patches", "march", "max_num", "may", "caveats", "password", "permission", "userattributesimilarityvalidator", "files", "template", "response", "parameter", "november", "mysql", "directory", "%", "sql", "header", "aggregates", "execution", "exhaustion", "reset", "lfi", "information", "january", "python", "issue", "web", "upgrade", "urlizetrunc", "problems", "versions", "csrf", "modeladmin.readonly_fields", "index", "notification", "django.utils.text.truncator.words", "accept", "possibility", "september", "django.utils.html.urlize", "analytics", "advisories", "settings", "addresses", "¶", "redirect", "prototype", "session", "reverse", "cookie", "post", "memory", "october", "admindocs", "oracle", "attacks", "archive.extract", "timing", "storage.save", "django.utils.http.limited_parse_qsl", "system", "december", "june", "urlfield.verify_exists", "content", "project", "values_list"], "type": "documentation"},
{"title": "How to manage error reporting | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/error-reporting/", "content": "How to manage error reporting ¶ When you’re running a public site you should always turn off the DEBUG setting. That will make your server run much faster, and will\nalso prevent malicious users from seeing details of your application that can be\nrevealed by the error pages. However, running with DEBUG set to False means you’ll never see\nerrors generated by your site – everyone will instead see your public error\npages. You need to keep track of errors that occur in deployed sites, so Django\ncan be configured to create reports with details about those errors. Email reports ¶ Server errors ¶ When DEBUG is False , Django will email the users listed in the ADMINS setting whenever your code raises an unhandled exception and\nresults in an internal server error (strictly speaking, for any response with\nan HTTP status code of 500 or greater). This gives the administrators immediate\nnotification of any errors. The ADMINS will get a description of the\nerror, a complete Python traceback, and details about the HTTP request that\ncaused the error. Note In order to send email, Django requires a few settings telling it\nhow to connect to your mail server. At the very least, you’ll need\nto specify EMAIL_HOST and possibly EMAIL_HOST_USER and EMAIL_HOST_PASSWORD ,\nthough other settings may be also required depending on your mail\nserver’s configuration. Consult the Django settings\ndocumentation for a full list of email-related\nsettings. By default, Django will send email from root @ localhost . However, some mail\nproviders reject all email from this address. To use a different sender\naddress, modify the SERVER_EMAIL setting. To activate this behavior, put the email addresses of the recipients in the ADMINS setting. See also Server error emails are sent using the logging framework, so you can\ncustomize this behavior by customizing your logging configuration . 404 errors ¶ Django can also be configured to email errors about broken links (404 “page\nnot found” errors). Django sends emails about 404 errors when: DEBUG is False ; Your MIDDLEWARE setting includes django.middleware.common.BrokenLinkEmailsMiddleware . If those conditions are met, Django will email the users listed in the MANAGERS setting whenever your code raises a 404 and the request has\na referer. It doesn’t bother to email for 404s that don’t have a referer –\nthose are usually people typing in broken URLs or broken web bots. It also\nignores 404s when the referer is equal to the requested URL, since this\nbehavior is from broken web bots too. Note BrokenLinkEmailsMiddleware must appear\nbefore other middleware that intercepts 404 errors, such as LocaleMiddleware or FlatpageFallbackMiddleware .\nPut it toward the top of your MIDDLEWARE setting. You can tell Django to stop reporting particular 404s by tweaking the IGNORABLE_404_URLS setting. It should be a list of compiled\nregular expression objects. For example: import re IGNORABLE_404_URLS = [ re . compile ( r \"\\.(php|cgi)$\" ), re . compile ( r \"^/phpmyadmin/\" ), ] In this example, a 404 to any URL ending with .php or .cgi will not be\nreported. Neither will any URL starting with /phpmyadmin/ . The following example shows how to exclude some conventional URLs that browsers and\ncrawlers often request: import re IGNORABLE_404_URLS = [ re . compile ( r \"^/apple-touch-icon.*\\.png$\" ), re . compile ( r \"^/favicon\\.ico$\" ), re . compile ( r \"^/robots\\.txt$\" ), ] (Note that these are regular expressions, so we put a backslash in front of\nperiods to escape them.) If you’d like to customize the behavior of django.middleware.common.BrokenLinkEmailsMiddleware further (for\nexample to ignore requests coming from web crawlers), you should subclass it\nand override its methods. See also 404 errors are logged using the logging framework. By default, these log\nrecords are ignored, but you can use them for error reporting by writing a\nhandler and configuring logging appropriately. Filtering error reports ¶ Warning Filtering sensitive data is a hard problem, and it’s nearly impossible to\nguarantee that sensitive data won’t leak into an error report. Therefore,\nerror reports should only be available to trusted team members and you\nshould avoid transmitting error reports unencrypted over the internet\n(such as through email). Filtering sensitive information ¶ Error reports are really helpful for debugging errors, so it is generally\nuseful to record as much relevant information about those errors as possible.\nFor example, by default Django records the full traceback for the\nexception raised, each traceback frame ’s local variables, and the HttpRequest ’s attributes . However, sometimes certain types of information may be too sensitive and thus\nmay not be appropriate to be kept track of, for example a user’s password or\ncredit card number. So in addition to filtering out settings that appear to be\nsensitive as described in the DEBUG documentation, Django offers a\nset of function decorators to help you control which information should be\nfiltered out of error reports in a production environment (that is, where DEBUG is set to False ): sensitive_variables() and sensitive_post_parameters() . sensitive_variables ( * variables ) [source] ¶ If a function (either a view or any regular callback) in your code uses\nlocal variables susceptible to contain sensitive information, you may\nprevent the values of those variables from being included in error reports\nusing the sensitive_variables decorator: from django.views.decorators.debug import sensitive_variables @sensitive_variables ( \"user\" , \"pw\" , \"cc\" ) def process_info ( user ): pw = user . pass_word cc = user . credit_card_number name = user . name ... In the above example, the values for the user , pw and cc variables will be hidden and replaced with stars ( ********** )\nin the error reports, whereas the value of the name variable will be\ndisclosed. To systematically hide all local variables of a function from error logs,\ndo not provide any argument to the sensitive_variables decorator: @sensitive_variables () def my_function (): ... When using multiple decorators If the variable you want to hide is also a function argument (e.g.\n‘ user ’ in the following example), and if the decorated function has\nmultiple decorators, then make sure to place @sensitive_variables at the top of the decorator chain. This way it will also hide the\nfunction argument as it gets passed through the other decorators: @sensitive_variables ( \"user\" , \"pw\" , \"cc\" ) @some_decorator @another_decorator def process_info ( user ): ... Changed in Django 5.0: Support for wrapping async functions was added. sensitive_post_parameters ( * parameters ) [source] ¶ If one of your views receives an HttpRequest object\nwith POST parameters susceptible to\ncontain sensitive information, you may prevent the values of those\nparameters from being included in the error reports using the sensitive_post_parameters decorator: from django.views.decorators.debug import sensitive_post_parameters @sensitive_post_parameters ( \"pass_word\" , \"credit_card_number\" ) def record_user_profile ( request ): UserProfile . create ( user = request . user , password = request . POST [ \"pass_word\" ], credit_card = request . POST [ \"credit_card_number\" ], name = request . POST [ \"name\" ], ) ... In the above example, the values for the pass_word and credit_card_number POST parameters will be hidden and replaced with\nstars ( ********** ) in the request’s representation inside the\nerror reports, whereas the value of the name parameter will be\ndisclosed. To systematically hide all POST parameters of a request in error reports,\ndo not provide any argument to the sensitive_post_parameters decorator: @sensitive_post_parameters () def my_view ( request ): ... All POST parameters are systematically filtered out of error reports for\ncertain django.contrib.auth.views views ( login , password_reset_confirm , password_change , and add_view and user_change_password in the auth admin) to prevent the leaking of\nsensitive information such as user passwords. Changed in Django 5.0: Support for wrapping async functions was added. Custom error reports ¶ All sensitive_variables() and sensitive_post_parameters() do is,\nrespectively, annotate the decorated function with the names of sensitive\nvariables and annotate the HttpRequest object with the names of sensitive\nPOST parameters, so that this sensitive information can later be filtered out\nof reports when an error occurs. The actual filtering is done by Django’s\ndefault error reporter filter: django.views.debug.SafeExceptionReporterFilter . This filter uses the\ndecorators’ annotations to replace the corresponding values with stars\n( ********** ) when the error reports are produced. If you wish to\noverride or customize this default behavior for your entire site, you need to\ndefine your own filter class and tell Django to use it via the DEFAULT_EXCEPTION_REPORTER_FILTER setting: DEFAULT_EXCEPTION_REPORTER_FILTER = \"path.to.your.CustomExceptionReporterFilter\" You may also control in a more granular way which filter to use within any\ngiven view by setting the HttpRequest ’s exception_reporter_filter attribute: def my_view ( request ): if request . user . is_authenticated : request . exception_reporter_filter = CustomExceptionReporterFilter () ... Your custom filter class needs to inherit from django.views.debug.SafeExceptionReporterFilter and may override the\nfollowing attributes and methods: class SafeExceptionReporterFilter [source] ¶ cleansed_substitute ¶ The string value to replace sensitive value with. By default it\nreplaces the values of sensitive variables with stars\n( ********** ). hidden_settings ¶ A compiled regular expression object used to match settings and request.META values considered as sensitive. By default equivalent\nto: import re re . compile ( r \"API|TOKEN|KEY|SECRET|PASS|SIGNATURE|HTTP_COOKIE\" , flags = re . IGNORECASE ) is_active ( request ) [source] ¶ Returns True to activate the filtering in get_post_parameters() and get_traceback_frame_variables() .\nBy default the filter is active if DEBUG is False . Note\nthat sensitive request.META values are always filtered along with\nsensitive setting values, as described in the DEBUG documentation. get_post_parameters ( request ) [source] ¶ Returns the filtered dictionary of POST parameters. Sensitive values\nare replaced with cleansed_substitute . get_traceback_frame_variables ( request , tb_frame ) [source] ¶ Returns the filtered dictionary of local variables for the given\ntraceback frame. Sensitive values are replaced with cleansed_substitute . If you need to customize error reports beyond filtering you may specify a\ncustom error reporter class by defining the DEFAULT_EXCEPTION_REPORTER setting: DEFAULT_EXCEPTION_REPORTER = \"path.to.your.CustomExceptionReporter\" The exception reporter is responsible for compiling the exception report data,\nand formatting it as text or HTML appropriately. (The exception reporter uses DEFAULT_EXCEPTION_REPORTER_FILTER when preparing the exception\nreport data.) Your custom reporter class needs to inherit from django.views.debug.ExceptionReporter . class ExceptionReporter [source] ¶ html_template_path [source] ¶ Property that returns a pathlib.Path representing the absolute\nfilesystem path to a template for rendering the HTML representation of\nthe exception. Defaults to the Django provided template. text_template_path [source] ¶ Property that returns a pathlib.Path representing the absolute\nfilesystem path to a template for rendering the plain-text\nrepresentation of the exception. Defaults to the Django provided\ntemplate. get_traceback_data () [source] ¶ Return a dictionary containing traceback information. This is the main extension point for customizing exception reports, for\nexample: from django.views.debug import ExceptionReporter class CustomExceptionReporter ( ExceptionReporter ): def get_traceback_data ( self ): data = super () . get_traceback_data () # ... remove/add something here ... return data get_traceback_html () [source] ¶ Return HTML version of exception report. Used for HTML version of debug 500 HTTP error page. get_traceback_text () [source] ¶ Return plain text version of exception report. Used for plain text version of debug 500 HTTP error page and email\nreports. As with the filter class, you may control which exception reporter class to use\nwithin any given view by setting the HttpRequest ’s exception_reporter_class attribute: def my_view ( request ): if request . user . is_authenticated : request . exception_reporter_class = CustomExceptionReporter () ... See also You can also set up custom error reporting by writing a custom piece of exception middleware . If you do write custom\nerror handling, it’s a good idea to emulate Django’s built-in error handling\nand only report/log errors if DEBUG is False .", "keywords": ["function", "users", "views", "view", "production", "record_user_profile", "status", "credit_card", "number", "login", "url", "error", "conditions", "def", "code", "point", "site", "values", "auth", "404s", "get_traceback_text", "pages", "filter", "false", "behavior", "referer", "addition", "class", "sender", "example", "safeexceptionreporterfilter", "string", "api|token|key|secret|pass|signature|http_cookie", "touch", "#", "icon.*\\.png$", "list", "default_exception_reporter_filter", "ignorecase", "returns", "pass_word", "names", "customexceptionreporterfilter", "brokenlinkemailsmiddleware", "request", "managers", "emails", "user_change_password", "representation", "email", "*", "page", "re", "@another_decorator", "version", "types", "cleansed_substitute", "variable", "path.to.your", "password_reset_confirm", "admin", "idea", "links", "ignorable_404_urls", "application", "exception_reporter_filter", "attributes", "pw", "django", "django.views.debug", "http", "configuration", "=", "^/phpmyadmin/", "n’t", "frame", "results", "administrators", "localhost", "logs", "set", "track", "password_change", "r", "log", "value", "filesystem", "email_host_password", "^/favicon\\.ico$", "cc", "source", "html_template_path", "mail", "equivalent", "data", "card", "get_traceback_data", "debug", "handler", "errors", "html", "environment", "server", "my_function", "stars", "passwords", ".php", "^/apple", "middleware", "pathlib", "self", "people", "custom", "objects", "documentation", "flatpagefallbackmiddleware", "members", "get_traceback_frame_variables", "records", "reporting", "tb_frame", "sensitive_variables", "bots", "extension", "handling", "order", "get_traceback_html", "default", "server_email", "user", "default_exception_reporter", "report", "path", "recipients", "credit_card_number", "functions", "front", "team", "annotations", "attribute", "my_view", "callback", "expression", "problem", "decorator", "warning", "get_post_parameters", "framework", "setting", "/phpmyadmin/", "^/robots\\.txt$", "browsers", "sensitive_post_parameters", "add_view", "urls", "crawlers", "description", "support", "providers", "@sensitive_post_parameters", "object", "django.middleware.common", "backslash", "leaking", "chain", "password", "process_info", "localemiddleware", "import", "name", "httprequest", "admins", "template", "response", ".cgi", "parameter", "dictionary", "compile", "defaults", "traceback", "requests", "flags", "way", "reporter", "internet", "consult", "information", "django.contrib.auth.views", "web", "python", "exceptionreporter", "hidden_settings", "methods", "userprofile", "exception_reporter_class", "notification", "exception", "django.views.decorators.debug", "details", "credit", "top", "variables", "periods", "root", "settings", "decorators", "@sensitive_variables", "reports", "¶", "addresses", "argument", "return", "piece", "sites", "parameters", "post", "expressions", "address", "customexceptionreporter", "property", "means", "\\.(php|cgi)$", "text", "filtering", "async"], "type": "documentation"},
{"title": "Geolocation with GeoIP2 | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/geoip2/", "content": "Geolocation with GeoIP2 ¶ The GeoIP2 object is a wrapper for the MaxMind geoip2 Python\nlibrary . [ 1 ] In order to perform IP-based geolocation, the GeoIP2 object requires\nthe geoip2 Python package and the GeoIP Country and/or City datasets in binary format (the CSV files will not work!), downloaded from e.g. MaxMind or DB-IP websites. Grab the GeoLite2-Country.mmdb.gz and GeoLite2-City.mmdb.gz files and unzip them in a directory corresponding to\nthe GEOIP_PATH setting. Additionally, it is recommended to install the libmaxminddb C library , so\nthat geoip2 can leverage the C library’s faster speed. Example ¶ Here is an example of its usage: >>> from django.contrib.gis.geoip2 import GeoIP2 >>> g = GeoIP2 () >>> g . country ( \"google.com\" ) {'continent_code': 'NA', 'continent_name': 'North America', 'country_code': 'US', 'country_name': 'United States', 'is_in_european_union': False} >>> g . city ( \"72.14.207.99\" ) {'accuracy_radius': 1000, 'city': 'Mountain View', 'continent_code': 'NA', 'continent_name': 'North America', 'country_code': 'US', 'country_name': 'United States', 'is_in_european_union': False, 'latitude': 37.419200897216797, 'longitude': -122.05740356445312, 'metro_code': 807, 'postal_code': '94043', 'region_code': 'CA', 'region_name': 'California', 'time_zone': 'America/Los_Angeles', 'dma_code': 807, 'region': 'CA'} >>> g . lat_lon ( \"salon.com\" ) (39.0437, -77.4875) >>> g . lon_lat ( \"uh.edu\" ) (-95.4342, 29.834) >>> g . geos ( \"24.124.1.80\" ) . wkt 'POINT (-97 38)' API Reference ¶ class GeoIP2 ( path = None , cache = 0 , country = None , city = None ) [source] ¶ The GeoIP object does not require any parameters to use the default\nsettings. However, at the very least the GEOIP_PATH setting\nshould be set with the path of the location of your GeoIP datasets. The\nfollowing initialization keywords may be used to customize any of the\ndefaults. Keyword Arguments Description path Base directory to where GeoIP data is located or the\nfull path to where the city or country data files\n( .mmdb ) are located. Assumes that both the city and\ncountry datasets are located in this directory;\noverrides the GEOIP_PATH setting. cache The cache settings when opening up the GeoIP datasets. May\nbe an integer in (0, 1, 2, 4, 8) corresponding to the MODE_AUTO , MODE_MMAP_EXT , MODE_MMAP , and GEOIP_INDEX_CACHE MODE_MEMORY C API settings,\nrespectively. Defaults to 0 ( MODE_AUTO ). country The name of the GeoIP country data file. Defaults\nto GeoLite2-Country.mmdb . Setting this keyword\noverrides the GEOIP_COUNTRY setting. city The name of the GeoIP city data file. Defaults to GeoLite2-City.mmdb . Setting this keyword overrides\nthe GEOIP_CITY setting. Methods ¶ Instantiating ¶ classmethod GeoIP2. open ( path , cache ) [source] ¶ This classmethod instantiates the GeoIP object from the given database path\nand given cache setting. Deprecated since version 5.1: Use the GeoIP2() constructor instead. Querying ¶ All the following querying routines may take an instance of IPv4Address or IPv6Address , a string IP\naddress, or a fully qualified domain name (FQDN). For example, IPv4Address(\"205.186.163.125\") , \"205.186.163.125\" , and \"djangoproject.com\" would all be valid query parameters. GeoIP2. city ( query ) [source] ¶ Returns a dictionary of city information for the given query. Some\nof the values in the dictionary may be undefined ( None ). GeoIP2. country ( query ) [source] ¶ Returns a dictionary with the country code and country for the given\nquery. GeoIP2. country_code ( query ) [source] ¶ Returns the country code corresponding to the query. GeoIP2. country_name ( query ) [source] ¶ Returns the country name corresponding to the query. Coordinate Retrieval ¶ GeoIP2. coords ( query ) [source] ¶ Returns a coordinate tuple of (longitude, latitude). Deprecated since version 5.1: Use GeoIP2.lon_lat() instead. GeoIP2. lon_lat ( query ) [source] ¶ Returns a coordinate tuple of (longitude, latitude). GeoIP2. lat_lon ( query ) [source] ¶ Returns a coordinate tuple of (latitude, longitude), GeoIP2. geos ( query ) [source] ¶ Returns a Point object corresponding to the\nquery. Settings ¶ GEOIP_PATH ¶ A string or pathlib.Path specifying the directory where the GeoIP data\nfiles are located. This setting is required unless manually specified\nwith path keyword when initializing the GeoIP2 object. GEOIP_COUNTRY ¶ The basename to use for the GeoIP country data file. Defaults to 'GeoLite2-Country.mmdb' . GEOIP_CITY ¶ The basename to use for the GeoIP city data file. Defaults to 'GeoLite2-City.mmdb' . Exceptions ¶ exception GeoIP2Exception [source] ¶ The exception raised when an error occurs in the GeoIP2 wrapper.\nExceptions from the underlying geoip2 library are passed through\nunchanged. Footnotes [ 1 ] GeoIP(R) is a registered trademark of MaxMind, Inc.", "keywords": ["keywords", "8)", "routines", "view", "geolocation", "websites", "country_code", "lat_lon", "72.14.207.99", "wrapper", "los_angeles", "csv", "error", "point", "classmethod", "assumes", "code", "values", "library", "false", "ca", "c", "string", "class", "example", "inc.", "django.contrib.gis.geoip2", "country", "city", "longitude", "geolite2-city.mmdb.gz", "returns", "database", "fqdn", "location", "query", "coords", "cache", "version", "continent_name", "geoip2", "mode_auto", "coordinate", "-122.05740356445312", "datasets", "ipv4address(\"205.186.163.125", "usage", "geoip_index_cache", "=", "ip", "country_name", "instantiating", "geos", "db", "geolite2-city.mmdb", "geoip(r", "wkt", "source", "retrieval", "data", "california", "lon_lat", "use", "is_in_european_union", "base", "continent_code", "tuple", "arguments", "postal_code", "geolite2-country.mmdb", "trademark", "package", "pathlib", "accuracy_radius", "-97", "instance", "ipv4address", "g", "maxmind", "file", "speed", "initialization", "region", "order", "default", "region_name", "latitude", "path", "na", "uh.edu", "states", "none", "format", "24.124.1.80", "geoip2.lon_lat", "america", "constructor", "mountain", "region_code", "united", "metro_code", "setting", "api", "description", "geoip", "object", "basename", "domain", "north", "us", "files", "import", "mode_mmap_ext", "name", "directory", "defaults", "dictionary", "reference", "information", "python", ".mmdb", "keyword", "methods", "footnotes", "exception", "integer", "settings", "ipv6address", "¶", "mode_mmap", "parameters", "address", "geoip2exception", "exceptions"], "type": "documentation"},
{"title": "System check framework | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/checks/", "content": "System check framework ¶ The system check framework is a set of static checks for validating Django\nprojects. It detects common problems and provides hints for how to fix them.\nThe framework is extensible so you can easily add your own checks. For details on how to add your own checks and integrate them with Django’s\nsystem checks, see the System check topic guide . API reference ¶ CheckMessage ¶ class CheckMessage ( level , msg , hint = None , obj = None , id = None ) [source] ¶ The warnings and errors raised by system checks must be instances of CheckMessage . An instance encapsulates a single reportable error or\nwarning. It also provides context and hints applicable to the message, and a\nunique identifier that is used for filtering purposes. Constructor arguments are: level The severity of the message. Use one of the predefined values: DEBUG , INFO , WARNING , ERROR , CRITICAL . If the level is greater or\nequal to ERROR , then Django will prevent management commands from\nexecuting. Messages with level lower than ERROR (i.e. warnings) are\nreported to the console, but can be silenced. msg A short (less than 80 characters) string describing the problem. The string\nshould not contain newlines. hint A single-line string providing a hint for fixing the problem. If no hint\ncan be provided, or the hint is self-evident from the error message, the\nhint can be omitted, or a value of None can be used. obj Optional. An object providing context for the message (for example, the\nmodel where the problem was discovered). The object should be a model,\nfield, or manager or any other object that defines a __str__() method.\nThe method is used while reporting all messages and its result precedes the\nmessage. id Optional string. A unique identifier for the issue. Identifiers should\nfollow the pattern applabel.X001 , where X is one of the letters CEWID , indicating the message severity ( C for criticals, E for\nerrors and so). The number can be allocated by the application, but should\nbe unique within that application. There are subclasses to make creating messages with common levels easier. When\nusing them you can omit the level argument because it is implied by the\nclass name. class Debug ( msg , hint = None , obj = None , id = None ) [source] ¶ class Info ( msg , hint = None , obj = None , id = None ) [source] ¶ class Warning ( msg , hint=None obj=None , id=None ) [source] ¶ class Error ( msg , hint = None , obj = None , id = None ) [source] ¶ class Critical ( msg , hint = None , obj = None , id = None ) [source] ¶ Builtin tags ¶ Django’s system checks are organized using the following tags: admin : Checks of any admin site declarations. async_support : Checks asynchronous-related configuration. caches : Checks cache related configuration. compatibility : Flags potential problems with version upgrades. database : Checks database-related configuration issues. Database checks\nare not run by default because they do more than static code analysis as\nregular checks do. They are only run by the migrate command or if\nyou specify configured database aliases using the --database option when\ncalling the check command. files : Checks files related configuration. models : Checks of model, field, and manager definitions. security : Checks security related configuration. signals : Checks on signal declarations and handler registrations. sites : Checks django.contrib.sites configuration. staticfiles : Checks django.contrib.staticfiles configuration. templates : Checks template related configuration. translation : Checks translation related configuration. urls : Checks URL configuration. Some checks may be registered with multiple tags. Core system checks ¶ Asynchronous support ¶ The following checks verify your setup for Asynchronous support : async.E001 : You should not set the DJANGO_ALLOW_ASYNC_UNSAFE environment variable in deployment. This disables async safety\nprotection . Backwards compatibility ¶ Compatibility checks warn of potential problems that might occur after\nupgrading Django. 2_0.W001 : Your URL pattern <pattern> has a route that contains (?P< , begins with a ^ , or ends with a $ . This was likely an\noversight when migrating from url() to path() . 4_0.E001 : As of Django 4.0, the values in the CSRF_TRUSTED_ORIGINS setting must start with a scheme (usually http:// or https:// ) but found <hostname> . Caches ¶ The following checks verify that your CACHES setting is correctly\nconfigured: caches.E001 : You must define a 'default' cache in your CACHES setting. caches.W002 : Your <cache> configuration might expose your cache or\nlead to corruption of your data because its LOCATION matches/is inside/contains MEDIA_ROOT / STATIC_ROOT / STATICFILES_DIRS . caches.W003 : Your <cache> cache LOCATION is relative. Use an absolute path instead. Database ¶ MySQL and MariaDB ¶ If you’re using MySQL or MariaDB, the following checks will be performed: mysql.E001 : MySQL/MariaDB does not allow unique CharField s to have a max_length > 255. This check was changed to mysql.W003 in Django\n3.1 as the real maximum size depends on many factors. mysql.W002 : MySQL/MariaDB Strict Mode is not set for database connection <alias> . See also Setting sql_mode . mysql.W003 : MySQL/MariaDB may not allow unique CharField s to have a max_length > 255. Managing files ¶ The following checks verify your setup for Managing files : files.E001 : The FILE_UPLOAD_TEMP_DIR setting refers to the\nnonexistent directory <path> . Model fields ¶ fields.E001 : Field names must not end with an underscore. fields.E002 : Field names must not contain \"__\" . fields.E003 : pk is a reserved word that cannot be used as a field\nname. fields.E004 : choices must be a mapping (e.g. a dictionary) or an\niterable (e.g. a list or tuple). fields.E005 : choices must be a mapping of actual values to human\nreadable names or an iterable containing (actual value, human readable name) tuples. fields.E006 : db_index must be None , True or False . fields.E007 : Primary keys must not have null=True . fields.E008 : All validators must be callable. fields.E009 : max_length is too small to fit the longest value in choices ( <count> characters). fields.E010 : <field> default should be a callable instead of an\ninstance so that it’s not shared between all field instances. fields.E011 : <database> does not support default database values with\nexpressions ( db_default ). fields.E012 : <expression> cannot be used in db_default . fields.E100 : AutoField s must set primary_key=True. fields.E110 : BooleanField s do not accept null values. This check\nappeared before support for null values was added in Django 2.1. fields.E120 : CharField s must define a max_length attribute. fields.E121 : max_length must be a positive integer. fields.W122 : max_length is ignored when used with <integer field type> . fields.E130 : DecimalField s must define a decimal_places attribute. fields.E131 : decimal_places must be a non-negative integer. fields.E132 : DecimalField s must define a max_digits attribute. fields.E133 : max_digits must be a positive integer. fields.E134 : max_digits must be greater or equal to decimal_places . fields.E140 : FilePathField s must have either allow_files or allow_folders set to True. fields.E150 : GenericIPAddressField s cannot have blank=True if null=False , as blank values are stored as nulls. fields.E160 : The options auto_now , auto_now_add , and default are mutually exclusive. Only one of these options may be present. fields.W161 : Fixed default value provided. fields.W162 : <database> does not support a database index on <field data type> columns. fields.W163 : <database> does not support comments on columns\n( db_comment ). fields.E170 : BinaryField ’s default cannot be a string. Use bytes\ncontent instead. fields.E180 : <database> does not support JSONField s. fields.E190 : <database> does not support a database collation on <field_type> s. fields.E220 : <database> does not support GeneratedField s. fields.E221 : <database> does not support non-persisted GeneratedField s. fields.E222 : <database> does not support persisted GeneratedField s. fields.E223 : GeneratedField.output_field has errors: … fields.W224 : GeneratedField.output_field has warnings: … fields.E900 : IPAddressField has been removed except for support in\nhistorical migrations. fields.W900 : IPAddressField has been deprecated. Support for it\n(except in historical migrations) will be removed in Django 1.9. This check\nappeared in Django 1.7 and 1.8 . fields.W901 : CommaSeparatedIntegerField has been deprecated. Support\nfor it (except in historical migrations) will be removed in Django 2.0. This\ncheck appeared in Django 1.10 and 1.11 . fields.E901 : CommaSeparatedIntegerField is removed except for support\nin historical migrations. fields.W902 : FloatRangeField is deprecated and will be removed in\nDjango 3.1. This check appeared in Django 2.2 and 3.0 . fields.W903 : NullBooleanField is deprecated. Support for it (except\nin historical migrations) will be removed in Django 4.0. This check appeared\nin Django 3.1 and 3.2 . fields.E903 : NullBooleanField is removed except for support in\nhistorical migrations. fields.W904 : django.contrib.postgres.fields.JSONField is deprecated.\nSupport for it (except in historical migrations) will be removed in Django\n4.0. This check appeared in Django 3.1 and 3.2 . fields.E904 : django.contrib.postgres.fields.JSONField is removed\nexcept for support in historical migrations. fields.W905 : django.contrib.postgres.fields.CICharField is\ndeprecated. Support for it (except in historical migrations) will be removed\nin Django 5.1. This check appeared in Django 4.2 and 5.0 . fields.E905 : django.contrib.postgres.fields.CICharField is removed\nexcept for support in historical migrations. fields.W906 : django.contrib.postgres.fields.CIEmailField is\ndeprecated. Support for it (except in historical migrations) will be removed\nin Django 5.1. This check appeared in Django 4.2 and 5.0 . fields.E906 : django.contrib.postgres.fields.CIEmailField is removed\nexcept for support in historical migrations. fields.W907 : django.contrib.postgres.fields.CITextField is\ndeprecated. Support for it (except in historical migrations) will be removed\nin Django 5.1. This check appeared in Django 4.2 and 5.0 . fields.E907 : django.contrib.postgres.fields.CITextField is removed\nexcept for support for historical migrations. File fields ¶ fields.E200 : unique is not a valid argument for a FileField . This check is removed in Django 1.11 . fields.E201 : primary_key is not a valid argument for a FileField . fields.E202 : FileField ’s upload_to argument must be a relative\npath, not an absolute path. fields.E210 : Cannot use ImageField because Pillow is not installed. Related fields ¶ fields.E300 : Field defines a relation with model <model> , which is\neither not installed, or is abstract. fields.E301 : Field defines a relation with the model <app_label>.<model> which has been swapped out. fields.E302 : Reverse accessor <related model>.<accessor name> for <app_label>.<model>.<field name> clashes with field name <app_label>.<model>.<field name> . fields.E303 : Reverse query name for <app_label>.<model>.<field name> clashes with field name <app_label>.<model>.<field name> . fields.E304 : Reverse accessor <related model>.<accessor name> for <app_label>.<model>.<field name> clashes with reverse accessor for <app_label>.<model>.<field name> . fields.E305 : Reverse query name for <app_label>.<model>.<field name> clashes with reverse query name for <app_label>.<model>.<field name> . fields.E306 : The name <name> is invalid related_name for field <model>.<field name> . fields.E307 : The field <app label>.<model>.<field name> was declared\nwith a lazy reference to <app label>.<model> , but app <app label> isn’t installed or doesn’t provide model <model> . fields.E308 : Reverse query name <related query name> must not end\nwith an underscore. fields.E309 : Reverse query name <related query name> must not contain '__' . fields.E310 : No subset of the fields <field1> , <field2> , … on\nmodel <model> is unique. fields.E311 : <model>.<field name> must be unique because it is\nreferenced by a ForeignKey . fields.E312 : The to_field <field name> doesn’t exist on the\nrelated model <app label>.<model> . fields.E320 : Field specifies on_delete=SET_NULL , but cannot be null. fields.E321 : The field specifies on_delete=SET_DEFAULT , but has no\ndefault value. fields.E330 : ManyToManyField s cannot be unique. fields.E331 : Field specifies a many-to-many relation through model <model> , which has not been installed. fields.E332 : Many-to-many fields with intermediate tables must not be\nsymmetrical. This check appeared before Django 3.0. fields.E333 : The model is used as an intermediate model by <model> ,\nbut it has more than two foreign keys to <model> , which is ambiguous.\nYou must specify which two foreign keys Django should use via the through_fields keyword argument. fields.E334 : The model is used as an intermediate model by <model> ,\nbut it has more than one foreign key from <model> , which is ambiguous.\nYou must specify which foreign key Django should use via the through_fields keyword argument. fields.E335 : The model is used as an intermediate model by <model> ,\nbut it has more than one foreign key to <model> , which is ambiguous.\nYou must specify which foreign key Django should use via the through_fields keyword argument. fields.E336 : The model is used as an intermediary model by <model> ,\nbut it does not have foreign key to <model> or <model> . fields.E337 : Field specifies through_fields but does not provide the\nnames of the two link fields that should be used for the relation through <model> . fields.E338 : The intermediary model <through model> has no field <field name> . fields.E339 : <model>.<field name> is not a foreign key to <model> . fields.E340 : The field’s intermediary table <table name> clashes with\nthe table name of <model> / <model>.<field name> . fields.W340 : null has no effect on ManyToManyField . fields.W341 : ManyToManyField does not support validators . fields.W342 : Setting unique=True on a ForeignKey has the same\neffect as using a OneToOneField . fields.W343 : limit_choices_to has no effect on ManyToManyField with a through model. This check appeared before Django 4.0. fields.W344 : The field’s intermediary table <table name> clashes with\nthe table name of <model> / <model>.<field name> . fields.W345 : related_name has no effect on ManyToManyField with a\nsymmetrical relationship, e.g. to “self”. fields.W346 : db_comment has no effect on ManyToManyField . Models ¶ models.E001 : <swappable> is not of the form app_label.app_name . models.E002 : <SETTING> references <model> , which has not been\ninstalled, or is abstract. models.E003 : The model has two identical many-to-many relations through\nthe intermediate model <app_label>.<model> . models.E004 : id can only be used as a field name if the field also\nsets primary_key=True . models.E005 : The field <field name> from parent model <model> clashes with the field <field name> from parent model <model> . models.E006 : The field <field name> clashes with the field <field name> from model <model> . models.E007 : Field <field name> has column name <column name> that is used by another field. models.E008 : index_together must be a list or tuple. This check\nappeared before Django 5.1. models.E009 : All index_together elements must be lists or tuples. This check appeared before Django 5.1. models.E010 : unique_together must be a list or tuple. models.E011 : All unique_together elements must be lists or tuples. models.E012 : constraints/indexes/unique_together refers to the\nnonexistent field <field name> . models.E013 : constraints/indexes/unique_together refers to a ManyToManyField <field name> , but ManyToManyField s are not\nsupported for that option. models.E014 : ordering must be a tuple or list (even if you want to\norder by only one field). models.E015 : ordering refers to the nonexistent field, related field,\nor lookup <field name> . models.E016 : constraints/indexes/unique_together refers to field <field_name> which is not local to model <model> . models.E017 : Proxy model <model> contains model fields. models.E018 : Autogenerated column name too long for field <field> .\nMaximum length is <maximum length> for database <alias> . models.E019 : Autogenerated column name too long for M2M field <M2M field> . Maximum length is <maximum length> for database <alias> . models.E020 : The <model>.check() class method is currently overridden. models.E021 : ordering and order_with_respect_to cannot be used\ntogether. models.E022 : <function> contains a lazy reference to <app label>.<model> , but app <app label> isn’t installed or\ndoesn’t provide model <model> . models.E023 : The model name <model> cannot start or end with an\nunderscore as it collides with the query lookup syntax. models.E024 : The model name <model> cannot contain double underscores\nas it collides with the query lookup syntax. models.E025 : The property <property name> clashes with a related\nfield accessor. models.E026 : The model cannot have more than one field with primary_key=True . models.W027 : <database> does not support check constraints. models.E028 : db_table <db_table> is used by multiple models: <model list> . models.E029 : index name <index> is not unique for model <model> . models.E030 : index name <index> is not unique among models: <model list> . models.E031 : constraint name <constraint> is not unique for model <model> . models.E032 : constraint name <constraint> is not unique among\nmodels: <model list> . models.E033 : The index name <index> cannot start with an underscore\nor a number. models.E034 : The index name <index> cannot be longer than <max_length> characters. models.W035 : db_table <db_table> is used by multiple models: <model list> . models.W036 : <database> does not support unique constraints with\nconditions. models.W037 : <database> does not support indexes with conditions. models.W038 : <database> does not support deferrable unique\nconstraints. models.W039 : <database> does not support unique constraints with\nnon-key columns. models.W040 : <database> does not support indexes with non-key\ncolumns. models.E041 : constraints refers to the joined field <field name> . models.W042 : Auto-created primary key used when not defining a primary\nkey type, by default django.db.models.AutoField . models.W043 : <database> does not support indexes on expressions. models.W044 : <database> does not support unique constraints on\nexpressions. models.W045 : Check constraint <constraint> contains RawSQL() expression and won’t be validated during the model full_clean() . models.W046 : <database> does not support comments on tables\n( db_table_comment ). models.W047 : <database> does not support unique constraints with\nnulls distinct. Security ¶ The security checks do not make your site secure. They do not audit code, do\nintrusion detection, or do anything particularly complex. Rather, they help\nperform an automated, low-hanging-fruit checklist, that can help you to improve\nyour site’s security. Some of these checks may not be appropriate for your particular deployment\nconfiguration. For instance, if you do your HTTP to HTTPS redirection in a load\nbalancer, it’d be irritating to be constantly warned about not having enabled SECURE_SSL_REDIRECT . Use SILENCED_SYSTEM_CHECKS to\nsilence unneeded checks. The following checks are run if you use the check --deploy option: security.W001 : You do not have django.middleware.security.SecurityMiddleware in your MIDDLEWARE so the SECURE_HSTS_SECONDS , SECURE_CONTENT_TYPE_NOSNIFF , SECURE_REFERRER_POLICY , SECURE_CROSS_ORIGIN_OPENER_POLICY , and SECURE_SSL_REDIRECT settings will have no effect. security.W002 : You do not have django.middleware.clickjacking.XFrameOptionsMiddleware in your MIDDLEWARE , so your pages will not be served with an 'x-frame-options' header. Unless there is a good reason for your\nsite to be served in a frame, you should consider enabling this\nheader to help prevent clickjacking attacks. security.W003 : You don’t appear to be using Django’s built-in cross-site\nrequest forgery protection via the middleware\n( django.middleware.csrf.CsrfViewMiddleware is not in your MIDDLEWARE ). Enabling the middleware is the safest\napproach to ensure you don’t leave any holes. security.W004 : You have not set a value for the SECURE_HSTS_SECONDS setting. If your entire site is served only\nover SSL, you may want to consider setting a value and enabling HTTP\nStrict Transport Security . Be sure to read\nthe documentation first; enabling HSTS carelessly can cause serious,\nirreversible problems. security.W005 : You have not set the SECURE_HSTS_INCLUDE_SUBDOMAINS setting to True . Without this,\nyour site is potentially vulnerable to attack via an insecure connection to a\nsubdomain. Only set this to True if you are certain that all subdomains of\nyour domain should be served exclusively via SSL. security.W006 : Your SECURE_CONTENT_TYPE_NOSNIFF setting is not\nset to True , so your pages will not be served with an 'X-Content-Type-Options: nosniff' header. You should consider enabling\nthis header to prevent the browser from identifying content types incorrectly. security.W007 : Your SECURE_BROWSER_XSS_FILTER setting is not\nset to True , so your pages will not be served with an 'X-XSS-Protection: 1; mode=block' header. You should consider enabling\nthis header to activate the browser’s XSS filtering and help prevent XSS\nattacks. This check is removed in Django 3.0 as the X-XSS-Protection header is no longer honored by modern browsers. security.W008 : Your SECURE_SSL_REDIRECT setting is not set to True . Unless your site should be available over both SSL and non-SSL\nconnections, you may want to either set this setting to True or configure\na load balancer or reverse-proxy server  to redirect all connections to HTTPS. security.W009 : Your SECRET_KEY has less than 50 characters,\nless than 5 unique characters, or it’s prefixed with 'django-insecure-' indicating that it was generated automatically by Django. Please generate a\nlong and random value, otherwise many of Django’s security-critical features\nwill be vulnerable to attack. security.W010 : You have django.contrib.sessions in your INSTALLED_APPS but you have not set SESSION_COOKIE_SECURE to True . Using a secure-only session\ncookie makes it more difficult for network traffic sniffers to hijack user\nsessions. security.W011 : You have django.contrib.sessions.middleware.SessionMiddleware in your MIDDLEWARE , but you have not set SESSION_COOKIE_SECURE to True . Using a secure-only session cookie makes it more difficult for\nnetwork traffic sniffers to hijack user sessions. security.W012 : SESSION_COOKIE_SECURE is not set to True .\nUsing a secure-only session cookie makes it more difficult for network traffic\nsniffers to hijack user sessions. security.W013 : You have django.contrib.sessions in your INSTALLED_APPS , but you have not set SESSION_COOKIE_HTTPONLY to True . Using an HttpOnly session\ncookie makes it more difficult for cross-site scripting attacks to hijack user\nsessions. security.W014 : You have django.contrib.sessions.middleware.SessionMiddleware in your MIDDLEWARE , but you have not set SESSION_COOKIE_HTTPONLY to True . Using an HttpOnly session cookie makes it more difficult for\ncross-site scripting attacks to hijack user sessions. security.W015 : SESSION_COOKIE_HTTPONLY is not set to True .\nUsing an HttpOnly session cookie makes it more difficult for cross-site\nscripting attacks to hijack user sessions. security.W016 : CSRF_COOKIE_SECURE is not set to True .\nUsing a secure-only CSRF cookie makes it more difficult for network traffic\nsniffers to steal the CSRF token. security.W017 : CSRF_COOKIE_HTTPONLY is not set to True .\nUsing an HttpOnly CSRF cookie makes it more difficult for cross-site\nscripting attacks to steal the CSRF token. This check is removed in Django\n1.11 as the CSRF_COOKIE_HTTPONLY setting offers no practical\nbenefit. security.W018 : You should not have DEBUG set to True in\ndeployment. security.W019 : You have django.middleware.clickjacking.XFrameOptionsMiddleware in your MIDDLEWARE , but X_FRAME_OPTIONS is not set to 'DENY' . Unless there is a good reason for your site to serve other parts\nof itself in a frame, you should change it to 'DENY' . security.W020 : ALLOWED_HOSTS must not be empty in deployment. security.W021 : You have not set the SECURE_HSTS_PRELOAD setting to True . Without this, your site\ncannot be submitted to the browser preload list. security.W022 : You have not set the SECURE_REFERRER_POLICY setting. Without this, your site will not send a Referrer-Policy header. You\nshould consider enabling this header to protect user privacy. security.E023 : You have set the SECURE_REFERRER_POLICY setting\nto an invalid value. security.E024 : You have set the SECURE_CROSS_ORIGIN_OPENER_POLICY setting to an invalid value. security.W025 : Your SECRET_KEY_FALLBACKS[n] has less than 50\ncharacters, less than 5 unique characters, or it’s prefixed with 'django-insecure-' indicating that it was generated automatically by\nDjango. Please generate a long and random value, otherwise many of Django’s\nsecurity-critical features will be vulnerable to attack. The following checks verify that your security-related settings are correctly\nconfigured: security.E100 : DEFAULT_HASHING_ALGORITHM must be 'sha1' or 'sha256' . This check appeared in Django 3.1 and 3.2 . security.E101 : The CSRF failure view 'path.to.view' does not take the\ncorrect number of arguments. security.E102 : The CSRF failure view 'path.to.view' could not be\nimported. Signals ¶ signals.E001 : <handler> was connected to the <signal> signal with\na lazy reference to the sender <app label>.<model> , but app <app label> isn’t installed or doesn’t provide model <model> . Templates ¶ The following checks verify that your TEMPLATES setting is correctly\nconfigured: templates.E001 : You have 'APP_DIRS': True in your TEMPLATES but also specify 'loaders' in OPTIONS . Either\nremove APP_DIRS or remove the 'loaders' option. This check is\nremoved in Django 5.1 as system checks may now raise ImproperlyConfigured instead. templates.E002 : string_if_invalid in TEMPLATES OPTIONS must be a string but got: {value} ( {type} ). templates.E003 : <name> is used for multiple template tag modules: <module list> . This check was changed to templates.W003 in Django\n4.1.2 . templates.W003 : <name> is used for multiple template tag modules: <module list> . Translation ¶ The following checks are performed on your translation configuration: translation.E001 : You have provided an invalid value for the LANGUAGE_CODE setting: <value> . translation.E002 : You have provided an invalid language code in the LANGUAGES setting: <value> . translation.E003 : You have provided an invalid language code in the LANGUAGES_BIDI setting: <value> . translation.E004 : You have provided a value for the LANGUAGE_CODE setting that is not in the LANGUAGES setting. URLs ¶ The following checks are performed on your URL configuration: urls.W001 : Your URL pattern <pattern> uses include() with a route ending with a $ . Remove the\ndollar from the route to avoid problems including URLs. urls.W002 : Your URL pattern <pattern> has a route beginning with\na / . Remove this slash as it is unnecessary. If this pattern is targeted\nin an include() , ensure the include() pattern has a trailing / . urls.W003 : Your URL pattern <pattern> has a name including a : . Remove the colon, to avoid ambiguous namespace\nreferences. urls.E004 : Your URL pattern <pattern> is invalid. Ensure that urlpatterns is a list of path() and/or re_path() instances. urls.W005 : URL namespace <namespace> isn’t unique. You may not be\nable to reverse all URLs in this namespace. urls.E006 : The MEDIA_URL / STATIC_URL setting must\nend with a slash. urls.E007 : The custom handlerXXX view 'path.to.view' does not\ntake the correct number of arguments (…). urls.E008 : The custom handlerXXX view 'path.to.view' could not be\nimported. urls.E009 : Your URL pattern <pattern> has an invalid view, pass <view>.as_view() instead of <view> . urls.W010 : Your URL pattern <pattern> has an unmatched <angle bracket> . contrib app checks ¶ admin ¶ Admin checks are all performed as part of the admin tag. The following checks are performed on any ModelAdmin (or subclass) that is registered\nwith the admin site: admin.E001 : The value of raw_id_fields must be a list or tuple. admin.E002 : The value of raw_id_fields[n] refers to <field name> ,\nwhich is not a field of <model> . admin.E003 : The value of raw_id_fields[n] must be a foreign key or\na many-to-many field. admin.E004 : The value of fields must be a list or tuple. admin.E005 : Both fieldsets and fields are specified. admin.E006 : The value of fields contains duplicate field(s). admin.E007 : The value of fieldsets must be a list or tuple. admin.E008 : The value of fieldsets[n] must be a list or tuple. admin.E009 : The value of fieldsets[n] must be of length 2. admin.E010 : The value of fieldsets[n][1] must be a dictionary. admin.E011 : The value of fieldsets[n][1] must contain the key fields . admin.E012 : There are duplicate field(s) in fieldsets[n][1] . admin.E013 : The value of fields[n]/filter_horizontal[n]/filter_vertical[n]/fieldsets[n][m] cannot\ninclude the ManyToManyField <field name> , because that field manually\nspecifies a relationship model. admin.E014 : The value of exclude must be a list or tuple. admin.E015 : The value of exclude contains duplicate field(s). admin.E016 : The value of form must inherit from BaseModelForm . admin.E017 : The value of filter_vertical must be a list or tuple. admin.E018 : The value of filter_horizontal must be a list or tuple. admin.E019 : The value of filter_vertical[n]/filter_horizontal[n] refers to <field name> , which is not a field of <model> . admin.E020 : The value of filter_vertical[n]/filter_horizontal[n] must be a many-to-many field. admin.E021 : The value of radio_fields must be a dictionary. admin.E022 : The value of radio_fields refers to <field name> ,\nwhich is not a field of <model> . admin.E023 : The value of radio_fields refers to <field name> ,\nwhich is not an instance of ForeignKey , and does not have a choices definition. admin.E024 : The value of radio_fields[<field name>] must be either admin.HORIZONTAL or admin.VERTICAL . admin.E025 : The value of view_on_site must be either a callable or a\nboolean value. admin.E026 : The value of prepopulated_fields must be a dictionary. admin.E027 : The value of prepopulated_fields refers to <field name> , which is not a field of <model> . admin.E028 : The value of prepopulated_fields refers to <field name> , which must not be a DateTimeField , a ForeignKey ,\na OneToOneField , or a ManyToManyField field. admin.E029 : The value of prepopulated_fields[<field name>] must be a\nlist or tuple. admin.E030 : The value of prepopulated_fields refers to <field name> , which is not a field of <model> . admin.E031 : The value of ordering must be a list or tuple. admin.E032 : The value of ordering has the random ordering marker ? , but contains other fields as well. admin.E033 : The value of ordering refers to <field name> , which\nis not a field of <model> . admin.E034 : The value of readonly_fields must be a list or tuple. admin.E035 : The value of readonly_fields[n] refers to <field_name> , which is not a callable, an attribute of <ModelAdmin class> , or an attribute of <model> . admin.E036 : The value of autocomplete_fields must be a list or tuple. admin.E037 : The value of autocomplete_fields[n] refers to <field name> , which is not a field of <model> . admin.E038 : The value of autocomplete_fields[n] must be a foreign\nkey or a many-to-many field. admin.E039 : An admin for model <model> has to be registered to be\nreferenced by <modeladmin>.autocomplete_fields . admin.E040 : <modeladmin> must define search_fields , because\nit’s referenced by <other_modeladmin>.autocomplete_fields . ModelAdmin ¶ The following checks are performed on any ModelAdmin that is registered\nwith the admin site: admin.E101 : The value of save_as must be a boolean. admin.E102 : The value of save_on_top must be a boolean. admin.E103 : The value of inlines must be a list or tuple. admin.E104 : <InlineModelAdmin class> must inherit from InlineModelAdmin . admin.E105 : <InlineModelAdmin class> must have a model attribute. admin.E106 : The value of <InlineModelAdmin class>.model must be a Model . admin.E107 : The value of list_display must be a list or tuple. admin.E108 : The value of list_display[n] refers to <label> , which\nis not a callable or attribute of <ModelAdmin class> , or an attribute,\nmethod, or field on <model> . admin.E109 : The value of list_display[n] must not be a many-to-many\nfield or a reverse foreign key. admin.E110 : The value of list_display_links must be a list, a tuple,\nor None . admin.E111 : The value of list_display_links[n] refers to <label> ,\nwhich is not defined in list_display . admin.E112 : The value of list_filter must be a list or tuple. admin.E113 : The value of list_filter[n] must inherit from ListFilter . admin.E114 : The value of list_filter[n] must not inherit from FieldListFilter . admin.E115 : The value of list_filter[n][1] must inherit from FieldListFilter . admin.E116 : The value of list_filter[n] refers to <label> ,\nwhich does not refer to a Field. admin.E117 : The value of list_select_related must be a boolean,\ntuple or list. admin.E118 : The value of list_per_page must be an integer. admin.E119 : The value of list_max_show_all must be an integer. admin.E120 : The value of list_editable must be a list or tuple. admin.E121 : The value of list_editable[n] refers to <label> ,\nwhich is not a field of <model> . admin.E122 : The value of list_editable[n] refers to <label> ,\nwhich is not contained in list_display . admin.E123 : The value of list_editable[n] cannot be in both list_editable and list_display_links . admin.E124 : The value of list_editable[n] refers to the first field\nin list_display ( <label> ), which cannot be used unless list_display_links is set. admin.E125 : The value of list_editable[n] refers to <field name> ,\nwhich is not editable through the admin. admin.E126 : The value of search_fields must be a list or tuple. admin.E127 : The value of date_hierarchy refers to <field name> ,\nwhich does not refer to a Field. admin.E128 : The value of date_hierarchy must be a DateField or DateTimeField . admin.E129 : <modeladmin> must define a has_<foo>_permission() method for the <action> action. admin.E130 : __name__ attributes of actions defined in <modeladmin> must be unique. Name <name> is not unique. InlineModelAdmin ¶ The following checks are performed on any InlineModelAdmin that is registered as an\ninline on a ModelAdmin . admin.E201 : Cannot exclude the field <field name> , because it is the\nforeign key to the parent model <app_label>.<model> . admin.E202 : <model> has no ForeignKey to <parent model> ./ <model> has more than one ForeignKey to <parent model> . You must\nspecify a fk_name attribute. admin.E203 : The value of extra must be an integer. admin.E204 : The value of max_num must be an integer. admin.E205 : The value of min_num must be an integer. admin.E206 : The value of formset must inherit from BaseModelFormSet . GenericInlineModelAdmin ¶ The following checks are performed on any GenericInlineModelAdmin that is\nregistered as an inline on a ModelAdmin . admin.E301 : 'ct_field' references <label> , which is not a field\non <model> . admin.E302 : 'ct_fk_field' references <label> , which is not a\nfield on <model> . admin.E303 : <model> has no GenericForeignKey . admin.E304 : <model> has no GenericForeignKey using content type\nfield <field name> and object ID field <field name> . AdminSite ¶ The following checks are performed on the default AdminSite : admin.E401 : django.contrib.contenttypes must be in INSTALLED_APPS in order to use the admin application. admin.E402 : django.contrib.auth.context_processors.auth must be enabled in DjangoTemplates ( TEMPLATES ) if using the default auth backend in order to use the\nadmin application. admin.E403 : A django.template.backends.django.DjangoTemplates instance must be configured in TEMPLATES in order to use the\nadmin application. admin.E404 : django.contrib.messages.context_processors.messages must be enabled in DjangoTemplates ( TEMPLATES ) in order to use the admin application. admin.E405 : django.contrib.auth must be in INSTALLED_APPS in order to use the admin application. admin.E406 : django.contrib.messages must be in INSTALLED_APPS in order to use the admin application. admin.E408 : django.contrib.auth.middleware.AuthenticationMiddleware must be in MIDDLEWARE in order to use the admin application. admin.E409 : django.contrib.messages.middleware.MessageMiddleware must be in MIDDLEWARE in order to use the admin application. admin.E410 : django.contrib.sessions.middleware.SessionMiddleware must be in MIDDLEWARE in order to use the admin application. admin.W411 : django.template.context_processors.request must be\nenabled in DjangoTemplates ( TEMPLATES ) in order to use the admin navigation sidebar. auth ¶ auth.E001 : REQUIRED_FIELDS must be a list or tuple. auth.E002 : The field named as the USERNAME_FIELD for a custom user\nmodel must not be included in REQUIRED_FIELDS . auth.E003 : <field> must be unique because it is named as the USERNAME_FIELD . auth.W004 : <field> is named as the USERNAME_FIELD , but it is not\nunique. auth.E005 : The permission codenamed <codename> clashes with a builtin\npermission for model <model> . auth.E006 : The permission codenamed <codename> is duplicated for model <model> . auth.E007 : The verbose_name of model <model> must be at most\n244 characters for its builtin permission names\nto be at most 255 characters. auth.E008 : The permission named <name> of model <model> is longer\nthan 255 characters. auth.C009 : <User model>.is_anonymous must be an attribute or property\nrather than a method. Ignoring this is a security issue as anonymous users\nwill be treated as authenticated! auth.C010 : <User model>.is_authenticated must be an attribute or\nproperty rather than a method. Ignoring this is a security issue as anonymous\nusers will be treated as authenticated! auth.E011 : The name of model <model> must be at most 93 characters\nfor its builtin permission names to be at most 100 characters. auth.E012 : The permission codenamed <codename> of model <model> is longer than 100 characters. auth.E013 : In order to use django.contrib.auth.middleware.LoginRequiredMiddleware , django.contrib.auth.middleware.AuthenticationMiddleware must be\ndefined before it in MIDDLEWARE. contenttypes ¶ The following checks are performed when a model contains a GenericForeignKey or GenericRelation : contenttypes.E001 : The GenericForeignKey object ID references the\nnonexistent field <field> . contenttypes.E002 : The GenericForeignKey content type references the\nnonexistent field <field> . contenttypes.E003 : <field> is not a ForeignKey . contenttypes.E004 : <field> is not a ForeignKey to contenttypes.ContentType . contenttypes.E005 : Model names must be at most 100 characters. postgres ¶ The following checks are performed on django.contrib.postgres model\nfields: postgres.E001 : Base field for array has errors: … postgres.E002 : Base field for array cannot be a related field. postgres.E003 : <field> default should be a callable instead of an\ninstance so that it’s not shared between all field instances. This check was\nchanged to fields.E010 in Django 3.1 . postgres.W004 : Base field for array has warnings: … sites ¶ The following checks are performed on any model using a CurrentSiteManager : sites.E001 : CurrentSiteManager could not find a field named <field name> . sites.E002 : CurrentSiteManager cannot use <field> as it is not a\nforeign key or a many-to-many field. The following checks verify that django.contrib.sites is correctly\nconfigured: sites.E101 : The SITE_ID setting must be an integer. staticfiles ¶ The following checks verify that django.contrib.staticfiles is correctly\nconfigured: staticfiles.E001 : The STATICFILES_DIRS setting is not a tuple\nor list. staticfiles.E002 : The STATICFILES_DIRS setting should not\ncontain the STATIC_ROOT setting. staticfiles.E003 : The prefix <prefix> in the STATICFILES_DIRS setting must not end with a slash. staticfiles.W004 : The directory <directory> in the STATICFILES_DIRS does not exist. staticfiles.E005 : The STORAGES setting must define a staticfiles storage.", "keywords": ["users", "e004", "e312", "storage", "pattern", "underscores", "factors", "e025", "formset", "messages", "e223", "declarations", "e220", "pillow", "w022", "e002", "e340", "search_fields", "corruption", "django.contrib.messages.context_processors.messages", "analysis", "e034", "sender", "field", "bracket", "e339", "w019", "radio_fields[<field", "relation", "m", "migrations", "unique_together", "django.contrib.messages.middleware", "w038", "action", "django.db.models", "subset", "e203", "cache", "compatibility", "sha1", "datefield", "save_as", "prepopulated_fields[<field", "transport", "non", "csrf_cookie_httponly", "username_field", "colon", "https", "^", "save_on_top", "vertical", "label", "e018", "navigation", "http", "=", "secure_cross_origin_opener_policy", "message", "relationship", "e131", "modeladmin>.autocomplete_fields", "w020", "letters", "w008", "setup", "m2", "tables", "tag", "postgres", "readonly_fields[n", "django_allow_async_unsafe", "e014", "e307", "genericforeignkey", "e024", "w346", "debug", "e337", "e112", "topic", "w902", "e102", "nosniff", "codename", "through_fields", "type", "w900", "path.to.view", "e008", "filefield", "e020", "custom", "to_field", "documentation", "e150", "genericinlinemodeladmin", "x001", "file", "constraint", "e409", "e222", "e026", "insecure-", "modules", "e121", "user", "fruit", "django.middleware.security", "attribute", "re_path", "warning", "size", "constraints", "list_max_show_all", "django.contrib.auth.context_processors.auth", "tags", "w027", "w014", "e030", "inlinemodeladmin", "checkmessage", "setting", "clickjacking", "raw_id_fields", "purposes", "e333", "list_display_links", "e104", "criticals", "e033", "file_upload_temp_dir", "e101", "e037", "csrf_cookie_secure", "citextfield", "fieldsets[n", "name", "flags", "secret_key_fallbacks[n", "e113", "reference", "django.contrib.auth", "issue", "other_modeladmin>.autocomplete_fields", "w013", "problems", "oversight", "min_num", "w010", "handlerxxx", "e009", "e115", "4.1.2", "manager", "trailing", "secure_ssl_redirect", "angle", "reverse", "static_url", "e130", "e132", "e109", "expressions", "w012", "parent", "order_with_respect_to", "fieldsets", "e302", "w343", "datetimefield", "django.contrib.staticfiles", "failure", "ct_fk_field", "w035", "w344", "sessionmiddleware", "e013", "aliases", "checklist", "proxy", "url", "error", "conditions", "module", "code", "subdomains", "--database", "httponly", "decimalfield", "w036", "safety", "w340", "auth", "pages", "info", "false", "c", "i", "class", "link", "array", "redirection", "ssl", "list_display_links[n", "warnings", "app_dirs", "w004", "names", "model>.check", "sidebar", "x", "attack", "request", "secure_hsts_include_subdomains", "string_if_invalid", "route", "database", "block", "e334", "signal", "query", "commands", "migrate", "count", "w224", "types", "e330", "elements", "fields[n]/filter_horizontal[n]/filter_vertical[n]/fieldsets[n][m", "w002", "e180", "subclass", "list_editable", "admin", "accessor", "e105", ".", "filter_vertical", "configuration", "e133", "w904", "max_length", "frame", "currentsitemanager", "django.contrib.sites", "e001", "e017", "e127", "w005", "genericrelation", "view_on_site", "e405", "include", "e320", "e", "e306", "filepathfield", "source", "w018", "registrations", "e031", "underscore", "use", "./", "environment", "e107", "e301", "static_root", "http://", "w006", "autocomplete_fields", "e140", "subclasses", "list_filter[n][1", "label>.<model", "django.contrib.sessions.middleware", "protection", "secure_content_type_nosniff", "genericipaddressfield", "core", "intrusion", "order", "default", "hsts", "floatrangefield", "list_display[n", "choices", "identifiers", "alias", "e408", "signals", "form", "prefix", "option", "basemodelform", "expression", "characters", "filter_vertical[n]/filter_horizontal[n", "e406", "csrf_trusted_origins", "default_hashing_algorithm", "prepopulated_fields", "browsers", "e005", "booleanfield", "scheme", "holes", "nullbooleanfield", "e022", "https://", "w016", "privacy", "csrfviewmiddleware", "duplicate", "template", "header", "w017", "generatedfield.output_field", "onetoonefield", "e036", "django.contrib.postgres", "console", "checks", "strict", "comments", "app_label>.<model", "index", "e309", "balancer", "c010", "integer", "field_type", "session", "¶", "bytes", "command", "id", "e021", "allow_files", "property", "db_comment", "e003", "fieldlistfilter", "content", "result", "view", "django.contrib.sessions", "e321", "on_delete", "indexes", "w046", "number", "generatedfield", "e040", "e907", "jsonfield", "relations", "e332", "secure_hsts_seconds", "w122", "values", "staticfiles", "app_label>.<model>.<field", "e126", "string", "radio_fields", "preload", "_", "w906", "<", "w021", "mapping", "w037", "auto", "connections", "verbose_name", "e100", "staticfiles_dirs", "traffic", "exclude", "location", "table", "subdomain", "sniffers", "language", "inlines", "models", "e016", "scripting", "referrer", "version", "e403", "level", "e221", "hostname", "namespace", "django", "session_cookie_httponly", "e202", "django.contrib.auth.middleware", "n’t", "securitymiddleware", "fields", "django.contrib.messages", "commaseparatedintegerfield", "languages", "set", "p", "ct_field", "e123", "value", "e336", "e210", "line", "limit_choices_to", "improperlyconfigured", "contenttype", "policy", "e103", "columns", "data", "cicharfield", "browser", "handler", "messagemiddleware", "e404", "backend", "guide", "model>.<accessor", "sha256", "clashes", "inline", "identifier", "cewid", "list_display", "e108", "security", "db_index", "e041", "async_support", "e906", "c009", "self", "instance", "e023", "set_null", "djangotemplates", "model>.<field", "primary_key", "levels", "validators", "e338", "severity", "modeladmin", "forgery", "ipaddressfield", "issues", "e311", "e111", "w003", "instances", "authenticationmiddleware", "dollar", "installed_apps", "part", "w411", "references", "object", "load", "field(s", "builtin", "deployment", "domain", "e201", "django.middleware.csrf", "charfield", "e006", "list_filter[n", "management", "manytomanyfield", "loaders", "e170", "dictionary", "hints", "binaryfield", "w901", "keyword", "s", "csrf", "ordering", "upgrades", "max_digits", "matches", "e110", "e019", "obj", "fieldsets[n][1", "e012", "django.contrib.postgres.fields", "effect", "django.contrib.contenttypes", "system", "class>.model", "date_hierarchy", "e335", "filtering", "async", "e122", "secure_referrer_policy", "imagefield", "s.", "storages", "applabel", "e205", "definition", "autofield", "slash", "basemodelformset", "e402", "check", "w044", "site", "w903", "features", "w341", "list_select_related", "e114", "lists", "example", "app", "e310", "e410", "column", "list", "e125", "collation", "e304", "w162", "detection", "filter_horizontal", "w001", "newlines", "e905", "has_<foo>_permission", "model", "variable", "word", "e028", "e039", "w011", "application", "actions", "attributes", "approach", "media_url", "insecure", "w047", "e200", "languages_bidi", "w009", "translation", "syntax", "critical", "w025", "e190", "benefit", "e308", "keys", "boolean", "length", "lookup", "full_clean", "null", "network", "errors", "tuple", "server", "str", "arguments", "middleware", "db_default", "xss", "rawsql", "e904", "e027", "msg", "contrib", "e038", "tuples", "e029", "autocomplete_fields[n", "secret_key", "adminsite", "path", "contenttypes", "e160", "e900", "key", "w015", "4_0.e001", "none", "problem", "mariadb", "definitions", "w040", "session_cookie_secure", "executing", "reason", "framework", "caches", "e015", "secure_hsts_preload", "list_editable[n", "w342", "true", "e118", "urls", "api", "sql_mode", "sessions", "support", "e106", "hint", "projects", "mode", "max_num", "connection", "-", "field_name", "decimal_places", "context", "e901", "permission", "files", "d", "list_per_page", "e401", "mysql", "directory", ">", "pk", "e007", "foreignkey", "e032", "site_id", "e903", "x_frame_options", "app_label.app_name", "e303", "optional", "options", "details", "method", "e204", "e129", "readonly_fields", "settings", "field1", "argument", "list_filter", "e128", "field2", "cookie", "sites", "e035", "raw_id_fields[n", "attacks", "w345", "marker", "listfilter", "deny", "ciemailfield", "templates", "e119", "w163", "nulls", "parts"], "type": "documentation"},
{"title": "Uploaded Files and Upload Handlers | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/files/uploads/", "content": "Uploaded Files and Upload Handlers ¶ Uploaded files ¶ class UploadedFile [source] ¶ During file uploads, the actual file data is stored in request.FILES . Each entry in this dictionary is an UploadedFile object (or a subclass) – a wrapper around an uploaded file.\nYou’ll usually use one of these methods to access the uploaded content: UploadedFile. read () ¶ Read the entire uploaded data from the file. Be careful with this method:\nif the uploaded file is huge it can overwhelm your system if you try to\nread it into memory. You’ll probably want to use chunks() instead; see\nbelow. UploadedFile. multiple_chunks ( chunk_size = None ) ¶ Returns True if the uploaded file is big enough to require reading in\nmultiple chunks. By default this will be any file larger than 2.5 megabytes,\nbut that’s configurable; see below. UploadedFile. chunks ( chunk_size = None ) ¶ A generator returning chunks of the file. If multiple_chunks() is True , you should use this method in a loop instead of read() . In practice, it’s often easiest to use chunks() all the time. Looping\nover chunks() instead of using read() ensures that large files\ndon’t overwhelm your system’s memory. Here are some useful attributes of UploadedFile : UploadedFile. name ¶ The name of the uploaded file (e.g. my_file.txt ). UploadedFile. size ¶ The size, in bytes, of the uploaded file. UploadedFile. content_type ¶ The content-type header uploaded with the file (e.g. text/plain or application/pdf ). Like any data supplied by the user, you\nshouldn’t trust that the uploaded file is actually this type. You’ll still\nneed to validate that the file contains the content that the content-type\nheader claims – “trust but verify.” UploadedFile. content_type_extra ¶ A dictionary containing extra parameters passed to the content-type header. This is typically provided by services, such as Google App Engine,\nthat intercept and handle file uploads on your behalf. As a result your\nhandler may not receive the uploaded file content, but instead a URL or\nother pointer to the file (see RFC 2388 ). UploadedFile. charset ¶ For text/* content-types, the character set (i.e. utf8 )\nsupplied by the browser. Again, “trust but verify” is the best policy here. Note Like regular Python files, you can read the file line-by-line by iterating\nover the uploaded file: for line in uploadedfile : do_something_with ( line ) Lines are split using universal newlines . The following are\nrecognized as ending a line: the Unix end-of-line convention '\\n' , the\nWindows convention '\\r\\n' , and the old Macintosh convention '\\r' . Subclasses of UploadedFile include: class TemporaryUploadedFile [source] ¶ A file uploaded to a temporary location (i.e. stream-to-disk). This class\nis used by the TemporaryFileUploadHandler . In\naddition to the methods from UploadedFile , it has one additional\nmethod: TemporaryUploadedFile. temporary_file_path () [source] ¶ Returns the full path to the temporary uploaded file. class InMemoryUploadedFile [source] ¶ A file uploaded into memory (i.e. stream-to-memory). This class is used\nby the MemoryFileUploadHandler . Built-in upload handlers ¶ Together the MemoryFileUploadHandler and TemporaryFileUploadHandler provide Django’s default file upload\nbehavior of reading small files into memory and large ones onto disk. They\nare located in django.core.files.uploadhandler . class MemoryFileUploadHandler [source] ¶ File upload handler to stream uploads into memory (used for small files). class TemporaryFileUploadHandler [source] ¶ Upload handler that streams data into a temporary file using TemporaryUploadedFile . Writing custom upload handlers ¶ class FileUploadHandler [source] ¶ All file upload handlers should be subclasses of django.core.files.uploadhandler.FileUploadHandler . You can define upload\nhandlers wherever you wish. Required methods ¶ Custom file upload handlers must define the following methods: FileUploadHandler. receive_data_chunk ( raw_data , start ) [source] ¶ Receives a “chunk” of data from the file upload. raw_data is a bytestring containing the uploaded data. start is the position in the file where this raw_data chunk\nbegins. The data you return will get fed into the subsequent upload handlers’ receive_data_chunk methods. In this way, one handler can be a\n“filter” for other handlers. Return None from receive_data_chunk to short-circuit remaining\nupload handlers from getting this chunk. This is useful if you’re\nstoring the uploaded data yourself and don’t want future handlers to\nstore a copy of the data. If you raise a StopUpload or a SkipFile exception, the upload\nwill abort or the file will be completely skipped. FileUploadHandler. file_complete ( file_size ) [source] ¶ Called when a file has finished uploading. The handler should return an UploadedFile object that will be stored\nin request.FILES . Handlers may also return None to indicate that\nthe UploadedFile object should come from subsequent upload handlers. Optional methods ¶ Custom upload handlers may also define any of the following optional methods or\nattributes: FileUploadHandler. chunk_size ¶ Size, in bytes, of the “chunks” Django should store into memory and feed\ninto the handler. That is, this attribute controls the size of chunks\nfed into FileUploadHandler.receive_data_chunk . For maximum performance the chunk sizes should be divisible by 4 and\nshould not exceed 2 GB (2 31 bytes) in size. When there are\nmultiple chunk sizes provided by multiple handlers, Django will use the\nsmallest chunk size defined by any handler. The default is 64*2 10 bytes, or 64 KB. FileUploadHandler. new_file ( field_name , file_name , content_type , content_length , charset , content_type_extra ) [source] ¶ Callback signaling that a new file upload is starting. This is called\nbefore any data has been fed to any upload handlers. field_name is a string name of the file <input> field. file_name is the filename provided by the browser. content_type is the MIME type provided by the browser – E.g. 'image/jpeg' . content_length is the length of the image given by the browser.\nSometimes this won’t be provided and will be None . charset is the character set (i.e. utf8 ) given by the browser.\nLike content_length , this sometimes won’t be provided. content_type_extra is extra information about the file from the content-type header. See UploadedFile.content_type_extra . This method may raise a StopFutureHandlers exception to prevent\nfuture handlers from handling this file. FileUploadHandler. upload_complete () [source] ¶ Callback signaling that the entire upload (all files) has completed. FileUploadHandler. upload_interrupted () [source] ¶ Callback signaling that the upload was interrupted, e.g. when the user\nclosed their browser during file upload. FileUploadHandler. handle_raw_input ( input_data , META , content_length , boundary , encoding ) [source] ¶ Allows the handler to completely override the parsing of the raw\nHTTP input. input_data is a file-like object that supports read() -ing. META is the same object as request.META . content_length is the length of the data in input_data . Don’t\nread more than content_length bytes from input_data . boundary is the MIME boundary for this request. encoding is the encoding of the request. Return None if you want upload handling to continue, or a tuple of (POST, FILES) if you want to return the new data structures suitable\nfor the request directly.", "keywords": ["feed", "result", "fileuploadhandler", "file_name", "jpeg", "temporary_file_path", "position", "wrapper", "verify", "url", "fileuploadhandler.receive_data_chunk", "\\r", "behalf", "uploads", "filter", "string", "behavior", "new_file", "addition", "class", "field", "app", "windows", "utf8", "megabytes", "unix", "upload_interrupted", "inmemoryuploadedfile", "returns", "mime", "request", "loop", "parsing", "newlines", "structures", "django.core.files.uploadhandler", "location", "input", "*", "lines", "copy", "google", "temporaryfileuploadhandler", "types", "read", "subclass", ".", "image", "application", "encoding", "boundary", "memoryfileuploadhandler", "attributes", "django", "http", "receive_data_chunk", "handle_raw_input", "rfc", "n’t", "filename", "sizes", "stopupload", "engine", "stream", "entry", "multiple_chunks", "practice", "claims", "character", "plain", "gb", "line", "ones", "source", "content_type", "policy", "data", "browser", "length", "handler", "tuple", "chunk", "charset", "upload", "kb", "type", "subclasses", "custom", "performance", "generator", "end", "\\n", "file", "e.g.", "content_type_extra", "default", "user", "path", "do_something_with", "my_file.txt", "stopfuturehandlers", "start", "attribute", "none", "callback", "size", "meta", "raw_data", "time", "convention", "file_complete", "\\r\\n", "pdf", "object", "circuit", "field_name", "uploadedfile.content_type_extra", "files", "name", "temporaryuploadedfile", "input_data", "header", "dictionary", "way", "chunks", "information", "python", "methods", "macintosh", "exception", "uploadedfile", "method", "¶", "bytes", "handlers", "parameters", "disk", "memory", "post", "services", "system", "pointer", "content_length", "file_size", "text", "content"], "type": "documentation"},
{"title": "Creating forms from models | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/forms/modelforms/", "content": "Creating forms from models ¶ ModelForm ¶ class ModelForm [source] ¶ If you’re building a database-driven app, chances are you’ll have forms that\nmap closely to Django models. For instance, you might have a BlogComment model, and you want to create a form that lets people submit comments. In this\ncase, it would be redundant to define the field types in your form, because\nyou’ve already defined the fields in your model. For this reason, Django provides a helper class that lets you create a Form class from a Django model. For example: >>> from django.forms import ModelForm >>> from myapp.models import Article # Create the form class. >>> class ArticleForm ( ModelForm ): ... class Meta : ... model = Article ... fields = [ \"pub_date\" , \"headline\" , \"content\" , \"reporter\" ] ... # Creating a form to add an article. >>> form = ArticleForm () # Creating a form to change an existing article. >>> article = Article . objects . get ( pk = 1 ) >>> form = ArticleForm ( instance = article ) Field types ¶ The generated Form class will have a form field for every model field\nspecified, in the order specified in the fields attribute. Each model field has a corresponding default form field. For example, a CharField on a model is represented as a CharField on a form. A model ManyToManyField is represented as a MultipleChoiceField . Here is the\nfull list of conversions: Model field Form field AutoField Not represented in the form BigAutoField Not represented in the form BigIntegerField IntegerField with min_value set to -9223372036854775808\nand max_value set to 9223372036854775807. BinaryField CharField , if editable is set to True on the model field, otherwise not\nrepresented in the form. BooleanField BooleanField , or NullBooleanField if null=True . CharField CharField with max_length set to the model field’s max_length and empty_value set to None if null=True . DateField DateField DateTimeField DateTimeField DecimalField DecimalField DurationField DurationField EmailField EmailField FileField FileField FilePathField FilePathField FloatField FloatField ForeignKey ModelChoiceField (see below) ImageField ImageField IntegerField IntegerField IPAddressField IPAddressField GenericIPAddressField GenericIPAddressField JSONField JSONField ManyToManyField ModelMultipleChoiceField (see below) PositiveBigIntegerField IntegerField PositiveIntegerField IntegerField PositiveSmallIntegerField IntegerField SlugField SlugField SmallAutoField Not represented in the form SmallIntegerField IntegerField TextField CharField with widget=forms.Textarea TimeField TimeField URLField URLField UUIDField UUIDField As you might expect, the ForeignKey and ManyToManyField model field\ntypes are special cases: ForeignKey is represented by django.forms.ModelChoiceField ,\nwhich is a ChoiceField whose choices are a model QuerySet . ManyToManyField is represented by django.forms.ModelMultipleChoiceField , which is a MultipleChoiceField whose choices are a model QuerySet . In addition, each generated form field has attributes set as follows: If the model field has blank=True , then required is set to False on the form field. Otherwise, required=True . The form field’s label is set to the verbose_name of the model\nfield, with the first character capitalized. The form field’s help_text is set to the help_text of the model\nfield. If the model field has choices set, then the form field’s widget will be set to Select , with choices coming from the model field’s choices . The choices will normally include the blank choice which is\nselected by default. If the field is required, this forces the user to\nmake a selection. The blank choice will not be included if the model\nfield has blank=False and an explicit default value (the default value will be initially selected instead). Finally, note that you can override the form field used for a given model\nfield. See Overriding the default fields below. A full example ¶ Consider this set of models: from django.db import models from django.forms import ModelForm TITLE_CHOICES = { \"MR\" : \"Mr.\" , \"MRS\" : \"Mrs.\" , \"MS\" : \"Ms.\" , } class Author ( models . Model ): name = models . CharField ( max_length = 100 ) title = models . CharField ( max_length = 3 , choices = TITLE_CHOICES ) birth_date = models . DateField ( blank = True , null = True ) def __str__ ( self ): return self . name class Book ( models . Model ): name = models . CharField ( max_length = 100 ) authors = models . ManyToManyField ( Author ) class AuthorForm ( ModelForm ): class Meta : model = Author fields = [ \"name\" , \"title\" , \"birth_date\" ] class BookForm ( ModelForm ): class Meta : model = Book fields = [ \"name\" , \"authors\" ] With these models, the ModelForm subclasses above would be roughly\nequivalent to this (the only difference being the save() method, which\nwe’ll discuss in a moment.): from django import forms class AuthorForm ( forms . Form ): name = forms . CharField ( max_length = 100 ) title = forms . CharField ( max_length = 3 , widget = forms . Select ( choices = TITLE_CHOICES ), ) birth_date = forms . DateField ( required = False ) class BookForm ( forms . Form ): name = forms . CharField ( max_length = 100 ) authors = forms . ModelMultipleChoiceField ( queryset = Author . objects . all ()) Validation on a ModelForm ¶ There are two main steps involved in validating a ModelForm : Validating the form Validating the model instance Just like normal form validation, model form validation is triggered implicitly\nwhen calling is_valid() or accessing the errors attribute and explicitly when calling full_clean() , although you will typically not use the latter method in\npractice. Model validation ( Model.full_clean() ) is triggered from within the form\nvalidation step, right after the form’s clean() method is called. Warning The cleaning process modifies the model instance passed to the ModelForm constructor in various ways. For instance, any date fields on\nthe model are converted into actual date objects. Failed validation may\nleave the underlying model instance in an inconsistent state and therefore\nit’s not recommended to reuse it. Overriding the clean() method ¶ You can override the clean() method on a model form to provide additional\nvalidation in the same way you can on a normal form. A model form instance attached to a model object will contain an instance attribute that gives its methods access to that specific model instance. Warning The ModelForm.clean() method sets a flag that makes the model\nvalidation step validate the uniqueness of model\nfields that are marked as unique , unique_together or unique_for_date|month|year . If you would like to override the clean() method and maintain this\nvalidation, you must call the parent class’s clean() method. Interaction with model validation ¶ As part of the validation process, ModelForm will call the clean() method of each field on your model that has a corresponding field on your form.\nIf you have excluded any model fields, validation will not be run on those\nfields. See the form validation documentation\nfor more on how field cleaning and validation work. The model’s clean() method will be called before any uniqueness checks are\nmade. See Validating objects for more information\non the model’s clean() hook. Considerations regarding model’s error_messages ¶ Error messages defined at the form field level or at the form Meta level always take\nprecedence over the error messages defined at the model field level. Error messages  defined on model fields are only used when the ValidationError is raised during the model validation step and no corresponding error messages are defined at\nthe form level. You can override the error messages from NON_FIELD_ERRORS raised by model\nvalidation by adding the NON_FIELD_ERRORS key\nto the error_messages dictionary of the ModelForm ’s inner Meta class: from django.core.exceptions import NON_FIELD_ERRORS from django.forms import ModelForm class ArticleForm ( ModelForm ): class Meta : error_messages = { NON_FIELD_ERRORS : { \"unique_together\" : \" %(model_name)s 's %(field_labels)s are not unique.\" , } } The save() method ¶ Every ModelForm also has a save() method. This method creates and saves\na database object from the data bound to the form. A subclass of ModelForm can accept an existing model instance as the keyword argument instance ; if\nthis is supplied, save() will update that instance. If it’s not supplied, save() will create a new instance of the specified model: >>> from myapp.models import Article >>> from myapp.forms import ArticleForm # Create a form instance from POST data. >>> f = ArticleForm ( request . POST ) # Save a new Article object from the form's data. >>> new_article = f . save () # Create a form to edit an existing Article, but use # POST data to populate the form. >>> a = Article . objects . get ( pk = 1 ) >>> f = ArticleForm ( request . POST , instance = a ) >>> f . save () Note that if the form hasn’t been validated , calling save() will do so by checking form.errors . A ValueError will be raised if the data in the form\ndoesn’t validate – i.e., if form.errors evaluates to True . If an optional field doesn’t appear in the form’s data, the resulting model\ninstance uses the model field default , if\nthere is one, for that field. This behavior doesn’t apply to fields that use CheckboxInput , CheckboxSelectMultiple , or SelectMultiple (or any custom widget whose value_omitted_from_data() method always returns False ) since an unchecked checkbox and unselected <select multiple> don’t appear in the data of an HTML form submission. Use a custom form field or\nwidget if you’re designing an API and want the default fallback behavior for a\nfield that uses one of these widgets. This save() method accepts an optional commit keyword argument, which\naccepts either True or False . If you call save() with commit=False , then it will return an object that hasn’t yet been saved to\nthe database. In this case, it’s up to you to call save() on the resulting\nmodel instance. This is useful if you want to do custom processing on the\nobject before saving it, or if you want to use one of the specialized model saving options . commit is True by default. Another side effect of using commit=False is seen when your model has\na many-to-many relation with another model. If your model has a many-to-many\nrelation and you specify commit=False when you save a form, Django cannot\nimmediately save the form data for the many-to-many relation. This is because\nit isn’t possible to save many-to-many data for an instance until the instance\nexists in the database. To work around this problem, every time you save a form using commit=False ,\nDjango adds a save_m2m() method to your ModelForm subclass. After\nyou’ve manually saved the instance produced by the form, you can invoke save_m2m() to save the many-to-many form data. For example: # Create a form instance with POST data. >>> f = AuthorForm ( request . POST ) # Create, but don't save the new author instance. >>> new_author = f . save ( commit = False ) # Modify the author in some way. >>> new_author . some_field = \"some_value\" # Save the new instance. >>> new_author . save () # Now, save the many-to-many data for the form. >>> f . save_m2m () Calling save_m2m() is only required if you use save(commit=False) .\nWhen you use a save() on a form, all data – including many-to-many data –\nis saved without the need for any additional method calls.  For example: # Create a form instance with POST data. >>> a = Author () >>> f = AuthorForm ( request . POST , instance = a ) # Create and save the new author instance. There's no need to do anything else. >>> new_author = f . save () Other than the save() and save_m2m() methods, a ModelForm works\nexactly the same way as any other forms form. For example, the is_valid() method is used to check for validity, the is_multipart() method is used to determine whether a form requires multipart file upload (and\nhence whether request.FILES must be passed to the form), etc. See Binding uploaded files to a form for more information. Selecting the fields to use ¶ It is strongly recommended that you explicitly set all fields that should be\nedited in the form using the fields attribute. Failure to do so can easily\nlead to security problems when a form unexpectedly allows a user to set certain\nfields, especially when new fields are added to a model. Depending on how the\nform is rendered, the problem may not even be visible on the web page. The alternative approach would be to include all fields automatically, or\nremove only some. This fundamental approach is known to be much less secure\nand has led to serious exploits on major websites (e.g. GitHub ). There are, however, two shortcuts available for cases where you can guarantee\nthese security concerns do not apply to you: Set the fields attribute to the special value '__all__' to indicate\nthat all fields in the model should be used. For example: from django.forms import ModelForm class AuthorForm ( ModelForm ): class Meta : model = Author fields = \"__all__\" Set the exclude attribute of the ModelForm ’s inner Meta class to\na list of fields to be excluded from the form. For example: class PartialAuthorForm ( ModelForm ): class Meta : model = Author exclude = [ \"title\" ] Since the Author model has the 3 fields name , title and birth_date , this will result in the fields name and birth_date being present on the form. If either of these are used, the order the fields appear in the form will be the\norder the fields are defined in the model, with ManyToManyField instances\nappearing last. In addition, Django applies the following rule: if you set editable=False on\nthe model field, any form created from the model via ModelForm will not\ninclude that field. Note Any fields not included in a form by the above logic\nwill not be set by the form’s save() method. Also, if you\nmanually add the excluded fields back to the form, they will not\nbe initialized from the model instance. Django will prevent any attempt to save an incomplete model, so if\nthe model does not allow the missing fields to be empty, and does\nnot provide a default value for the missing fields, any attempt to save() a ModelForm with missing fields will fail.  To\navoid this failure, you must instantiate your model with initial\nvalues for the missing, but required fields: author = Author ( title = \"Mr\" ) form = PartialAuthorForm ( request . POST , instance = author ) form . save () Alternatively, you can use save(commit=False) and manually set\nany extra required fields: form = PartialAuthorForm ( request . POST ) author = form . save ( commit = False ) author . title = \"Mr\" author . save () See the section on saving forms for more details on using save(commit=False) . Overriding the default fields ¶ The default field types, as described in the Field types table above, are\nsensible defaults. If you have a DateField in your model, chances are you’d\nwant that to be represented as a DateField in your form. But ModelForm gives you the flexibility of changing the form field for a given model. To specify a custom widget for a field, use the widgets attribute of the\ninner Meta class. This should be a dictionary mapping field names to widget\nclasses or instances. For example, if you want the CharField for the name attribute of Author to be represented by a <textarea> instead of its default <input type=\"text\"> , you can override the field’s widget: from django.forms import ModelForm , Textarea from myapp.models import Author class AuthorForm ( ModelForm ): class Meta : model = Author fields = [ \"name\" , \"title\" , \"birth_date\" ] widgets = { \"name\" : Textarea ( attrs = { \"cols\" : 80 , \"rows\" : 20 }), } The widgets dictionary accepts either widget instances (e.g., Textarea(...) ) or classes (e.g., Textarea ). Note that the widgets dictionary is ignored for a model field with a non-empty choices attribute.\nIn this case, you must override the form field to use a different widget. Similarly, you can specify the labels , help_texts and error_messages attributes of the inner Meta class if you want to further customize a field. For example if you wanted to customize the wording of all user facing strings for\nthe name field: from django.utils.translation import gettext_lazy as _ class AuthorForm ( ModelForm ): class Meta : model = Author fields = [ \"name\" , \"title\" , \"birth_date\" ] labels = { \"name\" : _ ( \"Writer\" ), } help_texts = { \"name\" : _ ( \"Some useful help text.\" ), } error_messages = { \"name\" : { \"max_length\" : _ ( \"This writer's name is too long.\" ), }, } You can also specify field_classes or formfield_callback to customize\nthe type of fields instantiated by the form. For example, if you wanted to use MySlugFormField for the slug field, you could do the following: from django.forms import ModelForm from myapp.models import Article class ArticleForm ( ModelForm ): class Meta : model = Article fields = [ \"pub_date\" , \"headline\" , \"content\" , \"reporter\" , \"slug\" ] field_classes = { \"slug\" : MySlugFormField , } or: from django.forms import ModelForm from myapp.models import Article def formfield_for_dbfield ( db_field , ** kwargs ): if db_field . name == \"slug\" : return MySlugFormField () return db_field . formfield ( ** kwargs ) class ArticleForm ( ModelForm ): class Meta : model = Article fields = [ \"pub_date\" , \"headline\" , \"content\" , \"reporter\" , \"slug\" ] formfield_callback = formfield_for_dbfield Finally, if you want complete control over of a field – including its type,\nvalidators, required, etc. – you can do this by declaratively specifying\nfields like you would in a regular Form . If you want to specify a field’s validators, you can do so by defining\nthe field declaratively and setting its validators parameter: from django.forms import CharField , ModelForm from myapp.models import Article class ArticleForm ( ModelForm ): slug = CharField ( validators = [ validate_slug ]) class Meta : model = Article fields = [ \"pub_date\" , \"headline\" , \"content\" , \"reporter\" , \"slug\" ] Note When you explicitly instantiate a form field like this, it is important to\nunderstand how ModelForm and regular Form are related. ModelForm is a regular Form which can automatically generate\ncertain fields. The fields that are automatically generated depend on\nthe content of the Meta class and on which fields have already been\ndefined declaratively. Basically, ModelForm will only generate fields\nthat are missing from the form, or in other words, fields that weren’t\ndefined declaratively. Fields defined declaratively are left as-is, therefore any customizations\nmade to Meta attributes such as widgets , labels , help_texts ,\nor error_messages are ignored; these only apply to fields that are\ngenerated automatically. Similarly, fields defined declaratively do not draw their attributes like max_length or required from the corresponding model. If you want to\nmaintain the behavior specified in the model, you must set the relevant\narguments explicitly when declaring the form field. For example, if the Article model looks like this: class Article ( models . Model ): headline = models . CharField ( max_length = 200 , null = True , blank = True , help_text = \"Use puns liberally\" , ) content = models . TextField () and you want to do some custom validation for headline , while keeping\nthe blank and help_text values as specified, you might define ArticleForm like this: class ArticleForm ( ModelForm ): headline = MyFormField ( max_length = 200 , required = False , help_text = \"Use puns liberally\" , ) class Meta : model = Article fields = [ \"headline\" , \"content\" ] You must ensure that the type of the form field can be used to set the\ncontents of the corresponding model field. When they are not compatible,\nyou will get a ValueError as no implicit conversion takes place. See the form field documentation for more information\non fields and their arguments. Enabling localization of fields ¶ By default, the fields in a ModelForm will not localize their data. To\nenable localization for fields, you can use the localized_fields attribute on the Meta class. >>> from django.forms import ModelForm >>> from myapp.models import Author >>> class AuthorForm ( ModelForm ): ... class Meta : ... model = Author ... localized_fields = [ 'birth_date' ] If localized_fields is set to the special value '__all__' , all fields\nwill be localized. Form inheritance ¶ As with basic forms, you can extend and reuse ModelForms by inheriting\nthem. This is useful if you need to declare extra fields or extra methods on a\nparent class for use in a number of forms derived from models. For example,\nusing the previous ArticleForm class: >>> class EnhancedArticleForm ( ArticleForm ): ... def clean_pub_date ( self ): ... ... This creates a form that behaves identically to ArticleForm , except there’s\nsome extra validation and cleaning for the pub_date field. You can also subclass the parent’s Meta inner class if you want to change\nthe Meta.fields or Meta.exclude lists: >>> class RestrictedArticleForm ( EnhancedArticleForm ): ... class Meta ( ArticleForm . Meta ): ... exclude = [ \"body\" ] ... This adds the extra method from the EnhancedArticleForm and modifies\nthe original ArticleForm.Meta to remove one field. There are a couple of things to note, however. Normal Python name resolution rules apply. If you have multiple base\nclasses that declare a Meta inner class, only the first one will be\nused. This means the child’s Meta , if it exists, otherwise the Meta of the first parent, etc. It’s possible to inherit from both Form and ModelForm simultaneously,\nhowever, you must ensure that ModelForm appears first in the MRO. This is\nbecause these classes rely on different metaclasses and a class can only have\none metaclass. It’s possible to declaratively remove a Field inherited from a parent class by\nsetting the name to be None on the subclass. You can only use this technique to opt out from a field defined declaratively\nby a parent class; it won’t prevent the ModelForm metaclass from generating\na default field. To opt-out from default fields, see Selecting the fields to use . Providing initial values ¶ As with regular forms, it’s possible to specify initial data for forms by\nspecifying an initial parameter when instantiating the form. Initial\nvalues provided this way will override both initial values from the form field\nand values from an attached model instance. For example: >>> article = Article . objects . get ( pk = 1 ) >>> article . headline 'My headline' >>> form = ArticleForm ( initial = { \"headline\" : \"Initial headline\" }, instance = article ) >>> form [ \"headline\" ] . value () 'Initial headline' ModelForm factory function ¶ You can create forms from a given model using the standalone function modelform_factory() , instead of using a class\ndefinition. This may be more convenient if you do not have many customizations\nto make: >>> from django.forms import modelform_factory >>> from myapp.models import Book >>> BookForm = modelform_factory ( Book , fields = [ \"author\" , \"title\" ]) This can also be used to make modifications to existing forms, for example by\nspecifying the widgets to be used for a given field: >>> from django.forms import Textarea >>> Form = modelform_factory ( Book , form = BookForm , widgets = { \"title\" : Textarea ()}) The fields to include can be specified using the fields and exclude keyword arguments, or the corresponding attributes on the ModelForm inner Meta class. Please see the ModelForm Selecting the fields to use documentation. … or enable localization for specific fields: >>> Form = modelform_factory ( Author , form = AuthorForm , localized_fields = [ \"birth_date\" ]) Model formsets ¶ class models. BaseModelFormSet ¶ Like regular formsets , Django provides a couple\nof enhanced formset classes to make working with Django models more\nconvenient. Let’s reuse the Author model from above: >>> from django.forms import modelformset_factory >>> from myapp.models import Author >>> AuthorFormSet = modelformset_factory ( Author , fields = [ \"name\" , \"title\" ]) Using fields restricts the formset to use only the given fields.\nAlternatively, you can take an “opt-out” approach, specifying which fields to\nexclude: >>> AuthorFormSet = modelformset_factory ( Author , exclude = [ \"birth_date\" ]) This will create a formset that is capable of working with the data associated\nwith the Author model. It works just like a regular formset: >>> formset = AuthorFormSet () >>> print ( formset ) <input type=\"hidden\" name=\"form-TOTAL_FORMS\" value=\"1\" id=\"id_form-TOTAL_FORMS\"><input type=\"hidden\" name=\"form-INITIAL_FORMS\" value=\"0\" id=\"id_form-INITIAL_FORMS\"><input type=\"hidden\" name=\"form-MIN_NUM_FORMS\" value=\"0\" id=\"id_form-MIN_NUM_FORMS\"><input type=\"hidden\" name=\"form-MAX_NUM_FORMS\" value=\"1000\" id=\"id_form-MAX_NUM_FORMS\"> <div><label for=\"id_form-0-name\">Name:</label><input id=\"id_form-0-name\" type=\"text\" name=\"form-0-name\" maxlength=\"100\"></div> <div><label for=\"id_form-0-title\">Title:</label><select name=\"form-0-title\" id=\"id_form-0-title\"> <option value=\"\" selected>---------</option> <option value=\"MR\">Mr.</option> <option value=\"MRS\">Mrs.</option> <option value=\"MS\">Ms.</option> </select><input type=\"hidden\" name=\"form-0-id\" id=\"id_form-0-id\"></div> Note modelformset_factory() uses formset_factory() to generate formsets. This\nmeans that a model formset is an extension of a basic formset that knows\nhow to interact with a particular model. Note When using multi-table inheritance , forms\ngenerated by a formset factory will contain a parent link field (by default <parent_model_name>_ptr ) instead of an id field. Changing the queryset ¶ By default, when you create a formset from a model, the formset will use a\nqueryset that includes all objects in the model (e.g., Author.objects.all() ). You can override this behavior by using the queryset argument: >>> formset = AuthorFormSet ( queryset = Author . objects . filter ( name__startswith = \"O\" )) Alternatively, you can create a subclass that sets self.queryset in __init__ : from django.forms import BaseModelFormSet from myapp.models import Author class BaseAuthorFormSet ( BaseModelFormSet ): def __init__ ( self , * args , ** kwargs ): super () . __init__ ( * args , ** kwargs ) self . queryset = Author . objects . filter ( name__startswith = \"O\" ) Then, pass your BaseAuthorFormSet class to the factory function: >>> AuthorFormSet = modelformset_factory ( ... Author , fields = [ \"name\" , \"title\" ], formset = BaseAuthorFormSet ... ) If you want to return a formset that doesn’t include any preexisting\ninstances of the model, you can specify an empty QuerySet: >>> AuthorFormSet ( queryset = Author . objects . none ()) Changing the form ¶ By default, when you use modelformset_factory , a model form will\nbe created using modelform_factory() .\nOften, it can be useful to specify a custom model form. For example,\nyou can create a custom model form that has custom validation: class AuthorForm ( forms . ModelForm ): class Meta : model = Author fields = [ \"name\" , \"title\" ] def clean_name ( self ): # custom validation for the name field ... Then, pass your model form to the factory function: AuthorFormSet = modelformset_factory ( Author , form = AuthorForm ) It is not always necessary to define a custom model form. The modelformset_factory function has several arguments which are\npassed through to modelform_factory , which are described below. Specifying widgets to use in the form with widgets ¶ Using the widgets parameter, you can specify a dictionary of values to\ncustomize the ModelForm ’s widget class for a particular field. This\nworks the same way as the widgets dictionary on the inner Meta class of a ModelForm works: >>> AuthorFormSet = modelformset_factory ( ... Author , ... fields = [ \"name\" , \"title\" ], ... widgets = { \"name\" : Textarea ( attrs = { \"cols\" : 80 , \"rows\" : 20 })}, ... ) Enabling localization for fields with localized_fields ¶ Using the localized_fields parameter, you can enable localization for\nfields in the form. >>> AuthorFormSet = modelformset_factory ( ... Author , fields = [ 'name' , 'title' , 'birth_date' ], ... localized_fields = [ 'birth_date' ]) If localized_fields is set to the special value '__all__' , all fields\nwill be localized. Providing initial values ¶ As with regular formsets, it’s possible to specify initial data for forms in the formset by specifying an initial parameter when instantiating the model formset class returned by modelformset_factory() . However, with model\nformsets, the initial values only apply to extra forms, those that aren’t\nattached to an existing model instance. If the length of initial exceeds\nthe number of extra forms, the excess initial data is ignored. If the extra\nforms with initial data aren’t changed by the user, they won’t be validated or\nsaved. Saving objects in the formset ¶ As with a ModelForm , you can save the data as a model object. This is done\nwith the formset’s save() method: # Create a formset instance with POST data. >>> formset = AuthorFormSet ( request . POST ) # Assuming all is valid, save the data. >>> instances = formset . save () The save() method returns the instances that have been saved to the\ndatabase. If a given instance’s data didn’t change in the bound data, the\ninstance won’t be saved to the database and won’t be included in the return\nvalue ( instances , in the above example). When fields are missing from the form (for example because they have been\nexcluded), these fields will not be set by the save() method. You can find\nmore information about this restriction, which also holds for regular ModelForms , in Selecting the fields to use . Pass commit=False to return the unsaved model instances: # don't save to the database >>> instances = formset . save ( commit = False ) >>> for instance in instances : ... # do something with instance ... instance . save () ... This gives you the ability to attach data to the instances before saving them\nto the database. If your formset contains a ManyToManyField , you’ll also\nneed to call formset.save_m2m() to ensure the many-to-many relationships\nare saved properly. After calling save() , your model formset will have three new attributes\ncontaining the formset’s changes: models.BaseModelFormSet. changed_objects ¶ models.BaseModelFormSet. deleted_objects ¶ models.BaseModelFormSet. new_objects ¶ Limiting the number of editable objects ¶ As with regular formsets, you can use the max_num and extra parameters\nto modelformset_factory() to limit the number of\nextra forms displayed. max_num does not prevent existing objects from being displayed: >>> Author . objects . order_by ( \"name\" ) <QuerySet [<Author: Charles Baudelaire>, <Author: Paul Verlaine>, <Author: Walt Whitman>]> >>> AuthorFormSet = modelformset_factory ( Author , fields = [ \"name\" ], max_num = 1 ) >>> formset = AuthorFormSet ( queryset = Author . objects . order_by ( \"name\" )) >>> [ x . name for x in formset . get_queryset ()] ['Charles Baudelaire', 'Paul Verlaine', 'Walt Whitman'] Also, extra=0 doesn’t prevent creation of new model instances as you can add additional forms with JavaScript or send additional POST data. See Preventing new objects creation on how to do\nthis. If the value of max_num is greater than the number of existing related\nobjects, up to extra additional blank forms will be added to the formset,\nso long as the total number of forms does not exceed max_num : >>> AuthorFormSet = modelformset_factory ( Author , fields = [ \"name\" ], max_num = 4 , extra = 2 ) >>> formset = AuthorFormSet ( queryset = Author . objects . order_by ( \"name\" )) >>> for form in formset : ... print ( form ) ... <div><label for=\"id_form-0-name\">Name:</label><input id=\"id_form-0-name\" type=\"text\" name=\"form-0-name\" value=\"Charles Baudelaire\" maxlength=\"100\"><input type=\"hidden\" name=\"form-0-id\" value=\"1\" id=\"id_form-0-id\"></div> <div><label for=\"id_form-1-name\">Name:</label><input id=\"id_form-1-name\" type=\"text\" name=\"form-1-name\" value=\"Paul Verlaine\" maxlength=\"100\"><input type=\"hidden\" name=\"form-1-id\" value=\"3\" id=\"id_form-1-id\"></div> <div><label for=\"id_form-2-name\">Name:</label><input id=\"id_form-2-name\" type=\"text\" name=\"form-2-name\" value=\"Walt Whitman\" maxlength=\"100\"><input type=\"hidden\" name=\"form-2-id\" value=\"2\" id=\"id_form-2-id\"></div> <div><label for=\"id_form-3-name\">Name:</label><input id=\"id_form-3-name\" type=\"text\" name=\"form-3-name\" maxlength=\"100\"><input type=\"hidden\" name=\"form-3-id\" id=\"id_form-3-id\"></div> A max_num value of None (the default) puts a high limit on the number\nof forms displayed (1000). In practice this is equivalent to no limit. Preventing new objects creation ¶ Using the edit_only parameter, you can prevent creation of any new\nobjects: >>> AuthorFormSet = modelformset_factory ( ... Author , ... fields = [ \"name\" , \"title\" ], ... edit_only = True , ... ) Here, the formset will only edit existing Author instances. No other\nobjects will be created or edited. Using a model formset in a view ¶ Model formsets are very similar to formsets. Let’s say we want to present a\nformset to edit Author model instances: from django.forms import modelformset_factory from django.shortcuts import render from myapp.models import Author def manage_authors ( request ): AuthorFormSet = modelformset_factory ( Author , fields = [ \"name\" , \"title\" ]) if request . method == \"POST\" : formset = AuthorFormSet ( request . POST , request . FILES ) if formset . is_valid (): formset . save () # do something. else : formset = AuthorFormSet () return render ( request , \"manage_authors.html\" , { \"formset\" : formset }) As you can see, the view logic of a model formset isn’t drastically different\nthan that of a “normal” formset. The only difference is that we call formset.save() to save the data into the database. (This was described\nabove, in Saving objects in the formset .) Overriding clean() on a ModelFormSet ¶ Just like with ModelForms , by default the clean() method of a ModelFormSet will validate that none of the items in the formset violate\nthe unique constraints on your model (either unique , unique_together or unique_for_date|month|year ).  If you want to override the clean() method\non a ModelFormSet and maintain this validation, you must call the parent\nclass’s clean method: from django.forms import BaseModelFormSet class MyModelFormSet ( BaseModelFormSet ): def clean ( self ): super () . clean () # example custom validation across forms in the formset for form in self . forms : # your custom formset validation ... Also note that by the time you reach this step, individual model instances\nhave already been created for each Form . Modifying a value in form.cleaned_data is not sufficient to affect the saved value. If you wish\nto modify a value in ModelFormSet.clean() you must modify form.instance : from django.forms import BaseModelFormSet class MyModelFormSet ( BaseModelFormSet ): def clean ( self ): super () . clean () for form in self . forms : name = form . cleaned_data [ \"name\" ] . upper () form . cleaned_data [ \"name\" ] = name # update the instance value. form . instance . name = name Using a custom queryset ¶ As stated earlier, you can override the default queryset used by the model\nformset: from django.forms import modelformset_factory from django.shortcuts import render from myapp.models import Author def manage_authors ( request ): AuthorFormSet = modelformset_factory ( Author , fields = [ \"name\" , \"title\" ]) queryset = Author . objects . filter ( name__startswith = \"O\" ) if request . method == \"POST\" : formset = AuthorFormSet ( request . POST , request . FILES , queryset = queryset , ) if formset . is_valid (): formset . save () # Do something. else : formset = AuthorFormSet ( queryset = queryset ) return render ( request , \"manage_authors.html\" , { \"formset\" : formset }) Note that we pass the queryset argument in both the POST and GET cases in this example. Using the formset in the template ¶ There are three ways to render a formset in a Django template. First, you can let the formset do most of the work: < form method = \"post\" > {{ formset }} </ form > Second, you can manually render the formset, but let the form deal with\nitself: < form method = \"post\" > {{ formset.management_form }} {% for form in formset %} {{ form }} {% endfor %} </ form > When you manually render the forms yourself, be sure to render the management\nform as shown above. See the management form documentation . Third, you can manually render each field: < form method = \"post\" > {{ formset.management_form }} {% for form in formset %} {% for field in form %} {{ field.label_tag }} {{ field }} {% endfor %} {% endfor %} </ form > If you opt to use this third method and you don’t iterate over the fields with\na {% for %} loop, you’ll need to render the primary key field. For example,\nif you were rendering the name and age fields of a model: < form method = \"post\" > {{ formset.management_form }} {% for form in formset %} {{ form.id }} < ul > < li > {{ form.name }} </ li > < li > {{ form.age }} </ li > </ ul > {% endfor %} </ form > Notice how we need to explicitly render {{ form.id }} . This ensures that\nthe model formset, in the POST case, will work correctly. (This example\nassumes a primary key named id . If you’ve explicitly defined your own\nprimary key that isn’t called id , make sure it gets rendered.) Inline formsets ¶ class models. BaseInlineFormSet ¶ Inline formsets is a small abstraction layer on top of model formsets. These\nsimplify the case of working with related objects via a foreign key. Suppose\nyou have these two models: from django.db import models class Author ( models . Model ): name = models . CharField ( max_length = 100 ) class Book ( models . Model ): author = models . ForeignKey ( Author , on_delete = models . CASCADE ) title = models . CharField ( max_length = 100 ) If you want to create a formset that allows you to edit books belonging to\na particular author, you could do this: >>> from django.forms import inlineformset_factory >>> BookFormSet = inlineformset_factory ( Author , Book , fields = [ \"title\" ]) >>> author = Author . objects . get ( name = \"Mike Royko\" ) >>> formset = BookFormSet ( instance = author ) BookFormSet ’s prefix is 'book_set' ( <model name>_set ). If Book ’s ForeignKey to Author has a related_name , that’s used instead. Note inlineformset_factory() uses modelformset_factory() and marks can_delete=True . See also Manually rendered can_delete and can_order . Overriding methods on an InlineFormSet ¶ When overriding methods on InlineFormSet , you should subclass BaseInlineFormSet rather than BaseModelFormSet . For example, if you want to override clean() : from django.forms import BaseInlineFormSet class CustomInlineFormSet ( BaseInlineFormSet ): def clean ( self ): super () . clean () # example custom validation across forms in the formset for form in self . forms : # your custom formset validation ... See also Overriding clean() on a ModelFormSet . Then when you create your inline formset, pass in the optional argument formset : >>> from django.forms import inlineformset_factory >>> BookFormSet = inlineformset_factory ( ... Author , Book , fields = [ \"title\" ], formset = CustomInlineFormSet ... ) >>> author = Author . objects . get ( name = \"Mike Royko\" ) >>> formset = BookFormSet ( instance = author ) More than one foreign key to the same model ¶ If your model contains more than one foreign key to the same model, you’ll\nneed to resolve the ambiguity manually using fk_name . For example, consider\nthe following model: class Friendship ( models . Model ): from_friend = models . ForeignKey ( Friend , on_delete = models . CASCADE , related_name = \"from_friends\" , ) to_friend = models . ForeignKey ( Friend , on_delete = models . CASCADE , related_name = \"friends\" , ) length_in_months = models . IntegerField () To resolve this, you can use fk_name to inlineformset_factory() : >>> FriendshipFormSet = inlineformset_factory ( ... Friend , Friendship , fk_name = \"from_friend\" , fields = [ \"to_friend\" , \"length_in_months\" ] ... ) Using an inline formset in a view ¶ You may want to provide a view that allows a user to edit the related objects\nof a model. Here’s how you can do that: def manage_books ( request , author_id ): author = Author . objects . get ( pk = author_id ) BookInlineFormSet = inlineformset_factory ( Author , Book , fields = [ \"title\" ]) if request . method == \"POST\" : formset = BookInlineFormSet ( request . POST , request . FILES , instance = author ) if formset . is_valid (): formset . save () # Do something. Should generally end with a redirect. For example: return HttpResponseRedirect ( author . get_absolute_url ()) else : formset = BookInlineFormSet ( instance = author ) return render ( request , \"manage_books.html\" , { \"formset\" : formset }) Notice how we pass instance in both the POST and GET cases. Specifying widgets to use in the inline form ¶ inlineformset_factory uses modelformset_factory and passes most\nof its arguments to modelformset_factory . This means you can use\nthe widgets parameter in much the same way as passing it to modelformset_factory . See Specifying widgets to use in the form with\nwidgets above.", "keywords": ["get_queryset", "rows", "bigintegerfield", "integerfield", "uuidfield", "formset", "emailfield", "selection", "messages", "formsets", "preexisting", "new_article", "field", "#", "friends", "relation", "m", "authorformset", "django.forms", "min_value", "unique_together", "value_omitted_from_data", "form.name", "loop", "mro", "manage_authors.html", "datefield", "modelmultiplechoicefield", "words", "field_labels)s", "type=\"text", "change", "label", "hook", "django.core.exceptions", "=", "concerns", "changes", "get_absolute_url", "length_in_months", "chances", "character", "value=\"paul", "myformfield", "process", "choice", "multiple", "name=\"form-2", "max_num_forms", "uniqueness", "articleform", "following", "type", "processing", "error_messages", "filefield", "self.queryset", "people", "custom", "calls", "kwargs", "objects", "documentation", "smallautofield", "file", "work", "id=\"id_form", "user", "li", "django.utils.translation", "cases", "helper", "attribute", "args", "modelform.clean", "min_num_forms\"><input", "maxlength=\"100\"><input", "constraints", "time", "name=\"form", "save", "date", "render", "to_friend", "things", "custominlineformset", "logic", "walt", "name", "birth_date", "parameter", "rule", "formfield_for_dbfield", "reporter", "is_multipart", "web", "age", "restrictedarticleform", "problems", "total_forms\"><input", "wording", "github", "opt", "form.cleaned_data", "normal", "return", "id=\"id_form-0", "parent", "modelformset", "textfield", "datetimefield", "failure", "mr", "relationships", "enhancedarticleform", "bookinlineformset", "for=\"id_form-3", "error", "royko", "decimalfield", "filter", "false", "behavior", "clean_name", "access", "class", "link", "i", "widget", "names", "javascript", "paul", "maxlength=\"100\"></div", "friendship", "modelform_factory", "request", "new_author", "formfield", "database", "flag", "input", "*", "metaclass", "page", "types", "strings", "empty_value", "floatfield", "modelformset_factory", "subclass", "creation", ".", "id\"></div", "value=\"ms\">ms.</option", "help_text", "limit", "step", "max_length", "formfield_callback", "validation", "flexibility", "name=\"form-0", "mike", "modelforms", "section", "filepathfield", "cleaned_data", "source", "use", "non_field_errors", "puns", "help_texts", "commit", "author", "deleted_objects", "subclasses", "genericipaddressfield", "order", "default", "choices", "modifications", "form", "shortcuts", "prefix", "option", "value=\"walt", "blogcomment", "classes", "help", "selected>---------</option", "cleaning", "violate", "form.errors", "considerations", "booleanfield", "validationerror", "f", "attempt", "bookformset", "fk_name", "template", "localized_fields", "value=\"mrs\">mrs.</option", "interaction", "way", "endfor", "super", "checks", "ms", "customizations", "comments", "queryset", "¶", "exceeds", "id", "baseinlineformset", "post", "parameters", "modelchoicefield", "extra=0", "headline", "side", "can_delete", "value=\"2", "content", "function", "multiplechoicefield", "min_num_forms", "save(commit", "view", "ambiguity", "websites", "control", "number", "mymodelformset", "jsonfield", "modelform", "def", "values", "order_by", "for=\"id_form-2", "mapping", "verbose_name", "id=\"id_form-2", "exclude", "table", "models", "-9223372036854775808", "ways", "level", "contents", "metaclasses", "article", "labels", "cols", "django", "n’t", "db_field", "formset_factory", "fields", "print", "formset.save", "conversions", "set", "book", "practice", "value", "formset.save_m2", "django.shortcuts", "field_classes", "data", "base", "out", "layer", "inline", "myapp.forms", "authorform", "security", "writer", "ul", "mrs.", "self", "need", "instance", "field.label_tag", "pub_date", "localization", "extension", "model_name)s", "validators", "name\">name:</label><input", "ipaddressfield", "value=\"0", "related_name", "save_m2", "gettext_lazy", "whitman", "name=\"form-3", "constructor", "parent_model_name>_ptr", "instances", "part", "object", "manage_authors", "textarea", "author.objects.all", "couple", "mrs", "valueerror", "choicefield", "charfield", "manytomanyfield", "management", "precedence", "dictionary", "authors", "binaryfield", "keyword", "child", "resolution", "from_friend", "attrs", "conversion", "notice", "rules", "top", "redirect", "effect", "inheritance", "charles", "items", "imagefield", "widgets", "verlaine", "definition", "baudelaire", "from_friends", "autofield", "basemodelformset", "difference", "forms", "type=\"hidden", "’s", "addition", "lists", "example", "value=\"3", "app", "list", "baseauthorformset", "for=\"id_form-1", "title\">title:</label><select", "friendshipformset", "inlineformset", "steps", "model.full_clean", "mr.", "id=\"id_form-3", "model", "ms.", "place", "id=\"id_form-1", "inlineformset_factory", "urlfield", "attributes", "approach", "slugfield", "title", "ability", "value=\"1", "timefield", "friend", "checkboxinput", "restriction", "select", "form.instance", "case", "length", "for=\"id_form-0", "full_clean", "slug", "bookform", "technique", "clean", "errors", "html", "factory", "str", "submission", "arguments", "upload", "init", "one", "selectmultiple", "validity", "checkboxselectmultiple", "initial_forms\"><input", "is_valid", "key", "value=\"1000", "abstraction", "update", "none", "value=\"mr\">mr.</option", "problem", "meta", "):", "get", "durationfield", "reason", "true", "manage_books.html", "new_objects", "manage_books", "api", "max_value", "myapp.models", "max_num", "-", "saving", "import", "files", "modelformset.clean", "d", "cascade", "partialauthorform", ">", "defaults", "%", "clean_pub_date", "foreignkey", "checkbox", "meta.fields", "author_id", "information", "myslugformfield", "python", "bigautofield", "methods", "exploits", "books", "options", "details", "method", "django.db", "argument", "name>_set", "note", "body", "state", "formset.management_form", "moment", "text"], "type": "documentation"},
{"title": "Conditional Expressions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/conditional-expressions/", "content": "Conditional Expressions ¶ Conditional expressions let you use if … elif … else logic within filters, annotations, aggregations, and updates. A\nconditional expression evaluates a series of conditions for each row of a\ntable and returns the matching result expression. Conditional expressions can\nalso be combined and nested like other expressions . The conditional expression classes ¶ We’ll be using the following model in the subsequent examples: from django.db import models class Client ( models . Model ): REGULAR = \"R\" GOLD = \"G\" PLATINUM = \"P\" ACCOUNT_TYPE_CHOICES = { REGULAR : \"Regular\" , GOLD : \"Gold\" , PLATINUM : \"Platinum\" , } name = models . CharField ( max_length = 50 ) registered_on = models . DateField () account_type = models . CharField ( max_length = 1 , choices = ACCOUNT_TYPE_CHOICES , default = REGULAR , ) When ¶ class When ( condition = None , then = None , ** lookups ) [source] ¶ A When() object is used to encapsulate a condition and its result for use\nin the conditional expression. Using a When() object is similar to using\nthe filter() method. The condition can\nbe specified using field lookups , Q objects, or Expression objects that have an output_field that is a BooleanField . The result is provided using the then keyword. Some examples: >>> from django.db.models import F , Q , When >>> # String arguments refer to fields; the following two examples are equivalent: >>> When ( account_type = Client . GOLD , then = \"name\" ) >>> When ( account_type = Client . GOLD , then = F ( \"name\" )) >>> # You can use field lookups in the condition >>> from datetime import date >>> When ( ... registered_on__gt = date ( 2014 , 1 , 1 ), ... registered_on__lt = date ( 2015 , 1 , 1 ), ... then = \"account_type\" , ... ) >>> # Complex conditions can be created using Q objects >>> When ( Q ( name__startswith = \"John\" ) | Q ( name__startswith = \"Paul\" ), then = \"name\" ) >>> # Condition can be created using boolean expressions. >>> from django.db.models import Exists , OuterRef >>> non_unique_account_type = ( ... Client . objects . filter ( ... account_type = OuterRef ( \"account_type\" ), ... ) ... . exclude ( pk = OuterRef ( \"pk\" )) ... . values ( \"pk\" ) ... ) >>> When ( Exists ( non_unique_account_type ), then = Value ( \"non unique\" )) >>> # Condition can be created using lookup expressions. >>> from django.db.models.lookups import GreaterThan , LessThan >>> When ( ... GreaterThan ( F ( \"registered_on\" ), date ( 2014 , 1 , 1 )) ... & LessThan ( F ( \"registered_on\" ), date ( 2015 , 1 , 1 )), ... then = \"account_type\" , ... ) Keep in mind that each of these values can be an expression. Note Since the then keyword argument is reserved for the result of the When() , there is a potential conflict if a Model has a field named then . This can be\nresolved in two ways: >>> When ( then__exact = 0 , then = 1 ) >>> When ( Q ( then = 0 ), then = 1 ) Case ¶ class Case ( * cases , ** extra ) [source] ¶ A Case() expression is like the if … elif … else statement in Python . Each condition in the provided When() objects is evaluated in order, until one evaluates to a\ntruthful value. The result expression from the matching When() object\nis returned. An example: >>> >>> from datetime import date , timedelta >>> from django.db.models import Case , Value , When >>> Client . objects . create ( ... name = \"Jane Doe\" , ... account_type = Client . REGULAR , ... registered_on = date . today () - timedelta ( days = 36 ), ... ) >>> Client . objects . create ( ... name = \"James Smith\" , ... account_type = Client . GOLD , ... registered_on = date . today () - timedelta ( days = 5 ), ... ) >>> Client . objects . create ( ... name = \"Jack Black\" , ... account_type = Client . PLATINUM , ... registered_on = date . today () - timedelta ( days = 10 * 365 ), ... ) >>> # Get the discount for each Client based on the account type >>> Client . objects . annotate ( ... discount = Case ( ... When ( account_type = Client . GOLD , then = Value ( \"5%\" )), ... When ( account_type = Client . PLATINUM , then = Value ( \"10%\" )), ... default = Value ( \"0%\" ), ... ), ... ) . values_list ( \"name\" , \"discount\" ) <QuerySet [('Jane Doe', '0%'), ('James Smith', '5%'), ('Jack Black', '10%')]> Case() accepts any number of When() objects as individual arguments.\nOther options are provided using keyword arguments. If none of the conditions\nevaluate to TRUE , then the expression given with the default keyword\nargument is returned. If a default argument isn’t provided, None is\nused. If we wanted to change our previous query to get the discount based on how long\nthe Client has been with us, we could do so using lookups: >>> a_month_ago = date . today () - timedelta ( days = 30 ) >>> a_year_ago = date . today () - timedelta ( days = 365 ) >>> # Get the discount for each Client based on the registration date >>> Client . objects . annotate ( ... discount = Case ( ... When ( registered_on__lte = a_year_ago , then = Value ( \"10%\" )), ... When ( registered_on__lte = a_month_ago , then = Value ( \"5%\" )), ... default = Value ( \"0%\" ), ... ) ... ) . values_list ( \"name\" , \"discount\" ) <QuerySet [('Jane Doe', '5%'), ('James Smith', '0%'), ('Jack Black', '10%')]> Note Remember that the conditions are evaluated in order, so in the above\nexample we get the correct result even though the second condition matches\nboth Jane Doe and Jack Black. This works just like an if … elif … else statement in Python . Case() also works in a filter() clause. For example, to find gold\nclients that registered more than a month ago and platinum clients that\nregistered more than a year ago: >>> a_month_ago = date . today () - timedelta ( days = 30 ) >>> a_year_ago = date . today () - timedelta ( days = 365 ) >>> Client . objects . filter ( ... registered_on__lte = Case ( ... When ( account_type = Client . GOLD , then = a_month_ago ), ... When ( account_type = Client . PLATINUM , then = a_year_ago ), ... ), ... ) . values_list ( \"name\" , \"account_type\" ) <QuerySet [('Jack Black', 'P')]> Advanced queries ¶ Conditional expressions can be used in annotations, aggregations, filters,\nlookups, and updates. They can also be combined and nested with other\nexpressions. This allows you to make powerful conditional queries. Conditional update ¶ Let’s say we want to change the account_type for our clients to match\ntheir registration dates. We can do this using a conditional expression and the update() method: >>> a_month_ago = date . today () - timedelta ( days = 30 ) >>> a_year_ago = date . today () - timedelta ( days = 365 ) >>> # Update the account_type for each Client from the registration date >>> Client . objects . update ( ... account_type = Case ( ... When ( registered_on__lte = a_year_ago , then = Value ( Client . PLATINUM )), ... When ( registered_on__lte = a_month_ago , then = Value ( Client . GOLD )), ... default = Value ( Client . REGULAR ), ... ), ... ) >>> Client . objects . values_list ( \"name\" , \"account_type\" ) <QuerySet [('Jane Doe', 'G'), ('James Smith', 'R'), ('Jack Black', 'P')]> Conditional aggregation ¶ What if we want to find out how many clients there are for each account_type ? We can use the filter argument of aggregate\nfunctions to achieve this: >>> # Create some more Clients first so we can have something to count >>> Client . objects . create ( ... name = \"Jean Grey\" , account_type = Client . REGULAR , registered_on = date . today () ... ) >>> Client . objects . create ( ... name = \"James Bond\" , account_type = Client . PLATINUM , registered_on = date . today () ... ) >>> Client . objects . create ( ... name = \"Jane Porter\" , account_type = Client . PLATINUM , registered_on = date . today () ... ) >>> # Get counts for each value of account_type >>> from django.db.models import Count >>> Client . objects . aggregate ( ... regular = Count ( \"pk\" , filter = Q ( account_type = Client . REGULAR )), ... gold = Count ( \"pk\" , filter = Q ( account_type = Client . GOLD )), ... platinum = Count ( \"pk\" , filter = Q ( account_type = Client . PLATINUM )), ... ) {'regular': 2, 'gold': 1, 'platinum': 3} This aggregate produces a query with the SQL 2003 FILTER WHERE syntax\non databases that support it: SELECT count ( 'id' ) FILTER ( WHERE account_type = 1 ) as regular , count ( 'id' ) FILTER ( WHERE account_type = 2 ) as gold , count ( 'id' ) FILTER ( WHERE account_type = 3 ) as platinum FROM clients ; On other databases, this is emulated using a CASE statement: SELECT count ( CASE WHEN account_type = 1 THEN id ELSE null ) as regular , count ( CASE WHEN account_type = 2 THEN id ELSE null ) as gold , count ( CASE WHEN account_type = 3 THEN id ELSE null ) as platinum FROM clients ; The two SQL statements are functionally equivalent but the more explicit FILTER may perform better. Conditional filter ¶ When a conditional expression returns a boolean value, it is possible to use it\ndirectly in filters. This means that it will not be added to the SELECT columns, but you can still use it to filter results: >>> non_unique_account_type = ( ... Client . objects . filter ( ... account_type = OuterRef ( \"account_type\" ), ... ) ... . exclude ( pk = OuterRef ( \"pk\" )) ... . values ( \"pk\" ) ... ) >>> Client . objects . filter ( ~ Exists ( non_unique_account_type )) In SQL terms, that evaluates to: SELECT ... FROM client c0 WHERE NOT EXISTS ( SELECT c1 . id FROM client c1 WHERE c1 . account_type = c0 . account_type AND NOT c1 . id = c0 . id )", "keywords": ["aggregations", "examples", "result", "when", "django.db.models.lookups", "number", "conditions", "values", "filter", "string", "i", "class", "example", "field", "#", "outerref", "exists", "clause", "aggregate", "month", "platinum", "paul", "databases", "table", "non_unique_account_type", "*", "models", "query", "dates", "conflict", "datefield", "ways", "count", "jane", "model", "year", "jean", "condition", "account_type_choices", "series", "=", "n’t", "max_length", "results", "fields", "registered_on", "p", "james", "clients", "syntax", "r", "select", "value", "source", "case", "columns", "lookup", "null", "use", "else", "bond", "arguments", "john", "registered_on__lte", "type", "a", "updates", "objects", "lookups", "g", "account_type", "mind", "today", "porter", "output_field", "aggregation", "matching", "order", "default", "|", "choices", "cases", "functions", "gold", "annotations", "update", "timedelta", "none", "filters", "expression", "discount", "q", "date", "registered_on__gt", "true", "annotate", "conditional", "statement", "black", "booleanfield", "account", "f", "object", "then__exact", "registered_on__lt", "doe", "logic", "counts", "c1", "import", "name", "charfield", "d", "grey", "statements", "%", "sql", "regular", "pk", "row", "lessthan", "python", "terms", "keyword", "options", "queries", "client", "jack", "method", "queryset", "registration", "django.db", "argument", "days", "¶", "note", "expressions", "smith", "c0", "advanced", "greaterthan", "values_list"], "type": "documentation"},
{"title": "Performing raw SQL queries | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/db/sql/", "content": "Performing raw SQL queries ¶ Django gives you two ways of performing raw SQL queries: you can use Manager.raw() to perform raw queries and return model instances , or\nyou can avoid the model layer entirely and execute custom SQL directly . Explore the ORM before using raw SQL! The Django ORM provides many tools to express queries without writing raw\nSQL. For example: The QuerySet API is extensive. You can annotate and aggregate using many built-in database functions . Beyond those, you can create custom query expressions . Before using raw SQL, explore the ORM . Ask on\none of the support channels to see if the ORM supports\nyour use case. Warning You should be very careful whenever you write raw SQL. Every time you use\nit, you should properly escape any parameters that the user can control\nby using params in order to protect against SQL injection attacks.\nPlease read more about SQL injection protection . Performing raw queries ¶ The raw() manager method can be used to perform raw SQL queries that\nreturn model instances: Manager. raw ( raw_query , params = () , translations = None ) ¶ This method takes a raw SQL query, executes it, and returns a django.db.models.query.RawQuerySet instance. This RawQuerySet instance\ncan be iterated over like a normal QuerySet to\nprovide object instances. This is best illustrated with an example. Suppose you have the following model: class Person ( models . Model ): first_name = models . CharField ( ... ) last_name = models . CharField ( ... ) birth_date = models . DateField ( ... ) You could then execute custom SQL like so: >>> for p in Person . objects . raw ( \"SELECT * FROM myapp_person\" ): ... print ( p ) ... John Smith Jane Jones This example isn’t very exciting – it’s exactly the same as running Person.objects.all() . However, raw() has a bunch of other options that\nmake it very powerful. Model table names Where did the name of the Person table come from in that example? By default, Django figures out a database table name by joining the\nmodel’s “app label” – the name you used in manage.py startapp – to\nthe model’s class name, with an underscore between them. In the example\nwe’ve assumed that the Person model lives in an app named myapp ,\nso its table would be myapp_person . For more details check out the documentation for the db_table option, which also lets you manually set the\ndatabase table name. Warning No checking is done on the SQL statement that is passed in to .raw() .\nDjango expects that the statement will return a set of rows from the\ndatabase, but does nothing to enforce that. If the query does not\nreturn rows, a (possibly cryptic) error will result. Warning If you are performing queries on MySQL, note that MySQL’s silent type coercion\nmay cause unexpected results when mixing types. If you query on a string\ntype column, but with an integer value, MySQL will coerce the types of all values\nin the table to an integer before performing the comparison. For example, if your\ntable contains the values 'abc' , 'def' and you query for WHERE mycolumn=0 ,\nboth rows will match. To prevent this, perform the correct typecasting\nbefore using the value in a query. Mapping query fields to model fields ¶ raw() automatically maps fields in the query to fields on the model. The order of fields in your query doesn’t matter. In other words, both\nof the following queries work identically: >>> Person . objects . raw ( \"SELECT id, first_name, last_name, birth_date FROM myapp_person\" ) >>> Person . objects . raw ( \"SELECT last_name, birth_date, first_name, id FROM myapp_person\" ) Matching is done by name. This means that you can use SQL’s AS clauses to\nmap fields in the query to model fields. So if you had some other table that\nhad Person data in it, you could easily map it into Person instances: >>> Person . objects . raw ( ... \"\"\" ... SELECT first AS first_name, ... last AS last_name, ... bd AS birth_date, ... pk AS id, ... FROM some_other_table ... \"\"\" ... ) As long as the names match, the model instances will be created correctly. Alternatively, you can map fields in the query to model fields using the translations argument to raw() . This is a dictionary mapping names of\nfields in the query to names of fields on the model. For example, the above\nquery could also be written: >>> name_map = { \"first\" : \"first_name\" , \"last\" : \"last_name\" , \"bd\" : \"birth_date\" , \"pk\" : \"id\" } >>> Person . objects . raw ( \"SELECT * FROM some_other_table\" , translations = name_map ) Index lookups ¶ raw() supports indexing, so if you need only the first result you can\nwrite: >>> first_person = Person . objects . raw ( \"SELECT * FROM myapp_person\" )[ 0 ] However, the indexing and slicing are not performed at the database level. If\nyou have a large number of Person objects in your database, it is more\nefficient to limit the query at the SQL level: >>> first_person = Person . objects . raw ( \"SELECT * FROM myapp_person LIMIT 1\" )[ 0 ] Deferring model fields ¶ Fields may also be left out: >>> people = Person . objects . raw ( \"SELECT id, first_name FROM myapp_person\" ) The Person objects returned by this query will be deferred model instances\n(see defer() ). This means that the\nfields that are omitted from the query will be loaded on demand. For example: >>> for p in Person . objects . raw ( \"SELECT id, first_name FROM myapp_person\" ): ... print ( ... p . first_name , # This will be retrieved by the original query ... p . last_name , # This will be retrieved on demand ... ) ... John Smith Jane Jones From outward appearances, this looks like the query has retrieved both\nthe first name and last name. However, this example actually issued 3\nqueries. Only the first names were retrieved by the raw() query – the\nlast names were both retrieved on demand when they were printed. There is only one field that you can’t leave out - the primary key\nfield. Django uses the primary key to identify model instances, so it\nmust always be included in a raw query. A FieldDoesNotExist exception will be raised if\nyou forget to include the primary key. Adding annotations ¶ You can also execute queries containing fields that aren’t defined on the\nmodel. For example, we could use PostgreSQL’s age() function to get a list\nof people with their ages calculated by the database: >>> people = Person . objects . raw ( \"SELECT *, age(birth_date) AS age FROM myapp_person\" ) >>> for p in people : ... print ( \" %s is %s .\" % ( p . first_name , p . age )) ... John is 37. Jane is 42. ... You can often avoid using raw SQL to compute annotations by instead using a Func() expression . Passing parameters into raw() ¶ If you need to perform parameterized queries, you can use the params argument to raw() : >>> lname = \"Doe\" >>> Person . objects . raw ( \"SELECT * FROM myapp_person WHERE last_name = %s \" , [ lname ]) params is a list or dictionary of parameters. You’ll use %s placeholders in the query string for a list, or %(key)s placeholders for a dictionary (where key is replaced by a\ndictionary key), regardless of your database engine. Such placeholders will be\nreplaced with parameters from the params argument. Note Dictionary params are not supported with the SQLite backend; with\nthis backend, you must pass parameters as a list. Warning Do not use string formatting on raw queries or quote placeholders in your\nSQL strings! It’s tempting to write the above query as: >>> query = \"SELECT * FROM myapp_person WHERE last_name = %s \" % lname >>> Person . objects . raw ( query ) You might also think you should write your query like this (with quotes\naround %s ): >>> query = \"SELECT * FROM myapp_person WHERE last_name = ' %s '\" Don’t make either of these mistakes. As discussed in SQL injection protection , using the params argument and leaving the placeholders unquoted protects you from SQL\ninjection attacks , a common exploit where attackers inject arbitrary\nSQL into your database. If you use string interpolation or quote the\nplaceholder, you’re at risk for SQL injection. Executing custom SQL directly ¶ Sometimes even Manager.raw() isn’t quite enough: you might need to\nperform queries that don’t map cleanly to models, or directly execute UPDATE , INSERT , or DELETE queries. In these cases, you can always access the database directly, routing around\nthe model layer entirely. The object django.db.connection represents the default database\nconnection. To use the database connection, call connection.cursor() to\nget a cursor object. Then, call cursor.execute(sql, [params]) to execute\nthe SQL and cursor.fetchone() or cursor.fetchall() to return the\nresulting rows. For example: from django.db import connection def my_custom_sql ( self ): with connection . cursor () as cursor : cursor . execute ( \"UPDATE bar SET foo = 1 WHERE baz = %s \" , [ self . baz ]) cursor . execute ( \"SELECT foo FROM bar WHERE baz = %s \" , [ self . baz ]) row = cursor . fetchone () return row To protect against SQL injection, you must not include quotes around the %s placeholders in the SQL string. Note that if you want to include literal percent signs in the query, you have to\ndouble them in the case you are passing parameters: cursor . execute ( \"SELECT foo FROM bar WHERE baz = '30%'\" ) cursor . execute ( \"SELECT foo FROM bar WHERE baz = '30 %% ' AND id = %s \" , [ self . id ]) If you are using more than one database , you can\nuse django.db.connections to obtain the connection (and cursor) for a\nspecific database. django.db.connections is a dictionary-like\nobject that allows you to retrieve a specific connection using its\nalias: from django.db import connections with connections [ \"my_db_alias\" ] . cursor () as cursor : # Your code here ... By default, the Python DB API will return results without their field names,\nwhich means you end up with a list of values, rather than a dict . At a\nsmall performance and memory cost, you can return results as a dict by\nusing something like this: def dictfetchall ( cursor ): \"\"\" Return all rows from a cursor as a dict. Assume the column names are unique. \"\"\" columns = [ col [ 0 ] for col in cursor . description ] return [ dict ( zip ( columns , row )) for row in cursor . fetchall ()] Another option is to use collections.namedtuple() from the Python\nstandard library. A namedtuple is a tuple-like object that has fields\naccessible by attribute lookup; it’s also indexable and iterable. Results are\nimmutable and accessible by field names or indices, which might be useful: from collections import namedtuple def namedtuplefetchall ( cursor ): \"\"\" Return all rows from a cursor as a namedtuple. Assume the column names are unique. \"\"\" desc = cursor . description nt_result = namedtuple ( \"Result\" , [ col [ 0 ] for col in desc ]) return [ nt_result ( * row ) for row in cursor . fetchall ()] The dictfetchall() and namedtuplefetchall() examples assume unique\ncolumn names, since a cursor cannot distinguish columns from different tables. Here is an example of the difference between the three: >>> cursor . execute ( \"SELECT id, parent_id FROM test LIMIT 2\" ) >>> cursor . fetchall () ((54360982, None), (54360880, None)) >>> cursor . execute ( \"SELECT id, parent_id FROM test LIMIT 2\" ) >>> dictfetchall ( cursor ) [{'parent_id': None, 'id': 54360982}, {'parent_id': None, 'id': 54360880}] >>> cursor . execute ( \"SELECT id, parent_id FROM test LIMIT 2\" ) >>> results = namedtuplefetchall ( cursor ) >>> results [Result(id=54360982, parent_id=None), Result(id=54360880, parent_id=None)] >>> results [ 0 ] . id 54360982 >>> results [ 0 ][ 0 ] 54360982 Connections and cursors ¶ connection and cursor mostly implement the standard Python DB-API\ndescribed in PEP 249 — except when it comes to transaction handling . If you’re not familiar with the Python DB-API, note that the SQL statement in cursor.execute() uses placeholders, \"%s\" , rather than adding\nparameters directly within the SQL. If you use this technique, the underlying\ndatabase library will automatically escape your parameters as necessary. Also note that Django expects the \"%s\" placeholder, not the \"?\" placeholder, which is used by the SQLite Python bindings. This is for the sake\nof consistency and sanity. Using a cursor as a context manager: with connection . cursor () as c : c . execute ( ... ) is equivalent to: c = connection . cursor () try : c . execute ( ... ) finally : c . close () Calling stored procedures ¶ CursorWrapper. callproc ( procname , params = None , kparams = None ) ¶ Calls a database stored procedure with the given name. A sequence\n( params ) or dictionary ( kparams ) of input parameters may be\nprovided. Most databases don’t support kparams . Of Django’s built-in\nbackends, only Oracle supports it. For example, given this stored procedure in an Oracle database: CREATE PROCEDURE \"TEST_PROCEDURE\" ( v_i INTEGER , v_text NVARCHAR2 ( 10 )) AS p_i INTEGER ; p_text NVARCHAR2 ( 10 ); BEGIN p_i : = v_i ; p_text : = v_text ; ... END ; This will call it: with connection . cursor () as cursor : cursor . callproc ( \"test_procedure\" , [ 1 , \"test\" ])", "keywords": ["function", "examples", "rows", "result", "jones", "fielddoesnotexist", "sanity", "slicing", "number", "collections", "dictfetchall", "procedure", "error", "def", "django.db.connection", "lname", "code", "difference", "values", "consistency", "library", "string", "c", "i", "class", "example", "field", "#", "placeholders", "app", "func", "cursor.fetchall", "defer", "column", "mapping", "list", "namedtuple", "channels", "names", "orm", "desc", "connections", "abc", "databases", "age(birth_date", "cursorwrapper", "procedures", "fetchall", "database", "name_map", "table", "coercion", "input", "close", "models", "query", "test", "postgresql", "my_custom_sql", "datefield", "ways", "level", "jane", "types", "strings", "model", "words", "collections.namedtuple", "procname", "mycolumn=0", "django.db.connections", "insert", "label", "django", "=", "myapp", "cursor.execute(sql", "limit", "n’t", "nvarchar2", "results", "fields", "print", "engine", "set", "fetchone", "cursor.execute", "p", "bunch", "db", "create", "p_text", "my_db_alias", "select", "value", "tables", "sake", "raw", "namedtuplefetchall", "key)s", "case", "sequence", "columns", "data", "pep", "lookup", "underscore", "django.db.models.query", "use", "parent_id", "indexing", "technique", "backend", "placeholder", "cost", "person", "callproc", "layer", "tuple", "john", "first_name", "quotes", "type", "baz", "self", "people", "custom", "protection", "instance", "objects", "translations", "documentation", "lookups", "performance", "nt_result", "kparams", "end", "sqlite", "comparison", "matching", "delete", "handling", "rawqueryset", "order", "last_name", "params", "default", "bar", "user", "exploit", "attackers", "mistakes", "cases", "functions", "key", "alias", "annotations", "update", "typecasting", "attribute", "none", "option", "expression", "warning", "cursor.fetchone", "col", "percent", "time", "injection", "risk", "instances", "startapp", "bindings", "statement", "dict", "checking", "api", "person.objects.all", "support", "description", "object", ".raw", "connection", "cursor", "ages", "first_person", "context", "doe", "begin", "myapp_person", "import", "name", "birth_date", "charfield", "d", "signs", "mysql", "demand", "%", "sql", "dictionary", "call", "pk", ">", "backends", "row", "execute", "python", "manager.raw", "age", "bd", "interpolation", "s", "options", "queries", "index", "exception", "manager", "details", "method", "queryset", "integer", "django.db", "transaction", "argument", "appearances", "¶", "return", "calling", "test_procedure", "note", "parameters", "memory", "expressions", "attacks", "tools", "smith", "connection.cursor", "foo", "cursors", "oracle", "indices", "clauses", "result(id=54360982", "zip"], "type": "documentation"},
{"title": "View decorators | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/http/decorators/", "content": "View decorators ¶ Django provides several decorators that can be applied to views to support\nvarious HTTP features. See Decorating the class for how to use these decorators with\nclass-based views. Allowed HTTP methods ¶ The decorators in django.views.decorators.http can be used to restrict\naccess to views based on the request method. These decorators will return\na django.http.HttpResponseNotAllowed if the conditions are not met. require_http_methods ( request_method_list ) [source] ¶ Decorator to require that a view only accepts particular request\nmethods. Usage: from django.views.decorators.http import require_http_methods @require_http_methods ([ \"GET\" , \"POST\" ]) def my_view ( request ): # I can assume now that only GET or POST requests make it this far # ... pass Note that request methods should be in uppercase. Changed in Django 5.0: Support for wrapping asynchronous view functions was added. require_GET () ¶ Decorator to require that a view only accepts the GET method. Changed in Django 5.0: Support for wrapping asynchronous view functions was added. require_POST () ¶ Decorator to require that a view only accepts the POST method. Changed in Django 5.0: Support for wrapping asynchronous view functions was added. require_safe () ¶ Decorator to require that a view only accepts the GET and HEAD methods.\nThese methods are commonly considered “safe” because they should not have\nthe significance of taking an action other than retrieving the requested\nresource. Note Web servers should automatically strip the content of responses to HEAD\nrequests while leaving the headers unchanged, so you may handle HEAD\nrequests exactly like GET requests in your views. Since some software,\nsuch as link checkers, rely on HEAD requests, you might prefer\nusing require_safe instead of require_GET . Changed in Django 5.0: Support for wrapping asynchronous view functions was added. Conditional view processing ¶ The following decorators in django.views.decorators.http can be used to\ncontrol caching behavior on particular views. condition ( etag_func = None , last_modified_func = None ) [source] ¶ etag ( etag_func ) [source] ¶ last_modified ( last_modified_func ) [source] ¶ These decorators can be used to generate ETag and Last-Modified headers; see conditional view processing . Changed in Django 5.0: Support for wrapping asynchronous view functions was added. GZip compression ¶ The decorators in django.views.decorators.gzip control content\ncompression on a per-view basis. gzip_page () ¶ This decorator compresses content if the browser allows gzip compression.\nIt sets the Vary header accordingly, so that caches will base their\nstorage on the Accept-Encoding header. Changed in Django 5.0: Support for wrapping asynchronous view functions was added. Vary headers ¶ The decorators in django.views.decorators.vary can be used to control\ncaching based on specific request headers. vary_on_cookie ( func ) ¶ Changed in Django 5.0: Support for wrapping asynchronous view functions was added. vary_on_headers ( * headers ) [source] ¶ The Vary header defines which request headers a cache mechanism should take\ninto account when building its cache key. See using vary headers . Changed in Django 5.0: Support for wrapping asynchronous view functions was added. Caching ¶ The decorators in django.views.decorators.cache control server and\nclient-side caching. cache_control ( ** kwargs ) [source] ¶ This decorator patches the response’s Cache-Control header by adding\nall of the keyword arguments to it. See patch_cache_control() for the details of the\ntransformation. Changed in Django 5.0: Support for wrapping asynchronous view functions was added. never_cache ( view_func ) [source] ¶ This decorator adds an Expires header to the current date/time. This decorator adds a Cache-Control: max-age=0, no-cache, no-store, must-revalidate, private header to a response to indicate that a page\nshould never be cached. Each header is only added if it isn’t already set. Changed in Django 5.0: Support for wrapping asynchronous view functions was added. Common ¶ The decorators in django.views.decorators.common allow per-view\ncustomization of CommonMiddleware behavior. no_append_slash () [source] ¶ This decorator allows individual views to be excluded from APPEND_SLASH URL normalization. Changed in Django 5.0: Support for wrapping asynchronous view functions was added.", "keywords": ["django.views.decorators.cache", "views", "view", "store", "commonmiddleware", "control", "django.views.decorators.http", "storage", "headers", "url", "conditions", "etag_func", "patch_cache_control", "features", "require_http_methods", "behavior", "access", "django.http", "class", "link", "#", "gzip", "func", "vary_on_cookie", "request", "gzip_page", "view_func", "action", "*", "page", "cache", "checkers", "etag", "encoding", "usage", "condition", "django", "http", "vary", "=", "head", "django.views.decorators.gzip", "last_modified_func", "source", "browser", "software", "server", "expires", "arguments", "significance", "normalization", "compression", "processing", "kwargs", "defines", "customization", "functions", "key", "require_safe", "my_view", "django.views.decorators.common", "none", "mechanism", "decorator", "transformation", "age=0", "get", "time", "vary_on_headers", "basis", "caches", "date", "responses", "caching", "account", "support", "-", "import", "httpresponsenotallowed", "response", "header", "requests", "web", "servers", "uppercase", "methods", "keyword", "@require_http_methods", "resource", "accept", "client", "max", "details", "method", "decorators", "¶", "note", "post", "side", "content"], "type": "documentation"},
{"title": "Serializing Django objects | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/serialization/", "content": "Serializing Django objects ¶ Django’s serialization framework provides a mechanism for “translating” Django\nmodels into other formats. Usually these other formats will be text-based and\nused for sending Django data over a wire, but it’s possible for a\nserializer to handle any format (text-based or not). See also If you just want to get some data from your tables into a serialized\nform, you could use the dumpdata management command. Serializing data ¶ At the highest level, you can serialize data like this: from django.core import serializers data = serializers . serialize ( \"xml\" , SomeModel . objects . all ()) The arguments to the serialize function are the format to serialize the data\nto (see Serialization formats ) and a QuerySet to serialize. (Actually, the second\nargument can be any iterator that yields Django model instances, but it’ll\nalmost always be a QuerySet). django.core.serializers. get_serializer ( format ) ¶ You can also use a serializer object directly: XMLSerializer = serializers . get_serializer ( \"xml\" ) xml_serializer = XMLSerializer () xml_serializer . serialize ( queryset ) data = xml_serializer . getvalue () This is useful if you want to serialize data directly to a file-like object\n(which includes an HttpResponse ): with open ( \"file.xml\" , \"w\" ) as out : xml_serializer . serialize ( SomeModel . objects . all (), stream = out ) Note Calling get_serializer() with an unknown format will raise a django.core.serializers.SerializerDoesNotExist exception. Subset of fields ¶ If you only want a subset of fields to be serialized, you can\nspecify a fields argument to the serializer: from django.core import serializers data = serializers . serialize ( \"xml\" , SomeModel . objects . all (), fields = [ \"name\" , \"size\" ]) In this example, only the name and size attributes of each model will\nbe serialized. The primary key is always serialized as the pk element in the\nresulting output; it never appears in the fields part. Note Depending on your model, you may find that it is not possible to\ndeserialize a model that only serializes a subset of its fields. If a\nserialized object doesn’t specify all the fields that are required by a\nmodel, the deserializer will not be able to save deserialized instances. Inherited models ¶ If you have a model that is defined using an abstract base class , you don’t have to do anything special to serialize\nthat model. Call the serializer on the object (or objects) that you want to\nserialize, and the output will be a complete representation of the serialized\nobject. However, if you have a model that uses multi-table inheritance , you also need to serialize all of the base classes\nfor the model. This is because only the fields that are locally defined on the\nmodel will be serialized. For example, consider the following models: class Place ( models . Model ): name = models . CharField ( max_length = 50 ) class Restaurant ( Place ): serves_hot_dogs = models . BooleanField ( default = False ) If you only serialize the Restaurant model: data = serializers . serialize ( \"xml\" , Restaurant . objects . all ()) the fields on the serialized output will only contain the serves_hot_dogs attribute. The name attribute of the base class will be ignored. In order to fully serialize your Restaurant instances, you will need to\nserialize the Place models as well: all_objects = [ * Restaurant . objects . all (), * Place . objects . all ()] data = serializers . serialize ( \"xml\" , all_objects ) Deserializing data ¶ Deserializing data is very similar to serializing it: for obj in serializers . deserialize ( \"xml\" , data ): do_something_with ( obj ) As you can see, the deserialize function takes the same format argument as serialize , a string or stream of data, and returns an iterator. However, here it gets slightly complicated. The objects returned by the deserialize iterator aren’t regular Django objects. Instead, they are\nspecial DeserializedObject instances that wrap a created – but unsaved –\nobject and any associated relationship data. Calling DeserializedObject.save() saves the object to the database. Note If the pk attribute in the serialized data doesn’t exist or is\nnull, a new instance will be saved to the database. This ensures that deserializing is a non-destructive operation even if the\ndata in your serialized representation doesn’t match what’s currently in the\ndatabase. Usually, working with these DeserializedObject instances looks\nsomething like: for deserialized_object in serializers . deserialize ( \"xml\" , data ): if object_should_be_saved ( deserialized_object ): deserialized_object . save () In other words, the usual use is to examine the deserialized objects to make\nsure that they are “appropriate” for saving before doing so. If you trust your\ndata source you can instead save the object directly and move on. The Django object itself can be inspected as deserialized_object.object .\nIf fields in the serialized data do not exist on a model, a DeserializationError will be raised unless the ignorenonexistent argument is passed in as True : serializers . deserialize ( \"xml\" , data , ignorenonexistent = True ) Serialization formats ¶ Django supports a number of serialization formats, some of which require you\nto install third-party Python modules: Identifier Information xml Serializes to and from a simple XML dialect. json Serializes to and from JSON . jsonl Serializes to and from JSONL . yaml Serializes to YAML (YAML Ain’t a Markup Language). This\nserializer is only available if PyYAML is installed. XML ¶ The basic XML serialization format looks like this: <?xml version=\"1.0\" encoding=\"utf-8\"?> <django-objects version= \"1.0\" > <object pk= \"123\" model= \"sessions.session\" > <field type= \"DateTimeField\" name= \"expire_date\" > 2013-01-16T08:16:59.844560+00:00 </field> <!-- ... --> </object> </django-objects> The whole collection of objects that is either serialized or deserialized is\nrepresented by a <django-objects> -tag which contains multiple <object> -elements. Each such object has two attributes: “pk” and “model”,\nthe latter being represented by the name of the app (“sessions”) and the\nlowercase name of the model (“session”) separated by a dot. Each field of the object is serialized as a <field> -element sporting the\nfields “type” and “name”. The text content of the element represents the value\nthat should be stored. Foreign keys and other relational fields are treated a little bit differently: <object pk= \"27\" model= \"auth.permission\" > <!-- ... --> <field to= \"contenttypes.contenttype\" name= \"content_type\" rel= \"ManyToOneRel\" > 9 </field> <!-- ... --> </object> In this example we specify that the auth.Permission object with the PK 27\nhas a foreign key to the contenttypes.ContentType instance with the PK 9. ManyToMany-relations are exported for the model that binds them. For instance,\nthe auth.User model has such a relation to the auth.Permission model: <object pk= \"1\" model= \"auth.user\" > <!-- ... --> <field to= \"auth.permission\" name= \"user_permissions\" rel= \"ManyToManyRel\" > <object pk= \"46\" ></object> <object pk= \"47\" ></object> </field> </object> This example links the given user with the permission models with PKs 46 and 47. Control characters If the content to be serialized contains control characters that are not\naccepted in the XML 1.0 standard, the serialization will fail with a ValueError exception. Read also the W3C’s explanation of HTML,\nXHTML, XML and Control Codes . JSON ¶ When staying with the same example data as before it would be serialized as\nJSON in the following way: [ { \"pk\" : \"4b678b301dfd8a4e0dad910de3ae245b\" , \"model\" : \"sessions.session\" , \"fields\" : { \"expire_date\" : \"2013-01-16T08:16:59.844Z\" , # ... }, } ] The formatting here is a bit simpler than with XML. The whole collection\nis just represented as an array and the objects are represented by JSON objects\nwith three properties: “pk”, “model” and “fields”. “fields” is again an object\ncontaining each field’s name and value as property and property-value\nrespectively. Foreign keys have the PK of the linked object as property value.\nManyToMany-relations are serialized for the model that defines them and are\nrepresented as a list of PKs. Be aware that not all Django output can be passed unmodified to json .\nFor example, if you have some custom type in an object to be serialized, you’ll\nhave to write a custom json encoder for it. Something like this will\nwork: from django.core.serializers.json import DjangoJSONEncoder class LazyEncoder ( DjangoJSONEncoder ): def default ( self , obj ): if isinstance ( obj , YourCustomType ): return str ( obj ) return super () . default ( obj ) You can then pass cls=LazyEncoder to the serializers.serialize() function: from django.core.serializers import serialize serialize ( \"json\" , SomeModel . objects . all (), cls = LazyEncoder ) Also note that GeoDjango provides a customized GeoJSON serializer . DjangoJSONEncoder ¶ class django.core.serializers.json. DjangoJSONEncoder ¶ The JSON serializer uses DjangoJSONEncoder for encoding. A subclass of JSONEncoder , it handles these additional types: datetime A string of the form YYYY-MM-DDTHH:mm:ss.sssZ or YYYY-MM-DDTHH:mm:ss.sss+HH:MM as defined in ECMA-262 . date A string of the form YYYY-MM-DD as defined in ECMA-262 . time A string of the form HH:MM:ss.sss as defined in ECMA-262 . timedelta A string representing a duration as defined in ISO-8601. For example, timedelta(days=1, hours=2, seconds=3.4) is represented as 'P1DT02H00M03.400000S' . Decimal , Promise ( django.utils.functional.lazy() objects), UUID A string representation of the object. JSONL ¶ JSONL stands for JSON Lines . With this format, objects are separated by new\nlines, and each line contains a valid JSON object. JSONL serialized data looks\nlike this: { \"pk\" : \"4b678b301dfd8a4e0dad910de3ae245b\" , \"model\" : \"sessions.session\" , \"fields\" : { ... }} { \"pk\" : \"88bea72c02274f3c9bf1cb2bb8cee4fc\" , \"model\" : \"sessions.session\" , \"fields\" : { ... }} { \"pk\" : \"9cf0e26691b64147a67e2a9f06ad7a53\" , \"model\" : \"sessions.session\" , \"fields\" : { ... }} JSONL can be useful for populating large databases, since the data can be\nprocessed line by line, rather than being loaded into memory all at once. YAML ¶ YAML serialization looks quite similar to JSON. The object list is serialized\nas a sequence mappings with the keys “pk”, “model” and “fields”. Each field is\nagain a mapping with the key being name of the field and the value the value: - model : sessions.session pk : 4b678b301dfd8a4e0dad910de3ae245b fields : expire_date : 2013-01-16 08:16:59.844560+00:00 Referential fields are again represented by the PK or sequence of PKs. Natural keys ¶ The default serialization strategy for foreign keys and many-to-many relations\nis to serialize the value of the primary key(s) of the objects in the relation.\nThis strategy works well for most objects, but it can cause difficulty in some\ncircumstances. Consider the case of a list of objects that have a foreign key referencing ContentType . If you’re going to\nserialize an object that refers to a content type, then you need to have a way\nto refer to that content type to begin with. Since ContentType objects are\nautomatically created by Django during the database synchronization process,\nthe primary key of a given content type isn’t easy to predict; it will\ndepend on how and when migrate was executed. This is true for all\nmodels which automatically generate objects, notably including Permission , Group , and User . Warning You should never include automatically generated objects in a fixture or\nother serialized data. By chance, the primary keys in the fixture\nmay match those in the database and loading the fixture will\nhave no effect. In the more likely case that they don’t match, the fixture\nloading will fail with an IntegrityError . There is also the matter of convenience. An integer id isn’t always\nthe most convenient way to refer to an object; sometimes, a\nmore natural reference would be helpful. It is for these reasons that Django provides natural keys . A natural\nkey is a tuple of values that can be used to uniquely identify an\nobject instance without using the primary key value. Deserialization of natural keys ¶ Consider the following two models: from django.db import models class Person ( models . Model ): first_name = models . CharField ( max_length = 100 ) last_name = models . CharField ( max_length = 100 ) birthdate = models . DateField () class Meta : constraints = [ models . UniqueConstraint ( fields = [ \"first_name\" , \"last_name\" ], name = \"unique_first_last_name\" , ), ] class Book ( models . Model ): name = models . CharField ( max_length = 100 ) author = models . ForeignKey ( Person , on_delete = models . CASCADE ) Ordinarily, serialized data for Book would use an integer to refer to\nthe author. For example, in JSON, a Book might be serialized as: ... { \"pk\" : 1 , \"model\" : \"store.book\" , \"fields\" : { \"name\" : \"Mostly Harmless\" , \"author\" : 42 }} ... This isn’t a particularly natural way to refer to an author. It\nrequires that you know the primary key value for the author; it also\nrequires that this primary key value is stable and predictable. However, if we add natural key handling to Person, the fixture becomes\nmuch more humane. To add natural key handling, you define a default\nManager for Person with a get_by_natural_key() method. In the case\nof a Person, a good natural key might be the pair of first and last\nname: from django.db import models class PersonManager ( models . Manager ): def get_by_natural_key ( self , first_name , last_name ): return self . get ( first_name = first_name , last_name = last_name ) class Person ( models . Model ): first_name = models . CharField ( max_length = 100 ) last_name = models . CharField ( max_length = 100 ) birthdate = models . DateField () objects = PersonManager () class Meta : constraints = [ models . UniqueConstraint ( fields = [ \"first_name\" , \"last_name\" ], name = \"unique_first_last_name\" , ), ] Now books can use that natural key to refer to Person objects: ... { \"pk\" : 1 , \"model\" : \"store.book\" , \"fields\" : { \"name\" : \"Mostly Harmless\" , \"author\" : [ \"Douglas\" , \"Adams\" ]}, } ... When you try to load this serialized data, Django will use the get_by_natural_key() method to resolve [\"Douglas\", \"Adams\"] into the primary key of an actual Person object. Note Whatever fields you use for a natural key must be able to uniquely\nidentify an object. This will usually mean that your model will\nhave a uniqueness clause (either unique=True on a single field, or a UniqueConstraint or unique_together over multiple fields) for the\nfield or fields in your natural key. However, uniqueness doesn’t need to be\nenforced at the database level. If you are certain that a set of fields\nwill be effectively unique, you can still use those fields as a natural\nkey. Deserialization of objects with no primary key will always check whether the\nmodel’s manager has a get_by_natural_key() method and if so, use it to\npopulate the deserialized object’s primary key. Serialization of natural keys ¶ So how do you get Django to emit a natural key when serializing an object?\nFirstly, you need to add another method – this time to the model itself: class Person ( models . Model ): first_name = models . CharField ( max_length = 100 ) last_name = models . CharField ( max_length = 100 ) birthdate = models . DateField () objects = PersonManager () class Meta : constraints = [ models . UniqueConstraint ( fields = [ \"first_name\" , \"last_name\" ], name = \"unique_first_last_name\" , ), ] def natural_key ( self ): return ( self . first_name , self . last_name ) That method should always return a natural key tuple – in this\nexample, (first name, last name) . Then, when you call serializers.serialize() , you provide use_natural_foreign_keys=True or use_natural_primary_keys=True arguments: >>> serializers . serialize ( ... \"json\" , ... [ book1 , book2 ], ... indent = 2 , ... use_natural_foreign_keys = True , ... use_natural_primary_keys = True , ... ) When use_natural_foreign_keys=True is specified, Django will use the natural_key() method to serialize any foreign key reference to objects\nof the type that defines the method. When use_natural_primary_keys=True is specified, Django will not provide the\nprimary key in the serialized data of this object since it can be calculated\nduring deserialization: ... { \"model\" : \"store.person\" , \"fields\" : { \"first_name\" : \"Douglas\" , \"last_name\" : \"Adams\" , \"birth_date\" : \"1952-03-11\" , }, } ... This can be useful when you need to load serialized data into an existing\ndatabase and you cannot guarantee that the serialized primary key value is not\nalready in use, and do not need to ensure that deserialized objects retain the\nsame primary keys. If you are using dumpdata to generate serialized data, use the dumpdata --natural-foreign and dumpdata --natural-primary command line flags to generate natural keys. Note You don’t need to define both natural_key() and get_by_natural_key() . If you don’t want Django to output\nnatural keys during serialization, but you want to retain the\nability to load natural keys, then you can opt to not implement\nthe natural_key() method. Conversely, if (for some strange reason) you want Django to output\nnatural keys during serialization, but not be able to load those\nkey values, just don’t define the get_by_natural_key() method. Natural keys and forward references ¶ Sometimes when you use natural foreign keys you’ll need to deserialize data where\nan object has a foreign key referencing another object that hasn’t yet been\ndeserialized. This is called a “forward reference”. For instance, suppose you have the following objects in your fixture: ... { \"model\" : \"store.book\" , \"fields\" : { \"name\" : \"Mostly Harmless\" , \"author\" : [ \"Douglas\" , \"Adams\" ]}, }, ... { \"model\" : \"store.person\" , \"fields\" : { \"first_name\" : \"Douglas\" , \"last_name\" : \"Adams\" }}, ... In order to handle this situation, you need to pass handle_forward_references=True to serializers.deserialize() . This will\nset the deferred_fields attribute on the DeserializedObject instances.\nYou’ll need to keep track of DeserializedObject instances where this\nattribute isn’t None and later call save_deferred_fields() on them. Typical usage looks like this: objs_with_deferred_fields = [] for obj in serializers . deserialize ( \"xml\" , data , handle_forward_references = True ): obj . save () if obj . deferred_fields is not None : objs_with_deferred_fields . append ( obj ) for obj in objs_with_deferred_fields : obj . save_deferred_fields () For this to work, the ForeignKey on the referencing model must have null=True . Dependencies during serialization ¶ It’s often possible to avoid explicitly having to handle forward references by\ntaking care with the ordering of objects within a fixture. To help with this, calls to dumpdata that use the dumpdata --natural-foreign option will serialize any model with a natural_key() method before serializing standard primary key objects. However, this may not always be enough. If your natural key refers to\nanother object (by using a foreign key or natural key to another object\nas part of a natural key), then you need to be able to ensure that\nthe objects on which a natural key depends occur in the serialized data\nbefore the natural key requires them. To control this ordering, you can define dependencies on your natural_key() methods. You do this by setting a dependencies attribute on the natural_key() method itself. For example, let’s add a natural key to the Book model from the\nexample above: class Book ( models . Model ): name = models . CharField ( max_length = 100 ) author = models . ForeignKey ( Person , on_delete = models . CASCADE ) def natural_key ( self ): return ( self . name ,) + self . author . natural_key () The natural key for a Book is a combination of its name and its\nauthor. This means that Person must be serialized before Book .\nTo define this dependency, we add one extra line: def natural_key ( self ): return ( self . name ,) + self . author . natural_key () natural_key . dependencies = [ \"example_app.person\" ] This definition ensures that all Person objects are serialized before\nany Book objects. In turn, any object referencing Book will be\nserialized after both Person and Book have been serialized.", "keywords": ["function", "birthdate", "ignorenonexistent", "being", "use_natural_foreign_keys", "iso-8601", "pyyaml", "uuid", "-elements", "control", "--natural", "serialize", "isinstance", "number", "manytomanyrel", "serializer", "version=\"1.0", "decimal", "definition", "relational", "relations", "def", "store.person", "values", "deserializedobject", "auth", "somemodel", "deserialization", "contenttypes.contenttype", "string", "array", "user_permissions", "class", "example", "field", "<", "#", "app", "django.core", "cls", "i", "group", "relation", "clause", "example_app.person", "serialization", "geojson", "list", "auth.user", "mapping", "sessions.session", "databases", "unique_together", "xmlserializer", "+", "deserializedobject.save", "formatting", "hh", "django.core.serializers", "referencing", "database", "9cf0e26691b64147a67e2a9f06ad7a53", "output", "douglas", "representation", "ss.sss+hh", "depends", "language", "*", "models", "lines", "wire", "httpresponse", "subset", "datefield", "migrate", "level", "json", "yaml", "types", "get_serializer", "deserializer", "rel=", "model", "words", "loading", "seconds=3.4", "subclass", "reasons", "place", "xhtml", "jsonl", "element", "xml_serializer", "serves_hot_dogs", "pair", "get_by_natural_key", "usage", "attributes", "django", "xml", "deserialize", "=", "ability", "n’t", "max_length", "fields", "stream", "dumpdata", "set", "relationship", "lowercase", "book", "track", "deserialized_object", "circumstances", "value", "tables", "adams", "line", "bit", "django.utils.functional.lazy", "codes", "uniqueconstraint", "source", "content_type", "harmless", "keys", "contenttype", "case", "sequence", "append", "data", "process", "use", "w", "base", "pks", "django.core.serializers.json", "html", "name=", "collection", "person", "encoding=\"utf-8", "difficulty", "tuple", "personmanager", "str", "store.book", "save_deferred_fields", "arguments", "identifier", "auth.permission", "first_name", "uniqueness", "type", "88bea72c02274f3c9bf1cb2bb8cee4fc", "author", "explanation", "serializers", "self", "ss.sss", "instance", "custom", "objects", "all_objects", "file", "ecma-262", "handling", "work", "operation", "order", "modules", "last_name", "default", "standard", "strategy", "serializers.serialize", "user", "contenttypes", "markup", "key", "do_something_with", "natural_key", "synchronization", "form", "attribute", "manytoonerel", "key(s", "deferred_fields", "mechanism", "properties", "format", "none", "classes", "characters", "expire_date", "size", "option", "meta", "constraints", "):", "mm", "time", "reason", "framework", "save", "date", "instances", "pk=", "timedelta(days=1", "fixture", "dd", "booleanfield", "care", "sessions", "part", "convenience", "dependency", "references", "object", "yyyy", "-", "lazyencoder", "deserializing", "valueerror", "iterator", "permission", "import", "name", "birth_date", "charfield", "dot", "d", "combination", "management", "mappings", "pk", "-element", "ss.sssz", "deserialized_object.object", "way", "foreignkey", "formats", "information", "reference", "flags", "python", "chance", "methods", "book1", "w3c", "djangojsonencoder", "dialect", "serializerdoesnotexist", "matter", "books", "exception", "ordering", "use_natural_primary_keys", "promise", "manager", "party", "geodjango", "queryset", "method", "integer", "handle_forward_references", "session", "django.db", "objs_with_deferred_fields", "argument", "integrityerror", "¶", "obj", "command", "return", "refers", "turn", "getvalue", "note", "yourcustomtype", "memory", "manytomany", "effect", "indent", "situation", "duration", "inheritance", "restaurant", "encoder", "property", "deserializationerror", "ddthh", "jsonencoder", "text", "dependencies", "content", "datetimefield"], "type": "documentation"},
{"title": "Django settings | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/settings/", "content": "Django settings ¶ A Django settings file contains all the configuration of your Django\ninstallation. This document explains how settings work and which settings are\navailable. The basics ¶ A settings file is just a Python module with module-level variables. Here are a couple of example settings: ALLOWED_HOSTS = [ \"www.example.com\" ] DEBUG = False DEFAULT_FROM_EMAIL = \"webmaster@example.com\" Note If you set DEBUG to False , you also need to properly set\nthe ALLOWED_HOSTS setting. Because a settings file is a Python module, the following apply: It doesn’t allow for Python syntax errors. It can assign settings dynamically using normal Python syntax.\nFor example: MY_SETTING = [ str ( i ) for i in range ( 30 )] It can import values from other settings files. Designating the settings ¶ DJANGO_SETTINGS_MODULE ¶ When you use Django, you have to tell it which settings you’re using. Do this\nby using an environment variable, DJANGO_SETTINGS_MODULE . The value of DJANGO_SETTINGS_MODULE should be in Python path syntax,\ne.g. mysite.settings . Note that the settings module should be on the\nPython sys.path . The django-admin utility ¶ When using django-admin , you can either set the\nenvironment variable once, or explicitly pass in the settings module each time\nyou run the utility. Example (Unix Bash shell): export DJANGO_SETTINGS_MODULE = mysite.settings\ndjango-admin runserver Example (Windows shell): set DJANGO_SETTINGS_MODULE=mysite.settings django-admin runserver Use the --settings command-line argument to specify the settings manually: django-admin runserver --settings = mysite.settings On the server ( mod_wsgi ) ¶ In your live server environment, you’ll need to tell your WSGI\napplication what settings file to use. Do that with os.environ : import os os . environ [ \"DJANGO_SETTINGS_MODULE\" ] = \"mysite.settings\" Read the Django mod_wsgi documentation for more information and other common\nelements to a Django WSGI application. Default settings ¶ A Django settings file doesn’t have to define any settings if it doesn’t need\nto. Each setting has a sensible default value. These defaults live in the\nmodule django/conf/global_settings.py . Here’s the algorithm Django uses in compiling settings: Load settings from global_settings.py . Load settings from the specified settings file, overriding the global\nsettings as necessary. Note that a settings file should not import from global_settings , because\nthat’s redundant. Seeing which settings you’ve changed ¶ The command python manage.py diffsettings displays differences between the\ncurrent settings file and Django’s default settings. For more, see the diffsettings documentation. Using settings in Python code ¶ In your Django apps, use settings by importing the object django.conf.settings . Example: from django.conf import settings if settings . DEBUG : # Do something ... Note that django.conf.settings isn’t a module – it’s an object. So\nimporting individual settings is not possible: from django.conf.settings import DEBUG # This won't work. Also note that your code should not import from either global_settings or\nyour own settings file. django.conf.settings abstracts the concepts of\ndefault settings and site-specific settings; it presents a single interface.\nIt also decouples the code that uses settings from the location of your\nsettings. Altering settings at runtime ¶ You shouldn’t alter settings in your applications at runtime. For example,\ndon’t do this in a view: from django.conf import settings settings . DEBUG = True # Don't do this! The only place you should assign to settings is in a settings file. Security ¶ Because a settings file contains sensitive information, such as the database\npassword, you should make every attempt to limit access to it. For example,\nchange its file permissions so that only you and your web server’s user can\nread it. This is especially important in a shared-hosting environment. Available settings ¶ For a full list of available settings, see the settings reference . Creating your own settings ¶ There’s nothing stopping you from creating your own settings, for your own\nDjango apps, but follow these guidelines: Setting names must be all uppercase. Don’t reinvent an already-existing setting. For settings that are sequences, Django itself uses lists, but this is only\na convention. Using settings without setting DJANGO_SETTINGS_MODULE ¶ In some cases, you might want to bypass the DJANGO_SETTINGS_MODULE environment variable. For example, if you’re using the template system by\nitself, you likely don’t want to have to set up an environment variable\npointing to a settings module. In these cases, you can configure Django’s settings manually. Do this by\ncalling: django.conf.settings. configure ( default_settings , ** settings ) ¶ Example: from django.conf import settings settings . configure ( DEBUG = True ) Pass configure() as many keyword arguments as you’d like, with each keyword\nargument representing a setting and its value. Each argument name should be all\nuppercase, with the same name as the settings described above. If a particular\nsetting is not passed to configure() and is needed at some later point,\nDjango will use the default setting value. Configuring Django in this fashion is mostly necessary – and, indeed,\nrecommended – when you’re using a piece of the framework inside a larger\napplication. Consequently, when configured via settings.configure() , Django will not\nmake any modifications to the process environment variables (see the\ndocumentation of TIME_ZONE for why this would normally occur). It’s\nassumed that you’re already in full control of your environment in these\ncases. Custom default settings ¶ If you’d like default values to come from somewhere other than django.conf.global_settings , you can pass in a module or class that\nprovides the default settings as the default_settings argument (or as the\nfirst positional argument) in the call to configure() . In this example, default settings are taken from myapp_defaults , and the DEBUG setting is set to True , regardless of its value in myapp_defaults : from django.conf import settings from myapp import myapp_defaults settings . configure ( default_settings = myapp_defaults , DEBUG = True ) The following example, which uses myapp_defaults as a positional argument,\nis equivalent: settings . configure ( myapp_defaults , DEBUG = True ) Normally, you will not need to override the defaults in this fashion. The\nDjango defaults are sufficiently tame that you can safely use them. Be aware\nthat if you do pass in a new default module, it entirely replaces the Django\ndefaults, so you must specify a value for every possible setting that might be\nused in the code you are importing. Check in django.conf.settings.global_settings for the full list. Either configure() or DJANGO_SETTINGS_MODULE is required ¶ If you’re not setting the DJANGO_SETTINGS_MODULE environment\nvariable, you must call configure() at some point before using any code\nthat reads settings. If you don’t set DJANGO_SETTINGS_MODULE and don’t call configure() , Django will raise an ImportError exception the first time\na setting is accessed. If you set DJANGO_SETTINGS_MODULE , access settings values somehow, then call configure() , Django will raise a RuntimeError indicating\nthat settings have already been configured. There is a property for this\npurpose: django.conf.settings. configured ¶ For example: from django.conf import settings if not settings . configured : settings . configure ( myapp_defaults , DEBUG = True ) Also, it’s an error to call configure() more than once, or to call configure() after any setting has been accessed. It boils down to this: Use exactly one of either configure() or DJANGO_SETTINGS_MODULE . Not both, and not neither. Calling django.setup() is required for “standalone” Django usage ¶ If you’re using components of Django “standalone” – for example, writing a\nPython script which loads some Django templates and renders them, or uses the\nORM to fetch some data – there’s one more step you’ll need in addition to\nconfiguring settings. After you’ve either set DJANGO_SETTINGS_MODULE or called configure() , you’ll need to call django.setup() to load your\nsettings and populate Django’s application registry. For example: import django from django.conf import settings from myapp import myapp_defaults settings . configure ( default_settings = myapp_defaults , DEBUG = True ) django . setup () # Now this script or any imported module can use any part of Django it needs. from myapp import models Note that calling django.setup() is only necessary if your code is truly\nstandalone. When invoked by your web server, or through django-admin , Django will handle this for you. django.setup() may only be called once. Therefore, avoid putting reusable application logic in standalone scripts\nso that you have to import from the script elsewhere in your application.\nIf you can’t avoid that, put the call to django.setup() inside an if block: if __name__ == \"__main__\" : import django django . setup () See also The Settings Reference Contains the complete list of core and contrib app settings.", "keywords": ["view", "control", "default_settings", "permissions", "guidelines", "error", "module", "fashion", "code", "point", "values", "algorithm", "site", "false", "i", "access", "example", "lists", "#", "class", "windows", "myapp_defaults", "addition", "_", "app", "unix", "list", "bash", "configure", "names", "orm", "settings.configure", "runserver", "django_settings_module", "export", "global_settings", "--settings", "database", "importerror", "block", "location", "range", "*", "models", "level", "elements", "variable", "admin", "place", "scripts", "application", "sequences", "registry", "django", "wsgi", "configuration", "=", "myapp", "script", "n’t", "differences", "step", "django.conf.settings.global_settings", "altering", "global_settings.py", "installation", "webmaster@example.com", "shell", "syntax", "pointing", "setup", "value", "mod_wsgi", "line", "concepts", "basics", "django.setup", "data", "process", "debug", "runtime", "mysite.settings", "errors", "environment", "server", "str", "apply", "arguments", "standalone", "security", "django.conf.settings", "custom", "documentation", "diffsettings", "file", "contrib", "core", "interface", "default", "user", "path", "os.environ", "cases", "modifications", "my_setting", "runtimeerror", "environ", "time", "convention", "framework", "allowed_hosts", "setting", "true", "components", "part", "django.conf.global_settings", "object", "document", "load", "attempt", "-", "couple", "password", "logic", "files", "import", "name", "template", "sys.path", "utility", "defaults", "call", "information", "reference", "web", "python", "uppercase", "keyword", "exception", "purpose", "variables", "settings", "argument", "piece", "¶", "calling", "command", "note", "applications", "system", "apps", "property", "conf"], "type": "documentation"},
{"title": "PostgreSQL specific model indexes | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/indexes/", "content": "PostgreSQL specific model indexes ¶ The following are PostgreSQL specific indexes available from the django.contrib.postgres.indexes module. BloomIndex ¶ class BloomIndex ( * expressions , length = None , columns = () , ** options ) [source] ¶ Creates a bloom index. To use this index access you need to activate the bloom extension on\nPostgreSQL. You can install it using the BloomExtension migration\noperation. Provide an integer number of bits from 1 to 4096 to the length parameter to specify the length of each index entry. PostgreSQL’s default\nis 80. The columns argument takes a tuple or list of up to 32 values that are\ninteger number of bits from 1 to 4095. BrinIndex ¶ class BrinIndex ( * expressions , autosummarize = None , pages_per_range = None , ** options ) [source] ¶ Creates a BRIN index . Set the autosummarize parameter to True to enable automatic\nsummarization to be performed by autovacuum. The pages_per_range argument takes a positive integer. BTreeIndex ¶ class BTreeIndex ( * expressions , fillfactor = None , deduplicate_items = None , ** options ) [source] ¶ Creates a B-Tree index. Provide an integer value from 10 to 100 to the fillfactor parameter to\ntune how packed the index pages will be. PostgreSQL’s default is 90. Provide a boolean value to the deduplicate_items parameter to control\nwhether deduplication is enabled. PostgreSQL enables deduplication by\ndefault. Changed in Django 5.1: The deduplicate_items parameter was added. GinIndex ¶ class GinIndex ( * expressions , fastupdate = None , gin_pending_list_limit = None , ** options ) [source] ¶ Creates a gin index . To use this index on data types not in the built-in operator classes ,\nyou need to activate the btree_gin extension on\nPostgreSQL. You can install it using the BtreeGinExtension migration\noperation. Set the fastupdate parameter to False to disable the GIN Fast\nUpdate Technique that’s enabled by default in PostgreSQL. Provide an integer number of kilobytes to the gin_pending_list_limit parameter to tune the maximum size of the GIN pending list which is used\nwhen fastupdate is enabled. GistIndex ¶ class GistIndex ( * expressions , buffering = None , fillfactor = None , ** options ) [source] ¶ Creates a GiST index . These indexes are\nautomatically created on spatial fields with spatial_index=True . They’re\nalso useful on other types, such as HStoreField or the range\nfields . To use this index on data types not in the built-in gist operator classes ,\nyou need to activate the btree_gist extension on PostgreSQL.\nYou can install it using the BtreeGistExtension migration\noperation. Set the buffering parameter to True or False to manually enable\nor disable buffering build of the index. Provide an integer value from 10 to 100 to the fillfactor parameter to\ntune how packed the index pages will be. PostgreSQL’s default is 90. HashIndex ¶ class HashIndex ( * expressions , fillfactor = None , ** options ) [source] ¶ Creates a hash index. Provide an integer value from 10 to 100 to the fillfactor parameter to\ntune how packed the index pages will be. PostgreSQL’s default is 90. SpGistIndex ¶ class SpGistIndex ( * expressions , fillfactor = None , ** options ) [source] ¶ Creates an SP-GiST index . Provide an integer value from 10 to 100 to the fillfactor parameter to\ntune how packed the index pages will be. PostgreSQL’s default is 90. OpClass() expressions ¶ class OpClass ( expression , name ) [source] ¶ An OpClass() expression represents the expression with a custom operator class that can be used to define functional indexes, functional\nunique constraints, or exclusion constraints. To use it, you need to add 'django.contrib.postgres' in your INSTALLED_APPS . Set the name parameter to the name of the operator class . For example: Index ( OpClass ( Lower ( \"username\" ), name = \"varchar_pattern_ops\" ), name = \"lower_username_idx\" , ) creates an index on Lower('username') using varchar_pattern_ops . UniqueConstraint ( OpClass ( Upper ( \"description\" ), name = \"text_pattern_ops\" ), name = \"upper_description_unique\" , ) creates a unique constraint on Upper('description') using text_pattern_ops . ExclusionConstraint ( name = \"exclude_overlapping_ops\" , expressions = [ ( OpClass ( \"circle\" , name = \"circle_ops\" ), RangeOperators . OVERLAPS ), ], ) creates an exclusion constraint on circle using circle_ops .", "keywords": ["circle", "upper_description_unique", "username", "indexes", "number", "tree", "module", "b", "values", "pages", "false", "access", "class", "migration", "example", "list", "summarization", "brinindex", "pages_per_range", "bits", "lower", "range", "*", "postgresql", "types", "bloomextension", "model", "buffering", "rangeoperators", "django", "hash", "=", "fields", "entry", "gist", "text_pattern_ops", "btree_gist", "value", "spgistindex", "uniqueconstraint", "source", "exclusionconstraint", "columns", "length", "data", "technique", "brin", "ginindex", "tuple", "varchar_pattern_ops", "custom", "gin", "constraint", "lower_username_idx", "deduplication", "extension", "operation", "exclusion", "default", "sp", "btreeginextension", "build", "upper", "update", "none", "classes", "expression", "size", "opclass", "constraints", "bloomindex", "fillfactor", "exclude_overlapping_ops", "django.contrib.postgres.indexes", "true", "gistindex", "lower('username", "hstorefield", "installed_apps", "description", "bloom", "upper('description", "deduplicate_items", "name", "hashindex", "parameter", "kilobytes", "django.contrib.postgres", "options", "index", "autovacuum", "fastupdate", "integer", "argument", "¶", "operator", "expressions", "btreeindex", "btreegistextension", "circle_ops", "spatial_index"], "type": "documentation"},
{"title": "Translation | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/i18n/translation/", "content": "Translation ¶ Overview ¶ In order to make a Django project translatable, you have to add a minimal\nnumber of hooks to your Python code and templates. These hooks are called translation strings . They tell Django: “This text\nshould be translated into the end user’s language, if a translation for this\ntext is available in that language.” It’s your responsibility to mark\ntranslatable strings; the system can only translate strings it knows about. Django then provides utilities to extract the translation strings into a message file . This file is a convenient way for translators to provide\nthe equivalent of the translation strings in the target language. Once the\ntranslators have filled in the message file, it must be compiled. This process\nrelies on the GNU gettext toolset. Once this is done, Django takes care of translating web apps on the fly in each\navailable language, according to users’ language preferences. Django’s internationalization hooks are on by default, and that means there’s a\nbit of i18n-related overhead in certain places of the framework. If you don’t\nuse internationalization, you should take the two seconds to set USE_I18N = False in your settings file. Then Django will\nmake some optimizations so as not to load the internationalization machinery. Note Make sure you’ve activated translation for your project (the fastest way is\nto check if MIDDLEWARE includes django.middleware.locale.LocaleMiddleware ). If you haven’t yet,\nsee How Django discovers language preference . Internationalization: in Python code ¶ Standard translation ¶ Specify a translation string by using the function gettext() . It’s convention to import this\nas a shorter alias, _ , to save typing. Note Python’s standard library gettext module installs _() into the\nglobal namespace, as an alias for gettext() . In Django, we have chosen\nnot to follow this practice, for a couple of reasons: Sometimes, you should use gettext_lazy() as the default translation method for a particular file. Without _() in the global namespace, the developer has to think about which is the\nmost appropriate translation function. The underscore character ( _ ) is used to represent “the previous\nresult” in Python’s interactive shell and doctest tests. Installing a\nglobal _() function causes interference. Explicitly importing gettext() as _() avoids this problem. What functions may be aliased as _ ? Because of how xgettext (used by makemessages ) works, only\nfunctions that take a single string argument can be imported as _ : gettext() gettext_lazy() In this example, the text \"Welcome to my site.\" is marked as a translation\nstring: from django.http import HttpResponse from django.utils.translation import gettext as _ def my_view ( request ): output = _ ( \"Welcome to my site.\" ) return HttpResponse ( output ) You could code this without using the alias. This example is identical to the\nprevious one: from django.http import HttpResponse from django.utils.translation import gettext def my_view ( request ): output = gettext ( \"Welcome to my site.\" ) return HttpResponse ( output ) Translation works on computed values. This example is identical to the previous\ntwo: def my_view ( request ): words = [ \"Welcome\" , \"to\" , \"my\" , \"site.\" ] output = _ ( \" \" . join ( words )) return HttpResponse ( output ) Translation works on variables. Again, here’s an identical example: def my_view ( request ): sentence = \"Welcome to my site.\" output = _ ( sentence ) return HttpResponse ( output ) (The caveat with using variables or computed values, as in the previous two\nexamples, is that Django’s translation-string-detecting utility, django-admin makemessages , won’t be able to find\nthese strings. More on makemessages later.) The strings you pass to _() or gettext() can take placeholders,\nspecified with Python’s standard named-string interpolation syntax. Example: def my_view ( request , m , d ): output = _ ( \"Today is %(month)s %(day)s .\" ) % { \"month\" : m , \"day\" : d } return HttpResponse ( output ) This technique lets language-specific translations reorder the placeholder\ntext. For example, an English translation may be \"Today is November 26.\" ,\nwhile a Spanish translation may be \"Hoy es 26 de noviembre.\" – with the\nmonth and the day placeholders swapped. For this reason, you should use named-string interpolation (e.g., %(day)s )\ninstead of positional interpolation (e.g., %s or %d ) whenever you\nhave more than a single parameter. If you used positional interpolation,\ntranslations wouldn’t be able to reorder placeholder text. Since string extraction is done by the xgettext command, only syntaxes\nsupported by gettext are supported by Django. In particular, Python f-strings are not yet supported by xgettext , and\nJavaScript template strings need gettext 0.21+. Comments for translators ¶ If you would like to give translators hints about a translatable string, you\ncan add a comment prefixed with the Translators keyword on the line\npreceding the string, e.g.: def my_view ( request ): # Translators: This message appears on the home page only output = gettext ( \"Welcome to my site.\" ) The comment will then appear in the resulting .po file associated with the\ntranslatable construct located below it and should also be displayed by most\ntranslation tools. Note Just for completeness, this is the corresponding fragment of the\nresulting .po file: #. Translators: This message appears on the home page only # path/to/python/file.py:123 msgid \"Welcome to my site.\" msgstr \"\" This also works in templates. See Comments for translators in templates for\nmore details. Marking strings as no-op ¶ Use the function django.utils.translation.gettext_noop() to mark a\nstring as a translation string without translating it. The string is later\ntranslated from a variable. Use this if you have constant strings that should be stored in the source\nlanguage because they are exchanged over systems or users – such as strings\nin a database – but should be translated at the last possible point in time,\nsuch as when the string is presented to the user. Pluralization ¶ Use the function django.utils.translation.ngettext() to specify\npluralized messages. ngettext() takes three arguments: the singular translation string, the\nplural translation string and the number of objects. This function is useful when you need your Django application to be localizable\nto languages where the number and complexity of plural forms is\ngreater than the two forms used in English (‘object’ for the singular and\n‘objects’ for all the cases where count is different from one, irrespective\nof its value.) For example: from django.http import HttpResponse from django.utils.translation import ngettext def hello_world ( request , count ): page = ngettext ( \"there is %(count)d object\" , \"there are %(count)d objects\" , count , ) % { \"count\" : count , } return HttpResponse ( page ) In this example the number of objects is passed to the translation\nlanguages as the count variable. Note that pluralization is complicated and works differently in each language.\nComparing count to 1 isn’t always the correct rule. This code looks\nsophisticated, but will produce incorrect results for some languages: from django.utils.translation import ngettext from myapp.models import Report count = Report . objects . count () if count == 1 : name = Report . _meta . verbose_name else : name = Report . _meta . verbose_name_plural text = ngettext ( \"There is %(count)d %(name)s available.\" , \"There are %(count)d %(name)s available.\" , count , ) % { \"count\" : count , \"name\" : name } Don’t try to implement your own singular-or-plural logic; it won’t be correct.\nIn a case like this, consider something like the following: text = ngettext ( \"There is %(count)d %(name)s object available.\" , \"There are %(count)d %(name)s objects available.\" , count , ) % { \"count\" : count , \"name\" : Report . _meta . verbose_name , } Note When using ngettext() , make sure you use a single name for every\nextrapolated variable included in the literal. In the examples above, note\nhow we used the name Python variable in both translation strings. This\nexample, besides being incorrect in some languages as noted above, would\nfail: text = ngettext ( \"There is %(count)d %(name)s available.\" , \"There are %(count)d %(plural_name)s available.\" , count , ) % { \"count\" : Report . objects . count (), \"name\" : Report . _meta . verbose_name , \"plural_name\" : Report . _meta . verbose_name_plural , } You would get an error when running django-admin compilemessages : a format specification for argument 'name', as in 'msgstr[0]', doesn't exist in 'msgid' Contextual markers ¶ Sometimes words have several meanings, such as \"May\" in English, which\nrefers to a month name and to a verb. To enable translators to translate\nthese words correctly in different contexts, you can use the django.utils.translation.pgettext() function, or the django.utils.translation.npgettext() function if the string needs\npluralization. Both take a context string as the first variable. In the resulting .po file, the string will then appear as often as there are\ndifferent contextual markers for the same string (the context will appear on the msgctxt line), allowing the translator to give a different translation for\neach of them. For example: from django.utils.translation import pgettext month = pgettext ( \"month name\" , \"May\" ) or: from django.db import models from django.utils.translation import pgettext_lazy class MyThing ( models . Model ): name = models . CharField ( help_text = pgettext_lazy ( \"help text for MyThing model\" , \"This is the help text\" ) ) will appear in the .po file as: msgctxt \"month name\" msgid \"May\" msgstr \"\" Contextual markers are also supported by the translate and blocktranslate template tags. Lazy translation ¶ Use the lazy versions of translation functions in django.utils.translation (easily recognizable by the lazy suffix in\ntheir names) to translate strings lazily – when the value is accessed rather\nthan when they’re called. These functions store a lazy reference to the string – not the actual\ntranslation. The translation itself will be done when the string is used in a\nstring context, such as in template rendering. This is essential when calls to these functions are located in code paths that\nare executed at module load time. This is something that can easily happen when defining models, forms and\nmodel forms, because Django implements these such that their fields are\nactually class-level attributes. For that reason, make sure to use lazy\ntranslations in the following cases: Model fields and relationships verbose_name and help_text option values ¶ For example, to translate the help text of the name field in the following\nmodel, do the following: from django.db import models from django.utils.translation import gettext_lazy as _ class MyThing ( models . Model ): name = models . CharField ( help_text = _ ( \"This is the help text\" )) You can mark names of ForeignKey , ManyToManyField or OneToOneField relationship as translatable by using\ntheir verbose_name options: class MyThing ( models . Model ): kind = models . ForeignKey ( ThingKind , on_delete = models . CASCADE , related_name = \"kinds\" , verbose_name = _ ( \"kind\" ), ) Just like you would do in verbose_name you\nshould provide a lowercase verbose name text for the relation as Django will\nautomatically titlecase it when required. Model verbose names values ¶ It is recommended to always provide explicit verbose_name and verbose_name_plural options rather than\nrelying on the fallback English-centric and somewhat naïve determination of\nverbose names Django performs by looking at the model’s class name: from django.db import models from django.utils.translation import gettext_lazy as _ class MyThing ( models . Model ): name = models . CharField ( _ ( \"name\" ), help_text = _ ( \"This is the help text\" )) class Meta : verbose_name = _ ( \"my thing\" ) verbose_name_plural = _ ( \"my things\" ) Model methods description argument to the @display decorator ¶ For model methods, you can provide translations to Django and the admin site\nwith the description argument to the display() decorator: from django.contrib import admin from django.db import models from django.utils.translation import gettext_lazy as _ class MyThing ( models . Model ): kind = models . ForeignKey ( ThingKind , on_delete = models . CASCADE , related_name = \"kinds\" , verbose_name = _ ( \"kind\" ), ) @admin . display ( description = _ ( \"Is it a mouse?\" )) def is_mouse ( self ): return self . kind . type == MOUSE_TYPE Working with lazy translation objects ¶ The result of a gettext_lazy() call can be used wherever you would use a\nstring (a str object) in other Django code, but it may not work with\narbitrary Python code. For example, the following won’t work because the requests library doesn’t handle gettext_lazy objects: body = gettext_lazy ( \"I \\u2764 Django\" ) # (Unicode :heart:) requests . post ( \"https://example.com/send\" , data = { \"body\" : body }) You can avoid such problems by casting gettext_lazy() objects to text\nstrings before passing them to non-Django code: requests . post ( \"https://example.com/send\" , data = { \"body\" : str ( body )}) If you don’t like the long gettext_lazy name, you can alias it as _ (underscore), like so: from django.db import models from django.utils.translation import gettext_lazy as _ class MyThing ( models . Model ): name = models . CharField ( help_text = _ ( \"This is the help text\" )) Using gettext_lazy() and ngettext_lazy() to mark strings in models\nand utility functions is a common operation. When you’re working with these\nobjects elsewhere in your code, you should ensure that you don’t accidentally\nconvert them to strings, because they should be converted as late as possible\n(so that the correct locale is in effect). This necessitates the use of the\nhelper function described next. Lazy translations and plural ¶ When using lazy translation for a plural string ( n[p]gettext_lazy ), you\ngenerally don’t know the number argument at the time of the string\ndefinition. Therefore, you are authorized to pass a key name instead of an\ninteger as the number argument. Then number will be looked up in the\ndictionary under that key during string interpolation. Here’s example: from django import forms from django.core.exceptions import ValidationError from django.utils.translation import ngettext_lazy class MyForm ( forms . Form ): error_message = ngettext_lazy ( \"You only provided %(num)d argument\" , \"You only provided %(num)d arguments\" , \"num\" , ) def clean ( self ): # ... if error : raise ValidationError ( self . error_message % { \"num\" : number }) If the string contains exactly one unnamed placeholder, you can interpolate\ndirectly with the number argument: class MyForm ( forms . Form ): error_message = ngettext_lazy ( \"You provided %d argument\" , \"You provided %d arguments\" , ) def clean ( self ): # ... if error : raise ValidationError ( self . error_message % number ) Formatting strings: format_lazy() ¶ Python’s str.format() method will not work when either the format_string or any of the arguments to str.format() contains lazy translation objects. Instead, you can use django.utils.text.format_lazy() , which creates a lazy object\nthat runs the str.format() method only when the result is included\nin a string. For example: from django.utils.text import format_lazy from django.utils.translation import gettext_lazy ... name = gettext_lazy ( \"John Lennon\" ) instrument = gettext_lazy ( \"guitar\" ) result = format_lazy ( \" {name} : {instrument} \" , name = name , instrument = instrument ) In this case, the lazy translations in result will only be converted to\nstrings when result itself is used in a string (usually at template\nrendering time). Other uses of lazy in delayed translations ¶ For any other case where you would like to delay the translation, but have to\npass the translatable string as argument to another function, you can wrap\nthis function inside a lazy call yourself. For example: from django.utils.functional import lazy from django.utils.translation import gettext_lazy as _ def to_lower ( string ): return string . lower () to_lower_lazy = lazy ( to_lower , str ) And then later: lazy_string = to_lower_lazy ( _ ( \"My STRING!\" )) Localized names of languages ¶ get_language_info ( lang_code ) [source] ¶ The get_language_info() function provides detailed information about\nlanguages: >>> from django.utils.translation import activate , get_language_info >>> activate ( \"fr\" ) >>> li = get_language_info ( \"de\" ) >>> print ( li [ \"name\" ], li [ \"name_local\" ], li [ \"name_translated\" ], li [ \"bidi\" ]) German Deutsch Allemand False The name , name_local , and name_translated attributes of the\ndictionary contain the name of the language in English, in the language\nitself, and in your current active language respectively.  The bidi attribute is True only for bi-directional languages. The source of the language information is the django.conf.locale module.\nSimilar access to this information is available for template code. See below. Internationalization: in template code ¶ Translations in Django templates uses two template\ntags and a slightly different syntax than in Python code. To give your template\naccess to these tags, put {% load i18n %} toward the top of your template.\nAs with all template tags, this tag needs to be loaded in all templates which\nuse translations, even those templates that extend from other templates which\nhave already loaded the i18n tag. Warning Translated strings will not be escaped when rendered in a template.\nThis allows you to include HTML in translations, for example for emphasis,\nbut potentially dangerous characters (e.g. \" ) will also be rendered\nunchanged. translate template tag ¶ The {% translate %} template tag translates either a constant string\n(enclosed in single or double quotes) or variable content: < title > {% translate \"This is the title.\" %} </ title > < title > {% translate myvar %} </ title > If the noop option is present, variable lookup still takes place but the\ntranslation is skipped. This is useful when “stubbing out” content that will\nrequire translation in the future: < title > {% translate \"myvar\" noop %} </ title > Internally, inline translations use a gettext() call. In case a template var ( myvar above) is passed to the tag, the tag will\nfirst resolve such variable to a string at run-time and then look up that\nstring in the message catalogs. It’s not possible to mix a template variable inside a string within {% translate %} . If your translations require strings with variables\n(placeholders), use {% blocktranslate %} instead. If you’d like to retrieve a translated string without displaying it, you can\nuse the following syntax: {% translate \"This is the title\" as the_title %} < title > {{ the_title }} </ title > < meta name = \"description\" content = \" {{ the_title }} \" > In practice you’ll use this to get a string you can use in multiple places in a\ntemplate or so you can use the output as an argument for other template tags or\nfilters: {% translate \"starting point\" as start %} {% translate \"end point\" as end %} {% translate \"La Grande Boucle\" as race %} < h1 > < a href = \"/\" title = \" {% blocktranslate %} Back to ' {{ race }} ' homepage {% endblocktranslate %} \" > {{ race }} </ a > </ h1 > < p > {% for stage in tour_stages %} {% cycle start end %} : {{ stage }}{% if forloop .counter | divisibleby : 2 %} < br > {% else %} , {% endif %} {% endfor %} </ p > {% translate %} also supports contextual markers using the context keyword: {% translate \"May\" context \"month name\" %} blocktranslate template tag ¶ Contrarily to the translate tag, the blocktranslate tag allows you\nto mark complex sentences consisting of literals and variable content for\ntranslation by making use of placeholders: {% blocktranslate %} This string will have {{ value }} inside. {% endblocktranslate %} To translate a template expression – say, accessing object attributes or\nusing template filters – you need to bind the expression to a local variable\nfor use within the translation block. Examples: {% blocktranslate with amount = article.price %} That will cost $ {{ amount }} . {% endblocktranslate %} {% blocktranslate with myvar = value | filter %} This will have {{ myvar }} inside. {% endblocktranslate %} You can use multiple expressions inside a single blocktranslate tag: {% blocktranslate with book_t = book | title author_t = author | title %} This is {{ book_t }} by {{ author_t }} {% endblocktranslate %} Note The previous more verbose format is still supported: {% blocktranslate with book|title as book_t and author|title as author_t %} Other block tags (for example {% for %} or {% if %} ) are\nnot allowed inside a blocktranslate tag. If resolving one of the block arguments fails, blocktranslate will fall\nback to the default language by deactivating the currently active language\ntemporarily with the deactivate_all() function. This tag also provides for pluralization. To use it: Designate and bind a counter value with the name count . This value will\nbe the one used to select the right plural form. Specify both the singular and plural forms separating them with the {% plural %} tag within the {% blocktranslate %} and {% endblocktranslate %} tags. An example: {% blocktranslate count counter = list | length %} There is only one {{ name }} object. {% plural %} There are {{ counter }} {{ name }} objects. {% endblocktranslate %} A more complex example: {% blocktranslate with amount = article.price count years = i.length %} That will cost $ {{ amount }} per year. {% plural %} That will cost $ {{ amount }} per {{ years }} years. {% endblocktranslate %} When you use both the pluralization feature and bind values to local variables\nin addition to the counter value, keep in mind that the blocktranslate construct is internally converted to an ngettext call. This means the\nsame notes regarding ngettext variables apply. Reverse URL lookups cannot be carried out within the blocktranslate and\nshould be retrieved (and stored) beforehand: {% url 'path.to.view' arg arg2 as the_url %} {% blocktranslate %} This is a URL: {{ the_url }} {% endblocktranslate %} If you’d like to retrieve a translated string without displaying it, you can\nuse the following syntax: {% blocktranslate asvar the_title %} The title is {{ title }} . {% endblocktranslate %} < title > {{ the_title }} </ title > < meta name = \"description\" content = \" {{ the_title }} \" > In practice you’ll use this to get a string you can use in multiple places in a\ntemplate or so you can use the output as an argument for other template tags or\nfilters. {% blocktranslate %} also supports contextual\nmarkers using the context keyword: {% blocktranslate with name = user.username context \"greeting\" %} Hi {{ name }}{% endblocktranslate %} Another feature {% blocktranslate %} supports is the trimmed option.\nThis option will remove newline characters from the beginning and the end of\nthe content of the {% blocktranslate %} tag, replace any whitespace at the\nbeginning and end of a line and merge all lines into one using a space\ncharacter to separate them. This is quite useful for indenting the content of a {% blocktranslate %} tag without having the indentation characters end up\nin the corresponding entry in the .po file, which makes the translation\nprocess easier. For instance, the following {% blocktranslate %} tag: {% blocktranslate trimmed %} First sentence.\n  Second paragraph. {% endblocktranslate %} will result in the entry \"First sentence. Second paragraph.\" in the .po file, compared to \"\\n First sentence.\\n Second paragraph.\\n\" , if the trimmed option had not been specified. String literals passed to tags and filters ¶ You can translate string literals passed as arguments to tags and filters\nby using the familiar _() syntax: {% some_tag _ ( \"Page not found\" ) value | yesno : _ ( \"yes,no\" ) %} In this case, both the tag and the filter will see the translated string,\nso they don’t need to be aware of translations. Note In this example, the translation infrastructure will be passed the string \"yes,no\" , not the individual strings \"yes\" and \"no\" . The\ntranslated string will need to contain the comma so that the filter\nparsing code knows how to split up the arguments. For example, a German\ntranslator might translate the string \"yes,no\" as \"ja,nein\" (keeping the comma intact). Comments for translators in templates ¶ Just like with Python code , these notes for\ntranslators can be specified using comments, either with the comment tag: {% comment %} Translators: View verb {% endcomment %} {% translate \"View\" %} {% comment %} Translators: Short intro blurb {% endcomment %} < p > {% blocktranslate %} A multiline translatable\nliteral. {% endblocktranslate %} </ p > or with the {# … #} one-line comment constructs : {# Translators: Label of a button that triggers search #} < button type = \"submit\" > {% translate \"Go\" %} </ button > {# Translators: This is a text of the base template #} {% blocktranslate %} Ambiguous translatable block of text {% endblocktranslate %} Note Just for completeness, these are the corresponding fragments of the\nresulting .po file: #. Translators: View verb # path/to/template/file.html:10 msgid \"View\" msgstr \"\" #. Translators: Short intro blurb # path/to/template/file.html:13 msgid \"\" \"A multiline translatable\" \"literal.\" msgstr \"\" # ... #. Translators: Label of a button that triggers search # path/to/template/file.html:100 msgid \"Go\" msgstr \"\" #. Translators: This is a text of the base template # path/to/template/file.html:103 msgid \"Ambiguous translatable block of text\" msgstr \"\" Switching language in templates ¶ If you want to select a language within a template, you can use the language template tag: {% load i18n %} {% get_current_language as LANGUAGE_CODE %} <!-- Current language: {{ LANGUAGE_CODE }} --> < p > {% translate \"Welcome to our page\" %} </ p > {% language 'en' %} {% get_current_language as LANGUAGE_CODE %} <!-- Current language: {{ LANGUAGE_CODE }} --> < p > {% translate \"Welcome to our page\" %} </ p > {% endlanguage %} While the first occurrence of “Welcome to our page” uses the current language,\nthe second will always be in English. Other tags ¶ These tags also require a {% load i18n %} . get_available_languages ¶ {% get_available_languages as LANGUAGES %} returns a list of tuples in\nwhich the first element is the language code and the second is the\nlanguage name (translated into the currently active locale). get_current_language ¶ {% get_current_language as LANGUAGE_CODE %} returns the current user’s\npreferred language as a string. Example: en-us . See How Django discovers language preference . get_current_language_bidi ¶ {% get_current_language_bidi as LANGUAGE_BIDI %} returns the current\nlocale’s direction. If True , it’s a right-to-left language, e.g. Hebrew,\nArabic. If False it’s a left-to-right language, e.g. English, French,\nGerman, etc. i18n context processor ¶ If you enable the django.template.context_processors.i18n context\nprocessor, then each RequestContext will have access to LANGUAGES , LANGUAGE_CODE , and LANGUAGE_BIDI as defined above. get_language_info ¶ You can also retrieve information about any of the available languages using\nprovided template tags and filters. To get information about a single language,\nuse the {% get_language_info %} tag: {% get_language_info for LANGUAGE_CODE as lang %} {% get_language_info for \"pl\" as lang %} You can then access the information: Language code: {{ lang.code }} < br > Name of language: {{ lang.name_local }} < br > Name in English: {{ lang.name }} < br > Bi-directional: {{ lang.bidi }} Name in the active language: {{ lang.name_translated }} get_language_info_list ¶ You can also use the {% get_language_info_list %} template tag to retrieve\ninformation for a list of languages (e.g. active languages as specified in LANGUAGES ). See the section about the set_language redirect\nview for an example of how to display a language\nselector using {% get_language_info_list %} . In addition to LANGUAGES style list of tuples, {% get_language_info_list %} supports lists of language codes.\nIf you do this in your view: context = { \"available_languages\" : [ \"en\" , \"es\" , \"fr\" ]} return render ( request , \"mytemplate.html\" , context ) you can iterate over those languages in the template: {% get_language_info_list for available_languages as langs %} {% for lang in langs %} ... {% endfor %} Template filters ¶ There are also some filters available for convenience: {{ LANGUAGE_CODE|language_name }} (“German”) {{ LANGUAGE_CODE|language_name_local }} (“Deutsch”) {{ LANGUAGE_CODE|language_bidi }} (False) {{ LANGUAGE_CODE|language_name_translated }} (“německy”, when active language is Czech) Internationalization: in JavaScript code ¶ Adding translations to JavaScript poses some problems: JavaScript code doesn’t have access to a gettext implementation. JavaScript code doesn’t have access to .po or .mo files; they need to\nbe delivered by the server. The translation catalogs for JavaScript should be kept as small as\npossible. Django provides an integrated solution for these problems: It passes the\ntranslations into JavaScript, so you can call gettext , etc., from within\nJavaScript. The main solution to these problems is the following JavaScriptCatalog view,\nwhich generates a JavaScript code library with functions that mimic the gettext interface, plus an array of translation strings. The JavaScriptCatalog view ¶ class JavaScriptCatalog [source] ¶ A view that produces a JavaScript code library with functions that mimic\nthe gettext interface, plus an array of translation strings. Attributes domain ¶ Translation domain containing strings to add in the view output.\nDefaults to 'djangojs' . packages ¶ A list of application names among\ninstalled applications. Those apps should contain a locale directory. All those catalogs plus all catalogs found in LOCALE_PATHS (which are always included) are merged into one\ncatalog. Defaults to None , which means that all available\ntranslations from all INSTALLED_APPS are provided in the\nJavaScript output. Example with default values : from django.views.i18n import JavaScriptCatalog urlpatterns = [ path ( \"jsi18n/\" , JavaScriptCatalog . as_view (), name = \"javascript-catalog\" ), ] Example with custom packages : urlpatterns = [ path ( \"jsi18n/myapp/\" , JavaScriptCatalog . as_view ( packages = [ \"your.app.label\" ]), name = \"javascript-catalog\" , ), ] If your root URLconf uses i18n_patterns() , JavaScriptCatalog must also be wrapped by i18n_patterns() for the\ncatalog to be correctly generated. Example with i18n_patterns() : from django.conf.urls.i18n import i18n_patterns urlpatterns = i18n_patterns ( path ( \"jsi18n/\" , JavaScriptCatalog . as_view (), name = \"javascript-catalog\" ), ) The precedence of translations is such that the packages appearing later in the packages argument have higher precedence than the ones appearing at the\nbeginning. This is important in the case of clashing translations for the same\nliteral. If you use more than one JavaScriptCatalog view on a site and some of them\ndefine the same strings, the strings in the catalog that was loaded last take\nprecedence. Using the JavaScript translation catalog ¶ To use the catalog, pull in the dynamically generated script like this: < script src = \" {% url 'javascript-catalog' %} \" ></ script > This uses reverse URL lookup to find the URL of the JavaScript catalog view.\nWhen the catalog is loaded, your JavaScript code can use the following methods: gettext ngettext interpolate get_format gettext_noop pgettext npgettext pluralidx gettext ¶ The gettext function behaves similarly to the standard gettext interface within your Python code: document . write ( gettext ( \"this is to be translated\" )) ngettext ¶ The ngettext function provides an interface to pluralize words and\nphrases: const objectCount = 1 // or 0, or 2, or 3, ... const string = ngettext ( 'literal for the singular case' , 'literal for the plural case' , objectCount ); interpolate ¶ The interpolate function supports dynamically populating a format string.\nThe interpolation syntax is borrowed from Python, so the interpolate function supports both positional and named interpolation: Positional interpolation: obj contains a JavaScript Array object\nwhose elements values are then sequentially interpolated in their\ncorresponding fmt placeholders in the same order they appear.\nFor example: const formats = ngettext ( 'There is %s object. Remaining: %s' , 'There are %s objects. Remaining: %s' , 11 ); const string = interpolate ( formats , [ 11 , 20 ]); // string is 'There are 11 objects. Remaining: 20' Named interpolation: This mode is selected by passing the optional\nboolean named parameter as true . obj contains a JavaScript\nobject or associative array. For example: const data = { count : 10 , total : 50 }; const formats = ngettext ( 'Total: %(total)s, there is %(count)s object' , 'there are %(count)s of a total of %(total)s objects' , data . count ); const string = interpolate ( formats , data , true ); You shouldn’t go over the top with string interpolation, though: this is still\nJavaScript, so the code has to make repeated regular-expression substitutions.\nThis isn’t as fast as string interpolation in Python, so keep it to those\ncases where you really need it (for example, in conjunction with ngettext to produce proper pluralizations). get_format ¶ The get_format function has access to the configured i18n formatting\nsettings and can retrieve the format string for a given setting name: document . write ( get_format ( 'DATE_FORMAT' )); // 'N j, Y' It has access to the following settings: DATE_FORMAT DATE_INPUT_FORMATS DATETIME_FORMAT DATETIME_INPUT_FORMATS DECIMAL_SEPARATOR FIRST_DAY_OF_WEEK MONTH_DAY_FORMAT NUMBER_GROUPING SHORT_DATE_FORMAT SHORT_DATETIME_FORMAT THOUSAND_SEPARATOR TIME_FORMAT TIME_INPUT_FORMATS YEAR_MONTH_FORMAT This is useful for maintaining formatting consistency with the Python-rendered\nvalues. gettext_noop ¶ This emulates the gettext function but does nothing, returning whatever\nis passed to it: document . write ( gettext_noop ( \"this will not be translated\" )) This is useful for stubbing out portions of the code that will need translation\nin the future. pgettext ¶ The pgettext function behaves like the Python variant\n( pgettext() ), providing a contextually\ntranslated word: document . write ( pgettext ( \"month name\" , \"May\" )) npgettext ¶ The npgettext function also behaves like the Python variant\n( npgettext() ), providing a pluralized contextually translated word: document . write ( npgettext ( 'group' , 'party' , 1 )); // party document . write ( npgettext ( 'group' , 'party' , 2 )); // parties pluralidx ¶ The pluralidx function works in a similar way to the pluralize template filter, determining if a given count should use a plural form of\na word or not: document . write ( pluralidx ( 0 )); // true document . write ( pluralidx ( 1 )); // false document . write ( pluralidx ( 2 )); // true In the simplest case, if no custom pluralization is needed, this returns false for the integer 1 and true for all other numbers. However, pluralization is not this simple in all languages. If the language does\nnot support pluralization, an empty value is provided. Additionally, if there are complex rules around pluralization, the catalog view\nwill render a conditional expression. This will evaluate to either a true (should pluralize) or false (should not pluralize) value. The JSONCatalog view ¶ class JSONCatalog [source] ¶ In order to use another client-side library to handle translations, you may\nwant to take advantage of the JSONCatalog view. It’s similar to JavaScriptCatalog but returns a JSON response. See the documentation for JavaScriptCatalog to learn about possible values and use of the domain and packages attributes. The response format is as follows: {\n    \"catalog\": {\n        # Translations catalog\n    },\n    \"formats\": {\n        # Language formats for date, time, etc.\n    },\n    \"plural\": \"...\"  # Expression for plural forms, or null.\n} Note on performance ¶ The various JavaScript/JSON i18n views generate the catalog from .mo files\non every request. Since its output is constant, at least for a given version\nof a site, it’s a good candidate for caching. Server-side caching will reduce CPU load. It’s easily implemented with the cache_page() decorator. To trigger cache\ninvalidation when your translations change, provide a version-dependent key\nprefix, as shown in the example below, or map the view at a version-dependent\nURL: from django.views.decorators.cache import cache_page from django.views.i18n import JavaScriptCatalog # The value returned by get_version() must change when translations change. urlpatterns = [ path ( \"jsi18n/\" , cache_page ( 86400 , key_prefix = \"jsi18n- %s \" % get_version ())( JavaScriptCatalog . as_view () ), name = \"javascript-catalog\" , ), ] Client-side caching will save bandwidth and make your site load faster. If\nyou’re using ETags ( ConditionalGetMiddleware ),\nyou’re already covered. Otherwise, you can apply conditional decorators . In the following example, the cache is invalidated\nwhenever you restart your application server: from django.utils import timezone from django.views.decorators.http import last_modified from django.views.i18n import JavaScriptCatalog last_modified_date = timezone . now () urlpatterns = [ path ( \"jsi18n/\" , last_modified ( lambda req , ** kw : last_modified_date )( JavaScriptCatalog . as_view () ), name = \"javascript-catalog\" , ), ] You can even pre-generate the JavaScript catalog as part of your deployment\nprocedure and serve it as a static file. This radical technique is implemented\nin django-statici18n . Internationalization: in URL patterns ¶ Django provides two mechanisms to internationalize URL patterns: Adding the language prefix to the root of the URL patterns to make it\npossible for LocaleMiddleware to detect\nthe language to activate from the requested URL. Making URL patterns themselves translatable via the django.utils.translation.gettext_lazy() function. Warning Using either one of these features requires that an active language be set\nfor each request; in other words, you need to have django.middleware.locale.LocaleMiddleware in your MIDDLEWARE setting. Language prefix in URL patterns ¶ i18n_patterns ( * urls , prefix_default_language = True ) [source] ¶ This function can be used in a root URLconf and Django will automatically\nprepend the current active language code to all URL patterns defined within i18n_patterns() . Setting prefix_default_language to False removes the prefix from the\ndefault language ( LANGUAGE_CODE ). This can be useful when adding\ntranslations to existing site so that the current URLs won’t change. Example URL patterns: from django.conf.urls.i18n import i18n_patterns from django.urls import include , path from about import views as about_views from news import views as news_views from sitemap.views import sitemap urlpatterns = [ path ( \"sitemap.xml\" , sitemap , name = \"sitemap-xml\" ), ] news_patterns = ( [ path ( \"\" , news_views . index , name = \"index\" ), path ( \"category/<slug:slug>/\" , news_views . category , name = \"category\" ), path ( \"<slug:slug>/\" , news_views . details , name = \"detail\" ), ], \"news\" , ) urlpatterns += i18n_patterns ( path ( \"about/\" , about_views . main , name = \"about\" ), path ( \"news/\" , include ( news_patterns , namespace = \"news\" )), ) After defining these URL patterns, Django will automatically add the\nlanguage prefix to the URL patterns that were added by the i18n_patterns function. Example: >>> from django.urls import reverse >>> from django.utils.translation import activate >>> activate ( \"en\" ) >>> reverse ( \"sitemap-xml\" ) '/sitemap.xml' >>> reverse ( \"news:index\" ) '/en/news/' >>> activate ( \"nl\" ) >>> reverse ( \"news:detail\" , kwargs = { \"slug\" : \"news-slug\" }) '/nl/news/news-slug/' With prefix_default_language=False and LANGUAGE_CODE='en' , the URLs\nwill be: >>> activate ( \"en\" ) >>> reverse ( \"news:index\" ) '/news/' >>> activate ( \"nl\" ) >>> reverse ( \"news:index\" ) '/nl/news/' Warning i18n_patterns() is only allowed in a root\nURLconf. Using it within an included URLconf will throw an ImproperlyConfigured exception. Warning Ensure that you don’t have non-prefixed URL patterns that might collide\nwith an automatically-added language prefix. Translating URL patterns ¶ URL patterns can also be marked translatable using the gettext_lazy() function. Example: from django.conf.urls.i18n import i18n_patterns from django.urls import include , path from django.utils.translation import gettext_lazy as _ from about import views as about_views from news import views as news_views from sitemaps.views import sitemap urlpatterns = [ path ( \"sitemap.xml\" , sitemap , name = \"sitemap-xml\" ), ] news_patterns = ( [ path ( \"\" , news_views . index , name = \"index\" ), path ( _ ( \"category/<slug:slug>/\" ), news_views . category , name = \"category\" ), path ( \"<slug:slug>/\" , news_views . details , name = \"detail\" ), ], \"news\" , ) urlpatterns += i18n_patterns ( path ( _ ( \"about/\" ), about_views . main , name = \"about\" ), path ( _ ( \"news/\" ), include ( news_patterns , namespace = \"news\" )), ) After you’ve created the translations, the reverse() function will return the URL in the active language. Example: >>> from django.urls import reverse >>> from django.utils.translation import activate >>> activate ( \"en\" ) >>> reverse ( \"news:category\" , kwargs = { \"slug\" : \"recent\" }) '/en/news/category/recent/' >>> activate ( \"nl\" ) >>> reverse ( \"news:category\" , kwargs = { \"slug\" : \"recent\" }) '/nl/nieuws/categorie/recent/' Warning In most cases, it’s best to use translated URLs only within a language code\nprefixed block of patterns (using i18n_patterns() ), to avoid the possibility\nthat a carelessly translated URL causes a collision with a non-translated\nURL pattern. Reversing in templates ¶ If localized URLs get reversed in templates they always use the current\nlanguage. To link to a URL in another language use the language template tag. It enables the given language in the enclosed template section: {% load i18n %} {% get_available_languages as languages %} {% translate \"View this category in:\" %} {% for lang_code , lang_name in languages %} {% language lang_code %} < a href = \" {% url 'category' slug = category.slug %} \" > {{ lang_name }} </ a > {% endlanguage %} {% endfor %} The language tag expects the language code as the only argument. Localization: how to create language files ¶ Once the string literals of an application have been tagged for later\ntranslation, the translation themselves need to be written (or obtained). Here’s\nhow that works. Message files ¶ The first step is to create a message file for a new language. A message\nfile is a plain-text file, representing a single language, that contains all\navailable translation strings and how they should be represented in the given\nlanguage. Message files have a .po file extension. Django comes with a tool, django-admin makemessages , that automates the creation and upkeep of these files. Gettext utilities The makemessages command (and compilemessages discussed later) use\ncommands from the GNU gettext toolset: xgettext , msgfmt , msgmerge and msguniq . The minimum version of the gettext utilities supported is 0.15. To create or update a message file, run this command: django-admin makemessages -l de …where de is the locale name for the message file you want to\ncreate. For example, pt_BR for Brazilian Portuguese, de_AT for Austrian\nGerman or id for Indonesian. The script should be run from one of two places: The root directory of your Django project (the one that contains manage.py ). The root directory of one of your Django apps. The script runs over your project source tree or your application source tree\nand pulls out all strings marked for translation (see How Django discovers translations and be sure LOCALE_PATHS is configured correctly). It creates (or updates) a message file in the\ndirectory locale/LANG/LC_MESSAGES . In the de example, the file will be locale/de/LC_MESSAGES/django.po . When you run makemessages from the root directory of your project, the\nextracted strings will be automatically distributed to the proper message files.\nThat is, a string extracted from a file of an app containing a locale directory will go in a message file under that directory. A string extracted\nfrom a file of an app without any locale directory will either go in a\nmessage file under the directory listed first in LOCALE_PATHS or\nwill generate an error if LOCALE_PATHS is empty. By default django-admin makemessages examines every\nfile that has the .html , .txt or .py file extension. If you want to\noverride that default, use the --extension or -e option to specify the file extensions to examine: django-admin makemessages -l de -e txt Separate multiple extensions with commas and/or use -e or --extension multiple times: django-admin makemessages -l de -e html,txt -e xml Warning When creating message files from JavaScript source code you need to use the special djangojs domain, not -e js . Using Jinja2 templates? makemessages doesn’t understand the syntax of Jinja2 templates.\nTo extract strings from a project containing Jinja2 templates, use Message\nExtracting from Babel instead. Here’s an example babel.cfg configuration file: # Extraction from Python source files [python: **.py] # Extraction from Jinja2 templates [jinja2: **.jinja] extensions = jinja2.ext.with_ Make sure you list all extensions you’re using! Otherwise Babel won’t\nrecognize the tags defined by these extensions and will ignore Jinja2\ntemplates containing them entirely. Babel provides similar features to makemessages , can replace it\nin general, and doesn’t depend on gettext . For more information, read\nits documentation about working with message catalogs . No gettext? If you don’t have the gettext utilities installed, makemessages will create empty files. If that’s the case, either\ninstall the gettext utilities or copy the English message file\n( locale/en/LC_MESSAGES/django.po ) if available and use it as a starting\npoint, which is an empty translation file. Working on Windows? If you’re using Windows and need to install the GNU gettext utilities so makemessages works, see gettext on Windows for more\ninformation. Each .po file contains a small bit of metadata, such as the translation\nmaintainer’s contact information, but the bulk of the file is a list of messages – mappings between translation strings and the actual translated\ntext for the particular language. For example, if your Django app contained a translation string for the text \"Welcome to my site.\" , like so: _ ( \"Welcome to my site.\" ) …then django-admin makemessages will have created\na .po file containing the following snippet – a message: #: path/to/python/module.py:23 msgid \"Welcome to my site.\" msgstr \"\" A quick explanation: msgid is the translation string, which appears in the source. Don’t\nchange it. msgstr is where you put the language-specific translation. It starts\nout empty, so it’s your responsibility to change it. Make sure you keep\nthe quotes around your translation. As a convenience, each message includes, in the form of a comment line\nprefixed with # and located above the msgid line, the filename and\nline number from which the translation string was gleaned. Long messages are a special case. There, the first string directly after the msgstr (or msgid ) is an empty string. Then the content itself will be\nwritten over the next few lines as one string per line. Those strings are\ndirectly concatenated. Don’t forget trailing spaces within the strings;\notherwise, they’ll be tacked together without whitespace! Mind your charset Due to the way the gettext tools work internally and because we want to\nallow non-ASCII source strings in Django’s core and your applications, you must use UTF-8 as the encoding for your .po files (the default when .po files are created).  This means that everybody will be using the\nsame encoding, which is important when Django processes the .po files. Fuzzy entries makemessages sometimes generates translation entries marked as\nfuzzy, e.g. when translations are inferred from previously translated\nstrings. By default, fuzzy entries are not processed by compilemessages . To reexamine all source code and templates for new translation strings and\nupdate all message files for all languages, run this: django-admin makemessages -a Compiling message files ¶ After you create your message file – and each time you make changes to it –\nyou’ll need to compile it into a more efficient form, for use by gettext . Do\nthis with the django-admin compilemessages utility. This tool runs over all available .po files and creates .mo files, which\nare binary files optimized for use by gettext . In the same directory from\nwhich you ran django-admin makemessages , run django-admin compilemessages like this: django-admin compilemessages That’s it. Your translations are ready for use. Working on Windows? If you’re using Windows and need to install the GNU gettext utilities so django-admin compilemessages works see gettext on Windows for more information. .po files: Encoding and BOM usage. Django only supports .po files encoded in UTF-8 and without any BOM\n(Byte Order Mark) so if your text editor adds such marks to the beginning of\nfiles by default then you will need to reconfigure it. Troubleshooting: gettext() incorrectly detects python-format in strings with percent signs ¶ In some cases, such as strings with a percent sign followed by a space and a string conversion type (e.g. _(\"10% interest\") ), gettext() incorrectly\nflags strings with python-format . If you try to compile message files with incorrectly flagged strings, you’ll\nget an error message like number of format specifications in 'msgid' and 'msgstr' does not match or 'msgstr' is not a valid Python format string, unlike 'msgid' . To workaround this, you can escape percent signs by adding a second percent\nsign: from django.utils.translation import gettext as _ output = _ ( \"10 %% interest\" ) Or you can use no-python-format so that all percent signs are treated as\nliterals: # xgettext:no-python-format output = _ ( \"10 % i nterest\" ) Creating message files from JavaScript source code ¶ You create and update the message files the same way as the other Django message\nfiles – with the django-admin makemessages tool.\nThe only difference is you need to explicitly specify what in gettext parlance\nis known as a domain in this case the djangojs domain, by providing a -d djangojs parameter, like this: django-admin makemessages -d djangojs -l de This would create or update the message file for JavaScript for German. After\nupdating message files, run django-admin compilemessages the same way as you do with normal Django message files. gettext on Windows ¶ This is only needed for people who either want to extract message IDs or compile\nmessage files ( .po ). Translation work itself involves editing existing\nfiles of this type, but if you want to create your own message files, or want\nto test or compile a changed message file, download a precompiled binary\ninstaller . You may also use gettext binaries you have obtained elsewhere, so long as\nthe xgettext --version command works properly. Do not attempt to use Django\ntranslation utilities with a gettext package if the command xgettext --version entered at a Windows command prompt causes a popup window saying\n“ xgettext.exe has generated errors and will be closed by Windows”. Customizing the makemessages command ¶ If you want to pass additional parameters to xgettext , you need to create a\ncustom makemessages command and override its xgettext_options attribute: from django.core.management.commands import makemessages class Command ( makemessages . Command ): xgettext_options = makemessages . Command . xgettext_options + [ \"--keyword=mytrans\" ] If you need more flexibility, you could also add a new argument to your custom makemessages command: from django.core.management.commands import makemessages class Command ( makemessages . Command ): def add_arguments ( self , parser ): super () . add_arguments ( parser ) parser . add_argument ( \"--extra-keyword\" , dest = \"xgettext_keywords\" , action = \"append\" , ) def handle ( self , * args , ** options ): xgettext_keywords = options . pop ( \"xgettext_keywords\" ) if xgettext_keywords : self . xgettext_options = makemessages . Command . xgettext_options [:] + [ \"--keyword= %s \" % kwd for kwd in xgettext_keywords ] super () . handle ( * args , ** options ) Miscellaneous ¶ The set_language redirect view ¶ set_language ( request ) [source] ¶ As a convenience, Django comes with a view, django.views.i18n.set_language() ,\nthat sets a user’s language preference and redirects to a given URL or, by default,\nback to the previous page. Activate this view by adding the following line to your URLconf: path ( \"i18n/\" , include ( \"django.conf.urls.i18n\" )), (Note that this example makes the view available at /i18n/setlang/ .) Warning Make sure that you don’t include the above URL within i18n_patterns() - it needs to be\nlanguage-independent itself to work correctly. The view expects to be called via the POST method, with a language parameter set in request. If session support is enabled, the view saves the\nlanguage choice in the user’s session. It also saves the language choice in a\ncookie that is named django_language by default. (The name can be changed\nthrough the LANGUAGE_COOKIE_NAME setting.) After setting the language choice, Django looks for a next parameter in the POST or GET data. If that is found and Django considers it to be a safe\nURL (i.e. it doesn’t point to a different host and uses a safe scheme), a\nredirect to that URL will be performed. Otherwise, Django may fall back to\nredirecting the user to the URL from the Referer header or, if it is not\nset, to / , depending on the nature of the request: If the request accepts HTML content (based on its Accept HTTP header),\nthe fallback will always be performed. If the request doesn’t accept HTML, the fallback will be performed only if\nthe next parameter was set. Otherwise a 204 status code (No Content) will\nbe returned. Here’s example HTML template code: {% load i18n %} < form action = \" {% url 'set_language' %} \" method = \"post\" > {% csrf_token %} < input name = \"next\" type = \"hidden\" value = \" {{ redirect_to }} \" > < select name = \"language\" > {% get_current_language as LANGUAGE_CODE %} {% get_available_languages as LANGUAGES %} {% get_language_info_list for LANGUAGES as languages %} {% for language in languages %} < option value = \" {{ language.code }} \" {% if language.code == LANGUAGE_CODE %} selected {% endif %} > {{ language.name_local }} ( {{ language.code }} ) </ option > {% endfor %} </ select > < input type = \"submit\" value = \"Go\" > </ form > In this example, Django looks up the URL of the page to which the user will be\nredirected in the redirect_to context variable. Explicitly setting the active language ¶ You may want to set the active language for the current session explicitly. Perhaps\na user’s language preference is retrieved from another system, for example.\nYou’ve already been introduced to django.utils.translation.activate() . That\napplies to the current thread only. To persist the language for the entire\nsession in a cookie, set the LANGUAGE_COOKIE_NAME cookie on the\nresponse: from django.conf import settings from django.http import HttpResponse from django.utils import translation user_language = \"fr\" translation . activate ( user_language ) response = HttpResponse ( ... ) response . set_cookie ( settings . LANGUAGE_COOKIE_NAME , user_language ) You would typically want to use both: django.utils.translation.activate() changes the language for this thread, and setting the cookie makes this\npreference persist in future requests. Using translations outside views and templates ¶ While Django provides a rich set of i18n tools for use in views and templates,\nit does not restrict the usage to Django-specific code. The Django translation\nmechanisms can be used to translate arbitrary texts to any language that is\nsupported by Django (as long as an appropriate translation catalog exists, of\ncourse). You can load a translation catalog, activate it and translate text to\nlanguage of your choice, but remember to switch back to original language, as\nactivating a translation catalog is done on per-thread basis and such change\nwill affect code running in the same thread. For example: from django.utils import translation def welcome_translated ( language ): cur_language = translation . get_language () try : translation . activate ( language ) text = translation . gettext ( \"welcome\" ) finally : translation . activate ( cur_language ) return text Calling this function with the value 'de' will give you \"Willkommen\" ,\nregardless of LANGUAGE_CODE and language set by middleware. Functions of particular interest are django.utils.translation.get_language() which returns the language used\nin the current thread, django.utils.translation.activate() which\nactivates a translation catalog for the current thread, and django.utils.translation.check_for_language() which checks if the given language is supported by Django. To help write more concise code, there is also a context manager django.utils.translation.override() that stores the current language on\nenter and restores it on exit. With it, the above example becomes: from django.utils import translation def welcome_translated ( language ): with translation . override ( language ): return translation . gettext ( \"welcome\" ) Language cookie ¶ A number of settings can be used to adjust language cookie options: LANGUAGE_COOKIE_NAME LANGUAGE_COOKIE_AGE LANGUAGE_COOKIE_DOMAIN LANGUAGE_COOKIE_HTTPONLY LANGUAGE_COOKIE_PATH LANGUAGE_COOKIE_SAMESITE LANGUAGE_COOKIE_SECURE Implementation notes ¶ Specialties of Django translation ¶ Django’s translation machinery uses the standard gettext module that comes\nwith Python. If you know gettext , you might note these specialties in the\nway Django does translation: The string domain is django or djangojs . This string domain is\nused to differentiate between different programs that store their data\nin a common message-file library (usually /usr/share/locale/ ). The django domain is used for Python and template translation strings\nand is loaded into the global translation catalogs. The djangojs domain is only used for JavaScript translation catalogs to make sure\nthat those are as small as possible. Django doesn’t use xgettext alone. It uses Python wrappers around xgettext and msgfmt . This is mostly for convenience. How Django discovers language preference ¶ Once you’ve prepared your translations – or, if you want to use the\ntranslations that come with Django – you’ll need to activate translation for\nyour app. Behind the scenes, Django has a very flexible model of deciding which language\nshould be used – installation-wide, for a particular user, or both. To set an installation-wide language preference, set LANGUAGE_CODE .\nDjango uses this language as the default translation – the final attempt if no\nbetter matching translation is found through one of the methods employed by the\nlocale middleware (see below). If all you want is to run Django with your native language all you need to do\nis set LANGUAGE_CODE and make sure the corresponding message\nfiles and their compiled versions ( .mo ) exist. If you want to let each individual user specify which language they\nprefer, then you also need to use the LocaleMiddleware . LocaleMiddleware enables language selection based on data from the request.\nIt customizes content for each user. To use LocaleMiddleware , add 'django.middleware.locale.LocaleMiddleware' to your MIDDLEWARE setting. Because middleware order matters, follow\nthese guidelines: Make sure it’s one of the first middleware installed. It should come after SessionMiddleware , because LocaleMiddleware makes use of session data. And it should come before CommonMiddleware because CommonMiddleware needs an activated language in order\nto resolve the requested URL. If you use CacheMiddleware , put LocaleMiddleware after it. For example, your MIDDLEWARE might look like this: MIDDLEWARE = [ \"django.contrib.sessions.middleware.SessionMiddleware\" , \"django.middleware.locale.LocaleMiddleware\" , \"django.middleware.common.CommonMiddleware\" , ] (For more on middleware, see the middleware documentation .) LocaleMiddleware tries to determine the user’s language preference by\nfollowing this algorithm: First, it looks for the language prefix in the requested URL.  This is\nonly performed when you are using the i18n_patterns function in your\nroot URLconf. See Internationalization: in URL patterns for more information\nabout the language prefix and how to internationalize URL patterns. Failing that, it looks for a cookie. The name of the cookie used is set by the LANGUAGE_COOKIE_NAME setting. (The default name is django_language .) Failing that, it looks at the Accept-Language HTTP header. This\nheader is sent by your browser and tells the server which language(s) you\nprefer, in order by priority. Django tries each language in the header\nuntil it finds one with available translations. Failing that, it uses the global LANGUAGE_CODE setting. Notes: In each of these places, the language preference is expected to be in the\nstandard language format , as a string. For example,\nBrazilian Portuguese is pt-br . If a base language is available but the sublanguage specified is not,\nDjango uses the base language. For example, if a user specifies de-at (Austrian German) but Django only has de available, Django uses de . Only languages listed in the LANGUAGES setting can be selected.\nIf you want to restrict the language selection to a subset of provided\nlanguages (because your application doesn’t provide all those languages),\nset LANGUAGES to a list of languages. For example: LANGUAGES = [ ( \"de\" , _ ( \"German\" )), ( \"en\" , _ ( \"English\" )), ] This example restricts languages that are available for automatic\nselection to German and English (and any sublanguage, like de-ch or en-us ). If you define a custom LANGUAGES setting, as explained in the\nprevious bullet, you can mark the language names as translation strings\n– but use gettext_lazy() instead of gettext() to avoid a circular import. Here’s a sample settings file: from django.utils.translation import gettext_lazy as _ LANGUAGES = [ ( \"de\" , _ ( \"German\" )), ( \"en\" , _ ( \"English\" )), ] Once LocaleMiddleware determines the user’s preference, it makes this\npreference available as request.LANGUAGE_CODE for each HttpRequest . Feel free to read this value in your view\ncode. Here’s an example: from django.http import HttpResponse def hello_world ( request , count ): if request . LANGUAGE_CODE == \"de-at\" : return HttpResponse ( \"You prefer to read Austrian German.\" ) else : return HttpResponse ( \"You prefer to read another language.\" ) Note that, with static (middleware-less) translation, the language is in settings.LANGUAGE_CODE , while with dynamic (middleware) translation, it’s\nin request.LANGUAGE_CODE . How Django discovers translations ¶ At runtime, Django builds an in-memory unified catalog of literals-translations.\nTo achieve this it looks for translations by following this algorithm regarding\nthe order in which it examines the different file paths to load the compiled message files ( .mo ) and the precedence of multiple\ntranslations for the same literal: The directories listed in LOCALE_PATHS have the highest\nprecedence, with the ones appearing first having higher precedence than\nthe ones appearing later. Then, it looks for and uses if it exists a locale directory in each\nof the installed apps listed in INSTALLED_APPS .  The ones\nappearing first have higher precedence than the ones appearing later. Finally, the Django-provided base translation in django/conf/locale is used as a fallback. See also The translations for literals included in JavaScript assets are looked up\nfollowing a similar but not identical algorithm. See JavaScriptCatalog for more details. You can also put custom format files in the LOCALE_PATHS directories if you also set FORMAT_MODULE_PATH . In all cases the name of the directory containing the translation is expected to\nbe named using locale name notation. E.g. de , pt_BR , es_AR ,\netc. Untranslated strings for territorial language variants use the translations\nof the generic language. For example, untranslated pt_BR strings use pt translations. This way, you can write applications that include their own translations, and\nyou can override base translations in your project. Or, you can build a big\nproject out of several apps and put all translations into one big common\nmessage file specific to the project you are composing. The choice is yours. All message file repositories are structured the same way. They are: All paths listed in LOCALE_PATHS in your settings file are\nsearched for <language>/LC_MESSAGES/django.(po|mo) $APPPATH/locale/<language>/LC_MESSAGES/django.(po|mo) $PYTHONPATH/django/conf/locale/<language>/LC_MESSAGES/django.(po|mo) To create message files, you use the django-admin makemessages tool. And you use django-admin compilemessages to produce the binary .mo files that are used by gettext . You can also run django-admin compilemessages --settings=path.to.settings to make the compiler process all\nthe directories in your LOCALE_PATHS setting. Using a non-English base language ¶ Django makes the general assumption that the original strings in a translatable\nproject are written in English. You can choose another language, but you must be\naware of certain limitations: gettext only provides two plural forms for the original messages, so you\nwill also need to provide a translation for the base language to include all\nplural forms if the plural rules for the base language are different from\nEnglish. When an English variant is activated and English strings are missing, the\nfallback language will not be the LANGUAGE_CODE of the project,\nbut the original strings. For example, an English user visiting a site with LANGUAGE_CODE set to Spanish and original strings written in\nRussian will see Russian text rather than Spanish.", "keywords": ["users", "language_cookie_domain", "feature", "django.views.decorators.http", "verbose", "error_message", "pattern", "selection", "messages", "troubleshooting", "extraction", "mytemplate.html", "library", "django.views.i18n.set_language", "field", "#", "parlance", "javascriptcatalog", "django.(po|mo", "relation", "m", "total", "grande", "metadata", "share", "req", "+", "paragraph", "numbers", "book_t", "host", "lambda", "action", "lines", "stage", "httpresponse", "subset", "directories", "cache", "myform", "ngettext", "paragraph.\\n", "words", "your.app.label", "tool", "thingkind", "django.urls", "change", "literal", "ids", "hebrew", "lc_messages", "label", "asvar", "name)s", "django.core.exceptions", "cpu", "=", "changes", "http", "results", "mything", ":)", "translated", "django.utils.translation.activate", "message", "installation", "relationship", "href", "shell", "character", "date_format", "tag", "endlanguage", "button", "language_code|language_name", "wrappers", "persist", "czech", "process", "places", "meanings", "fallback", "extracting", "django.utils.translation.get_language", "hello_world", "choice", "fmt", "var", "john", "charset", "following", "type", "path.to.view", "variant", "people", "custom", "kwargs", "es_ar", "objects", "django.utils.text", "documentation", ".po", "lookups", "jinja2.ext.with", "mind", "file", "month)s", "work", "user", "bullet", "li", "django.utils.translation", "fragment", "language_cookie_path", "machinery", "cases", "lennon", "helper", "attribute", "/en", "args", "guitar", "scenes", "warning", "packages", "time", "tags", "basis", "render", "date", "setting", "language_cookie_name", "set_language", "things", "msgstr[0", "may", "preference", "german", "logic", "name", "signs", "jsi18n/", "parameter", "candidate", "rule", "flags", "myvar", "reference", "django.utils.translation.gettext_noop", "web", "is_mouse", "problems", "interpolation", "versions", "language_code|language_name_local", "greeting", "blurb", "xgettext", "pt", "manager", "uses", "literals", "return", "behaves", "reverse", "sentences", "applications", "memory", "expressions", "specialties", "search", "kinds", "collision", "pgettext", "commas", "locale/<language>/lc_messages", "translate", "examples", "bom", "commonmiddleware", "sessionmiddleware", "slug>/", "category", "mytrans", "django.utils.translation.check_for_language", "status", "relationships", "name_local", "russian", "tree", "space", "url", "nature", "error", "guidelines", "module", "code", "algorithm", "bulk", "invalidation", "filter", "django.middleware.locale", "false", "style", "access", "class", "display", "placeholders", "array", "i", "exists", "group", "endcomment", "names", "javascript", "snippet", "str.format", "construct", "years", "objectcount", "request", "formatting", "database", "block", "output", "input", "deutsch", "instrument", "*", "page", "pluralidx", "commands", "count", "sentence", "file.html:13", "strings", "elements", "django.utils.translation.override", "-l", "multiline", "admin", "creation", "de", "gnu", "pluralization", "direction", "usage", "gettext_noop", "help_text", "xml", "configuration", "boucle", "category.slug", "kw", "script", "step", "jsi18n", "n[p]gettext_lazy", "thread", "flexibility", "allemand", "limitations", "decimal_separator", "set_cookie", "pt_br", "texts", "section", "translator", "developer", "suffix", "source", "append", "language_cookie_age", "specification", "spanish", "pop", "underscore", "\\u2764", "use", "substitutions", "placeholder", "blocktranslate", "editor", "the_title", "author", "gettext", "solution", "explanation", "performance", "time_input_formats", "de_at", "extensions", "core", "french", "operation", "order", "j", "date_input_formats", "cachemiddleware", "default", "specifications", "counter", "alias", "msgfmt", "short_datetime_format", "comment", "form", "heart", "prefix", "option", "/sitemap.xml", "format", "expression", "tests", "help", "characters", "comma", "etags", "babel", "percent", "day", "jsoncatalog", "convention", "nieuws", "lang", "sitemap.views", "timezone", "validationerror", "convenience", "advantage", "f", "supports", "total)s", "scheme", "xgettext_keywords", "django.middleware.common", "attempt", "race", "verbose_name_plural", "src", "template", "indentation", "marks", "statici18n", "mappings", "onetoonefield", "header", "way", "month_day_format", "endfor", "formats", "utf-8", "super", ".py", "fr", "optimizations", "comments", "index", "accept", "possibility", "op", "django.conf.locale", "party", "notation", "integer", "session", "@admin", "¶", "command", "news", "internationalization", "spaces", "post", "parameters", "format_module_path", "centric", "path.to.settings", "side", "miscellaneous", "installer", "content", "function", "reorder", "views", "result", "view", "binaries", "pluralizations", "run", "number", "right", "def", "language_code='en", "point", "values", "django.contrib", "msgctxt", "interest", "string", "verb", "catalogs", "language_bidi", "_", ".counter", "get_language_info_list", "windows", "overview", "file.html:10", "contact", "thing", "language_code|language_name_translated", "markers", "jinja2", "endblocktranslate", "verbose_name", "get_format", "article.price", "language_cookie_httponly", "language", "models", "exit", "user_language", "arabic", "version", "level", "intro", "file.html:100", "hoy", "json", "syntaxes", "processor", "i18n/", "namespace", "concise", "parser", "book|title", "django", "n’t", "filename", "fields", "print", "utilities", "entry", "languages", "set", "lowercase", "la", "override", "p", "book", "homepage", "practice", "get_version", "urlpatterns", "value", "phrases", "format_string", "line", "bit", "codes", "improperlyconfigured", "emphasis", "https://example.com/send", "data", "implementation", "browser", "base", "redirect_to", "updates", "indonesian", "paths", "self", "instance", "today", "localization", "makemessages", "interpolate", "extension", "interface", "directional", "-e", "mechanisms", "news/", "caveat", "report", "|", "jsi18n-", "unicode", "byte", "xgettext_options", "start", "file.py:123", "take", "ensure", "decorator", "gettext_lazy", "prefix_default_language", "lang_code", "noop", "add_arguments", "pl", "assets", "language_cookie_samesite", "i18n_patterns", "part", "module.py:23", "num)d", "language(s", "object", "load", "couple", "domain", "deployment", "npgettext", "localemiddleware", "httprequest", "charfield", "manytomanyfield", "bidi", "get_current_language", "november", "precedence", "response", "utility", "dictionary", "hints", "whitespace", "requests", "langs", "language>/lc_messages", "locale", "fly", "compilemessages", "forloop", "last_modified_date", "rendering", "keyword", "s", "conversion", "cache_page", "upkeep", "top", "variables", "rules", "decorators", "root", "responsibility", "notes", "obj", "redirect", "activate", "effect", "detail", "system", "apps", "sublanguage", "pluralize", "no", "overhead", "nein", "willkommen", "conf", "django.views.decorators.cache", "welcome", "matters", "plural", "sitemaps.views", "available_languages", "count)s", "programs", "definition", "procedure", "target", "completeness", "difference", "djangojs", "site", "forms", "features", "consistency", "lang_name", "referer", "addition", "lists", "example", "care", "recent/", "app", "hooks", "window", "i18n", "month", "list", "sample", "kwd", "determination", "locale_paths", "seconds", "en", "parties", "typing", "--settings", "first", "fragments", "plural_name)s", "language_cookie_secure", "starting", "language_code|language_bidi", "variable", "preferences", "model", "word", "year", "reasons", "place", "systems", "home", "portuguese", "element", "application", "author|title", "--extension", "encoding", "attributes", "key_prefix", "django.utils.translation.npgettext", "language.code", "title", "course", "redirects", "variants", "urlconf", "y", "contexts", "const", "translation", "interference", "syntax", "occurrence", "nl", "cur_language", "conditionalgetmiddleware", "i.length", "ones", "works", "case", "equivalent", "h1", "length", "arg", ".mo", "lookup", "boolean", "language_code", "conjunction", "deactivate_all", "slug", "technique", "br", "runtime", "html", "msgstr", "errors", "@display", "future", "server", "str", "arguments", "to_lower", "apppath", "quotes", "package", "middleware", "one", "catalog", "selector", "end", "translations", "entries", "singular", "e.g.", "toolset", "tuples", "matching", ".html", "amount", "standard", "mark", "kind", "německy", "get_language_info", "path", "functions", "key", "translatable", "author_t", "django.views.i18n", "handle", "my_view", "none", "portions", "filters", "problem", "sign", "meta", "lang.bidi", "patterns", "infrastructure", "reason", "prompt", "framework", "plural_name", "news_views", "caching", "urls", "sitemap", "arg2", "support", "myapp.models", "description", "complexity", "django.core.management.commands", "mode", "priority", "document", "assumption", "-", "datetime_input_formats", "context", "django.utils", "cycle", "import", "files", "d", "repositories", "directory", "%", "defaults", "compile", "call", "foreignkey", "information", "python", "pythonpath", "day)s", "translators", "mouse", "methods", "requestcontext", "options", "times", "--extra", "exception", "msgid", "client", "details", "method", "get_available_languages", "yesno", "django.db", "settings", "num", "argument", "maintainer", "cookie", "note", "body", "tools", "lang.name", "templates", "beginning", "text", "project", "english"], "type": "documentation"},
{"title": "GIS QuerySet API Reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/geoquerysets/", "content": "GIS QuerySet API Reference ¶ Spatial Lookups ¶ The spatial lookups in this section are available for GeometryField and RasterField . For an introduction, see the spatial lookups introduction .  For an overview of what lookups are\ncompatible with a particular spatial backend, refer to the spatial lookup compatibility table . Lookups with rasters ¶ All examples in the reference below are given for geometry fields and inputs,\nbut the lookups can be used the same way with rasters on both sides. Whenever\na lookup doesn’t support raster input, the input is automatically\nconverted to a geometry where necessary using the ST_Polygon function. See also the introduction to raster lookups . The database operators used by the lookups can be divided into three categories: Native raster support N : the operator accepts rasters natively on both\nsides of the lookup, and raster input can be mixed with geometry inputs. Bilateral raster support B : the operator supports rasters only if both\nsides of the lookup receive raster inputs. Raster data is automatically\nconverted to geometries for mixed lookups. Geometry conversion support C . The lookup does not have native raster\nsupport, all raster data is automatically converted to geometries. The examples below show the SQL equivalent for the lookups in the different\ntypes of raster support. The same pattern applies to all spatial lookups. Case Lookup SQL Equivalent N, B rast__contains=rst ST_Contains(rast, rst) N, B rast__1__contains=(rst, 2) ST_Contains(rast, 1, rst, 2) B, C rast__contains=geom ST_Contains(ST_Polygon(rast), geom) B, C rast__1__contains=geom ST_Contains(ST_Polygon(rast, 1), geom) B, C poly__contains=rst ST_Contains(poly, ST_Polygon(rst)) B, C poly__contains=(rst, 1) ST_Contains(poly, ST_Polygon(rst, 1)) C rast__crosses=rst ST_Crosses(ST_Polygon(rast), ST_Polygon(rst)) C rast__1__crosses=(rst, 2) ST_Crosses(ST_Polygon(rast, 1), ST_Polygon(rst, 2)) C rast__crosses=geom ST_Crosses(ST_Polygon(rast), geom) C poly__crosses=rst ST_Crosses(poly, ST_Polygon(rst)) Spatial lookups with rasters are only supported for PostGIS backends\n(denominated as PGRaster in this section). bbcontains ¶ Availability : PostGIS ,\nMariaDB, MySQL, SpatiaLite, PGRaster (Native) Tests if the geometry or raster field’s bounding box completely contains the\nlookup geometry’s bounding box. Example: Zipcode . objects . filter ( poly__bbcontains = geom ) Backend SQL Equivalent PostGIS poly ~ geom MariaDB MBRContains(poly, geom) MySQL MBRContains(poly, geom) SpatiaLite MbrContains(poly, geom) bboverlaps ¶ Availability : PostGIS ,\nMariaDB, MySQL, SpatiaLite, PGRaster (Native) Tests if the geometry field’s bounding box overlaps the lookup geometry’s\nbounding box. Example: Zipcode . objects . filter ( poly__bboverlaps = geom ) Backend SQL Equivalent PostGIS poly && geom MariaDB MBROverlaps(poly, geom) MySQL MBROverlaps(poly, geom) SpatiaLite MbrOverlaps(poly, geom) contained ¶ Availability : PostGIS ,\nMariaDB, MySQL, SpatiaLite, PGRaster (Native) Tests if the geometry field’s bounding box is completely contained by the\nlookup geometry’s bounding box. Example: Zipcode . objects . filter ( poly__contained = geom ) Backend SQL Equivalent PostGIS poly @ geom MariaDB MBRWithin(poly, geom) MySQL MBRWithin(poly, geom) SpatiaLite MbrWithin(poly, geom) contains ¶ Availability : PostGIS ,\nOracle, MariaDB, MySQL, SpatiaLite, PGRaster (Bilateral) Tests if the geometry field spatially contains the lookup geometry. Example: Zipcode . objects . filter ( poly__contains = geom ) Backend SQL Equivalent PostGIS ST_Contains(poly, geom) Oracle SDO_CONTAINS(poly, geom) MariaDB ST_Contains(poly, geom) MySQL ST_Contains(poly, geom) SpatiaLite Contains(poly, geom) contains_properly ¶ Availability : PostGIS ,\nPGRaster (Bilateral) Returns true if the lookup geometry intersects the interior of the\ngeometry field, but not the boundary (or exterior). Example: Zipcode . objects . filter ( poly__contains_properly = geom ) Backend SQL Equivalent PostGIS ST_ContainsProperly(poly, geom) coveredby ¶ Availability : PostGIS ,\nOracle, PGRaster (Bilateral), SpatiaLite Tests if no point in the geometry field is outside the lookup geometry. [ 3 ] Example: Zipcode . objects . filter ( poly__coveredby = geom ) Backend SQL Equivalent PostGIS ST_CoveredBy(poly, geom) Oracle SDO_COVEREDBY(poly, geom) SpatiaLite CoveredBy(poly, geom) covers ¶ Availability : PostGIS ,\nOracle, PGRaster (Bilateral), SpatiaLite Tests if no point in the lookup geometry is outside the geometry field. [ 3 ] Example: Zipcode . objects . filter ( poly__covers = geom ) Backend SQL Equivalent PostGIS ST_Covers(poly, geom) Oracle SDO_COVERS(poly, geom) SpatiaLite Covers(poly, geom) crosses ¶ Availability : PostGIS ,\nMariaDB, MySQL, SpatiaLite, PGRaster (Conversion) Tests if the geometry field spatially crosses the lookup geometry. Example: Zipcode . objects . filter ( poly__crosses = geom ) Backend SQL Equivalent PostGIS ST_Crosses(poly, geom) MariaDB ST_Crosses(poly, geom) MySQL ST_Crosses(poly, geom) SpatiaLite Crosses(poly, geom) disjoint ¶ Availability : PostGIS ,\nOracle, MariaDB, MySQL, SpatiaLite, PGRaster (Bilateral) Tests if the geometry field is spatially disjoint from the lookup geometry. Example: Zipcode . objects . filter ( poly__disjoint = geom ) Backend SQL Equivalent PostGIS ST_Disjoint(poly, geom) Oracle SDO_GEOM.RELATE(poly, 'DISJOINT', geom, 0.05) MariaDB ST_Disjoint(poly, geom) MySQL ST_Disjoint(poly, geom) SpatiaLite Disjoint(poly, geom) equals ¶ Availability : PostGIS ,\nOracle, MariaDB, MySQL, SpatiaLite, PGRaster (Conversion) Tests if the geometry field is spatially equal to the lookup geometry. Example: Zipcode . objects . filter ( poly__equals = geom ) Backend SQL Equivalent PostGIS ST_Equals(poly, geom) Oracle SDO_EQUAL(poly, geom) MariaDB ST_Equals(poly, geom) MySQL ST_Equals(poly, geom) SpatiaLite Equals(poly, geom) exact , same_as ¶ Availability : PostGIS ,\nOracle, MariaDB, MySQL, SpatiaLite, PGRaster (Bilateral) Tests if the geometry field is “equal” to the lookup geometry. On Oracle,\nMySQL, and SpatiaLite, it tests spatial equality, while on PostGIS it tests\nequality of bounding boxes. Example: Zipcode . objects . filter ( poly = geom ) Backend SQL Equivalent PostGIS poly ~= geom Oracle SDO_EQUAL(poly, geom) MariaDB ST_Equals(poly, geom) MySQL ST_Equals(poly, geom) SpatiaLite Equals(poly, geom) intersects ¶ Availability : PostGIS ,\nOracle, MariaDB, MySQL, SpatiaLite, PGRaster (Bilateral) Tests if the geometry field spatially intersects the lookup geometry. Example: Zipcode . objects . filter ( poly__intersects = geom ) Backend SQL Equivalent PostGIS ST_Intersects(poly, geom) Oracle SDO_OVERLAPBDYINTERSECT(poly, geom) MariaDB ST_Intersects(poly, geom) MySQL ST_Intersects(poly, geom) SpatiaLite Intersects(poly, geom) isempty ¶ Availability : PostGIS Tests if the geometry is empty. Example: Zipcode . objects . filter ( poly__isempty = True ) isvalid ¶ Availability : MySQL, PostGIS ,\nOracle, SpatiaLite Tests if the geometry is valid. Example: Zipcode . objects . filter ( poly__isvalid = True ) Backend SQL Equivalent MySQL, PostGIS, SpatiaLite ST_IsValid(poly) Oracle SDO_GEOM.VALIDATE_GEOMETRY_WITH_CONTEXT(poly, 0.05) = 'TRUE' overlaps ¶ Availability : PostGIS ,\nOracle, MariaDB, MySQL, SpatiaLite, PGRaster (Bilateral) Tests if the geometry field spatially overlaps the lookup geometry. Backend SQL Equivalent PostGIS ST_Overlaps(poly, geom) Oracle SDO_OVERLAPS(poly, geom) MariaDB ST_Overlaps(poly, geom) MySQL ST_Overlaps(poly, geom) SpatiaLite Overlaps(poly, geom) relate ¶ Availability : PostGIS ,\nMariaDB, Oracle, SpatiaLite, PGRaster (Conversion) Tests if the geometry field is spatially related to the lookup geometry by\nthe values given in the given pattern.  This lookup requires a tuple parameter, (geom, pattern) ; the form of pattern will depend on the spatial backend: MariaDB, PostGIS, and SpatiaLite ¶ On these spatial backends the intersection pattern is a string comprising\nnine characters, which  define intersections between  the interior, boundary,\nand exterior of the geometry field and the lookup geometry.\nThe intersection pattern matrix may only use the following characters: 1 , 2 , T , F , or * .  This lookup type allows users to “fine tune”\na specific geometric relationship consistent with the DE-9IM model. [ 1 ] Geometry example: # A tuple lookup parameter is used to specify the geometry and # the intersection pattern (the pattern here is for 'contains'). Zipcode . objects . filter ( poly__relate = ( geom , \"T*T***FF*\" )) PostGIS and MariaDB SQL equivalent: SELECT ... WHERE ST_Relate ( poly , geom , 'T*T***FF*' ) SpatiaLite SQL equivalent: SELECT ... WHERE Relate ( poly , geom , 'T*T***FF*' ) Raster example: Zipcode . objects . filter ( poly__relate = ( rast , 1 , \"T*T***FF*\" )) Zipcode . objects . filter ( rast__2__relate = ( rast , 1 , \"T*T***FF*\" )) PostGIS SQL equivalent: SELECT ... WHERE ST_Relate ( poly , ST_Polygon ( rast , 1 ), 'T*T***FF*' ) SELECT ... WHERE ST_Relate ( ST_Polygon ( rast , 2 ), ST_Polygon ( rast , 1 ), 'T*T***FF*' ) Oracle ¶ Here the relation pattern is comprised of at least one of the nine relation\nstrings: TOUCH , OVERLAPBDYDISJOINT , OVERLAPBDYINTERSECT , EQUAL , INSIDE , COVEREDBY , CONTAINS , COVERS , ON , and ANYINTERACT .   Multiple strings may be combined with the logical Boolean\noperator OR, for example, 'inside+touch' . [ 2 ] The relation\nstrings are case-insensitive. Example: Zipcode . objects . filter ( poly__relate = ( geom , \"anyinteract\" )) Oracle SQL equivalent: SELECT ... WHERE SDO_RELATE ( poly , geom , 'anyinteract' ) touches ¶ Availability : PostGIS ,\nOracle, MariaDB, MySQL, SpatiaLite Tests if the geometry field spatially touches the lookup geometry. Example: Zipcode . objects . filter ( poly__touches = geom ) Backend SQL Equivalent PostGIS ST_Touches(poly, geom) MariaDB ST_Touches(poly, geom) MySQL ST_Touches(poly, geom) Oracle SDO_TOUCH(poly, geom) SpatiaLite Touches(poly, geom) within ¶ Availability : PostGIS ,\nOracle, MariaDB, MySQL, SpatiaLite, PGRaster (Bilateral) Tests if the geometry field is spatially within the lookup geometry. Example: Zipcode . objects . filter ( poly__within = geom ) Backend SQL Equivalent PostGIS ST_Within(poly, geom) MariaDB ST_Within(poly, geom) MySQL ST_Within(poly, geom) Oracle SDO_INSIDE(poly, geom) SpatiaLite Within(poly, geom) left ¶ Availability : PostGIS ,\nPGRaster (Conversion) Tests if the geometry field’s bounding box is strictly to the left of the\nlookup geometry’s bounding box. Example: Zipcode . objects . filter ( poly__left = geom ) PostGIS equivalent: SELECT ... WHERE poly << geom right ¶ Availability : PostGIS ,\nPGRaster (Conversion) Tests if the geometry field’s bounding box is strictly to the right of the\nlookup geometry’s bounding box. Example: Zipcode . objects . filter ( poly__right = geom ) PostGIS equivalent: SELECT ... WHERE poly >> geom overlaps_left ¶ Availability : PostGIS ,\nPGRaster (Bilateral) Tests if the geometry field’s bounding box overlaps or is to the left of the lookup\ngeometry’s bounding box. Example: Zipcode . objects . filter ( poly__overlaps_left = geom ) PostGIS equivalent: SELECT ... WHERE poly &< geom overlaps_right ¶ Availability : PostGIS ,\nPGRaster (Bilateral) Tests if the geometry field’s bounding box overlaps or is to the right of the lookup\ngeometry’s bounding box. Example: Zipcode . objects . filter ( poly__overlaps_right = geom ) PostGIS equivalent: SELECT ... WHERE poly &> geom overlaps_above ¶ Availability : PostGIS ,\nPGRaster (Conversion) Tests if the geometry field’s bounding box overlaps or is above the lookup\ngeometry’s bounding box. Example: Zipcode . objects . filter ( poly__overlaps_above = geom ) PostGIS equivalent: SELECT ... WHERE poly |&> geom overlaps_below ¶ Availability : PostGIS ,\nPGRaster (Conversion) Tests if the geometry field’s bounding box overlaps or is below the lookup\ngeometry’s bounding box. Example: Zipcode . objects . filter ( poly__overlaps_below = geom ) PostGIS equivalent: SELECT ... WHERE poly &<| geom strictly_above ¶ Availability : PostGIS ,\nPGRaster (Conversion) Tests if the geometry field’s bounding box is strictly above the lookup\ngeometry’s bounding box. Example: Zipcode . objects . filter ( poly__strictly_above = geom ) PostGIS equivalent: SELECT ... WHERE poly |>> geom strictly_below ¶ Availability : PostGIS ,\nPGRaster (Conversion) Tests if the geometry field’s bounding box is strictly below the lookup\ngeometry’s bounding box. Example: Zipcode . objects . filter ( poly__strictly_below = geom ) PostGIS equivalent: SELECT ... WHERE poly <<| geom Distance Lookups ¶ Availability : PostGIS, Oracle, MariaDB, MySQL, SpatiaLite, PGRaster (Native) For an overview on performing distance queries, please refer to\nthe distance queries introduction . Distance lookups take the following form: <field>__<distance lookup>=(<geometry/raster>, <distance value>[, \"spheroid\"])\n<field>__<distance lookup>=(<raster>, <band_index>, <distance value>[, \"spheroid\"])\n<field>__<band_index>__<distance lookup>=(<raster>, <band_index>, <distance value>[, \"spheroid\"]) The value passed into a distance lookup is a tuple; the first two\nvalues are mandatory, and are the geometry to calculate distances to,\nand a distance value (either a number in units of the field, a Distance object, or a query\nexpression ). To pass a band index to the lookup, use\na 3-tuple where the second entry is the band index. On every distance lookup except dwithin , an optional element, 'spheroid' , may be included to use the more accurate spheroid distance\ncalculation functions on fields with a geodetic coordinate system. On PostgreSQL, the 'spheroid' option uses ST_DistanceSpheroid instead of ST_DistanceSphere . The\nsimpler ST_Distance function is\nused with projected coordinate systems. Rasters are converted to geometries for\nspheroid based lookups. distance_gt ¶ Returns models where the distance to the geometry field from the lookup\ngeometry is greater than the given distance value. Example: Zipcode . objects . filter ( poly__distance_gt = ( geom , D ( m = 5 ))) Backend SQL Equivalent PostGIS ST_Distance/ST_Distance_Sphere(poly, geom) > 5 MariaDB ST_Distance(poly, geom) > 5 MySQL ST_Distance(poly, geom) > 5 Oracle SDO_GEOM.SDO_DISTANCE(poly, geom, 0.05) > 5 SpatiaLite Distance(poly, geom) > 5 distance_gte ¶ Returns models where the distance to the geometry field from the lookup\ngeometry is greater than or equal to the given distance value. Example: Zipcode . objects . filter ( poly__distance_gte = ( geom , D ( m = 5 ))) Backend SQL Equivalent PostGIS ST_Distance/ST_Distance_Sphere(poly, geom) >= 5 MariaDB ST_Distance(poly, geom) >= 5 MySQL ST_Distance(poly, geom) >= 5 Oracle SDO_GEOM.SDO_DISTANCE(poly, geom, 0.05) >= 5 SpatiaLite Distance(poly, geom) >= 5 distance_lt ¶ Returns models where the distance to the geometry field from the lookup\ngeometry is less than the given distance value. Example: Zipcode . objects . filter ( poly__distance_lt = ( geom , D ( m = 5 ))) Backend SQL Equivalent PostGIS ST_Distance/ST_Distance_Sphere(poly, geom) < 5 MariaDB ST_Distance(poly, geom) < 5 MySQL ST_Distance(poly, geom) < 5 Oracle SDO_GEOM.SDO_DISTANCE(poly, geom, 0.05) < 5 SpatiaLite Distance(poly, geom) < 5 distance_lte ¶ Returns models where the distance to the geometry field from the lookup\ngeometry is less than or equal to the given distance value. Example: Zipcode . objects . filter ( poly__distance_lte = ( geom , D ( m = 5 ))) Backend SQL Equivalent PostGIS ST_Distance/ST_Distance_Sphere(poly, geom) <= 5 MariaDB ST_Distance(poly, geom) <= 5 MySQL ST_Distance(poly, geom) <= 5 Oracle SDO_GEOM.SDO_DISTANCE(poly, geom, 0.05) <= 5 SpatiaLite Distance(poly, geom) <= 5 dwithin ¶ Returns models where the distance to the geometry field from the lookup\ngeometry are within the given distance from one another. Note that you can only\nprovide Distance objects if the targeted\ngeometries are in a projected system. For geographic geometries, you should use\nunits of the geometry field (e.g. degrees for WGS84 ) . Example: Zipcode . objects . filter ( poly__dwithin = ( geom , D ( m = 5 ))) Backend SQL Equivalent PostGIS ST_DWithin(poly, geom, 5) Oracle SDO_WITHIN_DISTANCE(poly, geom, 5) SpatiaLite PtDistWithin(poly, geom, 5) Aggregate Functions ¶ Django provides some GIS-specific aggregate functions. For details on how to\nuse these aggregate functions, see the topic guide on aggregation . Keyword Argument Description tolerance This keyword is for Oracle only.  It is for the\ntolerance value used by the SDOAGGRTYPE procedure; the Oracle documentation has more\ndetails. Example: >>> from django.contrib.gis.db.models import Extent , Union >>> WorldBorder . objects . aggregate ( Extent ( \"mpoly\" ), Union ( \"mpoly\" )) Collect ¶ class Collect ( geo_field , filter = None ) [source] ¶ Availability : PostGIS , MySQL,\nSpatiaLite Returns a GEOMETRYCOLLECTION or a MULTI geometry object from the geometry\ncolumn. This is analogous to a simplified version of the Union aggregate, except it can be several orders of magnitude faster than performing\na union because it rolls up geometries into a collection or multi object, not\ncaring about dissolving boundaries. Changed in Django 5.0: Support for using the filter argument was added. Changed in Django 5.1: MySQL 8.0.24+ support was added. Extent ¶ class Extent ( geo_field , filter = None ) [source] ¶ Availability : PostGIS ,\nOracle, SpatiaLite Returns the extent of all geo_field in the QuerySet as a 4-tuple,\ncomprising the lower left coordinate and the upper right coordinate. Example: >>> qs = City . objects . filter ( name__in = ( \"Houston\" , \"Dallas\" )) . aggregate ( Extent ( \"poly\" )) >>> print ( qs [ \"poly__extent\" ]) (-96.8016128540039, 29.7633724212646, -95.3631439208984, 32.782058715820) Changed in Django 5.0: Support for using the filter argument was added. Extent3D ¶ class Extent3D ( geo_field , filter = None ) [source] ¶ Availability : PostGIS Returns the 3D extent of all geo_field in the QuerySet as a 6-tuple,\ncomprising the lower left coordinate and upper right coordinate (each with x, y,\nand z coordinates). Example: >>> qs = City . objects . filter ( name__in = ( \"Houston\" , \"Dallas\" )) . aggregate ( Extent3D ( \"poly\" )) >>> print ( qs [ \"poly__extent3d\" ]) (-96.8016128540039, 29.7633724212646, 0, -95.3631439208984, 32.782058715820, 0) Changed in Django 5.0: Support for using the filter argument was added. MakeLine ¶ class MakeLine ( geo_field , filter = None ) [source] ¶ Availability : PostGIS ,\nSpatiaLite Returns a LineString constructed from the point field geometries in the QuerySet . Currently, ordering the queryset has no effect. Example: >>> qs = City . objects . filter ( name__in = ( \"Houston\" , \"Dallas\" )) . aggregate ( MakeLine ( \"poly\" )) >>> print ( qs [ \"poly__makeline\" ]) LINESTRING (-95.3631510000000020 29.7633739999999989, -96.8016109999999941 32.7820570000000018) Changed in Django 5.0: Support for using the filter argument was added. Union ¶ class Union ( geo_field , filter = None ) [source] ¶ Availability : PostGIS ,\nOracle, SpatiaLite This method returns a GEOSGeometry object\ncomprising the union of every geometry in the queryset. Please note that use of Union is processor intensive and may take a significant amount of time on\nlarge querysets. Note If the computation time for using this method is too expensive, consider\nusing Collect instead. Example: >>> u = Zipcode . objects . aggregate ( Union ( poly )) # This may take a long time. >>> u = Zipcode . objects . filter ( poly__within = bbox ) . aggregate ( ... Union ( poly ) ... ) # A more sensible approach. Changed in Django 5.0: Support for using the filter argument was added. Footnotes [ 1 ] See OpenGIS Simple Feature Specification For SQL , at Ch. 2.1.13.2, p. 2-13 (The Dimensionally Extended Nine-Intersection Model). [ 2 ] See SDO_RELATE documentation , from the Oracle Spatial and\nGraph Developer’s Guide. [ 3 ] ( 1 , 2 ) For an explanation of this routine, read Quirks of the “Contains” Spatial Predicate by Martin Davis (a PostGIS developer).", "keywords": ["users", "box", "poly__disjoint", "feature", "pattern", "within(poly", "b", "field", "#", "touch", "relation", "raster", "poly__relate", "+", "st_contains(st_polygon(rast", "p.", "sdo_touch(poly", "compatibility", "-95.3631510000000020", "coordinate", "mbrwithin(poly", "exterior", "=", "graph", "categories", "relationship", "n", "inputs", "poly__within", "poly__dwithin", "quirks", "spheroid", "magnitude", "inside", "field>__<distance", "topic", "collection", "type", "objects", "documentation", "lookups", "st_polygon(rst", "django.contrib.gis.db.models", "touches(poly", "sides", "makeline", "time", "operators", "poly__makeline", "parameter", "backends", "reference", "st_distance_sphere(poly", "disjoint", "poly__intersects", "overlaps_right", "queries", "nine", "multi", "overlaps(poly", "ch", "overlaps", "poly__strictly_above", "z", "operator", "computation", "exact", "sdo_covers(poly", "examples", "davis", "equal", "geometry", "filter", "c", "class", "st_touches(poly", "st_within(poly", "zipcode", "mbrcontains(poly", "returns", "rast", "x", "u", "geo_field", "rast__1__contains", "database", "input", "*", "query", "postgresql", "types", "strings", ".", "sdo_contains(poly", "poly__touches", "dwithin", "overlapbdyintersect", "dimensionally", "covers(poly", "section", "sdo_equal(poly", "developer", "source", "specification", "boundaries", "anyinteract", "use", "left", "bbox", "explanation", "poly", "sdo_coveredby(poly", "poly__left", "same_as", "name__in", "st_crosses(poly", "extended", "poly__extent", "form", "option", "st_distance", "expression", "tests", "characters", "st_distancesphere", "equality", "st_overlaps(poly", "rast__crosses", "contains", "inside+touch", "f", "st_contains(rast", "poly__crosses", "poly__overlaps_below", "mbroverlaps(poly", "distance_gt", "way", "boxes", "poly__distance_lte", "t", "index", "queryset", "¶", "sdo_inside(poly", "disjoint(poly", "st_distance(poly", "ptdistwithin(poly", "function", "worldborder", "sdo_relate", "extent", "number", "right", "point", "values", "st_contains(poly", "string", "8.0.24", "city", "aggregate", "poly__isvalid", "overview", "availability", "degrees", "crosses(poly", "table", "sdo_within_distance(poly", "models", "querysets", "tolerance", "bilateral", "version", "processor", "wgs84", "routine", "gis", "bounding", "st_dwithin(poly", "on", "django", "poly__bboverlaps", "fields", "print", "entry", "geometrycollection", "poly__strictly_below", "value", "relate", "or", "tune", "data", "orders", "predicate", "backend", "guide", "rast__1__crosses=(rst", "intersections", "st_intersects(poly", "aggregation", "geometries", "poly__contains", "|", "extent3d", "strictly_above", "spatial", "poly__distance_gt", "st_polygon", "rst", "distance_lte", "object", "calculation", "lookup>=(<geometry", "sdo_overlaps(poly", "poly__overlaps_right", "sql", "poly__coveredby", "~=", "keyword", "distance(poly", "dallas", "conversion", "contains_properly", "qs", "intersection", "effect", "system", "-96.8016128540039", "interior", "sdoaggrtype", "distance_lt", "spatialite", "poly__equals", "rasterfield", "native", "procedure", "covers", "t*t***ff", "example", "houston", "bbcontains", "geosgeometry", "poly__covers", "column", "coveredby", "poly__distance_gte", "distances", "poly__overlaps_above", "model", "poly__overlaps_left", "poly__bbcontains", "systems", "element", "martin", "boundary", "coveredby(poly", "approach", "st_equals(poly", "y", "overlaps_left", "field>__<band_index>__<distance", "coordinates", "overlapbdydisjoint", "case", "equivalent", "equals(poly", "lookup", "rast__1__contains=(rst", "tuple", "pgraster", "introduction", "st_crosses(st_polygon(rast", "amount", "functions", "collect", "none", "intersects(poly", "mariadb", "contains(poly", "overlaps_above", "geom", "rasters", "api", "geometryfield", "support", "description", "linestring", "units", "overlaps_below", "import", "d", "poly__distance_lt", "poly__right", "mysql", "union", "st_disjoint(poly", "st_distancespheroid", "strictly_below", "footnotes", "rast__contains", "details", "method", "matrix", "argument", "2.1.13.2", "oracle", "band", "sdo_overlapbdyintersect(poly", "distance"], "type": "documentation"},
{"title": "The form rendering API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/forms/renderers/", "content": "The form rendering API ¶ Django’s form widgets are rendered using Django’s template engines\nsystem . The form rendering process can be customized at several levels: Widgets can specify custom template names. Forms and widgets can specify custom renderer classes. A widget’s template can be overridden by a project. (Reusable applications\ntypically shouldn’t override built-in templates because they might conflict\nwith a project’s custom templates.) The low-level render API ¶ The rendering of form templates is controlled by a customizable renderer class.\nA custom renderer can be specified by updating the FORM_RENDERER setting. It defaults to ' django.forms.renderers.DjangoTemplates ' . By specifying a custom form renderer and overriding form_template_name you can adjust the default form\nmarkup across your project from a single place. You can also provide a custom renderer per-form or per-widget by setting the Form.default_renderer attribute or by using the renderer argument\nof Form.render() , or Widget.render() . Matching points apply to formset rendering. See Using a formset in views and templates for\ndiscussion. Use one of the built-in template form renderers or implement your own. Custom renderers\nmust implement a render(template_name, context, request=None) method. It\nshould return a rendered templates (as a string) or raise TemplateDoesNotExist . class BaseRenderer [source] ¶ The base class for the built-in form renderers. form_template_name ¶ The default name of the template to use to render a form. Defaults to \"django/forms/div.html\" template. formset_template_name ¶ The default name of the template to use to render a formset. Defaults to \"django/forms/formsets/div.html\" template. field_template_name ¶ New in Django 5.0. The default name of the template used to render a BoundField . Defaults to \"django/forms/field.html\" get_template ( template_name ) [source] ¶ Subclasses must implement this method with the appropriate template\nfinding logic. render ( template_name , context , request = None ) [source] ¶ Renders the given template, or raises TemplateDoesNotExist . Built-in-template form renderers ¶ DjangoTemplates ¶ class DjangoTemplates [source] ¶ This renderer uses a standalone DjangoTemplates engine (unconnected to what you might have configured in the TEMPLATES setting). It loads templates first from the built-in form\ntemplates directory in django/forms/templates and then from the\ninstalled apps’ templates directories using the app_directories loader. If you want to render templates with customizations from your TEMPLATES setting, such as context processors for example, use the TemplatesSetting renderer. class DjangoDivFormRenderer [source] ¶ Deprecated since version 5.0. The alias of DjangoTemplates . Jinja2 ¶ class Jinja2 [source] ¶ This renderer is the same as the DjangoTemplates renderer except that\nit uses a Jinja2 backend. Templates\nfor the built-in widgets are located in django/forms/jinja2 and\ninstalled apps can provide templates in a jinja2 directory. To use this backend, all the forms and widgets in your project and its\nthird-party apps must have Jinja2 templates. Unless you provide your own Jinja2\ntemplates for widgets that don’t have any, you can’t use this renderer. For\nexample, django.contrib.admin doesn’t include Jinja2 templates for its\nwidgets due to their usage of Django template tags. class Jinja2DivFormRenderer [source] ¶ Deprecated since version 5.0. The alias of Jinja2 . TemplatesSetting ¶ class TemplatesSetting [source] ¶ This renderer gives you complete control of how form and widget templates are\nsourced. It uses get_template() to find templates\nbased on what’s configured in the TEMPLATES setting. Using this renderer along with the built-in templates requires either: 'django.forms' in INSTALLED_APPS and at least one engine\nwith APP_DIRS=True . Adding the built-in templates directory in DIRS of one of your template engines. To generate that path: import django django . __path__ [ 0 ] + \"/forms/templates\" # or '/forms/jinja2' Using this renderer requires you to make sure the form templates your project\nneeds can be located. Context available in formset templates ¶ Formset templates receive a context from BaseFormSet.get_context() . By\ndefault, formsets receive a dictionary with the following values: formset : The formset instance. Context available in form templates ¶ Form templates receive a context from Form.get_context() . By default,\nforms receive a dictionary with the following values: form : The bound form. fields : All bound fields, except the hidden fields. hidden_fields : All hidden bound fields. errors : All non field related or hidden field related form errors. Context available in field templates ¶ New in Django 5.0. Field templates receive a context from BoundField.get_context() . By\ndefault, fields receive a dictionary with the following values: field : The BoundField . Context available in widget templates ¶ Widget templates receive a context from Widget.get_context() . By\ndefault, widgets receive a single value in the context, widget . This is a\ndictionary that contains values like: name value attrs is_hidden template_name Some widgets add further information to the context. For instance, all widgets\nthat subclass Input defines widget['type'] and MultiWidget defines widget['subwidgets'] for looping purposes. Overriding built-in formset templates ¶ BaseFormSet.template_name To override formset templates, you must use the TemplatesSetting renderer. Then overriding formset templates works the same as overriding any other template in your project. Overriding built-in form templates ¶ Form.template_name To override form templates, you must use the TemplatesSetting renderer. Then overriding form templates works the same as overriding any other template in your project. Overriding built-in field templates ¶ New in Django 5.0. Field.template_name To override field templates, you must use the TemplatesSetting renderer. Then overriding field templates works the same as overriding any other template in your project. Overriding built-in widget templates ¶ Each widget has a template_name attribute with a value such as input.html . Built-in widget templates are stored in the django/forms/widgets path. You can provide a custom template for input.html by defining django/forms/widgets/input.html , for example.\nSee Built-in widgets for the name of each widget’s template. To override widget templates, you must use the TemplatesSetting renderer. Then overriding widget templates works the same as overriding any other template in your project.", "keywords": ["views", "field.html", "control", "widgets", "dirs", "formset", "form.template_name", "formsets", "forms", "values", "renderers", "directories", "string", "class", "example", "field", "#", "widget", "app_dirs", "django.forms", "names", "jinja2", "request", "formset_template_name", "input", "version", "level", "form_template_name", "widget['type", "form.render", "form.get_context", "needs", "place", "render(template_name", "usage", "django", "finding", "=", "fields", "engine", "value", "input.html", "source", "discussion", "form_renderer", "process", "django.forms.renderers", "base", "backend", "errors", "boundfield.get_context", "engines", "subclasses", "custom", "instance", "djangotemplates", "matching", "jinja2divformrenderer", "levels", "default", "widget['subwidgets", "get_template", "hidden_fields", "loader", "form.default_renderer", "markup", "processors", "path", "multiwidget", "alias", "renderer", "form", "attribute", "none", "classes", "tags", "render", "new", "setting", "baserenderer", "purposes", "api", "field_template_name", "templatedoesnotexist", "context", "logic", "import", "name", "widget.get_context", "template", "directory", "is_hidden", "defaults", "dictionary", "points", "information", "rendering", "template_name", "customizations", "attrs", "party", "method", "app_directories", "django.contrib.admin", "argument", "¶", "applications", "baseformset.get_context", "widget.render", "system", "apps", "boundfield", "div.html", "templates", "renders", "templatessetting", "project", "djangodivformrenderer"], "type": "documentation"},
{"title": "GeoDjango Forms API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/forms-api/", "content": "GeoDjango Forms API ¶ GeoDjango provides some specialized form fields and widgets in order to visually\ndisplay and edit geolocalized data on a map. By default, they use OpenLayers -powered maps, with a base WMS layer provided by NASA . Field arguments ¶ In addition to the regular form field arguments ,\nGeoDjango form fields take the following optional arguments. srid ¶ Field. srid ¶ This is the SRID code that the field value should be transformed to. For\nexample, if the map widget SRID is different from the SRID more generally\nused by your application or database, the field will automatically convert\ninput values into that SRID. geom_type ¶ Field. geom_type ¶ You generally shouldn’t have to set or change that attribute which should\nbe set up depending on the field class. It matches the OpenGIS standard\ngeometry name. Form field classes ¶ GeometryField ¶ class GeometryField [source] ¶ PointField ¶ class PointField [source] ¶ LineStringField ¶ class LineStringField [source] ¶ PolygonField ¶ class PolygonField [source] ¶ MultiPointField ¶ class MultiPointField [source] ¶ MultiLineStringField ¶ class MultiLineStringField [source] ¶ MultiPolygonField ¶ class MultiPolygonField [source] ¶ GeometryCollectionField ¶ class GeometryCollectionField [source] ¶ Form widgets ¶ GeoDjango form widgets allow you to display and edit geographic data on a\nvisual map.\nNote that none of the currently available widgets supports 3D geometries, hence\ngeometry fields will fallback using a Textarea widget for such data. Widget attributes ¶ GeoDjango widgets are template-based, so their attributes are mostly different\nfrom other Django widget attributes. BaseGeometryWidget. geom_type ¶ The OpenGIS geometry type, generally set by the form field. BaseGeometryWidget. map_srid ¶ SRID code used by the map (default is 4326). BaseGeometryWidget. display_raw ¶ Boolean value specifying if a textarea input showing the serialized\nrepresentation of the current geometry is visible, mainly for debugging\npurposes (default is False ). BaseGeometryWidget. supports_3d ¶ Indicates if the widget supports edition of 3D data (default is False ). BaseGeometryWidget. template_name ¶ The template used to render the map widget. You can pass widget attributes in the same manner that for any other Django\nwidget. For example: from django.contrib.gis import forms class MyGeoForm ( forms . Form ): point = forms . PointField ( widget = forms . OSMWidget ( attrs = { \"display_raw\" : True })) Widget classes ¶ BaseGeometryWidget class BaseGeometryWidget [source] ¶ This is an abstract base widget containing the logic needed by subclasses.\nYou cannot directly use this widget for a geometry field.\nNote that the rendering of GeoDjango widgets is based on a template,\nidentified by the template_name class attribute. OpenLayersWidget class OpenLayersWidget [source] ¶ This is the default widget used by all GeoDjango form fields. template_name is gis/openlayers.html . OpenLayersWidget and OSMWidget use the ol.js file hosted\non the cdn.jsdelivr.net content-delivery network. You can subclass\nthese widgets in order to specify your own version of the ol.js file in\nthe js property of the inner Media class (see Assets as a static definition ). OSMWidget class OSMWidget [source] ¶ This widget uses an OpenStreetMap base layer to display geographic objects\non. Attributes are: template_name ¶ gis/openlayers-osm.html default_lat ¶ default_lon ¶ The default center latitude and longitude are 47 and 5 ,\nrespectively, which is a location in eastern France. default_zoom ¶ The default map zoom is 12 . The OpenLayersWidget note about JavaScript file hosting above also\napplies here. See also this FAQ answer about https access to map\ntiles.", "keywords": ["widgets", "definition", "multilinestringfield", "maps", "center", "geometry", "code", "point", "forms", "values", "zoom", "addition", "display", "example", "field", "class", "access", "france", "widget", "longitude", "javascript", "answer", "database", "input", "representation", "location", "cdn.jsdelivr.net", "map", "version", "basegeometrywidget", "gis", "application", "delivery", "attributes", "geom_type", "django", "=", "fields", "3d", "value", "media", "source", "openlayerswidget", "openlayers", "data", "base", "tiles", "network", "ol.js", "layer", "arguments", "type", "subclasses", "display_raw", "objects", "file", "geometries", "order", "wms", "default", "pointfield", "linestringfield", "latitude", "osmwidget", "polygonfield", "form", "attribute", "multipolygonfield", "js", "none", "django.contrib.gis", "assets", "purposes", "faq", "geometryfield", "api", "nasa", "textarea", "edit", "logic", "multipointfield", "import", "name", "default_lat", "template", "default_lon", "edition", "supports_3d", "rendering", "map_srid", "attrs", "geometrycollectionfield", "geodjango", "¶", "note", "property", "openlayers.html", "manner", "srid", "content"], "type": "documentation"},
{"title": "Constraints reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/constraints/", "content": "Constraints reference ¶ The classes defined in this module create database constraints. They are added\nin the model Meta.constraints option. Referencing built-in constraints Constraints are defined in django.db.models.constraints , but for\nconvenience they’re imported into django.db.models . The standard\nconvention is to use from django.db import models and refer to the\nconstraints as models.<Foo>Constraint . Constraints in abstract base classes You must always specify a unique name for the constraint. As such, you\ncannot normally specify a constraint on an abstract base class, since the Meta.constraints option is\ninherited by subclasses, with exactly the same values for the attributes\n(including name ) each time. To work around name collisions, part of the\nname may contain '%(app_label)s' and '%(class)s' , which are\nreplaced, respectively, by the lowercased app label and class name of the\nconcrete model. For example CheckConstraint(condition=Q(age__gte=18), name='%(app_label)s_%(class)s_is_adult') . Validation of Constraints Constraints are checked during the model validation . BaseConstraint ¶ class BaseConstraint ( * name , violation_error_code = None , violation_error_message = None ) [source] ¶ Base class for all constraints. Subclasses must implement constraint_sql() , create_sql() , remove_sql() and validate() methods. Deprecated since version 5.0: Support for passing positional arguments is deprecated. All constraints have the following parameters in common: name ¶ BaseConstraint. name ¶ The name of the constraint. You must always specify a unique name for the\nconstraint. violation_error_code ¶ New in Django 5.0. BaseConstraint. violation_error_code ¶ The error code used when ValidationError is raised during model validation . Defaults to None . violation_error_message ¶ BaseConstraint. violation_error_message ¶ The error message used when ValidationError is raised during model validation . Defaults to \"Constraint “%(name)s” is violated.\" . validate() ¶ BaseConstraint. validate ( model , instance , exclude = None , using = DEFAULT_DB_ALIAS ) [source] ¶ Validates that the constraint, defined on model , is respected on the instance . This will do a query on the database to ensure that the\nconstraint is respected. If fields in the exclude list are needed to\nvalidate the constraint, the constraint is ignored. Raise a ValidationError if the constraint is violated. This method must be implemented by a subclass. CheckConstraint ¶ class CheckConstraint ( * , condition , name , violation_error_code = None , violation_error_message = None ) [source] ¶ Creates a check constraint in the database. condition ¶ CheckConstraint. condition ¶ A Q object or boolean Expression that\nspecifies the conditional check you want the constraint to enforce. For example, CheckConstraint(condition=Q(age__gte=18), name='age_gte_18') ensures the age field is never less than 18. Expression order Q argument order is not necessarily preserved, however the order of Q expressions themselves are preserved. This may be important for\ndatabases that preserve check constraint expression order for performance\nreasons. For example, use the following format if order matters: CheckConstraint ( condition = Q ( age__gte = 18 ) & Q ( expensive_check = condition ), name = \"age_gte_18_and_others\" , ) Oracle < 23c Checks with nullable fields on Oracle < 23c must include a condition\nallowing for NULL values in order for validate() to behave the same as check constraints validation. For example, if age is a nullable field: CheckConstraint ( condition = Q ( age__gte = 18 ) | Q ( age__isnull = True ), name = \"age_gte_18\" ) Deprecated since version 5.1: The check attribute is deprecated in favor of condition . UniqueConstraint ¶ class UniqueConstraint ( * expressions , fields = () , name = None , condition = None , deferrable = None , include = None , opclasses = () , nulls_distinct = None , violation_error_code = None , violation_error_message = None ) [source] ¶ Creates a unique constraint in the database. expressions ¶ UniqueConstraint. expressions ¶ Positional argument *expressions allows creating functional unique\nconstraints on expressions and database functions. For example: UniqueConstraint ( Lower ( \"name\" ) . desc (), \"category\" , name = \"unique_lower_name_category\" ) creates a unique constraint on the lowercased value of the name field in\ndescending order and the category field in the default ascending order. Functional unique constraints have the same database restrictions as Index.expressions . fields ¶ UniqueConstraint. fields ¶ A list of field names that specifies the unique set of columns you want the\nconstraint to enforce. For example, UniqueConstraint(fields=['room', 'date'], name='unique_booking') ensures each room can only be booked once for each\ndate. condition ¶ UniqueConstraint. condition ¶ A Q object that specifies the condition you want the constraint to\nenforce. For example: UniqueConstraint ( fields = [ \"user\" ], condition = Q ( status = \"DRAFT\" ), name = \"unique_draft_user\" ) ensures that each user only has one draft. These conditions have the same database restrictions as Index.condition . deferrable ¶ UniqueConstraint. deferrable ¶ Set this parameter to create a deferrable unique constraint. Accepted values\nare Deferrable.DEFERRED or Deferrable.IMMEDIATE . For example: from django.db.models import Deferrable , UniqueConstraint UniqueConstraint ( name = \"unique_order\" , fields = [ \"order\" ], deferrable = Deferrable . DEFERRED , ) By default constraints are not deferred. A deferred constraint will not be\nenforced until the end of the transaction. An immediate constraint will be\nenforced immediately after every command. MySQL, MariaDB, and SQLite. Deferrable unique constraints are ignored on MySQL, MariaDB, and SQLite as\nneither supports them. Warning Deferred unique constraints may lead to a performance penalty . include ¶ UniqueConstraint. include ¶ A list or tuple of the names of the fields to be included in the covering\nunique index as non-key columns. This allows index-only scans to be used for\nqueries that select only included fields ( include )\nand filter only by unique fields ( fields ). For example: UniqueConstraint ( name = \"unique_booking\" , fields = [ \"room\" , \"date\" ], include = [ \"full_name\" ]) will allow filtering on room and date , also selecting full_name ,\nwhile fetching data only from the index. Unique constraints with non-key columns are ignored for databases besides\nPostgreSQL. Non-key columns have the same database restrictions as Index.include . opclasses ¶ UniqueConstraint. opclasses ¶ The names of the PostgreSQL operator classes to use for\nthis unique index. If you require a custom operator class, you must provide one\nfor each field in the index. For example: UniqueConstraint ( name = \"unique_username\" , fields = [ \"username\" ], opclasses = [ \"varchar_pattern_ops\" ] ) creates a unique index on username using varchar_pattern_ops . opclasses are ignored for databases besides PostgreSQL. nulls_distinct ¶ New in Django 5.0. UniqueConstraint. nulls_distinct ¶ Whether rows containing NULL values covered by the unique constraint should\nbe considered distinct from each other. The default value is None which\nuses the database default which is True on most backends. For example: UniqueConstraint ( name = \"ordering\" , fields = [ \"ordering\" ], nulls_distinct = False ) creates a unique constraint that only allows one row to store a NULL value\nin the ordering column. Unique constraints with nulls_distinct are ignored for databases besides\nPostgreSQL 15+. violation_error_code ¶ New in Django 5.0. UniqueConstraint. violation_error_code ¶ The error code used when ValidationError is raised during model validation . Defaults to None . This code is not used for UniqueConstraint s with fields and without a condition . Such UniqueConstraint s have the\nsame error code as constraints defined with Field.unique or in Meta.unique_together . violation_error_message ¶ UniqueConstraint. violation_error_message ¶ The error message used when ValidationError is raised during model validation . Defaults to BaseConstraint.violation_error_message . This message is not used for UniqueConstraint s with fields and without a condition . Such UniqueConstraint s show the\nsame message as constraints defined with Field.unique or in Meta.unique_together .", "keywords": ["rows", "django.db.models.constraints", "category", "username", "status", "checkconstraint(condition", "q(age__gte=18", "error", "conditions", "module", "check", "code", "values", "class", "example", "field", "<", "app", "show", "validates", "column", "list", "age_gte_18", "favor", "names", "desc", "databases", "field.unique", "+", "app_label)s", "age_gte_18_and_others", "database", "exclude", "full_name", "lower", "remove_sql", "*", "models", "query", "draft", "age__gte", "postgresql", "version", "index.condition", "model", "subclass", "reasons", "create_sql", "attributes", "condition", "label", "violation_error_message", "django", "name)s", "=", "fields", "message", "set", "validation", "meta.unique_together", "unique_order", "unique_booking", "deferrable", "value", "uniqueconstraint", "source", "columns", "data", "null", "base", "room", "tuple", "arguments", "varchar_pattern_ops", "violation_error_code", "name='%(app_label)s_%(class)s_is_adult", "subclasses", "index.include", "instance", "performance", "custom", "end", "sqlite", "constraint", "order", "default", "standard", "user", "|", "functions", "attribute", "none", "option", "format", "classes", "expression", "constraints", "collisions", "time", "checkconstraint", "convention", "opclasses", "q", "date", "constraint_sql", "new", "unique_draft_user", "baseconstraint.violation_error_message", "convenience", "part", "support", "validationerror", "object", "scans", "import", "name", "parameter", "mysql", "%", "defaults", "penalty", "backends", "reference", "row", "checks", "age", "ascending", "baseconstraint", "methods", "name='age_gte_18", "s", "meta.constraints", "queries", "index", "ordering", "validate", "class)s", "method", "covering", "transaction", "argument", "¶", "command", "expensive_check", "operator", "parameters", "expressions", "oracle", "filtering", "restrictions"], "type": "documentation"},
{"title": "PostgreSQL specific form fields and widgets | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/forms/", "content": "PostgreSQL specific form fields and widgets ¶ All of these fields and widgets are available from the django.contrib.postgres.forms module. Fields ¶ SimpleArrayField ¶ class SimpleArrayField ( base_field , delimiter = ',' , max_length = None , min_length = None ) ¶ A field which maps to an array. It is represented by an HTML <input> . base_field ¶ This is a required argument. It specifies the underlying form field for the array. This is not used\nto render any HTML, but it is used to process the submitted data and\nvalidate it. For example: >>> from django import forms >>> from django.contrib.postgres.forms import SimpleArrayField >>> class NumberListForm ( forms . Form ): ... numbers = SimpleArrayField ( forms . IntegerField ()) ... >>> form = NumberListForm ({ \"numbers\" : \"1,2,3\" }) >>> form . is_valid () True >>> form . cleaned_data {'numbers': [1, 2, 3]} >>> form = NumberListForm ({ \"numbers\" : \"1,2,a\" }) >>> form . is_valid () False delimiter ¶ This is an optional argument which defaults to a comma: , . This\nvalue is used to split the submitted data. It allows you to chain SimpleArrayField for multidimensional data: >>> from django import forms >>> from django.contrib.postgres.forms import SimpleArrayField >>> class GridForm ( forms . Form ): ... places = SimpleArrayField ( SimpleArrayField ( IntegerField ()), delimiter = \"|\" ) ... >>> form = GridForm ({ \"places\" : \"1,2|2,1|4,3\" }) >>> form . is_valid () True >>> form . cleaned_data {'places': [[1, 2], [2, 1], [4, 3]]} Note The field does not support escaping of the delimiter, so be careful\nin cases where the delimiter is a valid character in the underlying\nfield. The delimiter does not need to be only one character. max_length ¶ This is an optional argument which validates that the array does not\nexceed the stated length. min_length ¶ This is an optional argument which validates that the array reaches at\nleast the stated length. User friendly forms SimpleArrayField is not particularly user friendly in most cases,\nhowever it is a useful way to format data from a client-side widget for\nsubmission to the server. SplitArrayField ¶ class SplitArrayField ( base_field , size , remove_trailing_nulls = False ) ¶ This field handles arrays by reproducing the underlying field a fixed\nnumber of times. base_field ¶ This is a required argument. It specifies the form field to be\nrepeated. size ¶ This is the fixed number of times the underlying field will be used. remove_trailing_nulls ¶ By default, this is set to False . When False , each value from\nthe repeated fields is stored. When set to True , any trailing\nvalues which are blank will be stripped from the result. If the\nunderlying field has required=True , but remove_trailing_nulls is True , then null values are only allowed at the end, and will be\nstripped. Some examples: SplitArrayField ( IntegerField ( required = True ), size = 3 , remove_trailing_nulls = False ) [ \"1\" , \"2\" , \"3\" ] # -> [1, 2, 3] [ \"1\" , \"2\" , \"\" ] # -> ValidationError - third entry required. [ \"1\" , \"\" , \"3\" ] # -> ValidationError - second entry required. [ \"\" , \"2\" , \"\" ] # -> ValidationError - first and third entries required. SplitArrayField ( IntegerField ( required = False ), size = 3 , remove_trailing_nulls = False ) [ \"1\" , \"2\" , \"3\" ] # -> [1, 2, 3] [ \"1\" , \"2\" , \"\" ] # -> [1, 2, None] [ \"1\" , \"\" , \"3\" ] # -> [1, None, 3] [ \"\" , \"2\" , \"\" ] # -> [None, 2, None] SplitArrayField ( IntegerField ( required = True ), size = 3 , remove_trailing_nulls = True ) [ \"1\" , \"2\" , \"3\" ] # -> [1, 2, 3] [ \"1\" , \"2\" , \"\" ] # -> [1, 2] [ \"1\" , \"\" , \"3\" ] # -> ValidationError - second entry required. [ \"\" , \"2\" , \"\" ] # -> ValidationError - first entry required. SplitArrayField ( IntegerField ( required = False ), size = 3 , remove_trailing_nulls = True ) [ \"1\" , \"2\" , \"3\" ] # -> [1, 2, 3] [ \"1\" , \"2\" , \"\" ] # -> [1, 2] [ \"1\" , \"\" , \"3\" ] # -> [1, None, 3] [ \"\" , \"2\" , \"\" ] # -> [None, 2] HStoreField ¶ class HStoreField ¶ A field which accepts JSON encoded data for an HStoreField . It casts all values\n(except nulls) to strings. It is represented by an HTML <textarea> . User friendly forms HStoreField is not particularly user friendly in most cases,\nhowever it is a useful way to format data from a client-side widget for\nsubmission to the server. Note On occasions it may be useful to require or restrict the keys which are\nvalid for a given field. This can be done using the KeysValidator . Range Fields ¶ This group of fields all share similar functionality for accepting range data.\nThey are based on MultiValueField . They treat one\nomitted value as an unbounded range. They also validate that the lower bound is\nnot greater than the upper bound. All of these fields use RangeWidget . IntegerRangeField ¶ class IntegerRangeField ¶ Based on IntegerField and translates its input into django.db.backends.postgresql.psycopg_any.NumericRange . Default for IntegerRangeField and BigIntegerRangeField . DecimalRangeField ¶ class DecimalRangeField ¶ Based on DecimalField and translates its input into django.db.backends.postgresql.psycopg_any.NumericRange . Default for DecimalRangeField . DateTimeRangeField ¶ class DateTimeRangeField ¶ Based on DateTimeField and translates its input into django.db.backends.postgresql.psycopg_any.DateTimeTZRange . Default for DateTimeRangeField . DateRangeField ¶ class DateRangeField ¶ Based on DateField and translates its input into django.db.backends.postgresql.psycopg_any.DateRange . Default for DateRangeField . Widgets ¶ RangeWidget ¶ class RangeWidget ( base_widget , attrs = None ) ¶ Widget used by all of the range fields.\nBased on MultiWidget . RangeWidget has one required argument: base_widget ¶ A RangeWidget comprises a 2-tuple of base_widget . decompress ( value ) ¶ Takes a single “compressed” value of a field, for example a DateRangeField ,\nand returns a tuple representing a lower and upper bound.", "keywords": ["django.db.backends.postgresql.psycopg_any", "examples", "result", "rangewidget", "widgets", "integerfield", "number", "module", "occasions", "forms", "values", "decimalfield", "false", "keysvalidator", "array", "class", "example", "field", "#", "decimalrangefield", "datetimerangefield", "group", "widget", "numbers", "input", "range", "datefield", "json", "strings", "daterange", "remove_trailing_nulls", "bound", "django", "=", "max_length", "fields", "entry", "character", "value", "django.contrib.postgres.forms", "cleaned_data", "keys", "multivaluefield", "data", "length", "places", "html", "tuple", "server", "submission", "a", "delimiter", "end", "entries", "default", "user", "is_valid", "cases", "multiwidget", "functionality", "arrays", "form", "none", "simplearrayfield", "comma", "size", "integerrangefield", "true", "hstorefield", "validationerror", "third", "textarea", "import", "1,2,a", "numberlistform", "decompress", "splitarrayfield", "way", "escaping", "gridform", "min_length", "times", "daterangefield", "base_widget", "client", "bigintegerrangefield", "attrs", "argument", "¶", "side", "nulls", "datetimefield"], "type": "documentation"},
{"title": "Model field reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/fields/", "content": "Model field reference ¶ This document contains all the API references of Field including the field options and field types Django offers. See also If the built-in fields don’t do the trick, you can try django-localflavor ( documentation ), which contains assorted\npieces of code that are useful for particular countries and cultures. Also, you can easily write your own custom model fields . Note Fields are defined in django.db.models.fields , but for convenience\nthey’re imported into django.db.models . The standard convention is\nto use from django.db import models and refer to fields as models.<Foo>Field . Field options ¶ The following arguments are available to all field types. All are optional. null ¶ Field. null ¶ If True , Django will store empty values as NULL in the database. Default\nis False . Avoid using null on string-based fields such as CharField and TextField . If a string-based field has null=True , that means it has two possible values for “no data”: NULL ,\nand the empty string. In most cases, it’s redundant to have two possible values\nfor “no data;” the Django convention is to use the empty string, not NULL . One exception is when a CharField has both unique=True and blank=True set. In this situation, null=True is required to avoid\nunique constraint violations when saving multiple objects with blank values. For both string-based and non-string-based fields, you will also need to\nset blank=True if you wish to permit empty values in forms, as the null parameter only affects database storage\n(see blank ). Note When using the Oracle database backend, the value NULL will be stored to\ndenote the empty string regardless of this attribute. blank ¶ Field. blank ¶ If True , the field is allowed to be blank. Default is False . Note that this is different than null . null is\npurely database-related, whereas blank is validation-related. If\na field has blank=True , form validation will allow entry of an empty value.\nIf a field has blank=False , the field will be required. Supplying missing values blank=True can be used with fields having null=False , but this will\nrequire implementing clean() on the model in\norder to programmatically supply any missing values. choices ¶ Field. choices [source] ¶ A mapping or iterable in the format described below to use as choices for this\nfield. If choices are given, they’re enforced by model validation and the default form widget will\nbe a select box with these choices instead of the standard text field. If a mapping is given, the key element is the actual value to be set on the\nmodel, and the second element is the human readable name. For example: YEAR_IN_SCHOOL_CHOICES = { \"FR\" : \"Freshman\" , \"SO\" : \"Sophomore\" , \"JR\" : \"Junior\" , \"SR\" : \"Senior\" , \"GR\" : \"Graduate\" , } You can also pass a sequence consisting itself of iterables of exactly\ntwo items (e.g. [(A1, B1), (A2, B2), …] ). The first element in each tuple\nis the actual value to be set on the model, and the second element is the\nhuman-readable name. For example: YEAR_IN_SCHOOL_CHOICES = [ ( \"FR\" , \"Freshman\" ), ( \"SO\" , \"Sophomore\" ), ( \"JR\" , \"Junior\" ), ( \"SR\" , \"Senior\" ), ( \"GR\" , \"Graduate\" ), ] choices can also be defined as a callable that expects no arguments and\nreturns any of the formats described above. For example: def get_currencies (): return { i : i for i in settings . CURRENCIES } class Expense ( models . Model ): amount = models . DecimalField ( max_digits = 10 , decimal_places = 2 ) currency = models . CharField ( max_length = 3 , choices = get_currencies ) Passing a callable for choices can be particularly handy when, for example,\nthe choices are: the result of I/O-bound operations (which could potentially be cached), such\nas querying a table in the same or an external database, or accessing the\nchoices from a static file. a list that is mostly stable but could vary from time to time or from\nproject to project. Examples in this category are using third-party apps that\nprovide a well-known inventory of values, such as currencies, countries,\nlanguages, time zones, etc. Changed in Django 5.0: Support for mappings and callables was added. Generally, it’s best to define choices inside a model class, and to\ndefine a suitably-named constant for each value: from django.db import models class Student ( models . Model ): FRESHMAN = \"FR\" SOPHOMORE = \"SO\" JUNIOR = \"JR\" SENIOR = \"SR\" GRADUATE = \"GR\" YEAR_IN_SCHOOL_CHOICES = { FRESHMAN : \"Freshman\" , SOPHOMORE : \"Sophomore\" , JUNIOR : \"Junior\" , SENIOR : \"Senior\" , GRADUATE : \"Graduate\" , } year_in_school = models . CharField ( max_length = 2 , choices = YEAR_IN_SCHOOL_CHOICES , default = FRESHMAN , ) def is_upperclass ( self ): return self . year_in_school in { self . JUNIOR , self . SENIOR } Though you can define a choices list outside of a model class and then\nrefer to it, defining the choices and names for each choice inside the\nmodel class keeps all of that information with the class that uses it,\nand helps reference the choices (e.g, Student.SOPHOMORE will work anywhere that the Student model has been imported). You can also collect your available choices into named groups that can\nbe used for organizational purposes: MEDIA_CHOICES = { \"Audio\" : { \"vinyl\" : \"Vinyl\" , \"cd\" : \"CD\" , }, \"Video\" : { \"vhs\" : \"VHS Tape\" , \"dvd\" : \"DVD\" , }, \"unknown\" : \"Unknown\" , } The key of the mapping is the name to apply to the group and the value is the\nchoices inside that group, consisting of the field value and a human-readable\nname for an option. Grouped options may be combined with ungrouped options\nwithin a single mapping (such as the \"unknown\" option in this example). You can also use a sequence, e.g. a list of 2-tuples: MEDIA_CHOICES = [ ( \"Audio\" , ( ( \"vinyl\" , \"Vinyl\" ), ( \"cd\" , \"CD\" ), ), ), ( \"Video\" , ( ( \"vhs\" , \"VHS Tape\" ), ( \"dvd\" , \"DVD\" ), ), ), ( \"unknown\" , \"Unknown\" ), ] Note that choices can be any sequence object – not necessarily a list or\ntuple. This lets you construct choices dynamically. But if you find yourself\nhacking choices to be dynamic, you’re probably better off using\na proper database table with a ForeignKey . choices is\nmeant for static data that doesn’t change much, if ever. Note A new migration is created each time the order of choices changes. For each model field that has choices set, Django will normalize\nthe choices to a list of 2-tuples and add a method to retrieve the\nhuman-readable name for the field’s current value. See get_FOO_display() in the database API\ndocumentation. Unless blank=False is set on the field along with a default then a label containing \"---------\" will be rendered\nwith the select box. To override this behavior, add a tuple to choices containing None ; e.g. (None, 'Your String For Display') .\nAlternatively, you can use an empty string instead of None where this makes\nsense - such as on a CharField . Enumeration types ¶ In addition, Django provides enumeration types that you can subclass to define\nchoices in a concise way: from django.utils.translation import gettext_lazy as _ class Student ( models . Model ): class YearInSchool ( models . TextChoices ): FRESHMAN = \"FR\" , _ ( \"Freshman\" ) SOPHOMORE = \"SO\" , _ ( \"Sophomore\" ) JUNIOR = \"JR\" , _ ( \"Junior\" ) SENIOR = \"SR\" , _ ( \"Senior\" ) GRADUATE = \"GR\" , _ ( \"Graduate\" ) year_in_school = models . CharField ( max_length = 2 , choices = YearInSchool , default = YearInSchool . FRESHMAN , ) def is_upperclass ( self ): return self . year_in_school in { self . YearInSchool . JUNIOR , self . YearInSchool . SENIOR , } These work similar to enum from Python’s standard library, but with some\nmodifications: Enum member values are a tuple of arguments to use when constructing the\nconcrete data type. Django supports adding an extra string value to the end\nof this tuple to be used as the human-readable name, or label . The label can be a lazy translatable string. Thus, in most cases, the member\nvalue will be a (value, label) 2-tuple. See below for an example\nof subclassing choices using a more complex\ndata type. If a tuple is not provided, or the last item is not a (lazy)\nstring, the label is automatically generated from the member name. A .label property is added on values, to return the human-readable name. A number of custom properties are added to the enumeration classes – .choices , .labels , .values , and .names – to make it easier\nto access lists of those separate parts of the enumeration. Warning These property names cannot be used as member names as they would conflict. The use of enum.unique() is enforced to ensure that values cannot be\ndefined multiple times. This is unlikely to be expected in choices for a\nfield. Note that using YearInSchool.SENIOR , YearInSchool['SENIOR'] , or YearInSchool('SR') to access or lookup enum members work as expected, as do\nthe .name and .value properties on the members. If you don’t need to have the human-readable names translated, you can have\nthem inferred from the member name (replacing underscores with spaces and using\ntitle-case): >>> class Vehicle ( models . TextChoices ): ... CAR = \"C\" ... TRUCK = \"T\" ... JET_SKI = \"J\" ... >>> Vehicle . JET_SKI . label 'Jet Ski' Since the case where the enum values need to be integers is extremely common,\nDjango provides an IntegerChoices class. For example: class Card ( models . Model ): class Suit ( models . IntegerChoices ): DIAMOND = 1 SPADE = 2 HEART = 3 CLUB = 4 suit = models . IntegerField ( choices = Suit ) It is also possible to make use of the Enum Functional API with the caveat\nthat labels are automatically generated as highlighted above: >>> MedalType = models . TextChoices ( \"MedalType\" , \"GOLD SILVER BRONZE\" ) >>> MedalType . choices [('GOLD', 'Gold'), ('SILVER', 'Silver'), ('BRONZE', 'Bronze')] >>> Place = models . IntegerChoices ( \"Place\" , \"FIRST SECOND THIRD\" ) >>> Place . choices [(1, 'First'), (2, 'Second'), (3, 'Third')] If you require support for a concrete data type other than int or str ,\nyou can subclass Choices and the required concrete data type, e.g. date for use with DateField : class MoonLandings ( datetime . date , models . Choices ): APOLLO_11 = 1969 , 7 , 20 , \"Apollo 11 (Eagle)\" APOLLO_12 = 1969 , 11 , 19 , \"Apollo 12 (Intrepid)\" APOLLO_14 = 1971 , 2 , 5 , \"Apollo 14 (Antares)\" APOLLO_15 = 1971 , 7 , 30 , \"Apollo 15 (Falcon)\" APOLLO_16 = 1972 , 4 , 21 , \"Apollo 16 (Orion)\" APOLLO_17 = 1972 , 12 , 11 , \"Apollo 17 (Challenger)\" There are some additional caveats to be aware of: Enumeration types do not support named groups . Because an enumeration with a concrete data type requires all values to match\nthe type, overriding the blank label cannot be achieved by creating a member with a value of None . Instead,\nset the __empty__ attribute on the class: class Answer ( models . IntegerChoices ): NO = 0 , _ ( \"No\" ) YES = 1 , _ ( \"Yes\" ) __empty__ = _ ( \"(Unknown)\" ) Changed in Django 5.0: Support for using enumeration types directly in the choices was added. db_column ¶ Field. db_column ¶ The name of the database column to use for this field. If this isn’t given,\nDjango will use the field’s name. If your database column name is an SQL reserved word, or contains\ncharacters that aren’t allowed in Python variable names – notably, the\nhyphen – that’s OK. Django quotes column and table names behind the\nscenes. db_comment ¶ Field. db_comment ¶ The comment on the database column to use for this field. It is useful for\ndocumenting fields for individuals with direct database access who may not be\nlooking at your Django code. For example: pub_date = models . DateTimeField ( db_comment = \"Date and time when the article was published\" , ) db_default ¶ New in Django 5.0. Field. db_default ¶ The database-computed default value for this field. This can be a literal value\nor a database function, such as Now : created = models . DateTimeField ( db_default = Now ()) More complex expressions can be used, as long as they are made from literals\nand database functions: month_due = models . DateField ( db_default = TruncMonth ( Now () + timedelta ( days = 90 ), output_field = models . DateField (), ) ) Database defaults cannot reference other fields or models. For example, this is\ninvalid: end = models . IntegerField ( db_default = F ( \"start\" ) + 50 ) If both db_default and Field.default are set, default will take\nprecedence when creating instances in Python code. db_default will still be\nset at the database level and will be used when inserting rows outside of the\nORM or when adding a new field in a migration. If a field has a db_default without a default set and no value is\nassigned to the field, a DatabaseDefault object is returned as the field\nvalue on unsaved model instances. The actual value for the field is determined\nby the database when the model instance is saved. db_index ¶ Field. db_index ¶ If True , a database index will be created for this field. Use the indexes option instead. Where possible, use the Meta.indexes option\ninstead. In nearly all cases, indexes provides more\nfunctionality than db_index . db_index may be deprecated in the\nfuture. db_tablespace ¶ Field. db_tablespace [source] ¶ The name of the database tablespace to use for\nthis field’s index, if this field is indexed. The default is the project’s DEFAULT_INDEX_TABLESPACE setting, if set, or the db_tablespace of the model, if any. If the backend doesn’t\nsupport tablespaces for indexes, this option is ignored. default ¶ Field. default ¶ The default value for the field. This can be a value or a callable object. If\ncallable it will be called every time a new object is created. The default can’t be a mutable object (model instance, list , set , etc.),\nas a reference to the same instance of that object would be used as the default\nvalue in all new model instances. Instead, wrap the desired default in a\ncallable. For example, if you want to specify a default dict for JSONField , use a function: def contact_default (): return { \"email\" : \"to1@example.com\" } contact_info = JSONField ( \"ContactInfo\" , default = contact_default ) lambda s can’t be used for field options like default because they\ncan’t be serialized by migrations . See that\ndocumentation for other caveats. For fields like ForeignKey that map to model instances, defaults\nshould be the value of the field they reference ( pk unless to_field is set) instead of model instances. The default value is used when new model instances are created and a value\nisn’t provided for the field. When the field is a primary key, the default is\nalso used when the field is set to None . The default value can also be set at the database level with Field.db_default . editable ¶ Field. editable ¶ If False , the field will not be displayed in the admin or any other ModelForm . They are also skipped during model\nvalidation . Default is True . error_messages ¶ Field. error_messages [source] ¶ The error_messages argument lets you override the default messages that the\nfield will raise. Pass in a dictionary with keys matching the error messages you\nwant to override. Error message keys include null , blank , invalid , invalid_choice , unique , and unique_for_date . Additional error message keys are\nspecified for each field in the Field types section below. These error messages often don’t propagate to forms. See Considerations regarding model’s error_messages . help_text ¶ Field. help_text ¶ Extra “help” text to be displayed with the form widget. It’s useful for\ndocumentation even if your field isn’t used on a form. Note that this value is not HTML-escaped in automatically-generated\nforms. This lets you include HTML in help_text if you so\ndesire. For example: help_text = \"Please use the following format: <em>YYYY-MM-DD</em>.\" Alternatively you can use plain text and django.utils.html.escape() to escape any HTML special characters. Ensure\nthat you escape any help text that may come from untrusted users to avoid a\ncross-site scripting attack. primary_key ¶ Field. primary_key ¶ If True , this field is the primary key for the model. If you don’t specify primary_key=True for any field in your model, Django\nwill automatically add a field to hold the primary key, so you don’t need to\nset primary_key=True on any of your fields unless you want to override the\ndefault primary-key behavior. The type of auto-created primary key fields can\nbe specified per app in AppConfig.default_auto_field or globally in the DEFAULT_AUTO_FIELD setting. For more, see Automatic primary key fields . primary_key=True implies null=False and unique=True . Only one primary key is allowed on an\nobject. The primary key field is read-only. If you change the value of the primary\nkey on an existing object and then save it, a new object will be created\nalongside the old one. The primary key field is set to None when deleting an object. unique ¶ Field. unique [source] ¶ If True , this field must be unique throughout the table. This is enforced at the database level and by model validation. If\nyou try to save a model with a duplicate value in a unique field, a django.db.IntegrityError will be raised by the model’s save() method. This option is valid on all field types except ManyToManyField and OneToOneField . Note that when unique is True , you don’t need to specify db_index , because unique implies the creation of an index. unique_for_date ¶ Field. unique_for_date ¶ Set this to the name of a DateField or DateTimeField to\nrequire that this field be unique for the value of the date field. For example, if you have a field title that has unique_for_date=\"pub_date\" , then Django wouldn’t allow the entry of two\nrecords with the same title and pub_date . Note that if you set this to point to a DateTimeField , only the date\nportion of the field will be considered. Besides, when USE_TZ is True , the check will be performed in the current time zone at the time the object gets saved. This is enforced by Model.validate_unique() during model validation\nbut not at the database level. If any unique_for_date constraint\ninvolves fields that are not part of a ModelForm (for\nexample, if one of the fields is listed in exclude or has editable=False ), Model.validate_unique() will\nskip validation for that particular constraint. unique_for_month ¶ Field. unique_for_month ¶ Like unique_for_date , but requires the field to be unique with\nrespect to the month. unique_for_year ¶ Field. unique_for_year ¶ Like unique_for_date and unique_for_month . verbose_name ¶ Field. verbose_name ¶ A human-readable name for the field. If the verbose name isn’t given, Django\nwill automatically create it using the field’s attribute name, converting\nunderscores to spaces. See Verbose field names . validators ¶ Field. validators [source] ¶ A list of validators to run for this field. See the validators\ndocumentation for more information. Field types ¶ AutoField ¶ class AutoField ( ** options ) [source] ¶ An IntegerField that automatically increments\naccording to available IDs. You usually won’t need to use this directly; a\nprimary key field will automatically be added to your model if you don’t specify\notherwise. See Automatic primary key fields . BigAutoField ¶ class BigAutoField ( ** options ) [source] ¶ A 64-bit integer, much like an AutoField except that it is\nguaranteed to fit numbers from 1 to 9223372036854775807 . BigIntegerField ¶ class BigIntegerField ( ** options ) [source] ¶ A 64-bit integer, much like an IntegerField except that it is\nguaranteed to fit numbers from -9223372036854775808 to 9223372036854775807 . The default form widget for this field is a NumberInput . BinaryField ¶ class BinaryField ( max_length = None , ** options ) [source] ¶ A field to store raw binary data. It can be assigned bytes , bytearray , or memoryview . By default, BinaryField sets editable to False , in which\ncase it can’t be included in a ModelForm . BinaryField. max_length ¶ Optional. The maximum length (in bytes) of the field. The maximum length is\nenforced in Django’s validation using MaxLengthValidator . Abusing BinaryField Although you might think about storing files in the database, consider that\nit is bad design in 99% of the cases. This field is not a replacement for\nproper static files handling. BooleanField ¶ class BooleanField ( ** options ) [source] ¶ A true/false field. The default form widget for this field is CheckboxInput ,\nor NullBooleanSelect if null=True . The default value of BooleanField is None when Field.default isn’t defined. CharField ¶ class CharField ( max_length = None , ** options ) [source] ¶ A string field, for small- to large-sized strings. For large amounts of text, use TextField . The default form widget for this field is a TextInput . CharField has the following extra arguments: CharField. max_length ¶ The maximum length (in characters) of the field. The max_length is enforced at the database level and in Django’s validation using MaxLengthValidator . It’s required for all\ndatabase backends included with Django except PostgreSQL, which supports\nunlimited VARCHAR columns. Note If you are writing an application that must be portable to multiple\ndatabase backends, you should be aware that there are restrictions on max_length for some backends. Refer to the database backend\nnotes for details. CharField. db_collation ¶ Optional. The database collation name of the field. Note Collation names are not standardized. As such, this will not be\nportable across multiple database backends. Oracle Oracle supports collations only when the MAX_STRING_SIZE database\ninitialization parameter is set to EXTENDED . DateField ¶ class DateField ( auto_now = False , auto_now_add = False , ** options ) [source] ¶ A date, represented in Python by a datetime.date instance. Has a few extra,\noptional arguments: DateField. auto_now ¶ Automatically set the field to now every time the object is saved. Useful\nfor “last-modified” timestamps. Note that the current date is always used; it’s not just a default value that you can override. The field is only automatically updated when calling Model.save() . The field isn’t updated when making updates\nto other fields in other ways such as QuerySet.update() , though you can specify a custom\nvalue for the field in an update like that. DateField. auto_now_add ¶ Automatically set the field to now when the object is first created. Useful\nfor creation of timestamps. Note that the current date is always used;\nit’s not just a default value that you can override. So even if you\nset a value for this field when creating the object, it will be ignored.\nIf you want to be able to modify this field, set the following instead of auto_now_add=True : For DateField : default=date.today - from datetime.date.today() For DateTimeField : default=timezone.now - from django.utils.timezone.now() The default form widget for this field is a DateInput . The admin adds a JavaScript calendar,\nand a shortcut for “Today”. Includes an additional invalid_date error\nmessage key. The options auto_now_add , auto_now , and default are mutually exclusive.\nAny combination of these options will result in an error. Note As currently implemented, setting auto_now or auto_now_add to True will cause the field to have editable=False and blank=True set. Note The auto_now and auto_now_add options will always use the date in\nthe default timezone at the moment of\ncreation or update. If you need something different, you may want to\nconsider using your own callable default or overriding save() instead\nof using auto_now or auto_now_add ; or using a DateTimeField instead of a DateField and deciding how to handle the conversion from\ndatetime to date at display time. Warning Always use DateField with a datetime.date instance. If you have a datetime.datetime instance, it’s recommended to convert\nit to a datetime.date first. If you don’t, DateField will\nlocalize the datetime.datetime to the default timezone and convert it to a datetime.date instance, removing its time component. This is true for both storage and\ncomparison. DateTimeField ¶ class DateTimeField ( auto_now = False , auto_now_add = False , ** options ) [source] ¶ A date and time, represented in Python by a datetime.datetime instance.\nTakes the same extra arguments as DateField . The default form widget for this field is a single DateTimeInput . The admin uses two separate TextInput widgets with JavaScript shortcuts. Warning Always use DateTimeField with a datetime.datetime instance. If you have a datetime.date instance, it’s recommended to convert it to\na datetime.datetime first. If you don’t, DateTimeField will\nuse midnight in the default timezone for\nthe time component. This is true for both storage and comparison. To\ncompare the date portion of a DateTimeField with a datetime.date instance, use the date lookup. DecimalField ¶ class DecimalField ( max_digits = None , decimal_places = None , ** options ) [source] ¶ A fixed-precision decimal number, represented in Python by a Decimal instance. It validates the input using DecimalValidator . Has the following required arguments: DecimalField. max_digits ¶ The maximum number of digits allowed in the number. Note that this number\nmust be greater than or equal to decimal_places . DecimalField. decimal_places ¶ The number of decimal places to store with the number. For example, to store numbers up to 999.99 with a resolution of 2 decimal\nplaces, you’d use: models . DecimalField ( ... , max_digits = 5 , decimal_places = 2 ) And to store numbers up to approximately one billion with a resolution of 10\ndecimal places: models . DecimalField ( ... , max_digits = 19 , decimal_places = 10 ) The default form widget for this field is a NumberInput when localize is False or TextInput otherwise. Note For more information about the differences between the FloatField and DecimalField classes, please\nsee FloatField vs. DecimalField . You\nshould also be aware of SQLite limitations of decimal fields. DurationField ¶ class DurationField ( ** options ) [source] ¶ A field for storing periods of time - modeled in Python by timedelta . When used on PostgreSQL, the data type\nused is an interval and on Oracle the data type is INTERVAL DAY(9) TO SECOND(6) . Otherwise a bigint of microseconds is used. Note Arithmetic with DurationField works in most cases. However on all\ndatabases other than PostgreSQL, comparing the value of a DurationField to arithmetic on DateTimeField instances will not work as expected. EmailField ¶ class EmailField ( max_length = 254 , ** options ) [source] ¶ A CharField that checks that the value is a valid email address using EmailValidator . FileField ¶ class FileField ( upload_to = '' , storage = None , max_length = 100 , ** options ) [source] ¶ A file-upload field. Note The primary_key argument isn’t supported and will raise an error if\nused. Has the following optional arguments: FileField. upload_to ¶ This attribute provides a way of setting the upload directory and file name,\nand can be set in two ways. In both cases, the value is passed to the Storage.save() method. If you specify a string value or a Path , it may contain strftime() formatting, which will be replaced by the date/time\nof the file upload (so that uploaded files don’t fill up the given\ndirectory). For example: class MyModel ( models . Model ): # file will be uploaded to MEDIA_ROOT/uploads upload = models . FileField ( upload_to = \"uploads/\" ) # or... # file will be saved to MEDIA_ROOT/uploads/2015/01/30 upload = models . FileField ( upload_to = \"uploads/%Y/%m/ %d /\" ) If you are using the default FileSystemStorage , the string value\nwill be appended to your MEDIA_ROOT path to form the location on\nthe local filesystem where uploaded files will be stored. If you are using\na different storage, check that storage’s documentation to see how it\nhandles upload_to . upload_to may also be a callable, such as a function. This will be\ncalled to obtain the upload path, including the filename. This callable must\naccept two arguments and return a Unix-style path (with forward slashes)\nto be passed along to the storage system. The two arguments are: Argument Description instance An instance of the model where the FileField is defined. More specifically,\nthis is the particular instance where the\ncurrent file is being attached. In most cases, this object will not have been\nsaved to the database yet, so if it uses the\ndefault AutoField , it might not yet have a\nvalue for its primary key field . filename The filename that was originally given to the\nfile. This may or may not be taken into account\nwhen determining the final destination path. For example: def user_directory_path ( instance , filename ): # file will be uploaded to MEDIA_ROOT/user_<id>/<filename> return \"user_ {0} / {1} \" . format ( instance . user . id , filename ) class MyModel ( models . Model ): upload = models . FileField ( upload_to = user_directory_path ) FileField. storage ¶ A storage object, or a callable which returns a storage object. This\nhandles the storage and retrieval of your files. See Managing files for details on how to provide this object. The default form widget for this field is a ClearableFileInput . Using a FileField or an ImageField (see below) in a model\ntakes a few steps: In your settings file, you’ll need to define MEDIA_ROOT as the\nfull path to a directory where you’d like Django to store uploaded files.\n(For performance, these files are not stored in the database.) Define MEDIA_URL as the base public URL of that directory. Make sure\nthat this directory is writable by the web server’s user account. Add the FileField or ImageField to your model, defining\nthe upload_to option to specify a subdirectory of MEDIA_ROOT to use for uploaded files. All that will be stored in your database is a path to the file\n(relative to MEDIA_ROOT ). You’ll most likely want to use the\nconvenience url attribute\nprovided by Django. For example, if your ImageField is called mug_shot , you can get the absolute path to your image in a template with {{ object.mug_shot.url }} . For example, say your MEDIA_ROOT is set to '/home/media' , and upload_to is set to 'photos/%Y/%m/%d' . The '%Y/%m/%d' part of upload_to is strftime() formatting; '%Y' is the four-digit year, '%m' is the two-digit month and '%d' is\nthe two-digit day. If you upload a file on Jan. 15, 2007, it will be saved in\nthe directory /home/media/photos/2007/01/15 . If you wanted to retrieve the uploaded file’s on-disk filename, or the file’s\nsize, you could use the name and size attributes respectively; for more\ninformation on the available attributes and methods, see the File class reference and the Managing files topic guide. Note The file is saved as part of saving the model in the database, so the actual\nfile name used on disk cannot be relied on until after the model has been\nsaved. The uploaded file’s relative URL can be obtained using the url attribute. Internally,\nthis calls the url() method of the\nunderlying Storage class. Note that whenever you deal with uploaded files, you should pay close attention\nto where you’re uploading them and what type of files they are, to avoid\nsecurity holes. Validate all uploaded files so that you’re sure the files are\nwhat you think they are. For example, if you blindly let somebody upload files,\nwithout validation, to a directory that’s within your web server’s document\nroot, then somebody could upload a CGI or PHP script and execute that script by\nvisiting its URL on your site. Don’t allow that. Also note that even an uploaded HTML file, since it can be executed by the\nbrowser (though not by the server), can pose security threats that are\nequivalent to XSS or CSRF attacks. FileField instances are created in your database as varchar columns with a default max length of 100 characters. As with other fields, you\ncan change the maximum length using the max_length argument. FileField and FieldFile ¶ class FieldFile [source] ¶ When you access a FileField on a model, you are\ngiven an instance of FieldFile as a proxy for accessing the underlying\nfile. The API of FieldFile mirrors that of File ,\nwith one key difference: The object wrapped by the class is not necessarily a\nwrapper around Python’s built-in file object. Instead, it is a wrapper around\nthe result of the Storage.open() method, which may be a File object, or it may be a\ncustom storage’s implementation of the File API. In addition to the API inherited from File such as read() and write() , FieldFile includes several methods that\ncan be used to interact with the underlying file: Warning Two methods of this class, save() and delete() , default to saving the model object of the\nassociated FieldFile in the database. FieldFile. name ¶ The name of the file including the relative path from the root of the Storage of the associated FileField . FieldFile. path [source] ¶ A read-only property to access the file’s local filesystem path by calling the path() method of the underlying Storage class. FieldFile. size [source] ¶ The result of the underlying Storage.size() method. FieldFile. url [source] ¶ A read-only property to access the file’s relative URL by calling the url() method of the underlying Storage class. FieldFile. open ( mode = 'rb' ) [source] ¶ Opens or reopens the file associated with this instance in the specified mode . Unlike the standard Python open() method, it doesn’t return a\nfile descriptor. Since the underlying file is opened implicitly when accessing it, it may be\nunnecessary to call this method except to reset the pointer to the underlying\nfile or to change the mode . FieldFile. close () [source] ¶ Behaves like the standard Python file.close() method and closes the file\nassociated with this instance. FieldFile. save ( name , content , save = True ) [source] ¶ This method takes a filename and file contents and passes them to the storage\nclass for the field, then associates the stored file with the model field.\nIf you want to manually associate file data with FileField instances on your model, the save() method is used to persist that file data. Takes two required arguments: name which is the name of the file, and content which is an object containing the file’s contents.  The\noptional save argument controls whether or not the model instance is\nsaved after the file associated with this field has been altered. Defaults to True . Note that the content argument should be an instance of django.core.files.File , not Python’s built-in file object.\nYou can construct a File from an existing\nPython file object like this: from django.core.files import File # Open an existing file using Python's built-in open() f = open ( \"/path/to/hello.world\" ) myfile = File ( f ) Or you can construct one from a Python string like this: from django.core.files.base import ContentFile myfile = ContentFile ( \"hello world\" ) For more information, see Managing files . FieldFile. delete ( save = True ) [source] ¶ Deletes the file associated with this instance and clears all attributes on\nthe field. Note: This method will close the file if it happens to be open when delete() is called. The optional save argument controls whether or not the model instance is\nsaved after the file associated with this field has been deleted. Defaults to True . Note that when a model is deleted, related files are not deleted. If you need\nto cleanup orphaned files, you’ll need to handle it yourself (for instance,\nwith a custom management command that can be run manually or scheduled to run\nperiodically via e.g. cron). FilePathField ¶ class FilePathField ( path = '' , match = None , recursive = False , allow_files = True , allow_folders = False , max_length = 100 , ** options ) [source] ¶ A CharField whose choices are limited to the filenames in a certain\ndirectory on the filesystem. Has some special arguments, of which the first is required : FilePathField. path ¶ Required. The absolute filesystem path to a directory from which this FilePathField should get its choices. Example: \"/home/images\" . path may also be a callable, such as a function to dynamically set the\npath at runtime. Example: import os from django.conf import settings from django.db import models def images_path (): return os . path . join ( settings . LOCAL_FILE_DIR , \"images\" ) class MyModel ( models . Model ): file = models . FilePathField ( path = images_path ) FilePathField. match ¶ Optional. A regular expression, as a string, that FilePathField will use to filter filenames. Note that the regex will be applied to the\nbase filename, not the full path. Example: \"foo.*\\.txt$\" , which will\nmatch a file called foo23.txt but not bar.txt or foo23.png . FilePathField. recursive ¶ Optional. Either True or False . Default is False . Specifies\nwhether all subdirectories of path should be included FilePathField. allow_files ¶ Optional.  Either True or False .  Default is True .  Specifies\nwhether files in the specified location should be included.  Either this or allow_folders must be True . FilePathField. allow_folders ¶ Optional.  Either True or False .  Default is False .  Specifies\nwhether folders in the specified location should be included.  Either this\nor allow_files must be True . The one potential gotcha is that match applies to the\nbase filename, not the full path. So, this example: FilePathField ( path = \"/home/images\" , match = \"foo.*\" , recursive = True ) …will match /home/images/foo.png but not /home/images/foo/bar.png because the match applies to the base filename\n( foo.png and bar.png ). FilePathField instances are created in your database as varchar columns with a default max length of 100 characters. As with other fields, you\ncan change the maximum length using the max_length argument. FloatField ¶ class FloatField ( ** options ) [source] ¶ A floating-point number represented in Python by a float instance. The default form widget for this field is a NumberInput when localize is False or TextInput otherwise. FloatField vs. DecimalField The FloatField class is sometimes mixed up with the DecimalField class. Although they both represent real numbers, they\nrepresent those numbers differently. FloatField uses Python’s float type internally, while DecimalField uses Python’s Decimal type. For\ninformation on the difference between the two, see Python’s documentation\nfor the decimal module. GeneratedField ¶ New in Django 5.0. class GeneratedField ( expression , output_field , db_persist = None , ** kwargs ) [source] ¶ A field that is always computed based on other fields in the model. This field\nis managed and updated by the database itself. Uses the GENERATED ALWAYS SQL syntax. There are two kinds of generated columns: stored and virtual. A stored\ngenerated column is computed when it is written (inserted or updated) and\noccupies storage as if it were a regular column. A virtual generated column\noccupies no storage and is computed when it is read. Thus, a virtual generated\ncolumn is similar to a view and a stored generated column is similar to a\nmaterialized view. GeneratedField. expression ¶ An Expression used by the database to automatically set the field\nvalue each time the model is changed. The expressions should be deterministic and only reference fields within\nthe model (in the same database table). Generated fields cannot reference\nother generated fields. Database backends can impose further restrictions. GeneratedField. output_field ¶ A model field instance to define the field’s data type. GeneratedField. db_persist ¶ Determines if the database column should occupy storage as if it were a\nreal column. If False , the column acts as a virtual column and does\nnot occupy database storage space. PostgreSQL only supports persisted columns. Oracle only supports virtual\ncolumns. Refresh the data Since the database always computed the value, the object must be reloaded\nto access the new value after save() , for example, by using refresh_from_db() . Database limitations There are many database-specific restrictions on generated fields that\nDjango doesn’t validate and the database may raise an error e.g. PostgreSQL\nrequires functions and operators referenced in a generated column to be\nmarked as IMMUTABLE . You should always check that expression is supported on your database.\nCheck out MariaDB , MySQL , Oracle , PostgreSQL , or SQLite docs. GenericIPAddressField ¶ class GenericIPAddressField ( protocol = 'both' , unpack_ipv4 = False , ** options ) [source] ¶ An IPv4 or IPv6 address, in string format (e.g. 192.0.2.30 or 2a02:42fe::4 ). The default form widget for this field is a TextInput . The IPv6 address normalization follows RFC 4291 Section 2.2 section 2.2,\nincluding using the IPv4 format suggested in paragraph 3 of that section, like ::ffff:192.0.2.0 . For example, 2001:0::0:01 would be normalized to 2001::1 , and ::ffff:0a0a:0a0a to ::ffff:10.10.10.10 . All characters\nare converted to lowercase. GenericIPAddressField. protocol ¶ Limits valid inputs to the specified protocol.\nAccepted values are 'both' (default), 'IPv4' or 'IPv6' . Matching is case insensitive. GenericIPAddressField. unpack_ipv4 ¶ Unpacks IPv4 mapped addresses like ::ffff:192.0.2.1 .\nIf this option is enabled that address would be unpacked to 192.0.2.1 . Default is disabled. Can only be used\nwhen protocol is set to 'both' . If you allow for blank values, you have to allow for null values since blank\nvalues are stored as null. ImageField ¶ class ImageField ( upload_to = None , height_field = None , width_field = None , max_length = 100 , ** options ) [source] ¶ Inherits all attributes and methods from FileField , but also\nvalidates that the uploaded object is a valid image. In addition to the special attributes that are available for FileField ,\nan ImageField also has height and width attributes. To facilitate querying on those attributes, ImageField has the\nfollowing optional arguments: ImageField. height_field ¶ Name of a model field which is auto-populated with the height of the image\neach time an image object is set. ImageField. width_field ¶ Name of a model field which is auto-populated with the width of the image\neach time an image object is set. Requires the pillow library. ImageField instances are created in your database as varchar columns with a default max length of 100 characters. As with other fields, you\ncan change the maximum length using the max_length argument. The default form widget for this field is a ClearableFileInput . IntegerField ¶ class IntegerField ( ** options ) [source] ¶ An integer. Values from -2147483648 to 2147483647 are safe in all\ndatabases supported by Django. It uses MinValueValidator and MaxValueValidator to validate the input based\non the values that the default database supports. The default form widget for this field is a NumberInput when localize is False or TextInput otherwise. JSONField ¶ class JSONField ( encoder = None , decoder = None , ** options ) [source] ¶ A field for storing JSON encoded data. In Python the data is represented in its\nPython native format: dictionaries, lists, strings, numbers, booleans and None . JSONField is supported on MariaDB, MySQL, Oracle, PostgreSQL, and SQLite\n(with the JSON1 extension enabled ). JSONField. encoder ¶ An optional json.JSONEncoder subclass to serialize data types\nnot supported by the standard JSON serializer (e.g. datetime.datetime or UUID ). For example, you can use the DjangoJSONEncoder class. Defaults to json.JSONEncoder . JSONField. decoder ¶ An optional json.JSONDecoder subclass to deserialize the value\nretrieved from the database. The value will be in the format chosen by the\ncustom encoder (most often a string). Your deserialization may need to\naccount for the fact that you can’t be certain of the input type. For\nexample, you run the risk of returning a datetime that was actually a\nstring that just happened to be in the same format chosen for datetime s. Defaults to json.JSONDecoder . To query JSONField in the database, see Querying JSONField . Default value If you give the field a default , ensure\nit’s a callable such as the dict class or a function that\nreturns a fresh object each time. Incorrectly using a mutable object like default={} or default=[] creates a mutable default that is shared\nbetween all instances. Indexing Index and Field.db_index both create a\nB-tree index, which isn’t particularly helpful when querying JSONField .\nOn PostgreSQL only, you can use GinIndex that is better suited. PostgreSQL users PostgreSQL has two native JSON based data types: json and jsonb .\nThe main difference between them is how they are stored and how they can be\nqueried. PostgreSQL’s json field is stored as the original string\nrepresentation of the JSON and must be decoded on the fly when queried\nbased on keys. The jsonb field is stored based on the actual structure\nof the JSON which allows indexing. The trade-off is a small additional cost\non writing to the jsonb field. JSONField uses jsonb . Oracle users Oracle Database does not support storing JSON scalar values. Only JSON\nobjects and arrays (represented in Python using dict and list ) are supported. PositiveBigIntegerField ¶ class PositiveBigIntegerField ( ** options ) [source] ¶ Like a PositiveIntegerField , but only allows values under a certain\n(database-dependent) point. Values from 0 to 9223372036854775807 are\nsafe in all databases supported by Django. PositiveIntegerField ¶ class PositiveIntegerField ( ** options ) [source] ¶ Like an IntegerField , but must be either positive or zero ( 0 ).\nValues from 0 to 2147483647 are safe in all databases supported by\nDjango. The value 0 is accepted for backward compatibility reasons. PositiveSmallIntegerField ¶ class PositiveSmallIntegerField ( ** options ) [source] ¶ Like a PositiveIntegerField , but only allows values under a certain\n(database-dependent) point. Values from 0 to 32767 are safe in all\ndatabases supported by Django. SlugField ¶ class SlugField ( max_length = 50 , ** options ) [source] ¶ Slug is a newspaper term. A slug is a short label for something,\ncontaining only letters, numbers, underscores or hyphens. They’re generally used\nin URLs. Like a CharField, you can specify max_length (read the note\nabout database portability and max_length in that section,\ntoo). If max_length is not specified, Django will use a\ndefault length of 50. Implies setting Field.db_index to True . It is often useful to automatically prepopulate a SlugField based on the value\nof some other value.  You can do this automatically in the admin using prepopulated_fields . It uses validate_slug or validate_unicode_slug for validation. SlugField. allow_unicode ¶ If True , the field accepts Unicode letters in addition to ASCII\nletters. Defaults to False . SmallAutoField ¶ class SmallAutoField ( ** options ) [source] ¶ Like an AutoField , but only allows values under a certain\n(database-dependent) limit. Values from 1 to 32767 are safe in all\ndatabases supported by Django. SmallIntegerField ¶ class SmallIntegerField ( ** options ) [source] ¶ Like an IntegerField , but only allows values under a certain\n(database-dependent) point. Values from -32768 to 32767 are safe in all\ndatabases supported by Django. TextField ¶ class TextField ( ** options ) [source] ¶ A large text field. The default form widget for this field is a Textarea . If you specify a max_length attribute, it will be reflected in the Textarea widget of the auto-generated form field.\nHowever it is not enforced at the model or database level. Use a CharField for that. TextField. db_collation ¶ Optional. The database collation name of the field. Note Collation names are not standardized. As such, this will not be\nportable across multiple database backends. Oracle Oracle does not support collations for a TextField . TimeField ¶ class TimeField ( auto_now = False , auto_now_add = False , ** options ) [source] ¶ A time, represented in Python by a datetime.time instance. Accepts the same\nauto-population options as DateField . The default form widget for this field is a TimeInput .\nThe admin adds some JavaScript shortcuts. URLField ¶ class URLField ( max_length = 200 , ** options ) [source] ¶ A CharField for a URL, validated by URLValidator . The default form widget for this field is a URLInput . Like all CharField subclasses, URLField takes the optional max_length argument. If you don’t specify max_length , a default of 200 is used. UUIDField ¶ class UUIDField ( ** options ) [source] ¶ A field for storing universally unique identifiers. Uses Python’s UUID class. When used on PostgreSQL and MariaDB 10.7+,\nthis stores in a uuid datatype, otherwise in a char(32) . Universally unique identifiers are a good alternative to AutoField for primary_key . The database will not generate the UUID for you, so\nit is recommended to use default : import uuid from django.db import models class MyUUIDModel ( models . Model ): id = models . UUIDField ( primary_key = True , default = uuid . uuid4 , editable = False ) # other fields Note that a callable (with the parentheses omitted) is passed to default ,\nnot an instance of UUID . Lookups on PostgreSQL and MariaDB 10.7+ Using iexact , contains , icontains , startswith , istartswith , endswith , or iendswith lookups on PostgreSQL don’t work for values without\nhyphens, because PostgreSQL and MariaDB 10.7+ store them in a hyphenated\nuuid datatype type. Relationship fields ¶ Django also defines a set of fields that represent relations. ForeignKey ¶ class ForeignKey ( to , on_delete , ** options ) [source] ¶ A many-to-one relationship. Requires two positional arguments: the class to\nwhich the model is related and the on_delete option: from django.db import models class Manufacturer ( models . Model ): name = models . TextField () class Car ( models . Model ): manufacturer = models . ForeignKey ( Manufacturer , on_delete = models . CASCADE ) The first positional argument can be either a concrete model class or a lazy reference to a model class. Recursive relationships , where a model has a\nrelationship with itself, are also supported. See ForeignKey.on_delete for details on the second positional\nargument. A database index is automatically created on the ForeignKey . You can\ndisable this by setting db_index to False .  You may want to\navoid the overhead of an index if you are creating a foreign key for\nconsistency rather than joins, or if you will be creating an alternative index\nlike a partial or multiple column index. Database Representation ¶ Behind the scenes, Django appends \"_id\" to the field name to create its\ndatabase column name. In the above example, the database table for the Car model will have a manufacturer_id column. You can change this explicitly by\nspecifying db_column , however, your code should never have to\ndeal with the database column name (unless you write custom SQL). You’ll always\ndeal with the field names of your model object. Arguments ¶ ForeignKey accepts other arguments that define the details of how the\nrelation works. ForeignKey. on_delete ¶ When an object referenced by a ForeignKey is deleted, Django will\nemulate the behavior of the SQL constraint specified by the on_delete argument. For example, if you have a nullable ForeignKey and you want it to be set null when the referenced\nobject is deleted: user = models . ForeignKey ( User , models . SET_NULL , blank = True , null = True , ) on_delete doesn’t create an SQL constraint in the database. Support for\ndatabase-level cascade options may be implemented later . The possible values for on_delete are found in django.db.models : CASCADE [source] ¶ Cascade deletes. Django emulates the behavior of the SQL constraint ON\nDELETE CASCADE and also deletes the object containing the ForeignKey. Model.delete() isn’t called on related models, but the pre_delete and post_delete signals are sent for all\ndeleted objects. PROTECT [source] ¶ Prevent deletion of the referenced object by raising ProtectedError , a subclass of django.db.IntegrityError . RESTRICT [source] ¶ Prevent deletion of the referenced object by raising RestrictedError (a subclass of django.db.IntegrityError ). Unlike PROTECT , deletion of the\nreferenced object is allowed if it also references a different object\nthat is being deleted in the same operation, but via a CASCADE relationship. Consider this set of models: class Artist ( models . Model ): name = models . CharField ( max_length = 10 ) class Album ( models . Model ): artist = models . ForeignKey ( Artist , on_delete = models . CASCADE ) class Song ( models . Model ): artist = models . ForeignKey ( Artist , on_delete = models . CASCADE ) album = models . ForeignKey ( Album , on_delete = models . RESTRICT ) Artist can be deleted even if that implies deleting an Album which is referenced by a Song , because Song also references Artist itself through a cascading relationship. For example: >>> artist_one = Artist . objects . create ( name = \"artist one\" ) >>> artist_two = Artist . objects . create ( name = \"artist two\" ) >>> album_one = Album . objects . create ( artist = artist_one ) >>> album_two = Album . objects . create ( artist = artist_two ) >>> song_one = Song . objects . create ( artist = artist_one , album = album_one ) >>> song_two = Song . objects . create ( artist = artist_one , album = album_two ) >>> album_one . delete () # Raises RestrictedError. >>> artist_two . delete () # Raises RestrictedError. >>> artist_one . delete () (4, {'Song': 2, 'Album': 1, 'Artist': 1}) SET_NULL [source] ¶ Set the ForeignKey null; this is only possible if null is True . SET_DEFAULT [source] ¶ Set the ForeignKey to its default value; a default for the ForeignKey must be set. SET () [source] ¶ Set the ForeignKey to the value passed to SET() , or if a callable is passed in,\nthe result of calling it. In most cases, passing a callable will be\nnecessary to avoid executing queries at the time your models.py is\nimported: from django.conf import settings from django.contrib.auth import get_user_model from django.db import models def get_sentinel_user (): return get_user_model () . objects . get_or_create ( username = \"deleted\" )[ 0 ] class MyModel ( models . Model ): user = models . ForeignKey ( settings . AUTH_USER_MODEL , on_delete = models . SET ( get_sentinel_user ), ) DO_NOTHING [source] ¶ Take no action. If your database backend enforces referential\nintegrity, this will cause an IntegrityError unless\nyou manually add an SQL ON DELETE constraint to the database field. ForeignKey. limit_choices_to ¶ Sets a limit to the available choices for this field when this field is\nrendered using a ModelForm or the admin (by default, all objects\nin the queryset are available to choose). Either a dictionary, a Q object, or a callable returning a\ndictionary or Q object can be used. For example: staff_member = models . ForeignKey ( User , on_delete = models . CASCADE , limit_choices_to = { \"is_staff\" : True }, ) causes the corresponding field on the ModelForm to list only Users that have is_staff=True . This may be helpful in the Django admin. The callable form can be helpful, for instance, when used in conjunction\nwith the Python datetime module to limit selections by date range. For\nexample: def limit_pub_date_choices (): return { \"pub_date__lte\" : datetime . date . today ()} limit_choices_to = limit_pub_date_choices If limit_choices_to is or returns a Q object , which is useful for complex queries , then it will only have an effect on the choices\navailable in the admin when the field is not listed in raw_id_fields in the ModelAdmin for the model. Note If a callable is used for limit_choices_to , it will be invoked\nevery time a new form is instantiated. It may also be invoked when a\nmodel is validated, for example by management commands or the admin.\nThe admin constructs querysets to validate its form inputs in various\nedge cases multiple times, so there is a possibility your callable may\nbe invoked several times. ForeignKey. related_name ¶ The name to use for the relation from the related object back to this one.\nIt’s also the default value for related_query_name (the name to use\nfor the reverse filter name from the target model). See the related\nobjects documentation for a full explanation\nand example. Note that you must set this value when defining relations on abstract models ; and when you do so some special syntax is available. If you’d prefer Django not to create a backwards relation, set related_name to '+' or end it with '+' . For example, this will\nensure that the User model won’t have a backwards relation to this\nmodel: user = models . ForeignKey ( User , on_delete = models . CASCADE , related_name = \"+\" , ) ForeignKey. related_query_name ¶ The name to use for the reverse filter name from the target model. It\ndefaults to the value of related_name or default_related_name if set, otherwise it\ndefaults to the name of the model: # Declare the ForeignKey with related_query_name class Tag ( models . Model ): article = models . ForeignKey ( Article , on_delete = models . CASCADE , related_name = \"tags\" , related_query_name = \"tag\" , ) name = models . CharField ( max_length = 255 ) # That's now the name of the reverse filter Article . objects . filter ( tag__name = \"important\" ) Like related_name , related_query_name supports app label and\nclass interpolation via some special syntax . ForeignKey. to_field ¶ The field on the related object that the relation is to. By default, Django\nuses the primary key of the related object. If you reference a different\nfield, that field must have unique=True . ForeignKey. db_constraint ¶ Controls whether or not a constraint should be created in the database for\nthis foreign key. The default is True , and that’s almost certainly what\nyou want; setting this to False can be very bad for data integrity.\nThat said, here are some scenarios where you might want to do this: You have legacy data that is not valid. You’re sharding your database. If this is set to False , accessing a related object that doesn’t exist\nwill raise its DoesNotExist exception. ForeignKey. swappable ¶ Controls the migration framework’s reaction if this ForeignKey is pointing at a swappable model. If it is True - the default -\nthen if the ForeignKey is pointing at a model which matches\nthe current value of settings.AUTH_USER_MODEL (or another swappable\nmodel setting) the relationship will be stored in the migration using\na reference to the setting, not to the model directly. You only want to override this to be False if you are sure your\nmodel should always point toward the swapped-in model - for example,\nif it is a profile model designed specifically for your custom user model. Setting it to False does not mean you can reference a swappable model\neven if it is swapped out - False means that the migrations made\nwith this ForeignKey will always reference the exact model you specify\n(so it will fail hard if the user tries to run with a User model you don’t\nsupport, for example). If in doubt, leave it to its default of True . ManyToManyField ¶ class ManyToManyField ( to , ** options ) [source] ¶ A many-to-many relationship. Requires a positional argument: the class to\nwhich the model is related, which works exactly the same as it does for ForeignKey , including recursive and lazy relationships. Related objects can be added, removed, or created with the field’s RelatedManager . Database Representation ¶ Behind the scenes, Django creates an intermediary join table to represent the\nmany-to-many relationship. By default, this table name is generated using the\nname of the many-to-many field and the name of the table for the model that\ncontains it. Since some databases don’t support table names above a certain\nlength, these table names will be automatically truncated and a uniqueness hash\nwill be used, e.g. author_books_9cdf . You can manually provide the name of\nthe join table using the db_table option. Arguments ¶ ManyToManyField accepts an extra set of arguments – all optional –\nthat control how the relationship functions. ManyToManyField. related_name ¶ Same as ForeignKey.related_name . ManyToManyField. related_query_name ¶ Same as ForeignKey.related_query_name . ManyToManyField. limit_choices_to ¶ Same as ForeignKey.limit_choices_to . ManyToManyField. symmetrical ¶ Only used in the definition of ManyToManyFields on self. Consider the\nfollowing model: from django.db import models class Person ( models . Model ): friends = models . ManyToManyField ( \"self\" ) When Django processes this model, it identifies that it has a ManyToManyField on itself, and as a result, it doesn’t add a person_set attribute to the Person class. Instead, the ManyToManyField is assumed to be symmetrical – that is, if I am\nyour friend, then you are my friend. If you do not want symmetry in many-to-many relationships with self , set symmetrical to False . This will force Django to\nadd the descriptor for the reverse relationship, allowing ManyToManyField relationships to be non-symmetrical. ManyToManyField. through ¶ Django will automatically generate a table to manage many-to-many\nrelationships. However, if you want to manually specify the intermediary\ntable, you can use the through option to specify\nthe Django model that represents the intermediate table that you want to\nuse. The most common use for this option is when you want to associate extra data with a many-to-many relationship . Note If you don’t want multiple associations between the same instances, add\na UniqueConstraint including the from and to\nfields. Django’s automatically generated many-to-many tables include\nsuch a constraint. Note Recursive relationships using an intermediary model can’t determine the\nreverse accessors names, as they would be the same. You need to set a related_name to at least one of them. If you’d\nprefer Django not to create a backwards relation, set related_name to '+' . If you don’t specify an explicit through model, there is still an\nimplicit through model class you can use to directly access the table\ncreated to hold the association. It has three fields to link the models. If the source and target models differ, the following fields are\ngenerated: id : the primary key of the relation. <containing_model>_id : the id of the model that declares the ManyToManyField . <other_model>_id : the id of the model that the ManyToManyField points to. If the ManyToManyField points from and to the same model, the following\nfields are generated: id : the primary key of the relation. from_<model>_id : the id of the instance which points at the\nmodel (i.e. the source instance). to_<model>_id : the id of the instance to which the relationship\npoints (i.e. the target model instance). This class can be used to query associated records for a given model\ninstance like a normal model: Model . m2mfield . through . objects . all () ManyToManyField. through_fields ¶ Only used when a custom intermediary model is specified. Django will\nnormally determine which fields of the intermediary model to use in order\nto establish a many-to-many relationship automatically. However,\nconsider the following models: from django.db import models class Person ( models . Model ): name = models . CharField ( max_length = 50 ) class Group ( models . Model ): name = models . CharField ( max_length = 128 ) members = models . ManyToManyField ( Person , through = \"Membership\" , through_fields = ( \"group\" , \"person\" ), ) class Membership ( models . Model ): group = models . ForeignKey ( Group , on_delete = models . CASCADE ) person = models . ForeignKey ( Person , on_delete = models . CASCADE ) inviter = models . ForeignKey ( Person , on_delete = models . CASCADE , related_name = \"membership_invites\" , ) invite_reason = models . CharField ( max_length = 64 ) Membership has two foreign keys to Person ( person and inviter ), which makes the relationship ambiguous and Django can’t know\nwhich one to use. In this case, you must explicitly specify which\nforeign keys Django should use using through_fields , as in the example\nabove. through_fields accepts a 2-tuple ('field1', 'field2') , where field1 is the name of the foreign key to the model the ManyToManyField is defined on ( group in this case), and field2 the name of the foreign key to the target model ( person in this case). When you have more than one foreign key on an intermediary model to any\n(or even both) of the models participating in a many-to-many relationship,\nyou must specify through_fields . This also applies to recursive relationships when an intermediary model is used and there are more than two\nforeign keys to the model, or you want to explicitly specify which two\nDjango should use. ManyToManyField. db_table ¶ The name of the table to create for storing the many-to-many data. If this\nis not provided, Django will assume a default name based upon the names of:\nthe table for the model defining the relationship and the name of the field\nitself. ManyToManyField. db_constraint ¶ Controls whether or not constraints should be created in the database for\nthe foreign keys in the intermediary table. The default is True , and\nthat’s almost certainly what you want; setting this to False can be\nvery bad for data integrity. That said, here are some scenarios where you\nmight want to do this: You have legacy data that is not valid. You’re sharding your database. It is an error to pass both db_constraint and through . ManyToManyField. swappable ¶ Controls the migration framework’s reaction if this ManyToManyField is pointing at a swappable model. If it is True - the default -\nthen if the ManyToManyField is pointing at a model which matches\nthe current value of settings.AUTH_USER_MODEL (or another swappable\nmodel setting) the relationship will be stored in the migration using\na reference to the setting, not to the model directly. You only want to override this to be False if you are sure your\nmodel should always point toward the swapped-in model - for example,\nif it is a profile model designed specifically for your custom user model. If in doubt, leave it to its default of True . ManyToManyField does not support validators . null has no effect since there is no way to require a\nrelationship at the database level. OneToOneField ¶ class OneToOneField ( to , on_delete , parent_link = False , ** options ) [source] ¶ A one-to-one relationship. Conceptually, this is similar to a ForeignKey with unique=True , but the\n“reverse” side of the relation will directly return a single object. This is most useful as the primary key of a model which “extends”\nanother model in some way; Multi-table inheritance is\nimplemented by adding an implicit one-to-one relation from the child\nmodel to the parent model, for example. One positional argument is required: the class to which the model will be\nrelated. This works exactly the same as it does for ForeignKey ,\nincluding all the options regarding recursive and lazy relationships. If you do not specify the related_name argument for the OneToOneField , Django will use the lowercase name of the current model as\ndefault value. With the following example: from django.conf import settings from django.db import models class MySpecialUser ( models . Model ): user = models . OneToOneField ( settings . AUTH_USER_MODEL , on_delete = models . CASCADE , ) supervisor = models . OneToOneField ( settings . AUTH_USER_MODEL , on_delete = models . CASCADE , related_name = \"supervisor_of\" , ) your resulting User model will have the following attributes: >>> user = User . objects . get ( pk = 1 ) >>> hasattr ( user , \"myspecialuser\" ) True >>> hasattr ( user , \"supervisor_of\" ) True A RelatedObjectDoesNotExist exception is raised when accessing the reverse\nrelationship if an entry in the related table doesn’t exist. This is a subclass\nof the target model’s Model.DoesNotExist exception and can be accessed as an\nattribute of the reverse accessor. For example, if a user doesn’t have a\nsupervisor designated by MySpecialUser : try : user . supervisor_of except User . supervisor_of . RelatedObjectDoesNotExist : pass Additionally, OneToOneField accepts all of the extra arguments\naccepted by ForeignKey , plus one extra argument: OneToOneField. parent_link ¶ When True and used in a model which inherits from another concrete model , indicates that this field should be used as the\nlink back to the parent class, rather than the extra OneToOneField which would normally be implicitly created by\nsubclassing. See One-to-one relationships for usage\nexamples of OneToOneField . Lazy relationships ¶ Lazy relationships allow referencing models by their names (as strings) or\ncreating recursive relationships. Strings can be used as the first argument in\nany relationship field to reference models lazily. A lazy reference can be\neither recursive , relative or absolute . Recursive ¶ To define a relationship where a model references itself, use \"self\" as the\nfirst argument of the relationship field: from django.db import models class Manufacturer ( models . Model ): name = models . TextField () suppliers = models . ManyToManyField ( \"self\" , symmetrical = False ) When used in an abstract model , the recursive\nrelationship resolves such that each concrete subclass references itself. Relative ¶ When a relationship needs to be created with a model that has not been defined\nyet, it can be referenced by its name rather than the model object itself: from django.db import models class Car ( models . Model ): manufacturer = models . ForeignKey ( \"Manufacturer\" , on_delete = models . CASCADE , ) class Manufacturer ( models . Model ): name = models . TextField () suppliers = models . ManyToManyField ( \"self\" , symmetrical = False ) Relationships defined this way on abstract models are resolved when the model is subclassed as a\nconcrete model and are not relative to the abstract model’s app_label : products/models.py ¶ from django.db import models class AbstractCar ( models . Model ): manufacturer = models . ForeignKey ( \"Manufacturer\" , on_delete = models . CASCADE ) class Meta : abstract = True production/models.py ¶ from django.db import models from products.models import AbstractCar class Manufacturer ( models . Model ): name = models . TextField () class Car ( AbstractCar ): pass In this example, the Car.manufacturer relationship will resolve to production.Manufacturer , as it points to the concrete model defined\nwithin the production/models.py file. Reusable models with relative references Relative references allow the creation of reusable abstract models with\nrelationships that can resolve to different implementations of the\nreferenced models in various subclasses across different applications. Absolute ¶ Absolute references specify a model using its app_label and class name,\nallowing for model references across different applications. This type of lazy\nrelationship can also help resolve circular imports. For example, if the Manufacturer model is defined in another application\ncalled thirdpartyapp , it can be referenced as: class Car ( models . Model ): manufacturer = models . ForeignKey ( \"thirdpartyapp.Manufacturer\" , on_delete = models . CASCADE , ) Absolute references always point to the same model, even when used in an abstract model . Field API reference ¶ class Field [source] ¶ Field is an abstract class that represents a database table column.\nDjango uses fields to create the database table ( db_type() ), to map\nPython types to database ( get_prep_value() ) and vice-versa\n( from_db_value() ). A field is thus a fundamental piece in different Django APIs, notably, models and querysets . In models, a field is instantiated as a class attribute and represents a\nparticular table column, see Models . It has attributes\nsuch as null and unique , and methods that Django uses to\nmap the field value to database-specific values. A Field is a subclass of RegisterLookupMixin and thus both Transform and Lookup can be registered on it to be used\nin QuerySet s (e.g. field_name__exact=\"foo\" ). All built-in\nlookups are registered by default. All of Django’s built-in fields, such as CharField , are particular\nimplementations of Field . If you need a custom field, you can either\nsubclass any of the built-in fields or write a Field from scratch. In\neither case, see How to create custom model fields . description ¶ A verbose description of the field, e.g. for the django.contrib.admindocs application. The description can be of the form: description = _ ( \"String (up to %(max_length)s )\" ) where the arguments are interpolated from the field’s __dict__ . descriptor_class ¶ A class implementing the descriptor protocol that is instantiated and assigned to the model instance attribute. The\nconstructor must accept a single argument, the Field instance.\nOverriding this class attribute allows for customizing the get and set\nbehavior. To map a Field to a database-specific type, Django exposes several\nmethods: get_internal_type () [source] ¶ Returns a string naming this field for backend specific purposes.\nBy default, it returns the class name. See Emulating built-in field types for usage in custom fields. db_type ( connection ) [source] ¶ Returns the database column data type for the Field , taking\ninto account the connection . See Custom database types for usage in custom fields. rel_db_type ( connection ) [source] ¶ Returns the database column data type for fields such as ForeignKey and OneToOneField that point to the Field , taking\ninto account the connection . See Custom database types for usage in custom fields. There are three main situations where Django needs to interact with the\ndatabase backend and fields: when it queries the database (Python value -> database backend value) when it loads data from the database (database backend value -> Python\nvalue) when it saves to the database (Python value -> database backend value) When querying, get_db_prep_value() and get_prep_value() are used: get_prep_value ( value ) [source] ¶ value is the current value of the model’s attribute, and the method\nshould return data in a format that has been prepared for use as a\nparameter in a query. See Converting Python objects to query values for usage. get_db_prep_value ( value , connection , prepared = False ) [source] ¶ Converts value to a backend-specific value. By default it returns value if prepared=True and get_prep_value() if is False . See Converting query values to database values for usage. When loading data, from_db_value() is used: from_db_value ( value , expression , connection ) ¶ Converts a value as returned by the database to a Python object. It is\nthe reverse of get_prep_value() . This method is not used for most built-in fields as the database\nbackend already returns the correct Python type, or the backend itself\ndoes the conversion. expression is the same as self . See Converting values to Python objects for usage. Note For performance reasons, from_db_value is not implemented as a\nno-op on fields which do not require it (all Django fields).\nConsequently you may not call super in your definition. When saving, pre_save() and get_db_prep_save() are used: get_db_prep_save ( value , connection ) [source] ¶ Same as the get_db_prep_value() , but called when the field value\nmust be saved to the database. By default returns get_db_prep_value() . pre_save ( model_instance , add ) [source] ¶ Method called prior to get_db_prep_save() to prepare the value\nbefore being saved (e.g. for DateField.auto_now ). model_instance is the instance this field belongs to and add is whether the instance is being saved to the database for the first\ntime. It should return the value of the appropriate attribute from model_instance for this field. The attribute name is in self.attname (this is set up by Field ). See Preprocessing values before saving for usage. Fields often receive their values as a different type, either from\nserialization or from forms. to_python ( value ) [source] ¶ Converts the value into the correct Python object. It acts as the\nreverse of value_to_string() , and is also called in clean() . See Converting values to Python objects for usage. Besides saving to the database, the field also needs to know how to\nserialize its value: value_from_object ( obj ) [source] ¶ Returns the field’s value for the given model instance. This method is often used by value_to_string() . value_to_string ( obj ) [source] ¶ Converts obj to a string. Used to serialize the value of the field. See Converting field data for serialization for usage. When using model forms , the Field needs to know which form field it should be represented by: formfield ( form_class = None , choices_form_class = None , ** kwargs ) [source] ¶ Returns the default django.forms.Field of this field for ModelForm . By default, if both form_class and choices_form_class are None , it uses CharField . If the field has choices and choices_form_class isn’t specified, it uses TypedChoiceField . See Specifying the form field for a model field for usage. deconstruct () [source] ¶ Returns a 4-tuple with enough information to recreate the field: The name of the field on the model. The import path of the field (e.g. \"django.db.models.IntegerField\" ).\nThis should be the most portable version, so less specific may be better. A list of positional arguments. A dict of keyword arguments. This method must be added to fields prior to 1.7 to migrate its data\nusing Migrations . Registering and fetching lookups ¶ Field implements the lookup registration API .\nThe API can be used to customize which lookups are available for a field class\nand its instances, and how lookups are fetched from a field. Field attribute reference ¶ Every Field instance contains several attributes that allow\nintrospecting its behavior. Use these attributes instead of isinstance checks when you need to write code that depends on a field’s functionality.\nThese attributes can be used together with the Model._meta API to narrow down a search for specific field types.\nCustom model fields should implement these flags. Attributes for fields ¶ Field. auto_created ¶ Boolean flag that indicates if the field was automatically created, such\nas the OneToOneField used by model inheritance. Field. concrete ¶ Boolean flag that indicates if the field has a database column associated\nwith it. Field. hidden ¶ Boolean flag that indicates if a field is hidden and should not be returned\nby Options.get_fields() by default. An example is\nthe reverse field for a ForeignKey with a related_name that starts with '+' . Field. is_relation ¶ Boolean flag that indicates if a field contains references to one or\nmore other models for its functionality (e.g. ForeignKey , ManyToManyField , OneToOneField , etc.). Field. model ¶ Returns the model on which the field is defined. If a field is defined on\na superclass of a model, model will refer to the superclass, not the\nclass of the instance. Attributes for fields with relations ¶ These attributes are used to query for the cardinality and other details of a\nrelation. These attribute are present on all fields; however, they will only\nhave boolean values (rather than None ) if the field is a relation type\n( Field.is_relation=True ). Field. many_to_many ¶ Boolean flag that is True if the field has a many-to-many relation; False otherwise. The only field included with Django where this is True is ManyToManyField . Field. many_to_one ¶ Boolean flag that is True if the field has a many-to-one relation, such\nas a ForeignKey ; False otherwise. Field. one_to_many ¶ Boolean flag that is True if the field has a one-to-many relation, such\nas a GenericRelation or the reverse of a ForeignKey ; False otherwise. Field. one_to_one ¶ Boolean flag that is True if the field has a one-to-one relation, such\nas a OneToOneField ; False otherwise. Field. related_model ¶ Points to the model the field relates to. For example, Author in ForeignKey(Author, on_delete=models.CASCADE) . The related_model for\na GenericForeignKey is always None .", "keywords": ["users", "appconfig.default_auto_field", "box", "editable", "bigintegerfield", "hello.world", "student", "integerfield", "verbose", "storage", "population", "underscores", "uuidfield", "iterables", "reaction", "emailfield", "messages", "bronze", "b", "pillow", "clearablefileinput", ".value", "default_auto_field", "library", "currencies", "field.db_default", "field", "#", "friends", "relation", "unique_for_month", "serialization", "silver", "intermediary", "migrations", "other_model>_id", "django.forms", "ffff:192.0.2.1", "datatype", "+", "paragraph", "numbers", "stores", "validate_unicode_slug", "regex", "lambda", "representation", "action", "range", "dd</em", "match", "calendar", "django.db.models", "member", "get_prep_value", "datefield", "compatibility", "doubt", "b2", "cardinality", "foreignkey.related_query_name", "2a02:42fe::4", "emailvalidator", "ids", "filenames", "’d", ".name", "datetime.date.today", "decoder", "video", "label", "datetimeinput", "user_<id>/<filename", "destination", "hash", "=", "changes", "interval", "prevent", "default_index_tablespace", "positivebigintegerfield", "message", "choices_form_class", "relationship", "fact", "positivesmallintegerfield", "inputs", "letters", "unpack_ipv4", "django.contrib.admindocs", "tables", "tag", "filesystem", "php", "apollo_16", "zones", "db_type", "genericforeignkey", "height", "ski", "places", "yearinschool['senior", "datetime.datetime", "iexact", "choice", "topic", "cost", "artist_two", "through_fields", "ipv4", "following", "type", "error_messages", "required", "filefield", "custom", "kwargs", "symmetry", "objects", "documentation", "to_field", "storage.size", "smallautofield", "lookups", "file", "is_upperclass", "constraint", "album", "urlvalidator", "user", "unpacks", "django.utils.translation", "cases", "violations", "attribute", "scenes", "size", "tape", "constraints", "time", "trick", "mm", "endswith", "scratch", "desire", "tags", "save", "risk", "date", "relatedmanager", "bytearray", "setting", "raw_id_fields", "purposes", "operators", "account", "app_label", "membership", "db_tablespace", "third", "transform", "db_persist", "field.default", "club", "senior", "auto_now", "name", "trade", "parameter", "world", "opens", "flags", "backends", "reference", "foo.*\\.txt$", "web", "django.contrib.auth", "contact_info", "collations", ".choices", "interpolation", "parent_link", "djangojsonencoder", "queries", "many_to_many", "height_field", "char(32", "is_staff", "functional", "literals", "addresses", "return", "behaves", "piece", "reverse", "deletion", "applications", "expressions", "situation", "foo", "currency", "use_tz", "define", "enum.unique", "parent", "ffff:0a0a:0a0a", "search", "kinds", "textfield", "photos/2007/01/15", "edge", "datetimefield", "datetime.date", "mymodel", "examples", ".labels", "callables", "category", "username", "wrapper", "relationships", "isinstance", "tree", "space", "proxy", "model.save", "url", "join", "error", "model.validate_unique", "module", "code", "bigint", "decimalfield", "localize", "filter", "false", "behavior", "c", "i", "cultures", "class", "migration", "display", "access", "style", "manufacturer_id", "link", "one_to_many", "group", "auto_now_add", "widget", "contactinfo", "returns", "names", "javascript", "'", "jet_ski", "year_in_school_choices", "attack", "occupies", "documenting", "deconstruct", "association", "formfield", "formatting", "referencing", "junior", "database", "flag", "input", "*", "query", "amounts", "commands", "postgresql", "inventory", "types", "strings", "floatfield", "e.g", "subclass", "admin", "accessor", "creation", ".values", "date.today", "suit", "restrictederror", "usage", "db_constraint", "help_text", "script", "2001:0::0:01", "limit", "max_length", "day(9", "value_to_string", "json1", "istartswith", "superclass", "validation", "upload_to", "genericrelation", "limitations", "recursive", "section", "filepathfield", "source", "user_directory_path", "allow_unicode", "converts", "sequence", "component", "managing", "card", "use", "graduate", "options.get_fields", "querying", "replacement", "ginindex", "model._meta", "author", "a", "imports", "explanation", "decimalvalidator", "subclasses", "performance", "genericipaddressfield", "enumeration", "jsondecoder", "order", "j", "operation", "lazy", "default", "post_delete", "get_sentinel_user", "choices", "suppliers", "modifications", "extended", "identifiers", "comment", "form", "heart", "shortcuts", "signals", "option", "properties", "format", "products", "classes", "characters", "help", "expression", "inherits", "maxlengthvalidator", "day", "digit", "convention", "manytomanyfields", "prepopulated_fields", "registerlookupmixin", "orion", "considerations", "timezone", "booleanfield", "inviter", "convenience", "uploads/%y/%m/", "f", "holes", "unique_for_year", "caveats", "media_root", "em", "limit_pub_date_choices", "combination", "gr", "timestamps", "template", "mappings", "onetoonefield", "myfile", "vhs", "way", "formats", "tablespaces", "author_books_9cdf", "checks", "booleans", "containing_model>_id", "apollo_15", "meta.indexes", "fr", "t", "index", "rb", "microseconds", "possibility", "validate", "implicit", "op", "party", "jet", "queryset", "integer", "periods", "midnight", "o", "urlinput", "¶", "bytes", "command", "spaces", "storage.open", "disk", "int", "integers", "precision", "allow_files", "encoder", "property", "db_comment", "side", "m2mfield", "positiveintegerfield", "car", "song_two", "content", "maxvaluevalidator", "function", "implementations", "protocol", "artist_one", "result", "view", "integrity", "float", "uuid", "open", "zone", "apollo_12", "enum", "indexes", "supervisor_of", "number", "generatedfield", "jsonfield", "relations", "modelform", "def", "typedchoicefield", "point", "freshman", "values", "deserialization", "selections", "falcon", "foreignkey.on_delete", "string", "model_instance", "_", "immutable", "unix", "mapping", "model.delete", "auto", "databases", "attention", "django.db.models.fields", "verbose_name", "a2", "exclude", "table", "location", "membership_invites", "medaltype", "models", "scripting", "querysets", "ipv6", "-9223372036854775808", "human", "ways", "level", "json", "version", "contents", "hyphens", "article", "width", "image", "labels", "apollo_11", "tablespace", "portion", "django", "to_<model>_id", "rfc", "profile", "n’t", "filename", "fields", "bar.png", "parentheses", "entry", "languages", "set", "lowercase", "individuals", "vehicle", "icontains", "max_length)s", "value", "media", "legacy", "bit", "limit_choices_to", "validate_slug", "retrieval", "subdirectories", "invalid_choice", "data", "columns", "browser", "implementation", "related_query_name", "item", "datetime", "db_collation", "base", "backend", "guide", "-2147483648", "person", "fieldfile", "myspecialuser", "queryset.update", "file.close", "thirdpartyapp", "security", "db_index", "updates", "shortcut", "self", "instance", "members", "newspaper", "set_null", "pub_date", "today", "output_field", "initialization", "primary_key", "extension", "foreignkey.limit_choices_to", "validators", "caveat", "portability", "modeladmin", "respect", "functionality", "cron", "unicode", "object.mug_shot.url", "arrays", "timedelta", "form_class", "docs", "related_name", "gettext_lazy", "digits", "relatedobjectdoesnotexist", "symmetrical", "integerchoices", "same", "joins", "from_<model>_id", "constructor", "descriptor", "gotcha", "instances", "get_db_prep_save", "structure", "unique_for_date", "part", "filesystemstorage", "references", "object", "textarea", "apollo_17", "groups", "dateinput", "supervisor", "contact_default", "numberinput", "charfield", "slashes", "invalid_date", "manytomanyfield", "y/%m/%d", "precedence", "management", "off", "dictionary", "models.<foo", "sql", "truncmonth", "dvd", "myuuidmodel", "points", "fly", "situations", "binaryfield", "descriptor_class", "keyword", "pub_date__lte", "csrf", "accessors", "related_model", "jr", "child", "resolution", "song", "max_digits", "conversion", "max", "rel_db_type", "get_db_prep_value", "from_db_value", "registration", "foreignkey(author", "root", "integrityerror", ".names", "notes", "controls", "mirrors", "vinyl", "effect", "system", "apps", "address", "storage.save", "pointer", "foo.png", "tag__name", "inheritance", "localflavor", "databasedefault", "overhead", "jsonencoder", "get_currencies", "restrictions", "refresh_from_db", "abstractcar", "second", "items", "imagefield", "django.utils.timezone.now", "s.", "protect", "production", "widgets", "b1", "serializer", "cd", "decimal", "definition", "autofield", "target", "check", "yearinschool", "difference", "intrepid", "forms", "site", "consistency", "uploads", "protectederror", "absolute", "emulating", "diamond", "field_name__exact=\"foo", "addition", "lists", "example", "app", "moonlandings", "antares", "month", "column", "list", "pieces", "collation", "orm", "year_in_school", "get_internal_type", "answer", "default_related_name", "album_one", "restrict", "first", "contentfile", "email", "steps", "sophomore", "self.attname", "read", "determines", "model", "word", "to1@example.com", "year", "timeinput", "reasons", "apis", "callable", "place", "memoryview", "element", "a1", "application", "jan.", "dictionaries", "get_user_model", "urlfield", "attributes", "media_url", "slugfield", "title", "unique_for_date=\"pub_date", "eagle", "countries", "differences", "cgi", "local_file_dir", "timefield", "staff_member", "y", "sense", "field.is_relation", "syntax", "subdirectory", "friend", "checkboxinput", "textinput", "uniqueconstraint", "manufacturer", "works", "keys", "case", "length", "yearinschool('sr", "lookup", "products.models", "conjunction", "hasattr", "null", "slug", "folders", "indexing", "runtime", "blank", "clean", "html", "tuple", "future", "server", "str", "photos/%y/%m/%d", "artist", "arguments", "normalization", "upload", "db_default", "xss", "one", "foreignkey.related_name", "datefield.auto_now", "converting", "challenger", "end", "uuid4", "is_relation", "records", "sqlite", "comparison", "textchoices", "matching", "tuples", "delete", "amount", "standard", "path", "functions", "key", "apollo", "term", "operations", "gold", "update", "none", "specifies", "meta", "mariadb", "arithmetic", "get", "durationfield", "q", "framework", "new", "true", "dict", "hyphen", "audio", "urls", "api", "support", "description", "song_one", "mode", "db_column", "document", "yyyy", "connection", "vice", "enforces", "decimal_places", "alternative", "limits", "import", "files", "images_path", "d", "cascade", "sr", "mysql", "directory", ">", "defaults", "%", "pk", "minvaluevalidator", "foreignkey", "information", "images", "through", "python", "strftime", "bigautofield", "methods", "associations", "width_field", "options", "expense", "times", "optional", "exception", "max_string_size", "details", "method", "django.db", "settings", "smallintegerfield", "argument", "days", "field1", "field.db_index", "field2", "truck", "note", "oracle", "threats", "attacks", "django.core.files", "django.utils.html.escape", "/path", "design", "scenarios", "moment", "text", "allow_folders", "project", "-32768", "parts"], "type": "documentation"},
{"title": "Middleware | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/middleware/", "content": "Middleware ¶ This document explains all middleware components that come with Django. For\ninformation on how to use them and how to write your own middleware, see\nthe middleware usage guide . Available middleware ¶ Cache middleware ¶ class UpdateCacheMiddleware [source] ¶ class FetchFromCacheMiddleware [source] ¶ Enable the site-wide cache. If these are enabled, each Django-powered page will\nbe cached for as long as the CACHE_MIDDLEWARE_SECONDS setting\ndefines. See the cache documentation . “Common” middleware ¶ class CommonMiddleware [source] ¶ response_redirect_class ¶ Defaults to HttpResponsePermanentRedirect . Subclass CommonMiddleware and override the attribute to customize the redirects\nissued by the middleware. Adds a few conveniences for perfectionists: Forbids access to user agents in the DISALLOWED_USER_AGENTS setting, which should be a list of compiled regular expression objects. Performs URL rewriting based on the APPEND_SLASH and PREPEND_WWW settings. If APPEND_SLASH is True and the initial URL doesn’t end\nwith a slash, and it is not found in the URLconf, then a new URL is\nformed by appending a slash at the end. If this new URL is found in the\nURLconf, then Django redirects the request to this new URL. Otherwise,\nthe initial URL is processed as usual. For example, foo.com/bar will be redirected to foo.com/bar/ if\nyou don’t have a valid URL pattern for foo.com/bar but do have a\nvalid pattern for foo.com/bar/ . If PREPEND_WWW is True , URLs that lack a leading “www.”\nwill be redirected to the same URL with a leading “www.” Both of these options are meant to normalize URLs. The philosophy is that\neach URL should exist in one, and only one, place. Technically a URL foo.com/bar is distinct from foo.com/bar/ – a search-engine\nindexer would treat them as separate URLs – so it’s best practice to\nnormalize URLs. If necessary, individual views may be excluded from the APPEND_SLASH behavior using the no_append_slash() decorator: from django.views.decorators.common import no_append_slash @no_append_slash def sensitive_fbv ( request , * args , ** kwargs ): \"\"\"View to be excluded from APPEND_SLASH.\"\"\" return HttpResponse () Sets the Content-Length header for non-streaming responses. class BrokenLinkEmailsMiddleware [source] ¶ Sends broken link notification emails to MANAGERS (see How to manage error reporting ). GZip middleware ¶ class GZipMiddleware [source] ¶ max_random_bytes ¶ Defaults to 100. Subclass GZipMiddleware and override the attribute\nto change the maximum number of random bytes that is included with\ncompressed responses. Note Security researchers revealed that when compression techniques (including GZipMiddleware ) are used on a website, the site may become exposed to a\nnumber of possible attacks. To mitigate attacks, Django implements a technique called Heal The Breach\n(HTB) . It adds up to 100 bytes (see max_random_bytes ) of random bytes to each response\nto make the attacks less effective. For more details, see the BREACH paper (PDF) , breachattack.com , and\nthe Heal The Breach (HTB) paper . The django.middleware.gzip.GZipMiddleware compresses content for browsers\nthat understand GZip compression (all modern browsers). This middleware should be placed before any other middleware that need to\nread or write the response body so that compression happens afterward. It will NOT compress content if any of the following are true: The content body is less than 200 bytes long. The response has already set the Content-Encoding header. The request (the browser) hasn’t sent an Accept-Encoding header\ncontaining gzip . If the response has an ETag header, the ETag is made weak to comply with RFC 9110 Section 8.8.1 . You can apply GZip compression to individual views using the gzip_page() decorator. Conditional GET middleware ¶ class ConditionalGetMiddleware [source] ¶ Handles conditional GET operations. If the response doesn’t have an ETag header, the middleware adds one if needed. If the response has an ETag or Last-Modified header, and the request has If-None-Match or If-Modified-Since , the response is replaced by an HttpResponseNotModified . Locale middleware ¶ class LocaleMiddleware [source] ¶ response_redirect_class ¶ Defaults to HttpResponseRedirect . Subclass LocaleMiddleware and override the attribute to customize the\nredirects issued by the middleware. Enables language selection based on data from the request. It customizes\ncontent for each user. See the internationalization documentation . Message middleware ¶ class MessageMiddleware [source] ¶ Enables cookie- and session-based message support. See the messages documentation . Security middleware ¶ Warning If your deployment situation allows, it’s usually a good idea to have your\nfront-end web server perform the functionality provided by the SecurityMiddleware . That way, if there are requests that aren’t served\nby Django (such as static media or user-uploaded files), they will have\nthe same protections as requests to your Django application. class SecurityMiddleware [source] ¶ The django.middleware.security.SecurityMiddleware provides several security\nenhancements to the request/response cycle. Each one can be independently\nenabled or disabled with a setting. SECURE_CONTENT_TYPE_NOSNIFF SECURE_CROSS_ORIGIN_OPENER_POLICY SECURE_HSTS_INCLUDE_SUBDOMAINS SECURE_HSTS_PRELOAD SECURE_HSTS_SECONDS SECURE_REDIRECT_EXEMPT SECURE_REFERRER_POLICY SECURE_SSL_HOST SECURE_SSL_REDIRECT HTTP Strict Transport Security ¶ For sites that should only be accessed over HTTPS, you can instruct modern\nbrowsers to refuse to connect to your domain name via an insecure connection\n(for a given period of time) by setting the “Strict-Transport-Security”\nheader . This reduces your exposure to some SSL-stripping man-in-the-middle\n(MITM) attacks. SecurityMiddleware will set this header for you on all HTTPS responses if\nyou set the SECURE_HSTS_SECONDS setting to a non-zero integer value. When enabling HSTS, it’s a good idea to first use a small value for testing,\nfor example, SECURE_HSTS_SECONDS = 3600 for one\nhour. Each time a web browser sees the HSTS header from your site, it will\nrefuse to communicate non-securely (using HTTP) with your domain for the given\nperiod of time. Once you confirm that all assets are served securely on your\nsite (i.e. HSTS didn’t break anything), it’s a good idea to increase this value\nso that infrequent visitors will be protected (31536000 seconds, i.e. 1 year,\nis common). Additionally, if you set the SECURE_HSTS_INCLUDE_SUBDOMAINS setting\nto True , SecurityMiddleware will add the includeSubDomains directive\nto the Strict-Transport-Security header. This is recommended (assuming all\nsubdomains are served exclusively using HTTPS), otherwise your site may still\nbe vulnerable via an insecure connection to a subdomain. If you wish to submit your site to the browser preload list , set the SECURE_HSTS_PRELOAD setting to True . That appends the preload directive to the Strict-Transport-Security header. Warning The HSTS policy applies to your entire domain, not just the URL of the\nresponse that you set the header on. Therefore, you should only use it if\nyour entire domain is served via HTTPS only. Browsers properly respecting the HSTS header will refuse to allow users to\nbypass warnings and connect to a site with an expired, self-signed, or\notherwise invalid SSL certificate. If you use HSTS, make sure your\ncertificates are in good shape and stay that way! Note If you are deployed behind a load-balancer or reverse-proxy server, and the Strict-Transport-Security header is not being added to your responses,\nit may be because Django doesn’t realize that it’s on a secure connection;\nyou may need to set the SECURE_PROXY_SSL_HEADER setting. Referrer Policy ¶ Browsers use the Referer header as a way to send information to a site\nabout how users got there. When a user clicks a link, the browser will send the\nfull URL of the linking page as the referrer. While this can be useful for some\npurposes – like figuring out who’s linking to your site – it also can cause\nprivacy concerns by informing one site that a user was visiting another site. Some browsers have the ability to accept hints about whether they should send\nthe HTTP Referer header when a user clicks a link; this hint is provided\nvia the Referrer-Policy header . This header can suggest any of three\nbehaviors to browsers: Full URL: send the entire URL in the Referer header. For example, if the\nuser is visiting https://example.com/page.html , the Referer header\nwould contain \"https://example.com/page.html\" . Origin only: send only the “origin” in the referrer. The origin consists of\nthe scheme, host and (optionally) port number. For example, if the user is\nvisiting https://example.com/page.html , the origin would be https://example.com/ . No referrer: do not send a Referer header at all. There are two types of conditions this header can tell a browser to watch out\nfor: Same-origin versus cross-origin: a link from https://example.com/1.html to https://example.com/2.html is same-origin. A link from https://example.com/page.html to https://not.example.com/page.html is\ncross-origin. Protocol downgrade: a downgrade occurs if the page containing the link is\nserved via HTTPS, but the page being linked to is not served via HTTPS. Warning When your site is served via HTTPS, Django’s CSRF protection system requires the Referer header to be present, so\ncompletely disabling the Referer header will interfere with CSRF\nprotection. To gain most of the benefits of disabling Referer headers\nwhile also keeping CSRF protection, consider enabling only same-origin\nreferrers. SecurityMiddleware can set the Referrer-Policy header for you, based on\nthe SECURE_REFERRER_POLICY setting (note spelling: browsers send a Referer header when a user clicks a link, but the header instructing a\nbrowser whether to do so is spelled Referrer-Policy ). The valid values for\nthis setting are: no-referrer Instructs the browser to send no referrer for links clicked on this site. no-referrer-when-downgrade Instructs the browser to send a full URL as the referrer, but only when no\nprotocol downgrade occurs. origin Instructs the browser to send only the origin, not the full URL, as the\nreferrer. origin-when-cross-origin Instructs the browser to send the full URL as the referrer for same-origin\nlinks, and only the origin for cross-origin links. same-origin Instructs the browser to send a full URL, but only for same-origin links. No\nreferrer will be sent for cross-origin links. strict-origin Instructs the browser to send only the origin, not the full URL, and to send\nno referrer when a protocol downgrade occurs. strict-origin-when-cross-origin Instructs the browser to send the full URL when the link is same-origin and\nno protocol downgrade occurs; send only the origin when the link is\ncross-origin and no protocol downgrade occurs; and no referrer when a\nprotocol downgrade occurs. unsafe-url Instructs the browser to always send the full URL as the referrer. Unknown Policy Values Where a policy value is unknown by a user agent, it is possible to\nspecify multiple policy values to provide a fallback. The last specified\nvalue that is understood takes precedence. To support this, an iterable or\ncomma-separated string can be used with SECURE_REFERRER_POLICY . Cross-Origin Opener Policy ¶ Some browsers have the ability to isolate top-level windows from other\ndocuments by putting them in a separate browsing context group based on the\nvalue of the Cross-Origin Opener Policy (COOP) header. If a document that\nis isolated in this way opens a cross-origin popup window, the popup’s window.opener property will be null . Isolating windows using COOP is a\ndefense-in-depth protection against cross-origin attacks, especially those like\nSpectre which allowed exfiltration of data loaded into a shared browsing\ncontext. SecurityMiddleware can set the Cross-Origin-Opener-Policy header for\nyou, based on the SECURE_CROSS_ORIGIN_OPENER_POLICY setting. The\nvalid values for this setting are: same-origin Isolates the browsing context exclusively to same-origin documents.\nCross-origin documents are not loaded in the same browsing context. This\nis the default and most secure option. same-origin-allow-popups Isolates the browsing context to same-origin documents or those which\neither don’t set COOP or which opt out of isolation by setting a COOP of unsafe-none . unsafe-none Allows the document to be added to its opener’s browsing context group\nunless the opener itself has a COOP of same-origin or same-origin-allow-popups . X-Content-Type-Options: nosniff ¶ Some browsers will try to guess the content types of the assets that they\nfetch, overriding the Content-Type header. While this can help display\nsites with improperly configured servers, it can also pose a security\nrisk. If your site serves user-uploaded files, a malicious user could upload a\nspecially-crafted file that would be interpreted as HTML or JavaScript by\nthe browser when you expected it to be something harmless. To prevent the browser from guessing the content type and force it to\nalways use the type provided in the Content-Type header, you can pass\nthe X-Content-Type-Options: nosniff header. SecurityMiddleware will\ndo this for all responses if the SECURE_CONTENT_TYPE_NOSNIFF setting\nis True . Note that in most deployment situations where Django isn’t involved in serving\nuser-uploaded files, this setting won’t help you. For example, if your MEDIA_URL is served directly by your front-end web server (nginx,\nApache, etc.) then you’d want to set this header there. On the other hand, if\nyou are using Django to do something like require authorization in order to\ndownload files and you cannot set the header using your web server, this\nsetting will be useful. SSL Redirect ¶ If your site offers both HTTP and HTTPS connections, most users will end up\nwith an unsecured connection by default. For best security, you should redirect\nall HTTP connections to HTTPS. If you set the SECURE_SSL_REDIRECT setting to True, SecurityMiddleware will permanently (HTTP 301) redirect all HTTP\nconnections to HTTPS. Note For performance reasons, it’s preferable to do these redirects outside of\nDjango, in a front-end load balancer or reverse-proxy server such as nginx . SECURE_SSL_REDIRECT is intended for the deployment\nsituations where this isn’t an option. If the SECURE_SSL_HOST setting has a value, all redirects will be\nsent to that host instead of the originally-requested host. If there are a few pages on your site that should be available over HTTP, and\nnot redirected to HTTPS, you can list regular expressions to match those URLs\nin the SECURE_REDIRECT_EXEMPT setting. Note If you are deployed behind a load-balancer or reverse-proxy server and\nDjango can’t seem to tell when a request actually is already secure, you\nmay need to set the SECURE_PROXY_SSL_HEADER setting. Session middleware ¶ class SessionMiddleware [source] ¶ Enables session support. See the session documentation . Site middleware ¶ class CurrentSiteMiddleware [source] ¶ Adds the site attribute representing the current site to every incoming HttpRequest object. See the sites documentation . Authentication middleware ¶ class AuthenticationMiddleware [source] ¶ Adds the user attribute, representing the currently-logged-in user, to\nevery incoming HttpRequest object. See Authentication in web requests . class LoginRequiredMiddleware [source] ¶ Subclass the middleware and override the following attributes and methods\nto customize behavior for unauthenticated requests. redirect_field_name ¶ Defaults to \"next\" . get_login_url () [source] ¶ Returns the URL that unauthenticated requests will be redirected to. This\nresult is either the login_url set on the login_required() decorator (if not None ), or settings.LOGIN_URL . get_redirect_field_name () [source] ¶ Returns the name of the query parameter that contains the URL the user\nshould be redirected to after a successful login. This result is either\nthe redirect_field_name set on the login_required() decorator (if not None ), or redirect_field_name . If None is returned, a query\nparameter won’t be added. New in Django 5.1. Redirects all unauthenticated requests to a login page, except for views\nexcluded with login_not_required() . The\nlogin page defaults to settings.LOGIN_URL , but can be\ncustomized. Enable this middleware by adding it to the MIDDLEWARE setting after AuthenticationMiddleware : MIDDLEWARE = [ \"...\" , \"django.contrib.auth.middleware.AuthenticationMiddleware\" , \"django.contrib.auth.middleware.LoginRequiredMiddleware\" , \"...\" , ] Make a view public, allowing unauthenticated requests, with login_not_required() . For example: from django.contrib.auth.decorators import login_not_required @login_not_required def contact_us ( request ): ... Customize the login URL or field name for authenticated views with the login_required() decorator to set login_url or redirect_field_name respectively. For example: from django.contrib.auth.decorators import login_required from django.utils.decorators import method_decorator from django.views.generic import View @login_required ( login_url = \"/books/login/\" , redirect_field_name = \"redirect_to\" ) def book_dashboard ( request ): ... @method_decorator ( login_required ( login_url = \"/books/login/\" , redirect_field_name = \"redirect_to\" ), name = \"dispatch\" , ) class BookMetrics ( View ): pass Ensure that your login view does not require a login. To prevent infinite redirects, ensure you have enabled unauthenticated requests to your login view. class RemoteUserMiddleware [source] ¶ Middleware for utilizing web server provided authentication. See How to authenticate using REMOTE_USER for usage details. class PersistentRemoteUserMiddleware [source] ¶ Middleware for utilizing web server provided authentication when enabled only\non the login page. See Using REMOTE_USER on login pages only for usage\ndetails. CSRF protection middleware ¶ class CsrfViewMiddleware [source] ¶ Adds protection against Cross Site Request Forgeries by adding hidden form\nfields to POST forms and checking requests for the correct value. See the Cross Site Request Forgery protection documentation . X-Frame-Options middleware ¶ class XFrameOptionsMiddleware [source] ¶ Simple clickjacking protection via the X-Frame-Options header . Middleware ordering ¶ Here are some hints about the ordering of various Django middleware classes: SecurityMiddleware It should go near the top of the list if you’re going to turn on the SSL\nredirect as that avoids running through a bunch of other unnecessary\nmiddleware. UpdateCacheMiddleware Before those that modify the Vary header ( SessionMiddleware , GZipMiddleware , LocaleMiddleware ). GZipMiddleware Before any middleware that may change or use the response body. After UpdateCacheMiddleware : Modifies Vary header. SessionMiddleware Before any middleware that may raise an exception to trigger an error\nview (such as PermissionDenied ) if you’re\nusing CSRF_USE_SESSIONS . After UpdateCacheMiddleware : Modifies Vary header. ConditionalGetMiddleware Before any middleware that may change the response (it sets the ETag header). After GZipMiddleware so it won’t calculate an ETag header on gzipped\ncontents. LocaleMiddleware One of the topmost, after SessionMiddleware (uses session data) and UpdateCacheMiddleware (modifies Vary header). CommonMiddleware Before any middleware that may change the response (it sets the Content-Length header). A middleware that appears before CommonMiddleware and changes the response must reset Content-Length . Close to the top: it redirects when APPEND_SLASH or PREPEND_WWW are set to True . After SessionMiddleware if you’re using CSRF_USE_SESSIONS . CsrfViewMiddleware Before any view middleware that assumes that CSRF attacks have been dealt\nwith. Before RemoteUserMiddleware , or any\nother authentication middleware that may perform a login, and hence rotate\nthe CSRF token, before calling down the middleware chain. After SessionMiddleware if you’re using CSRF_USE_SESSIONS . AuthenticationMiddleware After SessionMiddleware : uses session storage. LoginRequiredMiddleware New in Django 5.1. After AuthenticationMiddleware : uses user object. MessageMiddleware After SessionMiddleware : can use session-based storage. FetchFromCacheMiddleware After any middleware that modifies the Vary header: that header is used\nto pick a value for the cache hash-key. FlatpageFallbackMiddleware Should be near the bottom as it’s a last-resort type of middleware. RedirectFallbackMiddleware Should be near the bottom as it’s a last-resort type of middleware.", "keywords": ["users", "storage", "pattern", "login", "selection", "messages", "field", "django.utils.decorators", "brokenlinkemailsmiddleware", "emails", "host", "match", "httpresponse", "cache", "transport", "https", "links", "remote_user", "http", "secure_redirect_exempt", "=", "concerns", "hash", "engine", "secure_cross_origin_opener_policy", "message", "permissiondenied", "prepend_www", "cookie-", "paper", "django.contrib.auth.decorators", "fallback", "nosniff", "compression", "following", "type", "kwargs", "defines", "objects", "documentation", "coop", "flatpagefallbackmiddleware", "file", "man", "gzipmiddleware", "user", "django.middleware.security", "attribute", "args", "resort", "warning", "time", "login/", "referrers", "risk", "setting", "purposes", "responses", "components", "hour", "pdf", "name", "parameter", "web", "notification", "https://example.com/1.html", "secure_ssl_redirect", "/books", "popups", "behaviors", "return", "redirect_field_name", "reverse", "expressions", "situation", "search", "isolation", "exposure", "commonmiddleware", "sessionmiddleware", "forbids", "sensitive_fbv", "proxy", "url", "error", "conditions", "subdomains", "window.opener", "period", "pages", "forgeries", "behavior", "access", "class", "link", "gzip", "group", "ssl", "warnings", "returns", "javascript", "x", "login_url", "request", "gzip_page", "secure_hsts_include_subdomains", "*", "query", "page", "exfiltration", "types", "cache_middleware_seconds", "compresses", "subclass", "etag", "usage", "bottom", "frame", "httpresponsenotmodified", "https://example.com/2.html", "persistentremoteusermiddleware", "section", "source", "certificates", "get_login_url", "origin", "performance", "protection", "secure_content_type_nosniff", "contact_us", "nginx", "order", "default", "shape", "hsts", "researchers", "spelling", "form", "option", "expression", "comma", "classes", "cross", "browsers", "scheme", "@login_not_required", "chain", "privacy", "csrfviewmiddleware", "header", "csrf_use_sessions", "way", "response_redirect_class", "protections", "strict", "servers", "accept", "balancer", "integer", "session", "¶", "bytes", "internationalization", "django.middleware.gzip", "no_append_slash", "property", "mitm", "get_redirect_field_name", "content", "protocol", "views", "testing", "result", "view", "popup", "simple", "agent", "number", "def", "secure_hsts_seconds", "values", "enhancements", "enables", "bypass", "string", "preload", "windows", "heal", "handles", "downgrade", "connections", "managers", "defense", "hand", "subdomain", "language", "modifies", "referrer", "level", "contents", "benefits", "django", "rfc", "n’t", "securitymiddleware", "fields", "bunch", "practice", "value", "media", "policy", "data", "browser", "login_not_required", "messagemiddleware", "guide", "append_slash", "redirect_to", "loginrequiredmiddleware", "disallowed_user_agents", "security", "includesubdomains", "self", "reporting", "remoteusermiddleware", "forgery", "functionality", "conveniences", "decorator", "assets", "https://example.com/", "conditional", "authenticationmiddleware", "foo.com/bar", "agents", "object", "load", "indexer", "redirectfallbackmiddleware", "deployment", "domain", "foo.com/bar/", "localemiddleware", "httprequest", "response", "www", "precedence", "website", "common", "hints", "requests", "locale", "situations", "csrf", "ordering", "currentsitemiddleware", "opener", "top", "redirect", "system", "port", "secure_referrer_policy", "headers", "slash", "site", "forms", "apache", "referer", "example", "window", "list", "seconds", "bookmetrics", "secure_proxy_ssl_header", "perfectionists", "allow", "spectre", "year", "dispatch", "reasons", "idea", "techniques", "place", "application", "encoding", "login_required", "attributes", "media_url", "vary", "insecure", "ability", "https://example.com/page.html", "redirects", "urlconf", "philosophy", "secure_ssl_host", "conditionalgetmiddleware", "length", "authentication", "authorization", "certificate", "@no_append_slash", "technique", "html", "server", "middleware", "one", "directive", "end", "max_random_bytes", "depth", "key", "operations", "fetchfromcachemiddleware", "django.views.decorators.common", "none", "method_decorator", "get", "secure_hsts_preload", "new", "true", "urls", "support", "hint", "htb", "document", "connection", "-", "context", "cycle", "import", "files", "documents", "defaults", "information", "updatecachemiddleware", "methods", "options", "exception", "details", "breach", "settings", "note", "body", "sites", "attacks", "visitors", "8.8.1"], "type": "documentation"},
{"title": "Widgets | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/forms/widgets/", "content": "Widgets ¶ A widget is Django’s representation of an HTML input element. The widget\nhandles the rendering of the HTML, and the extraction of data from a GET/POST\ndictionary that corresponds to the widget. The HTML generated by the built-in widgets uses HTML5 syntax, targeting <!DOCTYPE html> . For example, it uses boolean attributes such as checked rather than the XHTML style of checked='checked' . Tip Widgets should not be confused with the form fields .\nForm fields deal with the logic of input validation and are used directly\nin templates. Widgets deal with rendering of HTML form input elements on\nthe web page and extraction of raw submitted data. However, widgets do\nneed to be assigned to form fields. Specifying widgets ¶ Whenever you specify a field on a form, Django will use a default widget\nthat is appropriate to the type of data that is to be displayed. To find\nwhich widget is used on which field, see the documentation about Built-in Field classes . However, if you want to use a different widget for a field, you can\nuse the widget argument on the field definition. For example: from django import forms class CommentForm ( forms . Form ): name = forms . CharField () url = forms . URLField () comment = forms . CharField ( widget = forms . Textarea ) This would specify a form with a comment that uses a larger Textarea widget, rather than the default TextInput widget. Setting arguments for widgets ¶ Many widgets have optional extra arguments; they can be set when defining the\nwidget on the field. In the following example, the years attribute is set for a SelectDateWidget : from django import forms BIRTH_YEAR_CHOICES = [ \"1980\" , \"1981\" , \"1982\" ] FAVORITE_COLORS_CHOICES = { \"blue\" : \"Blue\" , \"green\" : \"Green\" , \"black\" : \"Black\" , } class SimpleForm ( forms . Form ): birth_year = forms . DateField ( widget = forms . SelectDateWidget ( years = BIRTH_YEAR_CHOICES ) ) favorite_colors = forms . MultipleChoiceField ( required = False , widget = forms . CheckboxSelectMultiple , choices = FAVORITE_COLORS_CHOICES , ) See the Built-in widgets for more information about which widgets\nare available and which arguments they accept. Widgets inheriting from the Select widget ¶ Widgets inheriting from the Select widget deal with choices. They\npresent the user with a list of options to choose from. The different widgets\npresent this choice differently; the Select widget itself uses a <select> HTML list representation, while RadioSelect uses radio\nbuttons. Select widgets are used by default on ChoiceField fields. The\nchoices displayed on the widget are inherited from the ChoiceField and\nchanging ChoiceField.choices will update Select.choices . For\nexample: >>> from django import forms >>> CHOICES = { \"1\" : \"First\" , \"2\" : \"Second\" } >>> choice_field = forms . ChoiceField ( widget = forms . RadioSelect , choices = CHOICES ) >>> choice_field . choices [('1', 'First'), ('2', 'Second')] >>> choice_field . widget . choices [('1', 'First'), ('2', 'Second')] >>> choice_field . widget . choices = [] >>> choice_field . choices = [( \"1\" , \"First and only\" )] >>> choice_field . widget . choices [('1', 'First and only')] Widgets which offer a choices attribute can however be used\nwith fields which are not based on choice – such as a CharField –\nbut it is recommended to use a ChoiceField -based field when the\nchoices are inherent to the model and not just the representational widget. Customizing widget instances ¶ When Django renders a widget as HTML, it only renders very minimal markup -\nDjango doesn’t add class names, or any other widget-specific attributes. This\nmeans, for example, that all TextInput widgets will appear the same\non your web pages. There are two ways to customize widgets: per widget instance and per widget class . Styling widget instances ¶ If you want to make one widget instance look different from another, you will\nneed to specify additional attributes at the time when the widget object is\ninstantiated and assigned to a form field (and perhaps add some rules to your\nCSS files). For example, take the following form: from django import forms class CommentForm ( forms . Form ): name = forms . CharField () url = forms . URLField () comment = forms . CharField () This form will include TextInput widgets for the name and comment\nfields, and a URLInput widget for the url field. Each has default\nrendering - no CSS class, no extra attributes: >>> f = CommentForm ( auto_id = False ) >>> print ( f ) <div>Name:<input type=\"text\" name=\"name\" required></div> <div>Url:<input type=\"url\" name=\"url\" required></div> <div>Comment:<input type=\"text\" name=\"comment\" required></div> On a real web page, you probably want to customize this. You might want a\nlarger input element for the comment, and you might want the ‘name’ widget to\nhave some special CSS class. It is also possible to specify the ‘type’\nattribute to use a different HTML5 input type. To do this, you use the Widget.attrs argument when creating the widget: class CommentForm ( forms . Form ): name = forms . CharField ( widget = forms . TextInput ( attrs = { \"class\" : \"special\" })) url = forms . URLField () comment = forms . CharField ( widget = forms . TextInput ( attrs = { \"size\" : \"40\" })) You can also modify a widget in the form definition: class CommentForm ( forms . Form ): name = forms . CharField () url = forms . URLField () comment = forms . CharField () name . widget . attrs . update ({ \"class\" : \"special\" }) comment . widget . attrs . update ( size = \"40\" ) Or if the field isn’t declared directly on the form (such as model form fields),\nyou can use the Form.fields attribute: class CommentForm ( forms . ModelForm ): def __init__ ( self , * args , ** kwargs ): super () . __init__ ( * args , ** kwargs ) self . fields [ \"name\" ] . widget . attrs . update ({ \"class\" : \"special\" }) self . fields [ \"comment\" ] . widget . attrs . update ( size = \"40\" ) Django will then include the extra attributes in the rendered output: >>> f = CommentForm ( auto_id = False ) >>> print ( f ) <div>Name:<input type=\"text\" name=\"name\" class=\"special\" required></div> <div>Url:<input type=\"url\" name=\"url\" required></div> <div>Comment:<input type=\"text\" name=\"comment\" size=\"40\" required></div> You can also set the HTML id using attrs . See BoundField.id_for_label for an example. Styling widget classes ¶ With widgets, it is possible to add assets ( css and javascript )\nand more deeply customize their appearance and behavior. In a nutshell, you will need to subclass the widget and either define a “Media” inner class or create a “media” property . These methods involve somewhat advanced Python programming and are described in\ndetail in the Form Assets topic guide. Base widget classes ¶ Base widget classes Widget and MultiWidget are subclassed by\nall the built-in widgets and may serve as a\nfoundation for custom widgets. Widget ¶ class Widget ( attrs = None ) [source] ¶ This abstract class cannot be rendered, but provides the basic attribute attrs .  You may also implement or override the render() method on custom widgets. attrs ¶ A dictionary containing HTML attributes to be set on the rendered\nwidget. >>> from django import forms >>> name = forms . TextInput ( attrs = { \"size\" : 10 , \"title\" : \"Your name\" }) >>> name . render ( \"name\" , \"A name\" ) '<input title=\"Your name\" type=\"text\" name=\"name\" value=\"A name\" size=\"10\">' If you assign a value of True or False to an attribute,\nit will be rendered as an HTML5 boolean attribute: >>> name = forms . TextInput ( attrs = { \"required\" : True }) >>> name . render ( \"name\" , \"A name\" ) '<input name=\"name\" type=\"text\" value=\"A name\" required>' >>> >>> name = forms . TextInput ( attrs = { \"required\" : False }) >>> name . render ( \"name\" , \"A name\" ) '<input name=\"name\" type=\"text\" value=\"A name\">' supports_microseconds ¶ An attribute that defaults to True . If set to False , the\nmicroseconds part of datetime and time values will be set to 0 . format_value ( value ) [source] ¶ Cleans and returns a value for use in the widget template. value isn’t guaranteed to be valid input, therefore subclass implementations\nshould program defensively. get_context ( name , value , attrs ) [source] ¶ Returns a dictionary of values to use when rendering the widget\ntemplate. By default, the dictionary contains a single key, 'widget' , which is a dictionary representation of the widget\ncontaining the following keys: 'name' : The name of the field from the name argument. 'is_hidden' : A boolean indicating whether or not this widget is\nhidden. 'required' : A boolean indicating whether or not the field for\nthis widget is required. 'value' : The value as returned by format_value() . 'attrs' : HTML attributes to be set on the rendered widget. The\ncombination of the attrs attribute and the attrs argument. 'template_name' : The value of self.template_name . Widget subclasses can provide custom context values by overriding\nthis method. id_for_label ( id_ ) [source] ¶ Returns the HTML ID attribute of this widget for use by a <label> ,\ngiven the ID of the field. Returns an empty string if an ID isn’t\navailable. This hook is necessary because some widgets have multiple HTML\nelements and, thus, multiple IDs. In that case, this method should\nreturn an ID value that corresponds to the first ID in the widget’s\ntags. render ( name , value , attrs = None , renderer = None ) [source] ¶ Renders a widget to HTML using the given renderer. If renderer is None , the renderer from the FORM_RENDERER setting is\nused. value_from_datadict ( data , files , name ) [source] ¶ Given a dictionary of data and this widget’s name, returns the value\nof this widget. files may contain data coming from request.FILES . Returns None if a value wasn’t provided. Note also that value_from_datadict may\nbe called more than once during handling of form data, so if you\ncustomize it and add expensive processing, you should implement some\ncaching mechanism yourself. value_omitted_from_data ( data , files , name ) [source] ¶ Given data and files dictionaries and this widget’s name,\nreturns whether or not there’s data or files for the widget. The method’s result affects whether or not a field in a model form falls back to its default . Special cases are CheckboxInput , CheckboxSelectMultiple , and SelectMultiple , which always return False because an unchecked checkbox and unselected <select multiple> don’t appear in the data of an HTML form\nsubmission, so it’s unknown whether or not the user submitted a value. use_fieldset ¶ An attribute to identify if the widget should be grouped in a <fieldset> with a <legend> when rendered. Defaults to False but is True when the widget contains multiple <input> tags such as CheckboxSelectMultiple , RadioSelect , MultiWidget , SplitDateTimeWidget , and SelectDateWidget . use_required_attribute ( initial ) [source] ¶ Given a form field’s initial value, returns whether or not the\nwidget can be rendered with the required HTML attribute. Forms use\nthis method along with Field.required and Form.use_required_attribute to determine whether or not\nto display the required attribute for each field. By default, returns False for hidden widgets and True otherwise. Special cases are FileInput and ClearableFileInput , which return False when initial is set, and CheckboxSelectMultiple ,\nwhich always returns False because browser validation would require\nall checkboxes to be checked instead of at least one. Override this method in custom widgets that aren’t compatible with\nbrowser validation. For example, a WSYSIWG text editor widget backed by\na hidden textarea element may want to always return False to\navoid browser validation on the hidden field. MultiWidget ¶ class MultiWidget ( widgets , attrs = None ) [source] ¶ A widget that is composed of multiple widgets. MultiWidget works hand in hand with the MultiValueField . MultiWidget has one required argument: widgets ¶ An iterable containing the widgets needed. For example: >>> from django.forms import MultiWidget , TextInput >>> widget = MultiWidget ( widgets = [ TextInput , TextInput ]) >>> widget . render ( \"name\" , [ \"john\" , \"paul\" ]) '<input type=\"text\" name=\"name_0\" value=\"john\"><input type=\"text\" name=\"name_1\" value=\"paul\">' You may provide a dictionary in order to specify custom suffixes for\nthe name attribute on each subwidget. In this case, for each (key, widget) pair, the key will be appended to the name of the\nwidget in order to generate the attribute value. You may provide the\nempty string ( '' ) for a single key, in order to suppress the suffix\nfor one widget. For example: >>> widget = MultiWidget ( widgets = { \"\" : TextInput , \"last\" : TextInput }) >>> widget . render ( \"name\" , [ \"john\" , \"paul\" ]) '<input type=\"text\" name=\"name\" value=\"john\"><input type=\"text\" name=\"name_last\" value=\"paul\">' And one required method: decompress ( value ) [source] ¶ This method takes a single “compressed” value from the field and\nreturns a list of “decompressed” values. The input value can be\nassumed valid, but not necessarily non-empty. This method must be implemented by the subclass, and since the\nvalue may be empty, the implementation must be defensive. The rationale behind “decompression” is that it is necessary to “split”\nthe combined value of the form field into the values for each widget. An example of this is how SplitDateTimeWidget turns a datetime value into a list with date and time split\ninto two separate values: from django.forms import MultiWidget class SplitDateTimeWidget ( MultiWidget ): # ... def decompress ( self , value ): if value : return [ value . date (), value . time ()] return [ None , None ] Tip Note that MultiValueField has a\ncomplementary method compress() with the opposite responsibility - to combine cleaned values of\nall member fields into one. It provides some custom context: get_context ( name , value , attrs ) [source] ¶ In addition to the 'widget' key described in Widget.get_context() , MultiWidget adds a widget['subwidgets'] key. These can be looped over in the widget template: {% for subwidget in widget.subwidgets %} {% include subwidget.template_name with widget = subwidget %} {% endfor %} Here’s an example widget which subclasses MultiWidget to display\na date with the day, month, and year in different select boxes. This widget\nis intended to be used with a DateField rather than\na MultiValueField , thus we have implemented value_from_datadict() : from datetime import date from django import forms class DateSelectorWidget ( forms . MultiWidget ): def __init__ ( self , attrs = None ): days = { day : day for day in range ( 1 , 32 )} months = { month : month for month in range ( 1 , 13 )} years = { year : year for year in [ 2018 , 2019 , 2020 ]} widgets = [ forms . Select ( attrs = attrs , choices = days ), forms . Select ( attrs = attrs , choices = months ), forms . Select ( attrs = attrs , choices = years ), ] super () . __init__ ( widgets , attrs ) def decompress ( self , value ): if isinstance ( value , date ): return [ value . day , value . month , value . year ] elif isinstance ( value , str ): year , month , day = value . split ( \"-\" ) return [ day , month , year ] return [ None , None , None ] def value_from_datadict ( self , data , files , name ): day , month , year = super () . value_from_datadict ( data , files , name ) # DateField expects a single string that it can parse into a date. return \" {} - {} - {} \" . format ( year , month , day ) The constructor creates several Select widgets in a list. The super() method uses this list to set up the widget. The required method decompress() breaks up a datetime.date value into the day, month, and year values corresponding\nto each widget. If an invalid date was selected, such as the non-existent\n30th February, the DateField passes this method a\nstring instead, so that needs parsing. The final return handles when value is None , meaning we don’t have any defaults for our\nsubwidgets. The default implementation of value_from_datadict() returns a\nlist of values corresponding to each Widget . This is appropriate when\nusing a MultiWidget with a MultiValueField . But\nsince we want to use this widget with a DateField ,\nwhich takes a single value, we have overridden this method. The\nimplementation here combines the data from the subwidgets into a string in\nthe format that DateField expects. Built-in widgets ¶ Django provides a representation of all the basic HTML widgets, plus some\ncommonly used groups of widgets in the django.forms.widgets module,\nincluding the input of text , various checkboxes\nand selectors , uploading files ,\nand handling of multi-valued input . Widgets handling input of text ¶ These widgets make use of the HTML elements input and textarea . TextInput ¶ class TextInput [source] ¶ input_type : 'text' template_name : 'django/forms/widgets/text.html' Renders as: <input type=\"text\" ...> NumberInput ¶ class NumberInput [source] ¶ input_type : 'number' template_name : 'django/forms/widgets/number.html' Renders as: <input type=\"number\" ...> Beware that not all browsers support entering localized numbers in number input types. Django itself avoids using them for fields having\ntheir localize property set to True . EmailInput ¶ class EmailInput [source] ¶ input_type : 'email' template_name : 'django/forms/widgets/email.html' Renders as: <input type=\"email\" ...> URLInput ¶ class URLInput [source] ¶ input_type : 'url' template_name : 'django/forms/widgets/url.html' Renders as: <input type=\"url\" ...> PasswordInput ¶ class PasswordInput [source] ¶ input_type : 'password' template_name : 'django/forms/widgets/password.html' Renders as: <input type=\"password\" ...> Takes one optional argument: render_value ¶ Determines whether the widget will have a value filled in when the\nform is re-displayed after a validation error (default is False ). HiddenInput ¶ class HiddenInput [source] ¶ input_type : 'hidden' template_name : 'django/forms/widgets/hidden.html' Renders as: <input type=\"hidden\" ...> Note that there also is a MultipleHiddenInput widget that\nencapsulates a set of hidden input elements. DateInput ¶ class DateInput [source] ¶ input_type : 'text' template_name : 'django/forms/widgets/date.html' Renders as: <input type=\"text\" ...> Takes same arguments as TextInput , with one more optional argument: format ¶ The format in which this field’s initial value will be displayed. If no format argument is provided, the default format is the first\nformat found in DATE_INPUT_FORMATS and respects Format localization . %U , %W , and %j formats are not\nsupported by this widget. DateTimeInput ¶ class DateTimeInput [source] ¶ input_type : 'text' template_name : 'django/forms/widgets/datetime.html' Renders as: <input type=\"text\" ...> Takes same arguments as TextInput , with one more optional argument: format ¶ The format in which this field’s initial value will be displayed. If no format argument is provided, the default format is the first\nformat found in DATETIME_INPUT_FORMATS and respects Format localization . %U , %W , and %j formats are not\nsupported by this widget. By default, the microseconds part of the time value is always set to 0 .\nIf microseconds are required, use a subclass with the supports_microseconds attribute set to True . TimeInput ¶ class TimeInput [source] ¶ input_type : 'text' template_name : 'django/forms/widgets/time.html' Renders as: <input type=\"text\" ...> Takes same arguments as TextInput , with one more optional argument: format ¶ The format in which this field’s initial value will be displayed. If no format argument is provided, the default format is the first\nformat found in TIME_INPUT_FORMATS and respects Format localization . For the treatment of microseconds, see DateTimeInput . Textarea ¶ class Textarea [source] ¶ template_name : 'django/forms/widgets/textarea.html' Renders as: <textarea>...</textarea> Selector and checkbox widgets ¶ These widgets make use of the HTML elements <select> , <input type=\"checkbox\"> , and <input type=\"radio\"> . Widgets that render multiple choices have an option_template_name attribute\nthat specifies the template used to render each choice. For example, for the Select widget, select_option.html renders the <option> for a <select> . CheckboxInput ¶ class CheckboxInput [source] ¶ input_type : 'checkbox' template_name : 'django/forms/widgets/checkbox.html' Renders as: <input type=\"checkbox\" ...> Takes one optional argument: check_test ¶ A callable that takes the value of the CheckboxInput and returns True if the checkbox should be checked for that value. Select ¶ class Select [source] ¶ template_name : 'django/forms/widgets/select.html' option_template_name : 'django/forms/widgets/select_option.html' Renders as: <select><option ...>...</select> choices ¶ This attribute is optional when the form field does not have a choices attribute. If it does, it will override anything you set\nhere when the attribute is updated on the Field . NullBooleanSelect ¶ class NullBooleanSelect [source] ¶ template_name : 'django/forms/widgets/select.html' option_template_name : 'django/forms/widgets/select_option.html' Select widget with options ‘Unknown’, ‘Yes’ and ‘No’ SelectMultiple ¶ class SelectMultiple [source] ¶ template_name : 'django/forms/widgets/select.html' option_template_name : 'django/forms/widgets/select_option.html' Similar to Select , but allows multiple selection: <select multiple>...</select> RadioSelect ¶ class RadioSelect [source] ¶ template_name : 'django/forms/widgets/radio.html' option_template_name : 'django/forms/widgets/radio_option.html' Similar to Select , but rendered as a list of radio buttons within <div> tags: < div > < div >< input type = \"radio\" name = \"...\" ></ div > ... </ div > For more granular control over the generated markup, you can loop over the\nradio buttons in the template. Assuming a form myform with a field beatles that uses a RadioSelect as its widget: < fieldset > < legend > {{ myform.beatles.label }} </ legend > {% for radio in myform.beatles %} < div class = \"myradio\" > {{ radio }} </ div > {% endfor %} </ fieldset > This would generate the following HTML: < fieldset > < legend > Radio buttons </ legend > < div class = \"myradio\" > < label for = \"id_beatles_0\" >< input id = \"id_beatles_0\" name = \"beatles\" type = \"radio\" value = \"john\" required > John </ label > </ div > < div class = \"myradio\" > < label for = \"id_beatles_1\" >< input id = \"id_beatles_1\" name = \"beatles\" type = \"radio\" value = \"paul\" required > Paul </ label > </ div > < div class = \"myradio\" > < label for = \"id_beatles_2\" >< input id = \"id_beatles_2\" name = \"beatles\" type = \"radio\" value = \"george\" required > George </ label > </ div > < div class = \"myradio\" > < label for = \"id_beatles_3\" >< input id = \"id_beatles_3\" name = \"beatles\" type = \"radio\" value = \"ringo\" required > Ringo </ label > </ div > </ fieldset > That included the <label> tags. To get more granular, you can use each\nradio button’s tag , choice_label and id_for_label attributes.\nFor example, this template… < fieldset > < legend > {{ myform.beatles.label }} </ legend > {% for radio in myform.beatles %} < label for = \" {{ radio.id_for_label }} \" > {{ radio.choice_label }} < span class = \"radio\" > {{ radio.tag }} </ span > </ label > {% endfor %} </ fieldset > …will result in the following HTML: < fieldset > < legend > Radio buttons </ legend > < label for = \"id_beatles_0\" > John < span class = \"radio\" >< input id = \"id_beatles_0\" name = \"beatles\" type = \"radio\" value = \"john\" required ></ span > </ label > < label for = \"id_beatles_1\" > Paul < span class = \"radio\" >< input id = \"id_beatles_1\" name = \"beatles\" type = \"radio\" value = \"paul\" required ></ span > </ label > < label for = \"id_beatles_2\" > George < span class = \"radio\" >< input id = \"id_beatles_2\" name = \"beatles\" type = \"radio\" value = \"george\" required ></ span > </ label > < label for = \"id_beatles_3\" > Ringo < span class = \"radio\" >< input id = \"id_beatles_3\" name = \"beatles\" type = \"radio\" value = \"ringo\" required ></ span > </ label > </ fieldset > If you decide not to loop over the radio buttons – e.g., if your template\nincludes {{ myform.beatles }} – they’ll be output in a <div> with <div> tags, as above. The outer <div> container receives the id attribute of the widget,\nif defined, or BoundField.auto_id otherwise. When looping over the radio buttons, the label and input tags include for and id attributes, respectively. Each radio button has an id_for_label attribute to output the element’s ID. CheckboxSelectMultiple ¶ class CheckboxSelectMultiple [source] ¶ template_name : 'django/forms/widgets/checkbox_select.html' option_template_name : 'django/forms/widgets/checkbox_option.html' Similar to SelectMultiple , but rendered as a list of checkboxes: < div > < div >< input type = \"checkbox\" name = \"...\" ></ div > ... </ div > The outer <div> container receives the id attribute of the widget,\nif defined, or BoundField.auto_id otherwise. Like RadioSelect , you can loop over the individual checkboxes for the\nwidget’s choices. Unlike RadioSelect , the checkboxes won’t include the required HTML attribute if the field is required because browser validation\nwould require all checkboxes to be checked instead of at least one. When looping over the checkboxes, the label and input tags include for and id attributes, respectively. Each checkbox has an id_for_label attribute to output the element’s ID. File upload widgets ¶ FileInput ¶ class FileInput [source] ¶ template_name : 'django/forms/widgets/file.html' Renders as: <input type=\"file\" ...> ClearableFileInput ¶ class ClearableFileInput [source] ¶ template_name : 'django/forms/widgets/clearable_file_input.html' Renders as: <input type=\"file\" ...> with an additional checkbox\ninput to clear the field’s value, if the field is not required and has\ninitial data. Composite widgets ¶ MultipleHiddenInput ¶ class MultipleHiddenInput [source] ¶ template_name : 'django/forms/widgets/multiple_hidden.html' Renders as: multiple <input type=\"hidden\" ...> tags A widget that handles multiple hidden widgets for fields that have a list\nof values. SplitDateTimeWidget ¶ class SplitDateTimeWidget [source] ¶ template_name : 'django/forms/widgets/splitdatetime.html' Wrapper (using MultiWidget ) around two widgets: DateInput for the date, and TimeInput for the time. Must be used with SplitDateTimeField rather than DateTimeField . SplitDateTimeWidget has several optional arguments: date_format ¶ Similar to DateInput.format time_format ¶ Similar to TimeInput.format date_attrs ¶ time_attrs ¶ Similar to Widget.attrs . A dictionary containing HTML\nattributes to be set on the rendered DateInput and TimeInput widgets, respectively. If these attributes aren’t\nset, Widget.attrs is used instead. SplitHiddenDateTimeWidget ¶ class SplitHiddenDateTimeWidget [source] ¶ template_name : 'django/forms/widgets/splithiddendatetime.html' Similar to SplitDateTimeWidget , but uses HiddenInput for\nboth date and time. SelectDateWidget ¶ class SelectDateWidget [source] ¶ template_name : 'django/forms/widgets/select_date.html' Wrapper around three Select widgets: one each for\nmonth, day, and year. Takes several optional arguments: years ¶ An optional list/tuple of years to use in the “year” select box.\nThe default is a list containing the current year and the next 9 years. months ¶ An optional dict of months to use in the “months” select box. The keys of the dict correspond to the month number (1-indexed) and\nthe values are the displayed months: MONTHS = { 1 : _ ( \"jan\" ), 2 : _ ( \"feb\" ), 3 : _ ( \"mar\" ), 4 : _ ( \"apr\" ), 5 : _ ( \"may\" ), 6 : _ ( \"jun\" ), 7 : _ ( \"jul\" ), 8 : _ ( \"aug\" ), 9 : _ ( \"sep\" ), 10 : _ ( \"oct\" ), 11 : _ ( \"nov\" ), 12 : _ ( \"dec\" ), } empty_label ¶ If the DateField is not required, SelectDateWidget will have an empty choice at the top of the\nlist (which is --- by default). You can change the text of this\nlabel with the empty_label attribute. empty_label can be a string , list , or tuple . When a string is used, all select\nboxes will each have an empty choice with this label. If empty_label is a list or tuple of 3 string elements, the select boxes will\nhave their own custom label. The labels should be in this order ('year_label', 'month_label', 'day_label') . # A custom empty label with string field1 = forms . DateField ( widget = SelectDateWidget ( empty_label = \"Nothing\" )) # A custom empty label with tuple field1 = forms . DateField ( widget = SelectDateWidget ( empty_label = ( \"Choose Year\" , \"Choose Month\" , \"Choose Day\" ), ), )", "keywords": ["box", "form.fields", "jun", "selection", "clearablefileinput", "extraction", "type=\"checkbox", "field", "#", "legend", "self.template_name", "django.forms", "value_omitted_from_data", "select.html", "numbers", "representation", "range", "programming", "member", "datefield", "myform", "type=\"text", "xhtml", "ids", "multiple_hidden.html", "day_label", "label", "hook", "datetimeinput", "=", "widget.attrs", "months", "select_option.html", "date_format", "tag", "button", "value=\"paul", "choice", "select.choices", "topic", "multiple", "john", "dateinput.format", "type", "nutshell", "processing", "ringo", "decompression", "custom", "kwargs", "documentation", "file", "time.html", "user", "birth_year_choices", "cases", "attribute", "args", "mechanism", "radio", "name=\"name_last", "size", "timeinput.format", "splitdatetimefield", "time", "tags", "render", "date", "select><option", "setting", "dateselectorwidget", "mar", "password", "logic", "name", "id_beatles_0", "web", "appearance", "title=\"your", "selectdatewidget", "return", "deal", "type=\"number", "datetimefield", "number.html", "wrapper", "isinstance", "february", "url", "correspond", "error", "module", "commentform", "radio.choice_label", "pages", "localize", "style", "false", "behavior", "i", "class", "splitdatetime.html", "widget", "green", "sep", "returns", "names", "'", "javascript", "paul", "years", "simpleform", "request", "nov", "output", "input", "*", "page", "textarea.html", "types", "elements", "subclass", "field.required", "select_date.html", "pair", "foundation", "hiddeninput", "jul", "subwidget", "value=\"john\"><input", "form.use_required_attribute", "validation", "nullbooleanselect", "radio.id_for_label", "suffix", "source", "css", "use", "editor", "birth_year", "subclasses", "time_input_formats", "favorite_colors", "similar", "order", "date_input_formats", "j", "</textarea", "default", "type=\"radio", "favorite_colors_choices", "choices", "doctype", "markup", "boundfield.auto_id", "comment", "form", "id_beatles_3", "option", "format", "classes", "myform.beatles.label", "day", "browsers", "f", "multiplehiddeninput", "wsysiwg", "combination", "template", "name=\"comment", "id_beatles_1", "choicefield.choices", "endfor", "formats", "super", "template_name", "boxes", "checkboxes", "widget.subwidgets", "microseconds", "choice_label", "urlinput", "¶", "id", "post", "name=\"name_0", "property", "required></div", "subwidgets", "span", "multiplechoicefield", "implementations", "result", "control", "suffixes", "number", "checkbox_select.html", "clearable_file_input.html", "modelform", "def", "url.html", "hidden.html", "values", "password.html", "auto_id", "string", "_", "handles", "checkbox.html", "choice_field", "hand", "month_label", "url:<input", "ways", "cleans", "labels", "treatment", "django", "class=\"special", "choose", "n’t", "div", "fields", "print", "input_type", "set", "value", "compress", "media", "subwidget.template_name", "form_renderer", "multivaluefield", "data", "browser", "implementation", "container", "w", "base", "guide", "comment:<input", "self", "instance", "localization", "handling", "beatles", "widget['subwidgets", "tip", "datetime.html", "empty_label", "multiwidget", "myform.beatles", "assets", "constructor", "type=\"email", "part", "object", "textarea", "rationale", "groups", "choicefield", "dateinput", "numberinput", "charfield", "is_hidden", "dictionary", "aug", "splithiddendatetimewidget", "rendering", "supports_microseconds", "attrs", "rules", "top", "george", "django.forms.widgets", "responsibility", "fileinput", "detail", "passwordinput", "renders", "get_context", "widgets", "feb", "definition", "name:<input", "year_label", "option_template_name", "html5", "forms", "splithiddendatetime.html", "text.html", "addition", "example", "month", "list", "oct", "use_fieldset", "format_value", "value=\"a", "email", "file.html", "model", "year", "timeinput", "element", "dictionaries", "urlfield", "attributes", "title", "size=\"10", "value_from_datadict", "radio_option.html", "syntax", "checkboxinput", "select", "email.html", "textinput", "keys", "case", "radio.html", "type=\"file", "html", "tuple", "str", "submission", "arguments", "upload", "init", "selector", "emailinput", "e.g.", "name=\"url", "selectmultiple", "checkboxselectmultiple", "key", "renderer", "boundfield.id_for_label", "update", "none", "selectors", "jan", "name=\"name", "get", "):", "type=\"url", "true", "dict", "caching", "splitdatetimewidget", "styling", "id_for_label", "context", "datetime_input_formats", "import", "files", "widget.get_context", "d", ">", "defaults", "decompress", "%", "checkbox", "information", "python", "methods", "myradio", "options", "method", "date.html", "dec", "field1", "argument", "days", "radioselect", "note", "templates", "buttons", "text"], "type": "documentation"},
{"title": "Sending email | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/email/", "content": "Sending email ¶ Although Python provides a mail sending interface via the smtplib module, Django provides a couple of light wrappers over it. These wrappers are\nprovided to make sending email extra quick, to help test email sending during\ndevelopment, and to provide support for platforms that can’t use SMTP. The code lives in the django.core.mail module. Quick examples ¶ Use send_mail() for straightforward email sending. For example, to send a\nplain text message: from django.core.mail import send_mail send_mail ( \"Subject here\" , \"Here is the message.\" , \"from@example.com\" , [ \"to@example.com\" ], fail_silently = False , ) When additional email sending functionality is needed, use EmailMessage or EmailMultiAlternatives . For example, to send\na multipart email that includes both HTML and plain text versions with a\nspecific template and custom headers, you can use the following approach: from django.core.mail import EmailMultiAlternatives from django.template.loader import render_to_string # First, render the plain text content. text_content = render_to_string ( \"templates/emails/my_email.txt\" , context = { \"my_variable\" : 42 }, ) # Secondly, render the HTML content. html_content = render_to_string ( \"templates/emails/my_email.html\" , context = { \"my_variable\" : 42 }, ) # Then, create a multipart email instance. msg = EmailMultiAlternatives ( \"Subject here\" , text_content , \"from@example.com\" , [ \"to@example.com\" ], headers = { \"List-Unsubscribe\" : \"<mailto:unsub@example.com>\" }, ) # Lastly, attach the HTML content to the email instance and send. msg . attach_alternative ( html_content , \"text/html\" ) msg . send () Mail is sent using the SMTP host and port specified in the EMAIL_HOST and EMAIL_PORT settings. The EMAIL_HOST_USER and EMAIL_HOST_PASSWORD settings, if\nset, are used to authenticate to the SMTP server, and the EMAIL_USE_TLS and EMAIL_USE_SSL settings control whether\na secure connection is used. Note The character set of email sent with django.core.mail will be set to\nthe value of your DEFAULT_CHARSET setting. send_mail() ¶ send_mail ( subject , message , from_email , recipient_list , fail_silently = False , auth_user = None , auth_password = None , connection = None , html_message = None ) [source] ¶ In most cases, you can send email using django.core.mail.send_mail() . The subject , message , from_email and recipient_list parameters\nare required. subject : A string. message : A string. from_email : A string. If None , Django will use the value of the DEFAULT_FROM_EMAIL setting. recipient_list : A list of strings, each an email address. Each\nmember of recipient_list will see the other recipients in the “To:”\nfield of the email message. fail_silently : A boolean. When it’s False , send_mail() will raise\nan smtplib.SMTPException if an error occurs. See the smtplib docs for a list of possible exceptions, all of which are subclasses of SMTPException . auth_user : The optional username to use to authenticate to the SMTP\nserver. If this isn’t provided, Django will use the value of the EMAIL_HOST_USER setting. auth_password : The optional password to use to authenticate to the\nSMTP server. If this isn’t provided, Django will use the value of the EMAIL_HOST_PASSWORD setting. connection : The optional email backend to use to send the mail.\nIf unspecified, an instance of the default backend will be used.\nSee the documentation on Email backends for more details. html_message : If html_message is provided, the resulting email will be a multipart/alternative email with message as the text/plain content type and html_message as the text/html content type. The return value will be the number of successfully delivered messages (which\ncan be 0 or 1 since it can only send one message). send_mass_mail() ¶ send_mass_mail ( datatuple , fail_silently = False , auth_user = None , auth_password = None , connection = None ) [source] ¶ django.core.mail.send_mass_mail() is intended to handle mass emailing. datatuple is a tuple in which each element is in this format: ( subject , message , from_email , recipient_list ) fail_silently , auth_user and auth_password have the same functions\nas in send_mail() . Each separate element of datatuple results in a separate email message.\nAs in send_mail() , recipients in the same recipient_list will all see the other addresses in the email messages’\n“To:” field. For example, the following code would send two different messages to\ntwo different sets of recipients; however, only one connection to the\nmail server would be opened: message1 = ( \"Subject here\" , \"Here is the message\" , \"from@example.com\" , [ \"first@example.com\" , \"other@example.com\" ], ) message2 = ( \"Another Subject\" , \"Here is another message\" , \"from@example.com\" , [ \"second@test.com\" ], ) send_mass_mail (( message1 , message2 ), fail_silently = False ) The return value will be the number of successfully delivered messages. send_mass_mail() vs. send_mail() ¶ The main difference between send_mass_mail() and send_mail() is that send_mail() opens a connection to the mail server\neach time it’s executed, while send_mass_mail() uses\na single connection for all of its messages. This makes send_mass_mail() slightly more efficient. mail_admins() ¶ mail_admins ( subject , message , fail_silently = False , connection = None , html_message = None ) [source] ¶ django.core.mail.mail_admins() is a shortcut for sending an email to the\nsite admins, as defined in the ADMINS setting. mail_admins() prefixes the subject with the value of the EMAIL_SUBJECT_PREFIX setting, which is \"[Django] \" by default. The “From:” header of the email will be the value of the SERVER_EMAIL setting. This method exists for convenience and readability. If html_message is provided, the resulting email will be a multipart/alternative email with message as the text/plain content type and html_message as the text/html content type. mail_managers() ¶ mail_managers ( subject , message , fail_silently = False , connection = None , html_message = None ) [source] ¶ django.core.mail.mail_managers() is just like mail_admins() , except it\nsends an email to the site managers, as defined in the MANAGERS setting. Examples ¶ This sends a single email to john @ example . com and jane @ example . com , with them\nboth appearing in the “To:”: send_mail ( \"Subject\" , \"Message.\" , \"from@example.com\" , [ \"john@example.com\" , \"jane@example.com\" ], ) This sends a message to john @ example . com and jane @ example . com , with them both\nreceiving a separate email: datatuple = ( ( \"Subject\" , \"Message.\" , \"from@example.com\" , [ \"john@example.com\" ]), ( \"Subject\" , \"Message.\" , \"from@example.com\" , [ \"jane@example.com\" ]), ) send_mass_mail ( datatuple ) Preventing header injection ¶ Header injection is a security exploit in which an attacker inserts extra\nemail headers to control the “To:” and “From:” in email messages that your\nscripts generate. The Django email functions outlined above all protect against header injection\nby forbidding newlines in header values. If any subject , from_email or recipient_list contains a newline (in either Unix, Windows or Mac style),\nthe email function (e.g. send_mail() ) will raise django.core.mail.BadHeaderError (a subclass of ValueError ) and, hence,\nwill not send the email. It’s your responsibility to validate all data before\npassing it to the email functions. If a message contains headers at the start of the string, the headers will\nbe printed as the first bit of the email message. Here’s an example view that takes a subject , message and from_email from the request’s POST data, sends that to admin @ example . com and redirects to\n“/contact/thanks/” when it’s done: from django.core.mail import BadHeaderError , send_mail from django.http import HttpResponse , HttpResponseRedirect def send_email ( request ): subject = request . POST . get ( \"subject\" , \"\" ) message = request . POST . get ( \"message\" , \"\" ) from_email = request . POST . get ( \"from_email\" , \"\" ) if subject and message and from_email : try : send_mail ( subject , message , from_email , [ \"admin@example.com\" ]) except BadHeaderError : return HttpResponse ( \"Invalid header found.\" ) return HttpResponseRedirect ( \"/contact/thanks/\" ) else : # In reality we'd use a form class # to get proper validation errors. return HttpResponse ( \"Make sure all fields are entered and valid.\" ) The EmailMessage class ¶ Django’s send_mail() and send_mass_mail() functions are actually thin\nwrappers that make use of the EmailMessage class. Not all features of the EmailMessage class are\navailable through the send_mail() and related\nwrapper functions. If you wish to use advanced features, such as BCC’ed\nrecipients, file attachments, or multi-part email, you’ll need to create EmailMessage instances directly. Note This is a design feature. send_mail() and\nrelated functions were originally the only interface Django provided.\nHowever, the list of parameters they accepted was slowly growing over\ntime. It made sense to move to a more object-oriented design for email\nmessages and retain the original functions only for backwards\ncompatibility. EmailMessage is responsible for creating the email\nmessage itself. The email backend is then\nresponsible for sending the email. For convenience, EmailMessage provides a send() method for sending a single email. If you need to send multiple messages, the\nemail backend API provides an alternative . EmailMessage Objects ¶ class EmailMessage [source] ¶ The EmailMessage class is initialized with the\nfollowing parameters (in the given order, if positional arguments are used).\nAll parameters are optional and can be set at any time prior to calling the send() method. subject : The subject line of the email. body : The body text. This should be a plain text message. from_email : The sender’s address. Both fred@example.com and \"Fred\" <fred@example.com> forms are legal. If omitted, the DEFAULT_FROM_EMAIL setting is used. to : A list or tuple of recipient addresses. bcc : A list or tuple of addresses used in the “Bcc” header when\nsending the email. connection : An email backend instance. Use\nthis parameter if you are sending the EmailMessage via send() and you\nwant to use the same connection for multiple messages. If omitted, a new\nconnection is created when send() is called. This parameter is ignored\nwhen using send_messages() . attachments : A list of attachments to put on the message. These can\nbe either MIMEBase instances, or (filename, content, mimetype) triples. headers : A dictionary of extra headers to put on the message. The\nkeys are the header name, values are the header values. It’s up to the\ncaller to ensure header names and values are in the correct format for\nan email message. The corresponding attribute is extra_headers . cc : A list or tuple of recipient addresses used in the “Cc” header\nwhen sending the email. reply_to : A list or tuple of recipient addresses used in the “Reply-To”\nheader when sending the email. For example: from django.core.mail import EmailMessage email = EmailMessage ( \"Hello\" , \"Body goes here\" , \"from@example.com\" , [ \"to1@example.com\" , \"to2@example.com\" ], [ \"bcc@example.com\" ], reply_to = [ \"another@example.com\" ], headers = { \"Message-ID\" : \"foo\" }, ) The class has the following methods: send(fail_silently=False) sends the message. If a connection was\nspecified when the email was constructed, that connection will be used.\nOtherwise, an instance of the default backend will be instantiated and\nused. If the keyword argument fail_silently is True , exceptions\nraised while sending the message will be quashed. An empty list of\nrecipients will not raise an exception. It will return 1 if the message\nwas sent successfully, otherwise 0 . message() constructs a django.core.mail.SafeMIMEText object (a\nsubclass of Python’s MIMEText class) or a django.core.mail.SafeMIMEMultipart object holding the message to be\nsent. If you ever need to extend the EmailMessage class, you’ll probably want to\noverride this method to put the content you want into the MIME object. recipients() returns a list of all the recipients of the message,\nwhether they’re recorded in the to , cc or bcc attributes. This\nis another method you might need to override when subclassing, because the\nSMTP server needs to be told the full list of recipients when the message\nis sent. If you add another way to specify recipients in your class, they\nneed to be returned from this method as well. attach() creates a new file attachment and adds it to the message.\nThere are two ways to call attach() : You can pass it a single argument that is a MIMEBase instance. This will be inserted directly\ninto the resulting message. Alternatively, you can pass attach() three arguments: filename , content and mimetype . filename is the name\nof the file attachment as it will appear in the email, content is\nthe data that will be contained inside the attachment and mimetype is the optional MIME type for the attachment. If you\nomit mimetype , the MIME content type will be guessed from the\nfilename of the attachment. For example: message . attach ( \"design.png\" , img_data , \"image/png\" ) If you specify a mimetype of message/rfc822 , it will also\naccept django.core.mail.EmailMessage and email.message.Message . For a mimetype starting with text/ , content is expected to\nbe a string. Binary data will be decoded using UTF-8, and if that fails,\nthe MIME type will be changed to application/octet-stream and\nthe data will be attached unchanged. In addition, message/rfc822 attachments will no longer be\nbase64-encoded in violation of RFC 2046 Section 5.2.1 , which can cause\nissues with displaying the attachments in Evolution and Thunderbird . attach_file() creates a new attachment using a file from your\nfilesystem. Call it with the path of the file to attach and, optionally,\nthe MIME type to use for the attachment. If the MIME type is omitted, it\nwill be guessed from the filename. You can use it like this: message . attach_file ( \"/images/weather_map.png\" ) For MIME types starting with text/ , binary data is handled as in attach() . Sending alternative content types ¶ Sending multiple content versions ¶ It can be useful to include multiple versions of the content in an email; the\nclassic example is to send both text and HTML versions of a message. With\nDjango’s email library, you can do this using the EmailMultiAlternatives class. class EmailMultiAlternatives [source] ¶ A subclass of EmailMessage that has an\nadditional attach_alternative() method for including extra versions of\nthe message body in the email. All the other methods (including the class\ninitialization) are inherited directly from EmailMessage . attach_alternative ( content , mimetype ) [source] ¶ Attach an alternative representation of the message body in the email. For example, to send a text and HTML combination, you could write: from django.core.mail import EmailMultiAlternatives subject = \"hello\" from_email = \"from@example.com\" to = \"to@example.com\" text_content = \"This is an important message.\" html_content = \"<p>This is an <strong>important</strong> message.</p>\" msg = EmailMultiAlternatives ( subject , text_content , from_email , [ to ]) msg . attach_alternative ( html_content , \"text/html\" ) msg . send () Updating the default content type ¶ By default, the MIME type of the body parameter in an EmailMessage is \"text/plain\" . It is good\npractice to leave this alone, because it guarantees that any recipient will be\nable to read the email, regardless of their mail client. However, if you are\nconfident that your recipients can handle an alternative content type, you can\nuse the content_subtype attribute on the EmailMessage class to change the main content type.\nThe major type will always be \"text\" , but you can change the\nsubtype. For example: msg = EmailMessage ( subject , html_content , from_email , [ to ]) msg . content_subtype = \"html\" # Main content is now text/html msg . send () Email backends ¶ The actual sending of an email is handled by the email backend. The email backend class has the following methods: open() instantiates a long-lived email-sending connection. close() closes the current email-sending connection. send_messages(email_messages) sends a list of EmailMessage objects. If the connection is\nnot open, this call will implicitly open the connection, and close the\nconnection afterward. If the connection is already open, it will be\nleft open after mail has been sent. It can also be used as a context manager, which will automatically call open() and close() as needed: from django.core import mail with mail . get_connection () as connection : mail . EmailMessage ( subject1 , body1 , from1 , [ to1 ], connection = connection , ) . send () mail . EmailMessage ( subject2 , body2 , from2 , [ to2 ], connection = connection , ) . send () Obtaining an instance of an email backend ¶ The get_connection() function in django.core.mail returns an\ninstance of the email backend that you can use. get_connection ( backend = None , fail_silently = False , * args , ** kwargs ) [source] ¶ By default, a call to get_connection() will return an instance of the\nemail backend specified in EMAIL_BACKEND . If you specify the backend argument, an instance of that backend will be instantiated. The fail_silently argument controls how the backend should handle errors.\nIf fail_silently is True, exceptions during the email sending process\nwill be silently ignored. All other arguments are passed directly to the constructor of the\nemail backend. Django ships with several email sending backends. With the exception of the\nSMTP backend (which is the default), these backends are only useful during\ntesting and development. If you have special email sending requirements, you\ncan write your own email backend . SMTP backend ¶ class backends.smtp. EmailBackend ( host = None , port = None , username = None , password = None , use_tls = None , fail_silently = False , use_ssl = None , timeout = None , ssl_keyfile = None , ssl_certfile = None , ** kwargs ) ¶ This is the default backend. Email will be sent through a SMTP server. The value for each argument is retrieved from the matching setting if the\nargument is None : host : EMAIL_HOST port : EMAIL_PORT username : EMAIL_HOST_USER password : EMAIL_HOST_PASSWORD use_tls : EMAIL_USE_TLS use_ssl : EMAIL_USE_SSL timeout : EMAIL_TIMEOUT ssl_keyfile : EMAIL_SSL_KEYFILE ssl_certfile : EMAIL_SSL_CERTFILE The SMTP backend is the default configuration inherited by Django. If you\nwant to specify it explicitly, put the following in your settings: EMAIL_BACKEND = \"django.core.mail.backends.smtp.EmailBackend\" If unspecified, the default timeout will be the one provided by socket.getdefaulttimeout() , which defaults to None (no timeout). Console backend ¶ Instead of sending out real emails the console backend just writes the\nemails that would be sent to the standard output. By default, the console\nbackend writes to stdout . You can use a different stream-like object by\nproviding the stream keyword argument when constructing the connection. To specify this backend, put the following in your settings: EMAIL_BACKEND = \"django.core.mail.backends.console.EmailBackend\" This backend is not intended for use in production – it is provided as a\nconvenience that can be used during development. File backend ¶ The file backend writes emails to a file. A new file is created for each new\nsession that is opened on this backend. The directory to which the files are\nwritten is either taken from the EMAIL_FILE_PATH setting or from\nthe file_path keyword when creating a connection with get_connection() . To specify this backend, put the following in your settings: EMAIL_BACKEND = \"django.core.mail.backends.filebased.EmailBackend\" EMAIL_FILE_PATH = \"/tmp/app-messages\" # change this to a proper location This backend is not intended for use in production – it is provided as a\nconvenience that can be used during development. In-memory backend ¶ The 'locmem' backend stores messages in a special attribute of the django.core.mail module. The outbox attribute is created when the\nfirst message is sent. It’s a list with an EmailMessage instance for each message that would\nbe sent. To specify this backend, put the following in your settings: EMAIL_BACKEND = \"django.core.mail.backends.locmem.EmailBackend\" This backend is not intended for use in production – it is provided as a\nconvenience that can be used during development and testing. Django’s test runner automatically uses this backend for testing . Dummy backend ¶ As the name suggests the dummy backend does nothing with your messages. To\nspecify this backend, put the following in your settings: EMAIL_BACKEND = \"django.core.mail.backends.dummy.EmailBackend\" This backend is not intended for use in production – it is provided as a\nconvenience that can be used during development. Defining a custom email backend ¶ If you need to change how emails are sent you can write your own email\nbackend. The EMAIL_BACKEND setting in your settings file is then\nthe Python import path for your backend class. Custom email backends should subclass BaseEmailBackend that is located in\nthe django.core.mail.backends.base module. A custom email backend must\nimplement the send_messages(email_messages) method. This method receives a\nlist of EmailMessage instances and returns the\nnumber of successfully delivered messages. If your backend has any concept of\na persistent session or connection, you should also implement the open() and close() methods. Refer to smtp.EmailBackend for a reference\nimplementation. Sending multiple emails ¶ Establishing and closing an SMTP connection (or any other network connection,\nfor that matter) is an expensive process. If you have a lot of emails to send,\nit makes sense to reuse an SMTP connection, rather than creating and\ndestroying a connection every time you want to send an email. There are two ways you tell an email backend to reuse a connection. Firstly, you can use the send_messages() method on a connection. This takes\na list of EmailMessage (or subclass) instances, and sends them all\nusing that single connection. As a consequence, any connection set on an individual message is ignored. For example, if you have a function called get_notification_email() that\nreturns a list of EmailMessage objects representing\nsome periodic email you wish to send out, you could send these emails using\na single call to send_messages: from django.core import mail connection = mail . get_connection () # Use default email connection messages = get_notification_email () connection . send_messages ( messages ) In this example, the call to send_messages() opens a connection on the\nbackend, sends the list of messages, and then closes the connection again. The second approach is to use the open() and close() methods on the\nemail backend to manually control the connection. send_messages() will not\nmanually open or close the connection if it is already open, so if you\nmanually open the connection, you can control when it is closed. For example: from django.core import mail connection = mail . get_connection () # Manually open the connection connection . open () # Construct an email message that uses the connection email1 = mail . EmailMessage ( \"Hello\" , \"Body goes here\" , \"from@example.com\" , [ \"to1@example.com\" ], connection = connection , ) email1 . send () # Send the email # Construct two more messages email2 = mail . EmailMessage ( \"Hello\" , \"Body goes here\" , \"from@example.com\" , [ \"to2@example.com\" ], ) email3 = mail . EmailMessage ( \"Hello\" , \"Body goes here\" , \"from@example.com\" , [ \"to3@example.com\" ], ) # Send the two emails in a single call - connection . send_messages ([ email2 , email3 ]) # The connection was already open so send_messages() doesn't close it. # We need to manually close the connection. connection . close () Configuring email for development ¶ There are times when you do not want Django to send emails at\nall. For example, while developing a website, you probably don’t want\nto send out thousands of emails – but you may want to validate that\nemails will be sent to the right people under the right conditions,\nand that those emails will contain the correct content. The easiest way to configure email for local development is to use the console email backend. This backend\nredirects all email to stdout , allowing you to inspect the content of mail. The file email backend can also be useful\nduring development – this backend dumps the contents of every SMTP connection\nto a file that can be inspected at your leisure. Another approach is to use a “dumb” SMTP server that receives the emails\nlocally and displays them to the terminal, but does not actually send\nanything. The aiosmtpd package provides a way to accomplish this: python -m pip install aiosmtpd\n\npython -m aiosmtpd -n -l localhost:8025 This command will start a minimal SMTP server listening on port 8025 of\nlocalhost. This server prints to standard output all email headers and the\nemail body. You then only need to set the EMAIL_HOST and EMAIL_PORT accordingly. For a more detailed discussion of SMTP\nserver options, see the documentation of the aiosmtpd module. For information about unit-testing the sending of emails in your application,\nsee the Email services section of the testing documentation.", "keywords": ["feature", "messages", "platforms", "default_charset", "bcc@example.com", "library", "sender", "field", "#", "mimetext", "prints", "runner", "terminal", "octet", "bcc", "stores", "emails", "host", "representation", "httpresponse", "socket.getdefaulttimeout", "member", "compatibility", "email_subject_prefix", "=", "com", "message1", "results", "john@example.com", "stream", "message", "character", "to1", "filesystem", "wrappers", "cc", "sets", "pip", "process", "mac", "john", "following", "type", "people", "custom", "kwargs", "documentation", "reply", "file", "email2", "my_email.html", "email_use_tls", "recipient_list", "to3@example.com", "cases", "sending", "backends.smtp", "attribute", "smtpexception", "args", "time", "setting", "password", "name", "from_email", "parameter", "backends", "reference", "versions", "unsubscribe", "matter", "thanks/", "manager", "addresses", "return", "5.2.1", "memory", "foo", "examples", "locmem", "smtp", "bcc’ed", "dummy", "username", "wrapper", "error", "timeout", "module", "conditions", "code", "newline", "subject1", "badheadererror", "false", "style", "class", "reply_to", "names", "reality", "request", "email3", "output", "*", "test", "types", "strings", "subclass", "scripts", "my_email.txt", "email_host", "configuration", "recipient", "render_to_string", "validation", "django.core.mail.mail_admins", "section", "plain", "source", "send_mail", "discussion", "mail", "mass", "use", "django.core.mail.mail_managers", "email_use_ssl", "subclasses", "order", "rfc822", "default", "text_content", "html_message", "form", "fred", "format", "thunderbird", "subtype", "evolution", "mail_admins", "emailing", "convenience", "combination", "template", "header", "way", "console", "utf-8", "aiosmtpd", "generate", "send_messages(email_messages", "concept", "session", "¶", "command", "id", "parameters", "post", "services", "emailmultialternatives", "caller", "content", "function", "testing", "view", "omit", "number", "lot", "email_file_path", "mimetype", "def", "values", "string", "windows", "django.core", "unix", "django.core.mail.backends.locmem", "django.core.mail.send_mass_mail", "from1", "mime", "managers", "get_notification_email", "unit", "location", "subject", "ways", "jane", "contents", "image", "attachment", "django", "rfc", "datatuple", "n’t", "filename", "fields", "email_backend", "set", "development", "practice", "value", "line", "bit", "send_mass_mail", "data", "implementation", "to@example.com", "violation", "backend", "get_connection", "from2", "safemimetext", "message2", "security", "shortcut", "instance", "html_content", "initialization", "interface", "consequence", "readability", "exploit", "django.core.mail.backends.base", "functionality", "email.message", "start", "png", "docs", "issues", "constructor", "instances", "emailmessage", "stdout", "object", "email1", "couple", "ssl_certfile", "valueerror", "email_host_user", "website", "dictionary", "keyword", "responsibility", "attacker", "ssl_keyfile", "address", "port", "django.core.mail", "production", "protect", "send", "headers", "difference", "site", "features", "forms", "addition", "attach", "example", "app", "body1", "requirements", "list", "message.</p", "subject2", "attach_alternative", "send_messages", "newlines", "auth_user", "thousands", "email", "safemimemultipart", "smtplib", "send_email", "to1@example.com", "emailbackend", "element", "application", "attributes", "approach", "redirects", "localhost", "auth_password", "sense", "content_subtype", "email_host_password", "keys", "triples", "boolean", "attachments", "network", "html", "errors", "localhost:8025", "tuple", "server", "arguments", "package", "@", "to2@example.com", "msg", "matching", "server_email", "path", "recipients", "functions", "none", "injection", "email_port", "email_ssl_certfile", "leisure", "django.core.mail.send_mail", "api", "support", "outbox", "connection", "context", "alternative", "import", "files", "admins", "directory", "call", "information", "python", "methods", "attach_file", "options", "times", "exception", "body2", "client", "details", "method", "settings", "argument", "email_ssl_keyfile", "body", "important</strong", "design", "templates", "text", "exceptions"], "type": "documentation"},
{"title": "Database transactions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/db/transactions/", "content": "Database transactions ¶ Django gives you a few ways to control how database transactions are managed. Managing database transactions ¶ Django’s default transaction behavior ¶ Django’s default behavior is to run in autocommit mode. Each query is\nimmediately committed to the database, unless a transaction is active. See below for details . Django uses transactions or savepoints automatically to guarantee the\nintegrity of ORM operations that require multiple queries, especially delete() and update() queries. Django’s TestCase class also wraps each test in a\ntransaction for performance reasons. Tying transactions to HTTP requests ¶ A common way to handle transactions on the web is to wrap each request in a\ntransaction. Set ATOMIC_REQUESTS to True in the configuration of each database for which you want to enable\nthis behavior. It works like this. Before calling a view function, Django starts a\ntransaction. If the response is produced without problems, Django commits the\ntransaction. If the view produces an exception, Django rolls back the\ntransaction. You may perform subtransactions using savepoints in your view code, typically\nwith the atomic() context manager. However, at the end of the view,\neither all or none of the changes will be committed. Warning While the simplicity of this transaction model is appealing, it also makes it\ninefficient when traffic increases. Opening a transaction for every view has\nsome overhead. The impact on performance depends on the query patterns of your\napplication and on how well your database handles locking. Per-request transactions and streaming responses When a view returns a StreamingHttpResponse , reading\nthe contents of the response will often execute code to generate the\ncontent. Since the view has already returned, such code runs outside of\nthe transaction. Generally speaking, it isn’t advisable to write to the database while\ngenerating a streaming response, since there’s no sensible way to handle\nerrors after starting to send the response. In practice, this feature wraps every view function in the atomic() decorator described below. Note that only the execution of your view is enclosed in the transactions.\nMiddleware runs outside of the transaction, and so does the rendering of\ntemplate responses. When ATOMIC_REQUESTS is enabled, it’s\nstill possible to prevent views from running in a transaction. non_atomic_requests ( using = None ) [source] ¶ This decorator will negate the effect of ATOMIC_REQUESTS for a given view: from django.db import transaction @transaction . non_atomic_requests def my_view ( request ): do_stuff () @transaction . non_atomic_requests ( using = \"other\" ) def my_other_view ( request ): do_stuff_on_the_other_database () It only works if it’s applied to the view itself. Controlling transactions explicitly ¶ Django provides a single API to control database transactions. atomic ( using = None , savepoint = True , durable = False ) [source] ¶ Atomicity is the defining property of database transactions. atomic allows us to create a block of code within which the atomicity on the\ndatabase is guaranteed. If the block of code is successfully completed, the\nchanges are committed to the database. If there is an exception, the\nchanges are rolled back. atomic blocks can be nested. In this case, when an inner block\ncompletes successfully, its effects can still be rolled back if an\nexception is raised in the outer block at a later point. It is sometimes useful to ensure an atomic block is always the\noutermost atomic block, ensuring that any database changes are\ncommitted when the block is exited without errors. This is known as\ndurability and can be achieved by setting durable=True . If the atomic block is nested within another it raises a RuntimeError . atomic is usable both as a decorator : from django.db import transaction @transaction . atomic def viewfunc ( request ): # This code executes inside a transaction. do_stuff () and as a context manager : from django.db import transaction def viewfunc ( request ): # This code executes in autocommit mode (Django's default). do_stuff () with transaction . atomic (): # This code executes inside a transaction. do_more_stuff () Wrapping atomic in a try/except block allows for natural handling of\nintegrity errors: from django.db import IntegrityError , transaction @transaction . atomic def viewfunc ( request ): create_parent () try : with transaction . atomic (): generate_relationships () except IntegrityError : handle_exception () add_children () In this example, even if generate_relationships() causes a database\nerror by breaking an integrity constraint, you can execute queries in add_children() , and the changes from create_parent() are still\nthere and bound to the same transaction. Note that any operations attempted\nin generate_relationships() will already have been rolled back safely\nwhen handle_exception() is called, so the exception handler can also\noperate on the database if necessary. Avoid catching exceptions inside atomic ! When exiting an atomic block, Django looks at whether it’s exited\nnormally or with an exception to determine whether to commit or roll\nback. If you catch and handle exceptions inside an atomic block,\nyou may hide from Django the fact that a problem has happened. This\ncan result in unexpected behavior. This is mostly a concern for DatabaseError and its\nsubclasses such as IntegrityError . After such an\nerror, the transaction is broken and Django will perform a rollback at\nthe end of the atomic block. If you attempt to run database\nqueries before the rollback happens, Django will raise a TransactionManagementError . You may\nalso encounter this behavior when an ORM-related signal handler raises\nan exception. The correct way to catch database errors is around an atomic block\nas shown above. If necessary, add an extra atomic block for this\npurpose. This pattern has another advantage: it delimits explicitly\nwhich operations will be rolled back if an exception occurs. If you catch exceptions raised by raw SQL queries, Django’s behavior\nis unspecified and database-dependent. You may need to manually revert app state when rolling back a transaction. The values of a model’s fields won’t be reverted when a transaction\nrollback happens. This could lead to an inconsistent model state unless\nyou manually restore the original field values. For example, given MyModel with an active field, this snippet\nensures that the if obj.active check at the end uses the correct\nvalue if updating active to True fails in the transaction: from django.db import DatabaseError , transaction obj = MyModel ( active = False ) obj . active = True try : with transaction . atomic (): obj . save () except DatabaseError : obj . active = False if obj . active : ... This also applies to any other mechanism that may hold app state, such\nas caching or global variables. For example, if the code proactively\nupdates data in the cache after saving an object, it’s recommended to\nuse transaction.on_commit() instead, to defer cache alterations until the transaction is actually\ncommitted. In order to guarantee atomicity, atomic disables some APIs. Attempting\nto commit, roll back, or change the autocommit state of the database\nconnection within an atomic block will raise an exception. atomic takes a using argument which should be the name of a\ndatabase. If this argument isn’t provided, Django uses the \"default\" database. Under the hood, Django’s transaction management code: opens a transaction when entering the outermost atomic block; creates a savepoint when entering an inner atomic block; releases or rolls back to the savepoint when exiting an inner block; commits or rolls back the transaction when exiting the outermost block. You can disable the creation of savepoints for inner blocks by setting the savepoint argument to False . If an exception occurs, Django will\nperform the rollback when exiting the first parent block with a savepoint\nif there is one, and the outermost block otherwise. Atomicity is still\nguaranteed by the outer transaction. This option should only be used if\nthe overhead of savepoints is noticeable. It has the drawback of breaking\nthe error handling described above. You may use atomic when autocommit is turned off. It will only use\nsavepoints, even for the outermost block. Performance considerations Open transactions have a performance cost for your database server. To\nminimize this overhead, keep your transactions as short as possible. This\nis especially important if you’re using atomic() in long-running\nprocesses, outside of Django’s request / response cycle. Autocommit ¶ Why Django uses autocommit ¶ In the SQL standards, each SQL query starts a transaction, unless one is\nalready active. Such transactions must then be explicitly committed or rolled\nback. This isn’t always convenient for application developers. To alleviate this\nproblem, most databases provide an autocommit mode. When autocommit is turned\non and no transaction is active, each SQL query gets wrapped in its own\ntransaction. In other words, not only does each such query start a\ntransaction, but the transaction also gets automatically committed or rolled\nback, depending on whether the query succeeded. PEP 249 , the Python Database API Specification v2.0, requires autocommit to\nbe initially turned off. Django overrides this default and turns autocommit\non. To avoid this, you can deactivate the transaction management , but it isn’t recommended. Deactivating transaction management ¶ You can totally disable Django’s transaction management for a given database\nby setting AUTOCOMMIT to False in its\nconfiguration. If you do this, Django won’t enable autocommit, and won’t\nperform any commits. You’ll get the regular behavior of the underlying\ndatabase library. This requires you to commit explicitly every transaction, even those started\nby Django or by third-party libraries. Thus, this is best used in situations\nwhere you want to run your own transaction-controlling middleware or do\nsomething really strange. Performing actions after commit ¶ Sometimes you need to perform an action related to the current database\ntransaction, but only if the transaction successfully commits. Examples might\ninclude a background task, an email notification, or a cache invalidation. on_commit() allows you to register callbacks that will be executed after\nthe open transaction is successfully committed: on_commit ( func , using = None , robust = False ) [source] ¶ Pass a function, or any callable, to on_commit() : from django.db import transaction def send_welcome_email (): ... transaction . on_commit ( send_welcome_email ) Callbacks will not be passed any arguments, but you can bind them with functools.partial() : from functools import partial for user in users : transaction . on_commit ( partial ( send_invite_email , user = user )) Callbacks are called after the open transaction is successfully committed. If\nthe transaction is instead rolled back (typically when an unhandled exception\nis raised in an atomic() block), the callback will be discarded, and\nnever called. If you call on_commit() while there isn’t an open transaction,\nthe callback will be executed immediately. It’s sometimes useful to register callbacks that can fail. Passing robust=True allows the next callbacks to be executed even if the current\none throws an exception. All errors derived from Python’s Exception class\nare caught and logged to the django.db.backends.base logger. You can use TestCase.captureOnCommitCallbacks() to test callbacks\nregistered with on_commit() . Savepoints ¶ Savepoints (i.e. nested atomic() blocks) are handled correctly. That is,\nan on_commit() callable registered after a savepoint (in a nested atomic() block) will be called after the outer transaction is committed,\nbut not if a rollback to that savepoint or any previous savepoint occurred\nduring the transaction: with transaction . atomic (): # Outer atomic, start a new transaction transaction . on_commit ( foo ) with transaction . atomic (): # Inner atomic block, create a savepoint transaction . on_commit ( bar ) # foo() and then bar() will be called when leaving the outermost block On the other hand, when a savepoint is rolled back (due to an exception being\nraised), the inner callable will not be called: with transaction . atomic (): # Outer atomic, start a new transaction transaction . on_commit ( foo ) try : with transaction . atomic (): # Inner atomic block, create a savepoint transaction . on_commit ( bar ) raise SomeError () # Raising an exception - abort the savepoint except SomeError : pass # foo() will be called, but not bar() Order of execution ¶ On-commit functions for a given transaction are executed in the order they were\nregistered. Exception handling ¶ If one on-commit function registered with robust=False within a given\ntransaction raises an uncaught exception, no later registered functions in that\nsame transaction will run. This is the same behavior as if you’d executed the\nfunctions sequentially yourself without on_commit() . Timing of execution ¶ Your callbacks are executed after a successful commit, so a failure in a\ncallback will not cause the transaction to roll back. They are executed\nconditionally upon the success of the transaction, but they are not part of\nthe transaction. For the intended use cases (mail notifications, background\ntasks, etc.), this should be fine. If it’s not (if your follow-up action is so\ncritical that its failure should mean the failure of the transaction itself),\nthen you don’t want to use the on_commit() hook. Instead, you may want two-phase commit such as the psycopg Two-Phase Commit protocol support and the optional Two-Phase Commit Extensions\nin the Python DB-API specification . Callbacks are not run until autocommit is restored on the connection following\nthe commit (because otherwise any queries done in a callback would open an\nimplicit transaction, preventing the connection from going back into autocommit\nmode). When in autocommit mode and outside of an atomic() block, the function\nwill run immediately, not on commit. On-commit functions only work with autocommit mode and the atomic() (or ATOMIC_REQUESTS ) transaction API. Calling on_commit() when\nautocommit is disabled and you are not within an atomic block will result in an\nerror. Use in tests ¶ Django’s TestCase class wraps each test in a transaction\nand rolls back that transaction after each test, in order to provide test\nisolation. This means that no transaction is ever actually committed, thus your on_commit() callbacks will never be run. You can overcome this limitation by using TestCase.captureOnCommitCallbacks() . This captures your on_commit() callbacks in a list, allowing you to make assertions on them,\nor emulate the transaction committing by calling them. Another way to overcome the limitation is to use TransactionTestCase instead of TestCase . This will mean your transactions are committed,\nand the callbacks will run. However TransactionTestCase flushes the database between tests,\nwhich is significantly slower than TestCase 's isolation. Why no rollback hook? ¶ A rollback hook is harder to implement robustly than a commit hook, since a\nvariety of things can cause an implicit rollback. For instance, if your database connection is dropped because your process was\nkilled without a chance to shut down gracefully, your rollback hook will never\nrun. But there is a solution: instead of doing something during the atomic block\n(transaction) and then undoing it if the transaction fails, use on_commit() to delay doing it in the first place until after the\ntransaction succeeds. It’s a lot easier to undo something you never did in the\nfirst place! Low-level APIs ¶ Warning Always prefer atomic() if possible at all. It accounts for the\nidiosyncrasies of each database and prevents invalid operations. The low level APIs are only useful if you’re implementing your own\ntransaction management. Autocommit ¶ Django provides an API in the django.db.transaction module to manage the\nautocommit state of each database connection. get_autocommit ( using = None ) [source] ¶ set_autocommit ( autocommit , using = None ) [source] ¶ These functions take a using argument which should be the name of a\ndatabase. If it isn’t provided, Django uses the \"default\" database. Autocommit is initially turned on. If you turn it off, it’s your\nresponsibility to restore it. Once you turn autocommit off, you get the default behavior of your database\nadapter, and Django won’t help you. Although that behavior is specified in PEP 249 , implementations of adapters aren’t always consistent with one\nanother. Review the documentation of the adapter you’re using carefully. You must ensure that no transaction is active, usually by issuing a commit() or a rollback() , before turning autocommit back on. Django will refuse to turn autocommit off when an atomic() block is\nactive, because that would break atomicity. Transactions ¶ A transaction is an atomic set of database queries. Even if your program\ncrashes, the database guarantees that either all the changes will be applied,\nor none of them. Django doesn’t provide an API to start a transaction. The expected way to\nstart a transaction is to disable autocommit with set_autocommit() . Once you’re in a transaction, you can choose either to apply the changes\nyou’ve performed until this point with commit() , or to cancel them with rollback() . These functions are defined in django.db.transaction . commit ( using = None ) [source] ¶ rollback ( using = None ) [source] ¶ These functions take a using argument which should be the name of a\ndatabase. If it isn’t provided, Django uses the \"default\" database. Django will refuse to commit or to rollback when an atomic() block is\nactive, because that would break atomicity. Savepoints ¶ A savepoint is a marker within a transaction that enables you to roll back\npart of a transaction, rather than the full transaction. Savepoints are\navailable with the SQLite, PostgreSQL, Oracle, and MySQL (when using the InnoDB\nstorage engine) backends. Other backends provide the savepoint functions, but\nthey’re empty operations – they don’t actually do anything. Savepoints aren’t especially useful if you are using autocommit, the default\nbehavior of Django. However, once you open a transaction with atomic() ,\nyou build up a series of database operations awaiting a commit or rollback. If\nyou issue a rollback, the entire transaction is rolled back. Savepoints\nprovide the ability to perform a fine-grained rollback, rather than the full\nrollback that would be performed by transaction.rollback() . When the atomic() decorator is nested, it creates a savepoint to allow\npartial commit or rollback. You’re strongly encouraged to use atomic() rather than the functions described below, but they’re still part of the\npublic API, and there’s no plan to deprecate them. Each of these functions takes a using argument which should be the name of\na database for which the behavior applies.  If no using argument is\nprovided then the \"default\" database is used. Savepoints are controlled by three functions in django.db.transaction : savepoint ( using = None ) [source] ¶ Creates a new savepoint. This marks a point in the transaction that is\nknown to be in a “good” state. Returns the savepoint ID ( sid ). savepoint_commit ( sid , using = None ) [source] ¶ Releases savepoint sid . The changes performed since the savepoint was\ncreated become part of the transaction. savepoint_rollback ( sid , using = None ) [source] ¶ Rolls back the transaction to savepoint sid . These functions do nothing if savepoints aren’t supported or if the database\nis in autocommit mode. In addition, there’s a utility function: clean_savepoints ( using = None ) [source] ¶ Resets the counter used to generate unique savepoint IDs. The following example demonstrates the use of savepoints: from django.db import transaction # open a transaction @transaction . atomic def viewfunc ( request ): a . save () # transaction now contains a.save() sid = transaction . savepoint () b . save () # transaction now contains a.save() and b.save() if want_to_keep_b : transaction . savepoint_commit ( sid ) # open transaction still contains a.save() and b.save() else : transaction . savepoint_rollback ( sid ) # open transaction now contains only a.save() Savepoints may be used to recover from a database error by performing a partial\nrollback. If you’re doing this inside an atomic() block, the entire block\nwill still be rolled back, because it doesn’t know you’ve handled the situation\nat a lower level! To prevent this, you can control the rollback behavior with\nthe following functions. get_rollback ( using = None ) [source] ¶ set_rollback ( rollback , using = None ) [source] ¶ Setting the rollback flag to True forces a rollback when exiting the\ninnermost atomic block. This may be useful to trigger a rollback without\nraising an exception. Setting it to False prevents such a rollback. Before doing that, make sure\nyou’ve rolled back the transaction to a known-good savepoint within the current\natomic block! Otherwise you’re breaking atomicity and data corruption may\noccur. Database-specific notes ¶ Savepoints in SQLite ¶ While SQLite supports savepoints, a flaw in the design of the sqlite3 module makes them hardly usable. When autocommit is enabled, savepoints don’t make sense. When it’s disabled, sqlite3 commits implicitly before savepoint statements. (In fact, it\ncommits before any statement other than SELECT , INSERT , UPDATE , DELETE and REPLACE .) This bug has two consequences: The low level APIs for savepoints are only usable inside a transaction i.e.\ninside an atomic() block. It’s impossible to use atomic() when autocommit is turned off. Transactions in MySQL ¶ If you’re using MySQL, your tables may or may not support transactions; it\ndepends on your MySQL version and the table types you’re using. (By\n“table types,” we mean something like “InnoDB” or “MyISAM”.) MySQL transaction\npeculiarities are outside the scope of this article, but the MySQL site has information on MySQL transactions . If your MySQL setup does not support transactions, then Django will always\nfunction in autocommit mode: statements will be executed and committed as soon\nas they’re called. If your MySQL setup does support transactions, Django\nwill handle transactions as explained in this document. Handling exceptions within PostgreSQL transactions ¶ Note This section is relevant only if you’re implementing your own transaction\nmanagement. This problem cannot occur in Django’s default mode and atomic() handles it automatically. Inside a transaction, when a call to a PostgreSQL cursor raises an exception\n(typically IntegrityError ), all subsequent SQL in the same transaction\nwill fail with the error “current transaction is aborted, queries ignored\nuntil end of transaction block”. While the basic use of save() is unlikely\nto raise an exception in PostgreSQL, there are more advanced usage patterns\nwhich might, such as saving objects with unique fields, saving using the force_insert / force_update flag, or invoking custom SQL. There are several ways to recover from this sort of error. Transaction rollback ¶ The first option is to roll back the entire transaction. For example: a . save () # Succeeds, but may be undone by transaction rollback try : b . save () # Could throw exception except IntegrityError : transaction . rollback () c . save () # Succeeds, but a.save() may have been undone Calling transaction.rollback() rolls back the entire transaction. Any\nuncommitted database operations will be lost. In this example, the changes\nmade by a.save() would be lost, even though that operation raised no error\nitself. Savepoint rollback ¶ You can use savepoints to control\nthe extent of a rollback. Before performing a database operation that could\nfail, you can set or update the savepoint; that way, if the operation fails,\nyou can roll back the single offending operation, rather than the entire\ntransaction. For example: a . save () # Succeeds, and never undone by savepoint rollback sid = transaction . savepoint () try : b . save () # Could throw exception transaction . savepoint_commit ( sid ) except IntegrityError : transaction . savepoint_rollback ( sid ) c . save () # Succeeds, and a.save() is never undone In this example, a.save() will not be undone in the case where b.save() raises an exception.", "keywords": ["users", "feature", "storage", "pattern", "b", "background", "corruption", "library", "field", "#", "crashes", "action", "cache", "transactionmanagementerror", "send_welcome_email", "words", "ids", "hook", "http", "changes", "=", "engine", "fact", "force_insert", "setup", "tables", "process", "cost", "savepoint", "custom", "objects", "documentation", "constraint", "user", "autocommit", "cases", "callbacks", "mechanism", "runtimeerror", "developers", "warning", "peculiarities", "save", "atomicity", "responses", "simplicity", "send_invite_email", "things", "create_parent", "name", "hood", "execution", "impact", "backends", "web", "testcase.captureoncommitcallbacks", "problems", "my_other_view", "someerror", "queries", "notification", "manager", "do_stuff_on_the_other_database", "handle_exception", "foo", "situation", "timing", "parent", "isolation", "commits", "mymodel", "examples", "failure", "plan", "error", "module", "code", "set_autocommit", "invalidation", "false", "behavior", "c", "class", "sid", "resets", "returns", "snippet", "request", "database", "block", "flag", "add_children", "signal", "query", "test", "postgresql", "types", "creation", "insert", "adapter", "usage", "transactiontestcase", "configuration", "standards", "@transaction", "notifications", "section", "source", "specification", "mail", "use", "commit", "solution", "subclasses", "performance", "releases", "extensions", "operation", "order", "default", "counter", "bug", "option", "callback", "tests", "concern", "advantage", "adapters", "cursor", "limitation", "template", "way", "viewfunc", "transaction.on_commit", "idiosyncrasies", "party", "streaminghttpresponse", "streaming", "¶", "id", "atomic", "property", "content", "function", "implementations", "protocol", "views", "integrity", "view", "extent", "lot", "def", "two", "point", "values", "program", "functools", "databaseerror", "databases", "traffic", "hand", "libraries", "table", "subtransactions", "want_to_keep_b", "blocks", "version", "ways", "level", "contents", "atomic_requests", "article", "roll", "on", "sort", "django", "series", "n’t", "fields", "set", "db", "practice", "value", "rolls", "pep", "data", "handler", "scope", "task", "assertions", "prevents", "instance", "effects", "force_update", "handling", "decorator", "statement", "part", "object", "response", "management", "sql", "utility", "requests", "consequences", "situations", "try", "chance", "rendering", "replace", "logger", "variables", "responsibility", "integrityerror", "obj", "notes", "effect", "savepoints", "overhead", "alterations", "innodb", "drawback", "processes", "check", "site", "sqlite3", "psycopg", "addition", "example", "set_rollback", "app", "func", "list", "orm", "email", "phase", "model", "durability", "b.save", "reasons", "apis", "callable", "place", "application", "actions", "testcase", "ability", "sense", "variety", "myisam", "transaction.rollback", "rollback", "case", "errors", "generate_relationships", "server", "arguments", "middleware", "one", "end", "do_stuff", "sqlite", "delete", "bar", "fails", "functions", "operations", "non_atomic_requests", "success", "update", "my_view", "none", "problem", "patterns", "true", "on_commit", "api", "support", "mode", "flaw", "transactions", "document", "connection", "django.db.backends.base", "context", "cycle", "import", "mysql", "statements", "call", "information", "python", "functools.partial", "exception", "purpose", "details", "forces", "django.db", "transaction", "argument", "a.save", "note", "state", "tasks", "oracle", "marker", "design", "exceptions"], "type": "documentation"},
{"title": "Asynchronous support | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/async/", "content": "Asynchronous support ¶ Django has support for writing asynchronous (“async”) views, along with an\nentirely async-enabled request stack if you are running under ASGI . Async views will still work under\nWSGI, but with performance penalties, and without the ability to have efficient\nlong-running requests. We’re still working on async support for the ORM and other parts of Django.\nYou can expect to see this in future releases. For now, you can use the sync_to_async() adapter to interact with the sync parts of Django.\nThere is also a whole range of async-native Python libraries that you can\nintegrate with. Async views ¶ Any view can be declared async by making the callable part of it return a\ncoroutine - commonly, this is done using async def . For a function-based\nview, this means declaring the whole view using async def . For a\nclass-based view, this means declaring the HTTP method handlers, such as get() and post() as async def (not its __init__() , or as_view() ). Note Django uses asgiref.sync.iscoroutinefunction to test if your view is\nasynchronous or not. If you implement your own method of returning a\ncoroutine, ensure you use asgiref.sync.markcoroutinefunction so this\nfunction returns True . Under a WSGI server, async views will run in their own, one-off event loop.\nThis means you can use async features, like concurrent async HTTP requests,\nwithout any issues, but you will not get the benefits of an async stack. The main benefits are the ability to service hundreds of connections without\nusing Python threads. This allows you to use slow streaming, long-polling, and\nother exciting response types. If you want to use these, you will need to deploy Django using ASGI instead. Warning You will only get the benefits of a fully-asynchronous request stack if you\nhave no synchronous middleware loaded into your site. If there is a piece\nof synchronous middleware, then Django must use a thread per request to\nsafely emulate a synchronous environment for it. Middleware can be built to support both sync and async contexts. Some of Django’s middleware is built like\nthis, but not all. To see what middleware Django has to adapt for, you can\nturn on debug logging for the django.request logger and look for log\nmessages about “Asynchronous handler adapted for middleware …” . In both ASGI and WSGI mode, you can still safely use asynchronous support to\nrun code concurrently rather than serially. This is especially handy when\ndealing with external APIs or data stores. If you want to call a part of Django that is still synchronous, you will need\nto wrap it in a sync_to_async() call. For example: from asgiref.sync import sync_to_async results = await sync_to_async ( sync_function , thread_sensitive = True )( pk = 123 ) If you accidentally try to call a part of Django that is synchronous-only\nfrom an async view, you will trigger Django’s asynchronous safety protection to protect your data from\ncorruption. Decorators ¶ New in Django 5.0. The following decorators can be used with both synchronous and asynchronous\nview functions: cache_control() never_cache() no_append_slash() csrf_exempt() csrf_protect() ensure_csrf_cookie() requires_csrf_token() sensitive_variables() sensitive_post_parameters() gzip_page() condition() conditional_page() etag() last_modified() require_http_methods() require_GET() require_POST() require_safe() vary_on_cookie() vary_on_headers() xframe_options_deny() xframe_options_sameorigin() xframe_options_exempt() For example: from django.views.decorators.cache import never_cache @never_cache def my_sync_view ( request ): ... @never_cache async def my_async_view ( request ): ... Queries & the ORM ¶ With some exceptions, Django can run ORM queries asynchronously as well: async for author in Author . objects . filter ( name__startswith = \"A\" ): book = await author . books . afirst () Detailed notes can be found in Asynchronous queries , but in short: All QuerySet methods that cause an SQL query to occur have an a -prefixed asynchronous variant. async for is supported on all QuerySets (including the output of values() and values_list() .) Django also supports some asynchronous model methods that use the database: async def make_book ( * args , ** kwargs ): book = Book ( ... ) await book . asave ( using = \"secondary\" ) async def make_book_with_tags ( tags , * args , ** kwargs ): book = await Book . objects . acreate ( ... ) await book . tags . aset ( tags ) Transactions do not yet work in async mode. If you have a piece of code that\nneeds transactions behavior, we recommend you write that piece as a single\nsynchronous function and call it using sync_to_async() . Performance ¶ When running in a mode that does not match the view (e.g. an async view under\nWSGI, or a traditional sync view under ASGI), Django must emulate the other\ncall style to allow your code to run. This context-switch causes a small\nperformance penalty of around a millisecond. This is also true of middleware. Django will attempt to minimize the number of\ncontext-switches between sync and async. If you have an ASGI server, but all\nyour middleware and views are synchronous, it will switch just once, before it\nenters the middleware stack. However, if you put synchronous middleware between an ASGI server and an\nasynchronous view, it will have to switch into sync mode for the middleware and\nthen back to async mode for the view. Django will also hold the sync thread\nopen for middleware exception propagation. This may not be noticeable at first,\nbut adding this penalty of one thread per request can remove any async\nperformance advantage. You should do your own performance testing to see what effect ASGI versus WSGI\nhas on your code. In some cases, there may be a performance increase even for\na purely synchronous codebase under ASGI because the request-handling code is\nstill all running asynchronously. In general you will only want to enable ASGI\nmode if you have asynchronous code in your project. Handling disconnects ¶ New in Django 5.0. For long-lived requests, a client may disconnect before the view returns a\nresponse. In this case, an asyncio.CancelledError will be raised in the\nview. You can catch this error and handle it if you need to perform any\ncleanup: async def my_view ( request ): try : # Do some work ... except asyncio . CancelledError : # Handle disconnect raise You can also handle client disconnects in streaming responses . Async safety ¶ DJANGO_ALLOW_ASYNC_UNSAFE ¶ Certain key parts of Django are not able to operate safely in an async\nenvironment, as they have global state that is not coroutine-aware. These parts\nof Django are classified as “async-unsafe”, and are protected from execution in\nan async environment. The ORM is the main example, but there are other parts\nthat are also protected in this way. If you try to run any of these parts from a thread where there is a running\nevent loop , you will get a SynchronousOnlyOperation error. Note that you\ndon’t have to be inside an async function directly to have this error occur. If\nyou have called a sync function directly from an async function,\nwithout using sync_to_async() or similar, then it can also occur. This is\nbecause your code is still running in a thread with an active event loop, even\nthough it may not be declared as async code. If you encounter this error, you should fix your code to not call the offending\ncode from an async context. Instead, write your code that talks to async-unsafe\nfunctions in its own, sync function, and call that using asgiref.sync.sync_to_async() (or any other way of running sync code in\nits own thread). The async context can be imposed upon you by the environment in which you are\nrunning your Django code. For example, Jupyter notebooks and IPython interactive shells both transparently provide an active event loop so that it is\neasier to interact with asynchronous APIs. If you’re using an IPython shell, you can disable this event loop by running: %autoawait off as a command at the IPython prompt. This will allow you to run synchronous code\nwithout generating SynchronousOnlyOperation errors; however, you also won’t be able to await asynchronous APIs. To turn\nthe event loop back on, run: %autoawait on If you’re in an environment other than IPython (or you can’t turn off autoawait in IPython for some reason), you are certain there is no chance\nof your code being run concurrently, and you absolutely need to run your sync\ncode from an async context, then you can disable the warning by setting the DJANGO_ALLOW_ASYNC_UNSAFE environment variable to any value. Warning If you enable this option and there is concurrent access to the\nasync-unsafe parts of Django, you may suffer data loss or corruption. Be\nvery careful and do not use this in production environments. If you need to do this from within Python, do that with os.environ : import os os . environ [ \"DJANGO_ALLOW_ASYNC_UNSAFE\" ] = \"true\" Async adapter functions ¶ It is necessary to adapt the calling style when calling sync code from an async\ncontext, or vice-versa. For this there are two adapter functions, from the asgiref.sync module: async_to_sync() and sync_to_async() . They\nare used to transition between the calling styles while preserving\ncompatibility. These adapter functions are widely used in Django. The asgiref package\nitself is part of the Django project, and it is automatically installed as a\ndependency when you install Django with pip . async_to_sync() ¶ async_to_sync ( async_function , force_new_loop = False ) ¶ Takes an async function and returns a sync function that wraps it. Can be used\nas either a direct wrapper or a decorator: from asgiref.sync import async_to_sync async def get_data (): ... sync_get_data = async_to_sync ( get_data ) @async_to_sync async def get_other_data (): ... The async function is run in the event loop for the current thread, if one is\npresent. If there is no current event loop, a new event loop is spun up\nspecifically for the single async invocation and shut down again once it\ncompletes. In either situation, the async function will execute on a different\nthread to the calling code. Threadlocals and contextvars values are preserved across the boundary in both\ndirections. async_to_sync() is essentially a more powerful version of the asyncio.run() function in Python’s standard library. As well\nas ensuring threadlocals work, it also enables the thread_sensitive mode of sync_to_async() when that wrapper is used below it. sync_to_async() ¶ sync_to_async ( sync_function , thread_sensitive = True ) ¶ Takes a sync function and returns an async function that wraps it. Can be used\nas either a direct wrapper or a decorator: from asgiref.sync import sync_to_async async_function = sync_to_async ( sync_function , thread_sensitive = False ) async_function = sync_to_async ( sensitive_sync_function , thread_sensitive = True ) @sync_to_async def sync_function (): ... Threadlocals and contextvars values are preserved across the boundary in both\ndirections. Sync functions tend to be written assuming they all run in the main\nthread, so sync_to_async() has two threading modes: thread_sensitive=True (the default): the sync function will run in the\nsame thread as all other thread_sensitive functions. This will be the\nmain thread, if the main thread is synchronous and you are using the async_to_sync() wrapper. thread_sensitive=False : the sync function will run in a brand new thread\nwhich is then closed once the invocation completes. Warning asgiref version 3.3.0 changed the default value of the thread_sensitive parameter to True . This is a safer default, and in\nmany cases interacting with Django the correct value, but be sure to\nevaluate uses of sync_to_async() if updating asgiref from a prior\nversion. Thread-sensitive mode is quite special, and does a lot of work to run all\nfunctions in the same thread. Note, though, that it relies on usage of async_to_sync() above it in the stack to correctly run things on the\nmain thread. If you use asyncio.run() or similar, it will fall back to\nrunning thread-sensitive functions in a single, shared thread, but this will\nnot be the main thread. The reason this is needed in Django is that many libraries, specifically\ndatabase adapters, require that they are accessed in the same thread that they\nwere created in. Also a lot of existing Django code assumes it all runs in the\nsame thread, e.g. middleware adding things to a request for later use in views. Rather than introduce potential compatibility issues with this code, we instead\nopted to add this mode so that all existing Django sync code runs in the same\nthread and thus is fully compatible with async mode. Note that sync code will\nalways be in a different thread to any async code that is calling it, so you\nshould avoid passing raw database handles or other thread-sensitive references\naround. In practice this restriction means that you should not pass features of the\ndatabase connection object when calling sync_to_async() . Doing so will\ntrigger the thread safety checks: # DJANGO_SETTINGS_MODULE=settings.py python -m asyncio >>> import asyncio >>> from asgiref.sync import sync_to_async >>> from django.db import connection >>> # In an async context so you cannot use the database directly: >>> connection . cursor () django.core.exceptions.SynchronousOnlyOperation: You cannot call this from an async context - use a thread or sync_to_async. >>> # Nor can you pass resolved connection attributes across threads: >>> await sync_to_async ( connection . cursor )() django.db.utils.DatabaseError: DatabaseWrapper objects created in a thread can only be used in that same thread. The object with alias 'default' was created in thread id 4371465600 and this is thread id 6131478528. Rather, you should encapsulate all database access within a helper function\nthat can be called with sync_to_async() without relying on the connection\nobject in the calling code.", "keywords": ["function", "django.views.decorators.cache", "views", "testing", "view", "production", "wrapper", "number", "lot", "cleanup", "contextvars", "messages", "error", "def", "asgiref.sync.sync_to_async", "module", "code", "get_data", "databasewrapper", "features", "site", "values", "safety", "require_http_methods", "directions", "corruption", "filter", "style", "sync_to_async", "behavior", "millisecond", "class", "example", "disconnects", "#", "access", "false", "i", "modes", "sensitive_sync_function", "handles", "sync_function", "loss", "get_other_data", "vary_on_cookie", "orm", "databaseerror", "connections", "switches", "request", "loop", "django_settings_module", "stores", "event", "gzip_page", "asgiref.sync.markcoroutinefunction", "values_list", "database", "output", "libraries", "occur", "range", "*", "querysets", "stack", "query", "make_book_with_tags", "compatibility", "version", "jupyter", "types", "threading", "model", "apis", "cache_control", "etag", "benefits", "boundary", "transition", "adapter", "disconnect", "condition", "usage", "attributes", "django", "wsgi", "http", "django.core.exceptions", "=", "ability", "results", "asgi", "thread", "notebooks", "book", "shell", "practice", "synchronousonlyoperation", "log", "restriction", "value", "sync", "make_book", "brand", "pip", "django_allow_async_unsafe", "library", "case", "data", "debug", "handler", "shells", "use", "errors", "exceptions", "switch", "environment", "server", "conditional_page", "cancellederror", "author", "a", "async_to_sync", "init", "my_sync_view", "package", "middleware", "variant", "performance", "protection", "kwargs", "await", "hundreds", "objects", "releases", "increase", "sensitive_variables", "asgiref.sync", "force_new_loop", "work", "default", "cases", "polling", "functions", "os.environ", "sync_get_data", "invocation", "handle", "threadlocals", "alias", "require_safe", "my_view", "asgiref.sync.iscoroutinefunction", "args", "option", "helper", "csrf_protect", "issues", "requires_csrf_token", "warning", "decorator", "environ", "get", "styles", "tags", "vary_on_headers", "prompt", "reason", "asyncio", "new", "ipython", "true", "sensitive_post_parameters", "responses", "advantage", "part", "support", "dependency", "adapters", "mode", "references", "things", "require_post", "xframe_options_deny", "transactions", "connection", "vice", "asgiref", "object", "cursor", "context", "xframe_options_exempt", "propagation", "threads", "penalties", "import", "d", "response", "parameter", "penalty", "sql", "execution", "call", "pk", "requests", "way", "xframe_options_sameorigin", "codebase", "python", "checks", "async_function", "chance", "methods", "books", "queries", "@async_to_sync", "logger", "exception", "client", "method", "queryset", "@sync_to_async", "decorators", "uses", "streaming", "piece", "¶", "notes", "command", "handlers", "note", "post", "state", "effect", "situation", "no_append_slash", "environments", "never_cache", "coroutine", "async", "project", "parts"], "type": "documentation"},
{"title": "Signals | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/signals/", "content": "Signals ¶ Django includes a “signal dispatcher” which helps decoupled applications get\nnotified when actions occur elsewhere in the framework. In a nutshell, signals\nallow certain senders to notify a set of receivers that some action has\ntaken place. They’re especially useful when many pieces of code may be\ninterested in the same events. For example, a third-party app can register to be notified of settings\nchanges: from django.apps import AppConfig from django.core.signals import setting_changed def my_callback ( sender , ** kwargs ): print ( \"Setting changed!\" ) class MyAppConfig ( AppConfig ): ... def ready ( self ): setting_changed . connect ( my_callback ) Django’s built-in signals let user code get notified of\ncertain actions. You can also define and send your own custom signals. See Defining and sending signals below. Warning Signals give the appearance of loose coupling, but they can quickly lead to\ncode that is hard to understand, adjust and debug. Where possible you should opt for directly calling the handling code,\nrather than dispatching via a signal. Listening to signals ¶ To receive a signal, register a receiver function using the Signal.connect() method. The receiver function is called when the signal\nis sent. All of the signal’s receiver functions are called one at a time, in\nthe order they were registered. Signal. connect ( receiver , sender = None , weak = True , dispatch_uid = None ) [source] ¶ Parameters : receiver – The callback function which will be connected to this\nsignal. See Receiver functions for more information. sender – Specifies a particular sender to receive signals from. See Connecting to signals sent by specific senders for more information. weak – Django stores signal handlers as weak references by\ndefault. Thus, if your receiver is a local function, it may be\ngarbage collected. To prevent this, pass weak=False when you call\nthe signal’s connect() method. dispatch_uid – A unique identifier for a signal receiver in cases\nwhere duplicate signals may be sent. See Preventing duplicate signals for more information. Let’s see how this works by registering a signal that\ngets called after each HTTP request is finished. We’ll be connecting to the request_finished signal. Receiver functions ¶ First, we need to define a receiver function. A receiver can be any Python\nfunction or method: def my_callback ( sender , ** kwargs ): print ( \"Request finished!\" ) Notice that the function takes a sender argument, along with wildcard\nkeyword arguments ( **kwargs ); all signal handlers must take these arguments. We’ll look at senders a bit later , but\nright now look at the **kwargs argument. All signals send keyword\narguments, and may change those keyword arguments at any time. In the case of request_finished , it’s documented as sending no\narguments, which means we might be tempted to write our signal handling as my_callback(sender) . This would be wrong – in fact, Django will throw an error if you do so. That’s\nbecause at any point arguments could get added to the signal and your receiver\nmust be able to handle those new arguments. Receivers may also be asynchronous functions, with the same signature but\ndeclared using async def : async def my_callback ( sender , ** kwargs ): await asyncio . sleep ( 5 ) print ( \"Request finished!\" ) Signals can be sent either synchronously or asynchronously, and receivers will\nautomatically be adapted to the correct call-style. See sending signals for more information. Changed in Django 5.0: Support for asynchronous receivers was added. Connecting receiver functions ¶ There are two ways you can connect a receiver to a signal. You can take the\nmanual connect route: from django.core.signals import request_finished request_finished . connect ( my_callback ) Alternatively, you can use a receiver() decorator: receiver ( signal , ** kwargs ) [source] ¶ Parameters : signal – A signal or a list of signals to connect a function to. kwargs – Wildcard keyword arguments to pass to a function . Here’s how you connect with the decorator: from django.core.signals import request_finished from django.dispatch import receiver @receiver ( request_finished ) def my_callback ( sender , ** kwargs ): print ( \"Request finished!\" ) Now, our my_callback function will be called each time a request finishes. Where should this code live? Strictly speaking, signal handling and registration code can live anywhere\nyou like, although it’s recommended to avoid the application’s root module\nand its models module to minimize side-effects of importing code. In practice, signal handlers are usually defined in a signals submodule of the application they relate to. Signal receivers are\nconnected in the ready() method of your\napplication configuration class . If\nyou’re using the receiver() decorator, import the signals submodule inside ready() , this will implicitly\nconnect signal handlers: from django.apps import AppConfig from django.core.signals import request_finished class MyAppConfig ( AppConfig ): ... def ready ( self ): # Implicitly connect signal handlers decorated with @receiver. from . import signals # Explicitly connect a signal handler. request_finished . connect ( signals . my_callback ) Note The ready() method may be executed more than\nonce during testing, so you may want to guard your signals from\nduplication , especially if you’re planning\nto send them within tests. Connecting to signals sent by specific senders ¶ Some signals get sent many times, but you’ll only be interested in receiving a\ncertain subset of those signals. For example, consider the django.db.models.signals.pre_save signal sent before a model gets saved.\nMost of the time, you don’t need to know when any model gets saved – just\nwhen one specific model is saved. In these cases, you can register to receive signals sent only by particular\nsenders. In the case of django.db.models.signals.pre_save , the sender\nwill be the model class being saved, so you can indicate that you only want\nsignals sent by some model: from django.db.models.signals import pre_save from django.dispatch import receiver from myapp.models import MyModel @receiver ( pre_save , sender = MyModel ) def my_handler ( sender , ** kwargs ): ... The my_handler function will only be called when an instance of MyModel is saved. Different signals use different objects as their senders; you’ll need to consult\nthe built-in signal documentation for details of each\nparticular signal. Preventing duplicate signals ¶ In some circumstances, the code connecting receivers to signals may run\nmultiple times. This can cause your receiver function to be registered more\nthan once, and thus called as many times for a signal event. For example, the ready() method may be executed more than once\nduring testing. More generally, this occurs everywhere your project imports the\nmodule where you define the signals, because signal registration runs as many\ntimes as it is imported. If this behavior is problematic (such as when using signals to\nsend an email whenever a model is saved), pass a unique identifier as\nthe dispatch_uid argument to identify your receiver function. This\nidentifier will usually be a string, although any hashable object will\nsuffice. The end result is that your receiver function will only be\nbound to the signal once for each unique dispatch_uid value: from django.core.signals import request_finished request_finished . connect ( my_callback , dispatch_uid = \"my_unique_identifier\" ) Defining and sending signals ¶ Your applications can take advantage of the signal infrastructure and provide\nits own signals. When to use custom signals Signals are implicit function calls which make debugging harder. If the\nsender and receiver of your custom signal are both within your project,\nyou’re better off using an explicit function call. Defining signals ¶ class Signal [source] ¶ All signals are django.dispatch.Signal instances. For example: import django.dispatch pizza_done = django . dispatch . Signal () This declares a pizza_done signal. Sending signals ¶ There are two ways to send signals synchronously in Django. Signal. send ( sender , ** kwargs ) [source] ¶ Signal. send_robust ( sender , ** kwargs ) [source] ¶ Signals may also be sent asynchronously. Signal. asend ( sender , ** kwargs ) ¶ Signal. asend_robust ( sender , ** kwargs ) ¶ To send a signal, call either Signal.send() , Signal.send_robust() , await Signal.asend() , or await Signal.asend_robust() . You must provide the sender argument (which is a class most of the time) and may provide as many\nother keyword arguments as you like. For example, here’s how sending our pizza_done signal might look: class PizzaStore : ... def send_pizza ( self , toppings , size ): pizza_done . send ( sender = self . __class__ , toppings = toppings , size = size ) ... All four methods return a list of tuple pairs [(receiver, response), ...] ,\nrepresenting the list of called receiver functions and their response values. send() differs from send_robust() in how exceptions raised by receiver\nfunctions are handled. send() does not catch any exceptions raised by\nreceivers; it simply allows errors to propagate. Thus not all receivers may\nbe notified of a signal in the face of an error. send_robust() catches all errors derived from Python’s Exception class,\nand ensures all receivers are notified of the signal. If an error occurs, the\nerror instance is returned in the tuple pair for the receiver that raised the error. The tracebacks are present on the __traceback__ attribute of the errors\nreturned when calling send_robust() . asend() is similar to send() , but it is a coroutine that must be\nawaited: async def asend_pizza ( self , toppings , size ): await pizza_done . asend ( sender = self . __class__ , toppings = toppings , size = size ) ... Whether synchronous or asynchronous, receivers will be correctly adapted to\nwhether send() or asend() is used. Synchronous receivers will be\ncalled using sync_to_async() when invoked via asend() . Asynchronous\nreceivers will be called using async_to_sync() when invoked via sync() . Similar to the case for middleware ,\nthere is a small performance cost to adapting receivers in this way. Note that\nin order to reduce the number of sync/async calling-style switches within a send() or asend() call, the receivers are grouped by whether or not\nthey are async before being called. This means that an asynchronous receiver\nregistered before a synchronous receiver may be executed after the synchronous\nreceiver. In addition, async receivers are executed concurrently using asyncio.gather() . All built-in signals, except those in the async request-response cycle, are\ndispatched using Signal.send() . Changed in Django 5.0: Support for asynchronous signals was added. Disconnecting signals ¶ Signal. disconnect ( receiver = None , sender = None , dispatch_uid = None ) [source] ¶ To disconnect a receiver from a signal, call Signal.disconnect() . The\narguments are as described in Signal.connect() . The method returns True if a receiver was disconnected and False if not. When sender is passed as a lazy reference to <app label>.<model> , this method always\nreturns None . The receiver argument indicates the registered receiver to disconnect. It\nmay be None if dispatch_uid is used to identify the receiver.", "keywords": ["function", "my_handler", "mymodel", "@receiver", "testing", "result", "pre_save", "send", "receiver", "number", "error", "def", "module", "code", "point", "values", "’s", "my_callback", "asend_pizza", "style", "behavior", "string", "sync_to_async", "class", "example", "sender", "#", "_", "app", "addition", "asyncio.gather", "label>.<model", "list", "pieces", "request_finished", "django.apps", "send_robust", "switches", "request", "signal.send_robust", "stores", "event", "route", "action", "signal", "*", "models", "email", "subset", "ways", "model", "pizzastore", "receivers", "dispatch", "place", "application", "pair", "actions", "disconnect", "django", "http", "configuration", "changes", "=", "sleep", "print", "face", "set", "django.db.models.signals", "fact", "practice", "circumstances", "value", "toppings", "events", "signal.send", "sync", "my_callback(sender", "signal.asend", "bit", "source", "case", "wildcard", "debug", "handler", "errors", "cost", "tuple", "arguments", "identifier", "async_to_sync", "nutshell", "middleware", "self", "calls", "custom", "kwargs", "await", "instance", "django.db.models.signals.pre_save", "objects", "effects", "documentation", "end", "asend", "signal.asend_robust", "handling", "signal.connect", "order", "signature", "default", "user", "cases", "functions", "submodule", "appconfig", "duplication", "signals", "dispatch_uid", "attribute", "none", "garbage", "callback", "tests", "decorator", "warning", "specifies", "size", "time", "asend_robust", "infrastructure", "framework", "asyncio", "instances", "setting", "advantage", "support", "myapp.models", "references", "object", "tracebacks", "pizza_done", "senders", "runs", "cycle", "import", "response", "call", "traceback", "django.core.signals", "way", "information", "reference", "python", "pairs", "keyword", "methods", "dispatcher", "appearance", "times", "exception", "details", "party", "method", "registration", "performance", "root", "settings", "argument", "¶", "coupling", "handlers", "applications", "parameters", "connect", "side", "coroutine", "async", "project", "signal.disconnect", "exceptions"], "type": "documentation"},
{"title": "Base views | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/base/", "content": "Base views ¶ The following three classes provide much of the functionality needed to create\nDjango views. You may think of them as parent views, which can be used by\nthemselves or inherited from. They may not provide all the capabilities\nrequired for projects, in which case there are Mixins and Generic class-based\nviews. Many of Django’s built-in class-based views inherit from other class-based\nviews or various mixins. Because this inheritance chain is very important, the\nancestor classes are  documented under the section title of Ancestors (MRO) .\nMRO is an acronym for Method Resolution Order. View ¶ class django.views.generic.base. View ¶ The base view class. All other class-based views inherit from this base\nclass. It isn’t strictly a generic view and thus can also be imported from django.views . Method Flowchart setup() dispatch() http_method_not_allowed() options() Example views.py : from django.http import HttpResponse from django.views import View class MyView ( View ): def get ( self , request , * args , ** kwargs ): return HttpResponse ( \"Hello, World!\" ) Example urls.py : from django.urls import path from myapp.views import MyView urlpatterns = [ path ( \"mine/\" , MyView . as_view (), name = \"my-view\" ), ] Attributes http_method_names ¶ The list of HTTP method names that this view will accept. Default: [ \"get\" , \"post\" , \"put\" , \"patch\" , \"delete\" , \"head\" , \"options\" , \"trace\" ] Methods classmethod as_view ( ** initkwargs ) ¶ Returns a callable view that takes a request and returns a response: response = MyView . as_view ()( request ) The returned view has view_class and view_initkwargs attributes. When the view is called during the request/response cycle, the setup() method assigns the HttpRequest to\nthe view’s request attribute, and any positional and/or keyword\narguments captured from the URL pattern to the args and kwargs attributes, respectively. Then dispatch() is called. If a View subclass defines asynchronous ( async def ) method\nhandlers, as_view() will mark the returned callable as a coroutine\nfunction. An ImproperlyConfigured exception will be raised if both\nasynchronous ( async def ) and synchronous ( def ) handlers are\ndefined on a single view-class. setup ( request , * args , ** kwargs ) ¶ Performs key view initialization prior to dispatch() . If overriding this method, you must call super() . dispatch ( request , * args , ** kwargs ) ¶ The view part of the view – the method that accepts a request argument plus arguments, and returns an HTTP response. The default implementation will inspect the HTTP method and attempt to\ndelegate to a method that matches the HTTP method; a GET will be\ndelegated to get() , a POST to post() , and so on. By default, a HEAD request will be delegated to get() .\nIf you need to handle HEAD requests in a different way than GET ,\nyou can override the head() method. See Supporting other HTTP methods for an example. http_method_not_allowed ( request , * args , ** kwargs ) ¶ If the view was called with an HTTP method it doesn’t support, this\nmethod is called instead. The default implementation returns HttpResponseNotAllowed with a\nlist of allowed methods in plain text. options ( request , * args , ** kwargs ) ¶ Handles responding to requests for the OPTIONS HTTP verb. Returns a\nresponse with the Allow header containing a list of the view’s\nallowed HTTP method names. If the other HTTP methods handlers on the class are asynchronous\n( async def ) then the response will be wrapped in a coroutine\nfunction for use with await . TemplateView ¶ class django.views.generic.base. TemplateView ¶ Renders a given template, with the context containing parameters captured\nin the URL. Ancestors (MRO) This view inherits methods and attributes from the following views: django.views.generic.base.TemplateResponseMixin django.views.generic.base.ContextMixin django.views.generic.base.View Method Flowchart setup() dispatch() http_method_not_allowed() get_context_data() Example views.py : from django.views.generic.base import TemplateView from articles.models import Article class HomePageView ( TemplateView ): template_name = \"home.html\" def get_context_data ( self , ** kwargs ): context = super () . get_context_data ( ** kwargs ) context [ \"latest_articles\" ] = Article . objects . all ()[: 5 ] return context Example urls.py : from django.urls import path from myapp.views import HomePageView urlpatterns = [ path ( \"\" , HomePageView . as_view (), name = \"home\" ), ] Context Populated (through ContextMixin ) with\nthe keyword arguments captured from the URL pattern that served the view. You can also add context using the extra_context keyword\nargument for as_view() . RedirectView ¶ class django.views.generic.base. RedirectView ¶ Redirects to a given URL. The given URL may contain dictionary-style string formatting, which will be\ninterpolated against the parameters captured in the URL. Because keyword\ninterpolation is always done (even if no arguments are passed in), any \"%\" characters in the URL must be written as \"%%\" so that Python\nwill convert them to a single percent sign on output. If the given URL is None , Django will return an HttpResponseGone (410). Ancestors (MRO) This view inherits methods and attributes from the following view: django.views.generic.base.View Method Flowchart setup() dispatch() http_method_not_allowed() get_redirect_url() Example views.py : from django.shortcuts import get_object_or_404 from django.views.generic.base import RedirectView from articles.models import Article class ArticleCounterRedirectView ( RedirectView ): permanent = False query_string = True pattern_name = \"article-detail\" def get_redirect_url ( self , * args , ** kwargs ): article = get_object_or_404 ( Article , pk = kwargs [ \"pk\" ]) article . update_counter () return super () . get_redirect_url ( * args , ** kwargs ) Example urls.py : from django.urls import path from django.views.generic.base import RedirectView from article.views import ArticleCounterRedirectView , ArticleDetailView urlpatterns = [ path ( \"counter/<int:pk>/\" , ArticleCounterRedirectView . as_view (), name = \"article-counter\" , ), path ( \"details/<int:pk>/\" , ArticleDetailView . as_view (), name = \"article-detail\" ), path ( \"go-to-django/\" , RedirectView . as_view ( url = \"https://www.djangoproject.com/\" ), name = \"go-to-django\" , ), ] Attributes url ¶ The URL to redirect to, as a string. Or None to raise a 410 (Gone)\nHTTP error. pattern_name ¶ The name of the URL pattern to redirect to. Reversing will be done\nusing the same args and kwargs as are passed in for this view. permanent ¶ Whether the redirect should be permanent. The only difference here is\nthe HTTP status code returned. If True , then the redirect will use\nstatus code 301. If False , then the redirect will use status code\n302. By default, permanent is False . query_string ¶ Whether to pass along the GET query string to the new location. If True , then the query string is appended to the URL. If False ,\nthen the query string is discarded. By default, query_string is False . Methods get_redirect_url ( * args , ** kwargs ) ¶ Constructs the target URL for redirection. The args and kwargs arguments are positional and/or keyword\narguments captured from the URL pattern , respectively. The default implementation uses url as a starting\nstring and performs expansion of % named parameters in that string\nusing the named groups captured in the URL. If url is not set, get_redirect_url() tries to reverse the pattern_name using what was captured in the URL (both named and\nunnamed groups are used). If requested by query_string , it will also append the query\nstring to the generated URL.\nSubclasses may implement any behavior they wish, as long as the method\nreturns a redirect-ready URL string.", "keywords": ["function", "views", "homepageview", "get_object_or_404", "view", "contextmixin", "status", "pattern", "url", "error", "def", "target", "difference", "code", "ancestor", "generic", "initkwargs", "verb", "style", "string", "counter/<int", "class", "example", "behavior", "django.views.generic.base", "articles.models", "redirection", "handles", "list", "returns", "names", "articlecounterredirectview", "query_string", "article.views", "request", "formatting", "allow", "output", "location", "mro", "*", "query", "httpresponse", "starting", "subclass", "dispatch", "django.urls", "populated", "view_initkwargs", "home", "article", "pattern_name", "templateview", "articledetailview", "attributes", "django", "http", "title", "=", "redirectview", "redirects", "head", "get_redirect_url", "view_class", "capabilities", "setup", "expansion", "section", "django.shortcuts", "improperlyconfigured", "case", "implementation", "mixins", "details/<int", "ancestors", "use", "base", "arguments", "latest_articles", "subclasses", "self", "await", "kwargs", "defines", "objects", "flowchart", "myview", "initialization", "order", "default", "counter", "path", "trace", "functionality", "attribute", "args", "none", "classes", "characters", "sign", "percent", "get", "http_method_names", "inherit", "part", "projects", "chain", "django.views", "acronym", "context", "cycle", "groups", "import", "name", "httprequest", "httpresponsenotallowed", "template", "response", "httpresponsegone", "gone", "header", "%", "world", "requests", "pk", "as_view", "way", "pk>/", "home.html", "python", "methods", "keyword", "interpolation", "options", "exception", "resolution", "method", "myapp.views", "argument", "¶", "return", "redirect", "handlers", "post", "parameters", "detail", "inheritance", "get_context_data", "parent", "coroutine", "renders", "[:", "text", "async"], "type": "documentation"},
{"title": "Lookup API reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/lookups/", "content": "Lookup API reference ¶ This document has the API references of lookups, the Django API for building\nthe WHERE clause of a database query. To learn how to use lookups, see Making queries ; to learn how to create new lookups, see How to write custom lookups . The lookup API has two components: a RegisterLookupMixin class\nthat registers lookups, and the Query Expression API , a\nset of methods that a class has to implement to be registrable as a lookup. Django has two base classes that follow the query expression API and from where\nall Django builtin lookups are derived: Lookup : to lookup a field (e.g. the exact of field_name__exact ) Transform : to transform a field A lookup expression consists of three parts: Fields part (e.g. Book.objects.filter(author__best_friends__first_name... ); Transforms part (may be omitted) (e.g. __lower__first3chars__reversed ); A lookup (e.g. __icontains ) that, if omitted, defaults to __exact . Registration API ¶ Django uses RegisterLookupMixin to give a class the interface to\nregister lookups on itself or its instances. The two prominent examples are Field , the base class of all model fields, and Transform , the base class of all Django transforms. class lookups. RegisterLookupMixin ¶ A mixin that implements the lookup API on a class. classmethod register_lookup ( lookup , lookup_name = None ) ¶ Registers a new lookup in the class or class instance. For example: DateField . register_lookup ( YearExact ) User . _meta . get_field ( \"date_joined\" ) . register_lookup ( MonthExact ) will register YearExact lookup on DateField and MonthExact lookup on the User.date_joined (you can use Field Access API to retrieve a single field instance). It\noverrides a lookup that already exists with the same name. Lookups\nregistered on field instances take precedence over the lookups\nregistered on classes. lookup_name will be used for this lookup if\nprovided, otherwise lookup.lookup_name will be used. get_lookup ( lookup_name ) ¶ Returns the Lookup named lookup_name registered in the\nclass or class instance depending on what calls it. The default\nimplementation looks recursively on all parent classes and checks if\nany has a registered lookup named lookup_name , returning the first\nmatch. Instance lookups would override any class lookups with the same lookup_name . get_lookups () ¶ Returns a dictionary of each lookup name registered in the class or\nclass instance mapped to the Lookup class. get_transform ( transform_name ) ¶ Returns a Transform named transform_name registered in the\nclass or class instance. The default implementation looks recursively\non all parent classes to check if any has the registered transform\nnamed transform_name , returning the first match. For a class to be a lookup, it must follow the Query Expression API . Lookup and Transform naturally\nfollow this API. The Query Expression API ¶ The query expression API is a common set of methods that classes define to be\nusable in query expressions to translate themselves into SQL expressions. Direct\nfield references, aggregates, and Transform are examples that follow this\nAPI. A class is said to follow the query expression API when it implements the\nfollowing methods: as_sql ( compiler , connection ) ¶ Generates the SQL fragment for the expression. Returns a tuple (sql, params) , where sql is the SQL string, and params is the\nlist or tuple of query parameters. The compiler is an SQLCompiler object, which has a compile() method that can be used to compile other\nexpressions. The connection is the connection used to execute the\nquery. Calling expression.as_sql() is usually incorrect - instead compiler.compile(expression) should be used. The compiler.compile() method will take care of calling vendor-specific methods of the expression. Custom keyword arguments may be defined on this method if it’s likely that as_vendorname() methods or subclasses will need to supply data to\noverride the generation of the SQL string. See Func.as_sql() for\nexample usage. as_vendorname ( compiler , connection ) ¶ Works like as_sql() method. When an expression is compiled by compiler.compile() , Django will first try to call as_vendorname() ,\nwhere vendorname is the vendor name of the backend used for executing\nthe query. The vendorname is one of postgresql , oracle , sqlite , or mysql for Django’s built-in backends. get_lookup ( lookup_name ) ¶ Must return the lookup named lookup_name . For instance, by returning self.output_field.get_lookup(lookup_name) . get_transform ( transform_name ) ¶ Must return the lookup named transform_name . For instance, by returning self.output_field.get_transform(transform_name) . output_field ¶ Defines the type of class returned by the get_lookup() method. It must\nbe a Field instance. Transform reference ¶ class Transform [source] ¶ A Transform is a generic class to implement field transformations. A\nprominent example is __year that transforms a DateField into a IntegerField . The notation to use a Transform in a lookup expression is <expression>__<transformation> (e.g. date__year ). This class follows the Query Expression API , which\nimplies that you can use <expression>__<transform1>__<transform2> . It’s\na specialized Func() expression that only accepts\none argument.  It can also be used on the right hand side of a filter or\ndirectly as an annotation. bilateral ¶ A boolean indicating whether this transformation should apply to both lhs and rhs . Bilateral transformations will be applied to rhs in\nthe same order as they appear in the lookup expression. By default it is set\nto False . For example usage, see How to write custom lookups . lhs [source] ¶ The left-hand side - what is being transformed. It must follow the Query Expression API . lookup_name ¶ The name of the lookup, used for identifying it on parsing query\nexpressions. It cannot contain the string \"__\" . output_field ¶ Defines the class this transformation outputs. It must be a Field instance. By default is the same as\nits lhs.output_field . Lookup reference ¶ class Lookup [source] ¶ A Lookup is a generic class to implement lookups. A lookup is a query\nexpression with a left-hand side, lhs ; a right-hand side, rhs ; and a lookup_name that is used to produce a boolean\ncomparison between lhs and rhs such as lhs in rhs or lhs > rhs . The primary notation to use a lookup in an expression is <lhs>__<lookup_name>=<rhs> . Lookups can also be used directly in QuerySet filters: Book . objects . filter ( LessThan ( F ( \"word_count\" ), 7500 )) …or annotations: Book . objects . annotate ( is_short_story = LessThan ( F ( \"word_count\" ), 7500 )) lhs ¶ The left-hand side - what is being looked up. The object typically\nfollows the Query Expression API . It may also\nbe a plain value. rhs ¶ The right-hand side - what lhs is being compared against. It can be\na plain value, or something that compiles into SQL, typically an F() object or a QuerySet . lookup_name ¶ The name of this lookup, used to identify it on parsing query\nexpressions. It cannot contain the string \"__\" . prepare_rhs ¶ Defaults to True . When rhs is a plain value, prepare_rhs determines whether it should be prepared for use as\na parameter in a query. In order to do so, lhs.output_field.get_prep_value() is called if defined, or rhs is wrapped in Value() otherwise. process_lhs ( compiler , connection , lhs = None ) [source] ¶ Returns a tuple (lhs_string, lhs_params) , as returned by compiler.compile(lhs) . This method can be overridden to tune how\nthe lhs is processed. compiler is an SQLCompiler object, to be used like compiler.compile(lhs) for compiling lhs . The connection can be used for compiling vendor specific SQL. If lhs is not None , use it as the processed lhs instead of self.lhs . process_rhs ( compiler , connection ) [source] ¶ Behaves the same way as process_lhs() , for the right-hand side.", "keywords": ["examples", "integerfield", "self.output_field.get_lookup(lookup_name", "user.date_joined", "classmethod", "expression>__<transformation", "expression>__<transform1>__<transform2", "filter", "string", "false", "access", "class", "example", "clause", "field", "monthexact", "care", "is_short_story", "func", "list", "returns", "compiler", "sqlcompiler", "database", "hand", "lhs", "get_transform", "self.output_field.get_transform(transform_name", "match", "query", "rhs", "postgresql", "datefield", "vendorname", "model", "register_lookup", "get_field", "year", "yearexact", "annotation", "compiler.compile(lhs", "mixin", "usage", "django", "=", "fields", "set", "book", "get_lookups", "icontains", "value", "lhs>__<lookup_name>=<rhs", "prepare_rhs", "source", "compiler.compile", "implementation", "data", "lookup", "use", "base", "backend", "tuple", "arguments", "registers", "lhs_params", "type", "a", "word_count", "as_sql", "subclasses", "custom", "instance", "defines", "outputs", "generation", "lookups", "output_field", "comparison", "field_name__exact", "lookup.lookup_name", "order", "interface", "lhs_string", "params", "default", "user", "fragment", "lhs.output_field.get_prep_value", "process_lhs", "annotations", "none", "expression.as_sql", "compiler.compile(expression", "filters", "expression", "classes", "meta", "transformation", "as_vendorname", "registerlookupmixin", "instances", "true", "annotate", "lhs.output_field", "components", "api", "part", "f", "references", "transform", "document", "object", "connection", "builtin", "transformations", "name", "get_lookup", "parameter", "precedence", "mysql", "aggregates", "lookup_name", "defaults", "dictionary", "sql", "compile", "way", "backends", "reference", "lessthan", "checks", "methods", "keyword", "queries", "func.as_sql", "transform_name", "vendor", "notation", "method", "registration", "queryset", "argument", "¶", "behaves", "parameters", "expressions", "oracle", "parent", "side", "exact", "book.objects.filter(author__best_friends__first_name", "parts"], "type": "documentation"},
{"title": "Formsets | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/forms/formsets/", "content": "Formsets ¶ class BaseFormSet [source] ¶ A formset is a layer of abstraction to work with multiple forms on the same\npage. It can be best compared to a data grid. Let’s say you have the following\nform: >>> from django import forms >>> class ArticleForm ( forms . Form ): ... title = forms . CharField () ... pub_date = forms . DateField () ... You might want to allow the user to create several articles at once. To create\na formset out of an ArticleForm you would do: >>> from django.forms import formset_factory >>> ArticleFormSet = formset_factory ( ArticleForm ) You now have created a formset class named ArticleFormSet .\nInstantiating the formset gives you the ability to iterate over the forms\nin the formset and display them as you would with a regular form: >>> formset = ArticleFormSet () >>> for form in formset : ... print ( form ) ... <div><label for=\"id_form-0-title\">Title:</label><input type=\"text\" name=\"form-0-title\" id=\"id_form-0-title\"></div> <div><label for=\"id_form-0-pub_date\">Pub date:</label><input type=\"text\" name=\"form-0-pub_date\" id=\"id_form-0-pub_date\"></div> As you can see it only displayed one empty form. The number of empty forms\nthat is displayed is controlled by the extra parameter. By default, formset_factory() defines one extra form; the\nfollowing example will create a formset class to display two blank forms: >>> ArticleFormSet = formset_factory ( ArticleForm , extra = 2 ) Formsets can be iterated and indexed, accessing forms in the order they were\ncreated. You can reorder the forms by overriding the default iteration and indexing behavior if needed. Using initial data with a formset ¶ Initial data is what drives the main usability of a formset. As shown above\nyou can define the number of extra forms. What this means is that you are\ntelling the formset how many additional forms to show in addition to the\nnumber of forms it generates from the initial data. Let’s take a look at an\nexample: >>> import datetime >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> ArticleFormSet = formset_factory ( ArticleForm , extra = 2 ) >>> formset = ArticleFormSet ( ... initial = [ ... { ... \"title\" : \"Django is now open source\" , ... \"pub_date\" : datetime . date . today (), ... } ... ] ... ) >>> for form in formset : ... print ( form ) ... <div><label for=\"id_form-0-title\">Title:</label><input type=\"text\" name=\"form-0-title\" value=\"Django is now open source\" id=\"id_form-0-title\"></div> <div><label for=\"id_form-0-pub_date\">Pub date:</label><input type=\"text\" name=\"form-0-pub_date\" value=\"2023-02-11\" id=\"id_form-0-pub_date\"></div> <div><label for=\"id_form-1-title\">Title:</label><input type=\"text\" name=\"form-1-title\" id=\"id_form-1-title\"></div> <div><label for=\"id_form-1-pub_date\">Pub date:</label><input type=\"text\" name=\"form-1-pub_date\" id=\"id_form-1-pub_date\"></div> <div><label for=\"id_form-2-title\">Title:</label><input type=\"text\" name=\"form-2-title\" id=\"id_form-2-title\"></div> <div><label for=\"id_form-2-pub_date\">Pub date:</label><input type=\"text\" name=\"form-2-pub_date\" id=\"id_form-2-pub_date\"></div> There are now a total of three forms showing above. One for the initial data\nthat was passed in and two extra forms. Also note that we are passing in a\nlist of dictionaries as the initial data. If you use an initial for displaying a formset, you should pass the same initial when processing that formset’s submission so that the formset can\ndetect which forms were changed by the user. For example, you might have\nsomething like: ArticleFormSet(request.POST, initial=[...]) . See also Creating formsets from models with model formsets . Limiting the maximum number of forms ¶ The max_num parameter to formset_factory() gives you the ability to limit the number of forms the formset will display: >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> ArticleFormSet = formset_factory ( ArticleForm , extra = 2 , max_num = 1 ) >>> formset = ArticleFormSet () >>> for form in formset : ... print ( form ) ... <div><label for=\"id_form-0-title\">Title:</label><input type=\"text\" name=\"form-0-title\" id=\"id_form-0-title\"></div> <div><label for=\"id_form-0-pub_date\">Pub date:</label><input type=\"text\" name=\"form-0-pub_date\" id=\"id_form-0-pub_date\"></div> If the value of max_num is greater than the number of existing items in the\ninitial data, up to extra additional blank forms will be added to the\nformset, so long as the total number of forms does not exceed max_num . For\nexample, if extra=2 and max_num=2 and the formset is initialized with\none initial item, a form for the initial item and one blank form will be\ndisplayed. If the number of items in the initial data exceeds max_num , all initial\ndata forms will be displayed regardless of the value of max_num and no\nextra forms will be displayed. For example, if extra=3 and max_num=1 and the formset is initialized with two initial items, two forms with the\ninitial data will be displayed. A max_num value of None (the default) puts a high limit on the number\nof forms displayed (1000). In practice this is equivalent to no limit. By default, max_num only affects how many forms are displayed and does not\naffect validation.  If validate_max=True is passed to the formset_factory() , then max_num will affect\nvalidation.  See validate_max . Limiting the maximum number of instantiated forms ¶ The absolute_max parameter to formset_factory() allows limiting the\nnumber of forms that can be instantiated when supplying POST data. This\nprotects against memory exhaustion attacks using forged POST requests: >>> from django.forms.formsets import formset_factory >>> from myapp.forms import ArticleForm >>> ArticleFormSet = formset_factory ( ArticleForm , absolute_max = 1500 ) >>> data = { ... \"form-TOTAL_FORMS\" : \"1501\" , ... \"form-INITIAL_FORMS\" : \"0\" , ... } >>> formset = ArticleFormSet ( data ) >>> len ( formset . forms ) 1500 >>> formset . is_valid () False >>> formset . non_form_errors () ['Please submit at most 1000 forms.'] When absolute_max is None , it defaults to max_num + 1000 . (If max_num is None , it defaults to 2000 ). If absolute_max is less than max_num , a ValueError will be raised. Formset validation ¶ Validation with a formset is almost identical to a regular Form . There is\nan is_valid method on the formset to provide a convenient way to validate\nall forms in the formset: >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> ArticleFormSet = formset_factory ( ArticleForm ) >>> data = { ... \"form-TOTAL_FORMS\" : \"1\" , ... \"form-INITIAL_FORMS\" : \"0\" , ... } >>> formset = ArticleFormSet ( data ) >>> formset . is_valid () True We passed in no data to the formset which is resulting in a valid form. The\nformset is smart enough to ignore extra forms that were not changed. If we\nprovide an invalid article: >>> data = { ... \"form-TOTAL_FORMS\" : \"2\" , ... \"form-INITIAL_FORMS\" : \"0\" , ... \"form-0-title\" : \"Test\" , ... \"form-0-pub_date\" : \"1904-06-16\" , ... \"form-1-title\" : \"Test\" , ... \"form-1-pub_date\" : \"\" , # <-- this date is missing but required ... } >>> formset = ArticleFormSet ( data ) >>> formset . is_valid () False >>> formset . errors [{}, {'pub_date': ['This field is required.']}] As we can see, formset.errors is a list whose entries correspond to the\nforms in the formset. Validation was performed for each of the two forms, and\nthe expected error message appears for the second item. Just like when using a normal Form , each field in a formset’s forms may\ninclude HTML attributes such as maxlength for browser validation. However,\nform fields of formsets won’t include the required attribute as that\nvalidation may be incorrect when adding and deleting forms. BaseFormSet. total_error_count () [source] ¶ To check how many errors there are in the formset, we can use the total_error_count method: >>> # Using the previous example >>> formset . errors [{}, {'pub_date': ['This field is required.']}] >>> len ( formset . errors ) 2 >>> formset . total_error_count () 1 We can also check if form data differs from the initial data (i.e. the form was\nsent without any data): >>> data = { ... \"form-TOTAL_FORMS\" : \"1\" , ... \"form-INITIAL_FORMS\" : \"0\" , ... \"form-0-title\" : \"\" , ... \"form-0-pub_date\" : \"\" , ... } >>> formset = ArticleFormSet ( data ) >>> formset . has_changed () False Understanding the ManagementForm ¶ You may have noticed the additional data ( form-TOTAL_FORMS , form-INITIAL_FORMS ) that was required in the formset’s data above. This\ndata is required for the ManagementForm . This form is used by the formset\nto manage the collection of forms contained in the formset. If you don’t\nprovide this management data, the formset will be invalid: >>> data = { ... \"form-0-title\" : \"Test\" , ... \"form-0-pub_date\" : \"\" , ... } >>> formset = ArticleFormSet ( data ) >>> formset . is_valid () False It is used to keep track of how many form instances are being displayed. If\nyou are adding new forms via JavaScript, you should increment the count fields\nin this form as well. On the other hand, if you are using JavaScript to allow\ndeletion of existing objects, then you need to ensure the ones being removed\nare properly marked for deletion by including form-#-DELETE in the POST data. It is expected that all forms are present in the POST data regardless. The management form is available as an attribute of the formset\nitself. When rendering a formset in a template, you can include all\nthe management data by rendering {{ my_formset.management_form }} (substituting the name of your formset as appropriate). Note As well as the form-TOTAL_FORMS and form-INITIAL_FORMS fields shown\nin the examples here, the management form also includes form-MIN_NUM_FORMS and form-MAX_NUM_FORMS fields. They are output\nwith the rest of the management form, but only for the convenience of\nclient-side code. These fields are not required and so are not shown in\nthe example POST data. total_form_count and initial_form_count ¶ BaseFormSet has a couple of methods that are closely related to the ManagementForm , total_form_count and initial_form_count . total_form_count returns the total number of forms in this formset. initial_form_count returns the number of forms in the formset that were\npre-filled, and is also used to determine how many forms are required. You\nwill probably never need to override either of these methods, so please be\nsure you understand what they do before doing so. empty_form ¶ BaseFormSet provides an additional attribute empty_form which returns\na form instance with a prefix of __prefix__ for easier use in dynamic\nforms with JavaScript. error_messages ¶ The error_messages argument lets you override the default messages that the\nformset will raise. Pass in a dictionary with keys matching the error messages\nyou want to override. Error message keys include 'too_few_forms' , 'too_many_forms' , and 'missing_management_form' . The 'too_few_forms' and 'too_many_forms' error messages may contain %(num)d , which will be replaced with min_num and max_num ,\nrespectively. For example, here is the default error message when the\nmanagement form is missing: >>> formset = ArticleFormSet ({}) >>> formset . is_valid () False >>> formset . non_form_errors () ['ManagementForm data is missing or has been tampered with. Missing fields: form-TOTAL_FORMS, form-INITIAL_FORMS. You may need to file a bug report if the issue persists.'] And here is a custom error message: >>> formset = ArticleFormSet ( ... {}, error_messages = { \"missing_management_form\" : \"Sorry, something went wrong.\" } ... ) >>> formset . is_valid () False >>> formset . non_form_errors () ['Sorry, something went wrong.'] Custom formset validation ¶ A formset has a clean method similar to the one on a Form class. This\nis where you define your own validation that works at the formset level: >>> from django.core.exceptions import ValidationError >>> from django.forms import BaseFormSet >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> class BaseArticleFormSet ( BaseFormSet ): ... def clean ( self ): ... \"\"\"Checks that no two articles have the same title.\"\"\" ... if any ( self . errors ): ... # Don't bother validating the formset unless each form is valid on its own ... return ... titles = set () ... for form in self . forms : ... if self . can_delete and self . _should_delete_form ( form ): ... continue ... title = form . cleaned_data . get ( \"title\" ) ... if title in titles : ... raise ValidationError ( \"Articles in a set must have distinct titles.\" ) ... titles . add ( title ) ... >>> ArticleFormSet = formset_factory ( ArticleForm , formset = BaseArticleFormSet ) >>> data = { ... \"form-TOTAL_FORMS\" : \"2\" , ... \"form-INITIAL_FORMS\" : \"0\" , ... \"form-0-title\" : \"Test\" , ... \"form-0-pub_date\" : \"1904-06-16\" , ... \"form-1-title\" : \"Test\" , ... \"form-1-pub_date\" : \"1912-06-23\" , ... } >>> formset = ArticleFormSet ( data ) >>> formset . is_valid () False >>> formset . errors [{}, {}] >>> formset . non_form_errors () ['Articles in a set must have distinct titles.'] The formset clean method is called after all the Form.clean methods\nhave been called. The errors will be found using the non_form_errors() method on the formset. Non-form errors will be rendered with an additional class of nonform to\nhelp distinguish them from form-specific errors. For example, {{ formset.non_form_errors }} would look like: < ul class = \"errorlist nonform\" > < li > Articles in a set must have distinct titles. </ li > </ ul > Validating the number of forms in a formset ¶ Django provides a couple ways to validate the minimum or maximum number of\nsubmitted forms. Applications which need more customizable validation of the\nnumber of forms should use custom formset validation. validate_max ¶ If validate_max=True is passed to formset_factory() , validation will also check\nthat the number of forms in the data set, minus those marked for\ndeletion, is less than or equal to max_num . >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> ArticleFormSet = formset_factory ( ArticleForm , max_num = 1 , validate_max = True ) >>> data = { ... \"form-TOTAL_FORMS\" : \"2\" , ... \"form-INITIAL_FORMS\" : \"0\" , ... \"form-0-title\" : \"Test\" , ... \"form-0-pub_date\" : \"1904-06-16\" , ... \"form-1-title\" : \"Test 2\" , ... \"form-1-pub_date\" : \"1912-06-23\" , ... } >>> formset = ArticleFormSet ( data ) >>> formset . is_valid () False >>> formset . errors [{}, {}] >>> formset . non_form_errors () ['Please submit at most 1 form.'] validate_max=True validates against max_num strictly even if max_num was exceeded because the amount of initial data supplied was\nexcessive. The error message can be customized by passing the 'too_many_forms' message\nto the error_messages argument. Note Regardless of validate_max , if the number of forms in a data set\nexceeds absolute_max , then the form will fail to validate as if validate_max were set, and additionally only the first absolute_max forms will be validated. The remainder will be truncated entirely. This is\nto protect against memory exhaustion attacks using forged POST requests.\nSee Limiting the maximum number of instantiated forms . validate_min ¶ If validate_min=True is passed to formset_factory() , validation will also check\nthat the number of forms in the data set, minus those marked for\ndeletion, is greater than or equal to min_num . >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> ArticleFormSet = formset_factory ( ArticleForm , min_num = 3 , validate_min = True ) >>> data = { ... \"form-TOTAL_FORMS\" : \"2\" , ... \"form-INITIAL_FORMS\" : \"0\" , ... \"form-0-title\" : \"Test\" , ... \"form-0-pub_date\" : \"1904-06-16\" , ... \"form-1-title\" : \"Test 2\" , ... \"form-1-pub_date\" : \"1912-06-23\" , ... } >>> formset = ArticleFormSet ( data ) >>> formset . is_valid () False >>> formset . errors [{}, {}] >>> formset . non_form_errors () ['Please submit at least 3 forms.'] The error message can be customized by passing the 'too_few_forms' message\nto the error_messages argument. Note Regardless of validate_min , if a formset contains no data, then extra + min_num empty forms will be displayed. Dealing with ordering and deletion of forms ¶ The formset_factory() provides two optional\nparameters can_order and can_delete to help with ordering of forms in\nformsets and deletion of forms from a formset. can_order ¶ BaseFormSet. can_order ¶ Default: False Lets you create a formset with the ability to order: >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> ArticleFormSet = formset_factory ( ArticleForm , can_order = True ) >>> formset = ArticleFormSet ( ... initial = [ ... { \"title\" : \"Article #1\" , \"pub_date\" : datetime . date ( 2008 , 5 , 10 )}, ... { \"title\" : \"Article #2\" , \"pub_date\" : datetime . date ( 2008 , 5 , 11 )}, ... ] ... ) >>> for form in formset : ... print ( form ) ... <div><label for=\"id_form-0-title\">Title:</label><input type=\"text\" name=\"form-0-title\" value=\"Article #1\" id=\"id_form-0-title\"></div> <div><label for=\"id_form-0-pub_date\">Pub date:</label><input type=\"text\" name=\"form-0-pub_date\" value=\"2008-05-10\" id=\"id_form-0-pub_date\"></div> <div><label for=\"id_form-0-ORDER\">Order:</label><input type=\"number\" name=\"form-0-ORDER\" value=\"1\" id=\"id_form-0-ORDER\"></div> <div><label for=\"id_form-1-title\">Title:</label><input type=\"text\" name=\"form-1-title\" value=\"Article #2\" id=\"id_form-1-title\"></div> <div><label for=\"id_form-1-pub_date\">Pub date:</label><input type=\"text\" name=\"form-1-pub_date\" value=\"2008-05-11\" id=\"id_form-1-pub_date\"></div> <div><label for=\"id_form-1-ORDER\">Order:</label><input type=\"number\" name=\"form-1-ORDER\" value=\"2\" id=\"id_form-1-ORDER\"></div> <div><label for=\"id_form-2-title\">Title:</label><input type=\"text\" name=\"form-2-title\" id=\"id_form-2-title\"></div> <div><label for=\"id_form-2-pub_date\">Pub date:</label><input type=\"text\" name=\"form-2-pub_date\" id=\"id_form-2-pub_date\"></div> <div><label for=\"id_form-2-ORDER\">Order:</label><input type=\"number\" name=\"form-2-ORDER\" id=\"id_form-2-ORDER\"></div> This adds an additional field to each form. This new field is named ORDER and is an forms.IntegerField . For the forms that came from the initial\ndata it automatically assigned them a numeric value. Let’s look at what will\nhappen when the user changes these values: >>> data = { ... \"form-TOTAL_FORMS\" : \"3\" , ... \"form-INITIAL_FORMS\" : \"2\" , ... \"form-0-title\" : \"Article #1\" , ... \"form-0-pub_date\" : \"2008-05-10\" , ... \"form-0-ORDER\" : \"2\" , ... \"form-1-title\" : \"Article #2\" , ... \"form-1-pub_date\" : \"2008-05-11\" , ... \"form-1-ORDER\" : \"1\" , ... \"form-2-title\" : \"Article #3\" , ... \"form-2-pub_date\" : \"2008-05-01\" , ... \"form-2-ORDER\" : \"0\" , ... } >>> formset = ArticleFormSet ( ... data , ... initial = [ ... { \"title\" : \"Article #1\" , \"pub_date\" : datetime . date ( 2008 , 5 , 10 )}, ... { \"title\" : \"Article #2\" , \"pub_date\" : datetime . date ( 2008 , 5 , 11 )}, ... ], ... ) >>> formset . is_valid () True >>> for form in formset . ordered_forms : ... print ( form . cleaned_data ) ... {'pub_date': datetime.date(2008, 5, 1), 'ORDER': 0, 'title': 'Article #3'} {'pub_date': datetime.date(2008, 5, 11), 'ORDER': 1, 'title': 'Article #2'} {'pub_date': datetime.date(2008, 5, 10), 'ORDER': 2, 'title': 'Article #1'} BaseFormSet also provides an ordering_widget attribute and get_ordering_widget() method that\ncontrol the widget used with can_order . ordering_widget ¶ BaseFormSet. ordering_widget ¶ Default: NumberInput Set ordering_widget to specify the widget class to be used with can_order : >>> from django.forms import BaseFormSet , formset_factory >>> from myapp.forms import ArticleForm >>> class BaseArticleFormSet ( BaseFormSet ): ... ordering_widget = HiddenInput ... >>> ArticleFormSet = formset_factory ( ... ArticleForm , formset = BaseArticleFormSet , can_order = True ... ) get_ordering_widget ¶ BaseFormSet. get_ordering_widget () [source] ¶ Override get_ordering_widget() if you need to provide a widget instance for\nuse with can_order : >>> from django.forms import BaseFormSet , formset_factory >>> from myapp.forms import ArticleForm >>> class BaseArticleFormSet ( BaseFormSet ): ... def get_ordering_widget ( self ): ... return HiddenInput ( attrs = { \"class\" : \"ordering\" }) ... >>> ArticleFormSet = formset_factory ( ... ArticleForm , formset = BaseArticleFormSet , can_order = True ... ) can_delete ¶ BaseFormSet. can_delete ¶ Default: False Lets you create a formset with the ability to select forms for deletion: >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> ArticleFormSet = formset_factory ( ArticleForm , can_delete = True ) >>> formset = ArticleFormSet ( ... initial = [ ... { \"title\" : \"Article #1\" , \"pub_date\" : datetime . date ( 2008 , 5 , 10 )}, ... { \"title\" : \"Article #2\" , \"pub_date\" : datetime . date ( 2008 , 5 , 11 )}, ... ] ... ) >>> for form in formset : ... print ( form ) ... <div><label for=\"id_form-0-title\">Title:</label><input type=\"text\" name=\"form-0-title\" value=\"Article #1\" id=\"id_form-0-title\"></div> <div><label for=\"id_form-0-pub_date\">Pub date:</label><input type=\"text\" name=\"form-0-pub_date\" value=\"2008-05-10\" id=\"id_form-0-pub_date\"></div> <div><label for=\"id_form-0-DELETE\">Delete:</label><input type=\"checkbox\" name=\"form-0-DELETE\" id=\"id_form-0-DELETE\"></div> <div><label for=\"id_form-1-title\">Title:</label><input type=\"text\" name=\"form-1-title\" value=\"Article #2\" id=\"id_form-1-title\"></div> <div><label for=\"id_form-1-pub_date\">Pub date:</label><input type=\"text\" name=\"form-1-pub_date\" value=\"2008-05-11\" id=\"id_form-1-pub_date\"></div> <div><label for=\"id_form-1-DELETE\">Delete:</label><input type=\"checkbox\" name=\"form-1-DELETE\" id=\"id_form-1-DELETE\"></div> <div><label for=\"id_form-2-title\">Title:</label><input type=\"text\" name=\"form-2-title\" id=\"id_form-2-title\"></div> <div><label for=\"id_form-2-pub_date\">Pub date:</label><input type=\"text\" name=\"form-2-pub_date\" id=\"id_form-2-pub_date\"></div> <div><label for=\"id_form-2-DELETE\">Delete:</label><input type=\"checkbox\" name=\"form-2-DELETE\" id=\"id_form-2-DELETE\"></div> Similar to can_order this adds a new field to each form named DELETE and is a forms.BooleanField . When data comes through marking any of the\ndelete fields you can access them with deleted_forms : >>> data = { ... \"form-TOTAL_FORMS\" : \"3\" , ... \"form-INITIAL_FORMS\" : \"2\" , ... \"form-0-title\" : \"Article #1\" , ... \"form-0-pub_date\" : \"2008-05-10\" , ... \"form-0-DELETE\" : \"on\" , ... \"form-1-title\" : \"Article #2\" , ... \"form-1-pub_date\" : \"2008-05-11\" , ... \"form-1-DELETE\" : \"\" , ... \"form-2-title\" : \"\" , ... \"form-2-pub_date\" : \"\" , ... \"form-2-DELETE\" : \"\" , ... } >>> formset = ArticleFormSet ( ... data , ... initial = [ ... { \"title\" : \"Article #1\" , \"pub_date\" : datetime . date ( 2008 , 5 , 10 )}, ... { \"title\" : \"Article #2\" , \"pub_date\" : datetime . date ( 2008 , 5 , 11 )}, ... ], ... ) >>> [ form . cleaned_data for form in formset . deleted_forms ] [{'DELETE': True, 'pub_date': datetime.date(2008, 5, 10), 'title': 'Article #1'}] If you are using a ModelFormSet ,\nmodel instances for deleted forms will be deleted when you call formset.save() . If you call formset.save(commit=False) , objects will not be deleted\nautomatically.  You’ll need to call delete() on each of the formset.deleted_objects to actually delete\nthem: >>> instances = formset . save ( commit = False ) >>> for obj in formset . deleted_objects : ... obj . delete () ... On the other hand, if you are using a plain FormSet , it’s up to you to\nhandle formset.deleted_forms , perhaps in your formset’s save() method,\nas there’s no general notion of what it means to delete a form. BaseFormSet also provides a deletion_widget attribute and get_deletion_widget() method that\ncontrol the widget used with can_delete . deletion_widget ¶ BaseFormSet. deletion_widget ¶ Default: CheckboxInput Set deletion_widget to specify the widget class to be used with can_delete : >>> from django.forms import BaseFormSet , formset_factory >>> from myapp.forms import ArticleForm >>> class BaseArticleFormSet ( BaseFormSet ): ... deletion_widget = HiddenInput ... >>> ArticleFormSet = formset_factory ( ... ArticleForm , formset = BaseArticleFormSet , can_delete = True ... ) get_deletion_widget ¶ BaseFormSet. get_deletion_widget () [source] ¶ Override get_deletion_widget() if you need to provide a widget instance for\nuse with can_delete : >>> from django.forms import BaseFormSet , formset_factory >>> from myapp.forms import ArticleForm >>> class BaseArticleFormSet ( BaseFormSet ): ... def get_deletion_widget ( self ): ... return HiddenInput ( attrs = { \"class\" : \"deletion\" }) ... >>> ArticleFormSet = formset_factory ( ... ArticleForm , formset = BaseArticleFormSet , can_delete = True ... ) can_delete_extra ¶ BaseFormSet. can_delete_extra ¶ Default: True While setting can_delete=True , specifying can_delete_extra=False will\nremove the option to delete extra forms. Adding additional fields to a formset ¶ If you need to add additional fields to the formset this can be easily\naccomplished. The formset base class provides an add_fields method. You\ncan override this method to add your own fields or even redefine the default\nfields/attributes of the order and deletion fields: >>> from django.forms import BaseFormSet >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> class BaseArticleFormSet ( BaseFormSet ): ... def add_fields ( self , form , index ): ... super () . add_fields ( form , index ) ... form . fields [ \"my_field\" ] = forms . CharField () ... >>> ArticleFormSet = formset_factory ( ArticleForm , formset = BaseArticleFormSet ) >>> formset = ArticleFormSet () >>> for form in formset : ... print ( form ) ... <div><label for=\"id_form-0-title\">Title:</label><input type=\"text\" name=\"form-0-title\" id=\"id_form-0-title\"></div> <div><label for=\"id_form-0-pub_date\">Pub date:</label><input type=\"text\" name=\"form-0-pub_date\" id=\"id_form-0-pub_date\"></div> <div><label for=\"id_form-0-my_field\">My field:</label><input type=\"text\" name=\"form-0-my_field\" id=\"id_form-0-my_field\"></div> Passing custom parameters to formset forms ¶ Sometimes your form class takes custom parameters, like MyArticleForm .\nYou can pass this parameter when instantiating the formset: >>> from django.forms import BaseFormSet >>> from django.forms import formset_factory >>> from myapp.forms import ArticleForm >>> class MyArticleForm ( ArticleForm ): ... def __init__ ( self , * args , user , ** kwargs ): ... self . user = user ... super () . __init__ ( * args , ** kwargs ) ... >>> ArticleFormSet = formset_factory ( MyArticleForm ) >>> formset = ArticleFormSet ( form_kwargs = { \"user\" : request . user }) The form_kwargs may also depend on the specific form instance. The formset\nbase class provides a get_form_kwargs method. The method takes a single\nargument - the index of the form in the formset. The index is None for the empty_form : >>> from django.forms import BaseFormSet >>> from django.forms import formset_factory >>> class BaseArticleFormSet ( BaseFormSet ): ... def get_form_kwargs ( self , index ): ... kwargs = super () . get_form_kwargs ( index ) ... kwargs [ \"custom_kwarg\" ] = index ... return kwargs ... >>> ArticleFormSet = formset_factory ( MyArticleForm , formset = BaseArticleFormSet ) >>> formset = ArticleFormSet () Customizing a formset’s prefix ¶ In the rendered HTML, formsets include a prefix on each field’s name. By\ndefault, the prefix is 'form' , but it can be customized using the formset’s prefix argument. For example, in the default case, you might see: < label for = \"id_form-0-title\" > Title: </ label > < input type = \"text\" name = \"form-0-title\" id = \"id_form-0-title\" > But with ArticleFormset(prefix='article') that becomes: < label for = \"id_article-0-title\" > Title: </ label > < input type = \"text\" name = \"article-0-title\" id = \"id_article-0-title\" > This is useful if you want to use more than one formset in a view . Using a formset in views and templates ¶ Formsets have the following attributes and methods associated with rendering: BaseFormSet. renderer ¶ Specifies the renderer to use for the\nformset. Defaults to the renderer specified by the FORM_RENDERER setting. BaseFormSet. template_name [source] ¶ The name of the template rendered if the formset is cast into a string,\ne.g. via print(formset) or in a template via {{ formset }} . By default, a property returning the value of the renderer’s formset_template_name . You may\nset it as a string template name in order to override that for a particular\nformset class. This template will be used to render the formset’s management form, and\nthen each form in the formset as per the template defined by the form’s template_name . BaseFormSet. template_name_div ¶ The name of the template used when calling as_div() . By default this\nis \"django/forms/formsets/div.html\" . This template renders the\nformset’s management form and then each form in the formset as per the\nform’s as_div() method. BaseFormSet. template_name_p ¶ The name of the template used when calling as_p() . By default this\nis \"django/forms/formsets/p.html\" . This template renders the formset’s\nmanagement form and then each form in the formset as per the form’s as_p() method. BaseFormSet. template_name_table ¶ The name of the template used when calling as_table() . By default\nthis is \"django/forms/formsets/table.html\" . This template renders the\nformset’s management form and then each form in the formset as per the\nform’s as_table() method. BaseFormSet. template_name_ul ¶ The name of the template used when calling as_ul() . By default this\nis \"django/forms/formsets/ul.html\" . This template renders the formset’s\nmanagement form and then each form in the formset as per the form’s as_ul() method. BaseFormSet. get_context () [source] ¶ Returns the context for rendering a formset in a template. The available context is: formset : The instance of the formset. BaseFormSet. render ( template_name = None , context = None , renderer = None ) ¶ The render method is called by __str__ as well as the as_div() , as_p() , as_ul() , and as_table() methods. All arguments\nare optional and will default to: template_name : template_name context : Value returned by get_context() renderer : Value returned by renderer BaseFormSet. as_div () ¶ Renders the formset with the template_name_div template. BaseFormSet. as_p () ¶ Renders the formset with the template_name_p template. BaseFormSet. as_table () ¶ Renders the formset with the template_name_table template. BaseFormSet. as_ul () ¶ Renders the formset with the template_name_ul template. Using a formset inside a view is not very different from using a regular Form class. The only thing you will want to be aware of is making sure to\nuse the management form inside the template. Let’s look at a sample view: from django.forms import formset_factory from django.shortcuts import render from myapp.forms import ArticleForm def manage_articles ( request ): ArticleFormSet = formset_factory ( ArticleForm ) if request . method == \"POST\" : formset = ArticleFormSet ( request . POST , request . FILES ) if formset . is_valid (): # do something with the formset.cleaned_data pass else : formset = ArticleFormSet () return render ( request , \"manage_articles.html\" , { \"formset\" : formset }) The manage_articles.html template might look like this: < form method = \"post\" > {{ formset.management_form }} < table > {% for form in formset %} {{ form }} {% endfor %} </ table > </ form > However there’s a slight shortcut for the above by letting the formset itself\ndeal with the management form: < form method = \"post\" > < table > {{ formset }} </ table > </ form > The above ends up calling the BaseFormSet.render() method on the formset\nclass. This renders the formset using the template specified by the template_name attribute. Similar to forms, by default the\nformset will be rendered as_div , with other helper methods of as_p , as_ul , and as_table being available. The rendering of the formset can\nbe customized by specifying the template_name attribute, or more generally\nby overriding the default template . Manually rendered can_delete and can_order ¶ If you manually render fields in the template, you can render can_delete parameter with {{ form.DELETE }} : < form method = \"post\" > {{ formset.management_form }} {% for form in formset %} < ul > < li > {{ form.title }} </ li > < li > {{ form.pub_date }} </ li > {% if formset.can_delete %} < li > {{ form.DELETE }} </ li > {% endif %} </ ul > {% endfor %} </ form > Similarly, if the formset has the ability to order ( can_order=True ), it is\npossible to render it with {{ form.ORDER }} . Using more than one formset in a view ¶ You are able to use more than one formset in a view if you like. Formsets\nborrow much of its behavior from forms. With that said you are able to use prefix to prefix formset form field names with a given value to allow\nmore than one formset to be sent to a view without name clashing. Let’s take\na look at how this might be accomplished: from django.forms import formset_factory from django.shortcuts import render from myapp.forms import ArticleForm , BookForm def manage_articles ( request ): ArticleFormSet = formset_factory ( ArticleForm ) BookFormSet = formset_factory ( BookForm ) if request . method == \"POST\" : article_formset = ArticleFormSet ( request . POST , request . FILES , prefix = \"articles\" ) book_formset = BookFormSet ( request . POST , request . FILES , prefix = \"books\" ) if article_formset . is_valid () and book_formset . is_valid (): # do something with the cleaned_data on the formsets. pass else : article_formset = ArticleFormSet ( prefix = \"articles\" ) book_formset = BookFormSet ( prefix = \"books\" ) return render ( request , \"manage_articles.html\" , { \"article_formset\" : article_formset , \"book_formset\" : book_formset , }, ) You would then render the formsets as normal. It is important to point out\nthat you need to pass prefix on both the POST and non-POST cases so that\nit is rendered and processed correctly. Each formset’s prefix replaces the default form prefix that’s added to each field’s name and id HTML attributes.", "keywords": ["can_order", "integerfield", "manage_articles", "formset", "messages", "formsets", "too_few_forms", "type=\"checkbox", "field", "#", "total", "validate_min", "django.forms", "delete\">delete:</label><input", "form.pub_date", "datefield", "total_error_count", "type=\"text", "label", "django.core.exceptions", "=", "errorlist", "message", "get_form_kwargs", "empty_form", "id_form-0", "extra=3", "collection", "name=\"form-2", "max_num_forms", "missing_management_form", "articleform", "type", "error_messages", "ordering_widget", "custom", "usability", "kwargs", "objects", "absolute_max", "template_name_table", "get_ordering_widget", "user", "formset.deleted_objects", "li", "cases", "attribute", "helper", "args", "should_delete_form", "titles", "save", "date", "render", "setting", "print(formset", "grid", "understanding", "as_table", "name", "parameter", "max_num=1", "issue", "min_num", "can_delete_extra", "return", "deletion", "applications", "memory", "articleformset(prefix='article", "id=\"id_form-0", "modelformset", "type=\"number", "examples", "error", "code", "my_field", "false", "behavior", "i", "class", "widget", "returns", "names", "javascript", "'", "notion", "delete\"></div", "request", "output", "input", "formset.non_form_errors", "*", "page", "test", "pub_date\">pub", "count", "hiddeninput", "limit", "form-#-delete", "my_field\"></div", "validation", "name=\"form-0", "cleaned_data", "source", "add_fields", "use", "deleted_objects", "pass", "order", "default", "baseformset", "value=\"2023", "bug", "form", "initial", "get_deletion_widget", "title\"></div", "prefix", "option", "ul.html", "order\"></div", "booleanfield", "convenience", "validationerror", "bookformset", "len", "template", "way", "endfor", "super", "checks", "form.title", "template_name", "index", "remainder", "article_formset", "¶", "maxlength", "exceeds", "post", "parameters", "property", "side", "div.html", "can_delete", "value=\"2", "min_num_forms", "views", "view", "total_form_count", "number", "articleformset", "def", "pub_date\"></div", "values", "value=\"2008", "string", "_", "formset.save(commit", "for=\"id_form-2", "thing", "hand", "id=\"id_form-2", "table", "models", "ways", "level", "articleformset(request", "ordered_forms", "article", "django", "extra=2", "form_kwargs", "n’t", "formset_factory", "fields", "print", "formset.save", "set", "title\">title:</label><input", "override", "practice", "value", "django.shortcuts", "as_ul", "max_num=2", "form_renderer", "data", "browser", "item", "datetime", "base", "layer", "clashing", "myapp.forms", "too_many_forms", "shortcut", "ul", "self", "instance", "pub_date", "today", "my_field\">my", "report", "article-0", "as_div", "instances", "num)d", "couple", "valueerror", "my_formset.management_form", "p.html", "numberinput", "charfield", "protects", "management", "field:</label><input", "dictionary", "requests", "exhaustion", "rendering", "ordering", "attrs", "managementform", "as_p", "rest", "obj", "renders", "get_context", "items", "form-2", "forms", "’s", "deleted_forms", "formset.errors", "addition", "example", "list", "sample", "for=\"id_form-1", "formset_template_name", "baseformset.render", "id_article-0", "manage_articles.html", "model", "id=\"id_form-1", "dictionaries", "attributes", "title", "ability", "value=\"1", "table.html", "track", "checkboxinput", "ones", "keys", "case", "for=\"id_form-0", "bookform", "indexing", "look", "errors", "html", "myarticleform", "str", "submission", "arguments", "init", "one", "entries", "basearticleformset", "delete", "amount", "is_valid", "abstraction", "renderer", "template_name_ul", "none", "formset.deleted_forms", "lets", "specifies", "book_formset", "true", "value=\"django", "nonform", "max_num", "django.forms.formsets", "custom_kwarg", "context", "template_name_p", "files", "import", "d", "deletion_widget", "iteration", "non_form_errors", "value=\"article", ">", "defaults", "%", "methods", "books", "client", "method", "argument", "articles", "initial_form_count", "attacks", "date:</label><input", "formset.management_form", "templates", "text"], "type": "documentation"},
{"title": "PostgreSQL specific query expressions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/expressions/", "content": "PostgreSQL specific query expressions ¶ These expressions are available from the django.contrib.postgres.expressions module. ArraySubquery() expressions ¶ class ArraySubquery ( queryset ) [source] ¶ ArraySubquery is a Subquery that uses the\nPostgreSQL ARRAY constructor to build a list of values from the queryset,\nwhich must use QuerySet.values() to return only a single column. This class differs from ArrayAgg in the way that it does not act as an aggregate function and does not require\nan SQL GROUP BY clause to build the list of values. For example, if you want to annotate all related books to an author as JSON\nobjects: >>> from django.db.models import OuterRef >>> from django.db.models.functions import JSONObject >>> from django.contrib.postgres.expressions import ArraySubquery >>> books = Book . objects . filter ( author = OuterRef ( \"pk\" )) . values ( ... json = JSONObject ( title = \"title\" , pages = \"pages\" ) ... ) >>> author = Author . objects . annotate ( books = ArraySubquery ( books )) . first () >>> author . books [{'title': 'Solaris', 'pages': 204}, {'title': 'The Cyberiad', 'pages': 295}]", "keywords": ["function", "json", "jsonobject", "author", "queryset.values", "import", "django.contrib.postgres.expressions", "django.db.models.functions", "objects", "sql", "module", "way", "=", "title", "values", "solaris", "pages", "filter", "array", "class", "example", "subquery", "clause", "books", "outerref", "book", "group", "column", "queryset", "list", "cyberiad", "arraysubquery", "¶", "constructor", "source", "expressions", "annotate", "query", "postgresql", "arrayagg"], "type": "documentation"},
{"title": "PostgreSQL specific model fields | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/fields/", "content": "PostgreSQL specific model fields ¶ All of these fields are available from the django.contrib.postgres.fields module. Indexing these fields ¶ Index and Field.db_index both create a\nB-tree index, which isn’t particularly helpful when querying complex data types.\nIndexes such as GinIndex and GistIndex are better suited, though\nthe index choice is dependent on the queries that you’re using. Generally, GiST\nmay be a good choice for the range fields and HStoreField , and GIN may be helpful for ArrayField . ArrayField ¶ class ArrayField ( base_field , size = None , ** options ) ¶ A field for storing lists of data. Most field types can be used, and you\npass another field instance as the base_field . You may also specify a size . ArrayField can be nested to store multi-dimensional\narrays. If you give the field a default , ensure\nit’s a callable such as list (for an empty default) or a callable that\nreturns a list (such as a function). Incorrectly using default=[] creates a mutable default that is shared between all instances of ArrayField . base_field ¶ This is a required argument. Specifies the underlying data type and behavior for the array. It\nshould be an instance of a subclass of Field . For example, it could be an IntegerField or a CharField . Most field types are permitted,\nwith the exception of those handling relational data\n( ForeignKey , OneToOneField and ManyToManyField ) and file fields ( FileField and ImageField ). It is possible to nest array fields - you can specify an instance of ArrayField as the base_field . For example: from django.contrib.postgres.fields import ArrayField from django.db import models class ChessBoard ( models . Model ): board = ArrayField ( ArrayField ( models . CharField ( max_length = 10 , blank = True ), size = 8 , ), size = 8 , ) Transformation of values between the database and the model, validation\nof data and configuration, and serialization are all delegated to the\nunderlying base field. size ¶ This is an optional argument. If passed, the array will have a maximum size as specified. This will\nbe passed to the database, although PostgreSQL at present does not\nenforce the restriction. Note When nesting ArrayField , whether you use the size parameter or not,\nPostgreSQL requires that the arrays are rectangular: from django.contrib.postgres.fields import ArrayField from django.db import models class Board ( models . Model ): pieces = ArrayField ( ArrayField ( models . IntegerField ())) # Valid Board ( pieces = [ [ 2 , 3 ], [ 2 , 1 ], ] ) # Not valid Board ( pieces = [ [ 2 , 3 ], [ 2 ], ] ) If irregular shapes are required, then the underlying field should be made\nnullable and the values padded with None . Querying ArrayField ¶ There are a number of custom lookups and transforms for ArrayField .\nWe will use the following example model: from django.contrib.postgres.fields import ArrayField from django.db import models class Post ( models . Model ): name = models . CharField ( max_length = 200 ) tags = ArrayField ( models . CharField ( max_length = 200 ), blank = True ) def __str__ ( self ): return self . name contains ¶ The contains lookup is overridden on ArrayField . The\nreturned objects will be those where the values passed are a subset of the\ndata. It uses the SQL operator @> . For example: >>> Post . objects . create ( name = \"First post\" , tags = [ \"thoughts\" , \"django\" ]) >>> Post . objects . create ( name = \"Second post\" , tags = [ \"thoughts\" ]) >>> Post . objects . create ( name = \"Third post\" , tags = [ \"tutorial\" , \"django\" ]) >>> Post . objects . filter ( tags__contains = [ \"thoughts\" ]) <QuerySet [<Post: First post>, <Post: Second post>]> >>> Post . objects . filter ( tags__contains = [ \"django\" ]) <QuerySet [<Post: First post>, <Post: Third post>]> >>> Post . objects . filter ( tags__contains = [ \"django\" , \"thoughts\" ]) <QuerySet [<Post: First post>]> contained_by ¶ This is the inverse of the contains lookup -\nthe objects returned will be those where the data is a subset of the values\npassed. It uses the SQL operator <@ . For example: >>> Post . objects . create ( name = \"First post\" , tags = [ \"thoughts\" , \"django\" ]) >>> Post . objects . create ( name = \"Second post\" , tags = [ \"thoughts\" ]) >>> Post . objects . create ( name = \"Third post\" , tags = [ \"tutorial\" , \"django\" ]) >>> Post . objects . filter ( tags__contained_by = [ \"thoughts\" , \"django\" ]) <QuerySet [<Post: First post>, <Post: Second post>]> >>> Post . objects . filter ( tags__contained_by = [ \"thoughts\" , \"django\" , \"tutorial\" ]) <QuerySet [<Post: First post>, <Post: Second post>, <Post: Third post>]> overlap ¶ Returns objects where the data shares any results with the values passed. Uses\nthe SQL operator && . For example: >>> Post . objects . create ( name = \"First post\" , tags = [ \"thoughts\" , \"django\" ]) >>> Post . objects . create ( name = \"Second post\" , tags = [ \"thoughts\" , \"tutorial\" ]) >>> Post . objects . create ( name = \"Third post\" , tags = [ \"tutorial\" , \"django\" ]) >>> Post . objects . filter ( tags__overlap = [ \"thoughts\" ]) <QuerySet [<Post: First post>, <Post: Second post>]> >>> Post . objects . filter ( tags__overlap = [ \"thoughts\" , \"tutorial\" ]) <QuerySet [<Post: First post>, <Post: Second post>, <Post: Third post>]> >>> Post . objects . filter ( tags__overlap = Post . objects . values_list ( \"tags\" )) <QuerySet [<Post: First post>, <Post: Second post>, <Post: Third post>]> len ¶ Returns the length of the array. The lookups available afterward are those\navailable for IntegerField . For example: >>> Post . objects . create ( name = \"First post\" , tags = [ \"thoughts\" , \"django\" ]) >>> Post . objects . create ( name = \"Second post\" , tags = [ \"thoughts\" ]) >>> Post . objects . filter ( tags__len = 1 ) <QuerySet [<Post: Second post>]> Index transforms ¶ Index transforms index into the array. Any non-negative integer can be used.\nThere are no errors if it exceeds the size of the\narray. The lookups available after the transform are those from the base_field . For example: >>> Post . objects . create ( name = \"First post\" , tags = [ \"thoughts\" , \"django\" ]) >>> Post . objects . create ( name = \"Second post\" , tags = [ \"thoughts\" ]) >>> Post . objects . filter ( tags__0 = \"thoughts\" ) <QuerySet [<Post: First post>, <Post: Second post>]> >>> Post . objects . filter ( tags__1__iexact = \"Django\" ) <QuerySet [<Post: First post>]> >>> Post . objects . filter ( tags__276 = \"javascript\" ) <QuerySet []> Note PostgreSQL uses 1-based indexing for array fields when writing raw SQL.\nHowever these indexes and those used in slices use 0-based indexing to be consistent with Python. Slice transforms ¶ Slice transforms take a slice of the array. Any two non-negative integers can\nbe used, separated by a single underscore. The lookups available after the\ntransform do not change. For example: >>> Post . objects . create ( name = \"First post\" , tags = [ \"thoughts\" , \"django\" ]) >>> Post . objects . create ( name = \"Second post\" , tags = [ \"thoughts\" ]) >>> Post . objects . create ( name = \"Third post\" , tags = [ \"django\" , \"python\" , \"thoughts\" ]) >>> Post . objects . filter ( tags__0_1 = [ \"thoughts\" ]) <QuerySet [<Post: First post>, <Post: Second post>]> >>> Post . objects . filter ( tags__0_2__contains = [ \"thoughts\" ]) <QuerySet [<Post: First post>, <Post: Second post>]> Note PostgreSQL uses 1-based indexing for array fields when writing raw SQL.\nHowever these slices and those used in indexes use 0-based indexing to be consistent with Python. Multidimensional arrays with indexes and slices PostgreSQL has some rather esoteric behavior when using indexes and slices\non multidimensional arrays. It will always work to use indexes to reach\ndown to the final underlying data, but most other slices behave strangely\nat the database level and cannot be supported in a logical, consistent\nfashion by Django. HStoreField ¶ class HStoreField ( ** options ) ¶ A field for storing key-value pairs. The Python data type used is a dict . Keys must be strings, and values may be either strings or nulls\n( None in Python). To use this field, you’ll need to: Add 'django.contrib.postgres' in your INSTALLED_APPS . Set up the hstore extension in\nPostgreSQL. You’ll see an error like can't adapt type 'dict' if you skip the first\nstep, or type \"hstore\" does not exist if you skip the second. Note On occasions it may be useful to require or restrict the keys which are\nvalid for a given field. This can be done using the KeysValidator . Querying HStoreField ¶ In addition to the ability to query by key, there are a number of custom\nlookups available for HStoreField . We will use the following example model: from django.contrib.postgres.fields import HStoreField from django.db import models class Dog ( models . Model ): name = models . CharField ( max_length = 200 ) data = HStoreField () def __str__ ( self ): return self . name Key lookups ¶ To query based on a given key, you can use that key as the lookup name: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" }) >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" }) >>> Dog . objects . filter ( data__breed = \"collie\" ) <QuerySet [<Dog: Meg>]> You can chain other lookups after key lookups: >>> Dog . objects . filter ( data__breed__contains = \"l\" ) <QuerySet [<Dog: Rufus>, <Dog: Meg>]> or use F() expressions to annotate a key value. For example: >>> from django.db.models import F >>> rufus = Dog . objects . annotate ( breed = F ( \"data__breed\" ))[ 0 ] >>> rufus . breed 'labrador' If the key you wish to query by clashes with the name of another lookup, you\nneed to use the hstorefield.contains lookup instead. Note Key transforms can also be chained with: contains , icontains , endswith , iendswith , iexact , regex , iregex , startswith ,\nand istartswith lookups. Warning Since any string could be a key in a hstore value, any lookup other than\nthose listed below will be interpreted as a key lookup. No errors are\nraised. Be extra careful for typing mistakes, and always check your queries\nwork as you intend. contains ¶ The contains lookup is overridden on HStoreField . The returned objects are\nthose where the given dict of key-value pairs are all contained in the\nfield. It uses the SQL operator @> . For example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" , \"owner\" : \"Bob\" }) >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) >>> Dog . objects . create ( name = \"Fred\" , data = {}) >>> Dog . objects . filter ( data__contains = { \"owner\" : \"Bob\" }) <QuerySet [<Dog: Rufus>, <Dog: Meg>]> >>> Dog . objects . filter ( data__contains = { \"breed\" : \"collie\" }) <QuerySet [<Dog: Meg>]> contained_by ¶ This is the inverse of the contains lookup -\nthe objects returned will be those where the key-value pairs on the object are\na subset of those in the value passed. It uses the SQL operator <@ . For\nexample: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" , \"owner\" : \"Bob\" }) >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) >>> Dog . objects . create ( name = \"Fred\" , data = {}) >>> Dog . objects . filter ( data__contained_by = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) <QuerySet [<Dog: Meg>, <Dog: Fred>]> >>> Dog . objects . filter ( data__contained_by = { \"breed\" : \"collie\" }) <QuerySet [<Dog: Fred>]> has_key ¶ Returns objects where the given key is in the data. Uses the SQL operator ? . For example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" }) >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) >>> Dog . objects . filter ( data__has_key = \"owner\" ) <QuerySet [<Dog: Meg>]> has_any_keys ¶ Returns objects where any of the given keys are in the data. Uses the SQL\noperator ?| . For example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" }) >>> Dog . objects . create ( name = \"Meg\" , data = { \"owner\" : \"Bob\" }) >>> Dog . objects . create ( name = \"Fred\" , data = {}) >>> Dog . objects . filter ( data__has_any_keys = [ \"owner\" , \"breed\" ]) <QuerySet [<Dog: Rufus>, <Dog: Meg>]> has_keys ¶ Returns objects where all of the given keys are in the data. Uses the SQL operator ?& . For example: >>> Dog . objects . create ( name = \"Rufus\" , data = {}) >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) >>> Dog . objects . filter ( data__has_keys = [ \"breed\" , \"owner\" ]) <QuerySet [<Dog: Meg>]> keys ¶ Returns objects where the array of keys is the given value. Note that the order\nis not guaranteed to be reliable, so this transform is mainly useful for using\nin conjunction with lookups on ArrayField . Uses the SQL function akeys() . For example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"toy\" : \"bone\" }) >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) >>> Dog . objects . filter ( data__keys__overlap = [ \"breed\" , \"toy\" ]) <QuerySet [<Dog: Rufus>, <Dog: Meg>]> values ¶ Returns objects where the array of values is the given value. Note that the\norder is not guaranteed to be reliable, so this transform is mainly useful for\nusing in conjunction with lookups on ArrayField . Uses the SQL function avals() . For example: >>> Dog . objects . create ( name = \"Rufus\" , data = { \"breed\" : \"labrador\" }) >>> Dog . objects . create ( name = \"Meg\" , data = { \"breed\" : \"collie\" , \"owner\" : \"Bob\" }) >>> Dog . objects . filter ( data__values__contains = [ \"collie\" ]) <QuerySet [<Dog: Meg>]> Range Fields ¶ There are five range field types, corresponding to the built-in range types in\nPostgreSQL. These fields are used to store a range of values; for example the\nstart and end timestamps of an event, or the range of ages an activity is\nsuitable for. All of the range fields translate to psycopg Range objects in Python, but also accept tuples as input if no bounds\ninformation is necessary. The default is lower bound included, upper bound\nexcluded, that is [) (see the PostgreSQL documentation for details about different bounds ). The default bounds can be changed for non-discrete range\nfields ( DateTimeRangeField and DecimalRangeField ) by using\nthe default_bounds argument. IntegerRangeField ¶ class IntegerRangeField ( ** options ) ¶ Stores a range of integers. Based on an IntegerField . Represented by an int4range in\nthe database and a django.db.backends.postgresql.psycopg_any.NumericRange in Python. Regardless of the bounds specified when saving the data, PostgreSQL always\nreturns a range in a canonical form that includes the lower bound and\nexcludes the upper bound, that is [) . BigIntegerRangeField ¶ class BigIntegerRangeField ( ** options ) ¶ Stores a range of large integers. Based on a BigIntegerField . Represented by an int8range in the database and a django.db.backends.postgresql.psycopg_any.NumericRange in Python. Regardless of the bounds specified when saving the data, PostgreSQL always\nreturns a range in a canonical form that includes the lower bound and\nexcludes the upper bound, that is [) . DecimalRangeField ¶ class DecimalRangeField ( default_bounds = '[)' , ** options ) ¶ Stores a range of floating point values. Based on a DecimalField . Represented by a numrange in\nthe database and a django.db.backends.postgresql.psycopg_any.NumericRange in Python. default_bounds ¶ Optional. The value of bounds for list and tuple inputs. The\ndefault is lower bound included, upper bound excluded, that is [) (see the PostgreSQL documentation for details about different bounds ). default_bounds is not used for django.db.backends.postgresql.psycopg_any.NumericRange inputs. DateTimeRangeField ¶ class DateTimeRangeField ( default_bounds = '[)' , ** options ) ¶ Stores a range of timestamps. Based on a DateTimeField . Represented by a tstzrange in\nthe database and a django.db.backends.postgresql.psycopg_any.DateTimeTZRange in Python. default_bounds ¶ Optional. The value of bounds for list and tuple inputs. The\ndefault is lower bound included, upper bound excluded, that is [) (see the PostgreSQL documentation for details about different bounds ). default_bounds is not used for django.db.backends.postgresql.psycopg_any.DateTimeTZRange inputs. DateRangeField ¶ class DateRangeField ( ** options ) ¶ Stores a range of dates. Based on a DateField . Represented by a daterange in the\ndatabase and a django.db.backends.postgresql.psycopg_any.DateRange in\nPython. Regardless of the bounds specified when saving the data, PostgreSQL always\nreturns a range in a canonical form that includes the lower bound and\nexcludes the upper bound, that is [) . Querying Range Fields ¶ There are a number of custom lookups and transforms for range fields. They are\navailable on all the above fields, but we will use the following example\nmodel: from django.contrib.postgres.fields import IntegerRangeField from django.db import models class Event ( models . Model ): name = models . CharField ( max_length = 200 ) ages = IntegerRangeField () start = models . DateTimeField () def __str__ ( self ): return self . name We will also use the following example objects: >>> import datetime >>> from django.utils import timezone >>> now = timezone . now () >>> Event . objects . create ( name = \"Soft play\" , ages = ( 0 , 10 ), start = now ) >>> Event . objects . create ( ... name = \"Pub trip\" , ages = ( 21 , None ), start = now - datetime . timedelta ( days = 1 ) ... ) and NumericRange : >>> from django.db.backends.postgresql.psycopg_any import NumericRange Containment functions ¶ As with other PostgreSQL fields, there are three standard containment\noperators: contains , contained_by and overlap , using the SQL\noperators @> , <@ , and && respectively. contains ¶ >>> Event . objects . filter ( ages__contains = NumericRange ( 4 , 5 )) <QuerySet [<Event: Soft play>]> contained_by ¶ >>> Event . objects . filter ( ages__contained_by = NumericRange ( 0 , 15 )) <QuerySet [<Event: Soft play>]> The contained_by lookup is also available on the non-range field types: SmallAutoField , AutoField , BigAutoField , SmallIntegerField , IntegerField , BigIntegerField , DecimalField , FloatField , DateField , and DateTimeField . For example: >>> from django.db.backends.postgresql.psycopg_any import DateTimeTZRange >>> Event . objects . filter ( ... start__contained_by = DateTimeTZRange ( ... timezone . now () - datetime . timedelta ( hours = 1 ), ... timezone . now () + datetime . timedelta ( hours = 1 ), ... ), ... ) <QuerySet [<Event: Soft play>]> overlap ¶ >>> Event . objects . filter ( ages__overlap = NumericRange ( 8 , 12 )) <QuerySet [<Event: Soft play>]> Comparison functions ¶ Range fields support the standard lookups: lt , gt , lte and gte . These are not particularly helpful - they\ncompare the lower bounds first and then the upper bounds only if necessary.\nThis is also the strategy used to order by a range field. It is better to use\nthe specific range comparison operators. fully_lt ¶ The returned ranges are strictly less than the passed range. In other words,\nall the points in the returned range are less than all those in the passed\nrange. >>> Event . objects . filter ( ages__fully_lt = NumericRange ( 11 , 15 )) <QuerySet [<Event: Soft play>]> fully_gt ¶ The returned ranges are strictly greater than the passed range. In other words,\nthe all the points in the returned range are greater than all those in the\npassed range. >>> Event . objects . filter ( ages__fully_gt = NumericRange ( 11 , 15 )) <QuerySet [<Event: Pub trip>]> not_lt ¶ The returned ranges do not contain any points less than the passed range, that\nis the lower bound of the returned range is at least the lower bound of the\npassed range. >>> Event . objects . filter ( ages__not_lt = NumericRange ( 0 , 15 )) <QuerySet [<Event: Soft play>, <Event: Pub trip>]> not_gt ¶ The returned ranges do not contain any points greater than the passed range, that\nis the upper bound of the returned range is at most the upper bound of the\npassed range. >>> Event . objects . filter ( ages__not_gt = NumericRange ( 3 , 10 )) <QuerySet [<Event: Soft play>]> adjacent_to ¶ The returned ranges share a bound with the passed range. >>> Event . objects . filter ( ages__adjacent_to = NumericRange ( 10 , 21 )) <QuerySet [<Event: Soft play>, <Event: Pub trip>]> Querying using the bounds ¶ Range fields support several extra lookups. startswith ¶ Returned objects have the given lower bound. Can be chained to valid lookups\nfor the base field. >>> Event . objects . filter ( ages__startswith = 21 ) <QuerySet [<Event: Pub trip>]> endswith ¶ Returned objects have the given upper bound. Can be chained to valid lookups\nfor the base field. >>> Event . objects . filter ( ages__endswith = 10 ) <QuerySet [<Event: Soft play>]> isempty ¶ Returned objects are empty ranges. Can be chained to valid lookups for a BooleanField . >>> Event . objects . filter ( ages__isempty = True ) <QuerySet []> lower_inc ¶ Returns objects that have inclusive or exclusive lower bounds, depending on the\nboolean value passed. Can be chained to valid lookups for a BooleanField . >>> Event . objects . filter ( ages__lower_inc = True ) <QuerySet [<Event: Soft play>, <Event: Pub trip>]> lower_inf ¶ Returns objects that have unbounded (infinite) or bounded lower bound,\ndepending on the boolean value passed. Can be chained to valid lookups for a BooleanField . >>> Event . objects . filter ( ages__lower_inf = True ) <QuerySet []> upper_inc ¶ Returns objects that have inclusive or exclusive upper bounds, depending on the\nboolean value passed. Can be chained to valid lookups for a BooleanField . >>> Event . objects . filter ( ages__upper_inc = True ) <QuerySet []> upper_inf ¶ Returns objects that have unbounded (infinite) or bounded upper bound,\ndepending on the boolean value passed. Can be chained to valid lookups for a BooleanField . >>> Event . objects . filter ( ages__upper_inf = True ) <QuerySet [<Event: Pub trip>]> Defining your own range types ¶ PostgreSQL allows the definition of custom range types. Django’s model and form\nfield implementations use base classes below, and psycopg provides a register_range() to allow use of custom\nrange types. class RangeField ( ** options ) ¶ Base class for model range fields. base_field ¶ The model field class to use. range_type ¶ The range type to use. form_field ¶ The form field class to use. Should be a subclass of django.contrib.postgres.forms.BaseRangeField . class django.contrib.postgres.forms. BaseRangeField ¶ Base class for form range fields. base_field ¶ The form field to use. range_type ¶ The range type to use. Range operators ¶ class RangeOperators ¶ PostgreSQL provides a set of SQL operators that can be used together with the\nrange data types (see the PostgreSQL documentation for the full details of\nrange operators ). This class is meant as a\nconvenient method to avoid typos. The operator names overlap with the names of\ncorresponding lookups. class RangeOperators : EQUAL = \"=\" NOT_EQUAL = \"<>\" CONTAINS = \"@>\" CONTAINED_BY = \"<@\" OVERLAPS = \"&&\" FULLY_LT = \"<<\" FULLY_GT = \">>\" NOT_LT = \"&>\" NOT_GT = \"&<\" ADJACENT_TO = \"-|-\" RangeBoundary() expressions ¶ class RangeBoundary ( inclusive_lower = True , inclusive_upper = False ) ¶ inclusive_lower ¶ If True (default), the lower bound is inclusive '[' , otherwise\nit’s exclusive '(' . inclusive_upper ¶ If False (default), the upper bound is exclusive ')' , otherwise\nit’s inclusive ']' . A RangeBoundary() expression represents the range boundaries. It can be\nused with a custom range functions that expected boundaries, for example to\ndefine ExclusionConstraint . See the PostgreSQL documentation for the full details .", "keywords": ["function", "has_key", "django.db.backends.postgresql.psycopg_any", "ages__startswith", "arrayfield", "second", "ages__lower_inc", "bigintegerfield", "implementations", "imagefield", "data__breed__contains", "integerfield", "ages__upper_inc", "indexes", "base_field", "bob", "number", "equal", "definition", "tree", "relational", "autofield", "error", "module", "b", "fashion", "occasions", "point", "values", "ages__fully_gt", "activity", "psycopg", "decimalfield", "not_lt", "not_equal", "filter", "keysvalidator", "behavior", "array", "addition", "class", "lists", "field", "example", "#", "string", "datetimerangefield", "decimalrangefield", "serialization", "data__contains", "list", "pieces", "pub", "form_field", "returns", "names", "javascript", "l", "stores", "event", "lte", "database", "regex", "first", "hstorefield.contains", "input", "range", "transforms", "*", "models", "query", "dates", "subset", "postgresql", "upper_inc", "not_gt", "datefield", "inverse", "types", "contained_by", "level", "strings", "data__has_keys", "floatfield", "model", "hstore", "words", "tstzrange", "subclass", "daterange", "ages__adjacent_to", "typos", "avals", "tags__overlap", "data__keys__overlap", "owner", "rangeoperators", "bounds", "bound", "django", "configuration", "=", "tags__0_2__contains", "overlap", "ability", "step", "ages__upper_inf", "max_length", "gt", "results", "fields", "shapes", "register_range", "gist", "set", "validation", "data__has_any_keys", "tags__276", "inputs", "datetimetzrange", "chessboard", "restriction", "value", "icontains", "int8range", "django.contrib.postgres.forms", "ranges", "keys", "startswith", "boundaries", "exclusionconstraint", "data", "length", "lookup", "underscore", "conjunction", "default_bounds", "datetime", "ages__contains", "iexact", "use", "indexing", "choice", "base", "data__breed", "errors", "iendswith", "ginindex", "querying", "ages__overlap", "lower_inf", "tuple", "clashes", "tags__len", "str", "fully_gt", "start__contained_by", "lt", "type", "@", "filefield", "thoughts", "self", "instance", "custom", "tags__contains", "objects", "documentation", "play", "lookups", "smallautofield", "file", "gin", "comparison", "tags__0_1", "tuples", "extension", "work", "collie", "order", "slices", "default", "tags__0", "strategy", "iregex", "mistakes", "functions", "key", "containment", "upper_inf", "returned", "arrays", "start", "form", "timedelta", "none", "fred", "breed", "classes", "expression", "size", "specifies", "infinite", "transformation", "endswith", "tags", "data__contained_by", "ages__contained_by", "data__values__contains", "integerrangefield", "adjacent_to", "instances", "true", "annotate", "contains", "tags__contained_by", "dict", "operators", "gistindex", "timezone", "booleanfield", "hstorefield", "installed_apps", "f", "third", "transform", "object", "toy", "baserangefield", "ages", "django.utils", "dog", "data__has_key", "len", "valid", "soft", "import", "name", "charfield", "timestamps", "manytomanyfield", "parameter", "rangefield", "ages__fully_lt", ">", "sql", "onetoonefield", "points", "foreignkey", "django.contrib.postgres", "gte", "information", "trip", "python", "ages__endswith", "pairs", "bigautofield", "bone", "board", "options", "queries", "optional", "index", "daterangefield", "exception", "rangeboundary", "slice", "bigintegerrangefield", "details", "fully_lt", "method", "queryset", "int4range", "integer", "has_any_keys", "smallintegerfield", "argument", "days", "¶", "hours", "field.db_index", "operator", "django.contrib.postgres.fields", "post", "note", "numericrange", "akeys", "expressions", "numrange", "integers", "rufus", "labrador", "meg", "nulls", "datetimefield", "values_list"], "type": "documentation"},
{"title": "PostgreSQL specific aggregation functions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/aggregates/", "content": "PostgreSQL specific aggregation functions ¶ These functions are available from the django.contrib.postgres.aggregates module. They are described in more detail in the PostgreSQL docs . Note All functions come without default aliases, so you must explicitly provide\none. For example: >>> SomeModel . objects . aggregate ( arr = ArrayAgg ( \"somefield\" )) {'arr': [0, 1, 2]} Common aggregate options All aggregates have the filter keyword argument\nand most also have the default keyword argument. General-purpose aggregation functions ¶ ArrayAgg ¶ class ArrayAgg ( expression , distinct = False , filter = None , default = None , ordering = () , ** extra ) ¶ Returns a list of values, including nulls, concatenated into an array, or default if there are no values. distinct ¶ An optional boolean argument that determines if array values\nwill be distinct. Defaults to False . ordering ¶ An optional string of a field name (with an optional \"-\" prefix\nwhich indicates descending order) or an expression (or a tuple or list\nof strings and/or expressions) that specifies the ordering of the\nelements in the result list. Examples: \"some_field\" \"-some_field\" from django.db.models import F F ( \"some_field\" ) . desc () Changed in Django 5.0: In older versions, if there are no rows and default is not\nprovided, ArrayAgg returned an empty list instead of None . If\nyou need it, explicitly set default to Value([]) . BitAnd ¶ class BitAnd ( expression , filter = None , default = None , ** extra ) ¶ Returns an int of the bitwise AND of all non-null input values, or default if all values are null. BitOr ¶ class BitOr ( expression , filter = None , default = None , ** extra ) ¶ Returns an int of the bitwise OR of all non-null input values, or default if all values are null. BitXor ¶ class BitXor ( expression , filter = None , default = None , ** extra ) ¶ Returns an int of the bitwise XOR of all non-null input values, or default if all values are null. It requires PostgreSQL 14+. BoolAnd ¶ class BoolAnd ( expression , filter = None , default = None , ** extra ) ¶ Returns True , if all input values are true, default if all values\nare null or if there are no values, otherwise False . Usage example: class Comment ( models . Model ): body = models . TextField () published = models . BooleanField () rank = models . IntegerField () >>> from django.db.models import Q >>> from django.contrib.postgres.aggregates import BoolAnd >>> Comment . objects . aggregate ( booland = BoolAnd ( \"published\" )) {'booland': False} >>> Comment . objects . aggregate ( booland = BoolAnd ( Q ( rank__lt = 100 ))) {'booland': True} BoolOr ¶ class BoolOr ( expression , filter = None , default = None , ** extra ) ¶ Returns True if at least one input value is true, default if all\nvalues are null or if there are no values, otherwise False . Usage example: class Comment ( models . Model ): body = models . TextField () published = models . BooleanField () rank = models . IntegerField () >>> from django.db.models import Q >>> from django.contrib.postgres.aggregates import BoolOr >>> Comment . objects . aggregate ( boolor = BoolOr ( \"published\" )) {'boolor': True} >>> Comment . objects . aggregate ( boolor = BoolOr ( Q ( rank__gt = 2 ))) {'boolor': False} JSONBAgg ¶ class JSONBAgg ( expressions , distinct = False , filter = None , default = None , ordering = () , ** extra ) ¶ Returns the input values as a JSON array, or default if there are\nno values. You can query the result using key and index lookups . distinct ¶ An optional boolean argument that determines if array values will be\ndistinct. Defaults to False . ordering ¶ An optional string of a field name (with an optional \"-\" prefix\nwhich indicates descending order) or an expression (or a tuple or list\nof strings and/or expressions) that specifies the ordering of the\nelements in the result list. Examples are the same as for ArrayAgg.ordering . Usage example: class Room ( models . Model ): number = models . IntegerField ( unique = True ) class HotelReservation ( models . Model ): room = models . ForeignKey ( \"Room\" , on_delete = models . CASCADE ) start = models . DateTimeField () end = models . DateTimeField () requirements = models . JSONField ( blank = True , null = True ) >>> from django.contrib.postgres.aggregates import JSONBAgg >>> Room . objects . annotate ( ... requirements = JSONBAgg ( ... \"hotelreservation__requirements\" , ... ordering = \"-hotelreservation__start\" , ... ) ... ) . filter ( requirements__0__sea_view = True ) . values ( \"number\" , \"requirements\" ) <QuerySet [{'number': 102, 'requirements': [ {'parking': False, 'sea_view': True, 'double_bed': False}, {'parking': True, 'double_bed': True} ]}]> Changed in Django 5.0: In older versions, if there are no rows and default is not\nprovided, JSONBAgg returned an empty list instead of None . If\nyou need it, explicitly set default to Value([]) . StringAgg ¶ class StringAgg ( expression , delimiter , distinct = False , filter = None , default = None , ordering = () ) ¶ Returns the input values concatenated into a string, separated by\nthe delimiter string, or default if there are no values. delimiter ¶ Required argument. Needs to be a string. distinct ¶ An optional boolean argument that determines if concatenated values\nwill be distinct. Defaults to False . ordering ¶ An optional string of a field name (with an optional \"-\" prefix\nwhich indicates descending order) or an expression (or a tuple or list\nof strings and/or expressions) that specifies the ordering of the\nelements in the result string. Examples are the same as for ArrayAgg.ordering . Usage example: class Publication ( models . Model ): title = models . CharField ( max_length = 30 ) class Article ( models . Model ): headline = models . CharField ( max_length = 100 ) publications = models . ManyToManyField ( Publication ) >>> article = Article . objects . create ( headline = \"NASA uses Python\" ) >>> article . publications . create ( title = \"The Python Journal\" ) <Publication: Publication object (1)> >>> article . publications . create ( title = \"Science News\" ) <Publication: Publication object (2)> >>> from django.contrib.postgres.aggregates import StringAgg >>> Article . objects . annotate ( ... publication_names = StringAgg ( ... \"publications__title\" , ... delimiter = \", \" , ... ordering = \"publications__title\" , ... ) ... ) . values ( \"headline\" , \"publication_names\" ) <QuerySet [{ 'headline': 'NASA uses Python', 'publication_names': 'Science News, The Python Journal' }]> Changed in Django 5.0: In older versions, if there are no rows and default is not\nprovided, StringAgg returned an empty string instead of None .\nIf you need it, explicitly set default to Value(\"\") . Aggregate functions for statistics ¶ y and x ¶ The arguments y and x for all these functions can be the name of a\nfield or an expression returning a numeric data. Both are required. Corr ¶ class Corr ( y , x , filter = None , default = None ) ¶ Returns the correlation coefficient as a float , or default if there\naren’t any matching rows. CovarPop ¶ class CovarPop ( y , x , sample = False , filter = None , default = None ) ¶ Returns the population covariance as a float , or default if there\naren’t any matching rows. sample ¶ Optional. By default CovarPop returns the general population\ncovariance. However, if sample=True , the return value will be the\nsample population covariance. RegrAvgX ¶ class RegrAvgX ( y , x , filter = None , default = None ) ¶ Returns the average of the independent variable ( sum(x)/N ) as a float , or default if there aren’t any matching rows. RegrAvgY ¶ class RegrAvgY ( y , x , filter = None , default = None ) ¶ Returns the average of the dependent variable ( sum(y)/N ) as a float , or default if there aren’t any matching rows. RegrCount ¶ class RegrCount ( y , x , filter = None ) ¶ Returns an int of the number of input rows in which both expressions\nare not null. Note The default argument is not supported. RegrIntercept ¶ class RegrIntercept ( y , x , filter = None , default = None ) ¶ Returns the y-intercept of the least-squares-fit linear equation determined\nby the (x, y) pairs as a float , or default if there aren’t any\nmatching rows. RegrR2 ¶ class RegrR2 ( y , x , filter = None , default = None ) ¶ Returns the square of the correlation coefficient as a float , or default if there aren’t any matching rows. RegrSlope ¶ class RegrSlope ( y , x , filter = None , default = None ) ¶ Returns the slope of the least-squares-fit linear equation determined\nby the (x, y) pairs as a float , or default if there aren’t any\nmatching rows. RegrSXX ¶ class RegrSXX ( y , x , filter = None , default = None ) ¶ Returns sum(x^2) - sum(x)^2/N (“sum of squares” of the independent\nvariable) as a float , or default if there aren’t any matching rows. RegrSXY ¶ class RegrSXY ( y , x , filter = None , default = None ) ¶ Returns sum(x*y) - sum(x) * sum(y)/N (“sum of products” of independent\ntimes dependent variable) as a float , or default if there aren’t\nany matching rows. RegrSYY ¶ class RegrSYY ( y , x , filter = None , default = None ) ¶ Returns sum(y^2) - sum(y)^2/N (“sum of squares” of the dependent\nvariable) as a float , or default if there aren’t any matching rows. Usage examples ¶ We will use this example table: | FIELD1 | FIELD2 | FIELD3 |\n|--------|--------|--------|\n|    foo |      1 |     13 |\n|    bar |      2 | (null) |\n|   test |      3 |     13 | Here’s some examples of some of the general-purpose aggregation functions: >>> TestModel . objects . aggregate ( result = StringAgg ( \"field1\" , delimiter = \";\" )) {'result': 'foo;bar;test'} >>> TestModel . objects . aggregate ( result = ArrayAgg ( \"field2\" )) {'result': [1, 2, 3]} >>> TestModel . objects . aggregate ( result = ArrayAgg ( \"field1\" )) {'result': ['foo', 'bar', 'test']} The next example shows the usage of statistical aggregate functions. The\nunderlying math will be not described (you can read about this, for example, at wikipedia ): >>> TestModel . objects . aggregate ( count = RegrCount ( y = \"field3\" , x = \"field2\" )) {'count': 2} >>> TestModel . objects . aggregate ( ... avgx = RegrAvgX ( y = \"field3\" , x = \"field2\" ), avgy = RegrAvgY ( y = \"field3\" , x = \"field2\" ) ... ) {'avgx': 2, 'avgy': 13}", "keywords": ["math", "requirements__0__sea_view", "jsonbagg", "examples", "result", "rows", "float", "publications__title", "integerfield", "sea_view", "population", "aliases", "number", "jsonfield", "module", "publication", "covariance", "avgx", "values", "somemodel", "boolor", "filter", "false", "string", "rank", "array", "class", "example", "field", "aggregate", "bitxor", "requirements", "list", "sample", "some_field", "returns", "desc", "x", "wikipedia", "sum(y)^2", "sum(y^2", "input", "table", "*", "models", "test", "postgresql", "django.contrib.postgres.aggregates", "count", "json", "strings", "elements", "regrsxy", "model", "variable", "double_bed", "article", "sum(x)/n", "usage", "squares", "regravgx", "django", "=", "title", "science", "n’t", "max_length", "y", "correlation", "n", "somefield", "field3", "regrr2", "value", "sum(x)^2", "journal", "data", "regrslope", "slope", "null", "equation", "rank__lt", "room", "arrayagg", "corr", "tuple", "bitor", "coefficient", "sum", "arguments", "delimiter", "publication_names", "objects", "end", "lookups", "xor", "aggregation", "parking", "statistics", "matching", "order", "default", "bar", "|", "|--------|--------|--------|", "booland", "functions", "regravgy", "sum(x", "bitwise", "comment", "start", "prefix", "none", "docs", "products", "expression", "hotelreservation", "publications", "-some_field", "average", "foo;bar;test", "q", "annotate", "covarpop", "bitand", "booleanfield", "nasa", "f", "regrcount", "arr", "object", "intercept", "sum(y)/n", "regrintercept", "stringagg", "import", "name", "charfield", "manytomanyfield", "aggregates", "defaults", "foreignkey", "distinct", "python", "keyword", "versions", "options", "optional", "times", "ordering", "index", "purpose", "square", "regrsyy", "queryset", "field1", "argument", "¶", "return", "news", "field2", "body", "detail", "expressions", "foo", "int", "headline", "regrsxx", "textfield", "testmodel", "sum(x^2", "nulls", "datetimefield"], "type": "documentation"},
{"title": "GEOS API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/geos/", "content": "GEOS API ¶ Background ¶ What is GEOS? ¶ GEOS stands for Geometry Engine - Open Source ,\nand is a C++ library, ported from the Java Topology Suite .  GEOS\nimplements the OpenGIS Simple Features for SQL spatial predicate functions\nand spatial operators. GEOS, now an OSGeo project, was initially developed and\nmaintained by Refractions Research of Victoria, Canada. Features ¶ GeoDjango implements a high-level Python wrapper for the GEOS library, its\nfeatures include: A BSD-licensed interface to the GEOS geometry routines, implemented purely\nin Python using ctypes . Loosely-coupled to GeoDjango.  For example, GEOSGeometry objects\nmay be used outside of a Django project/application.  In other words,\nno need to have DJANGO_SETTINGS_MODULE set or use a database, etc. Mutability: GEOSGeometry objects may be modified. Cross-platform tested. Tutorial ¶ This section contains a brief introduction and tutorial to using GEOSGeometry objects. Creating a Geometry ¶ GEOSGeometry objects may be created in a few ways.  The first is\nto simply instantiate the object on some spatial input – the following\nare examples of creating the same geometry from WKT, HEX, WKB, and GeoJSON: >>> from django.contrib.gis.geos import GEOSGeometry >>> pnt = GEOSGeometry ( \"POINT(5 23)\" ) # WKT >>> pnt = GEOSGeometry ( \"010100000000000000000014400000000000003740\" ) # HEX >>> pnt = GEOSGeometry ( ... memoryview ( ... b \" \\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x14 @ \\x00\\x00\\x00\\x00\\x00\\x00 7@\" ... ) ... ) # WKB >>> pnt = GEOSGeometry ( ... '{ \"type\": \"Point\", \"coordinates\": [ 5.000000, 23.000000 ] }' ... ) # GeoJSON Another option is to use the constructor for the specific geometry type\nthat you wish to create.  For example, a Point object may be\ncreated by passing in the X and Y coordinates into its constructor: >>> from django.contrib.gis.geos import Point >>> pnt = Point ( 5 , 23 ) All these constructors take the keyword argument srid . For example: >>> from django.contrib.gis.geos import GEOSGeometry , LineString , Point >>> print ( GEOSGeometry ( \"POINT (0 0)\" , srid = 4326 )) SRID=4326;POINT (0 0) >>> print ( LineString (( 0 , 0 ), ( 1 , 1 ), srid = 4326 )) SRID=4326;LINESTRING (0 0, 1 1) >>> print ( Point ( 0 , 0 , srid = 32140 )) SRID=32140;POINT (0 0) Finally, there is the fromfile() factory method which returns a GEOSGeometry object from a file: >>> from django.contrib.gis.geos import fromfile >>> pnt = fromfile ( \"/path/to/pnt.wkt\" ) >>> pnt = fromfile ( open ( \"/path/to/pnt.wkt\" )) My logs are filled with GEOS-related errors You find many TypeError or AttributeError exceptions filling your\nweb server’s log files. This generally means that you are creating GEOS\nobjects at the top level of some of your Python modules. Then, due to a race\ncondition in the garbage collector, your module is garbage collected before\nthe GEOS object. To prevent this, create GEOSGeometry objects\ninside the local scope of your functions/methods. Geometries are Pythonic ¶ GEOSGeometry objects are ‘Pythonic’, in other words components may\nbe accessed, modified, and iterated over using standard Python conventions.\nFor example, you can iterate over the coordinates in a Point : >>> pnt = Point ( 5 , 23 ) >>> [ coord for coord in pnt ] [5.0, 23.0] With any geometry object, the GEOSGeometry.coords property\nmay be used to get the geometry coordinates as a Python tuple: >>> pnt . coords (5.0, 23.0) You can get/set geometry components using standard Python indexing\ntechniques.  However, what is returned depends on the geometry type\nof the object.  For example, indexing on a LineString returns a coordinate tuple: >>> from django.contrib.gis.geos import LineString >>> line = LineString (( 0 , 0 ), ( 0 , 50 ), ( 50 , 50 ), ( 50 , 0 ), ( 0 , 0 )) >>> line [ 0 ] (0.0, 0.0) >>> line [ - 2 ] (50.0, 0.0) Whereas indexing on a Polygon will return the ring\n(a LinearRing object) corresponding to the index: >>> from django.contrib.gis.geos import Polygon >>> poly = Polygon ((( 0.0 , 0.0 ), ( 0.0 , 50.0 ), ( 50.0 , 50.0 ), ( 50.0 , 0.0 ), ( 0.0 , 0.0 ))) >>> poly [ 0 ] <LinearRing object at 0x1044395b0> >>> poly [ 0 ][ - 2 ] # second-to-last coordinate of external ring (50.0, 0.0) In addition, coordinates/components of the geometry may added or modified,\njust like a Python list: >>> line [ 0 ] = ( 1.0 , 1.0 ) >>> line . pop () (0.0, 0.0) >>> line . append (( 1.0 , 1.0 )) >>> line . coords ((1.0, 1.0), (0.0, 50.0), (50.0, 50.0), (50.0, 0.0), (1.0, 1.0)) Geometries support set-like operators: >>> from django.contrib.gis.geos import LineString >>> ls1 = LineString (( 0 , 0 ), ( 2 , 2 )) >>> ls2 = LineString (( 1 , 1 ), ( 3 , 3 )) >>> print ( ls1 | ls2 ) # equivalent to `ls1.union(ls2)` MULTILINESTRING ((0 0, 1 1), (1 1, 2 2), (2 2, 3 3)) >>> print ( ls1 & ls2 ) # equivalent to `ls1.intersection(ls2)` LINESTRING (1 1, 2 2) >>> print ( ls1 - ls2 ) # equivalent to `ls1.difference(ls2)` LINESTRING(0 0, 1 1) >>> print ( ls1 ^ ls2 ) # equivalent to `ls1.sym_difference(ls2)` MULTILINESTRING ((0 0, 1 1), (2 2, 3 3)) Equality operator doesn’t check spatial equality The GEOSGeometry equality operator uses equals_exact() , not equals() , i.e.\nit requires the compared geometries to have the same coordinates in the\nsame positions with the same SRIDs: >>> from django.contrib.gis.geos import LineString >>> ls1 = LineString (( 0 , 0 ), ( 1 , 1 )) >>> ls2 = LineString (( 1 , 1 ), ( 0 , 0 )) >>> ls3 = LineString (( 1 , 1 ), ( 0 , 0 ), srid = 4326 ) >>> ls1 . equals ( ls2 ) True >>> ls1 == ls2 False >>> ls3 == ls2 # different SRIDs False Geometry Objects ¶ GEOSGeometry ¶ class GEOSGeometry ( geo_input , srid = None ) [source] ¶ Parameters : geo_input – Geometry input value (string or memoryview ) srid ( int ) – spatial reference identifier This is the base class for all GEOS geometry objects.  It initializes on the\ngiven geo_input argument, and then assumes the proper geometry subclass\n(e.g., GEOSGeometry('POINT(1 1)') will create a Point object). The srid parameter, if given, is set as the SRID of the created geometry if geo_input doesn’t have an SRID. If different SRIDs are provided through the geo_input and srid parameters, ValueError is raised: >>> from django.contrib.gis.geos import GEOSGeometry >>> GEOSGeometry ( \"POINT EMPTY\" , srid = 4326 ) . ewkt 'SRID=4326;POINT EMPTY' >>> GEOSGeometry ( \"SRID=4326;POINT EMPTY\" , srid = 4326 ) . ewkt 'SRID=4326;POINT EMPTY' >>> GEOSGeometry ( \"SRID=1;POINT EMPTY\" , srid = 4326 ) Traceback (most recent call last): ... ValueError : Input geometry already has SRID: 1. The following input formats, along with their corresponding Python types,\nare accepted: Format Input Type WKT / EWKT str HEX / HEXEWKB str WKB / EWKB memoryview GeoJSON str For the GeoJSON format, the SRID is set based on the crs member. If crs isn’t provided, the SRID defaults to 4326. classmethod GEOSGeometry. from_gml ( gml_string ) ¶ Constructs a GEOSGeometry from the given GML string. Properties ¶ GEOSGeometry. coords ¶ Returns the coordinates of the geometry as a tuple. GEOSGeometry. dims ¶ Returns the dimension of the geometry: 0 for Point s and MultiPoint s 1 for LineString s and MultiLineString s 2 for Polygon s and MultiPolygon s -1 for empty GeometryCollection s the maximum dimension of its elements for non-empty GeometryCollection s GEOSGeometry. empty ¶ Returns whether or not the set of points in the geometry is empty. GEOSGeometry. geom_type ¶ Returns a string corresponding to the type of geometry.  For example: >>> pnt = GEOSGeometry ( \"POINT(5 23)\" ) >>> pnt . geom_type 'Point' GEOSGeometry. geom_typeid ¶ Returns the GEOS geometry type identification number.  The following table\nshows the value for each geometry type: Geometry ID Point 0 LineString 1 LinearRing 2 Polygon 3 MultiPoint 4 MultiLineString 5 MultiPolygon 6 GeometryCollection 7 GEOSGeometry. num_coords ¶ Returns the number of coordinates in the geometry. GEOSGeometry. num_geom ¶ Returns the number of geometries in this geometry.  In other words, will\nreturn 1 on anything but geometry collections. GEOSGeometry. hasz ¶ Returns a boolean indicating whether the geometry is three-dimensional. GEOSGeometry. ring ¶ Returns a boolean indicating whether the geometry is a LinearRing . GEOSGeometry. simple ¶ Returns a boolean indicating whether the geometry is ‘simple’. A geometry\nis simple if and only if it does not intersect itself (except at boundary\npoints).  For example, a LineString object is not simple if it\nintersects itself. Thus, LinearRing and Polygon objects\nare always simple because they cannot intersect themselves, by definition. GEOSGeometry. valid ¶ Returns a boolean indicating whether the geometry is valid. GEOSGeometry. valid_reason ¶ Returns a string describing the reason why a geometry is invalid. GEOSGeometry. srid ¶ Property that may be used to retrieve or set the SRID associated with the\ngeometry.  For example: >>> pnt = Point ( 5 , 23 ) >>> print ( pnt . srid ) None >>> pnt . srid = 4326 >>> pnt . srid 4326 Output Properties ¶ The properties in this section export the GEOSGeometry object into\na different.  This output may be in the form of a string, buffer, or even\nanother object. GEOSGeometry. ewkt ¶ Returns the “extended” Well-Known Text of the geometry.  This representation\nis specific to PostGIS and is a superset of the OGC WKT standard. [ 1 ] Essentially the SRID is prepended to the WKT representation, for example SRID=4326;POINT(5 23) . Note The output from this property does not include the 3dm, 3dz, and 4d\ninformation that PostGIS supports in its EWKT representations. GEOSGeometry. hex ¶ Returns the WKB of this Geometry in hexadecimal form.  Please note\nthat the SRID value is not included in this representation\nbecause it is not a part of the OGC specification (use the GEOSGeometry.hexewkb property instead). GEOSGeometry. hexewkb ¶ Returns the EWKB of this Geometry in hexadecimal form.  This is an\nextension of the WKB specification that includes the SRID value\nthat are a part of this geometry. GEOSGeometry. json ¶ Returns the GeoJSON representation of the geometry. Note that the result is\nnot a complete GeoJSON structure but only the geometry key content of a\nGeoJSON structure. See also GeoJSON Serializer . GEOSGeometry. geojson ¶ Alias for GEOSGeometry.json . GEOSGeometry. kml ¶ Returns a KML (Keyhole Markup Language) representation of the\ngeometry.  This should only be used for geometries with an SRID of\n4326 (WGS84), but this restriction is not enforced. GEOSGeometry. ogr ¶ Returns an OGRGeometry object\ncorresponding to the GEOS geometry. GEOSGeometry. wkb ¶ Returns the WKB (Well-Known Binary) representation of this Geometry\nas a Python buffer.  SRID value is not included, use the GEOSGeometry.ewkb property instead. GEOSGeometry. ewkb ¶ Return the EWKB representation of this Geometry as a Python buffer.\nThis is an extension of the WKB specification that includes any SRID\nvalue that are a part of this geometry. GEOSGeometry. wkt ¶ Returns the Well-Known Text of the geometry (an OGC standard). Spatial Predicate Methods ¶ All of the following spatial predicate methods take another GEOSGeometry instance ( other ) as a parameter, and\nreturn a boolean. GEOSGeometry. contains ( other ) ¶ Returns True if other.within(this) returns True . GEOSGeometry. covers ( other ) ¶ Returns True if this geometry covers the specified geometry. The covers predicate has the following equivalent definitions: Every point of the other geometry is a point of this geometry. The DE-9IM Intersection Matrix for the two geometries is T*****FF* , *T****FF* , ***T**FF* , or ****T*FF* . If either geometry is empty, returns False . This predicate is similar to GEOSGeometry.contains() , but is more\ninclusive (i.e. returns True for more cases). In particular, unlike contains() it does not distinguish between points in the\nboundary and in the interior of geometries. For most situations, covers() should be preferred to contains() . As an\nadded benefit, covers() is more amenable to optimization and hence\nshould outperform contains() . GEOSGeometry. crosses ( other ) ¶ Returns True if the DE-9IM intersection matrix for the two Geometries\nis T*T****** (for a point and a curve,a point and an area or a line\nand an area) 0******** (for two curves). GEOSGeometry. disjoint ( other ) ¶ Returns True if the DE-9IM intersection matrix for the two geometries\nis FF*FF**** . GEOSGeometry. equals ( other ) ¶ Returns True if the DE-9IM intersection matrix for the two geometries\nis T*F**FFF* . GEOSGeometry. equals_exact ( other , tolerance = 0 ) ¶ Returns true if the two geometries are exactly equal, up to a\nspecified tolerance.  The tolerance value should be a floating\npoint number representing the error tolerance in the comparison, e.g., poly1.equals_exact(poly2, 0.001) will compare equality to within\none thousandth of a unit. GEOSGeometry. equals_identical ( other ) ¶ New in Django 5.0. Returns True if the two geometries are point-wise equivalent by\nchecking that the structure, ordering, and values of all vertices are\nidentical in all dimensions. NaN values are considered to be equal to\nother NaN values. Requires GEOS 3.12. GEOSGeometry. intersects ( other ) ¶ Returns True if GEOSGeometry.disjoint() is False . GEOSGeometry. overlaps ( other ) ¶ Returns true if the DE-9IM intersection matrix for the two geometries\nis T*T***T** (for two points or two surfaces) 1*T***T** (for two curves). GEOSGeometry. relate_pattern ( other , pattern ) ¶ Returns True if the elements in the DE-9IM intersection matrix\nfor this geometry and the other matches the given pattern –\na string of nine characters from the alphabet: { T , F , * , 0 }. GEOSGeometry. touches ( other ) ¶ Returns True if the DE-9IM intersection matrix for the two geometries\nis FT******* , F**T***** or F***T**** . GEOSGeometry. within ( other ) ¶ Returns True if the DE-9IM intersection matrix for the two geometries\nis T*F**F*** . Topological Methods ¶ GEOSGeometry. buffer ( width , quadsegs = 8 ) ¶ Returns a GEOSGeometry that represents all points whose distance\nfrom this geometry is less than or equal to the given width . The\noptional quadsegs keyword sets the number of segments used to\napproximate a quarter circle (defaults is 8). GEOSGeometry. buffer_with_style ( width , quadsegs = 8 , end_cap_style = 1 , join_style = 1 , mitre_limit = 5.0 ) ¶ Same as buffer() , but allows customizing the style of the buffer. end_cap_style can be round ( 1 ), flat ( 2 ), or square ( 3 ). join_style can be round ( 1 ), mitre ( 2 ), or bevel ( 3 ). Mitre ratio limit ( mitre_limit ) only affects mitered join style. GEOSGeometry. difference ( other ) ¶ Returns a GEOSGeometry representing the points making up this\ngeometry that do not make up other. GEOSGeometry. interpolate ( distance ) ¶ GEOSGeometry. interpolate_normalized ( distance ) ¶ Given a distance (float), returns the point (or closest point) within the\ngeometry ( LineString or MultiLineString ) at that distance.\nThe normalized version takes the distance as a float between 0 (origin) and\n1 (endpoint). Reverse of GEOSGeometry.project() . GEOSGeometry. intersection ( other ) ¶ Returns a GEOSGeometry representing the points shared by this\ngeometry and other. GEOSGeometry. project ( point ) ¶ GEOSGeometry. project_normalized ( point ) ¶ Returns the distance (float) from the origin of the geometry\n( LineString or MultiLineString ) to the point projected on\nthe geometry (that is to a point of the line the closest to the given\npoint). The normalized version returns the distance as a float between 0\n(origin) and 1 (endpoint). Reverse of GEOSGeometry.interpolate() . GEOSGeometry. relate ( other ) ¶ Returns the DE-9IM intersection matrix (a string) representing the\ntopological relationship between this geometry and the other. GEOSGeometry. simplify ( tolerance = 0.0 , preserve_topology = False ) ¶ Returns a new GEOSGeometry , simplified to the specified tolerance\nusing the Douglas-Peucker algorithm. A higher tolerance value implies\nfewer points in the output. If no tolerance is provided, it defaults to 0. By default, this function does not preserve topology. For example, Polygon objects can be split, be collapsed into lines, or\ndisappear. Polygon holes can be created or disappear, and lines may\ncross. By specifying preserve_topology=True , the result will have the\nsame dimension and number of components as the input; this is significantly\nslower, however. GEOSGeometry. sym_difference ( other ) ¶ Returns a GEOSGeometry combining the points in this geometry\nnot in other, and the points in other not in this geometry. GEOSGeometry. union ( other ) ¶ Returns a GEOSGeometry representing all the points in this\ngeometry and the other. Topological Properties ¶ GEOSGeometry. boundary ¶ Returns the boundary as a newly allocated Geometry object. GEOSGeometry. centroid ¶ Returns a Point object representing the geometric center of\nthe geometry.  The point is not guaranteed to be on the interior\nof the geometry. GEOSGeometry. convex_hull ¶ Returns the smallest Polygon that contains all the points in\nthe geometry. GEOSGeometry. envelope ¶ Returns a Polygon that represents the bounding envelope of\nthis geometry. Note that it can also return a Point if the input\ngeometry is a point. GEOSGeometry. point_on_surface ¶ Computes and returns a Point guaranteed to be on the interior\nof this geometry. GEOSGeometry. unary_union ¶ Computes the union of all the elements of this geometry. The result obeys the following contract: Unioning a set of LineString s has the effect of fully noding and\ndissolving the linework. Unioning a set of Polygon s will always return a Polygon or MultiPolygon geometry (unlike GEOSGeometry.union() ,\nwhich may return geometries of lower dimension if a topology collapse\noccurs). Other Properties & Methods ¶ GEOSGeometry. area ¶ This property returns the area of the Geometry. GEOSGeometry. extent ¶ This property returns the extent of this geometry as a 4-tuple,\nconsisting of (xmin, ymin, xmax, ymax) . GEOSGeometry. clone () ¶ This method returns a GEOSGeometry that is a clone of the original. GEOSGeometry. distance ( geom ) ¶ Returns the distance between the closest points on this geometry and the\ngiven geom (another GEOSGeometry object). Note GEOS distance calculations are  linear – in other words, GEOS does not\nperform a spherical calculation even if the SRID specifies a geographic\ncoordinate system. GEOSGeometry. length ¶ Returns the length of this geometry (e.g., 0 for a Point ,\nthe length of a LineString , or the circumference of\na Polygon ). GEOSGeometry. prepared ¶ Returns a GEOS PreparedGeometry for the contents of this geometry. PreparedGeometry objects are optimized for the contains, intersects,\ncovers, crosses, disjoint, overlaps, touches and within operations. Refer to\nthe Prepared Geometries documentation for more information. GEOSGeometry. srs ¶ Returns a SpatialReference object\ncorresponding to the SRID of the geometry or None . GEOSGeometry. transform ( ct , clone = False ) ¶ Transforms the geometry according to the given coordinate transformation\nparameter ( ct ), which may be an integer SRID, spatial reference WKT\nstring, a PROJ string, a SpatialReference object, or a CoordTransform object. By\ndefault, the geometry is transformed in-place and nothing is returned.\nHowever if the clone keyword is set, then the geometry is not modified\nand a transformed clone of the geometry is returned instead. Note Raises GEOSException if GDAL is not\navailable or if the geometry’s SRID is None or less than 0. It\ndoesn’t impose any constraints on the geometry’s SRID if called with a CoordTransform object. GEOSGeometry. make_valid () ¶ Returns a valid GEOSGeometry equivalent, trying not to lose any of\nthe input vertices. If the geometry is already valid, it is returned\nuntouched. This is similar to the MakeValid database\nfunction. Requires GEOS 3.8. GEOSGeometry. normalize ( clone = False ) ¶ Converts this geometry to canonical form. If the clone keyword is set,\nthen the geometry is not modified and a normalized clone of the geometry is\nreturned instead: >>> g = MultiPoint ( Point ( 0 , 0 ), Point ( 2 , 2 ), Point ( 1 , 1 )) >>> print ( g ) MULTIPOINT (0 0, 2 2, 1 1) >>> g . normalize () >>> print ( g ) MULTIPOINT (2 2, 1 1, 0 0) Point ¶ class Point ( x = None , y = None , z = None , srid = None ) [source] ¶ Point objects are instantiated using arguments that represent the\ncomponent coordinates of the point or with a single sequence coordinates.\nFor example, the following are equivalent: >>> pnt = Point ( 5 , 23 ) >>> pnt = Point ([ 5 , 23 ]) Empty Point objects may be instantiated by passing no arguments or an\nempty sequence. The following are equivalent: >>> pnt = Point () >>> pnt = Point ([]) LineString ¶ class LineString ( * args , ** kwargs ) [source] ¶ LineString objects are instantiated using arguments that are either a\nsequence of coordinates or Point objects. For example, the\nfollowing are equivalent: >>> ls = LineString (( 0 , 0 ), ( 1 , 1 )) >>> ls = LineString ( Point ( 0 , 0 ), Point ( 1 , 1 )) In addition, LineString objects may also be created by passing in a\nsingle sequence of coordinate or Point objects: >>> ls = LineString ((( 0 , 0 ), ( 1 , 1 ))) >>> ls = LineString ([ Point ( 0 , 0 ), Point ( 1 , 1 )]) Empty LineString objects may be instantiated by passing no arguments\nor an empty sequence. The following are equivalent: >>> ls = LineString () >>> ls = LineString ([]) closed ¶ Returns whether or not this LineString is closed. LinearRing ¶ class LinearRing ( * args , ** kwargs ) [source] ¶ LinearRing objects are constructed in the exact same way as LineString objects, however the coordinates must be closed , in\nother words, the first coordinates must be the same as the last\ncoordinates. For example: >>> ls = LinearRing (( 0 , 0 ), ( 0 , 1 ), ( 1 , 1 ), ( 0 , 0 )) Notice that (0, 0) is the first and last coordinate – if they were not\nequal, an error would be raised. is_counterclockwise [source] ¶ Returns whether this LinearRing is counterclockwise. Polygon ¶ class Polygon ( * args , ** kwargs ) [source] ¶ Polygon objects may be instantiated by passing in parameters that\nrepresent the rings of the polygon.  The parameters must either be LinearRing instances, or a sequence that may be used to construct a LinearRing : >>> ext_coords = (( 0 , 0 ), ( 0 , 1 ), ( 1 , 1 ), ( 1 , 0 ), ( 0 , 0 )) >>> int_coords = (( 0.4 , 0.4 ), ( 0.4 , 0.6 ), ( 0.6 , 0.6 ), ( 0.6 , 0.4 ), ( 0.4 , 0.4 )) >>> poly = Polygon ( ext_coords , int_coords ) >>> poly = Polygon ( LinearRing ( ext_coords ), LinearRing ( int_coords )) classmethod from_bbox ( bbox ) [source] ¶ Returns a polygon object from the given bounding-box, a 4-tuple\ncomprising (xmin, ymin, xmax, ymax) . num_interior_rings [source] ¶ Returns the number of interior rings in this geometry. Comparing Polygons Note that it is possible to compare Polygon objects directly with < or > , but as the comparison is made through Polygon’s LineString , it does not mean much (but is consistent and quick).\nYou can always force the comparison with the area property: >>> if poly_1 . area > poly_2 . area : ... pass ... Geometry Collections ¶ MultiPoint ¶ class MultiPoint ( * args , ** kwargs ) [source] ¶ MultiPoint objects may be instantiated by passing in Point objects as arguments, or a single sequence of Point objects: >>> mp = MultiPoint ( Point ( 0 , 0 ), Point ( 1 , 1 )) >>> mp = MultiPoint (( Point ( 0 , 0 ), Point ( 1 , 1 ))) MultiLineString ¶ class MultiLineString ( * args , ** kwargs ) [source] ¶ MultiLineString objects may be instantiated by passing in LineString objects as arguments, or a single sequence of LineString objects: >>> ls1 = LineString (( 0 , 0 ), ( 1 , 1 )) >>> ls2 = LineString (( 2 , 2 ), ( 3 , 3 )) >>> mls = MultiLineString ( ls1 , ls2 ) >>> mls = MultiLineString ([ ls1 , ls2 ]) merged ¶ Returns a LineString representing the line merge of\nall the components in this MultiLineString . closed ¶ Returns True if and only if all elements are closed. MultiPolygon ¶ class MultiPolygon ( * args , ** kwargs ) [source] ¶ MultiPolygon objects may be instantiated by passing Polygon objects as arguments, or a single sequence of Polygon objects: >>> p1 = Polygon ((( 0 , 0 ), ( 0 , 1 ), ( 1 , 1 ), ( 0 , 0 ))) >>> p2 = Polygon ((( 1 , 1 ), ( 1 , 2 ), ( 2 , 2 ), ( 1 , 1 ))) >>> mp = MultiPolygon ( p1 , p2 ) >>> mp = MultiPolygon ([ p1 , p2 ]) GeometryCollection ¶ class GeometryCollection ( * args , ** kwargs ) [source] ¶ GeometryCollection objects may be instantiated by passing in other GEOSGeometry as arguments, or a single sequence of GEOSGeometry objects: >>> poly = Polygon ((( 0 , 0 ), ( 0 , 1 ), ( 1 , 1 ), ( 0 , 0 ))) >>> gc = GeometryCollection ( Point ( 0 , 0 ), MultiPoint ( Point ( 0 , 0 ), Point ( 1 , 1 )), poly ) >>> gc = GeometryCollection (( Point ( 0 , 0 ), MultiPoint ( Point ( 0 , 0 ), Point ( 1 , 1 )), poly )) Prepared Geometries ¶ In order to obtain a prepared geometry, access the GEOSGeometry.prepared property.  Once you have a PreparedGeometry instance its spatial predicate methods, listed below,\nmay be used with other GEOSGeometry objects.  An operation with a prepared\ngeometry can be orders of magnitude faster – the more complex the geometry\nthat is prepared, the larger the speedup in the operation.  For more information,\nplease consult the GEOS wiki page on prepared geometries . For example: >>> from django.contrib.gis.geos import Point , Polygon >>> poly = Polygon . from_bbox (( 0 , 0 , 5 , 5 )) >>> prep_poly = poly . prepared >>> prep_poly . contains ( Point ( 2.5 , 2.5 )) True PreparedGeometry ¶ class PreparedGeometry ¶ All methods on PreparedGeometry take an other argument, which\nmust be a GEOSGeometry instance. contains ( other ) ¶ contains_properly ( other ) ¶ covers ( other ) ¶ crosses ( other ) ¶ disjoint ( other ) ¶ intersects ( other ) ¶ overlaps ( other ) ¶ touches ( other ) ¶ within ( other ) ¶ Geometry Factories ¶ fromfile ( file_h ) [source] ¶ Parameters : file_h (a Python file object or a string path to the file) – input file that contains spatial data Return type : a GEOSGeometry corresponding to the spatial data in the file Example: >>> from django.contrib.gis.geos import fromfile >>> g = fromfile ( \"/home/bob/geom.wkt\" ) fromstr ( string , srid = None ) [source] ¶ Parameters : string ( str ) – string that contains spatial data srid ( int ) – spatial reference identifier Return type : a GEOSGeometry corresponding to the spatial data in the string fromstr(string, srid) is equivalent to GEOSGeometry(string, srid) . Example: >>> from django.contrib.gis.geos import fromstr >>> pnt = fromstr ( \"POINT(-90.5 29.5)\" , srid = 4326 ) I/O Objects ¶ Reader Objects ¶ The reader I/O classes return a GEOSGeometry instance from the WKB\nand/or WKT input given to their read(geom) method. class WKBReader [source] ¶ Example: >>> from django.contrib.gis.geos import WKBReader >>> wkb_r = WKBReader () >>> wkb_r . read ( \"0101000000000000000000F03F000000000000F03F\" ) <Point object at 0x103a88910> class WKTReader [source] ¶ Example: >>> from django.contrib.gis.geos import WKTReader >>> wkt_r = WKTReader () >>> wkt_r . read ( \"POINT(1 1)\" ) <Point object at 0x103a88b50> Writer Objects ¶ All writer objects have a write(geom) method that returns either the\nWKB or WKT of the given geometry.  In addition, WKBWriter objects\nalso have properties that may be used to change the byte order, and or\ninclude the SRID value (in other words, EWKB). class WKBWriter ( dim = 2 ) [source] ¶ WKBWriter provides the most control over its output.  By default it\nreturns OGC-compliant WKB when its write method is called.  However,\nit has properties that allow for the creation of EWKB, a superset of the\nWKB standard that includes additional information. See the WKBWriter.outdim documentation for more details about the dim argument. write ( geom ) [source] ¶ Returns the WKB of the given geometry as a Python buffer object.\nExample: >>> from django.contrib.gis.geos import Point , WKBWriter >>> pnt = Point ( 1 , 1 ) >>> wkb_w = WKBWriter () >>> wkb_w . write ( pnt ) <read-only buffer for 0x103a898f0, size -1, offset 0 at 0x103a89930> write_hex ( geom ) [source] ¶ Returns WKB of the geometry in hexadecimal.  Example: >>> from django.contrib.gis.geos import Point , WKBWriter >>> pnt = Point ( 1 , 1 ) >>> wkb_w = WKBWriter () >>> wkb_w . write_hex ( pnt ) '0101000000000000000000F03F000000000000F03F' byteorder ¶ This property may be set to change the byte-order of the geometry\nrepresentation. Byteorder Value Description 0 Big Endian (e.g., compatible with RISC systems) 1 Little Endian (e.g., compatible with x86 systems) Example: >>> from django.contrib.gis.geos import Point , WKBWriter >>> wkb_w = WKBWriter () >>> pnt = Point ( 1 , 1 ) >>> wkb_w . write_hex ( pnt ) '0101000000000000000000F03F000000000000F03F' >>> wkb_w . byteorder = 0 '00000000013FF00000000000003FF0000000000000' outdim [source] ¶ This property may be set to change the output dimension of the geometry\nrepresentation.  In other words, if you have a 3D geometry then set to 3\nso that the Z value is included in the WKB. Outdim Value Description 2 The default, output 2D WKB. 3 Output 3D WKB. Example: >>> from django.contrib.gis.geos import Point , WKBWriter >>> wkb_w = WKBWriter () >>> wkb_w . outdim 2 >>> pnt = Point ( 1 , 1 , 1 ) >>> wkb_w . write_hex ( pnt ) # By default, no Z value included: '0101000000000000000000F03F000000000000F03F' >>> wkb_w . outdim = 3 # Tell writer to include Z values >>> wkb_w . write_hex ( pnt ) '0101000080000000000000F03F000000000000F03F000000000000F03F' srid [source] ¶ Set this property with a boolean to indicate whether the SRID of the\ngeometry should be included with the WKB representation.  Example: >>> from django.contrib.gis.geos import Point , WKBWriter >>> wkb_w = WKBWriter () >>> pnt = Point ( 1 , 1 , srid = 4326 ) >>> wkb_w . write_hex ( pnt ) # By default, no SRID included: '0101000000000000000000F03F000000000000F03F' >>> wkb_w . srid = True # Tell writer to include SRID >>> wkb_w . write_hex ( pnt ) '0101000020E6100000000000000000F03F000000000000F03F' class WKTWriter ( dim = 2 , trim = False , precision = None ) [source] ¶ This class allows outputting the WKT representation of a geometry. See the WKBWriter.outdim , trim , and precision attributes for\ndetails about the constructor arguments. write ( geom ) [source] ¶ Returns the WKT of the given geometry. Example: >>> from django.contrib.gis.geos import Point , WKTWriter >>> pnt = Point ( 1 , 1 ) >>> wkt_w = WKTWriter () >>> wkt_w . write ( pnt ) 'POINT (1.0000000000000000 1.0000000000000000)' outdim [source] ¶ See WKBWriter.outdim . trim [source] ¶ This property is used to enable or disable trimming of\nunnecessary decimals. >>> from django.contrib.gis.geos import Point , WKTWriter >>> pnt = Point ( 1 , 1 ) >>> wkt_w = WKTWriter () >>> wkt_w . trim False >>> wkt_w . write ( pnt ) 'POINT (1.0000000000000000 1.0000000000000000)' >>> wkt_w . trim = True >>> wkt_w . write ( pnt ) 'POINT (1 1)' precision [source] ¶ This property controls the rounding precision of coordinates;\nif set to None rounding is disabled. >>> from django.contrib.gis.geos import Point , WKTWriter >>> pnt = Point ( 1.44 , 1.66 ) >>> wkt_w = WKTWriter () >>> print ( wkt_w . precision ) None >>> wkt_w . write ( pnt ) 'POINT (1.4399999999999999 1.6599999999999999)' >>> wkt_w . precision = 0 >>> wkt_w . write ( pnt ) 'POINT (1 2)' >>> wkt_w . precision = 1 >>> wkt_w . write ( pnt ) 'POINT (1.4 1.7)' Footnotes [ 1 ] See PostGIS EWKB, EWKT and Canonical Forms , PostGIS documentation at Ch. 4.1.2. Settings ¶ GEOS_LIBRARY_PATH ¶ A string specifying the location of the GEOS C library.  Typically,\nthis setting is only used if the GEOS C library is in a non-standard\nlocation (e.g., /home/bob/lib/libgeos_c.so ). Note The setting must be the full path to the C shared library; in\nother words you want to use libgeos_c.so , not libgeos.so . Exceptions ¶ exception GEOSException [source] ¶ The base GEOS exception, indicates a GEOS-related error.", "keywords": ["t**ff", "routines", "box", "gml", "geo_input", "relate_pattern", "pattern", "endpoint", "point(1", "background", "ls1.difference(ls2", "libgeos_c.so", "library", "geosgeometry.coords", "#", "dimensions", "ls1.intersection(ls2", "spatialreference", "ewkt", "linework", "django_settings_module", "srs", "byteorder", "representation", "lines", "identification", "member", "wkb_r", "mutability", "words", "platform", "coordinate", "gc", "suite", "^", "constructors", "geom_type", "=", "xmin", "engine", "ring", "logs", "surfaces", "relationship", "magnitude", "crosses", "proj", "ls2", "exceptions", "pnt", "multipoint", "following", "type", "kwargs", "objects", "optimization", "coord", "documentation", "write", "file", "pnt.wkt", "modules", "cases", "valid_reason", "poly_1", "args", "size", "constraints", "kml", "2d", "fromstr", "setting", "operators", "components", "peucker", "p1", "make_valid", "transform", "pythonic", "rings", "geos_library_path", "contract", "parameter", "curve", "geosexception", "django.contrib.gis.geos", "srid=32140;point", "reference", "preserve_topology", "web", "topology", "centroid", "mitre_limit", "disjoint", "wkbwriter", "fromstr(string", "int_coords", "4.1.2", "ch", "overlaps", "z", "return", "t*f**f", "reverse", "operator", "tutorial", "ls1.sym_difference(ls2", "geosgeometry.disjoint", "fromfile", "srid", "lib", "risc", "examples", "srid=1;point", "binary", "noding", "factories", "wrapper", "join", "error", "geometry", "module", "point(5", "classmethod", "end_cap_style", "algorithm", "postgis", "false", "style", "-1", "i", "class", "c", "prepared", "alphabet", "normalize", "returns", "x", "wkb", "database", "output", "input", "*", "superset", "page", "collector", "types", "elements", "subclass", "wkbreader", "creation", ".", "geosgeometry.json", "file_h", "limit", "3d", "preparedgeometry", "makevalid", "0x103a898f0", "section", "linearring", "append", "source", "representations", "specification", "converts", "ewkb", "component", "sequence", "pop", "research", "geosgeometry('point(1", "ls3", "3dz", "origin", "bbox", "mls", "operation", "order", "default", "markup", "alias", "form", "multipolygon", "sym_difference", "option", "properties", "format", "wkt_w", "classes", "characters", "quarter", "canonical", "equality", "contains", "area", "merge", "f", "supports", "holes", "write(geom", "race", "bsd", "circumference", "join_style", "multilinestring", "equals_exact", "traceback", "ls", "way", "c++", "formats", "topological", "gdal", "intersects", "keyhole", "dimension", "index", "t", "o", "¶", "id", "parameters", "int", "precision", "property", "curves", "f***t", "convex_hull", "content", "thousandth", "polygon", "0101000080000000000000f03f000000000000f03f000000000000f03f", "function", "result", "circle", "float", "open", "xmax", "hasz", "control", "hexewkb", "simple", "ls1.union(ls2", "endian", "extent", "number", "refractions", "collections", "point", "values", "string", "geojson", "unit", "wkt_r", "douglas", "table", "unary_union", "location", "language", "coords", "crs", "tolerance", "version", "ways", "level", "json", "ymax", "speedup", "contents", "wgs84", "bounding", "width", "reader", "condition", "django", "dim", "n’t", "print", "set", "geometrycollection", "geosgeometry.project", "value", "wkt", "line", "counterclockwise", "wktwriter", "data", "00000000013ff00000000000003ff0000000000000", "orders", "scope", "predicate", "wkbwriter.outdim", "base", "ctypes", "envelope", "geom.wkt", "identifier", "writer", "need", "instance", "ext_coords", "affects", "typeerror", "from_bbox", "buffer", "geometries", "extension", "prep_poly", "interface", "ratio", "empty", "trimming", "|", "byte", "geosgeometry.contains", "garbage", "wktreader", "ogc", "7@", "ct", "transformation", "same", "constructor", "spatial", "point_on_surface", "num_interior_rings", "instances", "structure", "part", "object", "calculation", "0101000000000000000000f03f000000000000f03f", "valueerror", "canada", "\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x14", "collapse", "sql", "points", "situations", "keyword", "hexadecimal", "ordering", "nan", "java", "intersection", "effect", "ogrgeometry", "system", "srid=4326;point(5", "read(geom", "interior", "vertices", "8)", "segments", "bob", "definition", "serializer", "covers", "center", "difference", "features", "forms", "poly1.equals_exact(poly2", "geosgeometry.interpolate", "addition", "example", "geosgeometry", "victoria", "mitre", "list", "ymin", "geosgeometry.ewkb", "num_geom", "outdim", "ls1", "osgeo", "positions", "techniques", "place", "systems", "memoryview", "mp", "application", "boundary", "hex", "is_counterclockwise", "y", "geos", "write_hex", "log", "restriction", "coordinates", "benefit", "attributeerror", "boolean", "equivalent", "length", "indexing", "errors", "tuple", "server", "factory", "str", "coordtransform", "conventions", "arguments", "srid=4326;point", "introduction", "p2", "wkb_w", "dm", "1*t***t", "g", "comparison", "standard", "geosgeometry.union", "comprising", "computes", "ft", "path", "functions", "f**t", "operations", "none", "definitions", "0101000020e6100000000000000000f03f000000000000f03f", "geom", "reason", "new", "true", "4d", "api", "description", "linestring", "decimals", "-", "valid", "point(-90.5", "import", "files", "calculations", "union", "defaults", "call", "srids", "polygons", "information", "python", "touches", "methods", "linestring(0", "optional", "num_coords", "bevel", "footnotes", "exception", "details", "geodjango", "method", "matrix", "settings", "argument", "clone", "/path", "distance", "text", "project", "ogr"], "type": "documentation"},
{"title": "Generic date views | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/generic-date-based/", "content": "Generic date views ¶ Date-based generic views, provided in django.views.generic.dates , are\nviews for displaying drilldown pages for date-based data. Note Some of the examples on this page assume that an Article model has been\ndefined as follows in myapp/models.py : from django.db import models from django.urls import reverse class Article ( models . Model ): title = models . CharField ( max_length = 200 ) pub_date = models . DateField () def get_absolute_url ( self ): return reverse ( \"article-detail\" , kwargs = { \"pk\" : self . pk }) ArchiveIndexView ¶ class ArchiveIndexView [source] ¶ A top-level index page showing the “latest” objects, by date. Objects with\na date in the future are not included unless you set allow_future to True . Ancestors (MRO) django.views.generic.list.MultipleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.dates.BaseArchiveIndexView django.views.generic.dates.BaseDateListView django.views.generic.list.MultipleObjectMixin django.views.generic.dates.DateMixin django.views.generic.base.View Context In addition to the context provided by django.views.generic.list.MultipleObjectMixin (via django.views.generic.dates.BaseDateListView ), the template’s\ncontext will be: date_list : A QuerySet object containing all years that have objects available according to queryset , represented as datetime.datetime objects, in\ndescending order. Notes Uses a default context_object_name of latest . Uses a default template_name_suffix of _archive . Defaults to providing date_list by year, but this can be altered to\nmonth or day using the attribute date_list_period . This also applies\nto all subclass views. Example myapp/urls.py : from django.urls import path from django.views.generic.dates import ArchiveIndexView from myapp.models import Article urlpatterns = [ path ( \"archive/\" , ArchiveIndexView . as_view ( model = Article , date_field = \"pub_date\" ), name = \"article_archive\" , ), ] Example myapp/article_archive.html : < ul > {% for article in latest %} < li > {{ article.pub_date }} : {{ article.title }} </ li > {% endfor %} </ ul > This will output all articles. YearArchiveView ¶ class YearArchiveView [source] ¶ A yearly archive page showing all available months in a given year. Objects\nwith a date in the future are not displayed unless you set allow_future to True . Ancestors (MRO) django.views.generic.list.MultipleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.dates.BaseYearArchiveView django.views.generic.dates.YearMixin django.views.generic.dates.BaseDateListView django.views.generic.list.MultipleObjectMixin django.views.generic.dates.DateMixin django.views.generic.base.View make_object_list ¶ A boolean specifying whether to retrieve the full list of objects for\nthis year and pass those to the template. If True , the list of\nobjects will be made available to the context. If False , the None queryset will be used as the object list. By default, this is False . get_make_object_list () ¶ Determine if an object list will be returned as part of the context.\nReturns make_object_list by default. Context In addition to the context provided by django.views.generic.list.MultipleObjectMixin (via django.views.generic.dates.BaseDateListView ), the template’s\ncontext will be: date_list : A QuerySet object containing all months that have objects available according to queryset , represented as datetime.datetime objects, in\nascending order. year : A date object\nrepresenting the given year. next_year : A date object\nrepresenting the first day of the next year, according to allow_empty and allow_future . previous_year : A date object\nrepresenting the first day of the previous year, according to allow_empty and allow_future . Notes Uses a default template_name_suffix of _archive_year . Example myapp/views.py : from django.views.generic.dates import YearArchiveView from myapp.models import Article class ArticleYearArchiveView ( YearArchiveView ): queryset = Article . objects . all () date_field = \"pub_date\" make_object_list = True allow_future = True Example myapp/urls.py : from django.urls import path from myapp.views import ArticleYearArchiveView urlpatterns = [ path ( \"<int:year>/\" , ArticleYearArchiveView . as_view (), name = \"article_year_archive\" ), ] Example myapp/article_archive_year.html : < ul > {% for date in date_list %} < li > {{ date | date }} </ li > {% endfor %} </ ul > < div > < h1 > All Articles for {{ year | date :\"Y\" }} </ h1 > {% for obj in object_list %} < p > {{ obj.title }} - {{ obj.pub_date | date :\"F j, Y\" }} </ p > {% endfor %} </ div > MonthArchiveView ¶ class MonthArchiveView [source] ¶ A monthly archive page showing all objects in a given month. Objects with a\ndate in the future are not displayed unless you set allow_future to True . Ancestors (MRO) django.views.generic.list.MultipleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.dates.BaseMonthArchiveView django.views.generic.dates.YearMixin django.views.generic.dates.MonthMixin django.views.generic.dates.BaseDateListView django.views.generic.list.MultipleObjectMixin django.views.generic.dates.DateMixin django.views.generic.base.View Context In addition to the context provided by MultipleObjectMixin (via BaseDateListView ), the template’s\ncontext will be: date_list : A QuerySet object containing all days that have objects available in the given month,\naccording to queryset , represented as datetime.datetime objects, in ascending order. month : A date object\nrepresenting the given month. next_month : A date object\nrepresenting the first day of the next month, according to allow_empty and allow_future . previous_month : A date object\nrepresenting the first day of the previous month, according to allow_empty and allow_future . Notes Uses a default template_name_suffix of _archive_month . Example myapp/views.py : from django.views.generic.dates import MonthArchiveView from myapp.models import Article class ArticleMonthArchiveView ( MonthArchiveView ): queryset = Article . objects . all () date_field = \"pub_date\" allow_future = True Example myapp/urls.py : from django.urls import path from myapp.views import ArticleMonthArchiveView urlpatterns = [ # Example: /2012/08/ path ( \"<int:year>/<int:month>/\" , ArticleMonthArchiveView . as_view ( month_format = \"%m\" ), name = \"archive_month_numeric\" , ), # Example: /2012/aug/ path ( \"<int:year>/<str:month>/\" , ArticleMonthArchiveView . as_view (), name = \"archive_month\" , ), ] Example myapp/article_archive_month.html : < ul > {% for article in object_list %} < li > {{ article.pub_date | date :\"F j, Y\" }} : {{ article.title }} </ li > {% endfor %} </ ul > < p > {% if previous_month %} Previous Month: {{ previous_month | date :\"F Y\" }} {% endif %} {% if next_month %} Next Month: {{ next_month | date :\"F Y\" }} {% endif %} </ p > WeekArchiveView ¶ class WeekArchiveView [source] ¶ A weekly archive page showing all objects in a given week. Objects with a\ndate in the future are not displayed unless you set allow_future to True . Ancestors (MRO) django.views.generic.list.MultipleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.dates.BaseWeekArchiveView django.views.generic.dates.YearMixin django.views.generic.dates.WeekMixin django.views.generic.dates.BaseDateListView django.views.generic.list.MultipleObjectMixin django.views.generic.dates.DateMixin django.views.generic.base.View Context In addition to the context provided by MultipleObjectMixin (via BaseDateListView ), the template’s\ncontext will be: week : A date object\nrepresenting the first day of the given week. next_week : A date object\nrepresenting the first day of the next week, according to allow_empty and allow_future . previous_week : A date object\nrepresenting the first day of the previous week, according to allow_empty and allow_future . Notes Uses a default template_name_suffix of _archive_week . The week_format attribute is a strptime() format string\nused to parse the week number. The following values are supported: '%U' : Based on the United States week system where the week\nbegins on Sunday. This is the default value. '%W' : Similar to '%U' , except it assumes that the week\nbegins on Monday. This is not the same as the ISO 8601 week number. '%V' : ISO 8601 week number where the week begins on Monday. Example myapp/views.py : from django.views.generic.dates import WeekArchiveView from myapp.models import Article class ArticleWeekArchiveView ( WeekArchiveView ): queryset = Article . objects . all () date_field = \"pub_date\" week_format = \"%W\" allow_future = True Example myapp/urls.py : from django.urls import path from myapp.views import ArticleWeekArchiveView urlpatterns = [ # Example: /2012/week/23/ path ( \"<int:year>/week/<int:week>/\" , ArticleWeekArchiveView . as_view (), name = \"archive_week\" , ), ] Example myapp/article_archive_week.html : < h1 > Week {{ week | date :'W' }} </ h1 > < ul > {% for article in object_list %} < li > {{ article.pub_date | date :\"F j, Y\" }} : {{ article.title }} </ li > {% endfor %} </ ul > < p > {% if previous_week %} Previous Week: {{ previous_week | date :\"W\" }} of year {{ previous_week | date :\"Y\" }} {% endif %} {% if previous_week and next_week %} -- {% endif %} {% if next_week %} Next week: {{ next_week | date :\"W\" }} of year {{ next_week | date :\"Y\" }} {% endif %} </ p > In this example, you are outputting the week number. Keep in mind that week\nnumbers computed by the date template filter with the 'W' format character are not always the same as those computed by strftime() and strptime() with the '%W' format\nstring. For year 2015, for example, week numbers output by date are higher by one compared to those output by strftime() . There\nisn’t an equivalent for the '%U' strftime() format string\nin date . Therefore, you should avoid using date to\ngenerate URLs for WeekArchiveView . DayArchiveView ¶ class DayArchiveView [source] ¶ A day archive page showing all objects in a given day. Days in the future\nthrow a 404 error, regardless of whether any objects exist for future days,\nunless you set allow_future to True . Ancestors (MRO) django.views.generic.list.MultipleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.dates.BaseDayArchiveView django.views.generic.dates.YearMixin django.views.generic.dates.MonthMixin django.views.generic.dates.DayMixin django.views.generic.dates.BaseDateListView django.views.generic.list.MultipleObjectMixin django.views.generic.dates.DateMixin django.views.generic.base.View Context In addition to the context provided by MultipleObjectMixin (via BaseDateListView ), the template’s\ncontext will be: day : A date object\nrepresenting the given day. next_day : A date object\nrepresenting the next day, according to allow_empty and allow_future . previous_day : A date object\nrepresenting the previous day, according to allow_empty and allow_future . next_month : A date object\nrepresenting the first day of the next month, according to allow_empty and allow_future . previous_month : A date object\nrepresenting the first day of the previous month, according to allow_empty and allow_future . Notes Uses a default template_name_suffix of _archive_day . Example myapp/views.py : from django.views.generic.dates import DayArchiveView from myapp.models import Article class ArticleDayArchiveView ( DayArchiveView ): queryset = Article . objects . all () date_field = \"pub_date\" allow_future = True Example myapp/urls.py : from django.urls import path from myapp.views import ArticleDayArchiveView urlpatterns = [ # Example: /2012/nov/10/ path ( \"<int:year>/<str:month>/<int:day>/\" , ArticleDayArchiveView . as_view (), name = \"archive_day\" , ), ] Example myapp/article_archive_day.html : < h1 > {{ day }} </ h1 > < ul > {% for article in object_list %} < li > {{ article.pub_date | date :\"F j, Y\" }} : {{ article.title }} </ li > {% endfor %} </ ul > < p > {% if previous_day %} Previous Day: {{ previous_day }} {% endif %} {% if previous_day and next_day %} -- {% endif %} {% if next_day %} Next Day: {{ next_day }} {% endif %} </ p > TodayArchiveView ¶ class TodayArchiveView [source] ¶ A day archive page showing all objects for today . This is exactly the\nsame as django.views.generic.dates.DayArchiveView , except today’s\ndate is used instead of the year / month / day arguments. Ancestors (MRO) django.views.generic.list.MultipleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.dates.BaseTodayArchiveView django.views.generic.dates.BaseDayArchiveView django.views.generic.dates.YearMixin django.views.generic.dates.MonthMixin django.views.generic.dates.DayMixin django.views.generic.dates.BaseDateListView django.views.generic.list.MultipleObjectMixin django.views.generic.dates.DateMixin django.views.generic.base.View Notes Uses a default template_name_suffix of _archive_today . Example myapp/views.py : from django.views.generic.dates import TodayArchiveView from myapp.models import Article class ArticleTodayArchiveView ( TodayArchiveView ): queryset = Article . objects . all () date_field = \"pub_date\" allow_future = True Example myapp/urls.py : from django.urls import path from myapp.views import ArticleTodayArchiveView urlpatterns = [ path ( \"today/\" , ArticleTodayArchiveView . as_view (), name = \"archive_today\" ), ] Where is the example template for TodayArchiveView ? This view uses by default the same template as the DayArchiveView , which is in the previous example. If you need\na different template, set the template_name attribute to be the\nname of the new template. DateDetailView ¶ class DateDetailView [source] ¶ A page representing an individual object. If the object has a date value in\nthe future, the view will throw a 404 error by default, unless you set allow_future to True . Ancestors (MRO) django.views.generic.detail.SingleObjectTemplateResponseMixin django.views.generic.base.TemplateResponseMixin django.views.generic.dates.BaseDateDetailView django.views.generic.dates.YearMixin django.views.generic.dates.MonthMixin django.views.generic.dates.DayMixin django.views.generic.dates.DateMixin django.views.generic.detail.BaseDetailView django.views.generic.detail.SingleObjectMixin django.views.generic.base.View Context Includes the single object associated with the model specified in\nthe DateDetailView . Notes Uses a default template_name_suffix of _detail . Example myapp/urls.py : from django.urls import path from django.views.generic.dates import DateDetailView urlpatterns = [ path ( \"<int:year>/<str:month>/<int:day>/<int:pk>/\" , DateDetailView . as_view ( model = Article , date_field = \"pub_date\" ), name = \"archive_date_detail\" , ), ] Example myapp/article_detail.html : < h1 > {{ object.title }} </ h1 > Note All of the generic views listed above have matching Base views that\nonly differ in that they do not include the MultipleObjectTemplateResponseMixin (for the archive views) or SingleObjectTemplateResponseMixin (for the DateDetailView ): class BaseArchiveIndexView [source] ¶ class BaseYearArchiveView [source] ¶ class BaseMonthArchiveView [source] ¶ class BaseWeekArchiveView [source] ¶ class BaseDayArchiveView [source] ¶ class BaseTodayArchiveView [source] ¶ class BaseDateDetailView [source] ¶", "keywords": ["views", "examples", "allow_future", "next_month", "view", "next_day", "week>/", "sunday", "archiveindexview", "number", "singleobjectmixin", "object.title", "error", "article_archive", "year>/week/<int", "values", "baseyeararchiveview", "pages", "filter", "string", "addition", "class", "_", "example", "#", "django.views.generic.base", "strptime", "month", "year>/", "week/23/", "list", "archive", "basemontharchiveview", "returns", "article_archive_week.html", "u", "years", "numbers", "template_name_suffix", "weekmixin", "output", "article_year_archive", "mro", "make_object_list", "models", "page", "datefield", "archive_today", "level", "day>/", "archive_date_detail", "model", "basedatelistview", "subclass", "year", "django.urls", "articledayarchiveview", "multipleobjecttemplateresponsemixin", "article", "basearchiveindexview", "datemixin", "get_make_object_list", "/2012/08/", "archive_month", "title", "myapp", "=", "n’t", "div", "max_length", "article_archive_day.html", "get_absolute_url", "year>/<str", "next", "y", "months", "daymixin", "singleobjecttemplateresponsemixin", "p", "montharchiveview", "character", "urlpatterns", "previous_month", "value", "source", "equivalent", "boolean", "data", "h1", "date_list_period", "weekarchiveview", "django.views.generic.detail", "context_object_name", "ancestors", "w", "base", "future", "todayarchiveview", "day>/<int", "arguments", "article_detail.html", "article_archive.html", "ul", "self", "kwargs", "archive_day", "objects", "pub_date", "mind", "basedayarchiveview", "today", "next_week", "datedetailview", "django.views.generic.dates", "views.py", "order", "j", "default", "articleweekarchiveview", "previous_day", "basedatedetailview", "li", "|", "previous_year", "path", "dayarchiveview", "drilldown", "monthmixin", "attribute", "states", "none", "format", "article_archive_year.html", "nov/10/", "day", "baseweekarchiveview", "object_list", "united", "date", "true", "iso", "templateresponsemixin", "obj.pub_date", "urls", "part", "articletodayarchiveview", "myapp.models", "f", "week_format", "object", "month>/", "previous", "context", "import", "name", "charfield", "template", "week", "basetodayarchiveview", "%", "defaults", "month>/<int", "pk", "as_view", "endfor", "multipleobjectmixin", "pk>/", "archive_month_numeric", "monday", "strftime", "template_name", "year>/<int", "index", "articlemontharchiveview", "articleyeararchiveview", "date_list", "django.views.generic.list", "queryset", "django.db", "myapp.views", "v", "notes", "¶", "return", "articles", "obj", "days", "reverse", "determine", "detail", "obj.title", "system", "int", "article.title", "yeararchiveview", "yearmixin"], "type": "documentation"},
{"title": "Geographic Database Functions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/gis/functions/", "content": "Geographic Database Functions ¶ The functions documented on this page allow users to access geographic database\nfunctions to be used in annotations, aggregations, or filters in Django. Example: >>> from django.contrib.gis.db.models.functions import Length >>> Track . objects . annotate ( length = Length ( \"line\" )) . filter ( length__gt = 100 ) Not all backends support all functions, so refer to the documentation of each\nfunction to see if your database backend supports the function you want to use.\nIf you call a geographic function on a backend that doesn’t support it, you’ll\nget a NotImplementedError exception. Function’s summary: Measurement Relationships Operations Editors Input format Output format Miscellaneous Area Azimuth Difference ForcePolygonCW AsGeoJSON IsEmpty Distance BoundingCircle Intersection MakeValid AsGML IsValid GeometryDistance Centroid SymDifference Reverse AsKML MemSize Length ClosestPoint Union Scale AsSVG NumGeometries Perimeter Envelope LineLocatePoint PointOnSurface SnapToGrid Transform Translate FromWKB FromWKT AsWKB AsWKT GeoHash NumPoints Area ¶ class Area ( expression , ** extra ) [source] ¶ Availability : MariaDB, MySQL ,\nOracle, PostGIS , SpatiaLite Accepts a single geographic field or expression and returns the area of the\nfield as an Area measure. MySQL and SpatiaLite without LWGEOM/RTTOPO don’t support area calculations on\ngeographic SRSes. AsGeoJSON ¶ class AsGeoJSON ( expression , bbox = False , crs = False , precision = 8 , ** extra ) [source] ¶ Availability : MariaDB, MySQL ,\nOracle, PostGIS , SpatiaLite Accepts a single geographic field or expression and returns a GeoJSON representation of the geometry. Note that the result\nis not a complete GeoJSON structure but only the geometry key content of a\nGeoJSON structure. See also GeoJSON Serializer . Example: >>> City . objects . annotate ( json = AsGeoJSON ( \"point\" )) . get ( name = \"Chicago\" ) . json {\"type\":\"Point\",\"coordinates\":[-87.65018,41.85039]} Keyword Argument Description bbox Set this to True if you want the bounding box\nto be included in the returned GeoJSON. Ignored on\nOracle. crs Set this to True if you want the coordinate\nreference system to be included in the returned\nGeoJSON. Ignored on MySQL and Oracle. precision It may be used to specify the number of significant\ndigits for the coordinates in the GeoJSON\nrepresentation – the default value is 8. Ignored on\nOracle. AsGML ¶ class AsGML ( expression , version = 2 , precision = 8 , ** extra ) [source] ¶ Availability : Oracle, PostGIS ,\nSpatiaLite Accepts a single geographic field or expression and returns a Geographic Markup\nLanguage (GML) representation of the geometry. Example: >>> qs = Zipcode . objects . annotate ( gml = AsGML ( \"poly\" )) >>> print ( qs [ 0 ] . gml ) <gml:Polygon srsName=\"EPSG:4326\"><gml:OuterBoundaryIs>-147.78711,70.245363 ... -147.78711,70.245363</gml:OuterBoundaryIs></gml:Polygon> Keyword Argument Description precision Specifies the number of significant digits for the\ncoordinates in the GML representation – the default\nvalue is 8. Ignored on Oracle. version Specifies the GML version to use: 2 (default) or 3. AsKML ¶ class AsKML ( expression , precision = 8 , ** extra ) [source] ¶ Availability : PostGIS , SpatiaLite Accepts a single geographic field or expression and returns a Keyhole Markup\nLanguage (KML) representation of the geometry. Example: >>> qs = Zipcode . objects . annotate ( kml = AsKML ( \"poly\" )) >>> print ( qs [ 0 ] . kml ) <Polygon><outerBoundaryIs><LinearRing><coordinates>-103.04135,36.217596,0 ... -103.04135,36.217596,0</coordinates></LinearRing></outerBoundaryIs></Polygon> Keyword Argument Description precision This keyword may be used to specify the number of\nsignificant digits for the coordinates in the KML\nrepresentation – the default value is 8. AsSVG ¶ class AsSVG ( expression , relative = False , precision = 8 , ** extra ) [source] ¶ Availability : PostGIS , SpatiaLite Accepts a single geographic field or expression and returns a Scalable Vector\nGraphics (SVG) representation of the geometry. Keyword Argument Description relative If set to True , the path data will be implemented\nin terms of relative moves. Defaults to False ,\nmeaning that absolute moves are used instead. precision This keyword may be used to specify the number of\nsignificant digits for the coordinates in the SVG\nrepresentation – the default value is 8. AsWKB ¶ class AsWKB ( expression , ** extra ) [source] ¶ Availability : MariaDB, MySQL ,\nOracle, PostGIS , SpatiaLite Accepts a single geographic field or expression and returns a Well-known\nbinary (WKB) representation of the geometry. Example: >>> bytes ( City . objects . annotate ( wkb = AsWKB ( \"point\" )) . get ( name = \"Chelyabinsk\" ) . wkb ) b'\\x01\\x01\\x00\\x00\\x00]3\\xf9f\\x9b\\x91K@\\x00X\\x1d9\\xd2\\xb9N@' AsWKT ¶ class AsWKT ( expression , ** extra ) [source] ¶ Availability : MariaDB, MySQL ,\nOracle, PostGIS , SpatiaLite Accepts a single geographic field or expression and returns a Well-known text\n(WKT) representation of the geometry. Example: >>> City . objects . annotate ( wkt = AsWKT ( \"point\" )) . get ( name = \"Chelyabinsk\" ) . wkt 'POINT (55.137555 61.451728)' Azimuth ¶ class Azimuth ( point_a , point_b , ** extra ) [source] ¶ Availability : PostGIS ,\nSpatiaLite (LWGEOM/RTTOPO) Returns the azimuth in radians of the segment defined by the given point\ngeometries, or None if the two points are coincident. The azimuth is angle\nreferenced from north and is positive clockwise: north = 0 ; east = π/2 ;\nsouth = π ; west = 3π/2 . BoundingCircle ¶ class BoundingCircle ( expression , num_seg = 48 , ** extra ) [source] ¶ Availability : PostGIS , Oracle ,\nSpatiaLite 5.1+ Accepts a single geographic field or expression and returns the smallest circle\npolygon that can fully contain the geometry. The num_seg parameter is used only on PostGIS. Changed in Django 5.1: SpatiaLite 5.1+ support was added. Centroid ¶ class Centroid ( expression , ** extra ) [source] ¶ Availability : MariaDB, MySQL , PostGIS , Oracle, SpatiaLite Accepts a single geographic field or expression and returns the centroid value of the geometry. ClosestPoint ¶ New in Django 5.0. class ClosestPoint ( expr1 , expr2 , ** extra ) [source] ¶ Availability : PostGIS ,\nSpatiaLite Accepts two geographic fields or expressions and returns the 2-dimensional\npoint on geometry A that is closest to geometry B. Difference ¶ class Difference ( expr1 , expr2 , ** extra ) [source] ¶ Availability : MariaDB, MySQL , PostGIS , Oracle, SpatiaLite Accepts two geographic fields or expressions and returns the geometric\ndifference, that is the part of geometry A that does not intersect with\ngeometry B. Distance ¶ class Distance ( expr1 , expr2 , spheroid = None , ** extra ) [source] ¶ Availability : MariaDB, MySQL , PostGIS , Oracle, SpatiaLite Accepts two geographic fields or expressions and returns the distance between\nthem, as a Distance object. On MySQL, a raw\nfloat value is returned when the coordinates are geodetic. On backends that support distance calculation on geodetic coordinates, the\nproper backend function is automatically chosen depending on the SRID value of\nthe geometries (e.g. ST_DistanceSphere on PostGIS). When distances are calculated with geodetic (angular) coordinates, as is the\ncase with the default WGS84 (4326) SRID, you can set the spheroid keyword\nargument to decide if the calculation should be based on a simple sphere (less\naccurate, less resource-intensive) or on a spheroid (more accurate, more\nresource-intensive). In the following example, the distance from the city of Hobart to every other PointField in the AustraliaCity queryset is calculated: >>> from django.contrib.gis.db.models.functions import Distance >>> pnt = AustraliaCity . objects . get ( name = \"Hobart\" ) . point >>> for city in AustraliaCity . objects . annotate ( distance = Distance ( \"point\" , pnt )): ... print ( city . name , city . distance ) ... Wollongong 990071.220408 m Shellharbour 972804.613941 m Thirroul 1002334.36351 m ... Note Because the distance attribute is a Distance object, you can easily express\nthe value in the units of your choice. For example, city.distance.mi is\nthe distance value in miles and city.distance.km is the distance value\nin kilometers. See Measurement Objects for usage details and the list of Supported units . Envelope ¶ class Envelope ( expression , ** extra ) [source] ¶ Availability : MariaDB, MySQL , Oracle , PostGIS , SpatiaLite Accepts a single geographic field or expression and returns the geometry\nrepresenting the bounding box of the geometry. ForcePolygonCW ¶ class ForcePolygonCW ( expression , ** extra ) [source] ¶ Availability : PostGIS ,\nSpatiaLite Accepts a single geographic field or expression and returns a modified version\nof the polygon/multipolygon in which all exterior rings are oriented clockwise\nand all interior rings are oriented counterclockwise. Non-polygonal geometries\nare returned unchanged. FromWKB ¶ class FromWKB ( expression , srid = 0 , ** extra ) [source] ¶ Availability : MariaDB, MySQL ,\nOracle, PostGIS , SpatiaLite Creates geometry from Well-known binary (WKB) representation. The optional srid argument allows to specify the SRID of the resulting geometry. srid is ignored on Oracle. Changed in Django 5.1: The srid argument was added. FromWKT ¶ class FromWKT ( expression , srid = 0 , ** extra ) [source] ¶ Availability : MariaDB, MySQL ,\nOracle, PostGIS , SpatiaLite Creates geometry from Well-known text (WKT) representation. The optional srid argument allows to specify the SRID of the resulting geometry. srid is ignored on Oracle. Changed in Django 5.1: The srid argument was added. GeoHash ¶ class GeoHash ( expression , precision = None , ** extra ) [source] ¶ Availability : MySQL , PostGIS , SpatiaLite\n(LWGEOM/RTTOPO) Accepts a single geographic field or expression and returns a GeoHash representation of the geometry. The precision keyword argument controls the number of characters in the\nresult. GeometryDistance ¶ class GeometryDistance ( expr1 , expr2 , ** extra ) [source] ¶ Availability : PostGIS Accepts two geographic fields or expressions and returns the distance between\nthem. When used in an order_by() clause,\nit provides index-assisted nearest-neighbor result sets. Intersection ¶ class Intersection ( expr1 , expr2 , ** extra ) [source] ¶ Availability : MariaDB, MySQL , PostGIS , Oracle, SpatiaLite Accepts two geographic fields or expressions and returns the geometric\nintersection between them. IsEmpty ¶ class IsEmpty ( expr ) [source] ¶ Availability : PostGIS Accepts a geographic field or expression and tests if the value is an empty\ngeometry. Returns True if its value is empty and False otherwise. IsValid ¶ class IsValid ( expr ) [source] ¶ Availability : MySQL , PostGIS , Oracle, SpatiaLite Accepts a geographic field or expression and tests if the value is well formed.\nReturns True if its value is a valid geometry and False otherwise. Length ¶ class Length ( expression , spheroid = True , ** extra ) [source] ¶ Availability : MariaDB, MySQL ,\nOracle, PostGIS , SpatiaLite Accepts a single geographic linestring or multilinestring field or expression\nand returns its length as a Distance measure. On PostGIS and SpatiaLite, when the coordinates are geodetic (angular), you can\nspecify if the calculation should be based on a simple sphere (less\naccurate, less resource-intensive) or on a spheroid (more accurate, more\nresource-intensive) with the spheroid keyword argument. MySQL doesn’t support length calculations on geographic SRSes. LineLocatePoint ¶ class LineLocatePoint ( linestring , point , ** extra ) [source] ¶ Availability : PostGIS ,\nSpatiaLite Returns a float between 0 and 1 representing the location of the closest point on linestring to the given point , as a fraction of the 2D line length. MakeValid ¶ class MakeValid ( expr ) [source] ¶ Availability : PostGIS ,\nSpatiaLite (LWGEOM/RTTOPO) Accepts a geographic field or expression and attempts to convert the value into\na valid geometry without losing any of the input vertices. Geometries that are\nalready valid are returned without changes. Simple polygons might become a\nmultipolygon and the result might be of lower dimension than the input. MemSize ¶ class MemSize ( expression , ** extra ) [source] ¶ Availability : PostGIS Accepts a single geographic field or expression and returns the memory size\n(number of bytes) that the geometry field takes. NumGeometries ¶ class NumGeometries ( expression , ** extra ) [source] ¶ Availability : MariaDB, MySQL , PostGIS , Oracle,\nSpatiaLite Accepts a single geographic field or expression and returns the number of\ngeometries if the geometry field is a collection (e.g., a GEOMETRYCOLLECTION or MULTI* field). Returns 1 for single geometries. On MySQL, returns None for single geometries. NumPoints ¶ class NumPoints ( expression , ** extra ) [source] ¶ Availability : MariaDB, MySQL , PostGIS , Oracle, SpatiaLite Accepts a single geographic field or expression and returns the number of points\nin a geometry. On MySQL, returns None for any non- LINESTRING geometry. Perimeter ¶ class Perimeter ( expression , ** extra ) [source] ¶ Availability : PostGIS ,\nOracle, SpatiaLite Accepts a single geographic field or expression and returns the perimeter of the\ngeometry field as a Distance object. PointOnSurface ¶ class PointOnSurface ( expression , ** extra ) [source] ¶ Availability : PostGIS ,\nMariaDB, Oracle, SpatiaLite Accepts a single geographic field or expression and returns a Point geometry\nguaranteed to lie on the surface of the field; otherwise returns None . Reverse ¶ class Reverse ( expression , ** extra ) [source] ¶ Availability : PostGIS , Oracle,\nSpatiaLite Accepts a single geographic field or expression and returns a geometry with\nreversed coordinates. Scale ¶ class Scale ( expression , x , y , z = 0.0 , ** extra ) [source] ¶ Availability : PostGIS , SpatiaLite Accepts a single geographic field or expression and returns a geometry with\nscaled coordinates by multiplying them with the x , y , and optionally z parameters. SnapToGrid ¶ class SnapToGrid ( expression , * args , ** extra ) [source] ¶ Availability : PostGIS ,\nSpatiaLite Accepts a single geographic field or expression and returns a geometry with all\npoints snapped to the given grid.  How the geometry is snapped to the grid\ndepends on how many numeric (either float, integer, or long) arguments are\ngiven. Number of Arguments Description 1 A single size to snap both the X and Y grids to. 2 X and Y sizes to snap the grid to. 4 X, Y sizes and the corresponding X, Y origins. SymDifference ¶ class SymDifference ( expr1 , expr2 , ** extra ) [source] ¶ Availability : MariaDB, MySQL , PostGIS , Oracle,\nSpatiaLite Accepts two geographic fields or expressions and returns the geometric\nsymmetric difference (union without the intersection) between the given\nparameters. Transform ¶ class Transform ( expression , srid , ** extra ) [source] ¶ Availability : PostGIS ,\nOracle, SpatiaLite Accepts a geographic field or expression and a SRID integer code, and returns\nthe transformed geometry to the spatial reference system specified by the srid parameter. Note What spatial reference system an integer SRID corresponds to may depend on\nthe spatial database used.  In other words, the SRID numbers used for Oracle\nare not necessarily the same as those used by PostGIS. Translate ¶ class Translate ( expression , x , y , z = 0.0 , ** extra ) [source] ¶ Availability : PostGIS ,\nSpatiaLite Accepts a single geographic field or expression and returns a geometry with\nits coordinates offset by the x , y , and optionally z numeric\nparameters. Union ¶ class Union ( expr1 , expr2 , ** extra ) [source] ¶ Availability : MariaDB, MySQL , PostGIS , Oracle, SpatiaLite Accepts two geographic fields or expressions and returns the union of both\ngeometries.", "keywords": ["function", "aggregations", "users", "translate", "moves", "shellharbour", "kilometers", "result", "box", "circle", "float", "expr", "gml", "num_seg", "expr1", "city.distance.km", "aswkb", "relationships", "number", "closestpoint", "serializer", "measure", "srses", "b'\\x01\\x01\\x00\\x00\\x00]3\\xf9f\\x9b\\x91k@\\x00x\\x1d9\\xd2\\xb9n@", "rttopo", "geometry", "forcepolygoncw", "difference", "point", "graphics", "numgeometries", "chelyabinsk", "numpoints", "srid", "city.distance.mi", "code", "radians", "filter", "postgis", "class", "example", "field", "order_by", "clause", "miles", "city", "m", "australiacity", "geojson", "list", "zipcode", "availability", "returns", "thirroul", "x", "isempty", "text", "asgml", "geometrydistance", "south", "numbers", "fraction", "wkb", "database", "output", "clockwise", "input", "representation", "distances", "location", "language", "*", "page", "crs", "hobart", "version", "snaptogrid", "json", "type\":\"point\",\"coordinates\":[-87.65018,41.85039", "vector", "sphere", "words", "wgs84", "bounding", "coordinate", "π/2", "usage", "outerboundaryis>-147.78711,70.245363", "django", "exterior", "=", "changes", "n’t", "972804.613941", "sizes", "fields", "print", "summary", "isvalid", "set", "y", "editors", "makevalid", "wollongong", "geometrycollection", "track", "svg", "value", "wkt", "line", "spheroid", "sets", "chicago", "grids", "source", "coordinates", "counterclockwise", "case", "corresponds", "length", "data", "segment", "use", "envelope", "choice", "backend", "neighbor", "collection", "pnt", "-147.78711,70.245363</gml", "arguments", "content", "expr2", "scale", "bbox", "a", "objects", "documentation", "scalable", "geohash", "geometries", "point_a", "default", "pointfield", "measurement", "path", "markup", "functions", "operations", "annotations", "attribute", "multipolygon", "none", "args", "filters", "format", "expression", "west", "characters", "st_distancesphere", "tests", "digits", "size", "kml", "-103.04135,36.217596,0</coordinates></linearring></outerboundaryis></polygon", "azimuth", "2d", "new", "true", "annotate", "linelocatepoint", "structure", "srsname=\"epsg:4326\"><gml", "area", "fromwkb", "support", "description", "part", "transform", "object", "rings", "linestring", "calculation", "1002334.36351", "memsize", "units", "grid", "north", "symdifference", "fromwkt", "geographic", "import", "name", "parameter", "calculations", "mysql", "union", "defaults", "b.", "points", "django.contrib.gis.db.models.functions", "polygons", "backends", "reference", "terms", "centroid", "keyword", "keyhole", "origins", "surface", "dimension", "index", "exception", "resource", "polygon", "multi", "details", "aswkt", "queryset", "integer", "argument", "qs", "¶", "bytes", "angle", "z", "reverse", "parameters", "intersection", "memory", "perimeter", "pointonsurface", "oracle", "system", "precision", "east", "lwgeom", "expressions", "distance", "miscellaneous", "vertices", "asgeojson", "spatialite", "boundingcircle", "assvg"], "type": "documentation"},
{"title": "Class-based generic views - flattened index | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/flattened-index/", "content": "Class-based generic views - flattened index ¶ This index provides an alternate organization of the reference documentation\nfor class-based views. For each view, the effective attributes and methods from\nthe class tree are represented under that view. For the reference\ndocumentation organized by the class which defines the behavior, see Class-based views . See also Classy Class-Based Views provides a nice interface\nto navigate the class hierarchy of the built-in class-based views. Simple generic views ¶ View ¶ class View ¶ Attributes (with optional accessor): http_method_names Methods as_view() dispatch() head() http_method_not_allowed() setup() TemplateView ¶ class TemplateView ¶ Attributes (with optional accessor): content_type extra_context http_method_names response_class [ render_to_response() ] template_engine template_name [ get_template_names() ] Methods as_view() dispatch() get() get_context_data() head() http_method_not_allowed() render_to_response() setup() RedirectView ¶ class RedirectView ¶ Attributes (with optional accessor): http_method_names pattern_name permanent query_string url [ get_redirect_url() ] Methods as_view() delete() dispatch() get() head() http_method_not_allowed() options() post() put() setup() Detail Views ¶ DetailView ¶ class DetailView ¶ Attributes (with optional accessor): content_type context_object_name [ get_context_object_name() ] extra_context http_method_names model pk_url_kwarg query_pk_and_slug queryset [ get_queryset() ] response_class [ render_to_response() ] slug_field [ get_slug_field() ] slug_url_kwarg template_engine template_name [ get_template_names() ] template_name_field template_name_suffix Methods as_view() dispatch() get() get_context_data() get_object() head() http_method_not_allowed() render_to_response() setup() List Views ¶ ListView ¶ class ListView ¶ Attributes (with optional accessor): allow_empty [ get_allow_empty() ] content_type context_object_name [ get_context_object_name() ] extra_context http_method_names model ordering [ get_ordering() ] paginate_by [ get_paginate_by() ] paginate_orphans [ get_paginate_orphans() ] paginator_class queryset [ get_queryset() ] response_class [ render_to_response() ] template_engine template_name [ get_template_names() ] template_name_suffix Methods as_view() dispatch() get() get_context_data() get_paginator() head() http_method_not_allowed() paginate_queryset() render_to_response() setup() Editing views ¶ FormView ¶ class FormView ¶ Attributes (with optional accessor): content_type extra_context form_class [ get_form_class() ] http_method_names initial [ get_initial() ] prefix [ get_prefix() ] response_class [ render_to_response() ] success_url [ get_success_url() ] template_engine template_name [ get_template_names() ] Methods as_view() dispatch() form_invalid() form_valid() get() get_context_data() get_form() get_form_kwargs() http_method_not_allowed() post() put() setup() CreateView ¶ class CreateView ¶ Attributes (with optional accessor): content_type context_object_name [ get_context_object_name() ] extra_context fields form_class [ get_form_class() ] http_method_names initial [ get_initial() ] model pk_url_kwarg prefix [ get_prefix() ] query_pk_and_slug queryset [ get_queryset() ] response_class [ render_to_response() ] slug_field [ get_slug_field() ] slug_url_kwarg success_url [ get_success_url() ] template_engine template_name [ get_template_names() ] template_name_field template_name_suffix Methods as_view() dispatch() form_invalid() form_valid() get() get_context_data() get_form() get_form_kwargs() get_object() head() http_method_not_allowed() post() put() render_to_response() setup() UpdateView ¶ class UpdateView ¶ Attributes (with optional accessor): content_type context_object_name [ get_context_object_name() ] extra_context fields form_class [ get_form_class() ] http_method_names initial [ get_initial() ] model pk_url_kwarg prefix [ get_prefix() ] query_pk_and_slug queryset [ get_queryset() ] response_class [ render_to_response() ] slug_field [ get_slug_field() ] slug_url_kwarg success_url [ get_success_url() ] template_engine template_name [ get_template_names() ] template_name_field template_name_suffix Methods as_view() dispatch() form_invalid() form_valid() get() get_context_data() get_form() get_form_kwargs() get_object() head() http_method_not_allowed() post() put() render_to_response() setup() DeleteView ¶ class DeleteView ¶ Attributes (with optional accessor): content_type context_object_name [ get_context_object_name() ] extra_context http_method_names model pk_url_kwarg query_pk_and_slug queryset [ get_queryset() ] response_class [ render_to_response() ] slug_field [ get_slug_field() ] slug_url_kwarg success_url [ get_success_url() ] template_engine template_name [ get_template_names() ] template_name_field template_name_suffix Methods as_view() delete() dispatch() get() get_context_data() get_object() head() http_method_not_allowed() post() render_to_response() setup() Date-based views ¶ ArchiveIndexView ¶ class ArchiveIndexView ¶ Attributes (with optional accessor): allow_empty [ get_allow_empty() ] allow_future [ get_allow_future() ] content_type context_object_name [ get_context_object_name() ] date_field [ get_date_field() ] extra_context http_method_names model ordering [ get_ordering() ] paginate_by [ get_paginate_by() ] paginate_orphans [ get_paginate_orphans() ] paginator_class queryset [ get_queryset() ] response_class [ render_to_response() ] template_engine template_name [ get_template_names() ] template_name_suffix Methods as_view() dispatch() get() get_context_data() get_date_list() get_dated_items() get_dated_queryset() get_paginator() head() http_method_not_allowed() paginate_queryset() render_to_response() setup() YearArchiveView ¶ class YearArchiveView ¶ Attributes (with optional accessor): allow_empty [ get_allow_empty() ] allow_future [ get_allow_future() ] content_type context_object_name [ get_context_object_name() ] date_field [ get_date_field() ] extra_context http_method_names make_object_list [ get_make_object_list() ] model ordering [ get_ordering() ] paginate_by [ get_paginate_by() ] paginate_orphans [ get_paginate_orphans() ] paginator_class queryset [ get_queryset() ] response_class [ render_to_response() ] template_engine template_name [ get_template_names() ] template_name_suffix year [ get_year() ] year_format [ get_year_format() ] Methods as_view() dispatch() get() get_context_data() get_date_list() get_dated_items() get_dated_queryset() get_paginator() head() http_method_not_allowed() paginate_queryset() render_to_response() setup() MonthArchiveView ¶ class MonthArchiveView ¶ Attributes (with optional accessor): allow_empty [ get_allow_empty() ] allow_future [ get_allow_future() ] content_type context_object_name [ get_context_object_name() ] date_field [ get_date_field() ] extra_context http_method_names model month [ get_month() ] month_format [ get_month_format() ] ordering [ get_ordering() ] paginate_by [ get_paginate_by() ] paginate_orphans [ get_paginate_orphans() ] paginator_class queryset [ get_queryset() ] response_class [ render_to_response() ] template_engine template_name [ get_template_names() ] template_name_suffix year [ get_year() ] year_format [ get_year_format() ] Methods as_view() dispatch() get() get_context_data() get_date_list() get_dated_items() get_dated_queryset() get_next_month() get_paginator() get_previous_month() head() http_method_not_allowed() paginate_queryset() render_to_response() setup() WeekArchiveView ¶ class WeekArchiveView ¶ Attributes (with optional accessor): allow_empty [ get_allow_empty() ] allow_future [ get_allow_future() ] content_type context_object_name [ get_context_object_name() ] date_field [ get_date_field() ] extra_context http_method_names model ordering [ get_ordering() ] paginate_by [ get_paginate_by() ] paginate_orphans [ get_paginate_orphans() ] paginator_class queryset [ get_queryset() ] response_class [ render_to_response() ] template_engine template_name [ get_template_names() ] template_name_suffix week [ get_week() ] week_format [ get_week_format() ] year [ get_year() ] year_format [ get_year_format() ] Methods as_view() dispatch() get() get_context_data() get_date_list() get_dated_items() get_dated_queryset() get_paginator() head() http_method_not_allowed() paginate_queryset() render_to_response() setup() DayArchiveView ¶ class DayArchiveView ¶ Attributes (with optional accessor): allow_empty [ get_allow_empty() ] allow_future [ get_allow_future() ] content_type context_object_name [ get_context_object_name() ] date_field [ get_date_field() ] day [ get_day() ] day_format [ get_day_format() ] extra_context http_method_names model month [ get_month() ] month_format [ get_month_format() ] ordering [ get_ordering() ] paginate_by [ get_paginate_by() ] paginate_orphans [ get_paginate_orphans() ] paginator_class queryset [ get_queryset() ] response_class [ render_to_response() ] template_engine template_name [ get_template_names() ] template_name_suffix year [ get_year() ] year_format [ get_year_format() ] Methods as_view() dispatch() get() get_context_data() get_date_list() get_dated_items() get_dated_queryset() get_next_day() get_next_month() get_paginator() get_previous_day() get_previous_month() head() http_method_not_allowed() paginate_queryset() render_to_response() setup() TodayArchiveView ¶ class TodayArchiveView ¶ Attributes (with optional accessor): allow_empty [ get_allow_empty() ] allow_future [ get_allow_future() ] content_type context_object_name [ get_context_object_name() ] date_field [ get_date_field() ] day [ get_day() ] day_format [ get_day_format() ] extra_context http_method_names model month [ get_month() ] month_format [ get_month_format() ] ordering [ get_ordering() ] paginate_by [ get_paginate_by() ] paginate_orphans [ get_paginate_orphans() ] paginator_class queryset [ get_queryset() ] response_class [ render_to_response() ] template_engine template_name [ get_template_names() ] template_name_suffix year [ get_year() ] year_format [ get_year_format() ] Methods as_view() dispatch() get() get_context_data() get_date_list() get_dated_items() get_dated_queryset() get_next_day() get_next_month() get_paginator() get_previous_day() get_previous_month() head() http_method_not_allowed() paginate_queryset() render_to_response() setup() DateDetailView ¶ class DateDetailView ¶ Attributes (with optional accessor): allow_future [ get_allow_future() ] content_type context_object_name [ get_context_object_name() ] date_field [ get_date_field() ] day [ get_day() ] day_format [ get_day_format() ] extra_context http_method_names model month [ get_month() ] month_format [ get_month_format() ] pk_url_kwarg query_pk_and_slug queryset [ get_queryset() ] response_class [ render_to_response() ] slug_field [ get_slug_field() ] slug_url_kwarg template_engine template_name [ get_template_names() ] template_name_field template_name_suffix year [ get_year() ] year_format [ get_year_format() ] Methods as_view() dispatch() get() get_context_data() get_next_day() get_next_month() get_object() get_previous_day() get_previous_month() head() http_method_not_allowed() render_to_response() setup()", "keywords": ["views", "get_queryset", "view", "get_next_month", "get_day", "archiveindexview", "form_valid", "tree", "url", "get_paginate_orphans", "query_pk_and_slug", "get_date_field", "behavior", "class", "response_class", "month", "paginate_by", "list", "classy", "get_ordering", "query_string", "template_name_suffix", "make_object_list", "get_success_url", "template_name_field", "model", "year", "dispatch", "get_form", "accessor", "get_month_format", "organization", "templateview", "get_make_object_list", "attributes", "editing", "redirectview", "pk_url_kwarg", "render_to_response", "head", "get_form_class", "get_form_kwargs", "get_redirect_url", "paginate_queryset", "get_previous_day", "montharchiveview", "setup", "formview", "get_dated_items", "content_type", "get_allow_future", "hierarchy", "get_object", "weekarchiveview", "context_object_name", "paginate_orphans", "get_date_list", "todayarchiveview", "get_prefix", "get_week_format", "get_previous_month", "get_month", "documentation", "datedetailview", "updateview", "get_dated_queryset", "interface", "get_paginate_by", "dayarchiveview", "form_class", "get_day_format", "http_method_names", "get", "day", "template_engine", "date", "deleteview", "get_paginator", "get_slug_field", "week_format", "get_template_names", "listview", "get_week", "success_url", "put", "week", "as_view", "createview", "reference", "methods", "template_name", "get_year_format", "get_context_object_name", "options", "index", "queryset", "get_year", "slug_url_kwarg", "¶", "get_next_day", "post", "day_format", "detail", "get_context_data", "yeararchiveview", "detailview"], "type": "documentation"},
{"title": "Django Exceptions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/exceptions/", "content": "Django Exceptions ¶ Django raises some of its own exceptions as well as standard Python exceptions. Django Core Exceptions ¶ Django core exception classes are defined in django.core.exceptions . AppRegistryNotReady ¶ exception AppRegistryNotReady [source] ¶ This exception is raised when attempting to use models before the app\nloading process , which initializes the ORM, is\ncomplete. ObjectDoesNotExist ¶ exception ObjectDoesNotExist [source] ¶ The base class for Model.DoesNotExist exceptions. A try/except for ObjectDoesNotExist will catch DoesNotExist exceptions for all models. See get() . EmptyResultSet ¶ exception EmptyResultSet [source] ¶ EmptyResultSet may be raised during query generation if a query won’t\nreturn any results. Most Django projects won’t encounter this exception,\nbut it might be useful for implementing custom lookups and expressions. FullResultSet ¶ exception FullResultSet [source] ¶ FullResultSet may be raised during query generation if a query will\nmatch everything. Most Django projects won’t encounter this exception, but\nit might be useful for implementing custom lookups and expressions. FieldDoesNotExist ¶ exception FieldDoesNotExist [source] ¶ The FieldDoesNotExist exception is raised by a model’s _meta.get_field() method when the requested field does not exist on the\nmodel or on the model’s parents. MultipleObjectsReturned ¶ exception MultipleObjectsReturned [source] ¶ The base class for Model.MultipleObjectsReturned exceptions. A try/except for MultipleObjectsReturned will catch MultipleObjectsReturned exceptions for all\nmodels. See get() . SuspiciousOperation ¶ exception SuspiciousOperation [source] ¶ The SuspiciousOperation exception is raised when a user has\nperformed an operation that should be considered suspicious from a security\nperspective, such as tampering with a session cookie. Subclasses of SuspiciousOperation include: DisallowedHost DisallowedModelAdminLookup DisallowedModelAdminToField DisallowedRedirect InvalidSessionKey RequestDataTooBig SuspiciousFileOperation SuspiciousMultipartForm SuspiciousSession TooManyFieldsSent TooManyFilesSent If a SuspiciousOperation exception reaches the ASGI/WSGI handler level\nit is logged at the Error level and results in\na HttpResponseBadRequest . See the logging\ndocumentation for more information. PermissionDenied ¶ exception PermissionDenied [source] ¶ The PermissionDenied exception is raised when a user does not have\npermission to perform the action requested. ViewDoesNotExist ¶ exception ViewDoesNotExist [source] ¶ The ViewDoesNotExist exception is raised by django.urls when a requested view does not exist. MiddlewareNotUsed ¶ exception MiddlewareNotUsed [source] ¶ The MiddlewareNotUsed exception is raised when a middleware is not\nused in the server configuration. ImproperlyConfigured ¶ exception ImproperlyConfigured [source] ¶ The ImproperlyConfigured exception is raised when Django is\nsomehow improperly configured – for example, if a value in settings.py is incorrect or unparseable. FieldError ¶ exception FieldError [source] ¶ The FieldError exception is raised when there is a problem with a\nmodel field. This can happen for several reasons: A field in a model clashes with a field of the same name from an\nabstract base class An infinite loop is caused by ordering A keyword cannot be parsed from the filter parameters A field cannot be determined from a keyword in the query\nparameters A join is not permitted on the specified field A field name is invalid A query contains invalid order_by arguments ValidationError ¶ exception ValidationError [source] ¶ The ValidationError exception is raised when data fails form or\nmodel field validation. For more information about validation, see Form and Field Validation , Model Field Validation and the Validator Reference . NON_FIELD_ERRORS ¶ NON_FIELD_ERRORS ¶ ValidationError s that don’t belong to a particular field in a form\nor model are classified as NON_FIELD_ERRORS . This constant is used\nas a key in dictionaries that otherwise map fields to their respective\nlist of errors. BadRequest ¶ exception BadRequest [source] ¶ The BadRequest exception is raised when the request cannot be\nprocessed due to a client error. If a BadRequest exception reaches the\nASGI/WSGI handler level it results in a HttpResponseBadRequest . RequestAborted ¶ exception RequestAborted [source] ¶ The RequestAborted exception is raised when an HTTP body being read\nin by the handler is cut off midstream and the client connection closes,\nor when the client does not send data and hits a timeout where the server\ncloses the connection. It is internal to the HTTP handler modules and you are unlikely to see\nit elsewhere. If you are modifying HTTP handling code, you should raise\nthis when you encounter an aborted request to make sure the socket is\nclosed cleanly. SynchronousOnlyOperation ¶ exception SynchronousOnlyOperation [source] ¶ The SynchronousOnlyOperation exception is raised when code that\nis only allowed in synchronous Python code is called from an asynchronous\ncontext (a thread with a running asynchronous event loop). These parts of\nDjango are generally heavily reliant on thread-safety to function and don’t\nwork correctly under coroutines sharing the same thread. If you are trying to call code that is synchronous-only from an\nasynchronous thread, then create a synchronous thread and call it in that.\nYou can accomplish this is with asgiref.sync.sync_to_async() . URL Resolver exceptions ¶ URL Resolver exceptions are defined in django.urls . Resolver404 ¶ exception Resolver404 [source] ¶ The Resolver404 exception is raised by resolve() if the path passed to resolve() doesn’t\nmap to a view. It’s a subclass of django.http.Http404 . NoReverseMatch ¶ exception NoReverseMatch [source] ¶ The NoReverseMatch exception is raised by django.urls when a\nmatching URL in your URLconf cannot be identified based on the parameters\nsupplied. Database Exceptions ¶ Database exceptions may be imported from django.db . Django wraps the standard database exceptions so that your Django code has a\nguaranteed common implementation of these classes. exception Error [source] ¶ exception InterfaceError [source] ¶ exception DatabaseError [source] ¶ exception DataError [source] ¶ exception OperationalError [source] ¶ exception IntegrityError [source] ¶ exception InternalError [source] ¶ exception ProgrammingError [source] ¶ exception NotSupportedError [source] ¶ The Django wrappers for database exceptions behave exactly the same as\nthe underlying database exceptions. See PEP 249 , the Python Database API\nSpecification v2.0, for further information. As per PEP 3134 , a __cause__ attribute is set with the original\n(underlying) database exception, allowing access to any additional\ninformation provided. exception models. ProtectedError ¶ Raised to prevent deletion of referenced objects when using django.db.models.PROTECT . models.ProtectedError is a subclass\nof IntegrityError . exception models. RestrictedError ¶ Raised to prevent deletion of referenced objects when using django.db.models.RESTRICT . models.RestrictedError is a subclass\nof IntegrityError . HTTP Exceptions ¶ HTTP exceptions may be imported from django.http . UnreadablePostError ¶ exception UnreadablePostError [source] ¶ UnreadablePostError is raised when a user cancels an upload. Sessions Exceptions ¶ Sessions exceptions are defined in django.contrib.sessions.exceptions . SessionInterrupted ¶ exception SessionInterrupted [source] ¶ SessionInterrupted is raised when a session is destroyed in a\nconcurrent request. It’s a subclass of BadRequest . Transaction Exceptions ¶ Transaction exceptions are defined in django.db.transaction . TransactionManagementError ¶ exception TransactionManagementError [source] ¶ TransactionManagementError is raised for any and all problems\nrelated to database transactions. Testing Framework Exceptions ¶ Exceptions provided by the django.test package. RedirectCycleError ¶ exception client. RedirectCycleError ¶ RedirectCycleError is raised when the test client detects a\nloop or an overly long chain of redirects. Python Exceptions ¶ Django raises built-in Python exceptions when appropriate as well. See the\nPython documentation for further information on the Built-in Exceptions .", "keywords": ["testing", "view", "fielddoesnotexist", "join", "url", "error", "timeout", "asgiref.sync.sync_to_async", "code", "safety", "protectederror", "filter", "badrequest", "access", "class", "_", "field", "example", "order_by", "app", "django.http", "fielderror", "programmingerror", "list", "databaseerror", "orm", "django.contrib.sessions.exceptions", "request", "loop", "notsupportederror", "meta.get_field", "event", "resolver", "database", "restrict", "action", "models", "suspiciousoperation", "query", "django.db.models", "test", "level", "loading", "parents", "transactionmanagementerror", "model", "subclass", "appregistrynotready", "django.urls", "reasons", ".", "suspicioussession", "restrictederror", "dictionaries", "http404", "django", "requestaborted", "wsgi", "django.core.exceptions", "configuration", "http", "n’t", "perspective", "results", "fields", "toomanyfilessent", "redirects", "asgi", "thread", "disallowedmodeladmintofield", "urlconf", "permissiondenied", "validation", "synchronousonlyoperation", "value", "validator", "dataerror", "requestdatatoobig", "wrappers", "source", "suspiciousmultipartform", "improperlyconfigured", "specification", "v2.0", "pep", "data", "process", "implementation", "handler", "base", "non_field_errors", "errors", "server", "clashes", "arguments", "fullresultset", "upload", "sessioninterrupted", "security", "middlewarenotused", "package", "middleware", "subclasses", "custom", "objectdoesnotexist", "objects", "documentation", "generation", "lookups", "core", "emptyresultset", "resolve", "matching", "operation", "modules", "disallowedredirect", "midstream", "resolver404", "user", "constant", "path", "key", "socket", "internalerror", "form", "attribute", "classes", "problem", "httpresponsebadrequest", "unreadableposterror", "doesnotexist", "suspiciousfileoperation", "logging", "framework", "api", "validationerror", "parts", "sessions", "toomanyfieldssent", "projects", "interfaceerror", "transactions", "chain", "connection", "context", "permission", "name", "multipleobjectsreturned", "operationalerror", "viewdoesnotexist", "information", "reference", "python", "cause", "try", "keyword", "problems", "exception", "client", "method", "session", "transaction", "integrityerror", "¶", "disallowedhost", "cookie", "deletion", "parameters", "body", "expressions", "redirectcycleerror", "coroutines", "exceptions"], "type": "documentation"},
{"title": "URL dispatcher | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/http/urls/", "content": "URL dispatcher ¶ A clean, elegant URL scheme is an important detail in a high-quality web\napplication. Django lets you design URLs however you want, with no framework\nlimitations. See Cool URIs don’t change , by World Wide Web creator Tim Berners-Lee, for\nexcellent arguments on why URLs should be clean and usable. Overview ¶ To design URLs for an app, you create a Python module informally called a URLconf (URL configuration). This module is pure Python code and is a\nmapping between URL path expressions to Python functions (your views). This mapping can be as short or as long as needed. It can reference other\nmappings. And, because it’s pure Python code, it can be constructed\ndynamically. Django also provides a way to translate URLs according to the active\nlanguage. See the internationalization documentation for more information. How Django processes a request ¶ When a user requests a page from your Django-powered site, this is the\nalgorithm the system follows to determine which Python code to execute: Django determines the root URLconf module to use. Ordinarily,\nthis is the value of the ROOT_URLCONF setting, but if the incoming HttpRequest object has a urlconf attribute (set by middleware), its value will be used in place of the ROOT_URLCONF setting. Django loads that Python module and looks for the variable urlpatterns . This should be a sequence of django.urls.path() and/or django.urls.re_path() instances. Django runs through each URL pattern, in order, and stops at the first\none that matches the requested URL, matching against path_info . Once one of the URL patterns matches, Django imports and calls the given\nview, which is a Python function (or a class-based view ). The view gets passed the following\narguments: An instance of HttpRequest . If the matched URL pattern contained no named groups, then the\nmatches from the regular expression are provided as positional arguments. The keyword arguments are made up of any named parts matched by the\npath expression that are provided, overridden by any arguments specified\nin the optional kwargs argument to django.urls.path() or django.urls.re_path() . If no URL pattern matches, or if an exception is raised during any\npoint in this process, Django invokes an appropriate\nerror-handling view. See Error handling below. Example ¶ Here’s a sample URLconf: from django.urls import path from . import views urlpatterns = [ path ( \"articles/2003/\" , views . special_case_2003 ), path ( \"articles/<int:year>/\" , views . year_archive ), path ( \"articles/<int:year>/<int:month>/\" , views . month_archive ), path ( \"articles/<int:year>/<int:month>/<slug:slug>/\" , views . article_detail ), ] Notes: To capture a value from the URL, use angle brackets. Captured values can optionally include a converter type. For example, use <int:name> to capture an integer parameter. If a converter isn’t included,\nany string, excluding a / character, is matched. There’s no need to add a leading slash, because every URL has that. For\nexample, it’s articles , not /articles . Example requests: A request to /articles/2005/03/ would match the third entry in the\nlist. Django would call the function views.month_archive(request, year=2005, month=3) . /articles/2003/ would match the first pattern in the list, not the\nsecond one, because the patterns are tested in order, and the first one\nis the first test to pass. Feel free to exploit the ordering to insert\nspecial cases like this. Here, Django would call the function views.special_case_2003(request) /articles/2003 would not match any of these patterns, because each\npattern requires that the URL end with a slash. /articles/2003/03/building-a-django-site/ would match the final\npattern. Django would call the function views.article_detail(request, year=2003, month=3, slug=\"building-a-django-site\") . Path converters ¶ The following path converters are available by default: str - Matches any non-empty string, excluding the path separator, '/' .\nThis is the default if a converter isn’t included in the expression. int - Matches zero or any positive integer. Returns an int . slug - Matches any slug string consisting of ASCII letters or numbers,\nplus the hyphen and underscore characters. For example, building-your-1st-django-site . uuid - Matches a formatted UUID. To prevent multiple URLs from mapping to\nthe same page, dashes must be included and letters must be lowercase. For\nexample, 075194d3-6885-417e-a8a8-6c931e272f00 . Returns a UUID instance. path - Matches any non-empty string, including the path separator, '/' . This allows you to match against a complete URL path rather than\na segment of a URL path as with str . Registering custom path converters ¶ For more complex matching requirements, you can define your own path converters. A converter is a class that includes the following: A regex class attribute, as a string. A to_python(self, value) method, which handles converting the matched\nstring into the type that should be passed to the view function. It should\nraise ValueError if it can’t convert the given value. A ValueError is\ninterpreted as no match and as a consequence a 404 response is sent to the\nuser unless another URL pattern matches. A to_url(self, value) method, which handles converting the Python type\ninto a string to be used in the URL. It should raise ValueError if it\ncan’t convert the given value. A ValueError is interpreted as no match\nand as a consequence reverse() will raise NoReverseMatch unless another URL pattern matches. For example: class FourDigitYearConverter : regex = \"[0-9] {4} \" def to_python ( self , value ): return int ( value ) def to_url ( self , value ): return \" %04d \" % value Register custom converter classes in your URLconf using register_converter() : from django.urls import path , register_converter from . import converters , views register_converter ( converters . FourDigitYearConverter , \"yyyy\" ) urlpatterns = [ path ( \"articles/2003/\" , views . special_case_2003 ), path ( \"articles/<yyyy:year>/\" , views . year_archive ), ... , ] Deprecated since version 5.1: Overriding existing converters with django.urls.register_converter() is\ndeprecated. Using regular expressions ¶ If the paths and converters syntax isn’t sufficient for defining your URL\npatterns, you can also use regular expressions. To do so, use re_path() instead of path() . In Python regular expressions, the syntax for named regular expression groups\nis (?P<name>pattern) , where name is the name of the group and pattern is some pattern to match. Here’s the example URLconf from earlier, rewritten using regular expressions: from django.urls import path , re_path from . import views urlpatterns = [ path ( \"articles/2003/\" , views . special_case_2003 ), re_path ( r \"^articles/(?P<year>[0-9] {4} )/$\" , views . year_archive ), re_path ( r \"^articles/(?P<year>[0-9] {4} )/(?P<month>[0-9] {2} )/$\" , views . month_archive ), re_path ( r \"^articles/(?P<year>[0-9] {4} )/(?P<month>[0-9] {2} )/(?P<slug>[\\w-]+)/$\" , views . article_detail , ), ] This accomplishes roughly the same thing as the previous example, except: The exact URLs that will match are slightly more constrained. For example,\nthe year 10000 will no longer match since the year integers are constrained\nto be exactly four digits long. Each captured argument is sent to the view as a string, regardless of what\nsort of match the regular expression makes. When switching from using path() to re_path() or vice versa, it’s particularly important to be\naware that the type of the view arguments may change, and so you may need to\nadapt your views. Using unnamed regular expression groups ¶ As well as the named group syntax, e.g. (?P<year>[0-9]{4}) , you can\nalso use the shorter unnamed group, e.g. ([0-9]{4}) . This usage isn’t particularly recommended as it makes it easier to accidentally\nintroduce errors between the intended meaning of a match and the arguments\nof the view. In either case, using only one style within a given regex is recommended. When\nboth styles are mixed, any unnamed groups are ignored and only named groups are\npassed to the view function. Nested arguments ¶ Regular expressions allow nested arguments, and Django will resolve them and\npass them to the view. When reversing, Django will try to fill in all outer\ncaptured arguments, ignoring any nested captured arguments. Consider the\nfollowing URL patterns which optionally take a page argument: from django.urls import re_path urlpatterns = [ re_path ( r \"^blog/(page-([0-9]+)/)?$\" , blog_articles ), # bad re_path ( r \"^comments/(?:page-(?P<page_number>[0-9]+)/)?$\" , comments ), # good ] Both patterns use nested arguments and will resolve: for example, blog/page-2/ will result in a match to blog_articles with two\npositional arguments: page-2/ and 2 . The second pattern for comments will match comments/page-2/ with keyword argument page_number set to 2. The outer argument in this case is a non-capturing\nargument (?:...) . The blog_articles view needs the outermost captured argument to be reversed, page-2/ or no arguments in this case, while comments can be reversed\nwith either no arguments or a value for page_number . Nested captured arguments create a strong coupling between the view arguments\nand the URL as illustrated by blog_articles : the view receives part of the\nURL ( page-2/ ) instead of only the value the view is interested in. This\ncoupling is even more pronounced when reversing, since to reverse the view we\nneed to pass the piece of URL instead of the page number. As a rule of thumb, only capture the values the view needs to work with and\nuse non-capturing arguments when the regular expression needs an argument but\nthe view ignores it. What the URLconf searches against ¶ The URLconf searches against the requested URL, as a normal Python string. This\ndoes not include GET or POST parameters, or the domain name. For example, in a request to https://www.example.com/myapp/ , the URLconf\nwill look for myapp/ . In a request to https://www.example.com/myapp/?page=3 , the URLconf will look\nfor myapp/ . The URLconf doesn’t look at the request method. In other words, all request\nmethods – POST , GET , HEAD , etc. – will be routed to the same\nfunction for the same URL. Specifying defaults for view arguments ¶ A convenient trick is to specify default parameters for your views’ arguments.\nHere’s an example URLconf and view: # URLconf from django.urls import path from . import views urlpatterns = [ path ( \"blog/\" , views . page ), path ( \"blog/page<int:num>/\" , views . page ), ] # View (in blog/views.py) def page ( request , num = 1 ): # Output the appropriate page of blog entries, according to num. ... In the above example, both URL patterns point to the same view – views.page – but the first pattern doesn’t capture anything from the\nURL. If the first pattern matches, the page() function will use its\ndefault argument for num , 1 . If the second pattern matches, page() will use whatever num value was captured. Performance ¶ Django processes regular expressions in the urlpatterns list which is\ncompiled the first time it’s accessed. Subsequent requests use the cached\nconfiguration via the URL resolver. Syntax of the urlpatterns variable ¶ urlpatterns should be a sequence of path() and/or re_path() instances. Error handling ¶ When Django can’t find a match for the requested URL, or when an exception is\nraised, Django invokes an error-handling view. The views to use for these cases are specified by four variables. Their\ndefault values should suffice for most projects, but further customization is\npossible by overriding their default values. See the documentation on customizing error views for the full details. Such values can be set in your root URLconf. Setting these variables in any\nother URLconf will have no effect. Values must be callables, or strings representing the full Python import path\nto the view that should be called to handle the error condition at hand. The variables are: handler400 – See django.conf.urls.handler400 . handler403 – See django.conf.urls.handler403 . handler404 – See django.conf.urls.handler404 . handler500 – See django.conf.urls.handler500 . Including other URLconfs ¶ At any point, your urlpatterns can “include” other URLconf modules. This\nessentially “roots” a set of URLs below other ones. For example, here’s an excerpt of the URLconf for the Django website itself. It includes a number of other URLconfs: from django.urls import include , path urlpatterns = [ # ... snip ... path ( \"community/\" , include ( \"aggregator.urls\" )), path ( \"contact/\" , include ( \"contact.urls\" )), # ... snip ... ] Whenever Django encounters include() , it chops off\nwhatever part of the URL matched up to that point and sends the remaining\nstring to the included URLconf for further processing. Another possibility is to include additional URL patterns by using a list of path() instances. For example, consider this URLconf: from django.urls import include , path from apps.main import views as main_views from credit import views as credit_views extra_patterns = [ path ( \"reports/\" , credit_views . report ), path ( \"reports/<int:id>/\" , credit_views . report ), path ( \"charge/\" , credit_views . charge ), ] urlpatterns = [ path ( \"\" , main_views . homepage ), path ( \"help/\" , include ( \"apps.help.urls\" )), path ( \"credit/\" , include ( extra_patterns )), ] In this example, the /credit/reports/ URL will be handled by the credit_views.report() Django view. This can be used to remove redundancy from URLconfs where a single pattern\nprefix is used repeatedly. For example, consider this URLconf: from django.urls import path from . import views urlpatterns = [ path ( \"<page_slug>-<page_id>/history/\" , views . history ), path ( \"<page_slug>-<page_id>/edit/\" , views . edit ), path ( \"<page_slug>-<page_id>/discuss/\" , views . discuss ), path ( \"<page_slug>-<page_id>/permissions/\" , views . permissions ), ] We can improve this by stating the common path prefix only once and grouping\nthe suffixes that differ: from django.urls import include , path from . import views urlpatterns = [ path ( \"<page_slug>-<page_id>/\" , include ( [ path ( \"history/\" , views . history ), path ( \"edit/\" , views . edit ), path ( \"discuss/\" , views . discuss ), path ( \"permissions/\" , views . permissions ), ] ), ), ] Captured parameters ¶ An included URLconf receives any captured parameters from parent URLconfs, so\nthe following example is valid: # In settings/urls/main.py from django.urls import include , path urlpatterns = [ path ( \"<username>/blog/\" , include ( \"foo.urls.blog\" )), ] # In foo/urls/blog.py from django.urls import path from . import views urlpatterns = [ path ( \"\" , views . blog . index ), path ( \"archive/\" , views . blog . archive ), ] In the above example, the captured \"username\" variable is passed to the\nincluded URLconf, as expected. Passing extra options to view functions ¶ URLconfs have a hook that lets you pass extra arguments to your view functions,\nas a Python dictionary. The path() function can take an optional third argument\nwhich should be a dictionary of extra keyword arguments to pass to the view\nfunction. For example: from django.urls import path from . import views urlpatterns = [ path ( \"blog/<int:year>/\" , views . year_archive , { \"foo\" : \"bar\" }), ] In this example, for a request to /blog/2005/ , Django will call views.year_archive(request, year=2005, foo='bar') . This technique is used in the syndication framework to pass metadata and\noptions to views. Dealing with conflicts It’s possible to have a URL pattern which captures named keyword arguments,\nand also passes arguments with the same names in its dictionary of extra\narguments. When this happens, the arguments in the dictionary will be used\ninstead of the arguments captured in the URL. Passing extra options to include() ¶ Similarly, you can pass extra options to include() and\neach line in the included URLconf will be passed the extra options. For example, these two URLconf sets are functionally identical: Set one: # main.py from django.urls import include , path urlpatterns = [ path ( \"blog/\" , include ( \"inner\" ), { \"blog_id\" : 3 }), ] # inner.py from django.urls import path from mysite import views urlpatterns = [ path ( \"archive/\" , views . archive ), path ( \"about/\" , views . about ), ] Set two: # main.py from django.urls import include , path from mysite import views urlpatterns = [ path ( \"blog/\" , include ( \"inner\" )), ] # inner.py from django.urls import path urlpatterns = [ path ( \"archive/\" , views . archive , { \"blog_id\" : 3 }), path ( \"about/\" , views . about , { \"blog_id\" : 3 }), ] Note that extra options will always be passed to every line in the included\nURLconf, regardless of whether the line’s view actually accepts those options\nas valid. For this reason, this technique is only useful if you’re certain that\nevery view in the included URLconf accepts the extra options you’re passing. Reverse resolution of URLs ¶ A common need when working on a Django project is the possibility to obtain URLs\nin their final forms either for embedding in generated content (views and assets\nURLs, URLs shown to the user, etc.) or for handling of the navigation flow on\nthe server side (redirections, etc.) It is strongly desirable to avoid hard-coding these URLs (a laborious,\nnon-scalable and error-prone strategy). Equally dangerous is devising ad-hoc\nmechanisms to generate URLs that are parallel to the design described by the\nURLconf, which can result in the production of URLs that become stale over time. In other words, what’s needed is a DRY mechanism. Among other advantages it\nwould allow evolution of the URL design without having to go over all the\nproject source code to search and replace outdated URLs. The primary piece of information we have available to get a URL is an\nidentification (e.g. the name) of the view in charge of handling it. Other\npieces of information that necessarily must participate in the lookup of the\nright URL are the types (positional, keyword) and values of the view arguments. Django provides a solution such that the URL mapper is the only repository of\nthe URL design. You feed it with your URLconf and then it can be used in both\ndirections: Starting with a URL requested by the user/browser, it calls the right Django\nview providing any arguments it might need with their values as extracted from\nthe URL. Starting with the identification of the corresponding Django view plus the\nvalues of arguments that would be passed to it, obtain the associated URL. The first one is the usage we’ve been discussing in the previous sections. The\nsecond one is what is known as reverse resolution of URLs , reverse URL\nmatching , reverse URL lookup , or simply URL reversing . Django provides tools for performing URL reversing that match the different\nlayers where URLs are needed: In templates: Using the url template tag. In Python code: Using the reverse() function. In higher level code related to handling of URLs of Django model instances:\nThe get_absolute_url() method. Examples ¶ Consider again this URLconf entry: from django.urls import path from . import views urlpatterns = [ # ... path ( \"articles/<int:year>/\" , views . year_archive , name = \"news-year-archive\" ), # ... ] According to this design, the URL for the archive corresponding to year nnnn is /articles/<nnnn>/ . You can obtain these in template code by using: < a href = \" {% url 'news-year-archive' 2012 %} \" > 2012 Archive </ a > {# Or with the year in a template context variable: #} < ul > {% for yearvar in year_list %} < li >< a href = \" {% url 'news-year-archive' yearvar %} \" > {{ yearvar }} Archive </ a ></ li > {% endfor %} </ ul > Or in Python code: from django.http import HttpResponseRedirect from django.urls import reverse def redirect_to_year ( request ): # ... year = 2006 # ... return HttpResponseRedirect ( reverse ( \"news-year-archive\" , args = ( year ,))) If, for some reason, it was decided that the URLs where content for yearly\narticle archives are published at should be changed then you would only need to\nchange the entry in the URLconf. In some scenarios where views are of a generic nature, a many-to-one\nrelationship might exist between URLs and views. For these cases the view name\nisn’t a good enough identifier for it when comes the time of reversing\nURLs. Read the next section to know about the solution Django provides for this. Naming URL patterns ¶ In order to perform URL reversing, you’ll need to use named URL patterns as done in the examples above. The string used for the URL name can contain any\ncharacters you like. You are not restricted to valid Python names. When naming URL patterns, choose names that are unlikely to clash with other\napplications’ choice of names. If you call your URL pattern comment and another application does the same thing, the URL that reverse() finds depends on whichever pattern is last in\nyour project’s urlpatterns list. Putting a prefix on your URL names, perhaps derived from the application\nname (such as myapp-comment instead of comment ), decreases the chance\nof collision. You can deliberately choose the same URL name as another application if you\nwant to override a view. For example, a common use case is to override the LoginView . Parts of Django and most\nthird-party apps assume that this view has a URL pattern with the name login . If you have a custom login view and give its URL the name login , reverse() will find your custom view as long as it’s in urlpatterns after django.contrib.auth.urls is included (if that’s\nincluded at all). You may also use the same name for multiple URL patterns if they differ in\ntheir arguments. In addition to the URL name, reverse() matches the number of arguments and the names of the keyword arguments. Path\nconverters can also raise ValueError to indicate no match, see Registering custom path converters for details. URL namespaces ¶ Introduction ¶ URL namespaces allow you to uniquely reverse named URL patterns even if different applications use the same URL names.\nIt’s a good practice for third-party apps to always use namespaced URLs (as we\ndid in the tutorial). Similarly, it also allows you to reverse URLs if multiple\ninstances of an application are deployed. In other words, since multiple\ninstances of a single application will share named URLs, namespaces provide a\nway to tell these named URLs apart. Django applications that make proper use of URL namespacing can be deployed\nmore than once for a particular site. For example django.contrib.admin has an AdminSite class which allows you to deploy more than one instance of the admin .  In a\nlater example, we’ll discuss the idea of deploying the polls application from\nthe tutorial in two different locations so we can serve the same functionality\nto two different audiences (authors and publishers). A URL namespace comes in two parts, both of which are strings: application namespace ¶ This describes the name of the application that is being deployed. Every\ninstance of a single application will have the same application namespace.\nFor example, Django’s admin application has the somewhat predictable\napplication namespace of 'admin' . instance namespace ¶ This identifies a specific instance of an application. Instance namespaces\nshould be unique across your entire project. However, an instance namespace\ncan be the same as the application namespace. This is used to specify a\ndefault instance of an application. For example, the default Django admin\ninstance has an instance namespace of 'admin' . Namespaced URLs are specified using the ':' operator. For example, the main\nindex page of the admin application is referenced using 'admin:index' . This\nindicates a namespace of 'admin' , and a named URL of 'index' . Namespaces can also be nested. The named URL 'sports:polls:index' would\nlook for a pattern named 'index' in the namespace 'polls' that is itself\ndefined within the top-level namespace 'sports' . Reversing namespaced URLs ¶ When given a namespaced URL (e.g. 'polls:index' ) to resolve, Django splits\nthe fully qualified name into parts and then tries the following lookup: First, Django looks for a matching application namespace (in this\nexample, 'polls' ). This will yield a list of instances of that\napplication. If there is a current application defined, Django finds and returns the URL\nresolver for that instance. The current application can be specified with\nthe current_app argument to the reverse() function. The url template tag uses the namespace of the currently resolved\nview as the current application in a RequestContext . You can override this default by\nsetting the current application on the request.current_app attribute. If there is no current application, Django looks for a default\napplication instance. The default application instance is the instance\nthat has an instance namespace matching the application\nnamespace (in this example, an instance of polls called 'polls' ). If there is no default application instance, Django will pick the last\ndeployed instance of the application, whatever its instance name may be. If the provided namespace doesn’t match an application namespace in\nstep 1, Django will attempt a direct lookup of the namespace as an instance namespace . If there are nested namespaces, these steps are repeated for each part of the\nnamespace until only the view name is unresolved. The view name will then be\nresolved into a URL in the namespace that has been found. Example ¶ To show this resolution strategy in action, consider an example of two instances\nof the polls application from the tutorial: one called 'author-polls' and one called 'publisher-polls' . Assume we have enhanced that application\nso that it takes the instance namespace into consideration when creating and\ndisplaying polls. urls.py ¶ from django.urls import include , path urlpatterns = [ path ( \"author-polls/\" , include ( \"polls.urls\" , namespace = \"author-polls\" )), path ( \"publisher-polls/\" , include ( \"polls.urls\" , namespace = \"publisher-polls\" )), ] polls/urls.py ¶ from django.urls import path from . import views app_name = \"polls\" urlpatterns = [ path ( \"\" , views . IndexView . as_view (), name = \"index\" ), path ( \"<int:pk>/\" , views . DetailView . as_view (), name = \"detail\" ), ... , ] Using this setup, the following lookups are possible: If one of the instances is current - say, if we were rendering the detail page\nin the instance 'author-polls' - 'polls:index' will resolve to the\nindex page of the 'author-polls' instance; i.e. both of the following will\nresult in \"/author-polls/\" . In the method of a class-based view: reverse ( \"polls:index\" , current_app = self . request . resolver_match . namespace ) and in the template: {% url 'polls:index' %} If there is no current instance - say, if we were rendering a page\nsomewhere else on the site - 'polls:index' will resolve to the last\nregistered instance of polls . Since there is no default instance\n(instance namespace of 'polls' ), the last instance of polls that is\nregistered will be used. This would be 'publisher-polls' since it’s\ndeclared last in the urlpatterns . 'author-polls:index' will always resolve to the index page of the instance 'author-polls' (and likewise for 'publisher-polls' ) . If there were also a default instance - i.e., an instance named 'polls' -\nthe only change from above would be in the case where there is no current\ninstance (the second item in the list above). In this case 'polls:index' would resolve to the index page of the default instance instead of the instance\ndeclared last in urlpatterns . URL namespaces and included URLconfs ¶ Application namespaces of included URLconfs can be specified in two ways. Firstly, you can set an app_name attribute in the included URLconf module,\nat the same level as the urlpatterns attribute. You have to pass the actual\nmodule, or a string reference to the module, to include() ,\nnot the list of urlpatterns itself. polls/urls.py ¶ from django.urls import path from . import views app_name = \"polls\" urlpatterns = [ path ( \"\" , views . IndexView . as_view (), name = \"index\" ), path ( \"<int:pk>/\" , views . DetailView . as_view (), name = \"detail\" ), ... , ] urls.py ¶ from django.urls import include , path urlpatterns = [ path ( \"polls/\" , include ( \"polls.urls\" )), ] The URLs defined in polls.urls will have an application namespace polls . Secondly, you can include an object that contains embedded namespace data. If\nyou include() a list of path() or re_path() instances, the URLs contained in that object\nwill be added to the global namespace. However, you can also include() a\n2-tuple containing: (<list of path()/re_path() instances>, <application namespace>) For example: from django.urls import include , path from . import views polls_patterns = ( [ path ( \"\" , views . IndexView . as_view (), name = \"index\" ), path ( \"<int:pk>/\" , views . DetailView . as_view (), name = \"detail\" ), ], \"polls\" , ) urlpatterns = [ path ( \"polls/\" , include ( polls_patterns )), ] This will include the nominated URL patterns into the given application\nnamespace. The instance namespace can be specified using the namespace argument to include() . If the instance namespace is not specified,\nit will default to the included URLconf’s application namespace. This means\nit will also be the default instance for that namespace.", "keywords": ["articles/2003/", "pattern", "login", "searches", "a8a8", "#", "blog/<int", "metadata", "cool", "numbers", "meaning", "regex", "action", "match", "identification", "your-1st", "aggregator.urls", "words", "django.urls", "change", "hook", "path_info", "navigation", "creator", "=", "thumb", "blog_id", "get_absolute_url", "head", "relationship", "href", "character", "letters", "setup", "tag", "sets", "process", "separator", "choice", "articles/<yyyy", "following", "type", "processing", "contact.urls", "custom", "kwargs", "documentation", "lookups", "root_urlconf", "customization", "modules", "strategy", "user", "li", "cases", "handler404", "layers", "attribute", "args", "fourdigityearconverter", "mechanism", "re_path", "yearvar", "time", "styles", "trick", "setting", "page_slug>-<page_id>/discuss/", "polls", "registering", "edit", "uris", "name", "parameter", "rule", "world", "as_view", "reference", "web", "year>[0", "corresponding", "django.contrib.admin", "roots", "piece", "return", "angle", "tim", "reverse", "applications", "operator", "tutorial", "expressions", "foo", "consideration", "apps.main", "parent", "collision", "blog", "/articles", "django.contrib.auth.urls", "examples", "callables", "slug>/", "to_url(self", "url", "nature", "error", "module", "code", "algorithm", "slug>[\\w-]+)/$", "style", "request.current_app", "class", "foo='bar", "group", "year>/", "archive", "returns", "names", "request", "output", "django.conf.urls.handler403", "page", "test", "types", "strings", "admin", "usage", "configuration", "step", "converter", "redirect_to_year", "limitations", "reports/<int", "redundancy", "section", "source", "sequence", "to_python", "use", "advantages", "author", "imports", "solution", "month=3", "repository", "performance", "/author", "apps.help.urls", "charge", "handler403", "order", "default", "/articles/2003/", "main.py", "comment", "prefix", "expression", "characters", "classes", "evolution", "current_app", "django.urls.register_converter", "scheme", "to_url", "template", "wide", "mappings", "mysite", "way", "endfor", "page_slug>-<page_id>/history/", "comments", "index", "syndication", "possibility", "page_slug>-<page_id>/permissions/", "credit", "party", "/blog/2005/", "integer", "blog_articles", "¶", "news", "internationalization", "page_number>[0", "page_slug>-<page_id>/edit/", "post", "parameters", "int", "integers", "side", "content", "function", "views", "view", "uuid", "building", "number", "suffixes", "django.conf.urls.handler404", "permissions", "def", "indexview", "point", "main_views", "values", "polls.urls", "directions", "string", "urls.py", "overview", "mapping", "thing", "resolver", "hand", "publisher", "6c931e272f00", "language", "history", "version", "ways", "level", "dashes", "month>/<slug", "handler500", "article", "namespace", "condition", "django", "myapp", "n’t", "brackets", "entry", "sports", "set", "p", "excerpt", "redirections", "practice", "namespacing", "urlpatterns", "value", "line", "data", "browser", "item", "quality", "path()/re_path", "page_number", "identifier", "ul", "self", "need", "instance", "paths", "handling", "handler400", "consequence", "mechanisms", "year=2005", "page-2/", "report", "ad", "special_case_2003", "functionality", "publishers", "/articles/2003/03", "digits", "assets", "django.urls.path", "instances", "month>[0", "part", "object", "domain", "valueerror", "groups", "httprequest", "response", "website", "namespaces", "dictionary", "requests", "authors", "chance", "keyword", "register", "naming", "ordering", "resolution", "matches", "variables", "075194d3", "root", "notes", "coupling", "effect", "detail", "system", "apps", "views.page", "^blog/(page-([0", "archives", "id>/", "extra_patterns", "production", "articles/<int", "slash", "site", "forms", "addition", "example", "app", "requirements", "locations", "list", "sample", "pieces", "^articles/(?p", "steps", "variable", "model", "year", "sections", "idea", "place", "urlconfs", "application", "dry", "flow", "conflicts", "urlconf", "register_converter", "^comments/(?:page-(?p", "syntax", "r", "ones", "converters", "case", "segment", "lookup", "technique", "errors", "year=2003", "tuple", "server", "str", "arguments", "audiences", "introduction", "django.urls.re_path", "middleware", "one", "mapper", "entries", "matching", "adminsite", "bar", "polls_patterns", "loginview", "path", "functions", "httpresponseredirect", "get", "patterns", "reason", "framework", "lee", "urls", "django.conf.urls.handler400", "projects", "month>/", "-", "yyyy", "context", "import", "%", "defaults", "pk>/", "information", "python", "9]+)/)?$", "username>/blog/", "requestcontext", "methods", "year>/<int", "optional", "options", "exception", "berners", "foo.urls.blog", "details", "method", "num", "settings", "reversing", "argument", "articles", "tools", "scenarios", "design", "templates", "credit_views", "detailview", "project", "parts"], "type": "documentation"},
{"title": "Applications | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/applications/", "content": "Applications ¶ Django contains a registry of installed applications that stores configuration\nand provides introspection. It also maintains a list of available models . This registry is called apps and it’s available in django.apps : >>> from django.apps import apps >>> apps . get_app_config ( \"admin\" ) . verbose_name 'Administration' Projects and applications ¶ The term project describes a Django web application. The project Python\npackage is defined primarily by a settings module, but it usually contains\nother things. For example, when you run django-admin startproject mysite you’ll get a mysite project directory that contains a mysite Python\npackage with settings.py , urls.py , asgi.py and wsgi.py . The\nproject package is often extended to include things like fixtures, CSS, and\ntemplates which aren’t tied to a particular application. A project’s root directory (the one that contains manage.py ) is usually\nthe container for all of a project’s applications which aren’t installed\nseparately. The term application describes a Python package that provides some set of\nfeatures. Applications may be reused in various\nprojects. Applications include some combination of models, views, templates, template\ntags, static files, URLs, middleware, etc. They’re generally wired into\nprojects with the INSTALLED_APPS setting and optionally with other\nmechanisms such as URLconfs, the MIDDLEWARE setting, or template\ninheritance. It is important to understand that a Django application is a set of code\nthat interacts with various parts of the framework. There’s no such thing as\nan Application object. However, there’s a few places where Django needs to\ninteract with installed applications, mainly for configuration and also for\nintrospection. That’s why the application registry maintains metadata in an AppConfig instance for each installed application. There’s no restriction that a project package can’t also be considered an\napplication and have models, etc. (which would require adding it to INSTALLED_APPS ). Configuring applications ¶ To configure an application, create an apps.py module inside the\napplication, then define a subclass of AppConfig there. When INSTALLED_APPS contains the dotted path to an application\nmodule, by default, if Django finds exactly one AppConfig subclass in\nthe apps.py submodule, it uses that configuration for the application. This\nbehavior may be disabled by setting AppConfig.default to False . If the apps.py module contains more than one AppConfig subclass,\nDjango will look for a single one where AppConfig.default is True . If no AppConfig subclass is found, the base AppConfig class\nwill be used. Alternatively, INSTALLED_APPS may contain the dotted path to a\nconfiguration class to specify it explicitly: INSTALLED_APPS = [ ... , \"polls.apps.PollsAppConfig\" , ... , ] For application authors ¶ If you’re creating a pluggable app called “Rock ’n’ roll”, here’s how you\nwould provide a proper name for the admin: # rock_n_roll/apps.py from django.apps import AppConfig class RockNRollConfig ( AppConfig ): name = \"rock_n_roll\" verbose_name = \"Rock ’n’ roll\" RockNRollConfig will be loaded automatically when INSTALLED_APPS contains 'rock_n_roll' . If you need to prevent this, set default to False in the class definition. You can provide several AppConfig subclasses with different behaviors.\nTo tell Django which one to use by default, set default to True in its definition. If your users want to pick a non-default\nconfiguration, they must replace 'rock_n_roll' with the dotted path to that\nspecific class in their INSTALLED_APPS setting. The AppConfig.name attribute tells Django which application this\nconfiguration applies to. You can define any other attribute documented in the AppConfig API reference. AppConfig subclasses may be defined anywhere. The apps.py convention merely allows Django to load them automatically when INSTALLED_APPS contains the path to an application module rather\nthan the path to a configuration class. Note If your code imports the application registry in an application’s __init__.py , the name apps will clash with the apps submodule.\nThe best practice is to move that code to a submodule and import it. A\nworkaround is to import the registry under a different name: from django.apps import apps as django_apps For application users ¶ If you’re using “Rock ’n’ roll” in a project called anthology , but you\nwant it to show up as “Jazz Manouche” instead, you can provide your own\nconfiguration: # anthology/apps.py from rock_n_roll.apps import RockNRollConfig class JazzManoucheConfig ( RockNRollConfig ): verbose_name = \"Jazz Manouche\" # anthology/settings.py INSTALLED_APPS = [ \"anthology.apps.JazzManoucheConfig\" , # ... ] This example shows project-specific configuration classes located in a\nsubmodule called apps.py . This is a convention, not a requirement. AppConfig subclasses may be defined anywhere. In this situation, INSTALLED_APPS must contain the dotted path to\nthe configuration class because it lives outside of an application and thus\ncannot be automatically detected. Application configuration ¶ class AppConfig [source] ¶ Application configuration objects store metadata for an application. Some\nattributes can be configured in AppConfig subclasses. Others are set by Django and read-only. Configurable attributes ¶ AppConfig. name ¶ Full Python path to the application, e.g. 'django.contrib.admin' . This attribute defines which application the configuration applies to. It\nmust be set in all AppConfig subclasses. It must be unique across a Django project. AppConfig. label ¶ Short name for the application, e.g. 'admin' This attribute allows relabeling an application when two applications\nhave conflicting labels. It defaults to the last component of name .\nIt should be a valid Python identifier. It must be unique across a Django project. Warning Changing this attribute after migrations have been applied for an\napplication will result in breaking changes to a project or, in the\ncase of a reusable app, any existing installs of that app. This is\nbecause AppConfig.label is used in database tables and migration\nfiles when referencing an app in the dependencies list. AppConfig. verbose_name ¶ Human-readable name for the application, e.g. “Administration”. This attribute defaults to label.title() . AppConfig. path ¶ Filesystem path to the application directory, e.g. '/usr/lib/pythonX.Y/dist-packages/django/contrib/admin' . In most cases, Django can automatically detect and set this, but you can\nalso provide an explicit override as a class attribute on your AppConfig subclass. In a few situations this is\nrequired; for instance if the app package is a namespace package with\nmultiple paths. AppConfig. default ¶ Set this attribute to False to prevent Django from selecting a\nconfiguration class automatically. This is useful when apps.py defines\nonly one AppConfig subclass but you don’t want Django to use it by\ndefault. Set this attribute to True to tell Django to select a configuration\nclass automatically. This is useful when apps.py defines more than one AppConfig subclass and you want Django to use one of them by\ndefault. By default, this attribute isn’t set. AppConfig. default_auto_field [source] ¶ The implicit primary key type to add to models within this app. You can\nuse this to keep AutoField as the primary key\ntype for third party applications. By default, this is the value of DEFAULT_AUTO_FIELD . Read-only attributes ¶ AppConfig. module ¶ Root module for the application, e.g. <module 'django.contrib.admin' from 'django/contrib/admin/__init__.py'> . AppConfig. models_module ¶ Module containing the models, e.g. <module 'django.contrib.admin.models' from 'django/contrib/admin/models.py'> . It may be None if the application doesn’t contain a models module.\nNote that the database related signals such as pre_migrate and post_migrate are only emitted for applications that have a models module. Methods ¶ AppConfig. get_models ( include_auto_created = False , include_swapped = False ) [source] ¶ Returns an iterable of Model classes for this\napplication. Requires the app registry to be fully populated. AppConfig. get_model ( model_name , require_ready = True ) [source] ¶ Returns the Model with the given model_name . model_name is case-insensitive. Raises LookupError if no such model exists in this application. Requires the app registry to be fully populated unless the require_ready argument is set to False . require_ready behaves\nexactly as in apps.get_model() . AppConfig. ready () [source] ¶ Subclasses can override this method to perform initialization tasks such\nas registering signals. It is called as soon as the registry is fully\npopulated. Although you can’t import models at the module-level where AppConfig classes are defined, you can import them in ready() , using either an import statement or get_model() . If you’re registering model signals , you\ncan refer to the sender by its string label instead of using the model\nclass itself. Example: from django.apps import AppConfig from django.db.models.signals import pre_save class RockNRollConfig ( AppConfig ): # ... def ready ( self ): # importing model classes from .models import MyModel # or... MyModel = self . get_model ( \"MyModel\" ) # registering signals with the model's string label pre_save . connect ( receiver , sender = \"app_label.MyModel\" ) Warning Although you can access model classes as described above, avoid\ninteracting with the database in your ready() implementation.\nThis includes model methods that execute queries\n( save() , delete() , manager methods etc.), and\nalso raw SQL queries via django.db.connection . Your ready() method will run during startup of every management\ncommand. For example, even though the test database configuration is\nseparate from the production settings, manage.py test would still\nexecute some queries against your production database! Note In the usual initialization process, the ready method is only called\nonce by Django. But in some corner cases, particularly in tests which\nare fiddling with installed applications, ready might be called more\nthan once. In that case, either write idempotent methods, or put a flag\non your AppConfig classes to prevent rerunning code which should\nbe executed exactly one time. Namespace packages as apps ¶ Python packages without an __init__.py file are known as “namespace\npackages” and may be spread across multiple directories at different locations\non sys.path (see PEP 420 ). Django applications require a single base filesystem path where Django\n(depending on configuration) will search for templates, static assets,\netc. Thus, namespace packages may only be Django applications if one of the\nfollowing is true: The namespace package actually has only a single location (i.e. is not\nspread across more than one directory.) The AppConfig class used to configure the application\nhas a path class attribute, which is the\nabsolute directory path Django will use as the single base path for the\napplication. If neither of these conditions is met, Django will raise ImproperlyConfigured . Application registry ¶ apps ¶ The application registry provides the following public API. Methods that\naren’t listed below are considered private and may change without notice. apps. ready ¶ Boolean attribute that is set to True after the registry is fully\npopulated and all AppConfig.ready() methods are called. apps. get_app_configs () ¶ Returns an iterable of AppConfig instances. apps. get_app_config ( app_label ) ¶ Returns an AppConfig for the application with the\ngiven app_label . Raises LookupError if no such application\nexists. apps. is_installed ( app_name ) ¶ Checks whether an application with the given name exists in the registry. app_name is the full name of the app, e.g. 'django.contrib.admin' . apps. get_model ( app_label , model_name , require_ready = True ) ¶ Returns the Model with the given app_label and model_name . As a shortcut, this method also accepts a single\nargument in the form app_label.model_name . model_name is\ncase-insensitive. Raises LookupError if no such application or model exists. Raises ValueError when called with a single argument that doesn’t contain\nexactly one dot. Requires the app registry to be fully populated unless the require_ready argument is set to False . Setting require_ready to False allows looking up models while the app registry is being populated ,\nspecifically during the second phase where it imports models. Then get_model() has the same effect as importing the model. The main use\ncase is to configure model classes with settings, such as AUTH_USER_MODEL . When require_ready is False , get_model() returns a model class\nthat may not be fully functional (reverse accessors may be missing, for\nexample) until the app registry is fully populated. For this reason, it’s\nbest to leave require_ready to the default value of True whenever\npossible. Initialization process ¶ How applications are loaded ¶ When Django starts, django.setup() is responsible for populating the\napplication registry. setup ( set_prefix = True ) [source] ¶ Configures Django by: Loading the settings. Setting up logging. If set_prefix is True, setting the URL resolver script prefix to FORCE_SCRIPT_NAME if defined, or / otherwise. Initializing the application registry. This function is called automatically: When running an HTTP server via Django’s ASGI or WSGI support. When invoking a management command. It must be called explicitly in other cases, for instance in plain Python\nscripts. Changed in Django 5.0: Raises a RuntimeWarning when apps interact with the database before\nthe app registry has been fully populated. The application registry is initialized in three stages. At each stage, Django\nprocesses all applications in the order of INSTALLED_APPS . First Django imports each item in INSTALLED_APPS . If it’s an application configuration class, Django imports the root package\nof the application, defined by its name attribute. If\nit’s a Python package, Django looks for an application configuration in an apps.py submodule, or else creates a default application configuration. At this stage, your code shouldn’t import any models! In other words, your applications’ root packages and the modules that\ndefine your application configuration classes shouldn’t import any models,\neven indirectly. Strictly speaking, Django allows importing models once their application\nconfiguration is loaded. However, in order to avoid needless constraints on\nthe order of INSTALLED_APPS , it’s strongly recommended not\nimport any models at this stage. Once this stage completes, APIs that operate on application configurations\nsuch as get_app_config() become usable. Then Django attempts to import the models submodule of each application,\nif there is one. You must define or import all models in your application’s models.py or models/__init__.py . Otherwise, the application registry may not be fully\npopulated at this point, which could cause the ORM to malfunction. Once this stage completes, APIs that operate on models such as get_model() become usable. Finally Django runs the ready() method of each application\nconfiguration. Troubleshooting ¶ Here are some common problems that you may encounter during initialization: AppRegistryNotReady : This happens when\nimporting an application configuration or a models module triggers code that\ndepends on the app registry. For example, gettext() uses the app\nregistry to look up translation catalogs in applications. To translate at\nimport time, you need gettext_lazy() instead. (Using gettext() would be a bug,\nbecause the translation would happen at import time, rather than at each\nrequest depending on the active language.) Executing database queries with the ORM at import time in models modules\nwill also trigger this exception. The ORM cannot function properly until all\nmodels are available. This exception also happens if you forget to call django.setup() in\na standalone Python script. ImportError: cannot import name ... This happens if the import sequence\nends up in a loop. To eliminate such problems, you should minimize dependencies between your\nmodels modules and do as little work as possible at import time. To avoid\nexecuting code at import time, you can move it into a function and cache its\nresults. The code will be executed when you first need its results. This\nconcept is known as “lazy evaluation”. django.contrib.admin automatically performs autodiscovery of admin modules in installed applications. To prevent it, change your INSTALLED_APPS to contain 'django.contrib.admin.apps.SimpleAdminConfig' instead of 'django.contrib.admin' . RuntimeWarning: Accessing the database during app initialization is discouraged. This warning is triggered for database queries executed before\napps are ready, such as during module imports or in the AppConfig.ready() method. Such premature database queries are\ndiscouraged because they will run during the startup of every management\ncommand, which will slow down your project startup, potentially cache stale\ndata, and can even fail if migrations are pending. For example, a common mistake is making a database query to populate form\nfield choices: class LocationForm ( forms . Form ): country = forms . ChoiceField ( choices = [ c . name for c in Country . objects . all ()]) In the example above, the query from Country.objects.all() is executed\nduring module import, because the QuerySet is iterated over. To avoid the\nwarning, the form could use a ModelChoiceField instead: class LocationForm ( forms . Form ): country = forms . ModelChoiceField ( queryset = Country . objects . all ()) To make it easier to find the code that triggered this warning, you can make\nPython treat warnings as errors to reveal the\nstack trace, for example with python -Werror manage.py shell .", "keywords": ["lib", "function", "users", "mymodel", "views", "pre_save", "store", "lookuperror", "production", "receiver", "appconfig.name", "pre_migrate", "definition", "startup", "autofield", "url", "conditions", "module", "code", "point", "features", "forms", "default_auto_field", "post_migrate", "directories", "false", "behavior", "label.title", "string", "class", "example", "migration", "#", "sender", "app", "exists", "allows", "introspection", "field", "country", "locations", "list", "warnings", "thing", "migrations", "catalogs", "returns", "metadata", "'", "orm", "django.apps", "models/__init__.py", "verbose_name", "request", "loop", "resolver", "database", "flag", "first", "importerror", "get_app_config", "location", "rock_n_roll", "rocknrollconfig", "apps.get_model", "language", "models", "query", "stage", "test", "country.objects.all", "stack", "cache", "human", "level", "get_model", "phase", "model", "words", "rock_n_roll.apps", "subclass", "appregistrynotready", "admin", "apis", "scripts", "anthology.apps", "urlconfs", ".", "short", "application", "labels", "namespace", "attributes", "registry", "roll", "label", "jazzmanoucheconfig", "django", "wsgi", "http", "configuration", "=", "changes", "auth_user_model", "script", "n’t", "mistake", "results", "django.contrib.admin.apps", "asgi", "set", "django.db.models.signals", "override", "admin/__init__.py", "shell", "translation", "pollsappconfig", "practice", "restriction", "setup", "django_apps", "tables", "value", "filesystem", "source", "improperlyconfigured", "django.setup", "case", "component", "pep", "implementation", "process", "places", "manouche", "sequence", "data", "css", "item", "idempotent", "container", "use", "evaluation", "base", "errors", "pythonx.y", "server", "administration", "identifier", "iterable", "type", "following", "package", "gettext", "shortcut", "imports", "middleware", "subclasses", "one", "paths", "instance", "self", "defines", "django.contrib.admin.models", "dist", "contrib", "file", "startproject", "initialization", "work", "order", "modules", "default", "mechanisms", "requirement", "path", "choices", "cases", "trace", "c", "term", "submodule", "appconfig", "bug", "signals", "attribute", "form", "none", "classes", "tests", "packages", "gettext_lazy", "runtimewarning", "constraints", "warning", "time", "assets", "convention", "tags", "workaround", "reason", "framework", "save", "instances", "setting", "true", "statement", "urls", "api", "installed_apps", "app_label", "fixtures", "support", "get_models", "apps.py", "projects", "things", "object", ".models", "app_label.model_name", "valueerror", "rock", "corner", "choicefield", "import", "combination", "files", "name", "dot", "template", "stages", "management", "sys.path", "directory", "defaults", "mysite", "sql", "require_ready", "authors", "reference", "situations", "web", "python", "malfunction", "checks", "methods", "problems", "accessors", "queries", "set_prefix", "exception", "anthology", "include_auto_created", "configurations", "force_script_name", "manager", "concept", "others", "django.contrib.admin", "party", "method", "notice", "queryset", "root", "settings", "argument", "¶", "behaviors", "behaves", "command", "configures", "applications", "installs", "model_name", "tasks", "effect", "modelchoicefield", "jazz", "situation", "apps", "inheritance", "-werror", "locationform", "simpleadminconfig", "templates", "autodiscovery", "dependencies", "project", "parts"], "type": "documentation"},
{"title": "django.urls utility functions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/urlresolvers/", "content": "django.urls utility functions ¶ reverse() ¶ If you need to use something similar to the url template tag in\nyour code, Django provides the following function: reverse ( viewname , urlconf = None , args = None , kwargs = None , current_app = None ) [source] ¶ viewname can be a URL pattern name or the\ncallable view object. For example, given the following url : from news import views path ( \"archive/\" , views . archive , name = \"news-archive\" ) you can use any of the following to reverse the URL: # using the named URL reverse ( \"news-archive\" ) # passing a callable object # (This is discouraged because you can't reverse namespaced views this way.) from news import views reverse ( views . archive ) If the URL accepts arguments, you may pass them in args . For example: from django.urls import reverse def myview ( request ): return HttpResponseRedirect ( reverse ( \"arch-summary\" , args = [ 1945 ])) You can also pass kwargs instead of args . For example: >>> reverse ( \"admin:app_list\" , kwargs = { \"app_label\" : \"auth\" }) '/admin/auth/' args and kwargs cannot be passed to reverse() at the same time. If no match can be made, reverse() raises a NoReverseMatch exception. The reverse() function can reverse a large variety of regular expression\npatterns for URLs, but not every possible one. The main restriction at the\nmoment is that the pattern cannot contain alternative choices using the\nvertical bar ( \"|\" ) character. You can quite happily use such patterns for\nmatching against incoming URLs and sending them off to views, but you cannot\nreverse such patterns. The current_app argument allows you to provide a hint to the resolver\nindicating the application to which the currently executing view belongs.\nThis current_app argument is used as a hint to resolve application\nnamespaces into URLs on specific application instances, according to the namespaced URL resolution strategy . The urlconf argument is the URLconf module containing the URL patterns to\nuse for reversing. By default, the root URLconf for the current thread is used. Note The string returned by reverse() is already urlquoted . For example: >>> reverse ( \"cities\" , args = [ \"Orléans\" ]) '.../Orl%C3%A9ans/' Applying further encoding (such as urllib.parse.quote() ) to the output\nof reverse() may produce undesirable results. reverse_lazy() ¶ A lazily evaluated version of reverse() . reverse_lazy ( viewname , urlconf = None , args = None , kwargs = None , current_app = None ) ¶ It is useful for when you need to use a URL reversal before your project’s\nURLConf is loaded. Some common cases where this function is necessary are: providing a reversed URL as the url attribute of a generic class-based\nview. providing a reversed URL to a decorator (such as the login_url argument\nfor the django.contrib.auth.decorators.permission_required() decorator). providing a reversed URL as a default value for a parameter in a function’s\nsignature. resolve() ¶ The resolve() function can be used for resolving URL paths to the\ncorresponding view functions. It has the following signature: resolve ( path , urlconf = None ) [source] ¶ path is the URL path you want to resolve. As with reverse() , you don’t need to worry about the urlconf parameter. The function returns a ResolverMatch object that allows you\nto access various metadata about the resolved URL. If the URL does not resolve, the function raises a Resolver404 exception (a subclass of Http404 ) . class ResolverMatch [source] ¶ func ¶ The view function that would be used to serve the URL args ¶ The arguments that would be passed to the view function, as\nparsed from the URL. kwargs ¶ All keyword arguments that would be passed to the view function, i.e. captured_kwargs and extra_kwargs . captured_kwargs ¶ The captured keyword arguments that would be passed to the view\nfunction, as parsed from the URL. extra_kwargs ¶ The additional keyword arguments that would be passed to the view\nfunction. url_name ¶ The name of the URL pattern that matches the URL. route ¶ The route of the matching URL pattern. For example, if path('users/<id>/', ...) is the matching pattern, route will contain 'users/<id>/' . tried ¶ The list of URL patterns tried before the URL either matched one or\nexhausted available patterns. app_name ¶ The application namespace for the URL pattern that matches the\nURL. app_names ¶ The list of individual namespace components in the full\napplication namespace for the URL pattern that matches the URL.\nFor example, if the app_name is 'foo:bar' , then app_names will be ['foo', 'bar'] . namespace ¶ The instance namespace for the URL pattern that matches the\nURL. namespaces ¶ The list of individual namespace components in the full\ninstance namespace for the URL pattern that matches the URL.\ni.e., if the namespace is foo:bar , then namespaces will be ['foo', 'bar'] . view_name ¶ The name of the view that matches the URL, including the namespace if\nthere is one. A ResolverMatch object can then be interrogated to provide\ninformation about the URL pattern that matches a URL: # Resolve a URL match = resolve ( \"/some/path/\" ) # Print the URL pattern that matches the URL print ( match . url_name ) A ResolverMatch object can also be assigned to a triple: func , args , kwargs = resolve ( \"/some/path/\" ) One possible use of resolve() would be to test whether a\nview would raise a Http404 error before redirecting to it: from urllib.parse import urlparse from django.urls import resolve from django.http import Http404 , HttpResponseRedirect def myview ( request ): next = request . META . get ( \"HTTP_REFERER\" , None ) or \"/\" response = HttpResponseRedirect ( next ) # modify the request and response as required, e.g. change locale # and set corresponding locale cookie view , args , kwargs = resolve ( urlparse ( next )[ 2 ]) kwargs [ \"request\" ] = request try : view ( * args , ** kwargs ) except Http404 : return HttpResponseRedirect ( \"/\" ) return response get_script_prefix() ¶ get_script_prefix () [source] ¶ Normally, you should always use reverse() to define URLs\nwithin your application. However, if your application constructs part of the\nURL hierarchy itself, you may occasionally need to generate URLs. In that\ncase, you need to be able to find the base URL of the Django project within\nits web server (normally, reverse() takes care of this for\nyou). In that case, you can call get_script_prefix() , which will return\nthe script prefix portion of the URL for your Django project. If your Django\nproject is at the root of its web server, this is always \"/\" . Warning This function cannot be used outside of the request-response cycle\nsince it relies on values initialized during that cycle.", "keywords": ["function", "views", "view", "pattern", "url", "error", "module", "code", "values", "resolvermatch", "string", "class", "example", "care", "#", "func", "list", "get_script_prefix", "archive", "app_list", "metadata", "login_url", "normally", "request", "resolver", "route", "output", "*", "match", "version", "captured_kwargs", "subclass", "django.urls", "admin", "application", "encoding", "namespace", "http404", "noreversematch", "portion", "django", "=", "script", "results", "print", "cities", "summary", "thread", "urlconf", "variety", "urlparse", "character", "restriction", "value", "tag", "source", "hierarchy", "case", "users/<id>/", "use", "server", "arguments", "following", "triple", "paths", "instance", "kwargs", "app_names", "myview", "matching", "resolve", "signature", "default", "bar", "strategy", "|", "path", "choices", "cases", "urllib.parse.quote", "functions", "attribute", "prefix", "none", "args", "expression", "decorator", "meta", "path('users/<id>/", "time", "patterns", "current_app", "instances", "components", "urls", "app_label", "part", "hint", "object", "cycle", "import", "name", "template", "parameter", "response", "viewname", "namespaces", "utility", "way", "extra_kwargs", "orléans", "information", "web", "keyword", "exception", "resolution", "reversal", "root", "argument", "¶", "return", "news", "reverse", "cookie", "http_referer", "foo", "app_name", "moment", "project"], "type": "documentation"},
{"title": "The contenttypes framework | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/contenttypes/", "content": "The contenttypes framework ¶ Django includes a contenttypes application that can\ntrack all of the models installed in your Django-powered project, providing a\nhigh-level, generic interface for working with your models. Overview ¶ At the heart of the contenttypes application is the ContentType model, which lives at django.contrib.contenttypes.models.ContentType . Instances of ContentType represent and store\ninformation about the models installed in your project, and new instances of ContentType are automatically\ncreated whenever new models are installed. Instances of ContentType have\nmethods for returning the model classes they represent and for querying objects\nfrom those models. ContentType also has a custom manager that adds methods for\nworking with ContentType and for\nobtaining instances of ContentType for a particular model. Relations between your models and ContentType can also be used to\nenable “generic” relationships between an instance of one of your\nmodels and instances of any model you have installed. Installing the contenttypes framework ¶ The contenttypes framework is included in the default INSTALLED_APPS list created by django-admin startproject ,\nbut if you’ve removed it or if you manually set up your INSTALLED_APPS list, you can enable it by adding 'django.contrib.contenttypes' to your INSTALLED_APPS setting. It’s generally a good idea to have the contenttypes framework\ninstalled; several of Django’s other bundled applications require it: The admin application uses it to log the history of each object\nadded or changed through the admin interface. Django’s authentication framework uses it\nto tie user permissions to specific models. The ContentType model ¶ class ContentType [source] ¶ Each instance of ContentType has two fields which, taken together, uniquely describe an installed\nmodel: app_label ¶ The name of the application the model is part of. This is taken from\nthe app_label attribute of the model, and includes only the last part of the application’s Python import path; django.contrib.contenttypes , for example, becomes an app_label of contenttypes . model ¶ The name of the model class. Additionally, the following property is available: name [source] ¶ The human-readable name of the content type. This is taken from the verbose_name attribute of the model. Let’s look at an example to see how this works. If you already have\nthe contenttypes application installed, and then add the sites application to your INSTALLED_APPS setting and run manage.py migrate to install it,\nthe model django.contrib.sites.models.Site will be installed into\nyour database. Along with it a new instance of ContentType will be\ncreated with the following values: app_label will be set to 'sites' (the last part of the Python\npath django.contrib.sites ). model will be set to 'site' . Methods on ContentType instances ¶ Each ContentType instance has\nmethods that allow you to get from a ContentType instance to the\nmodel it represents, or to retrieve objects from that model: ContentType. get_object_for_this_type ( using = None , ** kwargs ) [source] ¶ Takes a set of valid lookup arguments for the\nmodel the ContentType represents, and does a get() lookup on that model, returning the corresponding object. The using argument\ncan be used to specify a different database than the default one. Changed in Django 5.1: The using argument was added. ContentType. model_class () [source] ¶ Returns the model class represented by this ContentType instance. For example, we could look up the ContentType for the User model: >>> from django.contrib.contenttypes.models import ContentType >>> user_type = ContentType . objects . get ( app_label = \"auth\" , model = \"user\" ) >>> user_type <ContentType: user> And then use it to query for a particular User , or to get access\nto the User model class: >>> user_type . model_class () <class 'django.contrib.auth.models.User'> >>> user_type . get_object_for_this_type ( username = \"Guido\" ) <User: Guido> Together, get_object_for_this_type() and model_class() enable\ntwo extremely important use cases: Using these methods, you can write high-level generic code that\nperforms queries on any installed model – instead of importing and\nusing a single specific model class, you can pass an app_label and model into a ContentType lookup at\nruntime, and then work with the model class or retrieve objects from it. You can relate another model to ContentType as a way of\ntying instances of it to particular model classes, and use these methods\nto get access to those model classes. Several of Django’s bundled applications make use of the latter technique.\nFor example, the permissions system in\nDjango’s authentication framework uses a Permission model with a foreign\nkey to ContentType ; this lets Permission represent concepts like\n“can add blog entry” or “can delete news story”. The ContentTypeManager ¶ class ContentTypeManager [source] ¶ ContentType also has a custom\nmanager, ContentTypeManager ,\nwhich adds the following methods: clear_cache () [source] ¶ Clears an internal cache used by ContentType to keep track\nof models for which it has created ContentType instances. You\nprobably won’t ever need to call this method yourself; Django will call\nit automatically when it’s needed. get_for_id ( id ) [source] ¶ Lookup a ContentType by ID.\nSince this method uses the same shared cache as get_for_model() ,\nit’s preferred to use this method over the usual ContentType.objects.get(pk=id) get_for_model ( model , for_concrete_model = True ) [source] ¶ Takes either a model class or an instance of a model, and returns the ContentType instance\nrepresenting that model. for_concrete_model=False allows fetching\nthe ContentType of a proxy\nmodel. get_for_models ( * models , for_concrete_models = True ) [source] ¶ Takes a variadic number of model classes, and returns a dictionary\nmapping the model classes to the ContentType instances\nrepresenting them. for_concrete_models=False allows fetching the ContentType of proxy\nmodels. get_by_natural_key ( app_label , model ) [source] ¶ Returns the ContentType instance uniquely identified by the given application label and model\nname. The primary purpose of this method is to allow ContentType objects to be\nreferenced via a natural key during deserialization. The get_for_model() method is especially\nuseful when you know you need to work with a ContentType but don’t\nwant to go to the trouble of obtaining the model’s metadata to perform a manual\nlookup: >>> from django.contrib.auth.models import User >>> ContentType . objects . get_for_model ( User ) <ContentType: user> Generic relations ¶ Adding a foreign key from one of your own models to ContentType allows your model to\neffectively tie itself to another model class, as in the example of the Permission model above. But it’s possible\nto go one step further and use ContentType to enable truly\ngeneric (sometimes called “polymorphic”) relationships between models. For example, it could be used for a tagging system like so: from django.contrib.contenttypes.fields import GenericForeignKey from django.contrib.contenttypes.models import ContentType from django.db import models class TaggedItem ( models . Model ): tag = models . SlugField () content_type = models . ForeignKey ( ContentType , on_delete = models . CASCADE ) object_id = models . PositiveIntegerField () content_object = GenericForeignKey ( \"content_type\" , \"object_id\" ) def __str__ ( self ): return self . tag class Meta : indexes = [ models . Index ( fields = [ \"content_type\" , \"object_id\" ]), ] A normal ForeignKey can only “point\nto” one other model, which means that if the TaggedItem model used a ForeignKey it would have to\nchoose one and only one model to store tags for. The contenttypes\napplication provides a special field type ( GenericForeignKey ) which\nworks around this and allows the relationship to be with any\nmodel: class GenericForeignKey [source] ¶ There are three parts to setting up a GenericForeignKey : Give your model a ForeignKey to ContentType . The usual\nname for this field is “content_type”. Give your model a field that can store primary key values from the\nmodels you’ll be relating to. For most models, this means a PositiveIntegerField . The usual name\nfor this field is “object_id”. Give your model a GenericForeignKey , and\npass it the names of the two fields described above. If these fields\nare named “content_type” and “object_id”, you can omit this – those\nare the default field names GenericForeignKey will\nlook for. Unlike for the ForeignKey , a database index is not automatically created on the GenericForeignKey , so it’s\nrecommended that you use Meta.indexes to add your own\nmultiple column index. This behavior may change in the\nfuture. for_concrete_model ¶ If False , the field will be able to reference proxy models. Default\nis True . This mirrors the for_concrete_model argument to get_for_model() . Primary key type compatibility The “object_id” field doesn’t have to be the same type as the\nprimary key fields on the related models, but their primary key values\nmust be coercible to the same type as the “object_id” field by its get_db_prep_value() method. For example, if you want to allow generic relations to models with either IntegerField or CharField primary key fields, you\ncan use CharField for the\n“object_id” field on your model since integers can be coerced to\nstrings by get_db_prep_value() . For maximum flexibility you can use a TextField which doesn’t have a\nmaximum length defined, however this may incur significant performance\npenalties depending on your database backend. There is no one-size-fits-all solution for which field type is best. You\nshould evaluate the models you expect to be pointing to and determine\nwhich solution will be most effective for your use case. Serializing references to ContentType objects If you’re serializing data (for example, when generating fixtures ) from a model that implements\ngeneric relations, you should probably be using a natural key to uniquely\nidentify related ContentType objects. See natural keys and dumpdata --natural-foreign for more information. This will enable an API similar to the one used for a normal ForeignKey ;\neach TaggedItem will have a content_object field that returns the\nobject it’s related to, and you can also assign to that field or use it when\ncreating a TaggedItem : >>> from django.contrib.auth.models import User >>> guido = User . objects . get ( username = \"Guido\" ) >>> t = TaggedItem ( content_object = guido , tag = \"bdfl\" ) >>> t . save () >>> t . content_object <User: Guido> If the related object is deleted, the content_type and object_id fields\nremain set to their original values and the GenericForeignKey returns None : >>> guido . delete () >>> t . content_object # returns None Due to the way GenericForeignKey is implemented, you cannot use such fields directly with filters ( filter() and exclude() , for example) via the database API. Because a GenericForeignKey isn’t a\nnormal field object, these examples will not work: # This will fail >>> TaggedItem . objects . filter ( content_object = guido ) # This will also fail >>> TaggedItem . objects . get ( content_object = guido ) Likewise, GenericForeignKey s\ndoes not appear in ModelForm s. Reverse generic relations ¶ class GenericRelation [source] ¶ related_query_name ¶ The relation on the related object back to this object doesn’t exist by\ndefault. Setting related_query_name creates a relation from the\nrelated object back to this one. This allows querying and filtering\nfrom the related object. If you know which models you’ll be using most often, you can also add\na “reverse” generic relationship to enable an additional API. For example: from django.contrib.contenttypes.fields import GenericRelation from django.db import models class Bookmark ( models . Model ): url = models . URLField () tags = GenericRelation ( TaggedItem ) Bookmark instances will each have a tags attribute, which can\nbe used to retrieve their associated TaggedItems : >>> b = Bookmark ( url = \"https://www.djangoproject.com/\" ) >>> b . save () >>> t1 = TaggedItem ( content_object = b , tag = \"django\" ) >>> t1 . save () >>> t2 = TaggedItem ( content_object = b , tag = \"python\" ) >>> t2 . save () >>> b . tags . all () <QuerySet [<TaggedItem: django>, <TaggedItem: python>]> You can also use add() , create() , or set() to create\nrelationships: >>> t3 = TaggedItem ( tag = \"Web development\" ) >>> b . tags . add ( t3 , bulk = False ) >>> b . tags . create ( tag = \"Web framework\" ) <TaggedItem: Web framework> >>> b . tags . all () <QuerySet [<TaggedItem: django>, <TaggedItem: python>, <TaggedItem: Web development>, <TaggedItem: Web framework>]> >>> b . tags . set ([ t1 , t3 ]) >>> b . tags . all () <QuerySet [<TaggedItem: django>, <TaggedItem: Web development>]> The remove() call will bulk delete the specified model objects: >>> b . tags . remove ( t3 ) >>> b . tags . all () <QuerySet [<TaggedItem: django>]> >>> TaggedItem . objects . all () <QuerySet [<TaggedItem: django>]> The clear() method can be used to bulk delete all related objects for an\ninstance: >>> b . tags . clear () >>> b . tags . all () <QuerySet []> >>> TaggedItem . objects . all () <QuerySet []> Defining GenericRelation with related_query_name set allows querying from the related object: tags = GenericRelation ( TaggedItem , related_query_name = \"bookmark\" ) This enables filtering, ordering, and other query operations on Bookmark from TaggedItem : >>> # Get all tags belonging to bookmarks containing `django` in the url >>> TaggedItem . objects . filter ( bookmark__url__contains = \"django\" ) <QuerySet [<TaggedItem: django>, <TaggedItem: python>]> If you don’t add the related_query_name , you can do the same types of\nlookups manually: >>> bookmarks = Bookmark . objects . filter ( url__contains = \"django\" ) >>> bookmark_type = ContentType . objects . get_for_model ( Bookmark ) >>> TaggedItem . objects . filter ( content_type__pk = bookmark_type . id , object_id__in = bookmarks ) <QuerySet [<TaggedItem: django>, <TaggedItem: python>]> Just as GenericForeignKey accepts the names of the content-type and object-ID fields as\narguments, so too does GenericRelation ;\nif the model which has the generic foreign key is using non-default names\nfor those fields, you must pass the names of the fields when setting up a GenericRelation to it. For example, if the TaggedItem model\nreferred to above used fields named content_type_fk and object_primary_key to create its generic foreign key, then a GenericRelation back to it would need to be defined like so: tags = GenericRelation ( TaggedItem , content_type_field = \"content_type_fk\" , object_id_field = \"object_primary_key\" , ) Note also, that if you delete an object that has a GenericRelation , any objects\nwhich have a GenericForeignKey pointing at it will be deleted as well. In the example above, this means that\nif a Bookmark object were deleted, any TaggedItem objects pointing at\nit would be deleted at the same time. Unlike ForeignKey , GenericForeignKey does not accept\nan on_delete argument to customize this\nbehavior; if desired, you can avoid the cascade-deletion by not using GenericRelation , and alternate\nbehavior can be provided via the pre_delete signal. Generic relations and aggregation ¶ Django’s database aggregation API works with a GenericRelation . For example, you\ncan find out how many tags all the bookmarks have: >>> Bookmark . objects . aggregate ( Count ( \"tags\" )) {'tags__count': 3} Generic relation in forms ¶ The django.contrib.contenttypes.forms module provides: BaseGenericInlineFormSet A formset factory, generic_inlineformset_factory() , for use with GenericForeignKey . class BaseGenericInlineFormSet [source] ¶ generic_inlineformset_factory ( model , form = ModelForm , formset = BaseGenericInlineFormSet , ct_field = 'content_type' , fk_field = 'object_id' , fields = None , exclude = None , extra = 3 , can_order = False , can_delete = True , max_num = None , formfield_callback = None , validate_max = False , for_concrete_model = True , min_num = None , validate_min = False , absolute_max = None , can_delete_extra = True ) [source] ¶ Returns a GenericInlineFormSet using modelformset_factory() . You must provide ct_field and fk_field if they are different from\nthe defaults, content_type and object_id respectively. Other\nparameters are similar to those documented in modelformset_factory() and inlineformset_factory() . The for_concrete_model argument corresponds to the for_concrete_model argument on GenericForeignKey . Generic relations in admin ¶ The django.contrib.contenttypes.admin module provides GenericTabularInline and GenericStackedInline (subclasses of GenericInlineModelAdmin ) These classes and functions enable the use of generic relations in forms\nand the admin. See the model formset and admin documentation for more\ninformation. class GenericInlineModelAdmin [source] ¶ The GenericInlineModelAdmin class inherits all properties from an InlineModelAdmin class. However,\nit adds a couple of its own for working with the generic relation: ct_field ¶ The name of the ContentType foreign key\nfield on the model. Defaults to content_type . ct_fk_field ¶ The name of the integer field that represents the ID of the related\nobject. Defaults to object_id . class GenericTabularInline [source] ¶ class GenericStackedInline [source] ¶ Subclasses of GenericInlineModelAdmin with stacked and tabular\nlayouts, respectively. GenericPrefetch() ¶ New in Django 5.0. class GenericPrefetch ( lookup , querysets , to_attr = None ) [source] ¶ This lookup is similar to Prefetch() and it should only be used on GenericForeignKey . The querysets argument accepts a list of querysets,\neach for a different ContentType . This is useful for GenericForeignKey with non-homogeneous set of results. >>> from django.contrib.contenttypes.prefetch import GenericPrefetch >>> bookmark = Bookmark . objects . create ( url = \"https://www.djangoproject.com/\" ) >>> animal = Animal . objects . create ( name = \"lion\" , weight = 100 ) >>> TaggedItem . objects . create ( tag = \"great\" , content_object = bookmark ) >>> TaggedItem . objects . create ( tag = \"awesome\" , content_object = animal ) >>> prefetch = GenericPrefetch ( ... \"content_object\" , [ Bookmark . objects . all (), Animal . objects . only ( \"name\" )] ... ) >>> TaggedItem . objects . prefetch_related ( prefetch ) . all () <QuerySet [<TaggedItem: Great>, <TaggedItem: Awesome>]>", "keywords": ["examples", "get_object_for_this_type", "ct_fk_field", "s.", "integerfield", "username", "indexes", "relationships", "number", "formset", "proxy", "relations", "permissions", "modelform", "url", "b", "module", "code", "site", "values", "forms", "auth", "deserialization", "bulk", "generic", "filter", "false", "behavior", "access", "class", "example", "i", "field", "#", "relation", "overview", "column", "list", "mapping", "returns", "names", "metadata", "genericstackedinline", "retrieve", "taggeditems", "trouble", "verbose_name", "database", "get_for_models", "https://www.djangoproject.com/", "animal", "signal", "*", "models", "history", "get_for_id", "query", "querysets", "genericinlineformset", "cache", "compatibility", "migrate", "level", "types", "count", "strings", "model", "modelformset_factory", "idea", "admin", "great", "application", "inlineformset_factory", "django.contrib.auth.models", "get_by_natural_key", "urlfield", "label", "django", "slugfield", "=", "django.contrib.contenttypes.models", "n’t", "step", "results", "fields", "object_id_field", "generic_inlineformset_factory", "entry", "dumpdata", "formfield_callback", "django.contrib.sites", "set", "relationship", "development", "url__contains", "track", "flexibility", "genericrelation", "ct_field", "django.contrib.contenttypes.fields", "pointing", "weight", "tag", "source", "content_type", "contenttype", "concepts", "genericforeignkey", "case", "keys", "length", "data", "authentication", "lookup", "tagging", "related_query_name", "use", "technique", "runtime", "backend", "contenttypemanager", "future", "bookmark__url__contains", "str", "factory", "arguments", "add", "guido", "type", "solution", "subclasses", "self", "clears", "custom", "instance", "kwargs", "objects", "performance", "one", "lookups", "absolute_max", "t1", "genericinlinemodeladmin", "documentation", "prefetch", "content_object", "aggregation", "represent", "startproject", "delete", "genericprefetch", "interface", "for_concrete_models", "taggeditem", "default", "bookmarks", "user", "clear_cache", "contenttypes", "path", "cases", "lion", "functions", "key", "awesome", "operations", "form", "heart", "attribute", "basegenericinlineformset", "none", "properties", "filters", "classes", "object_id", "size", "content_type_field", "meta", "time", "bookmark_type", "tags", "layouts", "framework", "save", "inlinemodeladmin", "new", "instances", "story", "to_attr", "app_label", "installed_apps", "part", "fixtures", "api", "references", "object", "for_concrete_model", "max_num", "couple", "get_for_model", "permission", "bookmark", "import", "name", "cascade", "d", "charfield", "penalties", "bdfl", "fk_field", "t2", "user_type", ">", "defaults", "call", "foreignkey", "way", "object_id__in", "information", "web", "python", "model_class", "methods", "meta.indexes", "s", "queries", "min_num", "index", "t", "purpose", "t3", "get_db_prep_value", "ordering", "manager", "method", "queryset", "integer", "clear", "argument", "¶", "news", "id", "deletion", "applications", "sites", "remove", "django.contrib.contenttypes.forms", "parameters", "generictabularinline", "django.contrib.contenttypes", "system", "integers", "property", "django.contrib.contenttypes.prefetch", "contenttype.objects.get(pk", "textfield", "can_delete", "positiveintegerfield", "blog", "filtering", "content", "project", "parts"], "type": "documentation"},
{"title": "The Django template language: for Python programmers | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/templates/api/", "content": "The Django template language: for Python programmers ¶ This document explains the Django template system from a technical\nperspective – how it works and how to extend it. If you’re looking for\nreference on the language syntax, see The Django template language . It assumes an understanding of templates, contexts, variables, tags, and\nrendering. Start with the introduction to the Django template language if you aren’t familiar with these concepts. Overview ¶ Using the template system in Python is a three-step process: You configure an Engine . You compile template code into a Template . You render the template with a Context . Django projects generally rely on the high level, backend agnostic APIs for each of these steps instead of the template system’s\nlower level APIs: For each DjangoTemplates backend\nin the TEMPLATES setting, Django instantiates an Engine . DjangoTemplates wraps Engine and adapts it to the common template backend API. The django.template.loader module provides functions such as get_template() for loading templates. They\nreturn a django.template.backends.django.Template which wraps the\nactual django.template.Template . The Template obtained in the previous step has a render() method which\nmarshals a context and possibly a request into a Context and\ndelegates the rendering to the underlying Template . Configuring an engine ¶ If you are using the DjangoTemplates backend, this probably isn’t the documentation you’re looking for. An instance\nof the Engine class described below is accessible using the engine attribute of that backend and any attribute defaults mentioned below are\noverridden by what’s passed by DjangoTemplates . class Engine ( dirs = None , app_dirs = False , context_processors = None , debug = False , loaders = None , string_if_invalid = '' , file_charset = 'utf-8' , libraries = None , builtins = None , autoescape = True ) [source] ¶ When instantiating an Engine all arguments must be passed as keyword\narguments: dirs is a list of directories where the engine should look for\ntemplate source files. It is used to configure filesystem.Loader . It defaults to an empty list. app_dirs only affects the default value of loaders . See below. It defaults to False . autoescape controls whether HTML autoescaping is enabled. It defaults to True . Warning Only set it to False if you’re rendering non-HTML templates! context_processors is a list of dotted Python paths to callables\nthat are used to populate the context when a template is rendered with a\nrequest. These callables take a request object as their argument and\nreturn a dict of items to be merged into the context. It defaults to an empty list. See RequestContext for more information. debug is a boolean that turns on/off template debug mode. If it is True , the template engine will store additional debug information\nwhich can be used to display a detailed report for any exception raised\nduring template rendering. It defaults to False . loaders is a list of template loader classes, specified as strings.\nEach Loader class knows how to import templates from a particular\nsource. Optionally, a tuple can be used instead of a string. The first\nitem in the tuple should be the Loader class name, subsequent items\nare passed to the Loader during initialization. It defaults to a list containing: 'django.template.loaders.filesystem.Loader' 'django.template.loaders.app_directories.Loader' if and only if app_dirs is True . These loaders are then wrapped in django.template.loaders.cached.Loader . See Loader types for details. string_if_invalid is the output, as a string, that the template\nsystem should use for invalid (e.g. misspelled) variables. It defaults to the empty string. See How invalid variables are handled for details. file_charset is the charset used to read template files on disk. It defaults to 'utf-8' . 'libraries' : A dictionary of labels and dotted Python paths of template\ntag modules to register with the template engine. This is used to add new\nlibraries or provide alternate labels for existing ones. For example: Engine ( libraries = { \"myapp_tags\" : \"path.to.myapp.tags\" , \"admin.urls\" : \"django.contrib.admin.templatetags.admin_urls\" , }, ) Libraries can be loaded by passing the corresponding dictionary key to\nthe {% load %} tag. 'builtins' : A list of dotted Python paths of template tag modules to\nadd to built-ins . For example: Engine ( builtins = [ \"myapp.builtins\" ], ) Tags and filters from built-in libraries can be used without first calling\nthe {% load %} tag. static Engine. get_default () [source] ¶ Returns the underlying Engine from the first configured DjangoTemplates engine. Raises ImproperlyConfigured if no engines are\nconfigured. It’s required for preserving APIs that rely on a globally available,\nimplicitly configured engine. Any other use is strongly discouraged. Engine. from_string ( template_code ) [source] ¶ Compiles the given template code and returns a Template object. Engine. get_template ( template_name ) [source] ¶ Loads a template with the given name, compiles it and returns a Template object. Engine. select_template ( template_name_list ) [source] ¶ Like get_template() , except it takes a list of names\nand returns the first template that was found. Loading a template ¶ The recommended way to create a Template is by calling the factory\nmethods of the Engine : get_template() , select_template() and from_string() . In a Django project where the TEMPLATES setting defines a DjangoTemplates engine, it’s\npossible to instantiate a Template directly. If more than one DjangoTemplates engine is defined,\nthe first one will be used. class Template [source] ¶ This class lives at django.template.Template . The constructor takes\none argument — the raw template code: from django.template import Template template = Template ( \"My name is {{ my_name }}.\" ) Behind the scenes The system only parses your raw template code once – when you create the Template object. From then on, it’s stored internally as a tree\nstructure for performance. Even the parsing itself is quite fast. Most of the parsing happens via a\nsingle call to a single, short, regular expression. Rendering a context ¶ Once you have a compiled Template object, you can render a context\nwith it. You can reuse the same template to render it several times with\ndifferent contexts. class Context ( dict_ = None , autoescape = True , use_l10n = None , use_tz = None ) [source] ¶ The constructor of django.template.Context takes an optional argument —\na dictionary mapping variable names to variable values. Three optional keyword arguments can also be specified: autoescape controls whether HTML autoescaping is enabled. It defaults to True . Warning Only set it to False if you’re rendering non-HTML templates! use_l10n overrides whether values will be localized by default. If\nset to True numbers and dates will be formatted based on locale. It defaults to None . See Controlling localization in templates for details. use_tz overrides whether dates are converted to the local time when\nrendered in a template. If set to True all dates will be rendered\nusing the local timezone. This takes precedence over USE_TZ . It defaults to None . See Time zone aware output in templates for details. For example usage, see Playing with Context objects below. Template. render ( context ) [source] ¶ Call the Template object’s render() method with a Context to “fill” the template: >>> from django.template import Context , Template >>> template = Template ( \"My name is {{ my_name }}.\" ) >>> context = Context ({ \"my_name\" : \"Adrian\" }) >>> template . render ( context ) \"My name is Adrian.\" >>> context = Context ({ \"my_name\" : \"Dolores\" }) >>> template . render ( context ) \"My name is Dolores.\" Variables and lookups ¶ Variable names must consist of any letter (A-Z), any digit (0-9), an underscore\n(but they must not start with an underscore) or a dot. Dots have a special meaning in template rendering. A dot in a variable name\nsignifies a lookup . Specifically, when the template system encounters a\ndot in a variable name, it tries the following lookups, in this order: Dictionary lookup. Example: foo[\"bar\"] Attribute lookup. Example: foo.bar List-index lookup. Example: foo[bar] Note that “bar” in a template expression like {{ foo.bar }} will be\ninterpreted as a literal string and not using the value of the variable “bar”,\nif one exists in the template context. The template system uses the first lookup type that works. It’s short-circuit\nlogic. Here are a few examples: >>> from django.template import Context , Template >>> t = Template ( \"My name is {{ person.first_name }}.\" ) >>> d = { \"person\" : { \"first_name\" : \"Joe\" , \"last_name\" : \"Johnson\" }} >>> t . render ( Context ( d )) \"My name is Joe.\" >>> class PersonClass : ... pass ... >>> p = PersonClass () >>> p . first_name = \"Ron\" >>> p . last_name = \"Nasty\" >>> t . render ( Context ({ \"person\" : p })) \"My name is Ron.\" >>> t = Template ( \"The first stooge in the list is {{ stooges.0 }}.\" ) >>> c = Context ({ \"stooges\" : [ \"Larry\" , \"Curly\" , \"Moe\" ]}) >>> t . render ( c ) \"The first stooge in the list is Larry.\" If any part of the variable is callable, the template system will try calling\nit. Example: >>> class PersonClass2 : ... def name ( self ): ... return \"Samantha\" ... >>> t = Template ( \"My name is {{ person.name }}.\" ) >>> t . render ( Context ({ \"person\" : PersonClass2 })) \"My name is Samantha.\" Callable variables are slightly more complex than variables which only require\nstraight lookups. Here are some things to keep in mind: If the variable raises an exception when called, the exception will be\npropagated, unless the exception has an attribute silent_variable_failure whose value is True . If the exception does have a silent_variable_failure attribute whose value is True , the variable will render as the value of the engine’s string_if_invalid configuration option (an empty string, by default).\nExample: >>> t = Template ( \"My name is {{ person.first_name }}.\" ) >>> class PersonClass3 : ... def first_name ( self ): ... raise AssertionError ( \"foo\" ) ... >>> p = PersonClass3 () >>> t . render ( Context ({ \"person\" : p })) Traceback (most recent call last): ... AssertionError : foo >>> class SilentAssertionError ( Exception ): ... silent_variable_failure = True ... >>> class PersonClass4 : ... def first_name ( self ): ... raise SilentAssertionError ... >>> p = PersonClass4 () >>> t . render ( Context ({ \"person\" : p })) \"My name is .\" Note that django.core.exceptions.ObjectDoesNotExist , which is the\nbase class for all Django database API DoesNotExist exceptions, has silent_variable_failure = True . So if you’re using Django templates\nwith Django model objects, any DoesNotExist exception will fail\nsilently. A variable can only be called if it has no required arguments. Otherwise,\nthe system will return the value of the engine’s string_if_invalid option. There can be side effects when calling some variables, and it’d be either\nfoolish or a security hole to allow the template system to access them. A good example is the delete() method on\neach Django model object. The template system shouldn’t be allowed to do\nsomething like this: I will now delete this valuable data. {{ data.delete }} To prevent this, set an alters_data attribute on the callable\nvariable. The template system won’t call a variable if it has alters_data=True set, and will instead replace the variable with string_if_invalid , unconditionally.  The\ndynamically-generated delete() and save() methods on Django model objects get alters_data=True automatically. Example: def sensitive_function ( self ): self . database_record . delete () sensitive_function . alters_data = True Occasionally you may want to turn off this feature for other reasons,\nand tell the template system to leave a variable uncalled no matter\nwhat.  To do so, set a do_not_call_in_templates attribute on the\ncallable with the value True .  The template system then will act as\nif your variable is not callable (allowing you to access attributes of\nthe callable, for example). How invalid variables are handled ¶ Generally, if a variable doesn’t exist, the template system inserts the value\nof the engine’s string_if_invalid configuration option, which is set to '' (the empty string) by default. Filters that are applied to an invalid variable will only be applied if string_if_invalid is set to '' (the empty string). If string_if_invalid is set to any other value, variable filters will be\nignored. This behavior is slightly different for the if , for and regroup template tags. If an invalid variable is provided to one of these template\ntags, the variable will be interpreted as None . Filters are always\napplied to invalid variables within these template tags. If string_if_invalid contains a '%s' , the format marker will be\nreplaced with the name of the invalid variable. For debug purposes only! While string_if_invalid can be a useful debugging tool, it is a bad\nidea to turn it on as a ‘development default’. Many templates, including some of Django’s, rely upon the silence of the\ntemplate system when a nonexistent variable is encountered. If you assign a\nvalue other than '' to string_if_invalid , you will experience\nrendering problems with these templates and sites. Generally, string_if_invalid should only be enabled in order to debug\na specific template problem, then cleared once debugging is complete. Built-in variables ¶ Every context contains True , False and None . As you would expect,\nthese variables resolve to the corresponding Python objects. Limitations with string literals ¶ Django’s template language has no way to escape the characters used for its own\nsyntax. For example, the templatetag tag is required if you need to\noutput character sequences like {% and %} . A similar issue exists if you want to include these sequences in template filter\nor tag arguments. For example, when parsing a block tag, Django’s template\nparser looks for the first occurrence of %} after a {% . This prevents\nthe use of \"%}\" as a string literal. For example, a TemplateSyntaxError will be raised for the following expressions: {% include \"template.html\" tvar = \"Some string literal with %} in it.\" %} {% with tvar = \"Some string literal with %} in it.\" %}{% endwith %} The same issue can be triggered by using a reserved sequence in filter\narguments: {{ some.variable | default :\"}}\" }} If you need to use strings with these sequences, store them in template\nvariables or use a custom template tag or filter to workaround the limitation. Playing with Context objects ¶ Most of the time, you’ll instantiate Context objects by passing in a\nfully-populated dictionary to Context() . But you can add and delete items\nfrom a Context object once it’s been instantiated, too, using standard\ndictionary syntax: >>> from django.template import Context >>> c = Context ({ \"foo\" : \"bar\" }) >>> c [ \"foo\" ] 'bar' >>> del c [ \"foo\" ] >>> c [ \"foo\" ] Traceback (most recent call last): ... KeyError : 'foo' >>> c [ \"newvariable\" ] = \"hello\" >>> c [ \"newvariable\" ] 'hello' Context. get ( key , otherwise = None ) ¶ Returns the value for key if key is in the context, else returns otherwise . Context. setdefault ( key , default = None ) ¶ If key is in the context, returns its value. Otherwise inserts key with a value of default and returns default . Context. pop () ¶ Context. push () ¶ exception ContextPopException [source] ¶ A Context object is a stack. That is, you can push() and pop() it.\nIf you pop() too much, it’ll raise django.template.ContextPopException : >>> c = Context () >>> c [ \"foo\" ] = \"first level\" >>> c . push () {} >>> c [ \"foo\" ] = \"second level\" >>> c [ \"foo\" ] 'second level' >>> c . pop () {'foo': 'second level'} >>> c [ \"foo\" ] 'first level' >>> c [ \"foo\" ] = \"overwritten\" >>> c [ \"foo\" ] 'overwritten' >>> c . pop () Traceback (most recent call last): ... ContextPopException You can also use push() as a context manager to ensure a matching pop() is called. >>> c = Context () >>> c [ \"foo\" ] = \"first level\" >>> with c . push (): ... c [ \"foo\" ] = \"second level\" ... c [ \"foo\" ] ... 'second level' >>> c [ \"foo\" ] 'first level' All arguments passed to push() will be passed to the dict constructor\nused to build the new context level. >>> c = Context () >>> c [ \"foo\" ] = \"first level\" >>> with c . push ( foo = \"second level\" ): ... c [ \"foo\" ] ... 'second level' >>> c [ \"foo\" ] 'first level' Context. update ( other_dict ) [source] ¶ In addition to push() and pop() , the Context object also defines an update() method. This works like push() but takes a dictionary as an argument and pushes that dictionary onto\nthe stack instead of an empty one. >>> c = Context () >>> c [ \"foo\" ] = \"first level\" >>> c . update ({ \"foo\" : \"updated\" }) {'foo': 'updated'} >>> c [ \"foo\" ] 'updated' >>> c . pop () {'foo': 'updated'} >>> c [ \"foo\" ] 'first level' Like push() , you can use update() as a context manager to ensure a\nmatching pop() is called. >>> c = Context () >>> c [ \"foo\" ] = \"first level\" >>> with c . update ({ \"foo\" : \"second level\" }): ... c [ \"foo\" ] ... 'second level' >>> c [ \"foo\" ] 'first level' Using a Context as a stack comes in handy in some custom template\ntags . Context. flatten () ¶ Using flatten() method you can get whole Context stack as one dictionary\nincluding builtin variables. >>> c = Context () >>> c [ \"foo\" ] = \"first level\" >>> c . update ({ \"bar\" : \"second level\" }) {'bar': 'second level'} >>> c . flatten () {'True': True, 'None': None, 'foo': 'first level', 'False': False, 'bar': 'second level'} A flatten() method is also internally used to make Context objects comparable. >>> c1 = Context () >>> c1 [ \"foo\" ] = \"first level\" >>> c1 [ \"bar\" ] = \"second level\" >>> c2 = Context () >>> c2 . update ({ \"bar\" : \"second level\" , \"foo\" : \"first level\" }) {'foo': 'first level', 'bar': 'second level'} >>> c1 == c2 True Result from flatten() can be useful in unit tests to compare Context against dict : class ContextTest ( unittest . TestCase ): def test_against_dictionary ( self ): c1 = Context () c1 [ \"update\" ] = \"value\" self . assertEqual ( c1 . flatten (), { \"True\" : True , \"None\" : None , \"False\" : False , \"update\" : \"value\" , }, ) Using RequestContext ¶ class RequestContext ( request , dict_ = None , processors = None , use_l10n = None , use_tz = None , autoescape = True ) [source] ¶ Django comes with a special Context class, django.template.RequestContext , that acts slightly differently from the\nnormal django.template.Context . The first difference is that it takes an HttpRequest as its first argument. For example: c = RequestContext ( request , { \"foo\" : \"bar\" , }, ) The second difference is that it automatically populates the context with a\nfew variables, according to the engine’s context_processors configuration\noption. The context_processors option is a list of callables – called context\nprocessors – that take a request object as their argument and return a\ndictionary of items to be merged into the context. In the default generated\nsettings file, the default template engine contains the following context\nprocessors: [ \"django.template.context_processors.debug\" , \"django.template.context_processors.request\" , \"django.contrib.auth.context_processors.auth\" , \"django.contrib.messages.context_processors.messages\" , ] In addition to these, RequestContext always enables 'django.template.context_processors.csrf' .  This is a security related\ncontext processor required by the admin and other contrib apps, and, in case\nof accidental misconfiguration, it is deliberately hardcoded in and cannot be\nturned off in the context_processors option. Each processor is applied in order. That means, if one processor adds a\nvariable to the context and a second processor adds a variable with the same\nname, the second will override the first. The default processors are explained\nbelow. When context processors are applied Context processors are applied on top of context data. This means that a\ncontext processor may overwrite variables you’ve supplied to your Context or RequestContext , so take care to avoid\nvariable names that overlap with those supplied by your context\nprocessors. If you want context data to take priority over context processors, use the\nfollowing pattern: from django.template import RequestContext request_context = RequestContext ( request ) request_context . push ({ \"my_name\" : \"Adrian\" }) Django does this to allow context data to override context processors in\nAPIs such as render() and TemplateResponse . Also, you can give RequestContext a list of additional processors,\nusing the optional, third positional argument, processors . In this\nexample, the RequestContext instance gets an ip_address variable: from django.http import HttpResponse from django.template import RequestContext , Template def ip_address_processor ( request ): return { \"ip_address\" : request . META [ \"REMOTE_ADDR\" ]} def client_ip_view ( request ): template = Template ( \"{{ title }}: {{ ip_address }}\" ) context = RequestContext ( request , { \"title\" : \"Your IP Address\" , }, [ ip_address_processor ], ) return HttpResponse ( template . render ( context )) Built-in template context processors ¶ Here’s what each of the built-in processors does: django.contrib.auth.context_processors.auth ¶ auth ( request ) [source] ¶ If this processor is enabled, every RequestContext will contain these\nvariables: user – An auth.User instance representing the currently\nlogged-in user (or an AnonymousUser instance, if the client isn’t\nlogged in). perms – An instance of django.contrib.auth.context_processors.PermWrapper , representing the\npermissions that the currently logged-in user has. django.template.context_processors.debug ¶ debug ( request ) [source] ¶ If this processor is enabled, every RequestContext will contain these two\nvariables – but only if your DEBUG setting is set to True and\nthe request’s IP address ( request.META['REMOTE_ADDR'] ) is in the INTERNAL_IPS setting: debug – True . You can use this in templates to test whether\nyou’re in DEBUG mode. sql_queries – A list of {'sql': ..., 'time': ...} dictionaries,\nrepresenting every SQL query that has happened so far during the request\nand how long it took. The list is in order by database alias and then by\nquery. It’s lazily generated on access. django.template.context_processors.i18n ¶ i18n ( request ) [source] ¶ If this processor is enabled, every RequestContext will contain these\nvariables: LANGUAGES – The value of the LANGUAGES setting. LANGUAGE_BIDI – True if the current language is a right-to-left\nlanguage, e.g. Hebrew, Arabic. False if it’s a left-to-right language,\ne.g. English, French, German. LANGUAGE_CODE – request.LANGUAGE_CODE , if it exists. Otherwise,\nthe value of the LANGUAGE_CODE setting. See i18n template tags for template tags that\ngenerate the same values. django.template.context_processors.media ¶ If this processor is enabled, every RequestContext will contain a variable MEDIA_URL , providing the value of the MEDIA_URL setting. django.template.context_processors.static ¶ static ( request ) [source] ¶ If this processor is enabled, every RequestContext will contain a variable STATIC_URL , providing the value of the STATIC_URL setting. django.template.context_processors.csrf ¶ This processor adds a token that is needed by the csrf_token template\ntag for protection against Cross Site Request Forgeries . django.template.context_processors.request ¶ If this processor is enabled, every RequestContext will contain a variable request , which is the current HttpRequest . django.template.context_processors.tz ¶ tz ( request ) [source] ¶ If this processor is enabled, every RequestContext will contain a variable TIME_ZONE , providing the name of the currently active time zone. django.contrib.messages.context_processors.messages ¶ If this processor is enabled, every RequestContext will contain these two\nvariables: messages – A list of messages (as strings) that have been set\nvia the messages framework . DEFAULT_MESSAGE_LEVELS – A mapping of the message level names to their numeric value . Writing your own context processors ¶ A context processor has a simple interface: It’s a Python function that takes\none argument, an HttpRequest object, and returns a\ndictionary that gets added to the template context. For example, to add the DEFAULT_FROM_EMAIL setting to every\ncontext: from django.conf import settings def from_email ( request ): return { \"DEFAULT_FROM_EMAIL\" : settings . DEFAULT_FROM_EMAIL , } Custom context processors can live anywhere in your code base. All Django\ncares about is that your custom context processors are pointed to by the 'context_processors' option in your TEMPLATES setting — or the context_processors argument of Engine if you’re\nusing it directly. Loading templates ¶ Generally, you’ll store templates in files on your filesystem rather than\nusing the low-level Template API yourself. Save\ntemplates in a directory specified as a template directory . Django searches for template directories in a number of places, depending on\nyour template loading settings (see “Loader types” below), but the most basic\nway of specifying template directories is by using the DIRS option. The DIRS option ¶ Tell Django what your template directories are by using the DIRS option in the TEMPLATES setting in your settings\nfile — or the dirs argument of Engine . This\nshould be set to a list of strings that contain full paths to your template\ndirectories: TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"DIRS\" : [ \"/home/html/templates/lawrence.com\" , \"/home/html/templates/default\" , ], }, ] Your templates can go anywhere you want, as long as the directories and\ntemplates are readable by the web server. They can have any extension you want,\nsuch as .html or .txt , or they can have no extension at all. Note that these paths should use Unix-style forward slashes, even on Windows. Loader types ¶ By default, Django uses a filesystem-based template loader, but Django comes\nwith a few other template loaders, which know how to load templates from other\nsources. Some of these other loaders are disabled by default, but you can activate them\nby adding a 'loaders' option to your DjangoTemplates backend in the TEMPLATES setting or passing a loaders argument to Engine . loaders should be a list of strings or\ntuples, where each represents a template loader class. Here are the template\nloaders that come with Django: django.template.loaders.filesystem.Loader class filesystem. Loader ¶ Loads templates from the filesystem, according to DIRS . This loader is enabled by default. However it won’t find any templates\nuntil you set DIRS to a non-empty list: TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"DIRS\" : [ BASE_DIR / \"templates\" ], } ] You can also override 'DIRS' and specify specific directories for a\nparticular filesystem loader: TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"OPTIONS\" : { \"loaders\" : [ ( \"django.template.loaders.filesystem.Loader\" , [ BASE_DIR / \"templates\" ], ), ], }, } ] django.template.loaders.app_directories.Loader class app_directories. Loader ¶ Loads templates from Django apps on the filesystem. For each app in INSTALLED_APPS , the loader looks for a templates subdirectory. If the directory exists, Django looks for templates in there. This means you can store templates with your individual apps. This also\nhelps to distribute Django apps with default templates. For example, for this setting: INSTALLED_APPS = [ \"myproject.polls\" , \"myproject.music\" ] …then get_template('foo.html') will look for foo.html in these\ndirectories, in this order: /path/to/myproject/polls/templates/ /path/to/myproject/music/templates/ … and will use the one it finds first. The order of INSTALLED_APPS is significant! For example, if you\nwant to customize the Django admin, you might choose to override the\nstandard admin/base_site.html template, from django.contrib.admin ,\nwith your own admin/base_site.html in myproject.polls . You must\nthen make sure that your myproject.polls comes before django.contrib.admin in INSTALLED_APPS , otherwise django.contrib.admin ’s will be loaded first and yours will be ignored. Note that the loader performs an optimization when it first runs:\nit caches a list of which INSTALLED_APPS packages have a templates subdirectory. You can enable this loader by setting APP_DIRS to True : TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"APP_DIRS\" : True , } ] django.template.loaders.cached.Loader class cached. Loader ¶ While the Django template system is quite fast, if it needs to read and\ncompile your templates every time they’re rendered, the overhead from that\ncan add up. You configure the cached template loader with a list of other loaders that\nit should wrap. The wrapped loaders are used to locate unknown templates\nwhen they’re first encountered. The cached loader then stores the compiled Template in memory. The cached Template instance is returned for\nsubsequent requests to load the same template. This loader is automatically enabled if OPTIONS['loaders'] isn’t specified. You can manually specify template caching with some custom template loaders\nusing settings like this: TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"DIRS\" : [ BASE_DIR / \"templates\" ], \"OPTIONS\" : { \"loaders\" : [ ( \"django.template.loaders.cached.Loader\" , [ \"django.template.loaders.filesystem.Loader\" , \"django.template.loaders.app_directories.Loader\" , \"path.to.custom.Loader\" , ], ), ], }, } ] Note All of the built-in Django template tags are safe to use with the\ncached loader, but if you’re using custom template tags that come from\nthird party packages, or that you wrote yourself, you should ensure\nthat the Node implementation for each tag is thread-safe. For more\ninformation, see template tag thread safety considerations . django.template.loaders.locmem.Loader class locmem. Loader ¶ Loads templates from a Python dictionary. This is useful for testing. This loader takes a dictionary of templates as its first argument: TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"OPTIONS\" : { \"loaders\" : [ ( \"django.template.loaders.locmem.Loader\" , { \"index.html\" : \"content here\" , }, ), ], }, } ] This loader is disabled by default. Django uses the template loaders in order according to the 'loaders' option. It uses each loader until a loader finds a match. Custom loaders ¶ It’s possible to load templates from additional sources using custom template\nloaders. Custom Loader classes should inherit from django.template.loaders.base.Loader and define the get_contents() and get_template_sources() methods. Loader methods ¶ class Loader [source] ¶ Loads templates from a given source, such as the filesystem or a database. get_template_sources ( template_name ) [source] ¶ A method that takes a template_name and yields Origin instances for each possible\nsource. For example, the filesystem loader may receive 'index.html' as a template_name argument.  This method would yield origins for the\nfull path of index.html as it appears in each template directory\nthe loader looks at. The method doesn’t need to verify that the template exists at a given\npath, but it should ensure the path is valid. For instance, the\nfilesystem loader makes sure the path lies under a valid template\ndirectory. get_contents ( origin ) ¶ Returns the contents for a template given a Origin instance. This is where a filesystem loader would read contents from the\nfilesystem, or a database loader would read from the database. If a\nmatching template doesn’t exist, this should raise a TemplateDoesNotExist error. get_template ( template_name , skip = None ) [source] ¶ Returns a Template object for a given template_name by looping\nthrough results from get_template_sources() and calling get_contents() . This returns the first matching template. If no\ntemplate is found, TemplateDoesNotExist is\nraised. The optional skip argument is a list of origins to ignore when\nextending templates. This allow templates to extend other templates of\nthe same name. It also used to avoid recursion errors. In general, it is enough to define get_template_sources() and get_contents() for custom template loaders. get_template() will usually not need to be overridden. Building your own For examples, read the source code for Django’s built-in loaders . Template origin ¶ Templates have an origin containing attributes depending on the source\nthey are loaded from. class Origin ( name , template_name = None , loader = None ) [source] ¶ name ¶ The path to the template as returned by the template loader.\nFor loaders that read from the file system, this is the full\npath to the template. If the template is instantiated directly rather than through a\ntemplate loader, this is a string value of <unknown_source> . template_name ¶ The relative path to the template as passed into the\ntemplate loader. If the template is instantiated directly rather than through a\ntemplate loader, this is None . loader ¶ The template loader instance that constructed this Origin . If the template is instantiated directly rather than through a\ntemplate loader, this is None . django.template.loaders.cached.Loader requires all of its\nwrapped loaders to set this attribute, typically by instantiating\nthe Origin with loader=self .", "keywords": ["feature", "pattern", "messages", "django.contrib.messages.context_processors.messages", "nasty", "numbers", "django.template.context_processors.static", "meaning", "match", "myapp_tags", "httpresponse", "assertionerror", "tool", "other_dict", "hebrew", "get_contents", "ip_address", "=", "perspective", "results", "engine", "message", "character", "tag", "filesystem", "django.contrib.auth.context_processors", "alters_data", "hole", "process", "places", "debug", "exceptions", "yields", "charset", "first_name", "autoescape", "type", "custom", "defines", "objects", "documentation", "optimization", "lookups", "mind", "file", "modules", "keyerror", "user", "processors", "foo.bar", "attribute", "scenes", "packages", "time", "doesnotexist", "path.to.custom", "django.contrib.auth.context_processors.auth", "ron", "tags", "render", "setting", "purposes", "polls", "things", "logic", "understanding", "name", "from_email", "reference", "web", "issue", "problems", "matter", "manager", "django.contrib.admin", "ip_address_processor", "literals", "z", "return", "curly", "static_url", "memory", "expressions", "foo", "use_tz", "/home", "letter", "get_default", "examples", "callables", "locmem", "setdefault", "dirs", "tree", "error", "module", "code", "auth", "safety", "foo.html", "forgeries", "filter", "false", "behavior", "c", "perms", "class", "access", "style", "admin.urls", "app_dirs", "returns", "names", "templatetag", "recursion", "request", "string_if_invalid", "my_name", "database", "block", "output", "query", "english", "index.html", "use_l10n", "types", "strings", "admin", "usage", "sequences", "some.variable", "default_message_levels", "stooges.0", "configuration", "step", "silentassertionerror", "misconfiguration", "thread", "limitations", "myproject", "source", "concepts", "sequence", "pop", "underscore", "use", "sources", "origin", "a", "engines", "silence", "performance", "protection", "base_site.html", "order", "default", "loader", "alias", "select_template", "option", "format", "classes", "expression", "characters", "tests", "dots", "cross", "digit", "test_against_dictionary", "considerations", "timezone", "push", "limitation", "template", "django.template.context_processors.tz", "traceback", "way", "utf-8", "template_code", "template_name", "origins", "index", "t", "builtins", "party", "¶", "templatesyntaxerror", "disk", "get_template('foo.html", "johnson", "personclass", "content", "function", "django.template.loader", "testing", "result", "zone", "number", "django.template.loaders.filesystem", "right", "autoescaping", "permissions", "def", "tz", "values", "directories", "string", "django.template.loaders.cached", "_", "windows", "overview", "unix", "mapping", "token", "template.html", "unit", "libraries", "language", "dates", "arabic", "level", "anonymoususer", "loading", "contents", "processor", "template_name_list", "labels", "parser", "django", "django.template.context_processors.media", "n’t", "ip", "joe", "languages", "set", "development", "context_processors", "p", "value", "improperlyconfigured", "data", "implementation", "path.to.myapp.tags", "item", "base", "backend", "node", "person", "security", "get_template_sources", "paths", "self", "instance", "objectdoesnotexist", "effects", "localization", "djangotemplates", "initialization", "extension", "tvar", "interface", "report", "|", "options['loaders", "constructor", "sensitive_function", "instances", "structure", "django.template", "flatten", "installed_apps", "part", "object", "from_string", "load", "templatedoesnotexist", "stooges", "c1", "httprequest", "dot", "slashes", "django.template.context_processors.debug", "precedence", "loaders", "dictionary", "sql", "requests", "request_context", "locale", "rendering", "keyword", "delegates", "s", "client_ip_view", "top", "variables", "app_directories", "controls", "system", "apps", "address", "myproject.polls", "overhead", "foo[\"bar", "items", "overwritten", "permwrapper", "sql_queries", "stooge", "tell", "difference", "site", "’s", "skip", "addition", "example", "ins", "care", "app", "i18n", "list", "personclass3", "parsing", "steps", "stack", "variable", "model", "silent_variable_failure", "reasons", "idea", "apis", "django.template.context_processors.request", "file_charset", "dictionaries", "attributes", "media_url", "testcase", "title", "personclass4", "samantha", "contexts", "syntax", "occurrence", "person.name", "internal_ips", "ones", "case", "boolean", "lookup", "contextpopexception", "dolores", "do_not_call_in_templates", "html", "django.contrib.admin.templatetags.admin_urls", "errors", "tuple", "server", "factory", "arguments", "introduction", "static", "one", "larry", "contrib", "matching", "tuples", "delete", ".html", "last_name", "bar", "get_template", "path", "functions", "key", "music", "update", "moe", "none", "filters", "problem", "default_from_email", "c2", "framework", "true", "templateresponse", "dict", "django.template.loaders.app_directories", "api", "loads", "mode", "projects", "document", "priority", "circuit", "foo[bar", "context", "files", "import", "d", "compiles", "directory", "%", "defaults", "call", "information", "python", "requestcontext", "methods", "options", "times", "exception", "client", "details", "method", "myapp.builtins", "settings", "argument", "person.first_name", "django.template.loaders.base", "del", "sites", "marker", "django.template.context_processors.csrf", "/path", "controlling", "templates", "project", "contexttest"], "type": "documentation"},
{"title": "django.contrib.humanize | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/humanize/", "content": "django.contrib.humanize ¶ A set of Django template filters useful for adding a “human touch” to data. To activate these filters, add 'django.contrib.humanize' to your INSTALLED_APPS setting. Once you’ve done that, use {% load humanize %} in a template, and you’ll have access to the following\nfilters. apnumber ¶ For numbers 1-9, returns the number spelled out. Otherwise, returns the\nnumber. This follows Associated Press style. Examples: 1 becomes one . 2 becomes two . 10 becomes 10 . You can pass in either an integer or a string representation of an integer. intcomma ¶ Converts an integer or float (or a string representation of either) to a string\ncontaining commas every three digits. Examples: 4500 becomes 4,500 . 4500.2 becomes 4,500.2 . 45000 becomes 45,000 . 450000 becomes 450,000 . 4500000 becomes 4,500,000 . Format localization will be respected if enabled,\ne.g. with the 'de' language: 45000 becomes '45.000' . 450000 becomes '450.000' . intword ¶ Converts a large integer (or a string representation of an integer) to a\nfriendly text representation. Translates 1.0 as a singular phrase and all\nother numeric values as plural, this may be incorrect for some languages. Works\nbest for numbers over 1 million. Examples: 1000000 becomes 1.0 million . 1200000 becomes 1.2 million . 1200000000 becomes 1.2 billion . -1200000000 becomes -1.2 billion . Values up to 10^100 (Googol) are supported. Format localization will be respected if enabled,\ne.g. with the 'de' language: 1000000 becomes '1,0 Million' . 1200000 becomes '1,2 Millionen' . 1200000000 becomes '1,2 Milliarden' . -1200000000 becomes '-1,2 Milliarden' . naturalday ¶ For dates that are the current day or within one day, return “today”,\n“tomorrow” or “yesterday”, as appropriate. Otherwise, format the date using\nthe passed in format string. Argument: Date formatting string as described in the date tag. Examples (when ‘today’ is 17 Feb 2007): 16 Feb 2007 becomes yesterday . 17 Feb 2007 becomes today . 18 Feb 2007 becomes tomorrow . Any other day is formatted according to given argument or the DATE_FORMAT setting if no argument is given. naturaltime ¶ For datetime values, returns a string representing how many seconds,\nminutes or hours ago it was – falling back to the timesince format if the value is more than a day old. In case the datetime value is in\nthe future the return value will automatically use an appropriate phrase. Examples (when ‘now’ is 17 Feb 2007 16:30:00): 17 Feb 2007 16:30:00 becomes now . 17 Feb 2007 16:29:31 becomes 29 seconds ago . 17 Feb 2007 16:29:00 becomes a minute ago . 17 Feb 2007 16:25:35 becomes 4 minutes ago . 17 Feb 2007 15:30:29 becomes 59 minutes ago . 17 Feb 2007 15:30:01 becomes 59 minutes ago . 17 Feb 2007 15:30:00 becomes an hour ago . 17 Feb 2007 13:31:29 becomes 2 hours ago . 16 Feb 2007 13:31:29 becomes 1 day, 2 hours ago . 16 Feb 2007 13:30:01 becomes 1 day, 2 hours ago . 16 Feb 2007 13:30:00 becomes 1 day, 3 hours ago . 17 Feb 2007 16:30:30 becomes 30 seconds from now . 17 Feb 2007 16:30:29 becomes 29 seconds from now . 17 Feb 2007 16:31:00 becomes a minute from now . 17 Feb 2007 16:34:35 becomes 4 minutes from now . 17 Feb 2007 17:30:29 becomes an hour from now . 17 Feb 2007 18:31:29 becomes 2 hours from now . 18 Feb 2007 16:31:29 becomes 1 day from now . 26 Feb 2007 18:31:29 becomes 1 week, 2 days from now . ordinal ¶ Converts an integer to its ordinal as a string. Examples: 1 becomes 1st . 2 becomes 2nd . 3 becomes 3rd . You can pass in either an integer or a string representation of an integer.\nNegative integers are returned unchanged.", "keywords": ["future", "load", "examples", "naturaltime", "associated", "press", "tomorrow", "value", "django.contrib.humanize", "minutes", "de", "number", "template", "feb", "week", "^", "ordinal", "today", "%", "localization", "django", "values", "phrase", "naturalday", "style", "string", "minute", "access", "humanize", "set", "apnumber", "languages", "touch", "intcomma", "yesterday", "date_format", "filters", "integer", "format", "milliarden", "googol", "argument", "tag", "¶", "digits", "-1200000000", "-1.2", "seconds", "hours", "timesince", "day", "return", "intword", "works", "numbers", "converts", "formatting", "case", "date", "data", "integers", "representation", "days", "millionen", "language", "dates", "text", "installed_apps", "hour", "commas"], "type": "documentation"},
{"title": "The sitemap framework | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/sitemaps/", "content": "The sitemap framework ¶ Django comes with a high-level sitemap-generating framework to create sitemap XML files. Overview ¶ A sitemap is an XML file on your website that tells search-engine indexers how\nfrequently your pages change and how “important” certain pages are in relation\nto other pages on your site. This information helps search engines index your\nsite. The Django sitemap framework automates the creation of this XML file by letting\nyou express this information in Python code. It works much like Django’s syndication framework . To create a sitemap, write a Sitemap class and point to it in your URLconf . Installation ¶ To install the sitemap app, follow these steps: Add 'django.contrib.sitemaps' to your INSTALLED_APPS setting. Make sure your TEMPLATES setting contains a DjangoTemplates backend whose APP_DIRS options is set to True . It’s in there by\ndefault, so you’ll only need to change this if you’ve changed that setting. Make sure you’ve installed the sites framework . (Note: The sitemap application doesn’t install any database tables. The only\nreason it needs to go into INSTALLED_APPS is so that the Loader() template\nloader can find the default templates.) Initialization ¶ views. sitemap ( request , sitemaps , section = None , template_name = 'sitemap.xml' , content_type = 'application/xml' ) ¶ To activate sitemap generation on your Django site, add this line to your URLconf : from django.contrib.sitemaps.views import sitemap path ( \"sitemap.xml\" , sitemap , { \"sitemaps\" : sitemaps }, name = \"django.contrib.sitemaps.views.sitemap\" , ) This tells Django to build a sitemap when a client accesses /sitemap.xml . The name of the sitemap file is not important, but the location is. Search\nengines will only index links in your sitemap for the current URL level and\nbelow. For instance, if sitemap.xml lives in your root directory, it may\nreference any URL in your site. However, if your sitemap lives at /content/sitemap.xml , it may only reference URLs that begin with /content/ . The sitemap view takes an extra, required argument: {'sitemaps': sitemaps} . sitemaps should be a dictionary that maps a short section label (e.g., blog or news ) to its Sitemap class\n(e.g., BlogSitemap or NewsSitemap ). It may also map to an instance of\na Sitemap class (e.g., BlogSitemap(some_var) ). Sitemap classes ¶ A Sitemap class is a Python class that\nrepresents a “section” of entries in your sitemap. For example, one Sitemap class could represent all the entries\nof your blog, while another could represent all of the events in your events\ncalendar. In the simplest case, all these sections get lumped together into one sitemap.xml , but it’s also possible to use the framework to generate a\nsitemap index that references individual sitemap files, one per section. (See Creating a sitemap index below.) Sitemap classes must subclass django.contrib.sitemaps.Sitemap . They can live anywhere in your codebase. An example ¶ Let’s assume you have a blog system, with an Entry model, and you want your\nsitemap to include all the links to your individual blog entries. Here’s how\nyour sitemap class might look: from django.contrib.sitemaps import Sitemap from blog.models import Entry class BlogSitemap ( Sitemap ): changefreq = \"never\" priority = 0.5 def items ( self ): return Entry . objects . filter ( is_draft = False ) def lastmod ( self , obj ): return obj . pub_date Note: changefreq and priority are class\nattributes corresponding to <changefreq> and <priority> elements,\nrespectively. They can be made callable as functions, as lastmod was in the example. items() is a method that returns a sequence or QuerySet of objects. The objects returned will get passed to any callable\nmethods corresponding to a sitemap property ( location , lastmod , changefreq , and priority ). lastmod should return a datetime . There is no location method in this example, but you\ncan provide it in order to specify the URL for your object. By default, location() calls get_absolute_url() on each object\nand returns the result. Sitemap class reference ¶ class Sitemap [source] ¶ A Sitemap class can define the following methods/attributes: items [source] ¶ Required. A method that returns a sequence or QuerySet of objects. The framework doesn’t care what type of objects they are;\nall that matters is that these objects get passed to the location() , lastmod() , changefreq() and priority() methods. location [source] ¶ Optional. Either a method or attribute. If it’s a method, it should return the absolute path for a given object\nas returned by items() . If it’s an attribute, its value should be a string representing an\nabsolute path to use for every object returned by items() . In both cases, “absolute path” means a URL that doesn’t include the\nprotocol or domain. Examples: Good: '/foo/bar/' Bad: 'example.com/foo/bar/' Bad: 'https://example.com/foo/bar/' If location isn’t provided, the framework will call\nthe get_absolute_url() method on each object as returned by items() . To specify a protocol other than 'http' , use protocol . lastmod ¶ Optional. Either a method or attribute. If it’s a method, it should take one argument – an object as returned\nby items() – and return that object’s last-modified\ndate/time as a datetime . If it’s an attribute, its value should be a datetime representing the last-modified date/time for every object returned by items() . If all items in a sitemap have a lastmod , the sitemap\ngenerated by views.sitemap() will have a Last-Modified header equal to the latest lastmod . You can activate the ConditionalGetMiddleware to make\nDjango respond appropriately to requests with an If-Modified-Since header which will prevent sending the sitemap if it hasn’t changed. paginator [source] ¶ Optional. This property returns a Paginator for items() . If you generate sitemaps in a batch you may\nwant to override this as a cached property in order to avoid multiple items() calls. changefreq ¶ Optional. Either a method or attribute. If it’s a method, it should take one argument – an object as returned\nby items() – and return that object’s change\nfrequency as a string. If it’s an attribute, its value should be a string representing the\nchange frequency of every object returned by items() . Possible values for changefreq , whether you use a\nmethod or attribute, are: 'always' 'hourly' 'daily' 'weekly' 'monthly' 'yearly' 'never' priority ¶ Optional. Either a method or attribute. If it’s a method, it should take one argument – an object as returned\nby items() – and return that object’s priority as\neither a string or float. If it’s an attribute, its value should be either a string or float\nrepresenting the priority of every object returned by items() . Example values for priority : 0.4 , 1.0 . The\ndefault priority of a page is 0.5 . See the sitemaps.org\ndocumentation for more. protocol ¶ Optional. This attribute defines the protocol ( 'http' or 'https' ) of the\nURLs in the sitemap. If it isn’t set, the protocol with which the\nsitemap was requested is used. If the sitemap is built outside the\ncontext of a request, the default is 'https' . Changed in Django 5.0: In older versions, the default protocol for sitemaps built outside\nthe context of a request was 'http' . limit ¶ Optional. This attribute defines the maximum number of URLs included on each page\nof the sitemap. Its value should not exceed the default value of 50000 , which is the upper limit allowed in the Sitemaps protocol . i18n ¶ Optional. A boolean attribute that defines if the URLs of this sitemap should\nbe generated using all of your LANGUAGES . The default is False . languages ¶ Optional. A sequence of language codes to use for\ngenerating alternate links when i18n is enabled.\nDefaults to LANGUAGES . alternates ¶ Optional. A boolean attribute. When used in conjunction with i18n generated URLs will each have a list of alternate\nlinks pointing to other language versions using the hreflang\nattribute . The default is False . x_default ¶ Optional. A boolean attribute. When True the alternate links generated by alternates will contain a hreflang=\"x-default\" fallback entry with a value of LANGUAGE_CODE . The default is False . get_latest_lastmod () [source] ¶ Optional. A method that returns the latest value returned by lastmod . This function is used to add the lastmod attribute to Sitemap index context\nvariables . By default get_latest_lastmod() returns: If lastmod is an attribute: lastmod . If lastmod is a method:\nThe latest lastmod returned by calling the method with all\nitems returned by Sitemap.items() . get_languages_for_item ( item ) [source] ¶ Optional. A method that returns the sequence of language codes for\nwhich the item is displayed. By default get_languages_for_item() returns languages . Shortcuts ¶ The sitemap framework provides a convenience class for a common case: class GenericSitemap ( info_dict , priority = None , changefreq = None , protocol = None ) [source] ¶ The django.contrib.sitemaps.GenericSitemap class allows you to\ncreate a sitemap by passing it a dictionary which has to contain at least\na queryset entry. This queryset will be used to generate the items\nof the sitemap. It may also have a date_field entry that\nspecifies a date field for objects retrieved from the queryset .\nThis will be used for the lastmod attribute and get_latest_lastmod() methods in the in the\ngenerated sitemap. The priority , changefreq ,\nand protocol keyword arguments allow specifying these\nattributes for all URLs. Example ¶ Here’s an example of a URLconf using GenericSitemap : from django.contrib.sitemaps import GenericSitemap from django.contrib.sitemaps.views import sitemap from django.urls import path from blog.models import Entry info_dict = { \"queryset\" : Entry . objects . all (), \"date_field\" : \"pub_date\" , } urlpatterns = [ # some generic view using info_dict # ... # the sitemap path ( \"sitemap.xml\" , sitemap , { \"sitemaps\" : { \"blog\" : GenericSitemap ( info_dict , priority = 0.6 )}}, name = \"django.contrib.sitemaps.views.sitemap\" , ), ] Sitemap for static views ¶ Often you want the search engine crawlers to index views which are neither\nobject detail pages nor flatpages. The solution is to explicitly list URL\nnames for these views in items and call reverse() in\nthe location method of the sitemap. For example: # sitemaps.py from django.contrib import sitemaps from django.urls import reverse class StaticViewSitemap ( sitemaps . Sitemap ): priority = 0.5 changefreq = \"daily\" def items ( self ): return [ \"main\" , \"about\" , \"license\" ] def location ( self , item ): return reverse ( item ) # urls.py from django.contrib.sitemaps.views import sitemap from django.urls import path from .sitemaps import StaticViewSitemap from . import views sitemaps = { \"static\" : StaticViewSitemap , } urlpatterns = [ path ( \"\" , views . main , name = \"main\" ), path ( \"about/\" , views . about , name = \"about\" ), path ( \"license/\" , views . license , name = \"license\" ), # ... path ( \"sitemap.xml\" , sitemap , { \"sitemaps\" : sitemaps }, name = \"django.contrib.sitemaps.views.sitemap\" , ), ] Creating a sitemap index ¶ views. index ( request , sitemaps , template_name = 'sitemap_index.xml' , content_type = 'application/xml' , sitemap_url_name = 'django.contrib.sitemaps.views.sitemap' ) ¶ The sitemap framework also has the ability to create a sitemap index that\nreferences individual sitemap files, one per each section defined in your sitemaps dictionary. The only differences in usage are: You use two views in your URLconf: django.contrib.sitemaps.views.index() and django.contrib.sitemaps.views.sitemap() . The django.contrib.sitemaps.views.sitemap() view should take a section keyword argument. Here’s what the relevant URLconf lines would look like for the example above: from django.contrib.sitemaps import views urlpatterns = [ path ( \"sitemap.xml\" , views . index , { \"sitemaps\" : sitemaps }, name = \"django.contrib.sitemaps.views.index\" , ), path ( \"sitemap-<section>.xml\" , views . sitemap , { \"sitemaps\" : sitemaps }, name = \"django.contrib.sitemaps.views.sitemap\" , ), ] This will automatically generate a sitemap.xml file that references\nboth sitemap-flatpages.xml and sitemap-blog.xml . The Sitemap classes and the sitemaps dict don’t change at all. If all sitemaps have a lastmod returned by Sitemap.get_latest_lastmod() the sitemap index will have a Last-Modified header equal to the latest lastmod . You should create an index file if one of your sitemaps has more than 50,000\nURLs. In this case, Django will automatically paginate the sitemap, and the\nindex will reflect that. If you’re not using the vanilla sitemap view – for example, if it’s wrapped\nwith a caching decorator – you must name your sitemap view and pass sitemap_url_name to the index view: from django.contrib.sitemaps import views as sitemaps_views from django.views.decorators.cache import cache_page urlpatterns = [ path ( \"sitemap.xml\" , cache_page ( 86400 )( sitemaps_views . index ), { \"sitemaps\" : sitemaps , \"sitemap_url_name\" : \"sitemaps\" }, ), path ( \"sitemap-<section>.xml\" , cache_page ( 86400 )( sitemaps_views . sitemap ), { \"sitemaps\" : sitemaps }, name = \"sitemaps\" , ), ] Template customization ¶ If you wish to use a different template for each sitemap or sitemap index\navailable on your site, you may specify it by passing a template_name parameter to the sitemap and index views via the URLconf: from django.contrib.sitemaps import views urlpatterns = [ path ( \"custom-sitemap.xml\" , views . index , { \"sitemaps\" : sitemaps , \"template_name\" : \"custom_sitemap.html\" }, name = \"django.contrib.sitemaps.views.index\" , ), path ( \"custom-sitemap-<section>.xml\" , views . sitemap , { \"sitemaps\" : sitemaps , \"template_name\" : \"custom_sitemap.html\" }, name = \"django.contrib.sitemaps.views.sitemap\" , ), ] These views return TemplateResponse instances which allow you to easily customize the response data before\nrendering. For more details, see the TemplateResponse documentation . Context variables ¶ When customizing the templates for the index() and sitemap() views, you can rely on the\nfollowing context variables. Index ¶ The variable sitemaps is a list of objects containing the location and lastmod attribute for each of the sitemaps. Each URL exposes the following\nattributes: location : The location (url & page) of the sitemap. lastmod : Populated by the get_latest_lastmod() method for each sitemap. Sitemap ¶ The variable urlset is a list of URLs that should appear in the\nsitemap. Each URL exposes attributes as defined in the Sitemap class: alternates changefreq item lastmod location priority The alternates attribute is available when i18n and alternates are enabled. It is a list of other language\nversions, including the optional x_default fallback, for each\nURL. Each alternate is a dictionary with location and lang_code keys. The item attribute has been added for each URL to allow more flexible\ncustomization of the templates, such as Google news sitemaps . Assuming\nSitemap’s items() would return a list of items with publication_data and a tags field something like this would\ngenerate a Google News compatible sitemap: <?xml version=\"1.0\" encoding=\"UTF-8\"?> <urlset xmlns= \"https://www.sitemaps.org/schemas/sitemap/0.9\" xmlns:news= \"https://www.google.com/schemas/sitemap-news/0.9\" > {% spaceless %} {% for url in urlset %} <url> <loc> {{ url.location }} </loc> {% if url.lastmod %} <lastmod> {{ url.lastmod | date :\"Y-m-d\" }} </lastmod> {% endif %} {% if url.changefreq %} <changefreq> {{ url.changefreq }} </changefreq> {% endif %} {% if url.priority %} <priority> {{ url.priority }} </priority> {% endif %} <news:news> {% if url.item.publication_date %} <news:publication_date> {{ url.item.publication_date | date :\"Y-m-d\" }} </news:publication_date> {% endif %} {% if url.item.tags %} <news:keywords> {{ url.item.tags }} </news:keywords> {% endif %} </news:news> </url> {% endfor %} {% endspaceless %} </urlset>", "keywords": ["function", "django.views.decorators.cache", "keywords", "protocol", "views", "examples", "url.item.tags", "result", "view", "items", "float", "genericsitemap", "https://www.sitemaps.org/schemas/sitemap/0.9", "changefreq", "weekly", "number", "loc", "version=\"1.0", "xmlns", "url", "bad", "def", "code", "point", "site", "values", "pages", "django.contrib", "filter", "string", "class", "example", "field", "#", "hreflang=\"x", "app", "flatpages", "relation", "i18n", "m", "overview", "list", "sitemap_index.xml", "app_dirs", "returns", "names", "url.priority", "indexers", "request", "sitemap-blog.xml", "database", "location", "alternates", "language", "steps", "lines", "page", "calendar", "google", "level", "paginator", "elements", "model", "if", "sections", "change", "https://example.com/foo/bar/", "views.sitemap", "creation", "https", "django.urls", "links", "application", "usage", "attributes", "label", "sitemap.get_latest_lastmod", "vanilla", "django", "xml", "http", "hreflang", "=", "limit", "n’t", "ability", "differences", "get_absolute_url", "engine", "entry", "urlconf", "languages", "installation", "y", "blogsitemap", "info_dict", "lastmod", "is_draft", "value", "tables", "conditionalgetmiddleware", "section", "events", "django.contrib.sitemaps.views.index", "line", "codes", "get_languages_for_item", "content_type", "source", "batch", "keys", "spaceless", "case", "sequence", "url.location", "data", "fallback", "language_code", "conjunction", "item", "datetime", "example.com/foo/bar/", "backend", "frequency", "arguments", "type", "engines", "required", "solution", "self", "calls", "instance", "custom", "objects", "documentation", "generation", "entries", "pub_date", "file", "sitemap_url_name", "djangotemplates", "initialization", "customization", "sitemap-<section>.xml", "order", "sitemap-flatpages.xml", "custom-sitemap.xml", "default", "sitemaps", "good", "blog.models", "|", "loader", "path", "cases", "functions", "django.contrib.sitemaps", "attribute", "shortcuts", "newssitemap", "none", "/sitemap.xml", "classes", "decorator", "lang_code", "time", "tags", "reason", "bar/", "framework", "alternate", "date", "instances", "setting", "true", "urlset", "templateresponse", "sitemap", "urls", "installed_apps", "blogsitemap(some_var", "get_latest_lastmod", "convenience", "crawlers", "references", "priority", "object", "django.contrib.sitemaps.views", "domain", "context", "files", "import", "name", "d", "template", "parameter", "response", "url.lastmod", "website", "directory", "dictionary", "header", "defaults", "%", "requests", "staticviewsitemap", "publication_data", "codebase", "information", "reference", "/content/", "python", "endfor", "template_name", "methods", "versions", "keyword", "options", "optional", "sitemaps_views", "index", "syndication", "client", "cache_page", "details", "https://www.google.com/schemas/sitemap-news/0.9", "method", "django.contrib.sitemaps.views.sitemap", "queryset", "variables", "root", "license", ".sitemaps", "argument", "xmlns=", "¶", "obj", "news", "return", "reverse", "note", "sites", "detail", "system", "search", "property", "templates", "sitemap.items", "blog"], "type": "documentation"},
{"title": "File storage API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/files/storage/", "content": "File storage API ¶ Getting the default storage class ¶ Django provides convenient ways to access the default storage class: storages ¶ A dictionary-like object that allows retrieving a storage instance using\nits alias as defined by STORAGES . storages has an attribute backends , which defaults to the raw value\nprovided in STORAGES . Additionally, storages provides a create_storage() method that\naccepts the dictionary used in STORAGES for a backend, and\nreturns a storage instance based on that backend definition. This may be\nuseful for third-party packages needing to instantiate storages in tests: >>> from django.core.files.storage import storages >>> storages . backends {'default': {'BACKEND': 'django.core.files.storage.FileSystemStorage'}, 'staticfiles': {'BACKEND': 'django.contrib.staticfiles.storage.StaticFilesStorage'}, 'custom': {'BACKEND': 'package.storage.CustomStorage'}} >>> storage_instance = storages . create_storage ({ \"BACKEND\" : \"package.storage.CustomStorage\" }) class DefaultStorage [source] ¶ DefaultStorage provides\nlazy access to the default storage system as defined by default key in STORAGES . DefaultStorage uses storages internally. default_storage ¶ default_storage is an instance of the DefaultStorage . The FileSystemStorage class ¶ class FileSystemStorage ( location = None , base_url = None , file_permissions_mode = None , directory_permissions_mode = None , allow_overwrite = False ) [source] ¶ The FileSystemStorage class implements\nbasic file storage on a local filesystem. It inherits from Storage and provides implementations\nfor all the public methods thereof. Note The FileSystemStorage.delete() method will not raise an exception\nif the given file name does not exist. location [source] ¶ Absolute path to the directory that will hold the files.\nDefaults to the value of your MEDIA_ROOT setting. base_url [source] ¶ URL that serves the files stored at this location.\nDefaults to the value of your MEDIA_URL setting. file_permissions_mode [source] ¶ The file system permissions that the file will receive when it is\nsaved. Defaults to FILE_UPLOAD_PERMISSIONS . directory_permissions_mode [source] ¶ The file system permissions that the directory will receive when it is\nsaved. Defaults to FILE_UPLOAD_DIRECTORY_PERMISSIONS . allow_overwrite ¶ New in Django 5.1. Flag to control allowing saving a new file over an existing one.\nDefaults to False . get_created_time ( name ) [source] ¶ Returns a datetime of the system’s ctime, i.e. os.path.getctime() . On some systems (like Unix), this is the\ntime of the last metadata change, and on others (like Windows), it’s\nthe creation time of the file. The InMemoryStorage class ¶ class InMemoryStorage ( location = None , base_url = None , file_permissions_mode = None , directory_permissions_mode = None ) [source] ¶ The InMemoryStorage class implements\na memory-based file storage. It has no persistence, but can be useful for\nspeeding up tests by avoiding disk access. location [source] ¶ Absolute path to the directory name assigned to files. Defaults to the\nvalue of your MEDIA_ROOT setting. base_url [source] ¶ URL that serves the files stored at this location.\nDefaults to the value of your MEDIA_URL setting. file_permissions_mode [source] ¶ The file system permissions assigned to files, provided for\ncompatibility with FileSystemStorage . Defaults to FILE_UPLOAD_PERMISSIONS . directory_permissions_mode [source] ¶ The file system permissions assigned to directories, provided for\ncompatibility with FileSystemStorage . Defaults to FILE_UPLOAD_DIRECTORY_PERMISSIONS . The Storage class ¶ class Storage [source] ¶ The Storage class provides a\nstandardized API for storing files, along with a set of default\nbehaviors that all other storage systems can inherit or override\nas necessary. Note When methods return naive datetime objects, the effective timezone\nused will be the current value of os.environ['TZ'] ; note that this\nis usually set from Django’s TIME_ZONE . delete ( name ) [source] ¶ Deletes the file referenced by name . If deletion is not supported\non the target storage system this will raise NotImplementedError instead. exists ( name ) [source] ¶ Returns True if a file referenced by the given name already exists\nin the storage system. get_accessed_time ( name ) [source] ¶ Returns a datetime of the last accessed time of the\nfile. For storage systems unable to return the last accessed time this\nwill raise NotImplementedError . If USE_TZ is True , returns an aware datetime ,\notherwise returns a naive datetime in the local timezone. get_alternative_name ( file_root , file_ext ) [source] ¶ Returns an alternative filename based on the file_root and file_ext parameters, an underscore plus a random 7 character\nalphanumeric string is appended to the filename before the extension. get_available_name ( name , max_length = None ) [source] ¶ Returns a filename based on the name parameter that’s free and\navailable for new content to be written to on the target storage\nsystem. The length of the filename will not exceed max_length , if provided.\nIf a free unique filename cannot be found, a SuspiciousFileOperation exception will be raised. If a file with name already exists, get_alternative_name() is\ncalled to obtain an alternative name. get_created_time ( name ) [source] ¶ Returns a datetime of the creation time of the file.\nFor storage systems unable to return the creation time this will raise NotImplementedError . If USE_TZ is True , returns an aware datetime ,\notherwise returns a naive datetime in the local timezone. get_modified_time ( name ) [source] ¶ Returns a datetime of the last modified time of the\nfile. For storage systems unable to return the last modified time this\nwill raise NotImplementedError . If USE_TZ is True , returns an aware datetime ,\notherwise returns a naive datetime in the local timezone. get_valid_name ( name ) [source] ¶ Returns a filename based on the name parameter that’s suitable\nfor use on the target storage system. generate_filename ( filename ) [source] ¶ Validates the filename by calling get_valid_name() and\nreturns a filename to be passed to the save() method. The filename argument may include a path as returned by FileField.upload_to .\nIn that case, the path won’t be passed to get_valid_name() but\nwill be prepended back to the resulting name. The default implementation uses os.path operations. Override\nthis method if that’s not appropriate for your storage. listdir ( path ) [source] ¶ Lists the contents of the specified path, returning a 2-tuple of lists;\nthe first item being directories, the second item being files. For\nstorage systems that aren’t able to provide such a listing, this will\nraise a NotImplementedError instead. open ( name , mode = 'rb' ) [source] ¶ Opens the file given by name . Note that although the returned file\nis guaranteed to be a File object, it might actually be some\nsubclass. In the case of remote file storage this means that\nreading/writing could be quite slow, so be warned. path ( name ) [source] ¶ The local filesystem path where the file can be opened using Python’s\nstandard open() . For storage systems that aren’t accessible from\nthe local filesystem, this will raise NotImplementedError instead. save ( name , content , max_length = None ) [source] ¶ Saves a new file using the storage system, preferably with the name\nspecified. If there already exists a file with this name name , the\nstorage system may modify the filename as necessary to get a unique\nname. The actual name of the stored file will be returned. The max_length argument is passed along to get_available_name() . The content argument must be an instance of django.core.files.File or a file-like object that can be\nwrapped in File . size ( name ) [source] ¶ Returns the total size, in bytes, of the file referenced by name .\nFor storage systems that aren’t able to return the file size this will\nraise NotImplementedError instead. url ( name ) [source] ¶ Returns the URL where the contents of the file referenced by name can be accessed. For storage systems that don’t support access by URL\nthis will raise NotImplementedError instead.", "keywords": ["implementations", "being", "open", "storages", "storage", "definition", "generate_filename", "url", "permissions", "target", "staticfiles", "get_accessed_time", "absolute", "directories", "false", "string", "access", "class", "lists", "base_url", "windows", "unix", "get_modified_time", "validates", "ctime", "returns", "metadata", "'", "storage_instance", "flag", "location", "compatibility", "ways", "filefield.upload_to", "defaultstorage", "contents", "subclass", "default_storage", "change", "get_valid_name", "creation", "systems", "media_url", "django", "=", "n’t", "filename", "max_length", "get_alternative_name", "writing", "os.path", "set", "get_created_time", "override", "character", "value", "filesystem", "source", "case", "length", "implementation", "underscore", "item", "datetime", "use", "backend", "get_available_name", "implements", "notimplementederror", "tuple", "file_permissions_mode", "file_upload_permissions", "customstorage", "instance", "custom", "objects", "file", "extension", "default", "path", "key", "filesystemstorage.delete", "alias", "create_storage", "operations", "file_upload_directory_permissions", "attribute", "none", "tests", "packages", "size", "package.storage", "os.path.getctime", "time", "suspiciousfileoperation", "save", "new", "setting", "listing", "timezone", "api", "listdir", "filesystemstorage", "mode", "object", "os.environ['tz", "staticfilesstorage", "import", "name", "files", "parameter", "directory", "dictionary", "defaults", "opens", "backends", "python", "methods", "exception", "rb", "party", "method", "others", "persistence", "argument", "¶", "directory_permissions_mode", "behaviors", "bytes", "deletion", "disk", "parameters", "memory", "file_ext", "system", "django.contrib.staticfiles.storage", "django.core.files", "use_tz", "content"], "type": "documentation"},
{"title": "Multiple databases | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/db/multi-db/", "content": "Multiple databases ¶ This topic guide describes Django’s support for interacting with\nmultiple databases. Most of the rest of Django’s documentation assumes\nyou are interacting with a single database. If you want to interact\nwith multiple databases, you’ll need to take some additional steps. See also See Multi-database support for information about testing with multiple\ndatabases. Defining your databases ¶ The first step to using more than one database with Django is to tell\nDjango about the database servers you’ll be using. This is done using\nthe DATABASES setting. This setting maps database aliases,\nwhich are a way to refer to a specific database throughout Django, to\na dictionary of settings for that specific connection. The settings in\nthe inner dictionaries are described fully in the DATABASES documentation. Databases can have any alias you choose. However, the alias default has special significance. Django uses the database with\nthe alias of default when no other database has been selected. The following is an example settings.py snippet defining two\ndatabases – a default PostgreSQL database and a MySQL database called users : DATABASES = { \"default\" : { \"NAME\" : \"app_data\" , \"ENGINE\" : \"django.db.backends.postgresql\" , \"USER\" : \"postgres_user\" , \"PASSWORD\" : \"s3krit\" , }, \"users\" : { \"NAME\" : \"user_data\" , \"ENGINE\" : \"django.db.backends.mysql\" , \"USER\" : \"mysql_user\" , \"PASSWORD\" : \"priv4te\" , }, } If the concept of a default database doesn’t make sense in the context\nof your project, you need to be careful to always specify the database\nthat you want to use. Django requires that a default database entry\nbe defined, but the parameters dictionary can be left blank if it will not be\nused. To do this, you must set up DATABASE_ROUTERS for all of your\napps’ models, including those in any contrib and third-party apps you’re using,\nso that no queries are routed to the default database. The following is an\nexample settings.py snippet defining two non-default databases, with the default entry intentionally left empty: DATABASES = { \"default\" : {}, \"users\" : { \"NAME\" : \"user_data\" , \"ENGINE\" : \"django.db.backends.mysql\" , \"USER\" : \"mysql_user\" , \"PASSWORD\" : \"superS3cret\" , }, \"customers\" : { \"NAME\" : \"customer_data\" , \"ENGINE\" : \"django.db.backends.mysql\" , \"USER\" : \"mysql_cust\" , \"PASSWORD\" : \"veryPriv@ate\" , }, } If you attempt to access a database that you haven’t defined in your DATABASES setting, Django will raise a django.utils.connection.ConnectionDoesNotExist exception. Synchronizing your databases ¶ The migrate management command operates on one database at a\ntime. By default, it operates on the default database, but by\nproviding the --database option, you can tell it\nto synchronize a different database. So, to synchronize all models onto\nall databases in the first example above, you would need to call: $ ./manage.py migrate\n$ ./manage.py migrate --database = users If you don’t want every application to be synchronized onto a\nparticular database, you can define a database\nrouter that implements a policy\nconstraining the availability of particular models. If, as in the second example above, you’ve left the default database empty,\nyou must provide a database name each time you run migrate . Omitting\nthe database name would raise an error. For the second example: $ ./manage.py migrate --database = users\n$ ./manage.py migrate --database = customers Using other management commands ¶ Most other django-admin commands that interact with the database operate in\nthe same way as migrate – they only ever operate on one database at\na time, using --database to control the database used. An exception to this rule is the makemigrations command. It\nvalidates the migration history in the databases to catch problems with the\nexisting migration files (which could be caused by editing them) before\ncreating new migrations. By default, it checks only the default database,\nbut it consults the allow_migrate() method of routers if any are installed. Automatic database routing ¶ The easiest way to use multiple databases is to set up a database\nrouting scheme. The default routing scheme ensures that objects remain\n‘sticky’ to their original database (i.e., an object retrieved from\nthe foo database will be saved on the same database). The default\nrouting scheme ensures that if a database isn’t specified, all queries\nfall back to the default database. You don’t have to do anything to activate the default routing scheme\n– it is provided ‘out of the box’ on every Django project. However,\nif you want to implement more interesting database allocation\nbehaviors, you can define and install your own database routers. Database routers ¶ A database Router is a class that provides up to four methods: db_for_read ( model , ** hints ) ¶ Suggest the database that should be used for read operations for\nobjects of type model . If a database operation is able to provide any additional\ninformation that might assist in selecting a database, it will be\nprovided in the hints dictionary. Details on valid hints are\nprovided below . Returns None if there is no suggestion. db_for_write ( model , ** hints ) ¶ Suggest the database that should be used for writes of objects of\ntype Model. If a database operation is able to provide any additional\ninformation that might assist in selecting a database, it will be\nprovided in the hints dictionary. Details on valid hints are\nprovided below . Returns None if there is no suggestion. allow_relation ( obj1 , obj2 , ** hints ) ¶ Return True if a relation between obj1 and obj2 should be\nallowed, False if the relation should be prevented, or None if\nthe router has no opinion. This is purely a validation operation,\nused by foreign key and many to many operations to determine if a\nrelation should be allowed between two objects. If no router has an opinion (i.e. all routers return None ), only\nrelations within the same database are allowed. allow_migrate ( db , app_label , model_name = None , ** hints ) ¶ Determine if the migration operation is allowed to run on the database with\nalias db . Return True if the operation should run, False if it\nshouldn’t run, or None if the router has no opinion. The app_label positional argument is the label of the application\nbeing migrated. model_name is set by most migration operations to the value of model._meta.model_name (the lowercased version of the model __name__ ) of the model being migrated. Its value is None for the RunPython and RunSQL operations unless they\nprovide it using hints. hints are used by certain operations to communicate additional\ninformation to the router. When model_name is set, hints normally contains the model class\nunder the key 'model' . Note that it may be a historical model , and thus not have any custom attributes, methods, or\nmanagers. You should only rely on _meta . This method can also be used to determine the availability of a model on a\ngiven database. makemigrations always creates migrations for model changes, but\nif allow_migrate() returns False , any migration operations for the model_name will be silently skipped when running migrate on\nthe db . Changing the behavior of allow_migrate() for models that\nalready have migrations may result in broken foreign keys, extra tables,\nor missing tables. When makemigrations verifies the migration\nhistory, it skips databases where no app is allowed to migrate. A router doesn’t have to provide all these methods – it may omit one\nor more of them. If one of the methods is omitted, Django will skip\nthat router when performing the relevant check. Hints ¶ The hints received by the database router can be used to decide which\ndatabase should receive a given request. At present, the only hint that will be provided is instance , an\nobject instance that is related to the read or write operation that is\nunderway. This might be the instance that is being saved, or it might\nbe an instance that is being added in a many-to-many relation. In some\ncases, no instance hint will be provided at all. The router checks for\nthe existence of an instance hint, and determine if that hint should be\nused to alter routing behavior. Using routers ¶ Database routers are installed using the DATABASE_ROUTERS setting. This setting defines a list of class names, each specifying a\nrouter that should be used by the base router\n( django.db.router ). The base router is used by Django’s database operations to allocate\ndatabase usage. Whenever a query needs to know which database to use,\nit calls the base router, providing a model and a hint (if\navailable). The base router tries each router class in turn until one returns\na database suggestion. If no routers return a suggestion, the base router tries\nthe current instance._state.db of the hint instance. If no hint instance\nwas provided, or instance._state.db is None , the base router will allocate the default database. An example ¶ Example purposes only! This example is intended as a demonstration of how the router\ninfrastructure can be used to alter database usage. It\nintentionally ignores some complex issues in order to\ndemonstrate how routers are used. This example won’t work if any of the models in myapp contain\nrelationships to models outside of the other database. Cross-database relationships introduce referential integrity problems that Django can’t\ncurrently handle. The primary/replica (referred to as master/slave by some databases)\nconfiguration described is also flawed – it\ndoesn’t provide any solution for handling replication lag (i.e.,\nquery inconsistencies introduced because of the time taken for a\nwrite to propagate to the replicas). It also doesn’t consider the\ninteraction of transactions with the database utilization strategy. So - what does this mean in practice? Let’s consider another sample\nconfiguration. This one will have several databases: one for the auth application, and all other apps using a primary/replica setup\nwith two read replicas. Here are the settings specifying these\ndatabases: DATABASES = { \"default\" : {}, \"auth_db\" : { \"NAME\" : \"auth_db_name\" , \"ENGINE\" : \"django.db.backends.mysql\" , \"USER\" : \"mysql_user\" , \"PASSWORD\" : \"swordfish\" , }, \"primary\" : { \"NAME\" : \"primary_name\" , \"ENGINE\" : \"django.db.backends.mysql\" , \"USER\" : \"mysql_user\" , \"PASSWORD\" : \"spam\" , }, \"replica1\" : { \"NAME\" : \"replica1_name\" , \"ENGINE\" : \"django.db.backends.mysql\" , \"USER\" : \"mysql_user\" , \"PASSWORD\" : \"eggs\" , }, \"replica2\" : { \"NAME\" : \"replica2_name\" , \"ENGINE\" : \"django.db.backends.mysql\" , \"USER\" : \"mysql_user\" , \"PASSWORD\" : \"bacon\" , }, } Now we’ll need to handle routing. First we want a router that knows to\nsend queries for the auth and contenttypes apps to auth_db ( auth models are linked to ContentType , so they must be stored in the\nsame database): class AuthRouter : \"\"\" A router to control all database operations on models in the auth and contenttypes applications. \"\"\" route_app_labels = { \"auth\" , \"contenttypes\" } def db_for_read ( self , model , ** hints ): \"\"\" Attempts to read auth and contenttypes models go to auth_db. \"\"\" if model . _meta . app_label in self . route_app_labels : return \"auth_db\" return None def db_for_write ( self , model , ** hints ): \"\"\" Attempts to write auth and contenttypes models go to auth_db. \"\"\" if model . _meta . app_label in self . route_app_labels : return \"auth_db\" return None def allow_relation ( self , obj1 , obj2 , ** hints ): \"\"\" Allow relations if a model in the auth or contenttypes apps is involved. \"\"\" if ( obj1 . _meta . app_label in self . route_app_labels or obj2 . _meta . app_label in self . route_app_labels ): return True return None def allow_migrate ( self , db , app_label , model_name = None , ** hints ): \"\"\" Make sure the auth and contenttypes apps only appear in the 'auth_db' database. \"\"\" if app_label in self . route_app_labels : return db == \"auth_db\" return None And we also want a router that sends all other apps to the\nprimary/replica configuration, and randomly chooses a replica to read\nfrom: import random class PrimaryReplicaRouter : def db_for_read ( self , model , ** hints ): \"\"\" Reads go to a randomly-chosen replica. \"\"\" return random . choice ([ \"replica1\" , \"replica2\" ]) def db_for_write ( self , model , ** hints ): \"\"\" Writes always go to primary. \"\"\" return \"primary\" def allow_relation ( self , obj1 , obj2 , ** hints ): \"\"\" Relations between objects are allowed if both objects are in the primary/replica pool. \"\"\" db_set = { \"primary\" , \"replica1\" , \"replica2\" } if obj1 . _state . db in db_set and obj2 . _state . db in db_set : return True return None def allow_migrate ( self , db , app_label , model_name = None , ** hints ): \"\"\" All non-auth models end up in this pool. \"\"\" return True Finally, in the settings file, we add the following (substituting path.to. with the actual Python path to the module(s) where the\nrouters are defined): DATABASE_ROUTERS = [ \"path.to.AuthRouter\" , \"path.to.PrimaryReplicaRouter\" ] The order in which routers are processed is significant. Routers will\nbe queried in the order they are listed in the DATABASE_ROUTERS setting. In this example, the AuthRouter is processed before the PrimaryReplicaRouter , and as a\nresult, decisions concerning the models in auth are processed\nbefore any other decision is made. If the DATABASE_ROUTERS setting listed the two routers in the other order, PrimaryReplicaRouter.allow_migrate() would be processed first. The\ncatch-all nature of the PrimaryReplicaRouter implementation would mean\nthat all models would be available on all databases. With this setup installed, and all databases migrated as per Synchronizing your databases , lets run some Django code: >>> # This retrieval will be performed on the 'auth_db' database >>> fred = User . objects . get ( username = \"fred\" ) >>> fred . first_name = \"Frederick\" >>> # This save will also be directed to 'auth_db' >>> fred . save () >>> # These retrieval will be randomly allocated to a replica database >>> dna = Person . objects . get ( name = \"Douglas Adams\" ) >>> # A new object has no database allocation when created >>> mh = Book ( title = \"Mostly Harmless\" ) >>> # This assignment will consult the router, and set mh onto >>> # the same database as the author object >>> mh . author = dna >>> # This save will force the 'mh' instance onto the primary database... >>> mh . save () >>> # ... but if we re-retrieve the object, it will come back on a replica >>> mh = Book . objects . get ( title = \"Mostly Harmless\" ) This example defined a router to handle interaction with models from the auth app, and other routers to handle interaction with all other apps. If\nyou left your default database empty and don’t want to define a catch-all\ndatabase router to handle all apps not otherwise specified, your routers must\nhandle the names of all apps in INSTALLED_APPS before you migrate.\nSee Behavior of contrib apps for information about contrib apps\nthat must be together in one database. Manually selecting a database ¶ Django also provides an API that allows you to maintain complete control\nover database usage in your code. A manually specified database allocation\nwill take priority over a database allocated by a router. Manually selecting a database for a QuerySet ¶ You can select the database for a QuerySet at any point in the QuerySet “chain.” Call using() on the QuerySet to get another QuerySet that uses the specified database. using() takes a single argument: the alias of the database on\nwhich you want to run the query. For example: >>> # This will run on the 'default' database. >>> Author . objects . all () >>> # So will this. >>> Author . objects . using ( \"default\" ) >>> # This will run on the 'other' database. >>> Author . objects . using ( \"other\" ) Selecting a database for save() ¶ Use the using keyword to Model.save() to specify to which\ndatabase the data should be saved. For example, to save an object to the legacy_users database, you’d\nuse this: >>> my_object . save ( using = \"legacy_users\" ) If you don’t specify using , the save() method will save into\nthe default database allocated by the routers. Moving an object from one database to another ¶ If you’ve saved an instance to one database, it might be tempting to\nuse save(using=...) as a way to migrate the instance to a new\ndatabase. However, if you don’t take appropriate steps, this could\nhave some unexpected consequences. Consider the following example: >>> p = Person ( name = \"Fred\" ) >>> p . save ( using = \"first\" ) # (statement 1) >>> p . save ( using = \"second\" ) # (statement 2) In statement 1, a new Person object is saved to the first database. At this time, p doesn’t have a primary key, so Django\nissues an SQL INSERT statement. This creates a primary key, and\nDjango assigns that primary key to p . When the save occurs in statement 2, p already has a primary key\nvalue, and Django will attempt to use that primary key on the new\ndatabase. If the primary key value isn’t in use in the second database, then you won’t have any problems – the object will be\ncopied to the new database. However, if the primary key of p is already in use on the second database, the existing object in the second database\nwill be overridden when p is saved. You can avoid this in two ways. First, you can clear the primary key\nof the instance. If an object has no primary key, Django will treat it\nas a new object, avoiding any loss of data on the second database: >>> p = Person ( name = \"Fred\" ) >>> p . save ( using = \"first\" ) >>> p . pk = None # Clear the primary key. >>> p . save ( using = \"second\" ) # Write a completely new object. The second option is to use the force_insert option to save() to ensure that Django does an SQL INSERT : >>> p = Person ( name = \"Fred\" ) >>> p . save ( using = \"first\" ) >>> p . save ( using = \"second\" , force_insert = True ) This will ensure that the person named Fred will have the same\nprimary key on both databases. If that primary key is already in use\nwhen you try to save onto the second database, an error will be\nraised. Selecting a database to delete from ¶ By default, a call to delete an existing object will be executed on\nthe same database that was used to retrieve the object in the first\nplace: >>> u = User . objects . using ( \"legacy_users\" ) . get ( username = \"fred\" ) >>> u . delete () # will delete from the `legacy_users` database To specify the database from which a model will be deleted, pass a using keyword argument to the Model.delete() method. This\nargument works just like the using keyword argument to save() . For example, if you’re migrating a user from the legacy_users database to the new_users database, you might use these commands: >>> user_obj . save ( using = \"new_users\" ) >>> user_obj . delete ( using = \"legacy_users\" ) Using managers with multiple databases ¶ Use the db_manager() method on managers to give managers access to\na non-default database. For example, say you have a custom manager method that touches the\ndatabase – User.objects.create_user() . Because create_user() is a manager method, not a QuerySet method, you can’t do User.objects.using('new_users').create_user() . (The create_user() method is only available on User.objects , the\nmanager, not on QuerySet objects derived from the manager.) The\nsolution is to use db_manager() , like this: User . objects . db_manager ( \"new_users\" ) . create_user ( ... ) db_manager() returns a copy of the manager bound to the database you specify. Using get_queryset() with multiple databases ¶ If you’re overriding get_queryset() on your manager, be sure to\neither call the method on the parent (using super() ) or do the\nappropriate handling of the _db attribute on the manager (a string\ncontaining the name of the database to use). For example, if you want to return a custom QuerySet class from\nthe get_queryset method, you could do this: class MyManager ( models . Manager ): def get_queryset ( self ): qs = CustomQuerySet ( self . model ) if self . _db is not None : qs = qs . using ( self . _db ) return qs Exposing multiple databases in Django’s admin interface ¶ Django’s admin doesn’t have any explicit support for multiple\ndatabases. If you want to provide an admin interface for a model on a\ndatabase other than that specified by your router chain, you’ll\nneed to write custom ModelAdmin classes\nthat will direct the admin to use a specific database for content. ModelAdmin objects have the following methods that require customization\nfor multiple-database support: class MultiDBModelAdmin ( admin . ModelAdmin ): # A handy constant for the name of the alternate database. using = \"other\" def save_model ( self , request , obj , form , change ): # Tell Django to save objects to the 'other' database. obj . save ( using = self . using ) def delete_model ( self , request , obj ): # Tell Django to delete objects from the 'other' database obj . delete ( using = self . using ) def get_queryset ( self , request ): # Tell Django to look for objects on the 'other' database. return super () . get_queryset ( request ) . using ( self . using ) def formfield_for_foreignkey ( self , db_field , request , ** kwargs ): # Tell Django to populate ForeignKey widgets using a query # on the 'other' database. return super () . formfield_for_foreignkey ( db_field , request , using = self . using , ** kwargs ) def formfield_for_manytomany ( self , db_field , request , ** kwargs ): # Tell Django to populate ManyToMany widgets using a query # on the 'other' database. return super () . formfield_for_manytomany ( db_field , request , using = self . using , ** kwargs ) The implementation provided here implements a multi-database strategy\nwhere all objects of a given type are stored on a specific database\n(e.g., all User objects are in the other database). If your\nusage of multiple databases is more complex, your ModelAdmin will\nneed to reflect that strategy. InlineModelAdmin objects can be handled in a\nsimilar fashion. They require three customized methods: class MultiDBTabularInline ( admin . TabularInline ): using = \"other\" def get_queryset ( self , request ): # Tell Django to look for inline objects on the 'other' database. return super () . get_queryset ( request ) . using ( self . using ) def formfield_for_foreignkey ( self , db_field , request , ** kwargs ): # Tell Django to populate ForeignKey widgets using a query # on the 'other' database. return super () . formfield_for_foreignkey ( db_field , request , using = self . using , ** kwargs ) def formfield_for_manytomany ( self , db_field , request , ** kwargs ): # Tell Django to populate ManyToMany widgets using a query # on the 'other' database. return super () . formfield_for_manytomany ( db_field , request , using = self . using , ** kwargs ) Once you’ve written your model admin definitions, they can be\nregistered with any Admin instance: from django.contrib import admin # Specialize the multi-db admin objects for use with specific models. class BookInline ( MultiDBTabularInline ): model = Book class PublisherAdmin ( MultiDBModelAdmin ): inlines = [ BookInline ] admin . site . register ( Author , MultiDBModelAdmin ) admin . site . register ( Publisher , PublisherAdmin ) othersite = admin . AdminSite ( \"othersite\" ) othersite . register ( Publisher , MultiDBModelAdmin ) This example sets up two admin sites. On the first site, the Author and Publisher objects are exposed; Publisher objects have a tabular inline showing books published by that\npublisher. The second site exposes just publishers, without the\ninlines. Using raw cursors with multiple databases ¶ If you are using more than one database you can use django.db.connections to obtain the connection (and cursor) for a\nspecific database. django.db.connections is a dictionary-like\nobject that allows you to retrieve a specific connection using its\nalias: from django.db import connections with connections [ \"my_db_alias\" ] . cursor () as cursor : ... Limitations of multiple databases ¶ Cross-database relations ¶ Django doesn’t currently provide any support for foreign key or\nmany-to-many relationships spanning multiple databases. If you\nhave used a router to partition models to different databases,\nany foreign key and many-to-many relationships defined by those\nmodels must be internal to a single database. This is because of referential integrity. In order to maintain a\nrelationship between two objects, Django needs to know that the\nprimary key of the related object is valid. If the primary key is\nstored on a separate database, it’s not possible to easily evaluate\nthe validity of a primary key. If you’re using Postgres, SQLite, Oracle, or MySQL with InnoDB, this is\nenforced at the database integrity level – database level key\nconstraints prevent the creation of relations that can’t be validated. However, if you’re using MySQL with MyISAM tables, there is no enforced\nreferential integrity; as a result, you may be able to ‘fake’ cross database\nforeign keys. However, this configuration is not officially supported by\nDjango. Behavior of contrib apps ¶ Several contrib apps include models, and some apps depend on others. Since\ncross-database relationships are impossible, this creates some restrictions on\nhow you can split these models across databases: each one of contenttypes.ContentType , sessions.Session and sites.Site can be stored in any database, given a suitable router. auth models — User , Group and Permission — are linked\ntogether and linked to ContentType , so they must be stored in the same\ndatabase as ContentType . admin depends on auth , so its models must be in the same database\nas auth . flatpages and redirects depend on sites , so their models must be\nin the same database as sites . In addition, some objects are automatically created just after migrate creates a table to hold them in a database: a default Site , a ContentType for each model (including those not stored in that\ndatabase), the Permission s for each model (including those not stored in that\ndatabase). For common setups with multiple databases, it isn’t useful to have these\nobjects in more than one database. Common setups include primary/replica and\nconnecting to external databases. Therefore, it’s recommended to write a database router that allows synchronizing\nthese three models to only one database. Use the same approach for contrib\nand third-party apps that don’t need their tables in multiple databases. Warning If you’re synchronizing content types to more than one database, be aware\nthat their primary keys may not match across databases. This may result in\ndata corruption or data loss.", "keywords": ["users", "get_queryset", "box", "db_for_write", "allow_migrate", "replica2_name", "create_user", "demonstration", "assumes", "corruption", "flatpages", "#", "relation", "eggs", "migrations", "setups", "verypriv@ate", "opinion", "django.db.connections", "change", "s3krit", "label", "=", "changes", "engine", "relationship", "force_insert", "setup", "tables", "postgres", "choice", "topic", "first_name", "following", "django.db.backends.mysql", "type", "custom", "kwargs", "objects", "documentation", "write", "file", "customization", "partition", "spam", "auth_db_name", "strategy", "user", "cases", "obj1", "attribute", "constraints", "time", "contain", "save", "inlinemodeladmin", "setting", "purposes", "app_label", "password", "name", "makemigrations", "rule", "problems", "queries", "primary_name", "manager", "behaviors", "return", "applications", "foo", "cursors", "mh", "parent", "username", "aliases", "relationships", "model.save", "nature", "error", "code", "--database", "auth", "false", "behavior", "access", "migration", "class", "group", "returns", "names", "dna", "u", "snippet", "request", "user_data", "database", "*", "db_for_read", "query", "commands", "postgresql", "migrate", "types", "decisions", "admin", "creation", "customers", "insert", "usage", "pool", "configuration", "step", "module(s", "save(using=", "replica2", "frederick", "validation", "limitations", "replicas", "router", "use", "author", "solution", "mymanager", "operation", "connectiondoesnotexist", "order", "default", "alias", "form", "fred", "option", "classes", "cross", "scheme", "multidbtabularinline", "chain", "cursor", "existence", "routing", "interaction", "way", "publisheradmin", "super", "servers", "replica1", "allocation", "delete_model", "concept", "party", "queryset", "session", "¶", "command", "django.db.backends.postgresql", "parameters", "content", "primary", "multidbmodeladmin", "replication", "result", "integrity", "inconsistencies", "control", "maps", "relations", "def", "fashion", "point", "priv4te", "django.contrib", "string", "_", "harmless", "model.delete", "availability", "databases", "customqueryset", "connections", "primaryreplicarouter", "user_obj", "managers", "douglas", "inlines", "table", "publisher", "models", "history", "copy", "version", "ways", "supers3cret", "level", "customer_data", "route_app_labels", "django", "myapp", "n’t", "db_field", "entry", "p", "book", "db", "practice", "my_db_alias", "value", "adams", "authrouter", "save_model", "contenttype", "policy", "retrieval", "implementation", "data", "base", "guide", "person", "user.objects.using('new_users').create_user", "inline", "runsql", "self", "master", "instance", "legacy_users", "auth_db", "handling", "interface", "constant", "database_routers", "modeladmin", "publishers", "issues", "writes", "./manage.py", "statement", "postgres_user", "utilization", "bacon", "object", "management", "dictionary", "sql", "hints", "bookinline", "consequences", "keyword", "ensures", "present", "others", "rest", "turn", "runpython", "determine", "apps", "formfield_for_foreignkey", "obj2", "restrictions", "innodb", "widgets", "routers", "check", "site", "addition", "example", "app", "primaryreplicarouter.allow_migrate", "db_manager", "list", "sample", "loss", "steps", "read", "model", "django.utils.connection", "place", "application", "dictionaries", "attributes", "approach", "user.objects", "title", "lag", "redirects", "sense", "myisam", "keys", "assignment", "suggestion", "using", "db_set", "significance", "one", "contrib", "sqlite", "delete", "adminsite", "decision", "reads", "validity", "contenttypes", "path", "replica1_name", "allow_relation", "key", "operations", "new_users", "none", "meta", "definitions", "infrastructure", "formfield_for_manytomany", "replica", "api", "sessions", "mysql_user", "support", "hint", "priority", "transactions", "connection", "-", "context", "permission", "files", "import", "mysql", ">", "call", "pk", "foreignkey", "model._meta.model_name", "attempts", "information", "python", "methods", "books", "exception", "details", "method", "django.db", "settings", "argument", "slave", "sites", "state", "model_name", "oracle", "catch", "my_object", "project", "tabularinline"], "type": "documentation"},
{"title": "Paginator | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/paginator/", "content": "Paginator ¶ Django provides a few classes that help you manage paginated data – that is,\ndata that’s split across several pages, with “Previous/Next” links. These\nclasses live in django/core/paginator.py . For examples, see the Pagination topic guide . Paginator class ¶ class Paginator ( object_list , per_page , orphans = 0 , allow_empty_first_page = True , error_messages = None ) [source] ¶ A paginator acts like a sequence of Page when using len() or\niterating it directly. Paginator. object_list ¶ Required. A list, tuple, QuerySet , or other sliceable object with a count() or __len__() method. For consistent pagination, QuerySet s should be ordered, e.g. with an order_by() clause or with a default ordering on the model. Performance issues paginating large QuerySet s If you’re using a QuerySet with a very large number of items,\nrequesting high page numbers might be slow on some databases, because\nthe resulting LIMIT / OFFSET query needs to count the number of OFFSET records which takes longer as the page number gets higher. Paginator. per_page ¶ Required. The maximum number of items to include on a page, not including\norphans (see the orphans optional argument below). Paginator. orphans ¶ Optional. Use this when you don’t want to have a last page with very few\nitems. If the last page would normally have a number of items less than or\nequal to orphans , then those items will be added to the previous page\n(which becomes the last page) instead of leaving the items on a page by\nthemselves. For example, with 23 items, per_page=10 , and orphans=3 ,\nthere will be two pages; the first page with 10 items and the second\n(and last) page with 13 items. orphans defaults to zero, which means\npages are never combined and the last page may have one item. Paginator. allow_empty_first_page ¶ Optional. Whether or not the first page is allowed to be empty.  If False and object_list is  empty, then an EmptyPage error will\nbe raised. Paginator. error_messages ¶ New in Django 5.0. The error_messages argument lets you override the default messages that\nthe paginator will raise. Pass in a dictionary with keys matching the error\nmessages you want to override. Available error message keys are: invalid_page , min_page , and no_results . For example, here is the default error message: >>> from django.core.paginator import Paginator >>> paginator = Paginator ([ 1 , 2 , 3 ], 2 ) >>> paginator . page ( 5 ) Traceback (most recent call last): ... EmptyPage : That page contains no results And here is a custom error message: >>> paginator = Paginator ( ... [ 1 , 2 , 3 ], ... 2 , ... error_messages = { \"no_results\" : \"Page does not exist\" }, ... ) >>> paginator . page ( 5 ) Traceback (most recent call last): ... EmptyPage : Page does not exist Methods ¶ Paginator. get_page ( number ) [source] ¶ Returns a Page object with the given 1-based index, while also\nhandling out of range and invalid page numbers. If the page isn’t a number, it returns the first page. If the page number\nis negative or greater than the number of pages, it returns the last page. Raises an EmptyPage exception only if you specify Paginator(..., allow_empty_first_page=False) and the object_list is\nempty. Paginator. page ( number ) [source] ¶ Returns a Page object with the given 1-based index. Raises PageNotAnInteger if the number cannot be converted to an integer\nby calling int() . Raises EmptyPage if the given page number\ndoesn’t exist. Paginator. get_elided_page_range ( number , * , on_each_side = 3 , on_ends = 2 ) [source] ¶ Returns a 1-based list of page numbers similar to Paginator.page_range , but may add an ellipsis to either or both\nsides of the current page number when Paginator.num_pages is large. The number of pages to include on each side of the current page number is\ndetermined by the on_each_side argument which defaults to 3. The number of pages to include at the beginning and end of page range is\ndetermined by the on_ends argument which defaults to 2. For example, with the default values for on_each_side and on_ends ,\nif the current page is 10 and there are 50 pages, the page range will be [1, 2, '…', 7, 8, 9, 10, 11, 12, 13, '…', 49, 50] . This will result in\npages 7, 8, and 9 to the left of and 11, 12, and 13 to the right of the\ncurrent page as well as pages 1 and 2 at the start and 49 and 50 at the\nend. Raises InvalidPage if the given page number doesn’t exist. Attributes ¶ Paginator. ELLIPSIS ¶ A translatable string used as a substitute for elided page numbers in the\npage range returned by get_elided_page_range() . Default is '…' . Paginator. count [source] ¶ The total number of objects, across all pages. Note When determining the number of objects contained in object_list , Paginator will first try calling object_list.count() . If object_list has no count() method, then Paginator will\nfall back to using len(object_list) . This allows objects, such as QuerySet , to use a more efficient count() method when\navailable. Paginator. num_pages [source] ¶ The total number of pages. Paginator. page_range [source] ¶ A 1-based range iterator of page numbers, e.g. yielding [1, 2, 3, 4] . Page class ¶ You usually won’t construct Page objects by hand – you’ll get them by\niterating Paginator , or by using Paginator.page() . class Page ( object_list , number , paginator ) [source] ¶ A page acts like a sequence of Page.object_list when using len() or iterating it directly. Methods ¶ Page. has_next () [source] ¶ Returns True if there’s a next page. Page. has_previous () [source] ¶ Returns True if there’s a previous page. Page. has_other_pages () [source] ¶ Returns True if there’s a next or previous page. Page. next_page_number () [source] ¶ Returns the next page number. Raises InvalidPage if next page\ndoesn’t exist. Page. previous_page_number () [source] ¶ Returns the previous page number. Raises InvalidPage if previous\npage doesn’t exist. Page. start_index () [source] ¶ Returns the 1-based index of the first object on the page, relative to all\nof the objects in the paginator’s list. For example, when paginating a list\nof 5 objects with 2 objects per page, the second page’s start_index() would return 3 . Page. end_index () [source] ¶ Returns the 1-based index of the last object on the page, relative to all\nof the objects in the paginator’s list. For example, when paginating a list\nof 5 objects with 2 objects per page, the second page’s end_index() would return 4 . Attributes ¶ Page. object_list ¶ The list of objects on this page. Page. number ¶ The 1-based page number for this page. Page. paginator ¶ The associated Paginator object. Exceptions ¶ exception InvalidPage [source] ¶ A base class for exceptions raised when a paginator is passed an invalid\npage number. The Paginator.page() method raises an exception if the requested page is\ninvalid (i.e. not an integer) or contains no objects. Generally, it’s enough\nto catch the InvalidPage exception, but if you’d like more granularity,\nyou can catch either of the following exceptions: exception PageNotAnInteger [source] ¶ Raised when page() is given a value that isn’t an integer. exception EmptyPage [source] ¶ Raised when page() is given a valid value but no objects\nexist on that page. Both of the exceptions are subclasses of InvalidPage , so you can handle\nthem both with except InvalidPage .", "keywords": ["examples", "items", "min_page", "number", "right", "has_next", "messages", "error", "values", "pages", "false", "string", "class", "_", "order_by", "clause", "example", "get_elided_page_range", "list", "returns", "databases", "numbers", "hand", "range", "*", "query", "page", "count", "paginator", "model", "links", "attributes", "django", "=", "pagination", "limit", "n’t", "results", "message", "per_page=10", "value", "granularity", "on_each_side", "source", "get_page", "keys", "invalid_page", "sequence", "django.core.paginator", "data", "item", "no_results", "base", "left", "guide", "topic", "tuple", "error_messages", "paginator.page", "required", "subclasses", "performance", "custom", "objects", "end", "records", "core", "default", "pagenotaninteger", "paginator.num_pages", "sides", "start", "paginator.page_range", "none", "substitute", "classes", "issues", "object_list", "page.object_list", "has_other_pages", "new", "has_previous", "object", "start_index", "len", "offset", "invalidpage", "iterator", "import", "dictionary", "call", "traceback", "per_page", "allow_empty_first_page", "methods", "ellipsis", "end_index", "optional", "index", "exception", "method", "queryset", "integer", "len(object_list", "argument", "¶", "num_pages", "int", "orphans", "side", "beginning", "page_range", "emptypage", "exceptions"], "type": "documentation"},
{"title": "Multiple object mixins | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/mixins-multiple-object/", "content": "Multiple object mixins ¶ MultipleObjectMixin ¶ class django.views.generic.list. MultipleObjectMixin ¶ A mixin that can be used to display a list of objects. If paginate_by is specified, Django will paginate the results returned\nby this. You can specify the page number in the URL in one of two ways: Use the page parameter in the URLconf. For example, this is what\nyour URLconf might look like: path ( \"objects/page<int:page>/\" , PaginatedView . as_view ()), Pass the page number via the page query-string parameter. For\nexample, a URL would look like this: /objects/?page=3 These values and lists are 1-based, not 0-based, so the first page would be\nrepresented as page 1 . For more on pagination, read the pagination documentation . As a special case, you are also permitted to use last as a value for page : /objects/?page=last This allows you to access the final page of results without first having to\ndetermine how many pages there are. Note that page must be either a valid page number or the value last ; any other value for page will result in a 404 error. Extends django.views.generic.base.ContextMixin Methods and Attributes allow_empty ¶ A boolean specifying whether to display the page if no objects are\navailable. If this is False and no objects are available, the view\nwill raise a 404 instead of displaying an empty page. By default, this\nis True . model ¶ The model that this view will display data for. Specifying model = Foo is effectively the same as specifying queryset = Foo.objects.all() , where objects stands for Foo ’s default manager . queryset ¶ A QuerySet that represents the objects. If provided, the value of queryset supersedes the value provided for model . Warning queryset is a class attribute with a mutable value so care\nmust be taken when using it directly. Before using it, either call\nits all() method or\nretrieve it with get_queryset() which takes care of the\ncloning behind the scenes. ordering ¶ A string or list of strings specifying the ordering to apply to the queryset .\nValid values are the same as those for order_by() . paginate_by ¶ An integer specifying how many objects should be displayed per page. If\nthis is given, the view will paginate objects with paginate_by objects per page. The view will\nexpect either a page query string parameter (via request.GET )\nor a page variable specified in the URLconf. paginate_orphans ¶ An integer specifying the number of “overflow” objects the last page\ncan contain. This extends the paginate_by limit on the last\npage by up to paginate_orphans , in order to keep the last page from\nhaving a very small number of objects. page_kwarg ¶ A string specifying the name to use for the page parameter.\nThe view will expect this parameter to be available either as a query\nstring parameter (via request.GET ) or as a kwarg variable specified\nin the URLconf. Defaults to page . paginator_class ¶ The paginator class to be used for pagination. By default, django.core.paginator.Paginator is used. If the custom paginator\nclass doesn’t have the same constructor interface as django.core.paginator.Paginator , you will also need to\nprovide an implementation for get_paginator() . context_object_name ¶ Designates the name of the variable to use in the context. get_queryset () ¶ Get the list of items for this view. This must be an iterable and may\nbe a queryset (in which queryset-specific behavior will be enabled). get_ordering () ¶ Returns a string (or iterable of strings) that defines the ordering that\nwill be applied to the queryset . Returns ordering by default. paginate_queryset ( queryset , page_size ) ¶ Returns a 4-tuple containing ( paginator , page , object_list , is_paginated ). Constructed by paginating queryset into pages of size page_size .\nIf the request contains a page argument, either as a captured URL\nargument or as a GET argument, object_list will correspond to the\nobjects from that page. get_paginate_by ( queryset ) ¶ Returns the number of items to paginate by, or None for no\npagination. By default this returns the value of paginate_by . get_paginator ( queryset , per_page , orphans = 0 , allow_empty_first_page = True ) ¶ Returns an instance of the paginator to use for this view. By default,\ninstantiates an instance of paginator_class . get_paginate_orphans () ¶ An integer specifying the number of “overflow” objects the last page\ncan contain. By default this returns the value of paginate_orphans . get_allow_empty () ¶ Return a boolean specifying whether to display the page if no objects\nare available. If this method returns False and no objects are\navailable, the view will raise a 404 instead of displaying an empty\npage. By default, this is True . get_context_object_name ( object_list ) ¶ Return the context variable name that will be used to contain\nthe list of data that this view is manipulating. If object_list is a queryset of Django objects and context_object_name is not set,\nthe context name will be the model_name of the model that\nthe queryset is composed from, with postfix '_list' appended. For example, the model Article would have a\ncontext object named article_list . get_context_data ( ** kwargs ) ¶ Returns context data for displaying the list of objects. Context object_list : The list of objects that this view is displaying. If context_object_name is specified, that variable will also be set\nin the context, with the same value as object_list . is_paginated : A boolean representing whether the results are\npaginated. Specifically, this is set to False if no page size has\nbeen specified, or if the available objects do not span multiple\npages. paginator : An instance of django.core.paginator.Paginator . If the page is not\npaginated, this context variable will be None . page_obj : An instance of django.core.paginator.Page . If the page is not paginated,\nthis context variable will be None . MultipleObjectTemplateResponseMixin ¶ class django.views.generic.list. MultipleObjectTemplateResponseMixin ¶ A mixin class that performs template-based response rendering for views\nthat operate upon a list of object instances. Requires that the view it is\nmixed with provides self.object_list , the list of object instances that\nthe view is operating on. self.object_list may be, but is not required\nto be, a QuerySet . Extends TemplateResponseMixin Methods and Attributes template_name_suffix ¶ The suffix to append to the auto-generated candidate template name.\nDefault suffix is _list . get_template_names () ¶ Returns a list of candidate template names. Returns the following list: the value of template_name on the view (if provided) <app_label>/<model_name><template_name_suffix>.html", "keywords": ["get_queryset", "views", "view", "items", "contextmixin", "number", "url", "error", "get_paginate_orphans", "values", "pages", "string", "behavior", "false", "class", "example", "lists", "care", "order_by", "_", "paginate_by", "list", "returns", "names", "auto", "kwarg", "request", "template_name_suffix", "*", "query", "page", "postfix", "paginator_class", "ways", "paginator", "strings", "model", "variable", "multipleobjecttemplateresponsemixin", "article", "mixin", "attributes", "django", "=", "pagination", "overflow", "limit", "page>/", "results", "cloning", "urlconf", "paginate_queryset", "value", "get_allow_empty", "suffix", "case", "django.core.paginator", "data", "implementation", "boolean", "mixins", "paginate_orphans", "tuple", "a", "paginatedview", "custom", "foo.objects.all", "instance", "objects", "documentation", "kwargs", "order", "interface", "default", "get_paginate_by", "path", "attribute", "none", "scenes", "warning", "size", "get", "constructor", "object_list", "instances", "get_paginator", "templateresponsemixin", "page_size", "get_template_names", "object", "context", "name", "template", "parameter", "response", "candidate", "defaults", "as_view", "multipleobjectmixin", "/objects/?page", "supersedes", "methods", "allow_empty_first_page", "get_context_object_name", "ordering", "extends", "manager", "django.views.generic.list", "self.object_list", "method", "queryset", "integer", "argument", "¶", "return", "model_name", "foo", "int", "get_context_data", "orphans"], "type": "documentation"},
{"title": "Date-based mixins | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/class-based-views/mixins-date-based/", "content": "Date-based mixins ¶ Note All the date formatting attributes in these mixins use strftime() format characters. Do not try to use the format\ncharacters from the now template tag as they are not compatible. YearMixin ¶ class YearMixin [source] ¶ A mixin that can be used to retrieve and provide parsing information for a\nyear component of a date. Methods and Attributes year_format ¶ The strftime() format to use when parsing the year.\nBy default, this is '%Y' . year ¶ Optional The value for the year, as a string. By default, set to None , which means the year will be determined using other means. get_year_format () [source] ¶ Returns the strftime() format to use when parsing the\nyear. Returns year_format by default. get_year () [source] ¶ Returns the year for which this view will display data, as a string.\nTries the following sources, in order: The value of the YearMixin.year attribute. The value of the year argument captured in the URL pattern. The value of the year GET query argument. Raises a 404 if no valid year specification can be found. get_next_year ( date ) [source] ¶ Returns a date object containing the first day of the year after the\ndate provided. This function can also return None or raise an Http404 exception, depending on the values of allow_empty and allow_future . get_previous_year ( date ) [source] ¶ Returns a date object containing the first day of the year before the\ndate provided. This function can also return None or raise an Http404 exception, depending on the values of allow_empty and allow_future . MonthMixin ¶ class MonthMixin [source] ¶ A mixin that can be used to retrieve and provide parsing information for a\nmonth component of a date. Methods and Attributes month_format ¶ The strftime() format to use when parsing the month. By\ndefault, this is '%b' . month ¶ Optional The value for the month, as a string. By default, set to None , which means the month will be determined using other means. get_month_format () [source] ¶ Returns the strftime() format to use when parsing the\nmonth. Returns month_format by default. get_month () [source] ¶ Returns the month for which this view will display data, as a string.\nTries the following sources, in order: The value of the MonthMixin.month attribute. The value of the month argument captured in the URL pattern. The value of the month GET query argument. Raises a 404 if no valid month specification can be found. get_next_month ( date ) [source] ¶ Returns a date object containing the first day of the month after the\ndate provided. This function can also return None or raise an Http404 exception, depending on the values of allow_empty and allow_future . get_previous_month ( date ) [source] ¶ Returns a date object containing the first day of the month before the\ndate provided. This function can also return None or raise an Http404 exception, depending on the values of allow_empty and allow_future . DayMixin ¶ class DayMixin [source] ¶ A mixin that can be used to retrieve and provide parsing information for a\nday component of a date. Methods and Attributes day_format ¶ The strftime() format to use when parsing the day. By\ndefault, this is '%d' . day ¶ Optional The value for the day, as a string. By default, set to None , which means the day will be determined using other means. get_day_format () [source] ¶ Returns the strftime() format to use when parsing the day.\nReturns day_format by default. get_day () [source] ¶ Returns the day for which this view will display data, as a string.\nTries the following sources, in order: The value of the DayMixin.day attribute. The value of the day argument captured in the URL pattern. The value of the day GET query argument. Raises a 404 if no valid day specification can be found. get_next_day ( date ) [source] ¶ Returns a date object containing the next valid day after the date\nprovided. This function can also return None or raise an Http404 exception, depending on the values of allow_empty and allow_future . get_previous_day ( date ) [source] ¶ Returns a date object containing the previous valid day. This function\ncan also return None or raise an Http404 exception, depending on the values of allow_empty and allow_future . WeekMixin ¶ class WeekMixin [source] ¶ A mixin that can be used to retrieve and provide parsing information for a\nweek component of a date. Methods and Attributes week_format ¶ The strftime() format to use when parsing the week. By\ndefault, this is '%U' , which means the week starts on Sunday. Set\nit to '%W' or '%V' (ISO 8601 week) if your week starts on\nMonday. week ¶ Optional The value for the week, as a string. By default, set to None , which means the week will be determined using other means. get_week_format () [source] ¶ Returns the strftime() format to use when parsing the\nweek. Returns week_format by default. get_week () [source] ¶ Returns the week for which this view will display data, as a string.\nTries the following sources, in order: The value of the WeekMixin.week attribute. The value of the week argument captured in the URL pattern The value of the week GET query argument. Raises a 404 if no valid week specification can be found. get_next_week ( date ) [source] ¶ Returns a date object containing the first day of the week after the\ndate provided. This function can also return None or raise an Http404 exception, depending on the values of allow_empty and allow_future . get_prev_week ( date ) ¶ Returns a date object containing the first day of the week before the\ndate provided. This function can also return None or raise an Http404 exception, depending on the values of allow_empty and allow_future . DateMixin ¶ class DateMixin [source] ¶ A mixin class providing common behavior for all date-based views. Methods and Attributes date_field ¶ The name of the DateField or DateTimeField in the QuerySet ’s model that the date-based archive should use to\ndetermine the list of objects to display on the page. When time zone support is enabled and date_field is a DateTimeField , dates are assumed to be in the\ncurrent time zone. Otherwise, the queryset could include objects from\nthe previous or the next day in the end user’s time zone. Warning In this situation, if you have implemented per-user time zone\nselection, the same URL may show a different set of objects,\ndepending on the end user’s time zone. To avoid this, you should\nuse a DateField as the date_field attribute. allow_future ¶ A boolean specifying whether to include “future” objects on this page,\nwhere “future” means objects in which the field specified in date_field is greater than the current date/time. By default, this\nis False . get_date_field () [source] ¶ Returns the name of the field that contains the date data that this\nview will operate on. Returns date_field by default. get_allow_future () [source] ¶ Determine whether to include “future” objects on this page, where\n“future” means objects in which the field specified in date_field is greater than the current date/time. Returns allow_future by default. BaseDateListView ¶ class BaseDateListView [source] ¶ A base class that provides common behavior for all date-based views. There\nwon’t normally be a reason to instantiate BaseDateListView ; instantiate one of\nthe subclasses instead. While this view (and its subclasses) are executing, self.object_list will contain the list of objects that the view is operating upon, and self.date_list will contain the list of dates for which data is\navailable. Mixins DateMixin MultipleObjectMixin Methods and Attributes allow_empty ¶ A boolean specifying whether to display the page if no objects are\navailable. If this is True and no objects are available, the view\nwill display an empty page instead of raising a 404. This is identical to django.views.generic.list.MultipleObjectMixin.allow_empty ,\nexcept for the default value, which is False . date_list_period ¶ Optional A string defining the aggregation period for date_list . It must be one of 'year' (default), 'month' , or 'day' . get_dated_items () [source] ¶ Returns a 3-tuple containing ( date_list , object_list , extra_context ). date_list is the list of dates for which data is available. object_list is the list of objects. extra_context is a\ndictionary of context data that will be added to any context data\nprovided by the MultipleObjectMixin . get_dated_queryset ( ** lookup ) [source] ¶ Returns a queryset, filtered using the query arguments defined by lookup . Enforces any restrictions on the queryset, such as allow_empty and allow_future . get_date_list_period () [source] ¶ Returns the aggregation period for date_list . Returns date_list_period by default. get_date_list ( queryset , date_type = None , ordering = 'ASC' ) [source] ¶ Returns the list of dates of type date_type for which queryset contains entries. For example, get_date_list(qs, 'year') will\nreturn the list of years for which qs has entries. If date_type isn’t provided, the result of get_date_list_period() is used. date_type and ordering are passed to QuerySet.dates() .", "keywords": ["function", "views", "allow_future", "result", "view", "sunday", "get_next_month", "get_day", "date_field", "zone", "pattern", "selection", "url", "b", "values", "period", "get_date_field", "asc", "string", "behavior", "class", "example", "field", "get_date_list_period", "month", "list", "archive", "returns", "years", "weekmixin", "*", "dates", "query", "page", "datefield", "model", "basedatelistview", "year", "get_prev_week", "get_month_format", "http404", "mixin", "attributes", "datemixin", "=", "y", "daymixin", "set", "get_previous_day", "date_type", "value", "self.date_list", "tag", "yearmixin.year", "get_dated_items", "source", "specification", "get_allow_future", "component", "boolean", "data", "lookup", "mixins", "w", "base", "sources", "get_next_week", "weekmixin.week", "get_date_list", "tuple", "get_week_format", "arguments", "get_previous_month", "type", "get_month", "subclasses", "get_date_list(qs", "objects", "end", "entries", "aggregation", "get_dated_queryset", "order", "default", "user", "monthmixin", "attribute", "none", "get_next_year", "get_day_format", "format", "characters", "get", "time", "day", "object_list", "reason", "date", "restrictions", "iso", "support", "object", "queryset.dates", "enforces", "get_week", "month_format", "context", "name", "d", "template", "week", "%", "dictionary", "information", "multipleobjectmixin", "monday", "strftime", "methods", "get_year_format", "optional", "ordering", "exception", "date_list", "self.object_list", "queryset", "get_year", "argument", "v", "¶", "qs", "get_next_day", "note", "situation", "monthmixin.month", "means", "datetimefield", "yearmixin"], "type": "documentation"},
{"title": "Query Expressions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/expressions/", "content": "Query Expressions ¶ Query expressions describe a value or a computation that can be used as part of\nan update, create, filter, order by, annotation, or aggregate. When an\nexpression outputs a boolean value, it may be used directly in filters. There\nare a number of built-in expressions (documented below) that can be used to\nhelp you write queries. Expressions can be combined, or in some cases nested,\nto form more complex computations. Supported arithmetic ¶ Django supports negation, addition, subtraction, multiplication, division,\nmodulo arithmetic, and the power operator on query expressions, using Python\nconstants, variables, and even other expressions. Output field ¶ Many of the expressions documented in this section support an optional output_field parameter. If given, Django will load the value into that\nfield after retrieving it from the database. output_field takes a model field instance, like IntegerField() or BooleanField() . Usually, the field doesn’t need any arguments, like max_length , since field arguments relate to data validation which will not\nbe performed on the expression’s output value. output_field is only required when Django is unable to automatically\ndetermine the result’s field type, such as complex expressions that mix field\ntypes. For example, adding a DecimalField() and a FloatField() requires\nan output field, like output_field=FloatField() . Some examples ¶ >>> from django.db.models import Count , F , Value >>> from django.db.models.functions import Length , Upper >>> from django.db.models.lookups import GreaterThan # Find companies that have more employees than chairs. >>> Company . objects . filter ( num_employees__gt = F ( \"num_chairs\" )) # Find companies that have at least twice as many employees # as chairs. Both the querysets below are equivalent. >>> Company . objects . filter ( num_employees__gt = F ( \"num_chairs\" ) * 2 ) >>> Company . objects . filter ( num_employees__gt = F ( \"num_chairs\" ) + F ( \"num_chairs\" )) # How many chairs are needed for each company to seat all employees? >>> company = ( ... Company . objects . filter ( num_employees__gt = F ( \"num_chairs\" )) ... . annotate ( chairs_needed = F ( \"num_employees\" ) - F ( \"num_chairs\" )) ... . first () ... ) >>> company . num_employees 120 >>> company . num_chairs 50 >>> company . chairs_needed 70 # Create a new company using expressions. >>> company = Company . objects . create ( name = \"Google\" , ticker = Upper ( Value ( \"goog\" ))) # Be sure to refresh it if you need to access the field. >>> company . refresh_from_db () >>> company . ticker 'GOOG' # Annotate models with an aggregated value. Both forms # below are equivalent. >>> Company . objects . annotate ( num_products = Count ( \"products\" )) >>> Company . objects . annotate ( num_products = Count ( F ( \"products\" ))) # Aggregates can contain complex computations also >>> Company . objects . annotate ( num_offerings = Count ( F ( \"products\" ) + F ( \"services\" ))) # Expressions can also be used in order_by(), either directly >>> Company . objects . order_by ( Length ( \"name\" ) . asc ()) >>> Company . objects . order_by ( Length ( \"name\" ) . desc ()) # or using the double underscore lookup syntax. >>> from django.db.models import CharField >>> from django.db.models.functions import Length >>> CharField . register_lookup ( Length ) >>> Company . objects . order_by ( \"name__length\" ) # Boolean expression can be used directly in filters. >>> from django.db.models import Exists , OuterRef >>> Company . objects . filter ( ... Exists ( Employee . objects . filter ( company = OuterRef ( \"pk\" ), salary__gt = 10 )) ... ) # Lookup expressions can also be used directly in filters >>> Company . objects . filter ( GreaterThan ( F ( \"num_employees\" ), F ( \"num_chairs\" ))) # or annotations. >>> Company . objects . annotate ( ... need_chairs = GreaterThan ( F ( \"num_employees\" ), F ( \"num_chairs\" )), ... ) Built-in Expressions ¶ Note These expressions are defined in django.db.models.expressions and django.db.models.aggregates , but for convenience they’re available and\nusually imported from django.db.models . F() expressions ¶ class F [source] ¶ An F() object represents the value of a model field, transformed value of a\nmodel field, or annotated column. It makes it possible to refer to model field\nvalues and perform database operations using them without actually having to\npull them out of the database into Python memory. Instead, Django uses the F() object to generate an SQL expression that\ndescribes the required operation at the database level. Let’s try this with an example. Normally, one might do something like this: # Tintin filed a news story! reporter = Reporters . objects . get ( name = \"Tintin\" ) reporter . stories_filed += 1 reporter . save () Here, we have pulled the value of reporter.stories_filed from the database\ninto memory and manipulated it using familiar Python operators, and then saved\nthe object back to the database. But instead we could also have done: from django.db.models import F reporter = Reporters . objects . get ( name = \"Tintin\" ) reporter . stories_filed = F ( \"stories_filed\" ) + 1 reporter . save () Although reporter.stories_filed = F('stories_filed') + 1 looks like a\nnormal Python assignment of value to an instance attribute, in fact it’s an SQL\nconstruct describing an operation on the database. When Django encounters an instance of F() , it overrides the standard Python\noperators to create an encapsulated SQL expression; in this case, one which\ninstructs the database to increment the database field represented by reporter.stories_filed . Whatever value is or was on reporter.stories_filed , Python never gets to\nknow about it - it is dealt with entirely by the database. All Python does,\nthrough Django’s F() class, is create the SQL syntax to refer to the field\nand describe the operation. To access the new value saved this way, the object must be reloaded: reporter = Reporters . objects . get ( pk = reporter . pk ) # Or, more succinctly: reporter . refresh_from_db () As well as being used in operations on single instances as above, F() can\nbe used on QuerySets of object instances, with update() . This reduces\nthe two queries we were using above - the get() and the save() - to just one: reporter = Reporters . objects . filter ( name = \"Tintin\" ) reporter . update ( stories_filed = F ( \"stories_filed\" ) + 1 ) We can also use update() to increment\nthe field value on multiple objects - which could be very much faster than\npulling them all into Python from the database, looping over them, incrementing\nthe field value of each one, and saving each one back to the database: Reporter . objects . update ( stories_filed = F ( \"stories_filed\" ) + 1 ) F() therefore can offer performance advantages by: getting the database, rather than Python, to do work reducing the number of queries some operations require Slicing F() expressions ¶ New in Django 5.1. For string-based fields, text-based fields, and ArrayField , you can use Python’s\narray-slicing syntax. The indices are 0-based and the step argument to slice is not supported. For example: >>> # Replacing a name with a substring of itself. >>> writer = Writers . objects . get ( name = \"Priyansh\" ) >>> writer . name = F ( \"name\" )[ 1 : 5 ] >>> writer . save () >>> writer . refresh_from_db () >>> writer . name 'riya' Avoiding race conditions using F() ¶ Another useful benefit of F() is that having the database - rather than\nPython - update a field’s value avoids a race condition . If two Python threads execute the code in the first example above, one thread\ncould retrieve, increment, and save a field’s value after the other has\nretrieved it from the database. The value that the second thread saves will be\nbased on the original value; the work of the first thread will be lost. If the database is responsible for updating the field, the process is more\nrobust: it will only ever update the field based on the value of the field in\nthe database when the save() or update() is executed, rather\nthan based on its value when the instance was retrieved. F() assignments persist after Model.save() ¶ F() objects assigned to model fields persist after saving the model\ninstance and will be applied on each save() . For example: reporter = Reporters . objects . get ( name = \"Tintin\" ) reporter . stories_filed = F ( \"stories_filed\" ) + 1 reporter . save () reporter . name = \"Tintin Jr.\" reporter . save () stories_filed will be updated twice in this case. If it’s initially 1 ,\nthe final value will be 3 . This persistence can be avoided by reloading the\nmodel object after saving it, for example, by using refresh_from_db() . Using F() in filters ¶ F() is also very useful in QuerySet filters, where they make it\npossible to filter a set of objects against criteria based on their field\nvalues, rather than on Python values. This is documented in using F() expressions in queries . Using F() with annotations ¶ F() can be used to create dynamic fields on your models by combining\ndifferent fields with arithmetic: company = Company . objects . annotate ( chairs_needed = F ( \"num_employees\" ) - F ( \"num_chairs\" )) If the fields that you’re combining are of different types you’ll need to tell\nDjango what kind of field will be returned. Most expressions support output_field for this case, but since F() does not, you\nwill need to wrap the expression with ExpressionWrapper : from django.db.models import DateTimeField , ExpressionWrapper , F Ticket . objects . annotate ( expires = ExpressionWrapper ( F ( \"active_at\" ) + F ( \"duration\" ), output_field = DateTimeField () ) ) When referencing relational fields such as ForeignKey , F() returns the\nprimary key value rather than a model instance: >>> car = Company . objects . annotate ( built_by = F ( \"manufacturer\" ))[ 0 ] >>> car . manufacturer <Manufacturer: Toyota> >>> car . built_by 3 Using F() to sort null values ¶ Use F() and the nulls_first or nulls_last keyword argument to Expression.asc() or desc() to control the ordering of\na field’s null values. By default, the ordering depends on your database. For example, to sort companies that haven’t been contacted ( last_contacted is null) after companies that have been contacted: from django.db.models import F Company . objects . order_by ( F ( \"last_contacted\" ) . desc ( nulls_last = True )) Using F() with logical operations ¶ F() expressions that output BooleanField can be logically negated with\nthe inversion operator ~F() . For example, to swap the activation status of\ncompanies: from django.db.models import F Company . objects . update ( is_active =~ F ( \"is_active\" )) Func() expressions ¶ Func() expressions are the base type of all expressions that involve\ndatabase functions like COALESCE and LOWER , or aggregates like SUM .\nThey can be used directly: from django.db.models import F , Func queryset . annotate ( field_lower = Func ( F ( \"field\" ), function = \"LOWER\" )) or they can be used to build a library of database functions: class Lower ( Func ): function = \"LOWER\" queryset . annotate ( field_lower = Lower ( \"field\" )) But both cases will result in a queryset where each model is annotated with an\nextra attribute field_lower produced, roughly, from the following SQL: SELECT ... LOWER ( \"db_table\" . \"field\" ) as \"field_lower\" See Database Functions for a list of built-in database functions. The Func API is as follows: class Func ( * expressions , ** extra ) [source] ¶ function ¶ A class attribute describing the function that will be generated.\nSpecifically, the function will be interpolated as the function placeholder within template . Defaults to None . template ¶ A class attribute, as a format string, that describes the SQL that is\ngenerated for this function. Defaults to '%(function)s(%(expressions)s)' . If you’re constructing SQL like strftime('%W', 'date') and need a\nliteral % character in the query, quadruple it ( %%%% ) in the template attribute because the string is interpolated twice: once\nduring the template interpolation in as_sql() and once in the SQL\ninterpolation with the query parameters in the database cursor. arg_joiner ¶ A class attribute that denotes the character used to join the list of expressions together. Defaults to ', ' . arity ¶ A class attribute that denotes the number of arguments the function\naccepts. If this attribute is set and the function is called with a\ndifferent number of expressions, TypeError will be raised. Defaults\nto None . as_sql ( compiler , connection , function = None , template = None , arg_joiner = None , ** extra_context ) [source] ¶ Generates the SQL fragment for the database function. Returns a tuple (sql, params) , where sql is the SQL string, and params is\nthe list or tuple of query parameters. The as_vendor() methods should use the function , template , arg_joiner , and any other **extra_context parameters to\ncustomize the SQL as needed. For example: django/db/models/functions.py ¶ class ConcatPair ( Func ): ... function = \"CONCAT\" ... def as_mysql ( self , compiler , connection , ** extra_context ): return super () . as_sql ( compiler , connection , function = \"CONCAT_WS\" , template = \" %(function)s ('', %(expressions)s )\" , ** extra_context ) To avoid an SQL injection vulnerability, extra_context must\nnot contain untrusted user input as these values are interpolated into the SQL string rather than passed\nas query parameters, where the database driver would escape them. The *expressions argument is a list of positional expressions that the\nfunction will be applied to. The expressions will be converted to strings,\njoined together with arg_joiner , and then interpolated into the template as the expressions placeholder. Positional arguments can be expressions or Python values. Strings are\nassumed to be column references and will be wrapped in F() expressions\nwhile other values will be wrapped in Value() expressions. The **extra kwargs are key=value pairs that can be interpolated\ninto the template attribute. To avoid an SQL injection vulnerability, extra must not contain untrusted user input as these values are interpolated\ninto the SQL string rather than passed as query parameters, where the database\ndriver would escape them. The function , template , and arg_joiner keywords can be used to\nreplace the attributes of the same name without having to define your own\nclass. output_field can be used to define the expected\nreturn type. Aggregate() expressions ¶ An aggregate expression is a special case of a Func() expression that informs the query that a GROUP BY clause\nis required. All of the aggregate functions ,\nlike Sum() and Count() , inherit from Aggregate() . Since Aggregate s are expressions and wrap expressions, you can represent\nsome complex computations: from django.db.models import Count Company . objects . annotate ( managers_required = ( Count ( \"num_employees\" ) / 4 ) + Count ( \"num_managers\" ) ) The Aggregate API is as follows: class Aggregate ( * expressions , output_field = None , distinct = False , filter = None , default = None , ** extra ) [source] ¶ template ¶ A class attribute, as a format string, that describes the SQL that is\ngenerated for this aggregate. Defaults to '%(function)s(%(distinct)s%(expressions)s)' . function ¶ A class attribute describing the aggregate function that will be\ngenerated. Specifically, the function will be interpolated as the function placeholder within template . Defaults to None . window_compatible ¶ Defaults to True since most aggregate functions can be used as the\nsource expression in Window . allow_distinct ¶ A class attribute determining whether or not this aggregate function\nallows passing a distinct keyword argument. If set to False (default), TypeError is raised if distinct=True is passed. empty_result_set_value ¶ Defaults to None since most aggregate functions result in NULL when applied to an empty result set. The expressions positional arguments can include expressions, transforms of\nthe model field, or the names of model fields. They will be converted to a\nstring and used as the expressions placeholder within the template . The distinct argument determines whether or not the aggregate function\nshould be invoked for each distinct value of expressions (or set of\nvalues, for multiple expressions ). The argument is only supported on\naggregates that have allow_distinct set to True . The filter argument takes a Q object that’s\nused to filter the rows that are aggregated. See Conditional aggregation and Filtering on annotations for example usage. The default argument takes a value that will be passed along with the\naggregate to Coalesce . This is useful for\nspecifying a value to be returned other than None when the queryset (or\ngrouping) contains no entries. The **extra kwargs are key=value pairs that can be interpolated\ninto the template attribute. Creating your own Aggregate Functions ¶ You can create your own aggregate functions, too. At a minimum, you need to\ndefine function , but you can also completely customize the SQL that is\ngenerated. Here’s a brief example: from django.db.models import Aggregate class Sum ( Aggregate ): # Supports SUM(ALL field). function = \"SUM\" template = \" %(function)s ( %(all_values)s%(expressions)s )\" allow_distinct = False def __init__ ( self , expression , all_values = False , ** extra ): super () . __init__ ( expression , all_values = \"ALL \" if all_values else \"\" , ** extra ) Value() expressions ¶ class Value ( value , output_field = None ) [source] ¶ A Value() object represents the smallest possible component of an\nexpression: a simple value. When you need to represent the value of an integer,\nboolean, or string within an expression, you can wrap that value within a Value() . You will rarely need to use Value() directly. When you write the expression F('field') + 1 , Django implicitly wraps the 1 in a Value() ,\nallowing simple values to be used in more complex expressions. You will need to\nuse Value() when you want to pass a string to an expression. Most\nexpressions interpret a string argument as the name of a field, like Lower('name') . The value argument describes the value to be included in the expression,\nsuch as 1 , True , or None . Django knows how to convert these Python\nvalues into their corresponding database type. If no output_field is specified, it will be inferred from\nthe type of the provided value for many common types. For example, passing\nan instance of datetime.datetime as value defaults output_field to DateTimeField . ExpressionWrapper() expressions ¶ class ExpressionWrapper ( expression , output_field ) [source] ¶ ExpressionWrapper surrounds another expression and provides access to\nproperties, such as output_field , that may not be\navailable on other expressions. ExpressionWrapper is necessary when using\narithmetic on F() expressions with different types as described in Using F() with annotations . Conditional expressions ¶ Conditional expressions allow you to use if … elif … else logic in queries. Django natively supports SQL CASE expressions. For more details see Conditional Expressions . Subquery() expressions ¶ class Subquery ( queryset , output_field = None ) [source] ¶ You can add an explicit subquery to a QuerySet using the Subquery expression. For example, to annotate each post with the email address of the author of the\nnewest comment on that post: >>> from django.db.models import OuterRef , Subquery >>> newest = Comment . objects . filter ( post = OuterRef ( \"pk\" )) . order_by ( \"-created_at\" ) >>> Post . objects . annotate ( newest_commenter_email = Subquery ( newest . values ( \"email\" )[: 1 ])) On PostgreSQL, the SQL looks like: SELECT \"post\" . \"id\" , ( SELECT U0 . \"email\" FROM \"comment\" U0 WHERE U0 . \"post_id\" = ( \"post\" . \"id\" ) ORDER BY U0 . \"created_at\" DESC LIMIT 1 ) AS \"newest_commenter_email\" FROM \"post\" Note The examples in this section are designed to show how to force\nDjango to execute a subquery. In some cases it may be possible to\nwrite an equivalent queryset that performs the same task more\nclearly or efficiently. Referencing columns from the outer queryset ¶ class OuterRef ( field ) [source] ¶ Use OuterRef when a queryset in a Subquery needs to refer to a field\nfrom the outer query or its transform. It acts like an F expression\nexcept that the check to see if it refers to a valid field isn’t made until the\nouter queryset is resolved. Instances of OuterRef may be used in conjunction with nested instances\nof Subquery to refer to a containing queryset that isn’t the immediate\nparent. For example, this queryset would need to be within a nested pair of Subquery instances to resolve correctly: >>> Book . objects . filter ( author = OuterRef ( OuterRef ( \"pk\" ))) Limiting a subquery to a single column ¶ There are times when a single column must be returned from a Subquery , for\ninstance, to use a Subquery as the target of an __in lookup. To return\nall comments for posts published within the last day: >>> from datetime import timedelta >>> from django.utils import timezone >>> one_day_ago = timezone . now () - timedelta ( days = 1 ) >>> posts = Post . objects . filter ( published_at__gte = one_day_ago ) >>> Comment . objects . filter ( post__in = Subquery ( posts . values ( \"pk\" ))) In this case, the subquery must use values() to return only a single column: the primary key of the post. Limiting the subquery to a single row ¶ To prevent a subquery from returning multiple rows, a slice ( [:1] ) of the\nqueryset is used: >>> subquery = Subquery ( newest . values ( \"email\" )[: 1 ]) >>> Post . objects . annotate ( newest_commenter_email = subquery ) In this case, the subquery must only return a single column and a single\nrow: the email address of the most recently created comment. (Using get() instead of a slice would fail because the OuterRef cannot be resolved until the queryset is used within a Subquery .) Exists() subqueries ¶ class Exists ( queryset ) [source] ¶ Exists is a Subquery subclass that uses an SQL EXISTS statement. In\nmany cases it will perform better than a subquery since the database is able to\nstop evaluation of the subquery when a first matching row is found. For example, to annotate each post with whether or not it has a comment from\nwithin the last day: >>> from django.db.models import Exists , OuterRef >>> from datetime import timedelta >>> from django.utils import timezone >>> one_day_ago = timezone . now () - timedelta ( days = 1 ) >>> recent_comments = Comment . objects . filter ( ... post = OuterRef ( \"pk\" ), ... created_at__gte = one_day_ago , ... ) >>> Post . objects . annotate ( recent_comment = Exists ( recent_comments )) On PostgreSQL, the SQL looks like: SELECT \"post\" . \"id\" , \"post\" . \"published_at\" , EXISTS ( SELECT ( 1 ) as \"a\" FROM \"comment\" U0 WHERE ( U0 . \"created_at\" >= YYYY - MM - DD HH : MM : SS AND U0 . \"post_id\" = \"post\" . \"id\" ) LIMIT 1 ) AS \"recent_comment\" FROM \"post\" It’s unnecessary to force Exists to refer to a single column, since the\ncolumns are discarded and a boolean result is returned. Similarly, since\nordering is unimportant within an SQL EXISTS subquery and would only\ndegrade performance, it’s automatically removed. You can query using NOT EXISTS with ~Exists() . Filtering on a Subquery() or Exists() expressions ¶ Subquery() that returns a boolean value and Exists() may be used as a condition in When expressions, or to\ndirectly filter a queryset: >>> recent_comments = Comment . objects . filter ( ... ) # From above >>> Post . objects . filter ( Exists ( recent_comments )) This will ensure that the subquery will not be added to the SELECT columns,\nwhich may result in a better performance. Using aggregates within a Subquery expression ¶ Aggregates may be used within a Subquery , but they require a specific\ncombination of filter() , values() , and annotate() to get the subquery grouping correct. Assuming both models have a length field, to find posts where the post\nlength is greater than the total length of all combined comments: >>> from django.db.models import OuterRef , Subquery , Sum >>> comments = Comment . objects . filter ( post = OuterRef ( \"pk\" )) . order_by () . values ( \"post\" ) >>> total_comments = comments . annotate ( total = Sum ( \"length\" )) . values ( \"total\" ) >>> Post . objects . filter ( length__gt = Subquery ( total_comments )) The initial filter(...) limits the subquery to the relevant parameters. order_by() removes the default ordering (if any) on the Comment model. values('post') aggregates comments by Post . Finally, annotate(...) performs the aggregation. The order in\nwhich these queryset methods are applied is important. In this case, since the\nsubquery must be limited to a single column, values('total') is required. This is the only way to perform an aggregation within a Subquery , as\nusing aggregate() attempts to evaluate the queryset (and if\nthere is an OuterRef , this will not be possible to resolve). Raw SQL expressions ¶ class RawSQL ( sql , params , output_field = None ) [source] ¶ Sometimes database expressions can’t easily express a complex WHERE clause.\nIn these edge cases, use the RawSQL expression. For example: >>> from django.db.models.expressions import RawSQL >>> queryset . annotate ( val = RawSQL ( \"select col from sometable where othercol = %s \" , ( param ,))) These extra lookups may not be portable to different database engines (because\nyou’re explicitly writing SQL code) and violate the DRY principle, so you\nshould avoid them if possible. RawSQL expressions can also be used as the target of __in filters: >>> queryset . filter ( id__in = RawSQL ( \"select id from sometable where col = %s \" , ( param ,))) Warning To protect against SQL injection attacks , you must escape any\nparameters that the user can control by using params . params is a\nrequired argument to force you to acknowledge that you’re not interpolating\nyour SQL with user-provided data. You also must not quote placeholders in the SQL string. This example is\nvulnerable to SQL injection because of the quotes around %s : RawSQL ( \"select col from sometable where othercol = ' %s '\" ) # unsafe! You can read more about how Django’s SQL injection protection works. Window functions ¶ Window functions provide a way to apply functions on partitions. Unlike a\nnormal aggregation function which computes a final result for each set defined\nby the group by, window functions operate on frames and\npartitions, and compute the result for each row. You can specify multiple windows in the same query which in Django ORM would be\nequivalent to including multiple expressions in a QuerySet.annotate() call. The ORM doesn’t make use of named windows,\ninstead they are part of the selected columns. class Window ( expression , partition_by = None , order_by = None , frame = None , output_field = None ) [source] ¶ template ¶ Defaults to %(expression)s OVER (%(window)s) . If only the expression argument is provided, the window clause will be blank. The Window class is the main expression for an OVER clause. The expression argument is either a window function , an aggregate function , or\nan expression that’s compatible in a window clause. The partition_by argument accepts an expression or a sequence of\nexpressions (column names should be wrapped in an F -object) that control\nthe partitioning of the rows.  Partitioning narrows which rows are used to\ncompute the result set. The output_field is specified either as an argument or by\nthe expression. The order_by argument accepts an expression on which you can call asc() and desc() , a string of a field name (with an\noptional \"-\" prefix which indicates descending order), or a tuple or list\nof strings and/or expressions. The ordering controls the order in which the\nexpression is applied. For example, if you sum over the rows in a partition,\nthe first result is the value of the first row, the second is the sum of first\nand second row. The frame parameter specifies which other rows that should be used in the\ncomputation. See Frames for details. For example, to annotate each movie with the average rating for the movies by\nthe same studio in the same genre and release year: >>> from django.db.models import Avg , F , Window >>> Movie . objects . annotate ( ... avg_rating = Window ( ... expression = Avg ( \"rating\" ), ... partition_by = [ F ( \"studio\" ), F ( \"genre\" )], ... order_by = \"released__year\" , ... ), ... ) This allows you to check if a movie is rated better or worse than its peers. You may want to apply multiple expressions over the same window, i.e., the\nsame partition and frame. For example, you could modify the previous example\nto also include the best and worst rating in each movie’s group (same studio,\ngenre, and release year) by using three window functions in the same query. The\npartition and ordering from the previous example is extracted into a dictionary\nto reduce repetition: >>> from django.db.models import Avg , F , Max , Min , Window >>> window = { ... \"partition_by\" : [ F ( \"studio\" ), F ( \"genre\" )], ... \"order_by\" : \"released__year\" , ... } >>> Movie . objects . annotate ( ... avg_rating = Window ( ... expression = Avg ( \"rating\" ), ... ** window , ... ), ... best = Window ( ... expression = Max ( \"rating\" ), ... ** window , ... ), ... worst = Window ( ... expression = Min ( \"rating\" ), ... ** window , ... ), ... ) Filtering against window functions is supported as long as lookups are not\ndisjunctive (not using OR or XOR as a connector) and against a queryset\nperforming aggregation. For example, a query that relies on aggregation and has an OR -ed filter\nagainst a window function and a field is not supported. Applying combined\npredicates post-aggregation could cause rows that would normally be excluded\nfrom groups to be included: >>> qs = Movie . objects . annotate ( ... category_rank = Window ( Rank (), partition_by = \"category\" , order_by = \"-rating\" ), ... scenes_count = Count ( \"actors\" ), ... ) . filter ( Q ( category_rank__lte = 3 ) | Q ( title__contains = \"Batman\" )) >>> list ( qs ) NotImplementedError: Heterogeneous disjunctive predicates against window functions are not implemented when performing conditional aggregation. Among Django’s built-in database backends, MySQL, PostgreSQL, and Oracle\nsupport window expressions. Support for different window expression features\nvaries among the different databases. For example, the options in asc() and desc() may not be supported. Consult the\ndocumentation for your database as needed. Frames ¶ For a window frame, you can choose either a range-based sequence of rows or an\nordinary sequence of rows. class ValueRange ( start = None , end = None , exclusion = None ) [source] ¶ frame_type ¶ This attribute is set to 'RANGE' . PostgreSQL has limited support for ValueRange and only supports use of\nthe standard start and end points, such as CURRENT ROW and UNBOUNDED FOLLOWING . Changed in Django 5.1: The exclusion argument was added. class RowRange ( start = None , end = None , exclusion = None ) [source] ¶ frame_type ¶ This attribute is set to 'ROWS' . Changed in Django 5.1: The exclusion argument was added. Both classes return SQL with the template: % ( frame_type ) s BETWEEN % ( start ) s AND % ( end ) s class WindowFrameExclusion [source] ¶ New in Django 5.1. CURRENT_ROW ¶ GROUP ¶ TIES ¶ NO_OTHERS ¶ The exclusion argument allows excluding rows\n( CURRENT_ROW ), groups\n( GROUP ), and ties\n( TIES ) from the window frames on supported\ndatabases: % ( frame_type ) s BETWEEN % ( start ) s AND % ( end ) s EXCLUDE % ( exclusion ) s Frames narrow the rows that are used for computing the result. They shift from\nsome start point to some specified end point. Frames can be used with and\nwithout partitions, but it’s often a good idea to specify an ordering of the\nwindow to ensure a deterministic result. In a frame, a peer in a frame is a row\nwith an equivalent value, or all rows if an ordering clause isn’t present. The default starting point for a frame is UNBOUNDED PRECEDING which is the\nfirst row of the partition. The end point is always explicitly included in the\nSQL generated by the ORM and is by default UNBOUNDED FOLLOWING . The default\nframe includes all rows from the partition to the last row in the set. The accepted values for the start and end arguments are None , an\ninteger, or zero. A negative integer for start results in N PRECEDING ,\nwhile None yields UNBOUNDED PRECEDING . In ROWS mode, a positive\ninteger can be used for start resulting in N FOLLOWING . Positive\nintegers are accepted for end and results in N FOLLOWING . In ROWS mode, a negative integer can be used for end resulting in N PRECEDING .\nFor both start and end , zero will return CURRENT ROW . There’s a difference in what CURRENT ROW includes. When specified in ROWS mode, the frame starts or ends with the current row. When specified in RANGE mode, the frame starts or ends at the first or last peer according to\nthe ordering clause. Thus, RANGE CURRENT ROW evaluates the expression for\nrows which have the same value specified by the ordering. Because the template\nincludes both the start and end points, this may be expressed with: ValueRange ( start = 0 , end = 0 ) If a movie’s “peers” are described as movies released by the same studio in the\nsame genre in the same year, this RowRange example annotates each movie\nwith the average rating of a movie’s two prior and two following peers: >>> from django.db.models import Avg , F , RowRange , Window >>> Movie . objects . annotate ( ... avg_rating = Window ( ... expression = Avg ( \"rating\" ), ... partition_by = [ F ( \"studio\" ), F ( \"genre\" )], ... order_by = \"released__year\" , ... frame = RowRange ( start =- 2 , end = 2 ), ... ), ... ) If the database supports it, you can specify the start and end points based on\nvalues of an expression in the partition. If the released field of the Movie model stores the release month of each movie, this ValueRange example annotates each movie with the average rating of a movie’s peers\nreleased between twelve months before and twelve months after each movie: >>> from django.db.models import Avg , F , ValueRange , Window >>> Movie . objects . annotate ( ... avg_rating = Window ( ... expression = Avg ( \"rating\" ), ... partition_by = [ F ( \"studio\" ), F ( \"genre\" )], ... order_by = \"released__year\" , ... frame = ValueRange ( start =- 12 , end = 12 ), ... ), ... ) Changed in Django 5.1: Support for positive integer start and negative integer end was\nadded for RowRange . Technical Information ¶ Below you’ll find technical implementation details that may be useful to\nlibrary authors. The technical API and examples below will help with\ncreating generic query expressions that can extend the built-in functionality\nthat Django provides. Expression API ¶ Query expressions implement the query expression API ,\nbut also expose a number of extra methods and attributes listed below. All\nquery expressions must inherit from Expression() or a relevant\nsubclass. When a query expression wraps another expression, it is responsible for\ncalling the appropriate methods on the wrapped expression. class Expression [source] ¶ allowed_default ¶ New in Django 5.0. Tells Django that this expression can be used in Field.db_default . Defaults to False . constraint_validation_compatible ¶ New in Django 5.1. Tells Django that this expression can be used during a constraint\nvalidation. Expressions with constraint_validation_compatible set\nto False must have only one source expression. Defaults to True . contains_aggregate ¶ Tells Django that this expression contains an aggregate and that a GROUP BY clause needs to be added to the query. contains_over_clause ¶ Tells Django that this expression contains a Window expression. It’s used,\nfor example, to disallow window function expressions in queries that\nmodify data. filterable ¶ Tells Django that this expression can be referenced in QuerySet.filter() . Defaults to True . window_compatible ¶ Tells Django that this expression can be used as the source expression\nin Window . Defaults to False . empty_result_set_value ¶ Tells Django which value should be returned when the expression is used\nto apply a function over an empty result set. Defaults to NotImplemented which forces the expression to be computed on\nthe database. resolve_expression ( query = None , allow_joins = True , reuse = None , summarize = False , for_save = False ) ¶ Provides the chance to do any preprocessing or validation of\nthe expression before it’s added to the query. resolve_expression() must also be called on any nested expressions. A copy() of self should be returned with any necessary transformations. query is the backend query implementation. allow_joins is a boolean that allows or denies the use of\njoins in the query. reuse is a set of reusable joins for multi-join scenarios. summarize is a boolean that, when True , signals that the\nquery being computed is a terminal aggregate query. for_save is a boolean that, when True , signals that the query\nbeing executed is performing a create or update. get_source_expressions () ¶ Returns an ordered list of inner expressions. For example: >>> Sum ( F ( \"foo\" )) . get_source_expressions () [F('foo')] set_source_expressions ( expressions ) ¶ Takes a list of expressions and stores them such that get_source_expressions() can return them. relabeled_clone ( change_map ) ¶ Returns a clone (copy) of self , with any column aliases relabeled.\nColumn aliases are renamed when subqueries are created. relabeled_clone() should also be called on any nested expressions\nand assigned to the clone. change_map is a dictionary mapping old aliases to new aliases. Example: def relabeled_clone ( self , change_map ): clone = copy . copy ( self ) clone . expression = self . expression . relabeled_clone ( change_map ) return clone convert_value ( value , expression , connection ) ¶ A hook allowing the expression to coerce value into a more\nappropriate type. expression is the same as self . get_group_by_cols () ¶ Responsible for returning the list of columns references by\nthis expression. get_group_by_cols() should be called on any\nnested expressions. F() objects, in particular, hold a reference\nto a column. asc ( nulls_first = None , nulls_last = None ) ¶ Returns the expression ready to be sorted in ascending order. nulls_first and nulls_last define how null values are sorted.\nSee Using F() to sort null values for example usage. desc ( nulls_first = None , nulls_last = None ) ¶ Returns the expression ready to be sorted in descending order. nulls_first and nulls_last define how null values are sorted.\nSee Using F() to sort null values for example usage. reverse_ordering () ¶ Returns self with any modifications required to reverse the sort\norder within an order_by call. As an example, an expression\nimplementing NULLS LAST would change its value to be NULLS FIRST . Modifications are only required for expressions that\nimplement sort order like OrderBy . This method is called when reverse() is called on a\nqueryset. Writing your own Query Expressions ¶ You can write your own query expression classes that use, and can integrate\nwith, other query expressions. Let’s step through an example by writing an\nimplementation of the COALESCE SQL function, without using the built-in Func() expressions . The COALESCE SQL function is defined as taking a list of columns or\nvalues. It will return the first column or value that isn’t NULL . We’ll start by defining the template to be used for SQL generation and\nan __init__() method to set some attributes: import copy from django.db.models import Expression class Coalesce ( Expression ): template = \"COALESCE( %(expressions)s )\" def __init__ ( self , expressions , output_field ): super () . __init__ ( output_field = output_field ) if len ( expressions ) < 2 : raise ValueError ( \"expressions must have at least 2 elements\" ) for expression in expressions : if not hasattr ( expression , \"resolve_expression\" ): raise TypeError ( \" %r is not an Expression\" % expression ) self . expressions = expressions We do some basic validation on the parameters, including requiring at least 2\ncolumns or values, and ensuring they are expressions. We are requiring output_field here so that Django knows what kind of model\nfield to assign the eventual result to. Now we implement the preprocessing and validation. Since we do not have\nany of our own validation at this point, we delegate to the nested\nexpressions: def resolve_expression ( self , query = None , allow_joins = True , reuse = None , summarize = False , for_save = False ): c = self . copy () c . is_summary = summarize for pos , expression in enumerate ( self . expressions ): c . expressions [ pos ] = expression . resolve_expression ( query , allow_joins , reuse , summarize , for_save ) return c Next, we write the method responsible for generating the SQL: def as_sql ( self , compiler , connection , template = None ): sql_expressions , sql_params = [], [] for expression in self . expressions : sql , params = compiler . compile ( expression ) sql_expressions . append ( sql ) sql_params . extend ( params ) template = template or self . template data = { \"expressions\" : \",\" . join ( sql_expressions )} return template % data , sql_params def as_oracle ( self , compiler , connection ): \"\"\" Example of vendor specific handling (Oracle in this case). Let's make the function name lowercase. \"\"\" return self . as_sql ( compiler , connection , template = \"coalesce( %(expressions)s )\" ) as_sql() methods can support custom keyword arguments, allowing as_vendorname() methods to override data used to generate the SQL string.\nUsing as_sql() keyword arguments for customization is preferable to\nmutating self within as_vendorname() methods as the latter can lead to\nerrors when running on different database backends. If your class relies on\nclass attributes to define data, consider allowing overrides in your as_sql() method. We generate the SQL for each of the expressions by using the compiler.compile() method, and join the result together with commas.\nThen the template is filled out with our data and the SQL and parameters\nare returned. We’ve also defined a custom implementation that is specific to the Oracle\nbackend. The as_oracle() function will be called instead of as_sql() if the Oracle backend is in use. Finally, we implement the rest of the methods that allow our query expression\nto play nice with other query expressions: def get_source_expressions ( self ): return self . expressions def set_source_expressions ( self , expressions ): self . expressions = expressions Let’s see how it works: >>> from django.db.models import F , Value , CharField >>> qs = Company . objects . annotate ( ... tagline = Coalesce ( ... [ F ( \"motto\" ), F ( \"ticker_name\" ), F ( \"description\" ), Value ( \"No Tagline\" )], ... output_field = CharField (), ... ) ... ) >>> for c in qs : ... print ( \" %s : %s \" % ( c . name , c . tagline )) ... Google: Do No Evil Apple: AAPL Yahoo: Internet Company Django Software Foundation: No Tagline Avoiding SQL injection ¶ Since a Func ’s keyword arguments for __init__() ( **extra ) and as_sql() ( **extra_context ) are interpolated into the SQL string rather\nthan passed as query parameters (where the database driver would escape them),\nthey must not contain untrusted user input. For example, if substring is user-provided, this function is vulnerable to\nSQL injection: from django.db.models import Func class Position ( Func ): function = \"POSITION\" template = \" %(function)s (' %(substring)s ' in %(expressions)s )\" def __init__ ( self , expression , substring ): # substring=substring is an SQL injection vulnerability! super () . __init__ ( expression , substring = substring ) This function generates an SQL string without any parameters. Since substring is passed to super().__init__() as a keyword argument, it’s\ninterpolated into the SQL string before the query is sent to the database. Here’s a corrected rewrite: class Position ( Func ): function = \"POSITION\" arg_joiner = \" IN \" def __init__ ( self , expression , substring ): super () . __init__ ( substring , expression ) With substring instead passed as a positional argument, it’ll be passed as\na parameter in the database query. Adding support in third-party database backends ¶ If you’re using a database backend that uses a different SQL syntax for a\ncertain function, you can add support for it by monkey patching a new method\nonto the function’s class. Let’s say we’re writing a backend for Microsoft’s SQL Server which uses the SQL LEN instead of LENGTH for the Length function.\nWe’ll monkey patch a new method called as_sqlserver() onto the Length class: from django.db.models.functions import Length def sqlserver_length ( self , compiler , connection ): return self . as_sql ( compiler , connection , function = \"LEN\" ) Length . as_sqlserver = sqlserver_length You can also customize the SQL using the template parameter of as_sql() . We use as_sqlserver() because django.db.connection.vendor returns sqlserver for the backend. Third-party backends can register their functions in the top level __init__.py file of the backend package or in a top level expressions.py file (or package) that is imported from the top level __init__.py . For user projects wishing to patch the backend that they’re using, this code\nshould live in an AppConfig.ready() method.", "keywords": ["queryset.filter", "rows", "employee", "peer", "integerfield", "slicing", "get_group_by_cols", "num_offerings", "get_source_expressions", "partition_by", "library", "field.db_default", "field", "#", "outerref", "ticker", "total", "division", "stores", "range", "transforms", "arg_joiner", "companies", "sqlserver_length", "annotation", "othercol", "arity", "window)s", "lower('name", "hook", "values('total", "=", "notimplemented", "results", "min", "subquery", "concatpair", "toyota", "n", "months", "fact", "character", "assignments", "super().__init", "rewrite", "for_save", "process", "reuse", "microsoft", "datetime.datetime", "software", "following", "type", "created_at__gte", "custom", "kwargs", "objects", "documentation", "lookups", "file", "customization", "partition", "constraint", "work", "empty_result_set_value", "exclusion", "user", "init__.py", "goog", "subtraction", "fragment", "cases", "c", "annotations", "attribute", "queryset.annotate", "mm", "as_vendorname", "inherit", "reporters", "save", "date", "ties", "as_oracle", "employees", "operators", "transform", "logic", "name", "computations", "parameter", "activation", "all_values", "reporter", "backends", "reference", "pos", "evil", "interpolation", "recent_comments", "queries", "slice", "sql_expressions", "field_lower", "ss", "partitions", "expression)s", "return", "frames", "operator", "memory", "computation", "expressions", "foo", "duration", "expressions)s", "parent", "num_chairs", "edge", "no_others", "greaterthan", "commas", "datetimefield", "examples", "category", "status", "aliases", "chairs", "position", "model.save", "conditions", "code", "concat_ws", "convert_value", "decimalfield", "asc", "filter", "false", "array", "grouping", "class", "access", "clause", "i", "post_id", "exists", "num_products", "function)s(%(distinct)s%(expressions)s", "placeholders", "group", "is_summary", "returns", "compiler", "'", "desc", "extra_context", "names", "length__gt", "inversion", "database", "output", "input", "lower", "*", "query", "sometable", "scenes_count", "postgresql", "count", "types", "strings", "floatfield", "elements", "register_lookup", "subclass", "all_values)s%(expressions)s", ".", "newest_commenter_email", "pair", "usage", "foundation", "limit", "step", "u0", "max_length", "frame", "thread", "validation", "create", "priyansh", "section", "substring", "append", "source", "component", "sequence", "underscore", "evaluation", "use", "placeholder", "sum", "author", "engines", "performance", "protection", "overrides", "criteria", "operation", "order", "params", "default", "movie", "modifications", "upper", "comment", "prefix", "products", "format", "properties", "expression", "title__contains", "classes", "day", "annotate", "timezone", "booleanfield", "convenience", "f", "writers", "supports", "num_employees__gt", "cursor", "race", "aapl", "len", "company", "combination", "template", "rowrange", "aggregates", "way", "internet", "super", "category_rank", "comments", "sql_params", "party", "queryset", "integer", "django.db.connection.vendor", "¶", "news", "parameters", "post", "services", "val", "technical", "integers", "as_sqlserver", "avoiding", "indices", "~exists", "car", "num_managers", "function", "keywords", "apple", "arrayfield", "result", "number", "salary__gt", "-object", "def", "point", "values", "string", "order_by", "windows", "django.db.models.expressions", "aggregate", "published_at", "mapping", "databases", "hh", "exclude", "models", "querysets", "predicates", "copy", "level", "allow_distinct", "condition", "minimum", "sort", "django", "vulnerability", "riya", "n’t", "fields", "print", "coalesce", "increment", "set", "power", "lowercase", "book", "db", "motto", "value", "negation", "rating", "or", "compiler.compile", "columns", "data", "implementation", "base", "backend", "task", "subqueries", "preprocessing", "active_at", "one_day_ago", "unbounded", "writer", "as_sql", "self", "instance", "typeerror", "output_field", "aggregation", "handling", "constants", "created_at", "substring)s", "expressionwrapper", "nulls_first", "avg_rating", "|", "functionality", "as_vendor", "start", "concat", "timedelta", "joins", "instances", "story", "conditional", "statement", "part", "references", "object", "django.db.models.aggregates", "ticket", "valueerror", "groups", "function)s", "charfield", "partitioning", "sql", "dictionary", "points", "authors", "name__length", "num_employees", "pairs", "chance", "total_comments", "keyword", "s", "ordering", "need_chairs", "repetition", "max", "variables", "rest", "qs", "enumerate", "address", "function)s(%(expressions)s", "yahoo", "no", "filtering", "-ed", "refresh_from_db", "django.db.models.lookups", "movies", "f('foo", "tagline", "target", "param", "check", "difference", "degrade", "addition", "example", "window", "chairs_needed", "func", "allowed_default", "month", "column", "list", "orm", "studio", "preceding", "email", "google", "starting", "rank", "model", "post__in", "year", "idea", "django.db.models.functions", "dry", "attributes", "published_at__gte", "release", "expression.asc", "id__in", "relabeled_clone", "windowframeexclusion", "as_mysql", "syntax", "r", "select", "peers", "set_source_expressions", "benefit", "saves", "manufacturer", "case", "principle", "boolean", "length", "lookup", "assignment", "conjunction", "hasattr", "null", "change_map", "resolve_expression", "errors", "frame_type", "notimplementederror", "strftime('%w", "tuple", "server", "modulo", "arguments", "quotes", "allow_joins", "driver", "init", "package", "rawsql", "end", "generation", "entries", "-created_at", "built_by", "wrap", "matching", "kind", "monkey", "functions", "key", "actors", "operations", "tells", "update", "none", "filters", "valuerange", "jr.", "specifies", "col", "arithmetic", "get", "injection", "q", "new", "true", "dd", "posts", "api", "genre", "current_row", "support", "ticker_name", "description", "batman", "mode", "projects", "yyyy", "connection", "-", "transformations", "django.utils", "last", "multiplication", "threads", "import", "connector", "d", "mysql", ">", "defaults", "%", "call", "pk", "compile", "foreignkey", "avg", "information", "row", "python", "methods", "options", "times", "vendor", "details", "category_rank__lte", "persistence", "method", "tintin", "argument", "days", "recent_comment", "clone", "note", "oracle", "attacks", "scenarios", "text", "orderby", "nulls", "advantages"], "type": "documentation"},
{"title": "Django shortcut functions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/http/shortcuts/", "content": "Django shortcut functions ¶ The package django.shortcuts collects helper functions and classes that\n“span” multiple levels of MVC. In other words, these functions/classes\nintroduce controlled coupling for convenience’s sake. render() ¶ render ( request , template_name , context = None , content_type = None , status = None , using = None ) [source] ¶ Combines a given template with a given context dictionary and returns an HttpResponse object with that rendered text. Django does not provide a shortcut function which returns a TemplateResponse because the constructor\nof TemplateResponse offers the same level\nof convenience as render() . Required arguments ¶ request The request object used to generate this response. template_name The full name of a template to use or sequence of template names. If a\nsequence is given, the first template that exists will be used. See the template loading documentation for more\ninformation on how templates are found. Optional arguments ¶ context A dictionary of values to add to the template context. By default, this\nis an empty dictionary. If a value in the dictionary is callable, the\nview will call it just before rendering the template. content_type The MIME type to use for the resulting document. Defaults to 'text/html' . status The status code for the response. Defaults to 200 . using The NAME of a template engine to use for\nloading the template. Example ¶ The following example renders the template myapp/index.html with the\nMIME type application/xhtml+xml : from django.shortcuts import render def my_view ( request ): # View code here... return render ( request , \"myapp/index.html\" , { \"foo\" : \"bar\" , }, content_type = \"application/xhtml+xml\" , ) This example is equivalent to: from django.http import HttpResponse from django.template import loader def my_view ( request ): # View code here... t = loader . get_template ( \"myapp/index.html\" ) c = { \"foo\" : \"bar\" } return HttpResponse ( t . render ( c , request ), content_type = \"application/xhtml+xml\" ) redirect() ¶ redirect ( to , * args , permanent = False , ** kwargs ) [source] ¶ Returns an HttpResponseRedirect to the appropriate URL\nfor the arguments passed. The arguments could be: A model: the model’s get_absolute_url() function will be called. A view name, possibly with arguments: reverse() will be\nused to reverse-resolve the name. An absolute or relative URL, which will be used as-is for the redirect\nlocation. By default issues a temporary redirect; pass permanent=True to issue a\npermanent redirect. Examples ¶ You can use the redirect() function in a number of ways. By passing some object; that object’s get_absolute_url() method will be called\nto figure out the redirect URL: from django.shortcuts import redirect def my_view ( request ): ... obj = MyModel . objects . get ( ... ) return redirect ( obj ) By passing the name of a view and optionally some positional or\nkeyword arguments; the URL will be reverse resolved using the reverse() method: def my_view ( request ): ... return redirect ( \"some-view-name\" , foo = \"bar\" ) By passing a hardcoded URL to redirect to: def my_view ( request ): ... return redirect ( \"/some/url/\" ) This also works with full URLs: def my_view ( request ): ... return redirect ( \"https://example.com/\" ) By default, redirect() returns a temporary redirect. All of the above\nforms accept a permanent argument; if set to True a permanent redirect\nwill be returned: def my_view ( request ): ... obj = MyModel . objects . get ( ... ) return redirect ( obj , permanent = True ) get_object_or_404() ¶ get_object_or_404 ( klass , * args , ** kwargs ) [source] ¶ aget_object_or_404 ( klass , * args , ** kwargs ) ¶ Asynchronous version : aget_object_or_404() Calls get() on a given model\nmanager, but it raises Http404 instead of the model’s DoesNotExist exception. Arguments ¶ klass A Model class,\na Manager ,\nor a QuerySet instance from which to get\nthe object. *args Q objects . **kwargs Lookup parameters, which should be in the format accepted by get() and filter() . Example ¶ The following example gets the object with the primary key of 1 from MyModel : from django.shortcuts import get_object_or_404 def my_view ( request ): obj = get_object_or_404 ( MyModel , pk = 1 ) This example is equivalent to: from django.http import Http404 def my_view ( request ): try : obj = MyModel . objects . get ( pk = 1 ) except MyModel . DoesNotExist : raise Http404 ( \"No MyModel matches the given query.\" ) The most common use case is to pass a Model , as\nshown above. However, you can also pass a QuerySet instance: queryset = Book . objects . filter ( title__startswith = \"M\" ) get_object_or_404 ( queryset , pk = 1 ) The above example is a bit contrived since it’s equivalent to doing: get_object_or_404 ( Book , title__startswith = \"M\" , pk = 1 ) but it can be useful if you are passed the queryset variable from somewhere\nelse. Finally, you can also use a Manager . This is useful\nfor example if you have a custom manager : get_object_or_404 ( Book . dahl_objects , title = \"Matilda\" ) You can also use related managers : author = Author . objects . get ( name = \"Roald Dahl\" ) get_object_or_404 ( author . book_set , title = \"Matilda\" ) Note: As with get() , a MultipleObjectsReturned exception\nwill be raised if more than one object is found. Changed in Django 5.0: aget_object_or_404() function was added. get_list_or_404() ¶ get_list_or_404 ( klass , * args , ** kwargs ) [source] ¶ aget_list_or_404 ( klass , * args , ** kwargs ) ¶ Asynchronous version : aget_list_or_404() Returns the result of filter() on\na given model manager cast to a list, raising Http404 if the resulting list is empty. Arguments ¶ klass A Model , Manager or QuerySet instance from which to get the\nlist. *args Q objects . **kwargs Lookup parameters, which should be in the format accepted by get() and filter() . Example ¶ The following example gets all published objects from MyModel : from django.shortcuts import get_list_or_404 def my_view ( request ): my_objects = get_list_or_404 ( MyModel , published = True ) This example is equivalent to: from django.http import Http404 def my_view ( request ): my_objects = list ( MyModel . objects . filter ( published = True )) if not my_objects : raise Http404 ( \"No MyModel matches the given query.\" ) Changed in Django 5.0: aget_list_or_404() function was added.", "keywords": ["function", "mymodel", "examples", "get_object_or_404", "result", "view", "status", "number", "url", "def", "code", "values", "forms", "filter", "c", "class", "example", "#", "m", "list", "returns", "names", "dahl_objects", "mime", "request", "managers", "location", "*", "query", "httpresponse", "index.html", "version", "ways", "level", "model", "words", "xhtml+xml", "variable", "roald", "get_list_or_404", "application", "http404", "django", "=", "myapp", "title", "get_absolute_url", "engine", "book", "dahl", "value", "sake", "bit", "django.shortcuts", "content_type", "source", "case", "sequence", "lookup", "use", "html", "matilda", "arguments", "type", "author", "a", "package", "shortcut", "calls", "instance", "kwargs", "custom", "objects", "documentation", "levels", "default", "bar", "get_template", "loader", "functions", "key", "helper", "my_view", "none", "args", "format", "classes", "issues", "httpresponseredirect", "aget_object_or_404", "url/", "get", "doesnotexist", "constructor", "https://example.com/", "q", "render", "true", "templateresponse", "django.template", "urls", "convenience", "object", "document", "my_objects", "context", "klass", "import", "name", "template", "response", "dictionary", "mvc", "defaults", "pk", "information", "aget_list_or_404", "t", "exception", "manager", "method", "queryset", "argument", "¶", "coupling", "redirect", "obj", "reverse", "note", "parameters", "foo", "templates", "no", "text", "span"], "type": "documentation"},
{"title": "Testing tools | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/testing/tools/", "content": "Testing tools ¶ Django provides a small set of tools that come in handy when writing tests. The test client ¶ The test client is a Python class that acts as a dummy web browser, allowing\nyou to test your views and interact with your Django-powered application\nprogrammatically. Some of the things you can do with the test client are: Simulate GET and POST requests on a URL and observe the response –\neverything from low-level HTTP (result headers and status codes) to\npage content. See the chain of redirects (if any) and check the URL and status code at\neach step. Test that a given request is rendered by a given Django template, with\na template context that contains certain values. Note that the test client is not intended to be a replacement for Selenium or\nother “in-browser” frameworks. Django’s test client has a different focus. In\nshort: Use Django’s test client to establish that the correct template is being\nrendered and that the template is passed the correct context data. Use RequestFactory to test view functions directly,\nbypassing the routing and middleware layers. Use in-browser frameworks like Selenium to test rendered HTML and the behavior of web pages, namely JavaScript functionality. Django also\nprovides special support for those frameworks; see the section on LiveServerTestCase for more details. A comprehensive test suite should use a combination of all of these test types. Overview and a quick example ¶ To use the test client, instantiate django.test.Client and retrieve\nweb pages: >>> from django.test import Client >>> c = Client () >>> response = c . post ( \"/login/\" , { \"username\" : \"john\" , \"password\" : \"smith\" }) >>> response . status_code 200 >>> response = c . get ( \"/customer/details/\" ) >>> response . content b'<!DOCTYPE html...' As this example suggests, you can instantiate Client from within a session\nof the Python interactive interpreter. Note a few important things about how the test client works: The test client does not require the web server to be running. In fact,\nit will run just fine with no web server running at all! That’s because\nit avoids the overhead of HTTP and deals directly with the Django\nframework. This helps make the unit tests run quickly. When retrieving pages, remember to specify the path of the URL, not the\nwhole domain. For example, this is correct: >>> c . get ( \"/login/\" ) This is incorrect: >>> c . get ( \"https://www.example.com/login/\" ) The test client is not capable of retrieving web pages that are not\npowered by your Django project. If you need to retrieve other web pages,\nuse a Python standard library module such as urllib . To resolve URLs, the test client uses whatever URLconf is pointed-to by\nyour ROOT_URLCONF setting. Although the above example would work in the Python interactive\ninterpreter, some of the test client’s functionality, notably the\ntemplate-related functionality, is only available while tests are\nrunning . The reason for this is that Django’s test runner performs a bit of black\nmagic in order to determine which template was loaded by a given view.\nThis black magic (essentially a patching of Django’s template system in\nmemory) only happens during test running. By default, the test client will disable any CSRF checks\nperformed by your site. If, for some reason, you want the test client to perform CSRF\nchecks, you can create an instance of the test client that\nenforces CSRF checks. To do this, pass in the enforce_csrf_checks argument when you construct your\nclient: >>> from django.test import Client >>> csrf_client = Client ( enforce_csrf_checks = True ) Making requests ¶ Use the django.test.Client class to make requests. class Client ( enforce_csrf_checks = False , raise_request_exception = True , json_encoder = DjangoJSONEncoder , * , headers = None , query_params = None , ** defaults ) [source] ¶ A testing HTTP client. Takes several arguments that can customize behavior. headers allows you to specify default headers that will be sent with\nevery request. For example, to set a User-Agent header: client = Client ( headers = { \"user-agent\" : \"curl/7.79.1\" }) query_params allows you to specify the default query string that will\nbe set on every request. Arbitrary keyword arguments in **defaults set WSGI environ variables . For example, to set the\nscript name: client = Client ( SCRIPT_NAME = \"/app/\" ) Note Keyword arguments starting with a HTTP_ prefix are set as headers,\nbut the headers parameter should be preferred for readability. The values from the headers , query_params , and extra keyword\narguments passed to get() , post() , etc. have precedence over\nthe defaults passed to the class constructor. The enforce_csrf_checks argument can be used to test CSRF\nprotection (see above). The raise_request_exception argument allows controlling whether or not\nexceptions raised during the request should also be raised in the test.\nDefaults to True . The json_encoder argument allows setting a custom JSON encoder for\nthe JSON serialization that’s described in post() . Changed in Django 5.1: The query_params argument was added. Once you have a Client instance, you can call any of the following\nmethods: get ( path , data = None , follow = False , secure = False , * , headers = None , query_params = None , ** extra ) [source] ¶ Makes a GET request on the provided path and returns a Response object, which is documented below. The key-value pairs in the query_params dictionary are used to set\nquery strings. For example: >>> c = Client () >>> c . get ( \"/customers/details/\" , query_params = { \"name\" : \"fred\" , \"age\" : 7 }) …will result in the evaluation of a GET request equivalent to: /customers/details/?name=fred&age=7 It is also possible to pass these parameters into the data parameter. However, query_params is preferred as it works for any\nHTTP method. The headers parameter can be used to specify headers to be sent in\nthe request. For example: >>> c = Client () >>> c . get ( ... \"/customers/details/\" , ... query_params = { \"name\" : \"fred\" , \"age\" : 7 }, ... headers = { \"accept\" : \"application/json\" }, ... ) …will send the HTTP header HTTP_ACCEPT to the details view, which\nis a good way to test code paths that use the django.http.HttpRequest.accepts() method. Arbitrary keyword arguments set WSGI environ variables . For example, headers\nto set the script name: >>> c = Client () >>> c . get ( \"/\" , SCRIPT_NAME = \"/app/\" ) If you already have the GET arguments in URL-encoded form, you can\nuse that encoding instead of using the data argument. For example,\nthe previous GET request could also be posed as: >>> c = Client () >>> c . get ( \"/customers/details/?name=fred&age=7\" ) If you provide a URL with both an encoded GET data and either a\nquery_params or data argument these arguments will take precedence. If you set follow to True the client will follow any redirects\nand a redirect_chain attribute will be set in the response object\ncontaining tuples of the intermediate urls and status codes. If you had a URL /redirect_me/ that redirected to /next/ , that\nredirected to /final/ , this is what you’d see: >>> response = c . get ( \"/redirect_me/\" , follow = True ) >>> response . redirect_chain [('http://testserver/next/', 302), ('http://testserver/final/', 302)] If you set secure to True the client will emulate an HTTPS\nrequest. Changed in Django 5.1: The query_params argument was added. post ( path , data = None , content_type = MULTIPART_CONTENT , follow = False , secure = False , * , headers = None , query_params = None , ** extra ) [source] ¶ Makes a POST request on the provided path and returns a Response object, which is documented below. The key-value pairs in the data dictionary are used to submit POST\ndata. For example: >>> c = Client () >>> c . post ( \"/login/\" , { \"name\" : \"fred\" , \"passwd\" : \"secret\" }) …will result in the evaluation of a POST request to this URL: /login/ …with this POST data: name=fred&passwd=secret If you provide content_type as application/json , the data is serialized using json.dumps() if it’s a dict, list,\nor tuple. Serialization is performed with DjangoJSONEncoder by default,\nand can be overridden by providing a json_encoder argument to Client . This serialization also happens for put() , patch() , and delete() requests. If you provide any other content_type (e.g. text/xml for an XML payload), the contents of data are sent as-is in the\nPOST request, using content_type in the HTTP Content-Type header. If you don’t provide a value for content_type , the values in data will be transmitted with a content type of multipart/form-data . In this case, the key-value pairs in data will be encoded as a multipart message and used to create the\nPOST data payload. To submit multiple values for a given key – for example, to specify\nthe selections for a <select multiple> – provide the values as a\nlist or tuple for the required key. For example, this value of data would submit three selected values for the field named choices : { \"choices\" : [ \"a\" , \"b\" , \"d\" ]} Submitting files is a special case. To POST a file, you need only\nprovide the file field name as a key, and a file handle to the file you\nwish to upload as a value. For example, if your form has fields name and attachment , the latter a FileField : >>> c = Client () >>> with open ( \"wishlist.doc\" , \"rb\" ) as fp : ... c . post ( \"/customers/wishes/\" , { \"name\" : \"fred\" , \"attachment\" : fp }) ... You may also provide any file-like object (e.g., StringIO or BytesIO ) as a file handle. If you’re uploading to an ImageField , the object needs a name attribute that passes the validate_image_file_extension validator.\nFor example: >>> from io import BytesIO >>> img = BytesIO ( ... b \"GIF89a \\x01\\x00\\x01\\x00\\x00\\x00\\x00 ! \\xf9\\x04\\x01\\x00\\x00\\x00 \" ... b \" \\x00 , \\x00\\x00\\x00\\x00\\x01\\x00\\x01\\x00\\x00\\x02\\x01\\x00\\x00 \" ... ) >>> img . name = \"myimage.gif\" Note that if you wish to use the same file handle for multiple post() calls then you will need to manually reset the file\npointer between posts. The easiest way to do this is to\nmanually close the file after it has been provided to post() , as demonstrated above. You should also ensure that the file is opened in a way that\nallows the data to be read. If your file contains binary data\nsuch as an image, this means you will need to open the file in rb (read binary) mode. The headers , query_params , and extra parameters acts the\nsame as for Client.get() . If the URL you request with a POST contains encoded parameters, these\nparameters will be made available in the request.GET data. For example,\nif you were to make the request: >>> c . post ( ... \"/login/\" , { \"name\" : \"fred\" , \"passwd\" : \"secret\" }, query_params = { \"visitor\" : \"true\" } ... ) … the view handling this request could interrogate request.POST\nto retrieve the username and password, and could interrogate request.GET\nto determine if the user was a visitor. If you set follow to True the client will follow any redirects\nand a redirect_chain attribute will be set in the response object\ncontaining tuples of the intermediate urls and status codes. If you set secure to True the client will emulate an HTTPS\nrequest. Changed in Django 5.1: The query_params argument was added. head ( path , data = None , follow = False , secure = False , * , headers = None , query_params = None , ** extra ) [source] ¶ Makes a HEAD request on the provided path and returns a Response object. This method works just like Client.get() ,\nincluding the follow , secure , headers , query_params ,\nand extra parameters, except it does not return a message body. Changed in Django 5.1: The query_params argument was added. options ( path , data = '' , content_type = 'application/octet-stream' , follow = False , secure = False , * , headers = None , query_params = None , ** extra ) [source] ¶ Makes an OPTIONS request on the provided path and returns a Response object. Useful for testing RESTful interfaces. When data is provided, it is used as the request body, and\na Content-Type header is set to content_type . The follow , secure , headers , query_params , and extra parameters act the same as for Client.get() . Changed in Django 5.1: The query_params argument was added. put ( path , data = '' , content_type = 'application/octet-stream' , follow = False , secure = False , * , headers = None , query_params = None , ** extra ) [source] ¶ Makes a PUT request on the provided path and returns a Response object. Useful for testing RESTful interfaces. When data is provided, it is used as the request body, and\na Content-Type header is set to content_type . The follow , secure , headers , query_params , and extra parameters act the same as for Client.get() . Changed in Django 5.1: The query_params argument was added. patch ( path , data = '' , content_type = 'application/octet-stream' , follow = False , secure = False , * , headers = None , query_params = None , ** extra ) [source] ¶ Makes a PATCH request on the provided path and returns a Response object. Useful for testing RESTful interfaces. The follow , secure , headers , query_params , and extra parameters act the same as for Client.get() . Changed in Django 5.1: The query_params argument was added. delete ( path , data = '' , content_type = 'application/octet-stream' , follow = False , secure = False , * , headers = None , query_params = None , ** extra ) [source] ¶ Makes a DELETE request on the provided path and returns a Response object. Useful for testing RESTful interfaces. When data is provided, it is used as the request body, and\na Content-Type header is set to content_type . The follow , secure , headers , query_params , and extra parameters act the same as for Client.get() . Changed in Django 5.1: The query_params argument was added. trace ( path , follow = False , secure = False , * , headers = None , query_params = None , ** extra ) [source] ¶ Makes a TRACE request on the provided path and returns a Response object. Useful for simulating diagnostic probes. Unlike the other request methods, data is not provided as a keyword\nparameter in order to comply with RFC 9110 Section 9.3.8 , which\nmandates that TRACE requests must not have a body. The follow , secure , headers , query_params , and extra parameters act the same as for Client.get() . Changed in Django 5.1: The query_params argument was added. login ( ** credentials ) ¶ alogin ( ** credentials ) ¶ Asynchronous version : alogin() If your site uses Django’s authentication system and you deal with logging in users, you can use the test client’s login() method to simulate the effect of a user logging into the\nsite. After you call this method, the test client will have all the cookies\nand session data required to pass any login-based tests that may form\npart of a view. The format of the credentials argument depends on which authentication backend you’re using\n(which is configured by your AUTHENTICATION_BACKENDS setting). If you’re using the standard authentication backend provided\nby Django ( ModelBackend ), credentials should be the user’s\nusername and password, provided as keyword arguments: >>> c = Client () >>> c . login ( username = \"fred\" , password = \"secret\" ) # Now you can access a view that's only available to logged-in users. If you’re using a different authentication backend, this method may\nrequire different credentials. It requires whichever credentials are\nrequired by your backend’s authenticate() method. login() returns True if it the credentials were accepted and\nlogin was successful. Finally, you’ll need to remember to create user accounts before you can\nuse this method. As we explained above, the test runner is executed\nusing a test database, which contains no users by default. As a result,\nuser accounts that are valid on your production site will not work\nunder test conditions. You’ll need to create users as part of the test\nsuite – either manually (using the Django model API) or with a test\nfixture. Remember that if you want your test user to have a password,\nyou can’t set the user’s password by setting the password attribute\ndirectly – you must use the set_password() function to\nstore a correctly hashed password. Alternatively, you can use the create_user() helper\nmethod to create a new user with a correctly hashed password. Changed in Django 5.0: alogin() method was added. force_login ( user , backend = None ) ¶ aforce_login ( user , backend = None ) ¶ Asynchronous version : aforce_login() If your site uses Django’s authentication\nsystem , you can use the force_login() method\nto simulate the effect of a user logging into the site. Use this method\ninstead of login() when a test requires a user be logged in and\nthe details of how a user logged in aren’t important. Unlike login() , this method skips the authentication and\nverification steps: inactive users ( is_active=False ) are permitted to login\nand the user’s credentials don’t need to be provided. The user will have its backend attribute set to the value of the backend argument (which should be a dotted Python path string), or\nto settings.AUTHENTICATION_BACKENDS[0] if a value isn’t provided.\nThe authenticate() function called by login() normally annotates the user like this. This method is faster than login() since the expensive\npassword hashing algorithms are bypassed. Also, you can speed up login() by using a weaker hasher while testing . Changed in Django 5.0: aforce_login() method was added. logout () ¶ alogout () ¶ Asynchronous version : alogout() If your site uses Django’s authentication system ,\nthe logout() method can be used to simulate the effect of a user\nlogging out of your site. After you call this method, the test client will have all the cookies\nand session data cleared to defaults. Subsequent requests will appear\nto come from an AnonymousUser . Changed in Django 5.0: alogout() method was added. Testing responses ¶ The get() and post() methods both return a Response object. This Response object is not the same as the HttpResponse object returned\nby Django views; the test response object has some additional data useful for\ntest code to verify. Specifically, a Response object has the following attributes: class Response ¶ client ¶ The test client that was used to make the request that resulted in the\nresponse. content ¶ The body of the response, as a bytestring. This is the final page\ncontent as rendered by the view, or any error message. context ¶ The template Context instance that was used to render the template that\nproduced the response content. If the rendered page used multiple templates, then context will be a\nlist of Context objects, in the order in which they were rendered. Regardless of the number of templates used during rendering, you can\nretrieve context values using the [] operator. For example, the\ncontext variable name could be retrieved using: >>> response = client . get ( \"/foo/\" ) >>> response . context [ \"name\" ] 'Arthur' Not using Django templates? This attribute is only populated when using the DjangoTemplates backend.\nIf you’re using another template engine, context_data may be a suitable alternative on responses with that attribute. exc_info ¶ A tuple of three values that provides information about the unhandled\nexception, if any, that occurred during the view. The values are (type, value, traceback), the same as returned by\nPython’s sys.exc_info() . Their meanings are: type : The type of the exception. value : The exception instance. traceback : A traceback object which encapsulates the call stack at\nthe point where the exception originally occurred. If no exception occurred, then exc_info will be None . json ( ** kwargs ) ¶ The body of the response, parsed as JSON. Extra keyword arguments are\npassed to json.loads() . For example: >>> response = client . get ( \"/foo/\" ) >>> response . json ()[ \"name\" ] 'Arthur' If the Content-Type header is not \"application/json\" , then a ValueError will be raised when trying to parse the response. request ¶ The request data that stimulated the response. wsgi_request ¶ The WSGIRequest instance generated by the test handler that\ngenerated the response. status_code ¶ The HTTP status of the response, as an integer. For a full list\nof defined codes, see the IANA status code registry . templates ¶ A list of Template instances used to render the final content, in\nthe order they were rendered. For each template in the list, use template.name to get the template’s file name, if the template was\nloaded from a file. (The name is a string such as 'admin/index.html' .) Not using Django templates? This attribute is only populated when using the DjangoTemplates backend.\nIf you’re using another template engine, template_name may be a suitable alternative if you only need the name of the\ntemplate used for rendering. resolver_match ¶ An instance of ResolverMatch for the response.\nYou can use the func attribute, for\nexample, to verify the view that served the response: # my_view here is a function based view. self . assertEqual ( response . resolver_match . func , my_view ) # Class-based views need to compare the view_class, as the # functions generated by as_view() won't be equal. self . assertIs ( response . resolver_match . func . view_class , MyView ) If the given URL is not found, accessing this attribute will raise a Resolver404 exception. As with a normal response, you can also access the headers through HttpResponse.headers . For example, you could determine the content\ntype of a response using response.headers['Content-Type'] . Exceptions ¶ If you point the test client at a view that raises an exception and Client.raise_request_exception is True , that exception will be visible\nin the test case. You can then use a standard try ... except block or assertRaises() to test for exceptions. The only exceptions that are not visible to the test client are Http404 , PermissionDenied , SystemExit , and SuspiciousOperation . Django catches these\nexceptions internally and converts them into the appropriate HTTP response\ncodes. In these cases, you can check response.status_code in your test. If Client.raise_request_exception is False , the test client will return a\n500 response as would be returned to a browser. The response has the attribute exc_info to provide information about the unhandled\nexception. Persistent state ¶ The test client is stateful. If a response returns a cookie, then that cookie\nwill be stored in the test client and sent with all subsequent get() and post() requests. Expiration policies for these cookies are not followed. If you want a cookie\nto expire, either delete it manually or create a new Client instance (which\nwill effectively delete all cookies). A test client has attributes that store persistent state information. You can\naccess these properties as part of a test condition. Client. cookies ¶ A Python SimpleCookie object, containing the current\nvalues of all the client cookies. See the documentation of the http.cookies module for more. Client. session ¶ A dictionary-like object containing session information. See the session documentation for full details. To modify the session and then save it, it must be stored in a variable\nfirst (because a new SessionStore is created every time this property\nis accessed): def test_something ( self ): session = self . client . session session [ \"somekey\" ] = \"test\" session . save () Client. asession () ¶ New in Django 5.0. This is similar to the session attribute but it works in async\ncontexts. Setting the language ¶ When testing applications that support internationalization and localization,\nyou might want to set the language for a test client request. The method for\ndoing so depends on whether or not the LocaleMiddleware is enabled. If the middleware is enabled, the language can be set by creating a cookie with\na name of LANGUAGE_COOKIE_NAME and a value of the language code: from django.conf import settings def test_language_using_cookie ( self ): self . client . cookies . load ({ settings . LANGUAGE_COOKIE_NAME : \"fr\" }) response = self . client . get ( \"/\" ) self . assertEqual ( response . content , b \"Bienvenue sur mon site.\" ) or by including the Accept-Language HTTP header in the request: def test_language_using_header ( self ): response = self . client . get ( \"/\" , headers = { \"accept-language\" : \"fr\" }) self . assertEqual ( response . content , b \"Bienvenue sur mon site.\" ) Note When using these methods, ensure to reset the active language at the end of\neach test: def tearDown ( self ): translation . activate ( settings . LANGUAGE_CODE ) More details are in How Django discovers language preference . If the middleware isn’t enabled, the active language may be set using translation.override() : from django.utils import translation def test_language_using_override ( self ): with translation . override ( \"fr\" ): response = self . client . get ( \"/\" ) self . assertEqual ( response . content , b \"Bienvenue sur mon site.\" ) More details are in Explicitly setting the active language . Example ¶ The following is a unit test using the test client: import unittest from django.test import Client class SimpleTest ( unittest . TestCase ): def setUp ( self ): # Every test needs a client. self . client = Client () def test_details ( self ): # Issue a GET request. response = self . client . get ( \"/customer/details/\" ) # Check that the response is 200 OK. self . assertEqual ( response . status_code , 200 ) # Check that the rendered context contains 5 customers. self . assertEqual ( len ( response . context [ \"customers\" ]), 5 ) See also django.test.RequestFactory Provided test case classes ¶ Normal Python unit test classes extend a base class of unittest.TestCase . Django provides a few extensions of this base class: Hierarchy of Django unit testing classes ¶ You can convert a normal unittest.TestCase to any of the subclasses:\nchange the base class of your test from unittest.TestCase to the subclass.\nAll of the standard Python unit test functionality will be available, and it\nwill be augmented with some useful additions as described in each section\nbelow. SimpleTestCase ¶ class SimpleTestCase [source] ¶ A subclass of unittest.TestCase that adds this functionality: Some useful assertions like: Checking that a callable raises a certain exception . Checking that a callable triggers a certain warning . Testing form field rendering and error treatment . Testing HTML responses for the presence/lack of a given fragment . Verifying that a template has/hasn't been used to generate a given response content . Verifying that two URLs are equal. Verifying an HTTP redirect is\nperformed by the app. Robustly testing two HTML fragments for equality/inequality or containment . Robustly testing two XML fragments for equality/inequality. Robustly testing two JSON fragments for equality. The ability to run tests with modified settings . Using the client Client . If your tests make any database queries, use subclasses TransactionTestCase or TestCase . SimpleTestCase. databases ¶ SimpleTestCase disallows database queries by default. This\nhelps to avoid executing write queries which will affect other tests\nsince each SimpleTestCase test isn’t run in a transaction. If you\naren’t concerned about this problem, you can disable this behavior by\nsetting the databases class attribute to '__all__' on your test\nclass. Warning SimpleTestCase and its subclasses (e.g. TestCase , …) rely on setUpClass() and tearDownClass() to perform some class-wide\ninitialization (e.g. overriding settings). If you need to override those\nmethods, don’t forget to call the super implementation: class MyTestCase ( TestCase ): @classmethod def setUpClass ( cls ): super () . setUpClass () ... @classmethod def tearDownClass ( cls ): ... super () . tearDownClass () Be sure to account for Python’s behavior if an exception is raised during setUpClass() . If that happens, neither the tests in the class nor tearDownClass() are run. In the case of django.test.TestCase ,\nthis will leak the transaction created in super() which results in\nvarious symptoms including a segmentation fault on some platforms (reported\non macOS). If you want to intentionally raise an exception such as unittest.SkipTest in setUpClass() , be sure to do it before\ncalling super() to avoid this. TransactionTestCase ¶ class TransactionTestCase [source] ¶ TransactionTestCase inherits from SimpleTestCase to\nadd some database-specific features: Resetting the database to a known state at the beginning of each test to\nease testing and using the ORM. Database fixtures . Test skipping based on database backend features . The remaining specialized assert* methods. Django’s TestCase class is a more commonly used subclass of TransactionTestCase that makes use of database transaction facilities\nto speed up the process of resetting the database to a known state at the\nbeginning of each test. A consequence of this, however, is that some database\nbehaviors cannot be tested within a Django TestCase class. For instance,\nyou cannot test that a block of code is executing within a transaction, as is\nrequired when using select_for_update() . In those cases,\nyou should use TransactionTestCase . TransactionTestCase and TestCase are identical except for the manner\nin which the database is reset to a known state and the ability for test code\nto test the effects of commit and rollback: A TransactionTestCase resets the database after the test runs by\ntruncating all tables. A TransactionTestCase may call commit and rollback\nand observe the effects of these calls on the database. A TestCase , on the other hand, does not truncate tables after a test.\nInstead, it encloses the test code in a database transaction that is rolled\nback at the end of the test. This guarantees that the rollback at the end of\nthe test restores the database to its initial state. Warning TestCase running on a database that does not support rollback (e.g. MySQL\nwith the MyISAM storage engine), and all instances of TransactionTestCase ,\nwill roll back at the end of the test by deleting all data from the test\ndatabase. Apps will not see their data reloaded ;\nif you need this functionality (for example, third-party apps should enable\nthis) you can set serialized_rollback = True inside the TestCase body. TestCase ¶ class TestCase [source] ¶ This is the most common class to use for writing tests in Django. It inherits\nfrom TransactionTestCase (and by extension SimpleTestCase ).\nIf your Django application doesn’t use a database, use SimpleTestCase . The class: Wraps the tests within two nested atomic() blocks: one for the whole class and one for each test. Therefore, if you want\nto test some specific database transaction behavior, use TransactionTestCase . Checks deferrable database constraints at the end of each test. It also provides an additional method: classmethod TestCase. setUpTestData () [source] ¶ The class-level atomic block described above allows the creation of\ninitial data at the class level, once for the whole TestCase . This\ntechnique allows for faster tests as compared to using setUp() . For example: from django.test import TestCase class MyTests ( TestCase ): @classmethod def setUpTestData ( cls ): # Set up data for the whole TestCase cls . foo = Foo . objects . create ( bar = \"Test\" ) ... def test1 ( self ): # Some test using self.foo ... def test2 ( self ): # Some other test using self.foo ... Note that if the tests are run on a database with no transaction support\n(for instance, MySQL with the MyISAM engine), setUpTestData() will be\ncalled before each test, negating the speed benefits. Objects assigned to class attributes in setUpTestData() must support\ncreating deep copies with copy.deepcopy() in order to isolate them\nfrom alterations performed by each test methods. classmethod TestCase. captureOnCommitCallbacks ( using = DEFAULT_DB_ALIAS , execute = False ) [source] ¶ Returns a context manager that captures transaction.on_commit() callbacks for the given database\nconnection. It returns a list that contains, on exit of the context, the\ncaptured callback functions. From this list you can make assertions on the\ncallbacks or call them to invoke their side effects, emulating a commit. using is the alias of the database connection to capture callbacks for. If execute is True , all the callbacks will be called as the context\nmanager exits, if no exception occurred. This emulates a commit after the\nwrapped block of code. For example: from django.core import mail from django.test import TestCase class ContactTests ( TestCase ): def test_post ( self ): with self . captureOnCommitCallbacks ( execute = True ) as callbacks : response = self . client . post ( \"/contact/\" , { \"message\" : \"I like your site\" }, ) self . assertEqual ( response . status_code , 200 ) self . assertEqual ( len ( callbacks ), 1 ) self . assertEqual ( len ( mail . outbox ), 1 ) self . assertEqual ( mail . outbox [ 0 ] . subject , \"Contact Form\" ) self . assertEqual ( mail . outbox [ 0 ] . body , \"I like your site\" ) LiveServerTestCase ¶ class LiveServerTestCase [source] ¶ LiveServerTestCase does basically the same as TransactionTestCase with one extra feature: it launches a\nlive Django server in the background on setup, and shuts it down on teardown.\nThis allows the use of automated test clients other than the Django dummy client such as, for example, the Selenium client, to execute a series of functional tests inside a browser and simulate a\nreal user’s actions. The live server listens on localhost and binds to port 0 which uses a free\nport assigned by the operating system. The server’s URL can be accessed with self.live_server_url during the tests. To demonstrate how to use LiveServerTestCase , let’s write a Selenium test.\nFirst of all, you need to install the selenium package: /  $ python -m pip install \"selenium >= 4.8.0\" ...\\> py -m pip install \"selenium >= 4.8.0\" Then, add a LiveServerTestCase -based test to your app’s tests module\n(for example: myapp/tests.py ). For this example, we’ll assume you’re using\nthe staticfiles app and want to have static files served\nduring the execution of your tests similar to what we get at development time\nwith DEBUG=True , i.e. without having to collect them using collectstatic . We’ll use\nthe StaticLiveServerTestCase subclass which provides that functionality. Replace it with django.test.LiveServerTestCase if you don’t need that. The code for this test may look as follows: from django.contrib.staticfiles.testing import StaticLiveServerTestCase from selenium.webdriver.common.by import By from selenium.webdriver.firefox.webdriver import WebDriver class MySeleniumTests ( StaticLiveServerTestCase ): fixtures = [ \"user-data.json\" ] @classmethod def setUpClass ( cls ): super () . setUpClass () cls . selenium = WebDriver () cls . selenium . implicitly_wait ( 10 ) @classmethod def tearDownClass ( cls ): cls . selenium . quit () super () . tearDownClass () def test_login ( self ): self . selenium . get ( f \" { self . live_server_url } /login/\" ) username_input = self . selenium . find_element ( By . NAME , \"username\" ) username_input . send_keys ( \"myuser\" ) password_input = self . selenium . find_element ( By . NAME , \"password\" ) password_input . send_keys ( \"secret\" ) self . selenium . find_element ( By . XPATH , '//input[@value=\"Log in\"]' ) . click () Finally, you may run the test as follows: /  $ ./manage.py test myapp.tests.MySeleniumTests.test_login ...\\> manage.py test myapp.tests.MySeleniumTests.test_login This example will automatically open Firefox then go to the login page, enter\nthe credentials and press the “Log in” button. Selenium offers other drivers in\ncase you do not have Firefox installed or wish to use another browser. The\nexample above is just a tiny fraction of what the Selenium client can do; check\nout the full reference for more details. Note When using an in-memory SQLite database to run the tests, the same database\nconnection will be shared by two threads in parallel: the thread in which\nthe live server is run and the thread in which the test case is run. It’s\nimportant to prevent simultaneous database queries via this shared\nconnection by the two threads, as that may sometimes randomly cause the\ntests to fail. So you need to ensure that the two threads don’t access the\ndatabase at the same time. In particular, this means that in some cases\n(for example, just after clicking a link or submitting a form), you might\nneed to check that a response is received by Selenium and that the next\npage is loaded before proceeding with further test execution.\nDo this, for example, by making Selenium wait until the <body> HTML tag\nis found in the response (requires Selenium > 2.13): def test_login ( self ): from selenium.webdriver.support.wait import WebDriverWait timeout = 2 ... self . selenium . find_element ( By . XPATH , '//input[@value=\"Log in\"]' ) . click () # Wait until the response is received WebDriverWait ( self . selenium , timeout ) . until ( lambda driver : driver . find_element ( By . TAG_NAME , \"body\" ) ) The tricky thing here is that there’s really no such thing as a “page load,”\nespecially in modern web apps that generate HTML dynamically after the\nserver generates the initial document. So, checking for the presence of <body> in the response might not necessarily be appropriate for all use\ncases. Please refer to the Selenium FAQ and Selenium documentation for more information. Test cases features ¶ Default test client ¶ SimpleTestCase. client ¶ Every test case in a django.test.*TestCase instance has access to an\ninstance of a Django test client. This client can be accessed as self.client . This client is recreated for each test, so you don’t have to\nworry about state (such as cookies) carrying over from one test to another. This means, instead of instantiating a Client in each test: import unittest from django.test import Client class SimpleTest ( unittest . TestCase ): def test_details ( self ): client = Client () response = client . get ( \"/customer/details/\" ) self . assertEqual ( response . status_code , 200 ) def test_index ( self ): client = Client () response = client . get ( \"/customer/index/\" ) self . assertEqual ( response . status_code , 200 ) …you can refer to self.client , like so: from django.test import TestCase class SimpleTest ( TestCase ): def test_details ( self ): response = self . client . get ( \"/customer/details/\" ) self . assertEqual ( response . status_code , 200 ) def test_index ( self ): response = self . client . get ( \"/customer/index/\" ) self . assertEqual ( response . status_code , 200 ) Customizing the test client ¶ SimpleTestCase. client_class ¶ If you want to use a different Client class (for example, a subclass\nwith customized behavior), use the client_class class\nattribute: from django.test import Client , TestCase class MyTestClient ( Client ): # Specialized methods for your environment ... class MyTest ( TestCase ): client_class = MyTestClient def test_my_stuff ( self ): # Here self.client is an instance of MyTestClient... call_some_test_code () Fixture loading ¶ TransactionTestCase. fixtures ¶ A test case class for a database-backed website isn’t much use if there isn’t\nany data in the database. Tests are more readable and it’s more maintainable to\ncreate objects using the ORM, for example in TestCase.setUpTestData() ,\nhowever, you can also use fixtures . A fixture is a collection of data that Django knows how to import into a\ndatabase. For example, if your site has user accounts, you might set up a\nfixture of fake user accounts in order to populate your database during tests. The most straightforward way of creating a fixture is to use the manage.py dumpdata command. This assumes you\nalready have some data in your database. See the dumpdata documentation for more details. Once you’ve created a fixture and placed it in a fixtures directory in one\nof your INSTALLED_APPS , you can use it in your unit tests by\nspecifying a fixtures class attribute on your django.test.TestCase subclass: from django.test import TestCase from myapp.models import Animal class AnimalTestCase ( TestCase ): fixtures = [ \"mammals.json\" , \"birds\" ] def setUp ( self ): # Test definitions as before. call_setup_methods () def test_fluffy_animals ( self ): # A test that uses the fixtures. call_some_test_code () Here’s specifically what will happen: At the start of each test, before setUp() is run, Django will flush the\ndatabase, returning the database to the state it was in directly after migrate was called. Then, all the named fixtures are installed. In this example, Django will\ninstall any JSON fixture named mammals , followed by any fixture named birds . See the Fixtures topic for more details on\ndefining and installing fixtures. For performance reasons, TestCase loads fixtures once for the entire\ntest class, before setUpTestData() , instead of before each\ntest, and it uses transactions to clean the database before each test. In any case,\nyou can be certain that the outcome of a test will not be affected by another\ntest or by the order of test execution. By default, fixtures are only loaded into the default database. If you are\nusing multiple databases and set TransactionTestCase.databases ,\nfixtures will be loaded into all specified databases. URLconf configuration ¶ If your application provides views, you may want to include tests that use the\ntest client to exercise those views. However, an end user is free to deploy the\nviews in your application at any URL of their choosing. This means that your\ntests can’t rely upon the fact that your views will be available at a\nparticular URL. Decorate your test class or test method with @override_settings(ROOT_URLCONF=...) for URLconf configuration. Multi-database support ¶ TransactionTestCase. databases ¶ Django sets up a test database corresponding to every database that is\ndefined in the DATABASES definition in your settings and referred to\nby at least one test through databases . However, a big part of the time taken to run a Django TestCase is consumed\nby the call to flush that ensures that you have a clean database at the\nstart of each test run. If you have multiple databases, multiple flushes are\nrequired (one for each database), which can be a time consuming activity –\nespecially if your tests don’t need to test multi-database activity. As an optimization, Django only flushes the default database at\nthe start of each test run. If your setup contains multiple databases,\nand you have a test that requires every database to be clean, you can\nuse the databases attribute on the test suite to request extra databases\nto be flushed. For example: class TestMyViews ( TransactionTestCase ): databases = { \"default\" , \"other\" } def test_index_page_view ( self ): call_some_test_code () This test case class will flush the default and other test databases\nbefore running test_index_page_view . You can also use '__all__' to\nspecify that all of the test databases must be flushed. The databases flag also controls which databases the TransactionTestCase.fixtures are loaded into. By default, fixtures are\nonly loaded into the default database. Queries against databases not in databases will give assertion errors to\nprevent state leaking between tests. TestCase. databases ¶ By default, only the default database will be wrapped in a transaction\nduring a TestCase ’s execution and attempts to query other databases will\nresult in assertion errors to prevent state leaking between tests. Use the databases class attribute on the test class to request transaction\nwrapping against non- default databases. For example: class OtherDBTests ( TestCase ): databases = { \"other\" } def test_other_db_query ( self ): ... This test will only allow queries against the other database. Just like for SimpleTestCase.databases and TransactionTestCase.databases , the '__all__' constant can be used to specify that the test should allow\nqueries to all databases. Overriding settings ¶ Warning Use the functions below to temporarily alter the value of settings in tests.\nDon’t manipulate django.conf.settings directly as Django won’t restore\nthe original values after such manipulations. SimpleTestCase. settings () [source] ¶ For testing purposes it’s often useful to change a setting temporarily and\nrevert to the original value after running the testing code. For this use case\nDjango provides a standard Python context manager (see PEP 343 ) called settings() , which can be used like this: from django.test import TestCase class LoginTestCase ( TestCase ): def test_login ( self ): # First check for the default behavior response = self . client . get ( \"/sekrit/\" ) self . assertRedirects ( response , \"/accounts/login/?next=/sekrit/\" ) # Then override the LOGIN_URL setting with self . settings ( LOGIN_URL = \"/other/login/\" ): response = self . client . get ( \"/sekrit/\" ) self . assertRedirects ( response , \"/other/login/?next=/sekrit/\" ) This example will override the LOGIN_URL setting for the code\nin the with block and reset its value to the previous state afterward. SimpleTestCase. modify_settings () [source] ¶ It can prove unwieldy to redefine settings that contain a list of values. In\npractice, adding or removing values is often sufficient. Django provides the modify_settings() context manager for easier\nsettings changes: from django.test import TestCase class MiddlewareTestCase ( TestCase ): def test_cache_middleware ( self ): with self . modify_settings ( MIDDLEWARE = { \"append\" : \"django.middleware.cache.FetchFromCacheMiddleware\" , \"prepend\" : \"django.middleware.cache.UpdateCacheMiddleware\" , \"remove\" : [ \"django.contrib.sessions.middleware.SessionMiddleware\" , \"django.contrib.auth.middleware.AuthenticationMiddleware\" , \"django.contrib.messages.middleware.MessageMiddleware\" , ], } ): response = self . client . get ( \"/\" ) # ... For each action, you can supply either a list of values or a string. When the\nvalue already exists in the list, append and prepend have no effect;\nneither does remove when the value doesn’t exist. override_settings ( ** kwargs ) [source] ¶ In case you want to override a setting for a test method, Django provides the override_settings() decorator (see PEP 318 ). It’s used\nlike this: from django.test import TestCase , override_settings class LoginTestCase ( TestCase ): @override_settings ( LOGIN_URL = \"/other/login/\" ) def test_login ( self ): response = self . client . get ( \"/sekrit/\" ) self . assertRedirects ( response , \"/other/login/?next=/sekrit/\" ) The decorator can also be applied to TestCase classes: from django.test import TestCase , override_settings @override_settings ( LOGIN_URL = \"/other/login/\" ) class LoginTestCase ( TestCase ): def test_login ( self ): response = self . client . get ( \"/sekrit/\" ) self . assertRedirects ( response , \"/other/login/?next=/sekrit/\" ) modify_settings ( * args , ** kwargs ) [source] ¶ Likewise, Django provides the modify_settings() decorator: from django.test import TestCase , modify_settings class MiddlewareTestCase ( TestCase ): @modify_settings ( MIDDLEWARE = { \"append\" : \"django.middleware.cache.FetchFromCacheMiddleware\" , \"prepend\" : \"django.middleware.cache.UpdateCacheMiddleware\" , } ) def test_cache_middleware ( self ): response = self . client . get ( \"/\" ) # ... The decorator can also be applied to test case classes: from django.test import TestCase , modify_settings @modify_settings ( MIDDLEWARE = { \"append\" : \"django.middleware.cache.FetchFromCacheMiddleware\" , \"prepend\" : \"django.middleware.cache.UpdateCacheMiddleware\" , } ) class MiddlewareTestCase ( TestCase ): def test_cache_middleware ( self ): response = self . client . get ( \"/\" ) # ... Note When given a class, these decorators modify the class directly and return\nit; they don’t create and return a modified copy of it. So if you try to\ntweak the above examples to assign the return value to a different name\nthan LoginTestCase or MiddlewareTestCase , you may be surprised to\nfind that the original test case classes are still equally affected by the\ndecorator. For a given class, modify_settings() is\nalways applied after override_settings() . Warning The settings file contains some settings that are only consulted during\ninitialization of Django internals. If you change them with override_settings , the setting is changed if you access it via the django.conf.settings module, however, Django’s internals access it\ndifferently. Effectively, using override_settings() or modify_settings() with these settings is probably not\ngoing to do what you expect it to do. We do not recommend altering the DATABASES setting. Altering\nthe CACHES setting is possible, but a bit tricky if you are\nusing internals that make using of caching, like django.contrib.sessions . For example, you will have to reinitialize\nthe session backend in a test that uses cached sessions and overrides CACHES . Finally, avoid aliasing your settings as module-level constants as override_settings() won’t work on such values since they are\nonly evaluated the first time the module is imported. You can also simulate the absence of a setting by deleting it after settings\nhave been overridden, like this: @override_settings () def test_something ( self ): del settings . LOGIN_URL ... When overriding settings, make sure to handle the cases in which your app’s\ncode uses a cache or similar feature that retains state even if the setting is\nchanged. Django provides the django.test.signals.setting_changed signal that lets you register callbacks to clean up and otherwise reset state\nwhen settings are changed. Django itself uses this signal to reset various data: Overridden settings Data reset USE_TZ, TIME_ZONE Databases timezone TEMPLATES Template engines FORM_RENDERER Default renderer SERIALIZATION_MODULES Serializers cache LOCALE_PATHS, LANGUAGE_CODE Default translation and loaded translations STATIC_ROOT, STATIC_URL, STORAGES Storages configuration Changed in Django 5.1: Resetting the default renderer when the FORM_RENDERER setting is\nchanged was added. Isolating apps ¶ utils. isolate_apps ( * app_labels , attr_name = None , kwarg_name = None ) ¶ Registers the models defined within a wrapped context into their own\nisolated apps registry. This functionality is useful\nwhen creating model classes for tests, as the classes will be cleanly\ndeleted afterward, and there is no risk of name collisions. The app labels which the isolated registry should contain must be passed as\nindividual arguments. You can use isolate_apps() as a decorator or a\ncontext manager. For example: from django.db import models from django.test import SimpleTestCase from django.test.utils import isolate_apps class MyModelTests ( SimpleTestCase ): @isolate_apps ( \"app_label\" ) def test_model_definition ( self ): class TestModel ( models . Model ): pass ... … or: with isolate_apps ( \"app_label\" ): class TestModel ( models . Model ): pass ... The decorator form can also be applied to classes. Two optional keyword arguments can be specified: attr_name : attribute assigned the isolated registry if used as a\nclass decorator. kwarg_name : keyword argument passing the isolated registry if used as\na function decorator. The temporary Apps instance used to isolate model registration can be\nretrieved as an attribute when used as a class decorator by using the attr_name parameter: @isolate_apps ( \"app_label\" , attr_name = \"apps\" ) class TestModelDefinition ( SimpleTestCase ): def test_model_definition ( self ): class TestModel ( models . Model ): pass self . assertIs ( self . apps . get_model ( \"app_label\" , \"TestModel\" ), TestModel ) … or alternatively as an argument on the test method when used as a method\ndecorator by using the kwarg_name parameter: class TestModelDefinition ( SimpleTestCase ): @isolate_apps ( \"app_label\" , kwarg_name = \"apps\" ) def test_model_definition ( self , apps ): class TestModel ( models . Model ): pass self . assertIs ( apps . get_model ( \"app_label\" , \"TestModel\" ), TestModel ) Emptying the test outbox ¶ If you use any of Django’s custom TestCase classes, the test runner will\nclear the contents of the test email outbox at the start of each test case. For more detail on email services during tests, see Email services below. Assertions ¶ As Python’s normal unittest.TestCase class implements assertion methods\nsuch as assertTrue() and assertEqual() , Django’s custom TestCase class\nprovides a number of custom assertion methods that are useful for testing web\napplications: The failure messages given by most of these assertion methods can be customized\nwith the msg_prefix argument. This string will be prefixed to any failure\nmessage generated by the assertion. This allows you to provide additional\ndetails that may help you to identify the location and cause of a failure in\nyour test suite. SimpleTestCase. assertRaisesMessage ( expected_exception , expected_message , callable , * args , ** kwargs ) [source] ¶ SimpleTestCase. assertRaisesMessage ( expected_exception , expected_message ) Asserts that execution of callable raises expected_exception and\nthat expected_message is found in the exception’s message. Any other\noutcome is reported as a failure. It’s a simpler version of unittest.TestCase.assertRaisesRegex() with the difference that expected_message isn’t treated as a regular expression. If only the expected_exception and expected_message parameters are\ngiven, returns a context manager so that the code being tested can be\nwritten inline rather than as a function: with self . assertRaisesMessage ( ValueError , \"invalid literal for int()\" ): int ( \"a\" ) SimpleTestCase. assertWarnsMessage ( expected_warning , expected_message , callable , * args , ** kwargs ) [source] ¶ SimpleTestCase. assertWarnsMessage ( expected_warning , expected_message ) Analogous to SimpleTestCase.assertRaisesMessage() but for assertWarnsRegex() instead of assertRaisesRegex() . SimpleTestCase. assertFieldOutput ( fieldclass , valid , invalid , field_args = None , field_kwargs = None , empty_value = '' ) [source] ¶ Asserts that a form field behaves correctly with various inputs. Parameters : fieldclass – the class of the field to be tested. valid – a dictionary mapping valid inputs to their expected cleaned\nvalues. invalid – a dictionary mapping invalid inputs to one or more raised\nerror messages. field_args – the args passed to instantiate the field. field_kwargs – the kwargs passed to instantiate the field. empty_value – the expected clean output for inputs in empty_values . For example, the following code tests that an EmailField accepts a@a.com as a valid email address, but rejects aaa with a reasonable\nerror message: self . assertFieldOutput ( EmailField , { \"a@a.com\" : \"a@a.com\" }, { \"aaa\" : [ \"Enter a valid email address.\" ]} ) SimpleTestCase. assertFormError ( form , field , errors , msg_prefix = '' ) [source] ¶ Asserts that a field on a form raises the provided list of errors. form is a Form instance. The form must be bound but not necessarily\nvalidated ( assertFormError() will automatically call full_clean() on the form). field is the name of the field on the form to check. To check the form’s non-field errors , use field=None . errors is a list of all the error strings that the field is expected to\nhave. You can also pass a single error string if you only expect one error\nwhich means that errors='error message' is the same as errors=['error message'] . SimpleTestCase. assertFormSetError ( formset , form_index , field , errors , msg_prefix = '' ) [source] ¶ Asserts that the formset raises the provided list of errors when\nrendered. formset is a FormSet instance. The formset must be bound but not\nnecessarily validated ( assertFormSetError() will automatically call the full_clean() on the formset). form_index is the number of the form within the FormSet (starting\nfrom 0). Use form_index=None to check the formset’s non-form errors,\ni.e. the errors you get when calling formset.non_form_errors() . In that\ncase you must also use field=None . field and errors have the same meaning as the parameters to assertFormError() . SimpleTestCase. assertContains ( response , text , count = None , status_code = 200 , msg_prefix = '' , html = False ) [source] ¶ Asserts that a response produced the\ngiven status_code and that text appears in its content . If count is provided, text must occur exactly count times in the response. Set html to True to handle text as HTML. The comparison with\nthe response content will be based on HTML semantics instead of\ncharacter-by-character equality. Whitespace is ignored in most cases,\nattribute ordering is not significant. See assertHTMLEqual() for more details. Changed in Django 5.1: In older versions, error messages didn’t contain the response content. SimpleTestCase. assertNotContains ( response , text , status_code = 200 , msg_prefix = '' , html = False ) [source] ¶ Asserts that a response produced the\ngiven status_code and that text does not appear in its content . Set html to True to handle text as HTML. The comparison with\nthe response content will be based on HTML semantics instead of\ncharacter-by-character equality. Whitespace is ignored in most cases,\nattribute ordering is not significant. See assertHTMLEqual() for more details. Changed in Django 5.1: In older versions, error messages didn’t contain the response content. SimpleTestCase. assertTemplateUsed ( response , template_name , msg_prefix = '' , count = None ) [source] ¶ Asserts that the template with the given name was used in rendering the\nresponse. response must be a response instance returned by the test client . template_name should be a string such as 'admin/index.html' . The count argument is an integer indicating the number of times the\ntemplate should be rendered. Default is None , meaning that the template\nshould be rendered one or more times. You can use this as a context manager, like this: with self . assertTemplateUsed ( \"index.html\" ): render_to_string ( \"index.html\" ) with self . assertTemplateUsed ( template_name = \"index.html\" ): render_to_string ( \"index.html\" ) SimpleTestCase. assertTemplateNotUsed ( response , template_name , msg_prefix = '' ) [source] ¶ Asserts that the template with the given name was not used in rendering\nthe response. You can use this as a context manager in the same way as assertTemplateUsed() . SimpleTestCase. assertURLEqual ( url1 , url2 , msg_prefix = '' ) [source] ¶ Asserts that two URLs are the same, ignoring the order of query string\nparameters except for parameters with the same name. For example, /path/?x=1&y=2 is equal to /path/?y=2&x=1 , but /path/?a=1&a=2 isn’t equal to /path/?a=2&a=1 . SimpleTestCase. assertRedirects ( response , expected_url , status_code = 302 , target_status_code = 200 , msg_prefix = '' , fetch_redirect_response = True ) [source] ¶ Asserts that the response returned a status_code redirect status, redirected\nto expected_url (including any GET data), and that the final page\nwas received with target_status_code . If your request used the follow argument, the expected_url and target_status_code will be the url and status code for the final\npoint of the redirect chain. If fetch_redirect_response is False , the final page won’t be\nloaded. Since the test client can’t fetch external URLs, this is\nparticularly useful if expected_url isn’t part of your Django app. Scheme is handled correctly when making comparisons between two URLs. If\nthere isn’t any scheme specified in the location where we are redirected to,\nthe original request’s scheme is used. If present, the scheme in expected_url is the one used to make the comparisons to. SimpleTestCase. assertHTMLEqual ( html1 , html2 , msg = None ) [source] ¶ Asserts that the strings html1 and html2 are equal. The comparison\nis based on HTML semantics. The comparison takes following things into\naccount: Whitespace before and after HTML tags is ignored. All types of whitespace are considered equivalent. All open tags are closed implicitly, e.g. when a surrounding tag is\nclosed or the HTML document ends. Empty tags are equivalent to their self-closing version. The ordering of attributes of an HTML element is not significant. Boolean attributes (like checked ) without an argument are equal to\nattributes that equal in name and value (see the examples). Text, character references, and entity references that refer to the same\ncharacter are equivalent. The following examples are valid tests and don’t raise any AssertionError : self . assertHTMLEqual ( \"<p>Hello <b>&#x27;world&#x27;!</p>\" , \"\"\"<p> Hello   <b>&#39;world&#39;! </b> </p>\"\"\" , ) self . assertHTMLEqual ( '<input type=\"checkbox\" checked=\"checked\" id=\"id_accept_terms\" />' , '<input id=\"id_accept_terms\" type=\"checkbox\" checked>' , ) html1 and html2 must contain HTML. An AssertionError will be\nraised if one of them cannot be parsed. Output in case of error can be customized with the msg argument. SimpleTestCase. assertHTMLNotEqual ( html1 , html2 , msg = None ) [source] ¶ Asserts that the strings html1 and html2 are not equal. The\ncomparison is based on HTML semantics. See assertHTMLEqual() for details. html1 and html2 must contain HTML. An AssertionError will be\nraised if one of them cannot be parsed. Output in case of error can be customized with the msg argument. SimpleTestCase. assertXMLEqual ( xml1 , xml2 , msg = None ) [source] ¶ Asserts that the strings xml1 and xml2 are equal. The\ncomparison is based on XML semantics. Similarly to assertHTMLEqual() , the comparison is\nmade on parsed content, hence only semantic differences are considered, not\nsyntax differences. When invalid XML is passed in any parameter, an AssertionError is always raised, even if both strings are identical. XML declaration, document type, processing instructions, and comments are\nignored. Only the root element and its children are compared. Output in case of error can be customized with the msg argument. SimpleTestCase. assertXMLNotEqual ( xml1 , xml2 , msg = None ) [source] ¶ Asserts that the strings xml1 and xml2 are not equal. The\ncomparison is based on XML semantics. See assertXMLEqual() for details. Output in case of error can be customized with the msg argument. SimpleTestCase. assertInHTML ( needle , haystack , count = None , msg_prefix = '' ) [source] ¶ Asserts that the HTML fragment needle is contained in the haystack once. If the count integer argument is specified, then additionally the number\nof needle occurrences will be strictly verified. Whitespace in most cases is ignored, and attribute ordering is not\nsignificant. See assertHTMLEqual() for more details. Changed in Django 5.1: In older versions, error messages didn’t contain the haystack . SimpleTestCase. assertNotInHTML ( needle , haystack , msg_prefix = '' ) [source] ¶ New in Django 5.1. Asserts that the HTML fragment needle is not contained in the haystack . Whitespace in most cases is ignored, and attribute ordering is not\nsignificant. See assertHTMLEqual() for more details. SimpleTestCase. assertJSONEqual ( raw , expected_data , msg = None ) [source] ¶ Asserts that the JSON fragments raw and expected_data are equal.\nUsual JSON non-significant whitespace rules apply as the heavyweight is\ndelegated to the json library. Output in case of error can be customized with the msg argument. SimpleTestCase. assertJSONNotEqual ( raw , expected_data , msg = None ) [source] ¶ Asserts that the JSON fragments raw and expected_data are not equal.\nSee assertJSONEqual() for further details. Output in case of error can be customized with the msg argument. TransactionTestCase. assertQuerySetEqual ( qs , values , transform = None , ordered = True , msg = None ) [source] ¶ Asserts that a queryset qs matches a particular iterable of values values . If transform is provided, values is compared to a list produced by\napplying transform to each member of qs . By default, the comparison is also ordering dependent. If qs doesn’t\nprovide an implicit ordering, you can set the ordered parameter to False , which turns the comparison into a collections.Counter comparison.\nIf the order is undefined (if the given qs isn’t ordered and the\ncomparison is against more than one ordered value), a ValueError is\nraised. Output in case of error can be customized with the msg argument. TransactionTestCase. assertNumQueries ( num , func , * args , ** kwargs ) [source] ¶ Asserts that when func is called with *args and **kwargs that num database queries are executed. If a \"using\" key is present in kwargs it is used as the database\nalias for which to check the number of queries: self . assertNumQueries ( 7 , using = \"non_default_db\" ) If you wish to call a function with a using parameter you can do it by\nwrapping the call with a lambda to add an extra parameter: self . assertNumQueries ( 7 , lambda : my_function ( using = 7 )) You can also use this as a context manager: with self . assertNumQueries ( 2 ): Person . objects . create ( name = \"Aaron\" ) Person . objects . create ( name = \"Daniel\" ) Tagging tests ¶ You can tag your tests so you can easily run a particular subset. For example,\nyou might label fast or slow tests: from django.test import tag class SampleTestCase ( TestCase ): @tag ( \"fast\" ) def test_fast ( self ): ... @tag ( \"slow\" ) def test_slow ( self ): ... @tag ( \"slow\" , \"core\" ) def test_slow_but_core ( self ): ... You can also tag a test case class: @tag ( \"slow\" , \"core\" ) class SampleTestCase ( TestCase ): ... Subclasses inherit tags from superclasses, and methods inherit tags from their\nclass. Given: @tag ( \"foo\" ) class SampleTestCaseChild ( SampleTestCase ): @tag ( \"bar\" ) def test ( self ): ... SampleTestCaseChild.test will be labeled with 'slow' , 'core' , 'bar' , and 'foo' . Then you can choose which tests to run. For example, to run only fast tests: /  $ ./manage.py test --tag = fast ...\\> manage.py test --tag=fast Or to run fast tests and the core one (even though it’s slow): /  $ ./manage.py test --tag = fast --tag = core ...\\> manage.py test --tag=fast --tag=core You can also exclude tests by tag. To run core tests if they are not slow: /  $ ./manage.py test --tag = core --exclude-tag = slow ...\\> manage.py test --tag=core --exclude-tag=slow test --exclude-tag has precedence over test --tag , so if a\ntest has two tags and you select one of them and exclude the other, the test\nwon’t be run. Testing asynchronous code ¶ If you merely want to test the output of your asynchronous views, the standard\ntest client will run them inside their own asynchronous loop without any extra\nwork needed on your part. However, if you want to write fully-asynchronous tests for a Django project,\nyou will need to take several things into account. Firstly, your tests must be async def methods on the test class (in order\nto give them an asynchronous context). Django will automatically detect\nany async def tests and wrap them so they run in their own event loop. If you are testing from an asynchronous function, you must also use the\nasynchronous test client. This is available as django.test.AsyncClient ,\nor as self.async_client on any test. class AsyncClient ( enforce_csrf_checks = False , raise_request_exception = True , * , headers = None , query_params = None , ** defaults ) [source] ¶ AsyncClient has the same methods and signatures as the synchronous (normal)\ntest client, with the following exceptions: In the initialization, arbitrary keyword arguments in defaults are added\ndirectly into the ASGI scope. Headers passed as extra keyword arguments should not have the HTTP_ prefix required by the synchronous client (see Client.get() ). For\nexample, here is how to set an HTTP Accept header: >>> c = AsyncClient () >>> c . get ( \"/customers/details/\" , { \"name\" : \"fred\" , \"age\" : 7 }, ACCEPT = \"application/json\" ) Changed in Django 5.0: Support for the follow parameter was added to the AsyncClient . Changed in Django 5.1: The query_params argument was added. Using AsyncClient any method that makes a request must be awaited: async def test_my_thing ( self ): response = await self . async_client . get ( \"/some-url/\" ) self . assertEqual ( response . status_code , 200 ) The asynchronous client can also call synchronous views; it runs through\nDjango’s asynchronous request path , which supports both.\nAny view called through the AsyncClient will get an ASGIRequest object\nfor its request rather than the WSGIRequest that the normal client\ncreates. Warning If you are using test decorators, they must be async-compatible to ensure\nthey work correctly. Django’s built-in decorators will behave correctly, but\nthird-party ones may appear to not execute (they will “wrap” the wrong part\nof the execution flow and not your test). If you need to use these decorators, then you should decorate your test\nmethods with async_to_sync() inside of them instead: from asgiref.sync import async_to_sync from django.test import TestCase class MyTests ( TestCase ): @mock . patch ( ... ) @async_to_sync async def test_my_thing ( self ): ... Email services ¶ If any of your Django views send email using Django’s email\nfunctionality , you probably don’t want to send email each time\nyou run a test using that view. For this reason, Django’s test runner\nautomatically redirects all Django-sent email to a dummy outbox. This lets you\ntest every aspect of sending email – from the number of messages sent to the\ncontents of each message – without actually sending the messages. The test runner accomplishes this by transparently replacing the normal\nemail backend with a testing backend.\n(Don’t worry – this has no effect on any other email senders outside of\nDjango, such as your machine’s mail server, if you’re running one.) django.core.mail. outbox ¶ During test running, each outgoing email is saved in django.core.mail.outbox . This is a list of all EmailMessage instances that have been sent.  The outbox attribute is a special attribute that is created only when the locmem email backend is used. It doesn’t normally exist as part of the django.core.mail module and you can’t import it directly. The code below\nshows how to access this attribute correctly. Here’s an example test that examines django.core.mail.outbox for length\nand contents: from django.core import mail from django.test import TestCase class EmailTest ( TestCase ): def test_send_email ( self ): # Send message. mail . send_mail ( \"Subject here\" , \"Here is the message.\" , \"from@example.com\" , [ \"to@example.com\" ], fail_silently = False , ) # Test that one message has been sent. self . assertEqual ( len ( mail . outbox ), 1 ) # Verify that the subject of the first message is correct. self . assertEqual ( mail . outbox [ 0 ] . subject , \"Subject here\" ) As noted previously , the test outbox is emptied\nat the start of every test in a Django *TestCase . To empty the outbox\nmanually, assign the empty list to mail.outbox : from django.core import mail # Empty the test outbox mail . outbox = [] Management Commands ¶ Management commands can be tested with the call_command() function. The output can be\nredirected into a StringIO instance: from io import StringIO from django.core.management import call_command from django.test import TestCase class ClosepollTest ( TestCase ): def test_command_output ( self ): out = StringIO () call_command ( \"closepoll\" , poll_ids = [ 1 ], stdout = out ) self . assertIn ( 'Successfully closed poll \"1\"' , out . getvalue ()) Skipping tests ¶ The unittest library provides the @skipIf and @skipUnless decorators to allow you to skip tests\nif you know ahead of time that those tests are going to fail under certain\nconditions. For example, if your test requires a particular optional library in order to\nsucceed, you could decorate the test case with @skipIf . Then, the test runner will report that the test wasn’t\nexecuted and why, instead of failing the test or omitting the test altogether. To supplement these test skipping behaviors, Django provides two\nadditional skip decorators. Instead of testing a generic boolean,\nthese decorators check the capabilities of the database, and skip the\ntest if the database doesn’t support a specific named feature. The decorators use a string identifier to describe database features.\nThis string corresponds to attributes of the database connection\nfeatures class. See django.db.backends.base.features.BaseDatabaseFeatures class for a full list of database features\nthat can be used as a basis for skipping tests. skipIfDBFeature ( * feature_name_strings ) [source] ¶ Skip the decorated test or TestCase if all of the named database features\nare supported. For example, the following test will not be executed if the database\nsupports transactions (e.g., it would not run under PostgreSQL, but\nit would under MySQL with MyISAM tables): class MyTests ( TestCase ): @skipIfDBFeature ( \"supports_transactions\" ) def test_transaction_behavior ( self ): # ... conditional test code pass skipUnlessDBFeature ( * feature_name_strings ) [source] ¶ Skip the decorated test or TestCase if any of the named database features\nare not supported. For example, the following test will only be executed if the database\nsupports transactions (e.g., it would run under PostgreSQL, but not under MySQL with MyISAM tables): class MyTests ( TestCase ): @skipUnlessDBFeature ( \"supports_transactions\" ) def test_transaction_behavior ( self ): # ... conditional test code pass", "keywords": ["users", "accounts", "assertjsonequal", "feature", "storage", "create_user", "--tag", "formset", "login", "haystack", "django.db.backends.base.features", "emailfield", "defining", "messages", "/login/", "background", "platforms", "activity", "library", "type=\"checkbox", "field", "#", "xml1", "assertinhtml", "runner", "find_element", "serialization", "flush", "contacttests", "aspect", "\\x00\\x00\\x00\\x00\\x01\\x00\\x01\\x00\\x00\\x02\\x01\\x00\\x00", "octet", "animaltestcase", "loop", "patching", "meaning", "copy.deepcopy", "lambda", "action", "outcome", "animal", "httpresponse", "wsgirequest", "subset", "member", "cache", "assertionerror", "get_model", "literal", "payload", "analogous", "suite", "asgirequest", "presence", "test_model_definition", "policies", "http", "=", "changes", "head", "engine", "stream", "message", "testcase.setuptestdata", "permissiondenied", "inequality", "fact", "inputs", "clients", "character", "call_command", "expected_message", "setup", "tables", "tag", "button", "assertwarnsregex", "pip", "mail.outbox", "process", "meanings", "debug", "html2", "expected_data", "myapp.tests", "login/?next=/sekrit/", "test_index_page_view", "assertin", "topic", "multiple", "collection", "test_command_output", "test_transaction_behavior", "john", "fault", "following", "type", "processing", "asession", "filefield", "serializers", "calls", "custom", "kwargs", "objects", "documentation", "write", "optimization", "file", "root_urlconf", "work", "user", "fragment", "validate_image_file_extension", "emailtest", "cases", "9.3.8", "callbacks", "layers", "attribute", "helper", "args", "response.headers['content", "warning", "transactiontestcase.fixtures", "constraints", "client.raise_request_exception", "url/", "time", "login/", "tags", "expiration", "risk", "signatures", "basis", "setting", "purposes", "faq", "responses", "self.live_server_url", "account", "app_label", "language_cookie_name", "leaking", "things", "transform", "transactiontestcase.databases", "preference", "password", "simplecookie", "name", "expected_warning", "interpreter", "deals", "parameter", "aaron", "fieldclass", "execution", "as_view", "test_language_using_header", "copies", "reference", "mammals.json", "web", "issue", "age", "url1", "kwarg_name", "versions", "assertis", "djangojsonencoder", "queries", "self.async_client", "simpletestcase", "focus", "manager", "/other", "visitor", "select_for_update", "override_settings", "children", "normal", "behaviors", "return", "static_url", "operator", "applications", "birds", "memory", "foo", "use_tz", "closepolltest", "live_server_url", "serialization_modules", "django.core.mail.outbox", "myseleniumtests.test_login", "flushes", "examples", "failure", "additions", "locmem", "sessionmiddleware", "username", "status", "django.http.httprequest.accepts", "url", "error", "conditions", "module", "collectstatic", "code", "classmethod", "timeout", "aaa", "mytest", "secret", "resolvermatch", "isolate_apps", "assertnotinhtml", "assertwarnsmessage", "pages", "false", "behavior", "c", "link", "class", "access", "manage.py", "msg_prefix", "test_my_stuff", "/contact/", "assertequal", "returns", "html1", "javascript", "'", "retrieve", "login_url", "force_login", "assert", "request", "gif89a", "database", "block", "flag", "output", "input", "password_input", "signal", "*", "formset.non_form_errors", "query", "page", "test", "suspiciousoperation", "commands", "index.html", "postgresql", "logout", "migrate", "types", "count", "strings", "empty_value", "non_default_db", "py", "subclass", "expected_exception", "id=\"id_accept_terms", "creation", ".", "customers", "test_slow", "http404", "registry", "transactiontestcase", "xml", "wsgi", "configuration", "assertxmlnotequal", "script", "step", "send_keys", "altering", "thread", "section", "user-data.json", "validator", "/", "append", "follow", "source", "mail", "evaluation", "use", "httpresponse.headers", "replacement", "environment", "credentials", "commit", "testmodeldefinition", "img", "static_root", "engines", "entity", "subclasses", "teardownclass", "performance", "protection", "assertfieldoutput", "extensions", "core", "pass", "order", "default", "test_details", "occurrences", "django.middleware.cache", "counter", "choices", "django.test", "containment", "alias", "form", "prefix", "properties", "format", "callback", "classes", "tests", "expression", "assertxmlequal", "environ", "equality", "set_password", "fixture", "@override_settings", "scheme", "chain", "len", "combination", "routing", "template", "--exclude", "header", "4.8.0", "supports_transactions", "iana", "way", "staticliveservertestcase", "bienvenue", "frameworks", "manipulate", "fred&passwd", "execute", "super", "cause", "checks", "expected_url", "interfaces", "transaction.on_commit", "fr", "comments", "@async_to_sync", "accept", "macos", "party", "queryset", "status_code", "integer", "session", "mytests", "¶", "command", "internationalization", "sampletestcase", "post", "parameters", "services", "assertformerror", "int", "encoder", "atomic", "property", "side", "test_fast", "assertcontains", "content", "function", "form_index", "views", "testing", "result", "view", "details/?name", "django.contrib.sessions", "run", "self.client", "agent", "number", "/final/", "collections", "def", "point", "attr_name", "values", "staticfiles", "assertjsonnotequal", "selections", "string", "logintestcase", "_", "test_language_using_cookie", "cls", "assertraisesregex", "django.core", "sys.exc_info", "overview", "contact", "mapping", "thing", "fetch_redirect_response", "databases", "xpath", "arthur", "unit", "fraction", "event", "hand", "location", "subject", "drivers", "language", "@skipunlessdbfeature", "facilities", "models", "copy", "exit", "blocks", "version", "choosing", "level", "json", "anonymoususer", "context_data", "contents", "loading", "absence", "machine", "image", "benefits", "attachment", "enforce_csrf_checks", "treatment", "condition", "requestfactory", "django", "series", "myapp", "rfc", "n’t", "fields", "modelbackend", "middlewaretestcase", "setupclass", "dumpdata", "set", "systemexit", "development", "override", "view_class", "operating", "practice", "value", "needle", "assertion", "modify_settings", "bit", "superclasses", "codes", "aforce_login", "test1", "hierarchy", "form_renderer", "pep", "data", "browser", "implementation", "to@example.com", "handler", "scope", "messagemiddleware", "base", "backend", "patch", "person", "json.dumps", "inline", "my_function", "assertions", "declaration", "iterable", "magic", "field_kwargs", "paths", "self", "instance", "effects", "localization", "djangotemplates", "speed", "initialization", "extension", "constants", "consequence", "readability", "empty", "otherdbtests", "trace", "functionality", "start", "setuptestdata", "assertredirects", "myuser", "decorator", "exc_info", "constructor", "a@a.com", "instances", "template.name", "./manage.py", "emailmessage", "authenticationmiddleware", "installed_apps", "part", "specialized", "fixtures", "asserttrue", "username_input", "object", "captureoncommitcallbacks", "load", "binds", "empty_values", "/path/?y=2&x=1", "references", "senders", "domain", "valueerror", "authenticate", "skipunlessdbfeature", "localemiddleware", "teardown", "test_cache_middleware", "@isolate_apps", "response", "management", "precedence", "internals", "assertraisesmessage", "website", "dictionary", "whitespace", "prepend", "instructions", "requests", "reset", "heavyweight", "alogout", "pairs", "try", "rendering", "keyword", "segmentation", "@modify_settings", "io", "csrf", "ordering", "rules", "variables", "registration", "decorators", "root", "qs", "redirect", "effect", "detail", "url2", "system", "pointer", "apps", "port", "address", "myimage.gif", "manner", "overhead", "mytestcase", "closepoll", "alterations", "sessionstore", "async", "django.core.mail", "imagefield", "production", "storages", "asyncclient", "comparisons", "definition", "headers", "webdriver", "testmyviews", "check", "difference", "site", "json.loads", "features", "bytestring", "\\x01\\x00\\x01\\x00\\x00\\x00\\x00", "algorithms", "errors='error", "skip", "@override_settings(root_urlconf=", "example", "webdriverwait", "app", "func", "redirect_chain", "django.test.*testcase", "parallel", "list", "locale_paths", "orm", "daniel", "/next/", "stringio", "utils", "assertformseterror", "translation.override", "manipulations", "poll", "fragments", "hasher", "@skipifdbfeature", "steps", "email", "semantics", "stack", "model", "errors=['error", "https://www.example.com/login/", "reasons", "callable", "element", "application", "flow", "asserttemplatenotused", "actions", "attributes", "testcase", "/app/", "simpletest", "ability", "xml2", "differences", "mon", "redirects", "localhost", "asgi", "call_some_test_code", "urlconf", "mytestclient", "myisam", "translation", "syntax", "capabilities", "@mock", "ones", "content_type", "rollback", "client.get", "assertnotcontains", "case", "csrf_client", "length", "boolean", "authentication", "symptoms", "query_params", "full_clean", "technique", "html", "errors", "test_index", "tuple", "server", "test_fluffy_animals", "arguments", "registers", "async_to_sync", "package", "driver", "assertraises", "middleware", "fp", "one", "django.conf.settings", "end", "translations", "msg", "probes", "sqlite", "myview", "comparison", "tuples", "bar", "assertnumqueries", "path", "sur", "skiptest", "functions", "key", "handle", "renderer", "sampletestcasechild", "fetchfromcachemiddleware", "poll_ids", "my_view", "none", "problem", "get", "collisions", "simpletestcase.databases", "definitions", "to", "/sekrit/", "reason", "raise_request_exception", "framework", "caches", "django.test.utils", "asserthtmlnotequal", "new", "true", "\\", "urls", "posts", "api", "loads", "sessions", "support", "myapp.models", "cookies", "somekey", "target_status_code", "mode", "outbox", "document", "transactions", "serialized_rollback", "connection", "-", "enforces", "django.utils", "context", "alternative", "test2", "threads", "import", "files", "@skipif", "put", "mysql", "directory", ">", "defaults", "call", "default_db_alias", "information", "python", "/customers", "updatecachemiddleware", "fred&age=7", "http.cookies", "feature_name_strings", "methods", "basedatabasefeatures", "options", "times", "exception", "firefox", "client", "@classmethod", "details", "method", "simulate", "verification", "settings", "transaction", "argument", "django.db", "num", "mammals", "selenium", "json_encoder", "note", "body", "state", "cookie", "del", "getvalue", "smith", "tools", "asserthtmlequal", "test_my_thing", "client_class", "templates", "beginning", "lack", "testmodel", "text", "project", "exceptions"], "type": "documentation"},
{"title": "Logging | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/logging/", "content": "Logging ¶ See also How to configure and use logging Django logging overview Django’s logging module extends Python’s builtin logging . Logging is configured as part of the general Django django.setup() function, so it’s always available unless explicitly disabled. Django’s default logging configuration ¶ By default, Django uses Python’s logging.config.dictConfig format . Default logging conditions ¶ The full set of default logging conditions are: When DEBUG is True : The django logger sends messages in the django hierarchy (except django.server ) at the INFO level or higher to the console. When DEBUG is False : The django logger sends messages in the django hierarchy (except django.server )  with ERROR or CRITICAL level to AdminEmailHandler . Independently of the value of DEBUG : The django.server logger sends messages at the INFO level\nor higher to the console. All loggers except django.server propagate logging to their\nparents, up to the root django logger. The console and mail_admins handlers are attached to the root logger to provide the behavior described\nabove. Python’s own defaults send records of level WARNING and higher\nto the console. Default logging definition ¶ Django’s default logging configuration inherits Python’s defaults. It’s\navailable as django.utils.log.DEFAULT_LOGGING and defined in django/utils/log.py : { \"version\" : 1 , \"disable_existing_loggers\" : False , \"filters\" : { \"require_debug_false\" : { \"()\" : \"django.utils.log.RequireDebugFalse\" , }, \"require_debug_true\" : { \"()\" : \"django.utils.log.RequireDebugTrue\" , }, }, \"formatters\" : { \"django.server\" : { \"()\" : \"django.utils.log.ServerFormatter\" , \"format\" : \"[ {server_time} ] {message} \" , \"style\" : \"{\" , } }, \"handlers\" : { \"console\" : { \"level\" : \"INFO\" , \"filters\" : [ \"require_debug_true\" ], \"class\" : \"logging.StreamHandler\" , }, \"django.server\" : { \"level\" : \"INFO\" , \"class\" : \"logging.StreamHandler\" , \"formatter\" : \"django.server\" , }, \"mail_admins\" : { \"level\" : \"ERROR\" , \"filters\" : [ \"require_debug_false\" ], \"class\" : \"django.utils.log.AdminEmailHandler\" , }, }, \"loggers\" : { \"django\" : { \"handlers\" : [ \"console\" , \"mail_admins\" ], \"level\" : \"INFO\" , }, \"django.server\" : { \"handlers\" : [ \"django.server\" ], \"level\" : \"INFO\" , \"propagate\" : False , }, }, } See Configuring logging on how to complement or replace this default\nlogging configuration. Django logging extensions ¶ Django provides a number of utilities to handle the particular requirements of\nlogging in a web server environment. Loggers ¶ Django provides several built-in loggers. django ¶ The parent logger for messages in the django named logger hierarchy . Django does not post messages using this name.\nInstead, it uses one of the loggers below. django.request ¶ Log messages related to the handling of requests. 5XX responses are\nraised as ERROR messages; 4XX responses are raised as WARNING messages. Requests that are logged to the django.security logger aren’t\nlogged to django.request . Messages to this logger have the following extra context: status_code : The HTTP response code associated with the request. request : The request object that generated the logging message. django.server ¶ Log messages related to the handling of requests received by the server invoked\nby the runserver command. HTTP 5XX responses are logged as ERROR messages, 4XX responses are logged as WARNING messages, and everything else\nis logged as INFO . Messages to this logger have the following extra context: status_code : The HTTP response code associated with the request. request : The request object (a socket.socket ) that generated the logging message. django.template ¶ Log messages related to the rendering of templates. Missing context variables are logged as DEBUG messages. django.db.backends ¶ Messages relating to the interaction of code with the database. For example,\nevery application-level SQL statement executed by a request is logged at the DEBUG level to this logger. Messages to this logger have the following extra context: duration : The time taken to execute the SQL statement. sql : The SQL statement that was executed. params : The parameters that were used in the SQL call. alias : The alias of the database used in the SQL call. For performance reasons, SQL logging is only enabled when settings.DEBUG is set to True , regardless of the logging\nlevel or handlers that are installed. This logging does not include framework-level initialization (e.g. SET TIMEZONE ). Turn on query logging in your database if you wish to view\nall database queries. django.utils.autoreload ¶ Log messages related to automatic code reloading during the execution of the\nDjango development server. This logger generates an INFO message upon\ndetecting a modification in a source code file and may produce WARNING messages during filesystem inspection and event subscription processes. django.contrib.auth ¶ New in Django 4.2.16. Log messages related to django.contrib.auth , particularly ERROR messages\nare generated when a PasswordResetForm is\nsuccessfully submitted but the password reset email cannot be delivered due to\na mail sending exception. django.contrib.gis ¶ Log messages related to GeoDjango at various points: during the\nloading of external GeoSpatial libraries (GEOS, GDAL, etc.) and when reporting\nerrors. Each ERROR log record includes the caught exception and relevant\ncontextual data. django.dispatch ¶ This logger is used in Signals , specifically within the Signal class, to report issues when dispatching a\nsignal to a connected receiver. The ERROR log record includes the caught\nexception as exc_info and adds the following extra context: receiver : The name of the receiver. err : The exception that occurred when calling the receiver. django.security.* ¶ The security loggers will receive messages on any occurrence of SuspiciousOperation and other security-related\nerrors. There is a sub-logger for each subtype of security error, including all SuspiciousOperation s. The level of the log event depends on where the\nexception is handled.  Most occurrences are logged as a warning, while\nany SuspiciousOperation that reaches the WSGI handler will be logged as an\nerror. For example, when an HTTP Host header is included in a request from\na client that does not match ALLOWED_HOSTS , Django will return a 400\nresponse, and an error message will be logged to the django.security.DisallowedHost logger. These log events will reach the django logger by default, which mails error\nevents to admins when DEBUG=False . Requests resulting in a 400 response due\nto a SuspiciousOperation will not be logged to the django.request logger, but only to the django.security logger. To silence a particular type of SuspiciousOperation , you can override that\nspecific logger following this example: LOGGING = { # ... \"handlers\" : { \"null\" : { \"class\" : \"logging.NullHandler\" , }, }, \"loggers\" : { \"django.security.DisallowedHost\" : { \"handlers\" : [ \"null\" ], \"propagate\" : False , }, }, # ... } Other django.security loggers not based on SuspiciousOperation are: django.security.csrf : For CSRF failures . django.db.backends.schema ¶ Logs the SQL queries that are executed during schema changes to the database by\nthe migrations framework . Note that it won’t log the\nqueries executed by RunPython .\nMessages to this logger have params and sql in their extra context (but\nunlike django.db.backends , not duration). The values have the same meaning\nas explained in django.db.backends . django.contrib.sessions ¶ Log messages related to the session framework . Non-fatal errors occurring when using the django.contrib.sessions.backends.cached_db.SessionStore engine are\nlogged as ERROR messages with the corresponding traceback. Handlers ¶ Django provides one log handler in addition to those provided by the Python logging module . class AdminEmailHandler ( include_html = False , email_backend = None , reporter_class = None ) [source] ¶ This handler sends an email to the site ADMINS for each log\nmessage it receives. If the log record contains a request attribute, the full details\nof the request will be included in the email. The email subject will\ninclude the phrase “internal IP” if the client’s IP address is in the INTERNAL_IPS setting; if not, it will include “EXTERNAL IP”. If the log record contains stack trace information, that stack\ntrace will be included in the email. The include_html argument of AdminEmailHandler is used to\ncontrol whether the traceback email includes an HTML attachment\ncontaining the full content of the debug web page that would have been\nproduced if DEBUG were True . To set this value in your\nconfiguration, include it in the handler definition for django.utils.log.AdminEmailHandler , like this: \"handlers\" : { \"mail_admins\" : { \"level\" : \"ERROR\" , \"class\" : \"django.utils.log.AdminEmailHandler\" , \"include_html\" : True , }, } Be aware of the security implications of logging when using the AdminEmailHandler . By setting the email_backend argument of AdminEmailHandler , the email backend that is being used by the\nhandler can be overridden, like this: \"handlers\" : { \"mail_admins\" : { \"level\" : \"ERROR\" , \"class\" : \"django.utils.log.AdminEmailHandler\" , \"email_backend\" : \"django.core.mail.backends.filebased.EmailBackend\" , }, } By default, an instance of the email backend specified in EMAIL_BACKEND will be used. The reporter_class argument of AdminEmailHandler allows providing\nan django.views.debug.ExceptionReporter subclass to customize the\ntraceback text sent in the email body. You provide a string import path to\nthe class you wish to use, like this: \"handlers\" : { \"mail_admins\" : { \"level\" : \"ERROR\" , \"class\" : \"django.utils.log.AdminEmailHandler\" , \"include_html\" : True , \"reporter_class\" : \"somepackage.error_reporter.CustomErrorReporter\" , }, } send_mail ( subject , message , * args , ** kwargs ) [source] ¶ Sends emails to admin users. To customize this behavior, you can\nsubclass the AdminEmailHandler class and\noverride this method. Filters ¶ Django provides some log filters in addition to those provided by the Python\nlogging module. class CallbackFilter ( callback ) [source] ¶ This filter accepts a callback function (which should accept a single\nargument, the record to be logged), and calls it for each record that\npasses through the filter. Handling of that record will not proceed if the\ncallback returns False. For instance, to filter out UnreadablePostError (raised when a user cancels an upload) from the admin emails, you would\ncreate a filter function: from django.http import UnreadablePostError def skip_unreadable_post ( record ): if record . exc_info : exc_type , exc_value = record . exc_info [: 2 ] if isinstance ( exc_value , UnreadablePostError ): return False return True and then add it to your logging config: LOGGING = { # ... \"filters\" : { \"skip_unreadable_posts\" : { \"()\" : \"django.utils.log.CallbackFilter\" , \"callback\" : skip_unreadable_post , }, }, \"handlers\" : { \"mail_admins\" : { \"level\" : \"ERROR\" , \"filters\" : [ \"skip_unreadable_posts\" ], \"class\" : \"django.utils.log.AdminEmailHandler\" , }, }, # ... } class RequireDebugFalse [source] ¶ This filter will only pass on records when settings.DEBUG is False. This filter is used as follows in the default LOGGING configuration to ensure that the AdminEmailHandler only sends\nerror emails to admins when DEBUG is False : LOGGING = { # ... \"filters\" : { \"require_debug_false\" : { \"()\" : \"django.utils.log.RequireDebugFalse\" , }, }, \"handlers\" : { \"mail_admins\" : { \"level\" : \"ERROR\" , \"filters\" : [ \"require_debug_false\" ], \"class\" : \"django.utils.log.AdminEmailHandler\" , }, }, # ... } class RequireDebugTrue [source] ¶ This filter is similar to RequireDebugFalse , except that records are\npassed only when DEBUG is True .", "keywords": ["function", "users", "streamhandler", "requiredebugtrue", "django.security", "django.contrib.sessions.backends.cached_db", "django.contrib.sessions", "s.", "external", "subscription", "receiver", "isinstance", "number", "definition", "messages", "processes", "error", "conditions", "module", "code", "values", "site", "failures", "django.security.csrf", "filter", "info", "behavior", "style", "disable_existing_loggers", "class", "example", "addition", "#", "false", "string", "requirements", "overview", "record", "migrations", "returns", "django.utils.autoreload", "inspection", "django.db.backends.schema", "runserver", "request", "utils", "exc_type", "event", "propagate", "meaning", "database", "host", "emails", "libraries", "subject", "config", "email", "signal", "*", "query", "require_debug_false", "suspiciousoperation", "stack", "page", "version", "level", "parents", "loading", "subclass", "callbackfilter", "reasons", "emailbackend", "loggers", "application", "attachment", "customerrorreporter", "django", "formatter", "4.2.16", "http", "configuration", "wsgi", "=", "changes", "django.views.debug", "utilities", "engine", "ip", "message", "logs", "email_backend", "set", "development", "geos", "skip_unreadable_post", "critical", "occurrence", "log", "formatters", "value", "filesystem", "events", "requiredebugfalse", "internal_ips", "source", "send_mail", "django.setup", "hierarchy", "mail", "data", "debug", "handler", "skip_unreadable_posts", "backend", "errors", "html", "environment", "log.py", "server", "exc_value", "content", "upload", "adminemailhandler", "type", "security", "performance", "instance", "kwargs", "records", "file", "extensions", "nullhandler", "implications", "initialization", "handling", "params", "default", "django.server", "occurrences", "user", "path", "trace", "alias", "signals", "attribute", "none", "django.contrib.gis", "reporter_class", "format", "filters", "args", "issues", "callback", "warning", "exc_info", "unreadableposterror", "subtype", "time", "reloading", "logging", "framework", "mail_admins", "new", "setting", "true", "require_debug_true", "statement", "responses", "timezone", "django.template", "part", "geospatial", "object", "-", "builtin", "context", "password", "passwordresetform", "serverformatter", "name", "import", "admins", "response", "header", "defaults", "sql", "call", "interaction", "requests", "execution", "points", "reset", "schema", "console", "traceback", "phrase", "web", "python", "django.contrib.auth", "gdal", "information", "exceptionreporter", "rendering", "modification", "django.utils.log", "queries", "csrf", "logger", "socket.socket", "exception", "client", "details", "geodjango", "variables", "status_code", "method", "root", "settings", "session", "argument", "configuring", "¶", "return", "command", "disallowedhost", "sub", "handlers", "parameters", "runpython", "body", "server_time", "include_html", "duration", "django.db.backends", "address", "parent", "templates", "somepackage.error_reporter", "[:", "text", "sessionstore"], "type": "documentation"},
{"title": "Database migration operations | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/postgres/operations/", "content": "Database migration operations ¶ All of these operations are available from\nthe django.contrib.postgres.operations module. Creating extension using migrations ¶ You can create a PostgreSQL extension in your database using a migration file.\nThis example creates an hstore extension, but the same principles apply for\nother extensions. Set up the hstore extension in PostgreSQL before the first CreateModel or AddField operation that involves HStoreField by adding a migration with\nthe HStoreExtension operation.\nFor example: from django.contrib.postgres.operations import HStoreExtension class Migration ( migrations . Migration ): ... operations = [ HStoreExtension (), ... ] The operation skips adding the extension if it already exists. For most extensions, this requires a database user with superuser privileges.\nIf the Django database user doesn’t have the appropriate privileges, you’ll\nhave to create the extension outside of Django migrations with a user that has\nthem. In that case, connect to your Django database and run the query CREATE EXTENSION IF NOT EXISTS hstore; . CreateExtension ¶ class CreateExtension ( name ) [source] ¶ An Operation subclass which installs a PostgreSQL extension. For common\nextensions, use one of the more specific subclasses below. name ¶ This is a required argument. The name of the extension to be installed. BloomExtension ¶ class BloomExtension [source] ¶ Installs the bloom extension. BtreeGinExtension ¶ class BtreeGinExtension [source] ¶ Installs the btree_gin extension. BtreeGistExtension ¶ class BtreeGistExtension [source] ¶ Installs the btree_gist extension. CITextExtension ¶ class CITextExtension [source] ¶ Installs the citext extension. CryptoExtension ¶ class CryptoExtension [source] ¶ Installs the pgcrypto extension. HStoreExtension ¶ class HStoreExtension [source] ¶ Installs the hstore extension and also sets up the connection to\ninterpret hstore data for possible use in subsequent migrations. TrigramExtension ¶ class TrigramExtension [source] ¶ Installs the pg_trgm extension. UnaccentExtension ¶ class UnaccentExtension [source] ¶ Installs the unaccent extension. Managing collations using migrations ¶ If you need to filter or order a column using a particular collation that your\noperating system provides but PostgreSQL does not, you can manage collations in\nyour database using a migration file. These collations can then be used with\nthe db_collation parameter on CharField , TextField , and their subclasses. For example, to create a collation for German phone book ordering: from django.contrib.postgres.operations import CreateCollation class Migration ( migrations . Migration ): ... operations = [ CreateCollation ( \"case_insensitive\" , provider = \"icu\" , locale = \"und-u-ks-level2\" , deterministic = False , ), ... , ] class CreateCollation ( name , locale , * , provider = 'libc' , deterministic = True ) [source] ¶ Creates a collation with the given name , locale and provider . Set the deterministic parameter to False to create a\nnon-deterministic collation, such as for case-insensitive filtering. class RemoveCollation ( name , locale , * , provider = 'libc' , deterministic = True ) [source] ¶ Removes the collations named name . When reversed this is creating a collation with the provided locale , provider , and deterministic arguments. Therefore, locale is\nrequired to make this operation reversible. Concurrent index operations ¶ PostgreSQL supports the CONCURRENTLY option to CREATE INDEX and DROP INDEX statements to add and remove indexes without locking out writes.\nThis option is useful for adding or removing an index in a live production\ndatabase. class AddIndexConcurrently ( model_name , index ) [source] ¶ Like AddIndex , but creates an\nindex with the CONCURRENTLY option. This has a few caveats to be aware\nof when using this option, see the PostgreSQL documentation of building\nindexes concurrently . class RemoveIndexConcurrently ( model_name , name ) [source] ¶ Like RemoveIndex , but removes the\nindex with the CONCURRENTLY option. This has a few caveats to be aware\nof when using this option, see the PostgreSQL documentation . Note The CONCURRENTLY option is not supported inside a transaction (see non-atomic migration ). Adding constraints without enforcing validation ¶ PostgreSQL supports the NOT VALID option with the ADD CONSTRAINT statement to add check constraints without enforcing validation on existing\nrows. This option is useful if you want to skip the potentially lengthy scan of\nthe table to verify that all existing rows satisfy the constraint. To validate check constraints created with the NOT VALID option at a later\npoint of time, use the ValidateConstraint operation. See the PostgreSQL documentation for more details. class AddConstraintNotValid ( model_name , constraint ) [source] ¶ Like AddConstraint , but avoids\nvalidating the constraint on existing rows. class ValidateConstraint ( model_name , name ) [source] ¶ Scans through the table and validates the given check constraint on\nexisting rows. Note AddConstraintNotValid and ValidateConstraint operations should be\nperformed in two separate migrations. Performing both operations in the\nsame atomic migration has the same effect as AddConstraint , whereas performing\nthem in a single non-atomic migration, may leave your database in an\ninconsistent state if the ValidateConstraint operation fails.", "keywords": ["concurrently", "rows", "production", "building", "indexes", "removeindex", "module", "check", "point", "hstoreextension", "createmodel", "false", "migration", "example", "class", "exists", "scan", "column", "migrations", "collation", "u", "database", "table", "privileges", "phone", "*", "query", "postgresql", "hstore", "subclass", "addindex", "django", "level2", "=", "trigramextension", "createcollation", "validation", "book", "operating", "btree_gist", "create", "libc", "source", "django.contrib.postgres.operations", "case", "data", "db_collation", "use", "und", "arguments", "add", "citextextension", "subclasses", "removecollation", "documentation", "cryptoextension", "file", "extensions", "constraint", "extension", "operation", "user", "btreeginextension", "operations", "addconstraint", "option", "addfield", "constraints", "validateconstraint", "superuser", "time", "writes", "provider", "statement", "principles", "hstorefield", "bloom", "icu", "connection", "-", "caveats", "scans", "valid", "import", "name", "charfield", "parameter", "statements", "locale", "collations", "index", "details", "transaction", "argument", "¶", "state", "model_name", "effect", "system", "createextension", "btreegistextension", "unaccentextension", "textfield", "filtering", "bloomextension"], "type": "documentation"},
{"title": "Migration Operations | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/migration-operations/", "content": "Migration Operations ¶ Migration files are composed of one or more Operation s, objects that\ndeclaratively record what the migration should do to your database. Django also uses these Operation objects to work out what your models\nlooked like historically, and to calculate what changes you’ve made to\nyour models since the last migration so it can automatically write\nyour migrations; that’s why they’re declarative, as it means Django can\neasily load them all into memory and run through them without touching\nthe database to work out what your project should look like. There are also more specialized Operation objects which are for things like data migrations and for advanced manual database\nmanipulation. You can also write your own Operation classes if you want\nto encapsulate a custom change you commonly make. If you need an empty migration file to write your own Operation objects\ninto, use python manage.py makemigrations --empty yourappname , but be aware\nthat manually adding schema-altering operations can confuse the migration\nautodetector and make resulting runs of makemigrations output\nincorrect code. All of the core Django operations are available from the django.db.migrations.operations module. For introductory material, see the migrations topic guide . Schema Operations ¶ CreateModel ¶ class CreateModel ( name , fields , options = None , bases = None , managers = None ) [source] ¶ Creates a new model in the project history and a corresponding table in the\ndatabase to match it. name is the model name, as would be written in the models.py file. fields is a list of 2-tuples of (field_name, field_instance) .\nThe field instance should be an unbound field (so just models.CharField(...) , rather than a field taken from another model). options is an optional dictionary of values from the model’s Meta class. bases is an optional list of other classes to have this model inherit from;\nit can contain both class objects as well as strings in the format \"appname.ModelName\" if you want to depend on another model (so you inherit\nfrom the historical version). If it’s not supplied, it defaults to inheriting\nfrom the standard models.Model . managers takes a list of 2-tuples of (manager_name, manager_instance) .\nThe first manager in the list will be the default manager for this model during\nmigrations. DeleteModel ¶ class DeleteModel ( name ) [source] ¶ Deletes the model from the project history and its table from the database. RenameModel ¶ class RenameModel ( old_name , new_name ) [source] ¶ Renames the model from an old name to a new one. You may have to manually add\nthis if you change the model’s name and quite a few of its fields at once; to\nthe autodetector, this will look like you deleted a model with the old name\nand added a new one with a different name, and the migration it creates will\nlose any data in the old table. AlterModelTable ¶ class AlterModelTable ( name , table ) [source] ¶ Changes the model’s table name (the db_table option on the Meta subclass). AlterModelTableComment ¶ class AlterModelTableComment ( name , table_comment ) [source] ¶ Changes the model’s table comment (the db_table_comment option on the Meta subclass). AlterUniqueTogether ¶ class AlterUniqueTogether ( name , unique_together ) [source] ¶ Changes the model’s set of unique constraints (the unique_together option on the Meta subclass). AlterIndexTogether ¶ class AlterIndexTogether ( name , index_together ) [source] ¶ Changes the model’s set of custom indexes (the index_together option on the Meta subclass). Warning AlterIndexTogether is officially supported only for pre-Django 4.2\nmigration files. For backward compatibility reasons, it’s still part of the\npublic API, and there’s no plan to deprecate or remove it, but it should\nnot be used for new migrations. Use AddIndex and RemoveIndex operations instead. AlterOrderWithRespectTo ¶ class AlterOrderWithRespectTo ( name , order_with_respect_to ) [source] ¶ Makes or deletes the _order column needed for the order_with_respect_to option on the Meta subclass. AlterModelOptions ¶ class AlterModelOptions ( name , options ) [source] ¶ Stores changes to miscellaneous model options (settings on a model’s Meta )\nlike permissions and verbose_name . Does not affect the database, but\npersists these changes for RunPython instances to use. options should be a dictionary mapping option names to values. AlterModelManagers ¶ class AlterModelManagers ( name , managers ) [source] ¶ Alters the managers that are available during migrations. AddField ¶ class AddField ( model_name , name , field , preserve_default = True ) [source] ¶ Adds a field to a model. model_name is the model’s name, name is\nthe field’s name, and field is an unbound Field instance (the thing\nyou would put in the field declaration in models.py - for example, models.IntegerField(null=True) . The preserve_default argument indicates whether the field’s default\nvalue is permanent and should be baked into the project state ( True ),\nor if it is temporary and just for this migration ( False ) - usually\nbecause the migration is adding a non-nullable field to a table and needs\na default value to put into existing rows. It does not affect the behavior\nof setting defaults in the database directly - Django never sets database\ndefaults and always applies them in the Django ORM code. Warning On older databases, adding a field with a default value may cause a full\nrewrite of the table. This happens even for nullable fields and may have a\nnegative performance impact. To avoid that, the following steps should be\ntaken. Add the nullable field without the default value and run the makemigrations command. This should generate a migration with\nan AddField operation. Add the default value to your field and run the makemigrations command. This should generate a migration with an AlterField operation. RemoveField ¶ class RemoveField ( model_name , name ) [source] ¶ Removes a field from a model. Bear in mind that when reversed, this is actually adding a field to a model.\nThe operation is reversible (apart from any data loss, which is irreversible)\nif the field is nullable or if it has a default value that can be used to\npopulate the recreated column. If the field is not nullable and does not have a\ndefault value, the operation is irreversible. PostgreSQL RemoveField will also delete any additional database objects that are\nrelated to the removed field (like views, for example). This is because the\nresulting DROP COLUMN statement will include the CASCADE clause to\nensure dependent objects outside the table are also dropped . AlterField ¶ class AlterField ( model_name , name , field , preserve_default = True ) [source] ¶ Alters a field’s definition, including changes to its type, null , unique , db_column and other field attributes. The preserve_default argument indicates whether the field’s default\nvalue is permanent and should be baked into the project state ( True ),\nor if it is temporary and just for this migration ( False ) - usually\nbecause the migration is altering a nullable field to a non-nullable one and\nneeds a default value to put into existing rows. It does not affect the\nbehavior of setting defaults in the database directly - Django never sets\ndatabase defaults and always applies them in the Django ORM code. Note that not all changes are possible on all databases - for example, you\ncannot change a text-type field like models.TextField() into a number-type\nfield like models.IntegerField() on most databases. RenameField ¶ class RenameField ( model_name , old_name , new_name ) [source] ¶ Changes a field’s name (and, unless db_column is set, its column name). AddIndex ¶ class AddIndex ( model_name , index ) [source] ¶ Creates an index in the database table for the model with model_name . index is an instance of the Index class. RemoveIndex ¶ class RemoveIndex ( model_name , name ) [source] ¶ Removes the index named name from the model with model_name . RenameIndex ¶ class RenameIndex ( model_name , new_name , old_name = None , old_fields = None ) [source] ¶ Renames an index in the database table for the model with model_name .\nExactly one of old_name and old_fields can be provided. old_fields is an iterable of the strings, often corresponding to fields of index_together (pre-Django 5.1 option). On databases that don’t support an index renaming statement (SQLite and MariaDB\n< 10.5.2), the operation will drop and recreate the index, which can be\nexpensive. AddConstraint ¶ class AddConstraint ( model_name , constraint ) [source] ¶ Creates a constraint in the database table for\nthe model with model_name . RemoveConstraint ¶ class RemoveConstraint ( model_name , name ) [source] ¶ Removes the constraint named name from the model with model_name . Special Operations ¶ RunSQL ¶ class RunSQL ( sql , reverse_sql = None , state_operations = None , hints = None , elidable = False ) [source] ¶ Allows running of arbitrary SQL on the database - useful for more advanced\nfeatures of database backends that Django doesn’t support directly. sql , and reverse_sql if provided, should be strings of SQL to run on\nthe database. On most database backends (all but PostgreSQL), Django will\nsplit the SQL into individual statements prior to executing them. Warning On PostgreSQL and SQLite, only use BEGIN or COMMIT in your SQL in non-atomic migrations , to avoid breaking\nDjango’s transaction state. You can also pass a list of strings or 2-tuples. The latter is used for passing\nqueries and parameters in the same way as cursor.execute() . These three operations are equivalent: migrations . RunSQL ( \"INSERT INTO musician (name) VALUES ('Reinhardt');\" ) migrations . RunSQL ([( \"INSERT INTO musician (name) VALUES ('Reinhardt');\" , None )]) migrations . RunSQL ([( \"INSERT INTO musician (name) VALUES ( %s );\" , [ \"Reinhardt\" ])]) If you want to include literal percent signs in the query, you have to double\nthem if you are passing parameters. The reverse_sql queries are executed when the migration is unapplied. They\nshould undo what is done by the sql queries. For example, to undo the above\ninsertion with a deletion: migrations . RunSQL ( sql = [( \"INSERT INTO musician (name) VALUES ( %s );\" , [ \"Reinhardt\" ])], reverse_sql = [( \"DELETE FROM musician where name= %s ;\" , [ \"Reinhardt\" ])], ) If reverse_sql is None (the default), the RunSQL operation is\nirreversible. The state_operations argument allows you to supply operations that are\nequivalent to the SQL in terms of project state. For example, if you are\nmanually creating a column, you should pass in a list containing an AddField operation here so that the autodetector still has an up-to-date state of the\nmodel. If you don’t, when you next run makemigrations , it won’t see any\noperation that adds that field and so will try to run it again. For example: migrations . RunSQL ( \"ALTER TABLE musician ADD COLUMN name varchar(255) NOT NULL;\" , state_operations = [ migrations . AddField ( \"musician\" , \"name\" , models . CharField ( max_length = 255 ), ), ], ) The optional hints argument will be passed as **hints to the allow_migrate() method of database routers to assist them in making\nrouting decisions. See Hints for more details on\ndatabase hints. The optional elidable argument determines whether or not the operation will\nbe removed (elided) when squashing migrations . RunSQL. noop ¶ Pass the RunSQL.noop attribute to sql or reverse_sql when you\nwant the operation not to do anything in the given direction. This is\nespecially useful in making the operation reversible. RunPython ¶ class RunPython ( code , reverse_code = None , atomic = None , hints = None , elidable = False ) [source] ¶ Runs custom Python code in a historical context. code (and reverse_code if supplied) should be callable objects that accept two arguments; the first is\nan instance of django.apps.registry.Apps containing historical models that\nmatch the operation’s place in the project history, and the second is an\ninstance of SchemaEditor . The reverse_code argument is called when unapplying migrations. This\ncallable should undo what is done in the code callable so that the\nmigration is reversible. If reverse_code is None (the default), the RunPython operation is irreversible. The optional hints argument will be passed as **hints to the allow_migrate() method of database routers to assist them in making a\nrouting decision. See Hints for more details on\ndatabase hints. The optional elidable argument determines whether or not the operation will\nbe removed (elided) when squashing migrations . You are advised to write the code as a separate function above the Migration class in the migration file, and pass it to RunPython . Here’s an example of\nusing RunPython to create some initial objects on a Country model: from django.db import migrations def forwards_func ( apps , schema_editor ): # We get the model from the versioned app registry; # if we directly import it, it'll be the wrong version Country = apps . get_model ( \"myapp\" , \"Country\" ) db_alias = schema_editor . connection . alias Country . objects . using ( db_alias ) . bulk_create ( [ Country ( name = \"USA\" , code = \"us\" ), Country ( name = \"France\" , code = \"fr\" ), ] ) def reverse_func ( apps , schema_editor ): # forwards_func() creates two Country instances, # so reverse_func() should delete them. Country = apps . get_model ( \"myapp\" , \"Country\" ) db_alias = schema_editor . connection . alias Country . objects . using ( db_alias ) . filter ( name = \"USA\" , code = \"us\" ) . delete () Country . objects . using ( db_alias ) . filter ( name = \"France\" , code = \"fr\" ) . delete () class Migration ( migrations . Migration ): dependencies = [] operations = [ migrations . RunPython ( forwards_func , reverse_func ), ] This is generally the operation you would use to create data migrations , run\ncustom data updates and alterations, and anything else you need access to an\nORM and/or Python code for. Much like RunSQL , ensure that if you change schema inside here you’re\neither doing it outside the scope of the Django model system (e.g. triggers)\nor that you use SeparateDatabaseAndState to add in operations that will\nreflect your changes to the model state - otherwise, the versioned ORM and\nthe autodetector will stop working correctly. By default, RunPython will run its contents inside a transaction on\ndatabases that do not support DDL transactions (for example, MySQL and\nOracle). This should be safe, but may cause a crash if you attempt to use\nthe schema_editor provided on these backends; in this case, pass atomic=False to the RunPython operation. On databases that do support DDL transactions (SQLite and PostgreSQL), RunPython operations do not have any transactions automatically added\nbesides the transactions created for each migration. Thus, on PostgreSQL, for\nexample, you should avoid combining schema changes and RunPython operations\nin the same migration or you may hit errors like OperationalError: cannot ALTER TABLE \"mytable\" because it has pending trigger events . If you have a different database and aren’t sure if it supports DDL\ntransactions, check the django.db.connection.features.can_rollback_ddl attribute. If the RunPython operation is part of a non-atomic migration , the operation will only be executed in a transaction\nif atomic=True is passed to the RunPython operation. Warning RunPython does not magically alter the connection of the models for you;\nany model methods you call will go to the default database unless you\ngive them the current database alias (available from schema_editor.connection.alias , where schema_editor is the second\nargument to your function). static RunPython. noop () [source] ¶ Pass the RunPython.noop method to code or reverse_code when\nyou want the operation not to do anything in the given direction. This is\nespecially useful in making the operation reversible. SeparateDatabaseAndState ¶ class SeparateDatabaseAndState ( database_operations = None , state_operations = None ) [source] ¶ A highly specialized operation that lets you mix and match the database\n(schema-changing) and state (autodetector-powering) aspects of operations. It accepts two lists of operations. When asked to apply state, it will use the state_operations list (this is a generalized version of RunSQL ’s state_operations argument). When asked to apply changes to the database, it\nwill use the database_operations list. If the actual state of the database and Django’s view of the state get out of\nsync, this can break the migration framework, even leading to data loss. It’s\nworth exercising caution and checking your database and state operations\ncarefully. You can use sqlmigrate and dbshell to check\nyour database operations. You can use makemigrations , especially\nwith --dry-run , to check your state\noperations. For an example using SeparateDatabaseAndState , see Changing a ManyToManyField to use a through model . Operation category ¶ New in Django 5.1. class OperationCategory [source] ¶ Categories of migration operation used by the makemigrations command to display meaningful symbols. ADDITION ¶ Symbol : + REMOVAL ¶ Symbol : - ALTERATION ¶ Symbol : ~ PYTHON ¶ Symbol : p SQL ¶ Symbol : s MIXED ¶ Symbol : ? Writing your own ¶ Operations have a relatively simple API, and they’re designed so that you can\neasily write your own to supplement the built-in Django ones. The basic\nstructure of an Operation looks like this: from django.db.migrations.operations.base import Operation class MyCustomOperation ( Operation ): # If this is False, it means that this operation will be ignored by # sqlmigrate; if true, it will be run and the SQL collected for its output. reduces_to_sql = False # If this is False, Django will refuse to reverse past this operation. reversible = False # This categorizes the operation. The corresponding symbol will be # displayed by the makemigrations command. category = OperationCategory . ADDITION def __init__ ( self , arg1 , arg2 ): # Operations are usually instantiated with arguments in migration # files. Store the values of them on self for later use. pass def state_forwards ( self , app_label , state ): # The Operation should take the 'state' parameter (an instance of # django.db.migrations.state.ProjectState) and mutate it to match # any schema changes that have occurred. pass def database_forwards ( self , app_label , schema_editor , from_state , to_state ): # The Operation should use schema_editor to apply any changes it # wants to make to the database. pass def database_backwards ( self , app_label , schema_editor , from_state , to_state ): # If reversible is True, this is called when the operation is reversed. pass def describe ( self ): # This is used to describe what the operation does. return \"Custom Operation\" @property def migration_name_fragment ( self ): # Optional. A filename part suitable for automatically naming a # migration containing this operation, or None if not applicable. return \"custom_operation_ %s _ %s \" % ( self . arg1 , self . arg2 ) You can take this template and work from it, though we suggest looking at the\nbuilt-in Django operations in django.db.migrations.operations - they cover\na lot of the example usage of semi-internal aspects of the migration framework\nlike ProjectState and the patterns used to get historical models, as well\nas ModelState and the patterns used to mutate historical models in state_forwards() . Some things to note: You don’t need to learn too much about ProjectState to write migrations;\njust know that it has an apps property that gives access to an app\nregistry (which you can then call get_model on). database_forwards and database_backwards both get two states passed\nto them; these represent the difference the state_forwards method would\nhave applied, but are given to you for convenience and speed reasons. If you want to work with model classes or model instances from the from_state argument in database_forwards() or database_backwards() , you must render model states using the clear_delayed_apps_cache() method to make related models available: def database_forwards ( self , app_label , schema_editor , from_state , to_state ): # This operation should have access to all models. Ensure that all models are # reloaded in case any are delayed. from_state . clear_delayed_apps_cache () ... to_state in the database_backwards method is the older state; that is,\nthe one that will be the current state once the migration has finished reversing. You might see implementations of references_model on the built-in\noperations; this is part of the autodetection code and does not matter for\ncustom operations. Warning For performance reasons, the Field instances in ModelState.fields are reused across migrations. You must never change\nthe attributes on these instances. If you need to mutate a field in state_forwards() , you must remove the old instance from ModelState.fields and add a new instance in its place. The same is true\nfor the Manager instances in ModelState.managers . As an example, let’s make an operation that loads PostgreSQL extensions (which\ncontain some of PostgreSQL’s more exciting features). Since there’s no model\nstate changes, all it does is run one command: from django.db.migrations.operations.base import Operation class LoadExtension ( Operation ): reversible = True def __init__ ( self , name ): self . name = name def state_forwards ( self , app_label , state ): pass def database_forwards ( self , app_label , schema_editor , from_state , to_state ): schema_editor . execute ( \"CREATE EXTENSION IF NOT EXISTS %s \" % self . name ) def database_backwards ( self , app_label , schema_editor , from_state , to_state ): schema_editor . execute ( \"DROP EXTENSION %s \" % self . name ) def describe ( self ): return \"Creates extension %s \" % self . name @property def migration_name_fragment ( self ): return \"create_extension_ %s \" % self . name", "keywords": ["rows", "allow_migrate", "integerfield", "removeindex", "usa", "runsql.noop", "alterorderwithrespectto", "field", "allows", "#", "django.db.migrations.state", "migrations", "django.apps.registry", "stores", "ddl", "compatibility", "get_model", "django.db.migrations.operations", "state_operations", "change", "altermodeloptions", "changes", "=", "schema_editor.connection.alias", "sqlmigrate", "categories", "cursor.execute", "symbol", "rewrite", "topic", "alterindextogether", "symbols", "type", "custom", "objects", "loadextension", "mind", "file", "constraint", "separatedatabaseandstate", "bulk_create", "state_forwards", "latter", "addconstraint", "attribute", "states", "addfield", "warning", "constraints", "inherit", "date", "database_forwards", "autodetection", "crash", "things", "name", "signs", "makemigrations", "special", "parameter", "impact", "backends", "queries", "manager", "return", "deletion", "memory", "order_with_respect_to", "textfield", "category", "references_model", "pre", "removefield", "plan", "module", "code", "triggers", "createmodel", "filter", "false", "behavior", "access", "migration", "class", "clause", "modelstate.fields", "forwards_func", "names", "altermodelmanagers", "schema_editor", "database", "output", "*", "query", "postgresql", "describe", "strings", "subclass", "decisions", "insert", "direction", "usage", "registry", "max_length", "create", "source", "into", "use", "dbshell", "manipulation", "performance", "create_extension", "core", "extensions", "preserve_default", "index_together", "operation", "order", "aspects", "default", "alias", "comment", "option", "format", "classes", "percent", "django.db.connection.features.can_rollback_ddl", "alteruniquetogether", "convenience", "material", "routing", "template", "schema", "way", "renamefield", "removeconstraint", "bear", "fr", "index", "manager_name", "¶", "command", "parameters", "modelstate", "property", "function", "implementations", "views", "@property", "view", "run", "indexes", "number", "lot", "permissions", "def", "values", "old_fields", "old_name", "_", "france", "mapping", "thing", "databases", "reduces_to_sql", "verbose_name", "managers", "table", "alteration", "models", "history", "version", "contents", "clear_delayed_apps_cache", "drop", "addindex", "django", "myapp", "n’t", "fields", "set", "reverse_code", "value", "events", "sync", "database_operations", "musician", "data", "scope", "modelname", "guide", "arg1", "database_backwards", "insertion", "renameindex", "runsql", "add", "declaration", "iterable", "updates", "varchar(255", "self", "instance", "schemaeditor", "speed", "extension", "alter", "mytable", "noop", "instances", "structure", "statement", "part", "begin", "charfield", "manytomanyfield", "renames", "operationalerror", "dictionary", "sql", "hints", "terms", "new_name", "s", "alterfield", "autodetector", "runpython", "system", "apps", "alterations", "dependencies", "runpython.noop", "field_instance", "reverse_sql", "mixed", "removal", "definition", "difference", "features", "addition", "lists", "deletemodel", "example", "db_alias", "app", "country", "column", "renamemodel", "list", "loss", "orm", "projectstate", "steps", "reverse_func", "alters", "model", "reasons", "place", "callable", "attributes", "altermodeltablecomment", "bases", "ones", "case", "null", "errors", "arguments", "static", "init", "one", "removes", "sqlite", "tuples", "delete", "decision", "operations", "django.db.migrations.operations.base", "none", "meta", "patterns", "framework", "new", "from_state", "table_comment", "manager_instance", "api", "arg2", "modelstate.managers", "db_column", "transactions", "-", "connection", "field_name", "context", "runs", "files", "cascade", "import", "statements", "%", "defaults", "python", "yourappname", "methods", "trigger", "caution", "options", "optional", "details", "method", "django.db", "settings", "transaction", "argument", "operationcategory", "state", "model_name", "oracle", "to_state", "text", "project"], "type": "documentation"},
{"title": "The messages framework | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/messages/", "content": "The messages framework ¶ Quite commonly in web applications, you need to display a one-time\nnotification message (also known as “flash message”) to the user after\nprocessing a form or some other types of user input. For this, Django provides full support for cookie- and session-based\nmessaging, for both anonymous and authenticated users. The messages framework\nallows you to temporarily store messages in one request and retrieve them for\ndisplay in a subsequent request (usually the next one). Every message is\ntagged with a specific level that determines its priority (e.g., info , warning , or error ). Enabling messages ¶ Messages are implemented through a middleware class and corresponding context processor . The default settings.py created by django-admin startproject already contains all the settings required to enable message functionality: 'django.contrib.messages' is in INSTALLED_APPS . MIDDLEWARE contains 'django.contrib.sessions.middleware.SessionMiddleware' and 'django.contrib.messages.middleware.MessageMiddleware' . The default storage backend relies on sessions . That’s why SessionMiddleware must be enabled and appear before MessageMiddleware in MIDDLEWARE . The 'context_processors' option of the DjangoTemplates backend\ndefined in your TEMPLATES setting contains 'django.contrib.messages.context_processors.messages' . If you don’t want to use messages, you can remove 'django.contrib.messages' from your INSTALLED_APPS , the MessageMiddleware line from MIDDLEWARE , and the messages context processor from TEMPLATES . Configuring the message engine ¶ Storage backends ¶ The messages framework can use different backends to store temporary messages. Django provides three built-in storage classes in django.contrib.messages : class storage.session. SessionStorage ¶ This class stores all messages inside of the request’s session. Therefore\nit requires Django’s contrib.sessions application. class storage.cookie. CookieStorage ¶ This class stores the message data in a cookie (signed with a secret hash\nto prevent manipulation) to persist notifications across requests. Old\nmessages are dropped if the cookie data size would exceed 2048 bytes. class storage.fallback. FallbackStorage ¶ This class first uses CookieStorage , and falls back to using SessionStorage for the messages that could not fit in a single cookie.\nIt also requires Django’s contrib.sessions application. This behavior avoids writing to the session whenever possible. It should\nprovide the best performance in the general case. FallbackStorage is the\ndefault storage class. If it isn’t suitable to your needs, you can select\nanother storage class by setting MESSAGE_STORAGE to its full import\npath, for example: MESSAGE_STORAGE = \"django.contrib.messages.storage.cookie.CookieStorage\" class storage.base. BaseStorage ¶ To write your own storage class, subclass the BaseStorage class in django.contrib.messages.storage.base and implement the _get and _store methods. Message levels ¶ The messages framework is based on a configurable level architecture similar\nto that of the Python logging module. Message levels allow you to group\nmessages by type so they can be filtered or displayed differently in views and\ntemplates. The built-in levels, which can be imported from django.contrib.messages directly, are: Constant Purpose DEBUG Development-related messages that will be ignored (or removed) in a production deployment INFO Informational messages for the user SUCCESS An action was successful, e.g. “Your profile was updated successfully” WARNING A failure did not occur but may be imminent ERROR An action was not successful or some other failure occurred The MESSAGE_LEVEL setting can be used to change the minimum recorded level\n(or it can be changed per request ). Attempts to add messages of a level less\nthan this will be ignored. Message tags ¶ Message tags are a string representation of the message level plus any\nextra tags that were added directly in the view (see Adding extra message tags below for more details). Tags are stored in a\nstring and are separated by spaces. Typically, message tags\nare used as CSS classes to customize message style based on message type. By\ndefault, each level has a single tag that’s a lowercase version of its own\nconstant: Level Constant Tag DEBUG debug INFO info SUCCESS success WARNING warning ERROR error To change the default tags for a message level (either built-in or custom),\nset the MESSAGE_TAGS setting to a dictionary containing the levels\nyou wish to change. As this extends the default tags, you only need to provide\ntags for the levels you wish to override: from django.contrib.messages import constants as messages MESSAGE_TAGS = { messages . INFO : \"\" , 50 : \"critical\" , } Using messages in views and templates ¶ add_message ( request , level , message , extra_tags = '' , fail_silently = False ) [source] ¶ Adding a message ¶ To add a message, call: from django.contrib import messages messages . add_message ( request , messages . INFO , \"Hello world.\" ) Some shortcut methods provide a standard way to add messages with commonly\nused tags (which are usually represented as HTML classes for the message): messages . debug ( request , \" %s SQL statements were executed.\" % count ) messages . info ( request , \"Three credits remain in your account.\" ) messages . success ( request , \"Profile details updated.\" ) messages . warning ( request , \"Your account expires in three days.\" ) messages . error ( request , \"Document deleted.\" ) Displaying messages ¶ get_messages ( request ) [source] ¶ In your template , use something like: {% if messages %} < ul class = \"messages\" > {% for message in messages %} < li {% if message.tags %} class = \" {{ message.tags }} \" {% endif %} > {{ message }} </ li > {% endfor %} </ ul > {% endif %} If you’re using the context processor, your template should be rendered with a RequestContext . Otherwise, ensure messages is available to\nthe template context. Even if you know there is only one message, you should still iterate over the messages sequence, because otherwise the message storage will not be\ncleared for the next request. The context processor also provides a DEFAULT_MESSAGE_LEVELS variable which\nis a mapping of the message level names to their numeric value: {% if messages %} < ul class = \"messages\" > {% for message in messages %} < li {% if message.tags %} class = \" {{ message.tags }} \" {% endif %} > {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %} Important: {% endif %} {{ message }} </ li > {% endfor %} </ ul > {% endif %} Outside of templates , you can use get_messages() : from django.contrib.messages import get_messages storage = get_messages ( request ) for message in storage : do_something_with_the_message ( message ) For instance, you can fetch all the messages to return them in a JSONResponseMixin instead of a TemplateResponseMixin . get_messages() will return an\ninstance of the configured storage backend. The Message class ¶ class Message [source] ¶ When you loop over the list of messages in a template, what you get are\ninstances of the Message class. They have only a few attributes: message : The actual text of the message. level : An integer describing the type of the message (see the message levels section above). tags : A string combining all the message’s tags ( extra_tags and level_tag ) separated by spaces. extra_tags : A string containing custom tags for this message,\nseparated by spaces. It’s empty by default. level_tag : The string representation of the level. By default, it’s\nthe lowercase version of the name of the associated constant, but this\ncan be changed if you need by using the MESSAGE_TAGS setting. Creating custom message levels ¶ Messages levels are nothing more than integers, so you can define your own\nlevel constants and use them to create more customized user feedback, e.g.: CRITICAL = 50 def my_view ( request ): messages . add_message ( request , CRITICAL , \"A serious error occurred.\" ) When creating custom message levels you should be careful to avoid overloading\nexisting levels. The values for the built-in levels are: Level Constant Value DEBUG 10 INFO 20 SUCCESS 25 WARNING 30 ERROR 40 If you need to identify the custom levels in your HTML or CSS, you need to\nprovide a mapping via the MESSAGE_TAGS setting. Note If you are creating a reusable application, it is recommended to use\nonly the built-in message levels and not rely on any custom levels. Changing the minimum recorded level per-request ¶ The minimum recorded level can be set per request via the set_level method: from django.contrib import messages # Change the messages level to ensure the debug message is added. messages . set_level ( request , messages . DEBUG ) messages . debug ( request , \"Test message...\" ) # In another request, record only messages with a level of WARNING and higher messages . set_level ( request , messages . WARNING ) messages . success ( request , \"Your profile was updated.\" ) # ignored messages . warning ( request , \"Your account is about to expire.\" ) # recorded # Set the messages level back to default. messages . set_level ( request , None ) Similarly, the current effective level can be retrieved with get_level : from django.contrib import messages current_level = messages . get_level ( request ) For more information on how the minimum recorded level functions, see Message levels above. Adding extra message tags ¶ For more direct control over message tags, you can optionally provide a string\ncontaining extra tags to any of the add methods: messages . add_message ( request , messages . INFO , \"Over 9000!\" , extra_tags = \"dragonball\" ) messages . error ( request , \"Email box full\" , extra_tags = \"email\" ) Extra tags are added before the default tag for that level and are space\nseparated. Failing silently when the message framework is disabled ¶ If you’re writing a reusable app (or other piece of code) and want to include\nmessaging functionality, but don’t want to require your users to enable it\nif they don’t want to, you may pass an additional keyword argument fail_silently=True to any of the add_message family of methods. For\nexample: messages . add_message ( request , messages . SUCCESS , \"Profile details updated.\" , fail_silently = True , ) messages . info ( request , \"Hello world.\" , fail_silently = True ) Note Setting fail_silently=True only hides the MessageFailure that would\notherwise occur when the messages framework disabled and one attempts to\nuse one of the add_message family of methods. It does not hide failures\nthat may occur for other reasons. Adding messages in class-based views ¶ class views. SuccessMessageMixin ¶ Adds a success message attribute to FormView based classes get_success_message ( cleaned_data ) ¶ cleaned_data is the cleaned data from the form which is used for\nstring formatting Example views.py : from django.contrib.messages.views import SuccessMessageMixin from django.views.generic.edit import CreateView from myapp.models import Author class AuthorCreateView ( SuccessMessageMixin , CreateView ): model = Author success_url = \"/success/\" success_message = \" %(name)s was created successfully\" The cleaned data from the form is available for string interpolation using\nthe %(field_name)s syntax. For ModelForms, if you need access to fields\nfrom the saved object override the get_success_message() method. Example views.py for ModelForms : from django.contrib.messages.views import SuccessMessageMixin from django.views.generic.edit import CreateView from myapp.models import ComplicatedModel class ComplicatedCreateView ( SuccessMessageMixin , CreateView ): model = ComplicatedModel success_url = \"/success/\" success_message = \" %(calculated_field)s was created successfully\" def get_success_message ( self , cleaned_data ): return self . success_message % dict ( cleaned_data , calculated_field = self . object . calculated_field , ) Expiration of messages ¶ The messages are marked to be cleared when the storage instance is iterated\n(and cleared when the response is processed). To avoid the messages being cleared, you can set the messages storage to False after iterating: storage = messages . get_messages ( request ) for message in storage : do_something_with ( message ) storage . used = False Behavior of parallel requests ¶ Due to the way cookies (and hence sessions) work, the behavior of any\nbackends that make use of cookies or sessions is undefined when the same\nclient makes multiple requests that set or get messages in parallel . For\nexample, if a client initiates a request that creates a message in one window\n(or tab) and then another that fetches any uniterated messages in another\nwindow, before the first window redirects, the message may appear in the\nsecond window instead of the first window where it may be expected. In short, when multiple simultaneous requests from the same client are\ninvolved, messages are not guaranteed to be delivered to the same window that\ncreated them nor, in some cases, at all. Note that this is typically not a\nproblem in most applications and will become a non-issue in HTML5, where each\nwindow/tab will have its own browsing context. Settings ¶ A few settings give you control over message\nbehavior: MESSAGE_LEVEL MESSAGE_STORAGE MESSAGE_TAGS For backends that use cookies, the settings for the cookie are taken from\nthe session cookie settings: SESSION_COOKIE_DOMAIN SESSION_COOKIE_SECURE SESSION_COOKIE_HTTPONLY Testing ¶ New in Django 5.0. This module offers a tailored test assertion method, for testing messages\nattached to an HttpResponse . To benefit from this assertion, add MessagesTestMixin to the class\nhierarchy: from django.contrib.messages.test import MessagesTestMixin from django.test import TestCase class MsgTestCase ( MessagesTestMixin , TestCase ): pass Then, inherit from the MsgTestCase in your tests. MessagesTestMixin. assertMessages ( response , expected_messages , ordered = True ) [source] ¶ Asserts that messages added to the response matches expected_messages . expected_messages is a list of Message objects. By default, the comparison is ordering dependent. You can disable this by\nsetting the ordered argument to False .", "keywords": ["users", "storage.base", "views", "failure", "testing", "box", "msgtestcase", "view", "store", "sessionmiddleware", "production", "control", "storage", "message.tags", "messagefailure", "space", "expected_messages", "messages", "error", "module", "code", "html5", "important", "values", "failures", "architecture", "message_tags", "django.contrib.messages.context_processors.messages", "django.contrib", "info", "behavior", "string", "style", "display", "class", "example", "_", "#", "app", "access", "calculated_field", "window", "parallel", "mapping", "list", "informational", "names", "request", "do_something_with_the_message", "stores", "input", "action", "representation", "email", "test", "family", "httpresponse", "version", "count", "level", "types", "storage.fallback", "variable", "needs", "model", "extra_tags", "processor", "/success/", "get_level", "field_name)s", "reasons", "application", "complicatedcreateview", "django.contrib.messages.views", "attributes", "default_message_levels", "django", "name)s", "session_cookie_httponly", "hash", "testcase", "=", "profile", "redirects", "fields", "django.contrib.messages", "engine", "writing", "message", "development", "lowercase", "context_processors", "tab", "notifications", "messagestestmixin", "syntax", "critical", "successmessagemixin", "cookie-", "value", "modelforms", "tag", "section", "jsonresponsemixin", "formview", "message.level", "assertion", "line", "cleaned_data", "source", "case", "sequence", "hierarchy", "data", "debug", "messaging", "css", "messagemiddleware", "use", "backend", "html", "fallbackstorage", "basestorage", "session_cookie_domain", "manipulation", "add", "type", "author", "cookiestorage", "django.contrib.sessions.middleware", "middleware", "ul", "self", "performance", "custom", "instance", "calculated_field)s", "objects", "complicatedmodel", "djangotemplates", "pass", "startproject", "django.views.generic.edit", "flash", "comparison", "levels", "work", "constants", "default", "user", "constant", "li", "path", "cases", "functionality", "functions", "do_something_with", "success", "form", "credits", "feedback", "my_view", "none", "option", "attribute", "classes", "problem", "tests", "warning", "size", "set_level", "get", "time", "inherit", "tags", "authorcreateview", "expiration", "framework", "storage.cookie", "assertmessages", "storage.session", "instances", "setting", "new", "add_message", "message_storage", "account", "templateresponsemixin", "get_success_message", "installed_apps", "sessions", "support", "myapp.models", "false", "cookies", "priority", "object", "document", "-", "deployment", "sessionstorage", "context", "import", "name", "success_url", "template", "response", "django.contrib.messages.storage.base", "statements", "django.contrib.messages.storage.cookie", "%", "dictionary", "sql", "world", "requests", "way", "attempts", "backends", "get_messages", "endfor", "web", "python", "in", "level_tag", "information", "createview", "issue", "requestcontext", "methods", "interpolation", "current_level", "notification", "purpose", "client", "details", "method", "success_message", "integer", "session", "settings", "argument", "days", "¶", "bytes", "piece", "return", "cookie", "applications", "spaces", "integers", "templates", "text", "dragonball", "contrib.sessions"], "type": "documentation"},
{"title": "The Forms API | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/forms/api/", "content": "The Forms API ¶ About this document This document covers the gritty details of Django’s forms API. You should\nread the introduction to working with forms first. Bound and unbound forms ¶ A Form instance is either bound to a set of data, or unbound . If it’s bound to a set of data, it’s capable of validating that data\nand rendering the form as HTML with the data displayed in the HTML. If it’s unbound , it cannot do validation (because there’s no data to\nvalidate!), but it can still render the blank form as HTML. class Form [source] ¶ To create an unbound Form instance, instantiate the class: >>> f = ContactForm () To bind data to a form, pass the data as a dictionary as the first parameter to\nyour Form class constructor: >>> data = { ... \"subject\" : \"hello\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"foo@example.com\" , ... \"cc_myself\" : True , ... } >>> f = ContactForm ( data ) In this dictionary, the keys are the field names, which correspond to the\nattributes in your Form class. The values are the data you’re trying to\nvalidate. These will usually be strings, but there’s no requirement that they be\nstrings; the type of data you pass depends on the Field , as we’ll see\nin a moment. Form. is_bound ¶ If you need to distinguish between bound and unbound form instances at runtime,\ncheck the value of the form’s is_bound attribute: >>> f = ContactForm () >>> f . is_bound False >>> f = ContactForm ({ \"subject\" : \"hello\" }) >>> f . is_bound True Note that passing an empty dictionary creates a bound form with empty data: >>> f = ContactForm ({}) >>> f . is_bound True If you have a bound Form instance and want to change the data somehow,\nor if you want to bind an unbound Form instance to some data, create\nanother Form instance. There is no way to change data in a Form instance. Once a Form instance has been created, you\nshould consider its data immutable, whether it has data or not. Using forms to validate data ¶ Form. clean () ¶ Implement a clean() method on your Form when you must add custom\nvalidation for fields that are interdependent. See Cleaning and validating fields that depend on each other for example usage. Form. is_valid () ¶ The primary task of a Form object is to validate data. With a bound Form instance, call the is_valid() method to run validation\nand return a boolean designating whether the data was valid: >>> data = { ... \"subject\" : \"hello\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"foo@example.com\" , ... \"cc_myself\" : True , ... } >>> f = ContactForm ( data ) >>> f . is_valid () True Let’s try with some invalid data. In this case, subject is blank (an error,\nbecause all fields are required by default) and sender is not a valid\nemail address: >>> data = { ... \"subject\" : \"\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"invalid email address\" , ... \"cc_myself\" : True , ... } >>> f = ContactForm ( data ) >>> f . is_valid () False Form. errors ¶ Access the errors attribute to get a dictionary of error\nmessages: >>> f . errors {'sender': ['Enter a valid email address.'], 'subject': ['This field is required.']} In this dictionary, the keys are the field names, and the values are lists of\nstrings representing the error messages. The error messages are stored\nin lists because a field can have multiple error messages. You can access errors without having to call is_valid() first. The form’s data will be validated the first time\neither you call is_valid() or access errors . The validation routines will only get called once, regardless of how many times\nyou access errors or call is_valid() . This means that\nif validation has side effects, those side effects will only be triggered once. Form.errors. as_data () ¶ Returns a dict that maps fields to their original ValidationError instances. >>> f . errors . as_data () {'sender': [ValidationError(['Enter a valid email address.'])], 'subject': [ValidationError(['This field is required.'])]} Use this method anytime you need to identify an error by its code . This\nenables things like rewriting the error’s message or writing custom logic in a\nview when a given error is present. It can also be used to serialize the errors\nin a custom format (e.g. XML); for instance, as_json() relies on as_data() . The need for the as_data() method is due to backwards compatibility.\nPreviously ValidationError instances were lost as soon as their rendered error messages were added to the Form.errors dictionary.\nIdeally Form.errors would have stored ValidationError instances\nand methods with an as_ prefix could render them, but it had to be done\nthe other way around in order not to break code that expects rendered error\nmessages in Form.errors . Form.errors. as_json ( escape_html = False ) ¶ Returns the errors serialized as JSON. >>> f . errors . as_json () {\"sender\": [{\"message\": \"Enter a valid email address.\", \"code\": \"invalid\"}], \"subject\": [{\"message\": \"This field is required.\", \"code\": \"required\"}]} By default, as_json() does not escape its output. If you are using it for\nsomething like AJAX requests to a form view where the client interprets the\nresponse and inserts errors into the page, you’ll want to be sure to escape the\nresults on the client-side to avoid the possibility of a cross-site scripting\nattack. You can do this in JavaScript with element.textContent = errorText or with jQuery’s $(el).text(errorText) (rather than its .html() function). If for some reason you don’t want to use client-side escaping, you can also\nset escape_html=True and error messages will be escaped so you can use them\ndirectly in HTML. Form.errors. get_json_data ( escape_html = False ) ¶ Returns the errors as a dictionary suitable for serializing to JSON. Form.errors.as_json() returns serialized JSON, while this returns the\nerror data before it’s serialized. The escape_html parameter behaves as described in Form.errors.as_json() . Form. add_error ( field , error ) ¶ This method allows adding errors to specific fields from within the Form.clean() method, or from outside the form altogether; for instance\nfrom a view. The field argument is the name of the field to which the errors\nshould be added. If its value is None the error will be treated as\na non-field error as returned by Form.non_field_errors() . The error argument can be a string, or preferably an instance of ValidationError . See Raising ValidationError for best practices\nwhen defining form errors. Note that Form.add_error() automatically removes the relevant field from cleaned_data . Form. has_error ( field , code = None ) ¶ This method returns a boolean designating whether a field has an error with\na specific error code . If code is None , it will return True if the field contains any errors at all. To check for non-field errors use NON_FIELD_ERRORS as the field parameter. Form. non_field_errors () ¶ This method returns the list of errors from Form.errors that aren’t associated with a particular field.\nThis includes ValidationError s that are raised in Form.clean() and errors added using Form.add_error(None, \"...\") . Behavior of unbound forms ¶ It’s meaningless to validate a form with no data, but, for the record, here’s\nwhat happens with unbound forms: >>> f = ContactForm () >>> f . is_valid () False >>> f . errors {} Initial form values ¶ Form. initial ¶ Use initial to declare the initial value of form fields at\nruntime. For example, you might want to fill in a username field with the\nusername of the current session. To accomplish this, use the initial argument to a Form .\nThis argument, if given, should be a dictionary mapping field names to initial\nvalues. Only include the fields for which you’re specifying an initial value;\nit’s not necessary to include every field in your form. For example: >>> f = ContactForm ( initial = { \"subject\" : \"Hi there!\" }) These values are only displayed for unbound forms, and they’re not used as\nfallback values if a particular value isn’t provided. If a Field defines initial and you\ninclude initial when instantiating the Form , then the latter initial will have precedence. In this example, initial is provided both\nat the field level and at the form instance level, and the latter gets\nprecedence: >>> from django import forms >>> class CommentForm ( forms . Form ): ... name = forms . CharField ( initial = \"class\" ) ... url = forms . URLField () ... comment = forms . CharField () ... >>> f = CommentForm ( initial = { \"name\" : \"instance\" }, auto_id = False ) >>> print ( f ) <div>Name:<input type=\"text\" name=\"name\" value=\"instance\" required></div> <div>Url:<input type=\"url\" name=\"url\" required></div> <div>Comment:<input type=\"text\" name=\"comment\" required></div> Form. get_initial_for_field ( field , field_name ) ¶ Returns the initial data for a form field. It retrieves the data from Form.initial if present, otherwise trying Field.initial .\nCallable values are evaluated. It is recommended to use BoundField.initial over get_initial_for_field() because BoundField.initial has a\nsimpler interface. Also, unlike get_initial_for_field() , BoundField.initial caches its values. This is useful especially when\ndealing with callables whose return values can change (e.g. datetime.now or uuid.uuid4 ): >>> import uuid >>> class UUIDCommentForm ( CommentForm ): ... identifier = forms . UUIDField ( initial = uuid . uuid4 ) ... >>> f = UUIDCommentForm () >>> f . get_initial_for_field ( f . fields [ \"identifier\" ], \"identifier\" ) UUID('972ca9e4-7bfe-4f5b-af7d-07b3aa306334') >>> f . get_initial_for_field ( f . fields [ \"identifier\" ], \"identifier\" ) UUID('1b411fab-844e-4dec-bd4f-e9b0495f04d0') >>> # Using BoundField.initial, for comparison >>> f [ \"identifier\" ] . initial UUID('28a09c59-5f00-4ed9-9179-a3b074fa9c30') >>> f [ \"identifier\" ] . initial UUID('28a09c59-5f00-4ed9-9179-a3b074fa9c30') Checking which form data has changed ¶ Form. has_changed () ¶ Use the has_changed() method on your Form when you need to check if the\nform data has been changed from the initial data. >>> data = { ... \"subject\" : \"hello\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"foo@example.com\" , ... \"cc_myself\" : True , ... } >>> f = ContactForm ( data , initial = data ) >>> f . has_changed () False When the form is submitted, we reconstruct it and provide the original data\nso that the comparison can be done: >>> f = ContactForm ( request . POST , initial = data ) >>> f . has_changed () has_changed() will be True if the data from request.POST differs\nfrom what was provided in initial or False otherwise. The\nresult is computed by calling Field.has_changed() for each field in the\nform. Form. changed_data ¶ The changed_data attribute returns a list of the names of the fields whose\nvalues in the form’s bound data (usually request.POST ) differ from what was\nprovided in initial . It returns an empty list if no data differs. >>> f = ContactForm ( request . POST , initial = data ) >>> if f . has_changed (): ... print ( \"The following fields changed: %s \" % \", \" . join ( f . changed_data )) ... >>> f . changed_data ['subject', 'message'] Accessing the fields from the form ¶ Form. fields ¶ You can access the fields of Form instance from its fields attribute: >>> for row in f . fields . values (): ... print ( row ) ... <django.forms.fields.CharField object at 0x7ffaac632510> <django.forms.fields.URLField object at 0x7ffaac632f90> <django.forms.fields.CharField object at 0x7ffaac3aa050> >>> f . fields [ \"name\" ] <django.forms.fields.CharField object at 0x7ffaac6324d0> You can alter the field and BoundField of Form instance to\nchange the way it is presented in the form: >>> f . as_div () . split ( \"</div>\" )[ 0 ] '<div><label for=\"id_subject\">Subject:</label><input type=\"text\" name=\"subject\" maxlength=\"100\" required id=\"id_subject\">' >>> f [ \"subject\" ] . label = \"Topic\" >>> f . as_div () . split ( \"</div>\" )[ 0 ] '<div><label for=\"id_subject\">Topic:</label><input type=\"text\" name=\"subject\" maxlength=\"100\" required id=\"id_subject\">' Beware not to alter the base_fields attribute because this modification\nwill influence all subsequent ContactForm instances within the same Python\nprocess: >>> f . base_fields [ \"subject\" ] . label_suffix = \"?\" >>> another_f = ContactForm ( auto_id = False ) >>> another_f . as_div () . split ( \"</div>\" )[ 0 ] '<div><label for=\"id_subject\">Subject?</label><input type=\"text\" name=\"subject\" maxlength=\"100\" required id=\"id_subject\">' Accessing “clean” data ¶ Form. cleaned_data ¶ Each field in a Form class is responsible not only for validating\ndata, but also for “cleaning” it – normalizing it to a consistent format. This\nis a nice feature, because it allows data for a particular field to be input in\na variety of ways, always resulting in consistent output. For example, DateField normalizes input into a\nPython datetime.date object. Regardless of whether you pass it a string in\nthe format '1994-07-15' , a datetime.date object, or a number of other\nformats, DateField will always normalize it to a datetime.date object\nas long as it’s valid. Once you’ve created a Form instance with a set of data and validated\nit, you can access the clean data via its cleaned_data attribute: >>> data = { ... \"subject\" : \"hello\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"foo@example.com\" , ... \"cc_myself\" : True , ... } >>> f = ContactForm ( data ) >>> f . is_valid () True >>> f . cleaned_data {'cc_myself': True, 'message': 'Hi there', 'sender': 'foo@example.com', 'subject': 'hello'} Note that any text-based field – such as CharField or EmailField –\nalways cleans the input into a string. We’ll cover the encoding implications\nlater in this document. If your data does not validate, the cleaned_data dictionary contains\nonly the valid fields: >>> data = { ... \"subject\" : \"\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"invalid email address\" , ... \"cc_myself\" : True , ... } >>> f = ContactForm ( data ) >>> f . is_valid () False >>> f . cleaned_data {'cc_myself': True, 'message': 'Hi there'} cleaned_data will always only contain a key for fields defined in the Form , even if you pass extra data when you define the Form . In this\nexample, we pass a bunch of extra fields to the ContactForm constructor,\nbut cleaned_data contains only the form’s fields: >>> data = { ... \"subject\" : \"hello\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"foo@example.com\" , ... \"cc_myself\" : True , ... \"extra_field_1\" : \"foo\" , ... \"extra_field_2\" : \"bar\" , ... \"extra_field_3\" : \"baz\" , ... } >>> f = ContactForm ( data ) >>> f . is_valid () True >>> f . cleaned_data # Doesn't contain extra_field_1, etc. {'cc_myself': True, 'message': 'Hi there', 'sender': 'foo@example.com', 'subject': 'hello'} When the Form is valid, cleaned_data will include a key and value for all its fields, even if the data didn’t include a value for some optional\nfields. In this example, the data dictionary doesn’t include a value for the nick_name field, but cleaned_data includes it, with an empty value: >>> from django import forms >>> class OptionalPersonForm ( forms . Form ): ... first_name = forms . CharField () ... last_name = forms . CharField () ... nick_name = forms . CharField ( required = False ) ... >>> data = { \"first_name\" : \"John\" , \"last_name\" : \"Lennon\" } >>> f = OptionalPersonForm ( data ) >>> f . is_valid () True >>> f . cleaned_data {'nick_name': '', 'first_name': 'John', 'last_name': 'Lennon'} In this above example, the cleaned_data value for nick_name is set to an\nempty string, because nick_name is CharField , and CharField s treat\nempty values as an empty string. Each field type knows what its “blank” value\nis – e.g., for DateField , it’s None instead of the empty string. For\nfull details on each field’s behavior in this case, see the “Empty value” note\nfor each field in the “Built-in Field classes” section below. You can write code to perform validation for particular form fields (based on\ntheir name) or for the form as a whole (considering combinations of various\nfields). More information about this is in Form and field validation . Outputting forms as HTML ¶ The second task of a Form object is to render itself as HTML. To do so, print it: >>> f = ContactForm () >>> print ( f ) <div><label for=\"id_subject\">Subject:</label><input type=\"text\" name=\"subject\" maxlength=\"100\" required id=\"id_subject\"></div> <div><label for=\"id_message\">Message:</label><input type=\"text\" name=\"message\" required id=\"id_message\"></div> <div><label for=\"id_sender\">Sender:</label><input type=\"email\" name=\"sender\" required id=\"id_sender\"></div> <div><label for=\"id_cc_myself\">Cc myself:</label><input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\"></div> If the form is bound to data, the HTML output will include that data\nappropriately. For example, if a field is represented by an <input type=\"text\"> , the data will be in the value attribute. If a\nfield is represented by an <input type=\"checkbox\"> , then that HTML will\ninclude checked if appropriate: >>> data = { ... \"subject\" : \"hello\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"foo@example.com\" , ... \"cc_myself\" : True , ... } >>> f = ContactForm ( data ) >>> print ( f ) <div><label for=\"id_subject\">Subject:</label><input type=\"text\" name=\"subject\" value=\"hello\" maxlength=\"100\" required id=\"id_subject\"></div> <div><label for=\"id_message\">Message:</label><input type=\"text\" name=\"message\" value=\"Hi there\" required id=\"id_message\"></div> <div><label for=\"id_sender\">Sender:</label><input type=\"email\" name=\"sender\" value=\"foo@example.com\" required id=\"id_sender\"></div> <div><label for=\"id_cc_myself\">Cc myself:</label><input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\" checked></div> This default output wraps each field with a <div> . Notice the following: For flexibility, the output does not include the <form> and </form> tags or an <input type=\"submit\"> tag. It’s your job to do that. Each field type has a default HTML representation. CharField is\nrepresented by an <input type=\"text\"> and EmailField by an <input type=\"email\"> . BooleanField(null=False) is represented by an <input type=\"checkbox\"> . Note these are merely sensible defaults; you can\nspecify which HTML to use for a given field by using widgets, which we’ll\nexplain shortly. The HTML name for each tag is taken directly from its attribute name\nin the ContactForm class. The text label for each field – e.g. 'Subject:' , 'Message:' and 'Cc myself:' is generated from the field name by converting all\nunderscores to spaces and upper-casing the first letter. Again, note\nthese are merely sensible defaults; you can also specify labels manually. Each text label is surrounded in an HTML <label> tag, which points\nto the appropriate form field via its id . Its id , in turn, is\ngenerated by prepending 'id_' to the field name. The id attributes and <label> tags are included in the output by default, to\nfollow best practices, but you can change that behavior. The output uses HTML5 syntax, targeting <!DOCTYPE html> . For example,\nit uses boolean attributes such as checked rather than the XHTML style\nof checked='checked' . Although <div> output is the default output style when you print a form\nyou can customize the output by using your own form template which can be set\nsite-wide, per-form, or per-instance. See Reusable form templates . Default rendering ¶ The default rendering when you print a form uses the following methods and\nattributes. template_name ¶ Form. template_name ¶ The name of the template rendered if the form is cast into a string, e.g. via print(form) or in a template via {{ form }} . By default, a property returning the value of the renderer’s form_template_name . You may set it\nas a string template name in order to override that for a particular form\nclass. render() ¶ Form. render ( template_name = None , context = None , renderer = None ) ¶ The render method is called by __str__ as well as the Form.as_div() , Form.as_table() , Form.as_p() , and Form.as_ul() methods.\nAll arguments are optional and default to: template_name : Form.template_name context : Value returned by Form.get_context() renderer : Value returned by Form.default_renderer By passing template_name you can customize the template used for just a\nsingle call. get_context() ¶ Form. get_context () ¶ Return the template context for rendering the form. The available context is: form : The bound form. fields : All bound fields, except the hidden fields. hidden_fields : All hidden bound fields. errors : All non field related or hidden field related form errors. template_name_label ¶ Form. template_name_label ¶ The template used to render a field’s <label> , used when calling BoundField.label_tag() / legend_tag() . Can be changed per\nform by overriding this attribute or more generally by overriding the default\ntemplate, see also Overriding built-in form templates . Output styles ¶ The recommended approach for changing form output style is to set a custom form\ntemplate either site-wide, per-form, or per-instance. See Reusable form templates for examples. The following helper functions are provided for backward compatibility and are\na proxy to Form.render() passing a particular template_name value. Note Of the framework provided templates and output styles, the default as_div() is recommended over the as_p() , as_table() , and as_ul() versions as the template implements <fieldset> and <legend> to group related inputs and is easier for screen reader users\nto navigate. Each helper pairs a form method with an attribute giving the appropriate\ntemplate name. as_div() ¶ Form. template_name_div ¶ The template used by as_div() . Default: 'django/forms/div.html' . Form. as_div () ¶ as_div() renders the form as a series of <div> elements, with each <div> containing one field, such as: >>> f = ContactForm () >>> f . as_div () … gives HTML like: < div > < label for = \"id_subject\" > Subject: </ label > < input type = \"text\" name = \"subject\" maxlength = \"100\" required id = \"id_subject\" > </ div > < div > < label for = \"id_message\" > Message: </ label > < input type = \"text\" name = \"message\" required id = \"id_message\" > </ div > < div > < label for = \"id_sender\" > Sender: </ label > < input type = \"email\" name = \"sender\" required id = \"id_sender\" > </ div > < div > < label for = \"id_cc_myself\" > Cc myself: </ label > < input type = \"checkbox\" name = \"cc_myself\" id = \"id_cc_myself\" > </ div > as_p() ¶ Form. template_name_p ¶ The template used by as_p() . Default: 'django/forms/p.html' . Form. as_p () ¶ as_p() renders the form as a series of <p> tags, with each <p> containing one field: >>> f = ContactForm () >>> f . as_p () '<p><label for=\"id_subject\">Subject:</label> <input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" required></p>\\n<p><label for=\"id_message\">Message:</label> <input type=\"text\" name=\"message\" id=\"id_message\" required></p>\\n<p><label for=\"id_sender\">Sender:</label> <input type=\"text\" name=\"sender\" id=\"id_sender\" required></p>\\n<p><label for=\"id_cc_myself\">Cc myself:</label> <input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\"></p>' >>> print ( f . as_p ()) <p><label for=\"id_subject\">Subject:</label> <input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" required></p> <p><label for=\"id_message\">Message:</label> <input type=\"text\" name=\"message\" id=\"id_message\" required></p> <p><label for=\"id_sender\">Sender:</label> <input type=\"email\" name=\"sender\" id=\"id_sender\" required></p> <p><label for=\"id_cc_myself\">Cc myself:</label> <input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\"></p> as_ul() ¶ Form. template_name_ul ¶ The template used by as_ul() . Default: 'django/forms/ul.html' . Form. as_ul () ¶ as_ul() renders the form as a series of <li> tags, with each <li> containing one field. It does not include the <ul> or </ul> , so that\nyou can specify any HTML attributes on the <ul> for flexibility: >>> f = ContactForm () >>> f . as_ul () '<li><label for=\"id_subject\">Subject:</label> <input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" required></li>\\n<li><label for=\"id_message\">Message:</label> <input type=\"text\" name=\"message\" id=\"id_message\" required></li>\\n<li><label for=\"id_sender\">Sender:</label> <input type=\"email\" name=\"sender\" id=\"id_sender\" required></li>\\n<li><label for=\"id_cc_myself\">Cc myself:</label> <input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\"></li>' >>> print ( f . as_ul ()) <li><label for=\"id_subject\">Subject:</label> <input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" required></li> <li><label for=\"id_message\">Message:</label> <input type=\"text\" name=\"message\" id=\"id_message\" required></li> <li><label for=\"id_sender\">Sender:</label> <input type=\"email\" name=\"sender\" id=\"id_sender\" required></li> <li><label for=\"id_cc_myself\">Cc myself:</label> <input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\"></li> as_table() ¶ Form. template_name_table ¶ The template used by as_table() . Default: 'django/forms/table.html' . Form. as_table () ¶ as_table() renders the form as an HTML <table> : >>> f = ContactForm () >>> f . as_table () '<tr><th><label for=\"id_subject\">Subject:</label></th><td><input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" required></td></tr>\\n<tr><th><label for=\"id_message\">Message:</label></th><td><input type=\"text\" name=\"message\" id=\"id_message\" required></td></tr>\\n<tr><th><label for=\"id_sender\">Sender:</label></th><td><input type=\"email\" name=\"sender\" id=\"id_sender\" required></td></tr>\\n<tr><th><label for=\"id_cc_myself\">Cc myself:</label></th><td><input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\"></td></tr>' >>> print ( f . as_table ()) <tr><th><label for=\"id_subject\">Subject:</label></th><td><input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" required></td></tr> <tr><th><label for=\"id_message\">Message:</label></th><td><input type=\"text\" name=\"message\" id=\"id_message\" required></td></tr> <tr><th><label for=\"id_sender\">Sender:</label></th><td><input type=\"email\" name=\"sender\" id=\"id_sender\" required></td></tr> <tr><th><label for=\"id_cc_myself\">Cc myself:</label></th><td><input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\"></td></tr> Styling required or erroneous form rows ¶ Form. error_css_class ¶ Form. required_css_class ¶ It’s pretty common to style form rows and fields that are required or have\nerrors. For example, you might want to present required form rows in bold and\nhighlight errors in red. The Form class has a couple of hooks you can use to add class attributes to required rows or to rows with errors: set the Form.error_css_class and/or Form.required_css_class attributes: from django import forms class ContactForm ( forms . Form ): error_css_class = \"error\" required_css_class = \"required\" # ... and the rest of your fields here Once you’ve done that, rows will be given \"error\" and/or \"required\" classes, as needed. The HTML will look something like: >>> f = ContactForm ( data ) >>> print ( f ) <div class=\"required\"><label for=\"id_subject\" class=\"required\">Subject:</label> ... <div class=\"required\"><label for=\"id_message\" class=\"required\">Message:</label> ... <div class=\"required\"><label for=\"id_sender\" class=\"required\">Sender:</label> ... <div><label for=\"id_cc_myself\">Cc myself:</label> ... >>> f [ \"subject\" ] . label_tag () <label class=\"required\" for=\"id_subject\">Subject:</label> >>> f [ \"subject\" ] . legend_tag () <legend class=\"required\" for=\"id_subject\">Subject:</legend> >>> f [ \"subject\" ] . label_tag ( attrs = { \"class\" : \"foo\" }) <label for=\"id_subject\" class=\"foo required\">Subject:</label> >>> f [ \"subject\" ] . legend_tag ( attrs = { \"class\" : \"foo\" }) <legend for=\"id_subject\" class=\"foo required\">Subject:</legend> Configuring form elements’ HTML id attributes and <label> tags ¶ Form. auto_id ¶ By default, the form rendering methods include: HTML id attributes on the form elements. The corresponding <label> tags around the labels. An HTML <label> tag\ndesignates which label text is associated with which form element. This small\nenhancement makes forms more usable and more accessible to assistive devices.\nIt’s always a good idea to use <label> tags. The id attribute values are generated by prepending id_ to the form\nfield names.  This behavior is configurable, though, if you want to change the id convention or remove HTML id attributes and <label> tags\nentirely. Use the auto_id argument to the Form constructor to control the id and label behavior. This argument must be True , False or a string. If auto_id is False , then the form output will not include <label> tags nor id attributes: >>> f = ContactForm ( auto_id = False ) >>> print ( f ) <div>Subject:<input type=\"text\" name=\"subject\" maxlength=\"100\" required></div> <div>Message:<textarea name=\"message\" cols=\"40\" rows=\"10\" required></textarea></div> <div>Sender:<input type=\"email\" name=\"sender\" required></div> <div>Cc myself:<input type=\"checkbox\" name=\"cc_myself\"></div> If auto_id is set to True , then the form output will include <label> tags and will use the field name as its id for each form\nfield: >>> f = ContactForm ( auto_id = True ) >>> print ( f ) <div><label for=\"subject\">Subject:</label><input type=\"text\" name=\"subject\" maxlength=\"100\" required id=\"subject\"></div> <div><label for=\"message\">Message:</label><textarea name=\"message\" cols=\"40\" rows=\"10\" required id=\"message\"></textarea></div> <div><label for=\"sender\">Sender:</label><input type=\"email\" name=\"sender\" required id=\"sender\"></div> <div><label for=\"cc_myself\">Cc myself:</label><input type=\"checkbox\" name=\"cc_myself\" id=\"cc_myself\"></div> If auto_id is set to a string containing the format character '%s' ,\nthen the form output will include <label> tags, and will generate id attributes based on the format string. For example, for a format string 'field_%s' , a field named subject will get the id value 'field_subject' . Continuing our example: >>> f = ContactForm ( auto_id = \"id_for_ %s \" ) >>> print ( f ) <div><label for=\"id_for_subject\">Subject:</label><input type=\"text\" name=\"subject\" maxlength=\"100\" required id=\"id_for_subject\"></div> <div><label for=\"id_for_message\">Message:</label><textarea name=\"message\" cols=\"40\" rows=\"10\" required id=\"id_for_message\"></textarea></div> <div><label for=\"id_for_sender\">Sender:</label><input type=\"email\" name=\"sender\" required id=\"id_for_sender\"></div> <div><label for=\"id_for_cc_myself\">Cc myself:</label><input type=\"checkbox\" name=\"cc_myself\" id=\"id_for_cc_myself\"></div> If auto_id is set to any other true value – such as a string that doesn’t\ninclude %s – then the library will act as if auto_id is True . By default, auto_id is set to the string 'id_%s' . Form. label_suffix ¶ A translatable string (defaults to a colon ( : ) in English) that will be\nappended after any label name when a form is rendered. It’s possible to customize that character, or omit it entirely, using the label_suffix parameter: >>> f = ContactForm ( auto_id = \"id_for_ %s \" , label_suffix = \"\" ) >>> print ( f ) <div><label for=\"id_for_subject\">Subject</label><input type=\"text\" name=\"subject\" maxlength=\"100\" required id=\"id_for_subject\"></div> <div><label for=\"id_for_message\">Message</label><textarea name=\"message\" cols=\"40\" rows=\"10\" required id=\"id_for_message\"></textarea></div> <div><label for=\"id_for_sender\">Sender</label><input type=\"email\" name=\"sender\" required id=\"id_for_sender\"></div> <div><label for=\"id_for_cc_myself\">Cc myself</label><input type=\"checkbox\" name=\"cc_myself\" id=\"id_for_cc_myself\"></div> >>> f = ContactForm ( auto_id = \"id_for_ %s \" , label_suffix = \" ->\" ) >>> print ( f ) <div><label for=\"id_for_subject\">Subject -&gt;</label><input type=\"text\" name=\"subject\" maxlength=\"100\" required id=\"id_for_subject\"></div> <div><label for=\"id_for_message\">Message -&gt;</label><textarea name=\"message\" cols=\"40\" rows=\"10\" required id=\"id_for_message\"></textarea></div> <div><label for=\"id_for_sender\">Sender -&gt;</label><input type=\"email\" name=\"sender\" required id=\"id_for_sender\"></div> <div><label for=\"id_for_cc_myself\">Cc myself -&gt;</label><input type=\"checkbox\" name=\"cc_myself\" id=\"id_for_cc_myself\"></div> Note that the label suffix is added only if the last character of the\nlabel isn’t a punctuation character (in English, those are . , ! , ? or : ). Fields can also define their own label_suffix .\nThis will take precedence over Form.label_suffix . The suffix can also be overridden at runtime\nusing the label_suffix parameter to label_tag() / legend_tag() . Form. use_required_attribute ¶ When set to True (the default), required form fields will have the required HTML attribute. Formsets instantiate forms with use_required_attribute=False to avoid incorrect browser validation when\nadding and deleting forms from a formset. Configuring the rendering of a form’s widgets ¶ Form. default_renderer ¶ Specifies the renderer to use for the form. Defaults to None which means to use the default renderer specified by the FORM_RENDERER setting. You can set this as a class attribute when declaring your form or use the renderer argument to Form.__init__() . For example: from django import forms class MyForm ( forms . Form ): default_renderer = MyRenderer () or: form = MyForm ( renderer = MyRenderer ()) Notes on field ordering ¶ In the as_p() , as_ul() and as_table() shortcuts, the fields are\ndisplayed in the order in which you define them in your form class. For\nexample, in the ContactForm example, the fields are defined in the order subject , message , sender , cc_myself . To reorder the HTML\noutput, change the order in which those fields are listed in the class. There are several other ways to customize the order: Form. field_order ¶ By default Form.field_order=None , which retains the order in which you\ndefine the fields in your form class. If field_order is a list of field\nnames, the fields are ordered as specified by the list and remaining fields are\nappended according to the default order. Unknown field names in the list are\nignored. This makes it possible to disable a field in a subclass by setting it\nto None without having to redefine ordering. You can also use the Form.field_order argument to a Form to\noverride the field order. If a Form defines field_order and you include field_order when instantiating\nthe Form , then the latter field_order will have precedence. Form. order_fields ( field_order ) ¶ You may rearrange the fields any time using order_fields() with a list of\nfield names as in field_order . How errors are displayed ¶ If you render a bound Form object, the act of rendering will automatically\nrun the form’s validation if it hasn’t already happened, and the HTML output\nwill include the validation errors as a <ul class=\"errorlist\"> near the\nfield. The particular positioning of the error messages depends on the output\nmethod you’re using: >>> data = { ... \"subject\" : \"\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"invalid email address\" , ... \"cc_myself\" : True , ... } >>> f = ContactForm ( data , auto_id = False ) >>> print ( f ) <div>Subject: <ul class=\"errorlist\"><li>This field is required.</li></ul> <input type=\"text\" name=\"subject\" maxlength=\"100\" required aria-invalid=\"true\"> </div> <div>Message: <textarea name=\"message\" cols=\"40\" rows=\"10\" required>Hi there</textarea> </div> <div>Sender: <ul class=\"errorlist\"><li>Enter a valid email address.</li></ul> <input type=\"email\" name=\"sender\" value=\"invalid email address\" required aria-invalid=\"true\"> </div> <div>Cc myself: <input type=\"checkbox\" name=\"cc_myself\" checked> </div> Customizing the error list format ¶ class ErrorList ( initlist = None , error_class = None , renderer = None ) [source] ¶ By default, forms use django.forms.utils.ErrorList to format validation\nerrors. ErrorList is a list like object where initlist is the\nlist of errors. In addition this class has the following attributes and\nmethods. error_class ¶ The CSS classes to be used when rendering the error list. Any provided\nclasses are added to the default errorlist class. renderer ¶ Specifies the renderer to use for ErrorList .\nDefaults to None which means to use the default renderer\nspecified by the FORM_RENDERER setting. template_name ¶ The name of the template used when calling __str__ or render() . By default this is 'django/forms/errors/list/default.html' which is a proxy for the 'ul.html' template. template_name_text ¶ The name of the template used when calling as_text() . By default\nthis is 'django/forms/errors/list/text.html' . This template renders\nthe errors as a list of bullet points. template_name_ul ¶ The name of the template used when calling as_ul() . By default\nthis is 'django/forms/errors/list/ul.html' . This template renders\nthe errors in <li> tags with a wrapping <ul> with the CSS\nclasses as defined by error_class . get_context () [source] ¶ Return context for rendering of errors in a template. The available context is: errors : A list of the errors. error_class : A string of CSS classes. render ( template_name = None , context = None , renderer = None ) ¶ The render method is called by __str__ as well as by the as_ul() method. All arguments are optional and will default to: template_name : Value returned by template_name context : Value returned by get_context() renderer : Value returned by renderer as_text () ¶ Renders the error list using the template defined by template_name_text . as_ul () ¶ Renders the error list using the template defined by template_name_ul . If you’d like to customize the rendering of errors this can be achieved by\noverriding the template_name attribute or more generally by\noverriding the default template, see also Overriding built-in form templates . More granular output ¶ The as_p() , as_ul() , and as_table() methods are shortcuts –\nthey’re not the only way a form object can be displayed. class BoundField [source] ¶ Used to display HTML or access attributes for a single field of a Form instance. The __str__() method of this object displays the HTML for this field. To retrieve a single BoundField , use dictionary lookup syntax on your form\nusing the field’s name as the key: >>> form = ContactForm () >>> print ( form [ \"subject\" ]) <input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" required> To retrieve all BoundField objects, iterate the form: >>> form = ContactForm () >>> for boundfield in form : ... print ( boundfield ) ... <input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" required> <input type=\"text\" name=\"message\" id=\"id_message\" required> <input type=\"email\" name=\"sender\" id=\"id_sender\" required> <input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\"> The field-specific output honors the form object’s auto_id setting: >>> f = ContactForm ( auto_id = False ) >>> print ( f [ \"message\" ]) <input type=\"text\" name=\"message\" required> >>> f = ContactForm ( auto_id = \"id_ %s \" ) >>> print ( f [ \"message\" ]) <input type=\"text\" name=\"message\" id=\"id_message\" required> Attributes of BoundField ¶ BoundField. auto_id [source] ¶ The HTML ID attribute for this BoundField . Returns an empty string\nif Form.auto_id is False . BoundField. data [source] ¶ This property returns the data for this BoundField extracted by the widget’s value_from_datadict() method, or None if it wasn’t given: >>> unbound_form = ContactForm () >>> print ( unbound_form [ \"subject\" ] . data ) None >>> bound_form = ContactForm ( data = { \"subject\" : \"My Subject\" }) >>> print ( bound_form [ \"subject\" ] . data ) My Subject BoundField. errors [source] ¶ A list-like object that is displayed\nas an HTML <ul class=\"errorlist\"> when printed: >>> data = { \"subject\" : \"hi\" , \"message\" : \"\" , \"sender\" : \"\" , \"cc_myself\" : \"\" } >>> f = ContactForm ( data , auto_id = False ) >>> print ( f [ \"message\" ]) <input type=\"text\" name=\"message\" required aria-invalid=\"true\"> >>> f [ \"message\" ] . errors ['This field is required.'] >>> print ( f [ \"message\" ] . errors ) <ul class=\"errorlist\"><li>This field is required.</li></ul> >>> f [ \"subject\" ] . errors [] >>> print ( f [ \"subject\" ] . errors ) >>> str ( f [ \"subject\" ] . errors ) '' When rendering a field with errors, aria-invalid=\"true\" will be set on\nthe field’s widget to indicate there is an error to screen reader users. Changed in Django 5.0: The aria-invalid=\"true\" was added when a field has errors. BoundField. field ¶ The form Field instance from the form class that\nthis BoundField wraps. BoundField. form ¶ The Form instance this BoundField is bound to. BoundField. help_text ¶ The help_text of the field. BoundField. html_name ¶ The name that will be used in the widget’s HTML name attribute. It takes\nthe form prefix into account. BoundField. id_for_label [source] ¶ Use this property to render the ID of this field. For example, if you are\nmanually constructing a <label> in your template (despite the fact that label_tag() / legend_tag() will do this\nfor you): < label for = \" {{ form.my_field.id_for_label }} \" > ... </ label > {{ my_field }} By default, this will be the field’s name prefixed by id_ (” id_my_field ” for the example above). You may modify the ID by setting attrs on the field’s widget. For example,\ndeclaring a field like this: my_field = forms . CharField ( widget = forms . TextInput ( attrs = { \"id\" : \"myFIELD\" })) and using the template above, would render something like: < label for = \"myFIELD\" > ... </ label >< input id = \"myFIELD\" type = \"text\" name = \"my_field\" required > BoundField. initial [source] ¶ Use BoundField.initial to retrieve initial data for a form field.\nIt retrieves the data from Form.initial if present, otherwise\ntrying Field.initial . Callable values are evaluated. See Initial form values for more examples. BoundField.initial caches its return value, which is useful\nespecially when dealing with callables whose return values can change (e.g. datetime.now or uuid.uuid4 ): >>> from datetime import datetime >>> class DatedCommentForm ( CommentForm ): ... created = forms . DateTimeField ( initial = datetime . now ) ... >>> f = DatedCommentForm () >>> f [ \"created\" ] . initial datetime.datetime(2021, 7, 27, 9, 5, 54) >>> f [ \"created\" ] . initial datetime.datetime(2021, 7, 27, 9, 5, 54) Using BoundField.initial is recommended over get_initial_for_field() . BoundField. is_hidden [source] ¶ Returns True if this BoundField ’s widget is\nhidden. BoundField. label ¶ The label of the field. This is used in label_tag() / legend_tag() . BoundField. name ¶ The name of this field in the form: >>> f = ContactForm () >>> print ( f [ \"subject\" ] . name ) subject >>> print ( f [ \"message\" ] . name ) message BoundField. template_name [source] ¶ New in Django 5.0. The name of the template rendered with BoundField.as_field_group() . A property returning the value of the template_name if set otherwise field_template_name . BoundField. use_fieldset [source] ¶ Returns the value of this BoundField widget’s use_fieldset attribute. BoundField. widget_type [source] ¶ Returns the lowercased class name of the wrapped field’s widget, with any\ntrailing input or widget removed. This may be used when building\nforms where the layout is dependent upon the widget type. For example: {% for field in form %} {% if field.widget_type == 'checkbox' %} # render one way {% else %} # render another way {% endif %} {% endfor %} Methods of BoundField ¶ BoundField. as_field_group () ¶ New in Django 5.0. Renders the field using BoundField.render() with default values\nwhich renders the BoundField , including its label, help text and errors\nusing the template’s template_name if set\notherwise field_template_name BoundField. as_hidden ( attrs = None , ** kwargs ) [source] ¶ Returns a string of HTML for representing this as an <input type=\"hidden\"> . **kwargs are passed to as_widget() . This method is primarily used internally. You should use a widget instead. BoundField. as_widget ( widget = None , attrs = None , only_initial = False ) [source] ¶ Renders the field by rendering the passed widget, adding any HTML\nattributes passed as attrs .  If no widget is specified, then the\nfield’s default widget will be used. only_initial is used by Django internals and should not be set\nexplicitly. BoundField. css_classes ( extra_classes = None ) [source] ¶ When you use Django’s rendering shortcuts, CSS classes are used to\nindicate required form fields or fields that contain errors. If you’re\nmanually rendering a form, you can access these CSS classes using the css_classes method: >>> f = ContactForm ( data = { \"message\" : \"\" }) >>> f [ \"message\" ] . css_classes () 'required' If you want to provide some additional classes in addition to the\nerror and required classes that may be required, you can provide\nthose classes as an argument: >>> f = ContactForm ( data = { \"message\" : \"\" }) >>> f [ \"message\" ] . css_classes ( \"foo bar\" ) 'foo bar required' BoundField. get_context () [source] ¶ New in Django 5.0. Return the template context for rendering the field. The available context\nis field being the instance of the bound field. BoundField. label_tag ( contents = None , attrs = None , label_suffix = None , tag = None ) [source] ¶ Renders a label tag for the form field using the template specified by Form.template_name_label . The available context is: field : This instance of the BoundField . contents : By default a concatenated string of BoundField.label and Form.label_suffix (or Field.label_suffix , if set). This can be overridden by the contents and label_suffix arguments. attrs : A dict containing for , Form.required_css_class , and id . id is generated by the\nfield’s widget attrs or BoundField.auto_id . Additional\nattributes can be provided by the attrs argument. use_tag : A boolean which is True if the label has an id .\nIf False the default template omits the tag . tag : An optional string to customize the tag, defaults to label . Tip In your template field is the instance of the BoundField .\nTherefore field.field accesses BoundField.field being\nthe field you declare, e.g. forms.CharField . To separately render the label tag of a form field, you can call its label_tag() method: >>> f = ContactForm ( data = { \"message\" : \"\" }) >>> print ( f [ \"message\" ] . label_tag ()) <label for=\"id_message\">Message:</label> If you’d like to customize the rendering this can be achieved by overriding\nthe Form.template_name_label attribute or more generally by\noverriding the default template, see also Overriding built-in form templates . BoundField. legend_tag ( contents = None , attrs = None , label_suffix = None ) [source] ¶ Calls label_tag() with tag='legend' to render the label with <legend> tags. This is useful when rendering radio and multiple\ncheckbox widgets where <legend> may be more appropriate than a <label> . BoundField. render ( template_name = None , context = None , renderer = None ) ¶ New in Django 5.0. The render method is called by as_field_group . All arguments are\noptional and default to: template_name : BoundField.template_name context : Value returned by BoundField.get_context() renderer : Value returned by Form.default_renderer By passing template_name you can customize the template used for just a\nsingle call. BoundField. value () [source] ¶ Use this method to render the raw value of this field as it would be rendered\nby a Widget : >>> initial = { \"subject\" : \"welcome\" } >>> unbound_form = ContactForm ( initial = initial ) >>> bound_form = ContactForm ( data = { \"subject\" : \"hi\" }, initial = initial ) >>> print ( unbound_form [ \"subject\" ] . value ()) welcome >>> print ( bound_form [ \"subject\" ] . value ()) hi Customizing BoundField ¶ If you need to access some additional information about a form field in a\ntemplate and using a subclass of Field isn’t\nsufficient, consider also customizing BoundField . A custom form field can override get_bound_field() : Field. get_bound_field ( form , field_name ) [source] ¶ Takes an instance of Form and the name of the field.\nThe return value will be used when accessing the field in a template. Most\nlikely it will be an instance of a subclass of BoundField . If you have a GPSCoordinatesField , for example, and want to be able to\naccess additional information about the coordinates in a template, this could\nbe implemented as follows: class GPSCoordinatesBoundField ( BoundField ): @property def country ( self ): \"\"\" Return the country the coordinates lie in or None if it can't be determined. \"\"\" value = self . value () if value : return get_country_from_coordinates ( value ) else : return None class GPSCoordinatesField ( Field ): def get_bound_field ( self , form , field_name ): return GPSCoordinatesBoundField ( form , self , field_name ) Now you can access the country in a template with {{ form.coordinates.country }} . Binding uploaded files to a form ¶ Dealing with forms that have FileField and ImageField fields\nis a little more complicated than a normal form. Firstly, in order to upload files, you’ll need to make sure that your <form> element correctly defines the enctype as \"multipart/form-data\" : < form enctype = \"multipart/form-data\" method = \"post\" action = \"/foo/\" > Secondly, when you use the form, you need to bind the file data. File\ndata is handled separately to normal form data, so when your form\ncontains a FileField and ImageField , you will need to specify\na second argument when you bind your form. So if we extend our\nContactForm to include an ImageField called mugshot , we\nneed to bind the file data containing the mugshot image: # Bound form with an image field >>> from django.core.files.uploadedfile import SimpleUploadedFile >>> data = { ... \"subject\" : \"hello\" , ... \"message\" : \"Hi there\" , ... \"sender\" : \"foo@example.com\" , ... \"cc_myself\" : True , ... } >>> file_data = { \"mugshot\" : SimpleUploadedFile ( \"face.jpg\" , b \"file data\" )} >>> f = ContactFormWithMugshot ( data , file_data ) In practice, you will usually specify request.FILES as the source\nof file data (just like you use request.POST as the source of\nform data): # Bound form with an image field, data from the request >>> f = ContactFormWithMugshot ( request . POST , request . FILES ) Constructing an unbound form is the same as always – omit both form data and file data: # Unbound form with an image field >>> f = ContactFormWithMugshot () Testing for multipart forms ¶ Form. is_multipart () ¶ If you’re writing reusable views or templates, you may not know ahead of time\nwhether your form is a multipart form or not. The is_multipart() method\ntells you whether the form requires multipart encoding for submission: >>> f = ContactFormWithMugshot () >>> f . is_multipart () True Here’s an example of how you might use this in a template: {% if form.is_multipart %} < form enctype = \"multipart/form-data\" method = \"post\" action = \"/foo/\" > {% else %} < form method = \"post\" action = \"/foo/\" > {% endif %} {{ form }} </ form > Subclassing forms ¶ If you have multiple Form classes that share fields, you can use\nsubclassing to remove redundancy. When you subclass a custom Form class, the resulting subclass will\ninclude all fields of the parent class(es), followed by the fields you define\nin the subclass. In this example, ContactFormWithPriority contains all the fields from ContactForm , plus an additional field, priority . The ContactForm fields are ordered first: >>> class ContactFormWithPriority ( ContactForm ): ... priority = forms . CharField () ... >>> f = ContactFormWithPriority ( auto_id = False ) >>> print ( f ) <div>Subject:<input type=\"text\" name=\"subject\" maxlength=\"100\" required></div> <div>Message:<textarea name=\"message\" cols=\"40\" rows=\"10\" required></textarea></div> <div>Sender:<input type=\"email\" name=\"sender\" required></div> <div>Cc myself:<input type=\"checkbox\" name=\"cc_myself\"></div> <div>Priority:<input type=\"text\" name=\"priority\" required></div> It’s possible to subclass multiple forms, treating forms as mixins. In this\nexample, BeatleForm subclasses both PersonForm and InstrumentForm (in that order), and its field list includes the fields from the parent\nclasses: >>> from django import forms >>> class PersonForm ( forms . Form ): ... first_name = forms . CharField () ... last_name = forms . CharField () ... >>> class InstrumentForm ( forms . Form ): ... instrument = forms . CharField () ... >>> class BeatleForm ( InstrumentForm , PersonForm ): ... haircut_type = forms . CharField () ... >>> b = BeatleForm ( auto_id = False ) >>> print ( b ) <div>First name:<input type=\"text\" name=\"first_name\" required></div> <div>Last name:<input type=\"text\" name=\"last_name\" required></div> <div>Instrument:<input type=\"text\" name=\"instrument\" required></div> <div>Haircut type:<input type=\"text\" name=\"haircut_type\" required></div> It’s possible to declaratively remove a Field inherited from a parent class\nby setting the name of the field to None on the subclass. For example: >>> from django import forms >>> class ParentForm ( forms . Form ): ... name = forms . CharField () ... age = forms . IntegerField () ... >>> class ChildForm ( ParentForm ): ... name = None ... >>> list ( ChildForm () . fields ) ['age'] Prefixes for forms ¶ Form. prefix ¶ You can put several Django forms inside one <form> tag. To give each Form its own namespace, use the prefix keyword argument: >>> mother = PersonForm ( prefix = \"mother\" ) >>> father = PersonForm ( prefix = \"father\" ) >>> print ( mother ) <div><label for=\"id_mother-first_name\">First name:</label><input type=\"text\" name=\"mother-first_name\" required id=\"id_mother-first_name\"></div> <div><label for=\"id_mother-last_name\">Last name:</label><input type=\"text\" name=\"mother-last_name\" required id=\"id_mother-last_name\"></div> >>> print ( father ) <div><label for=\"id_father-first_name\">First name:</label><input type=\"text\" name=\"father-first_name\" required id=\"id_father-first_name\"></div> <div><label for=\"id_father-last_name\">Last name:</label><input type=\"text\" name=\"father-last_name\" required id=\"id_father-last_name\"></div> The prefix can also be specified on the form class: >>> class PersonForm ( forms . Form ): ... ... ... prefix = \"person\" ...", "keywords": ["users", "routines", "rows", "feature", "act", "integerfield", "uuidfield", "underscores", "formset", "extra_classes", "emailfield", "messages", "id=\"id_for_message\"></textarea></div", "b", "formsets", "get_bound_field", "type=\"checkbox", "library", "sender", "field", "#", "legend", "record", "as_data", "li><label", "share", "representation", "action", "for=\"id_message\">message:</label></th><td><input", "compatibility", "datefield", "class=\"foo", "myform", "form.get_context", "form.as_ul", "type=\"text", "positioning", "colon", "type=\"submit", "rows=\"10", "xhtml", "value=\"foo@example.com", "template_name_label", "enctype", "label", "=", "results", "errorlist", "message", "fact", "inputs", "message:<textarea", "character", "father", "tag", "form.my_field.id_for_label", "cc", "process", "fallback", "unbound_form", "wrapping", "class=\"required\">sender:</label", "topic", "required></li>\\n", "sender:<input", "john", "first_name", "type", "myself</label><input", "id_cc_myself", "filefield", "calls", "custom", "kwargs", "objects", "boundfield.render", "for=\"id_subject\">subject?</label><input", "form.coordinates.country", "file", "uuid('1b411fab-844e-4dec", "implications", "layout", "id=\"id_for_sender\"></div", "default.html", "id_sender", "tag='legend", "li", "lennon", "whole", "required></li", "attribute", "helper", "gpscoordinatesboundfield", "radio", "time", "styles", "type:<input", "tags", "jquery", "render", "setting", "account", "things", "base_fields", "honors", "logic", "as_table", "name", "parameter", "id=\"id_cc_myself\"></td></tr", "optionalpersonform", "for=\"id_for_sender\">sender", "escaping", "has_changed", "is_multipart", "age", "for=\"id_for_sender\">sender:</label><input", "versions", "modification", "for=\"id_subject\">subject:</label></th><td><input", "a3b074fa9c30", "for=\"id_for_message\">message", "required></p", "behaves", "form.non_field_errors", "return", "required></p>\\n", "boundfield.label", "as_json", "foo", "parent", "field.label_suffix", "letter", "get_initial_for_field", "requirement", "datetime.date", "for=\"id_sender\">sender:</label></th><td><input", "datetimefield", "examples", "value=\"instance", "callables", "for=\"id_subject\">subject:</label", "form.label_suffix", "order_fields", "label_suffix", "username", "form.error_css_class", "proxy", "join", "url", "error", "for=\"id_for_subject\">subject</label><input", "code", "commentform", "my_field", "widget_type", "punctuation", "false", "behavior", "style", "access", "class", "i", "bullet", "contactform", "beatleform", "get_json_data", "group", "required\">subject:</label", "mother", "widget", "customizing", "returns", "names", "javascript", "'", "extra_field_2", "attack", "request", "class=\"required\">message:</label", "required_css_class", "output", "input", "name=\"first_name", "instrument", "*", "page", "field.initial", "strings", "elements", "wraps", "subclass", "form.as_div", "class=\"required\"><label", "name=\"last_name", ".", "name=\"haircut_type", "usage", "id=\"cc_myself\"></div", "name=\"mother", "help_text", "xml", "div><label", "validation", "flexibility", "contactformwithpriority", "redundancy", "as_field_group", "section", "for=\"id_subject\">topic:</label><input", "cleaned_data", "suffix", "source", "myself:</label><input", "id=\"message\"></textarea></div", "for=\"id_sender\">sender:</label", "for=\"id_for_message\">message</label><textarea", "uuidcommentform", "css", "use", "non_field_errors", "aria", "for=\"id_message\">message:</label><input", "errortext", "baz", "boundfield.label_tag", "value=\"invalid", "id=\"id_mother", "id_my_field", "required></td></tr>\\n", "cols=\"40", "order", "default", "af7d-07b3aa306334", "boundfield.auto_id", "doctype", "initlist", "comment", "form", "initial", "shortcuts", "prefix", "hi", "unbound", "format", "classes", "ul.html", "cleaning", "convention", "for=\"id_cc_myself\">cc", "form.errors.as_json", "add_error", "id_message", "haircut_type", "form.errors", "validationerror", "f", "name=\"message", "required\">subject:</legend", "template", "name=\"comment", "for=\"message\">message:</label><textarea", "form.add_error", "form.required_css_class", "boundfield.as_field_group", "way", "formats", "endfor", "first_name\"></div", "parentform", "template_name", "id=\"id_father", "datetime.now", "possibility", "session", "field_subject", "¶", "maxlength", "contactformwithmugshot", "id", "spaces", "id=\"id_for_subject\"></div", "post", "for=\"id_subject\">subject:</label><input", "file_data", "id=\"id_cc_myself\"></p", "boundfield", "id=\"id_subject", "property", "side", "required></div", "legend_tag", "div.html", "for=\"id_mother", "function", "views", "@property", "result", "testing", "view", "uuid", "treat", "number", "form.__init", "for=\"id_for_subject\">subject", "template_name_text", "maps", "gpscoordinatesfield", "def", "values", "use_required_attribute", "field_order", "auto_id", "instrument:<input", "string", "_", "id_subject", "<", "error_class", "for=\"id_father", "mapping", "uuid.uuid4", "django.forms.fields", "-&gt;</label><input", "changed_data", "el).text(errortext", "name=\"sender", "subject", "table", "form.add_error(none", "scripting", "as_text", "url:<input", "for=\"id_message\">message:</label", "ways", "level", "json", "form_template_name", "prefixes", "contents", "boundfield.initial", "id_%s", "image", "labels", "namespace", "reader", "django", "series", "foo@example.com", "n’t", "div", "name:</label><input", "fields", "print", "label_tag", "set", "for=\"sender\">sender:</label><input", "bunch", "practice", "0x7ffaac632f90", "required></td></tr", "value", "datedcommentform", "for=\"id_for_cc_myself\">cc", "as_ul", "form_renderer", "data", "browser", "myfield", "priority:<input", "mixins", "datetime", "task", "form.field_order", "person", "another_f", "identifier", "maxlength=\"100", "comment:<input", "ul", "has_error", "need", "instance", "self", "haircut", "myself:</label></th><td><input", "value=\"hello", "effects", "for=\"id_for_sender\">sender</label><input", "bd4f", "interface", "tip", "extra_field_3", "form.default_renderer", "as_div", "get_country_from_coordinates", "extra_field_1", "constructor", "instances", "for=\"id_for_message\">message:</label><textarea", "there</textarea", "type=\"email", "object", "print(form", "textarea", "couple", "last_name\"></div", "p.html", "charfield", "response", "precedence", "internals", "myrenderer", "dictionary", "requests", "points", "html_name", "red", "boundfield.field", "id=\"id_for_cc_myself\"></div", "rendering", "keyword", "s", "attrs", "inserts", "tr><th><label", "as_p", "rest", "myself:</label", "notes", "turn", "class=\"required\">subject:</label", "address", "practices", "renders", "class(es", "get_context", "as_hidden", "imagefield", "widgets", "name:<input", "form.template_name", "for=\"id_subject", "myself:<input", "html5", "forms", "site", "form.as_p", "for=\"id_message", "text.html", "addition", "lists", "example", "css_classes", "class=\"errorlist", "hooks", "country", "list", "simpleuploadedfile", "use_fieldset", "first", "name=\"priority", "email", "enhancement", "for=\"id_for_subject\">subject:</label><input", "for=\"subject\">subject:</label><input", "id=\"id_cc_myself", "nick_name", "name=\"father", "for=\"cc_myself\">cc", "idea", "django.forms.utils", "element", "encoding", "urlfield", "attributes", "approach", "table.html", "for=\"id_sender\">sender:</label><input", "childform", "id=\"id_sender", "value_from_datadict", "variety", "syntax", "subject:<input", "textinput", "coordinates", "keys", "case", "boolean", "lookup", "error_css_class", "runtime", "clean", "errors", "html", "job", "screen", "str", "boundfield.get_context", "submission", "arguments", "introduction", "personform", "cc_myself", "uuid4", "devices", "comparison", "for=\"id_subject\">subject:</legend", "name=\"cc_myself", ".html", "name=\"url", "last_name", "last_name\">last", "bar", "hidden_fields", "is_valid", "functions", "key", "renderer", "template_name_ul", "none", "address.</li></ul", "specifies", "name=\"name", "p><label", "reason", "name=\"cc_myself\"></div", "framework", "caches", "field.widget_type", "new", "true", "dict", "instrumentform", "uuid('28a09c59", "api", "priority", "document", "styling", "field_template_name", "-", "field_name", "context", "template_name_p", "import", "files", "d", "booleanfield(null", ">", "%", "defaults", "call", "checkbox", "information", "row", "python", "datetime.datetime(2021", "methods", "times", "field.field", "client", "details", "method", "argument", "form.template_name_label", "combinations", "note", "templates", "field_%s", "moment", "text", "english"], "type": "documentation"},
{"title": "SchemaEditor | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/schema-editor/", "content": "SchemaEditor ¶ class BaseDatabaseSchemaEditor [source] ¶ Django’s migration system is split into two parts; the logic for calculating\nand storing what operations should be run ( django.db.migrations ), and the\ndatabase abstraction layer that turns things like “create a model” or\n“delete a field” into SQL - which is the job of the SchemaEditor . It’s unlikely that you will want to interact directly with SchemaEditor as\na normal developer using Django, but if you want to write your own migration\nsystem, or have more advanced needs, it’s a lot nicer than writing SQL. Each database backend in Django supplies its own version of SchemaEditor ,\nand it’s always accessible via the connection.schema_editor() context\nmanager: with connection . schema_editor () as schema_editor : schema_editor . delete_model ( MyModel ) It must be used via the context manager as this allows it to manage things\nlike transactions and deferred SQL (like creating ForeignKey constraints). It exposes all possible operations as methods, that should be called in\nthe order you wish changes to be applied. Some possible operations or types\nof change are not possible on all databases - for example, MyISAM does not\nsupport foreign key constraints. If you are writing or maintaining a third-party database backend for Django,\nyou will need to provide a SchemaEditor implementation in order to work with\nDjango’s migration functionality - however, as long as your database is\nrelatively standard in its use of SQL and relational design, you should be able\nto subclass one of the built-in Django SchemaEditor classes and tweak the\nsyntax a little. Methods ¶ execute() ¶ BaseDatabaseSchemaEditor. execute ( sql , params = () ) [source] ¶ Executes the SQL statement passed in, with parameters if supplied. This\nis a wrapper around the normal database cursors that allows capture of the SQL\nto a .sql file if the user wishes. create_model() ¶ BaseDatabaseSchemaEditor. create_model ( model ) [source] ¶ Creates a new table in the database for the provided model, along with any\nunique constraints or indexes it requires. delete_model() ¶ BaseDatabaseSchemaEditor. delete_model ( model ) [source] ¶ Drops the model’s table in the database along with any unique constraints\nor indexes it has. add_index() ¶ BaseDatabaseSchemaEditor. add_index ( model , index ) [source] ¶ Adds index to model ’s table. remove_index() ¶ BaseDatabaseSchemaEditor. remove_index ( model , index ) [source] ¶ Removes index from model ’s table. rename_index() ¶ BaseDatabaseSchemaEditor. rename_index ( model , old_index , new_index ) [source] ¶ Renames old_index from model ’s table to new_index . add_constraint() ¶ BaseDatabaseSchemaEditor. add_constraint ( model , constraint ) [source] ¶ Adds constraint to model ’s table. remove_constraint() ¶ BaseDatabaseSchemaEditor. remove_constraint ( model , constraint ) [source] ¶ Removes constraint from model ’s table. alter_unique_together() ¶ BaseDatabaseSchemaEditor. alter_unique_together ( model , old_unique_together , new_unique_together ) [source] ¶ Changes a model’s unique_together value; this\nwill add or remove unique constraints from the model’s table until they match\nthe new value. alter_index_together() ¶ BaseDatabaseSchemaEditor. alter_index_together ( model , old_index_together , new_index_together ) [source] ¶ Changes a model’s index_together value; this will add or remove indexes\nfrom the model’s table until they match the new value. alter_db_table() ¶ BaseDatabaseSchemaEditor. alter_db_table ( model , old_db_table , new_db_table ) [source] ¶ Renames the model’s table from old_db_table to new_db_table . alter_db_table_comment() ¶ BaseDatabaseSchemaEditor. alter_db_table_comment ( model , old_db_table_comment , new_db_table_comment ) [source] ¶ Change the model ’s table comment to new_db_table_comment . alter_db_tablespace() ¶ BaseDatabaseSchemaEditor. alter_db_tablespace ( model , old_db_tablespace , new_db_tablespace ) [source] ¶ Moves the model’s table from one tablespace to another. add_field() ¶ BaseDatabaseSchemaEditor. add_field ( model , field ) [source] ¶ Adds a column (or sometimes multiple) to the model’s table to represent the\nfield. This will also add indexes or a unique constraint\nif the field has db_index=True or unique=True . If the field is a ManyToManyField without a value for through , instead\nof creating a column, it will make a table to represent the relationship. If through is provided, it is a no-op. If the field is a ForeignKey , this will also add the foreign key\nconstraint to the column. remove_field() ¶ BaseDatabaseSchemaEditor. remove_field ( model , field ) [source] ¶ Removes the column(s) representing the field from the model’s table, along\nwith any unique constraints, foreign key constraints, or indexes caused by\nthat field. If the field is a ManyToManyField without a value for through , it will\nremove the table created to track the relationship. If through is provided, it is a no-op. alter_field() ¶ BaseDatabaseSchemaEditor. alter_field ( model , old_field , new_field , strict = False ) [source] ¶ This transforms the field on the model from the old field to the new one. This\nincludes changing the name of the column (the db_column attribute), changing the type of the\nfield (if the field class changes), changing the NULL status of the field,\nadding or removing field-only unique constraints and indexes, changing primary\nkey, and changing the destination of ForeignKey constraints. The most common transformation this cannot do is transforming a ManyToManyField into a normal Field or vice-versa; Django cannot do this\nwithout losing data, and so it will refuse to do it. Instead, remove_field() and add_field() should be called separately. If the database has the supports_combined_alters , Django will try and\ndo as many of these in a single database call as possible; otherwise, it will\nissue a separate ALTER statement for each change, but will not issue ALTERs\nwhere no change is required. Attributes ¶ All attributes should be considered read-only unless stated otherwise. connection ¶ SchemaEditor. connection ¶ A connection object to the database. A useful attribute of the connection is alias which can be used to determine the name of the database being\naccessed. This is useful when doing data migrations for migrations with multiple\ndatabases .", "keywords": ["mymodel", "moves", "indexes", "wrapper", "status", "lot", "alter_db_table_comment", "relational", "migration", "class", "field", "example", ".sql", "add_index", "column", "migrations", "databases", "schema_editor", "alter_field", "database", "table", "add_field", "version", "alters", "types", "model", "needs", "new_db_table", "change", "tablespace", "attributes", "django", "destination", "changes", "=", "capture", "relationship", "myisam", "syntax", "value", "developer", "source", "implementation", "add_constraint", "data", "null", "old_index", "use", "backend", "job", "layer", "alter_index_together", "supports_combined_alters", "type", "django.db.migrations", "db_index", "new_index_together", "remove_field", "removes", "schemaeditor", "file", "constraint", "old_db_table_comment", "connection.schema_editor", "order", "params", "remove_index", "alter", "user", "functionality", "key", "abstraction", "operations", "alias", "comment", "column(s", "attribute", "classes", "constraints", "transformation", "new_index", "statement", "rename_index", "db_column", "things", "transactions", "object", "connection", "vice", "context", "logic", "name", "manytomanyfield", "renames", "sql", "call", "foreignkey", "alter_db_tablespace", "execute", "old_db_tablespace", "create_model", "new_db_tablespace", "methods", "basedatabaseschemaeditor", "delete_model", "index", "manager", "op", "party", "¶", "parameters", "system", "cursors", "design", "no", "new_unique_together", "remove_constraint", "parts"], "type": "documentation"},
{"title": "Advanced testing topics | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/testing/advanced/", "content": "Advanced testing topics ¶ The request factory ¶ class RequestFactory [source] ¶ The RequestFactory shares the same API as\nthe test client. However, instead of behaving like a browser, the\nRequestFactory provides a way to generate a request instance that can\nbe used as the first argument to any view. This means you can test a\nview function the same way as you would test any other function – as\na black box, with exactly known inputs, testing for specific outputs. The API for the RequestFactory is a slightly\nrestricted subset of the test client API: It only has access to the HTTP methods get() , post() , put() , delete() , head() , options() , and trace() . These methods accept all the same arguments except for follow . Since this is just a factory for producing\nrequests, it’s up to you to handle the response. It does not support middleware. Session and authentication\nattributes must be supplied by the test itself if required\nfor the view to function properly. Changed in Django 5.1: The query_params parameter was added. Example ¶ The following is a unit test using the request factory: from django.contrib.auth.models import AnonymousUser , User from django.test import RequestFactory , TestCase from .views import MyView , my_view class SimpleTest ( TestCase ): def setUp ( self ): # Every test needs access to the request factory. self . factory = RequestFactory () self . user = User . objects . create_user ( username = \"jacob\" , email = \"jacob@…\" , password = \"top_secret\" ) def test_details ( self ): # Create an instance of a GET request. request = self . factory . get ( \"/customer/details\" ) # Recall that middleware are not supported. You can simulate a # logged-in user by setting request.user manually. request . user = self . user # Or you can simulate an anonymous user by setting request.user to # an AnonymousUser instance. request . user = AnonymousUser () # Test my_view() as if it were deployed at /customer/details response = my_view ( request ) # Use this syntax for class-based views. response = MyView . as_view ()( request ) self . assertEqual ( response . status_code , 200 ) AsyncRequestFactory ¶ class AsyncRequestFactory [source] ¶ RequestFactory creates WSGI-like requests. If you want to create ASGI-like\nrequests, including having a correct ASGI scope , you can instead use django.test.AsyncRequestFactory . This class is directly API-compatible with RequestFactory , with the only\ndifference being that it returns ASGIRequest instances rather than WSGIRequest instances. All of its methods are still synchronous callables. Arbitrary keyword arguments in defaults are added directly into the ASGI\nscope. Changed in Django 5.1: The query_params parameter was added. Testing class-based views ¶ In order to test class-based views outside of the request/response cycle you\nmust ensure that they are configured correctly, by calling setup() after instantiation. For example, assuming the following class-based view: views.py ¶ from django.views.generic import TemplateView class HomeView ( TemplateView ): template_name = \"myapp/home.html\" def get_context_data ( self , ** kwargs ): kwargs [ \"environment\" ] = \"Production\" return super () . get_context_data ( ** kwargs ) You may directly test the get_context_data() method by first instantiating\nthe view, then passing a request to setup() , before proceeding with\nyour test’s code: tests.py ¶ from django.test import RequestFactory , TestCase from .views import HomeView class HomePageTest ( TestCase ): def test_environment_set_in_context ( self ): request = RequestFactory () . get ( \"/\" ) view = HomeView () view . setup ( request ) context = view . get_context_data () self . assertIn ( \"environment\" , context ) Tests and multiple host names ¶ The ALLOWED_HOSTS setting is validated when running tests. This\nallows the test client to differentiate between internal and external URLs. Projects that support multitenancy or otherwise alter business logic based on\nthe request’s host and use custom host names in tests must include those hosts\nin ALLOWED_HOSTS . The first option to do so is to add the hosts to your settings file. For\nexample, the test suite for docs.djangoproject.com includes the following: from django.test import TestCase class SearchFormTestCase ( TestCase ): def test_empty_get ( self ): response = self . client . get ( \"/en/dev/search/\" , headers = { \"host\" : \"docs.djangoproject.dev:8000\" }, ) self . assertEqual ( response . status_code , 200 ) and the settings file includes a list of the domains supported by the project: ALLOWED_HOSTS = [ \"www.djangoproject.dev\" , \"docs.djangoproject.dev\" , ... ] Another option is to add the required hosts to ALLOWED_HOSTS using override_settings() or modify_settings() . This option may be\npreferable in standalone apps that can’t package their own settings file or\nfor projects where the list of domains is not static (e.g., subdomains for\nmultitenancy). For example, you could write a test for the domain http://otherserver/ as follows: from django.test import TestCase , override_settings class MultiDomainTestCase ( TestCase ): @override_settings ( ALLOWED_HOSTS = [ \"otherserver\" ]) def test_other_domain ( self ): response = self . client . get ( \"http://otherserver/foo/bar/\" ) Disabling ALLOWED_HOSTS checking ( ALLOWED_HOSTS = ['*'] ) when\nrunning tests prevents the test client from raising a helpful error message if\nyou follow a redirect to an external URL. Tests and multiple databases ¶ Testing primary/replica configurations ¶ If you’re testing a multiple database configuration with primary/replica\n(referred to as master/slave by some databases) replication, this strategy of\ncreating test databases poses a problem.\nWhen the test databases are created, there won’t be any replication,\nand as a result, data created on the primary won’t be seen on the\nreplica. To compensate for this, Django allows you to define that a database is\na test mirror . Consider the following (simplified) example database\nconfiguration: DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.mysql\" , \"NAME\" : \"myproject\" , \"HOST\" : \"dbprimary\" , # ... plus some other settings }, \"replica\" : { \"ENGINE\" : \"django.db.backends.mysql\" , \"NAME\" : \"myproject\" , \"HOST\" : \"dbreplica\" , \"TEST\" : { \"MIRROR\" : \"default\" , }, # ... plus some other settings }, } In this setup, we have two database servers: dbprimary , described\nby the database alias default , and dbreplica described by the\nalias replica . As you might expect, dbreplica has been configured\nby the database administrator as a read replica of dbprimary , so in\nnormal activity, any write to default will appear on replica . If Django created two independent test databases, this would break any\ntests that expected replication to occur. However, the replica database has been configured as a test mirror (using the MIRROR test setting), indicating that under\ntesting, replica should be treated as a mirror of default . When the test environment is configured, a test version of replica will not be created. Instead the connection to replica will be redirected to point at default . As a result, writes to default will appear on replica – but because they are actually\nthe same database, not because there is data replication between the\ntwo databases. As this depends on transactions, the tests must use TransactionTestCase instead of TestCase . Controlling creation order for test databases ¶ By default, Django will assume all databases depend on the default database and therefore always create the default database first.\nHowever, no guarantees are made on the creation order of any other\ndatabases in your test setup. If your database configuration requires a specific creation order, you\ncan specify the dependencies that exist using the DEPENDENCIES test setting. Consider the following (simplified)\nexample database configuration: DATABASES = { \"default\" : { # ... db settings \"TEST\" : { \"DEPENDENCIES\" : [ \"diamonds\" ], }, }, \"diamonds\" : { # ... db settings \"TEST\" : { \"DEPENDENCIES\" : [], }, }, \"clubs\" : { # ... db settings \"TEST\" : { \"DEPENDENCIES\" : [ \"diamonds\" ], }, }, \"spades\" : { # ... db settings \"TEST\" : { \"DEPENDENCIES\" : [ \"diamonds\" , \"hearts\" ], }, }, \"hearts\" : { # ... db settings \"TEST\" : { \"DEPENDENCIES\" : [ \"diamonds\" , \"clubs\" ], }, }, } Under this configuration, the diamonds database will be created first,\nas it is the only database alias without dependencies. The default and clubs alias will be created next (although the order of creation of this\npair is not guaranteed), then hearts , and finally spades . If there are any circular dependencies in the DEPENDENCIES definition, an ImproperlyConfigured exception will be raised. Advanced features of TransactionTestCase ¶ TransactionTestCase. available_apps ¶ Warning This attribute is a private API. It may be changed or removed without\na deprecation period in the future, for instance to accommodate changes\nin application loading. It’s used to optimize Django’s own test suite, which contains hundreds\nof models but no relations between models in different applications. By default, available_apps is set to None . After each test, Django\ncalls flush to reset the database state. This empties all tables\nand emits the post_migrate signal, which\nrecreates one content type and four permissions for each model. This\noperation gets expensive proportionally to the number of models. Setting available_apps to a list of applications instructs Django to\nbehave as if only the models from these applications were available. The\nbehavior of TransactionTestCase changes as follows: post_migrate is fired before each\ntest to create the content types and permissions for each model in\navailable apps, in case they’re missing. After each test, Django empties only tables corresponding to models in\navailable apps. However, at the database level, truncation may cascade to\nrelated models in unavailable apps. Furthermore post_migrate isn’t fired; it will be\nfired by the next TransactionTestCase , after the correct set of\napplications is selected. Since the database isn’t fully flushed, if a test creates instances of\nmodels not included in available_apps , they will leak and they may\ncause unrelated tests to fail. Be careful with tests that use sessions;\nthe default session engine stores them in the database. Since post_migrate isn’t emitted after\nflushing the database, its state after a TransactionTestCase isn’t the\nsame as after a TestCase : it’s missing the rows created by listeners\nto post_migrate . Considering the order in which tests are executed , this isn’t an\nissue, provided either all TransactionTestCase in a given test suite\ndeclare available_apps , or none of them. available_apps is mandatory in Django’s own test suite. TransactionTestCase. reset_sequences ¶ Setting reset_sequences = True on a TransactionTestCase will make\nsure sequences are always reset before the test run: class TestsThatDependsOnPrimaryKeySequences ( TransactionTestCase ): reset_sequences = True def test_animal_pk ( self ): lion = Animal . objects . create ( name = \"lion\" , sound = \"roar\" ) # lion.pk is guaranteed to always be 1 self . assertEqual ( lion . pk , 1 ) Unless you are explicitly testing primary keys sequence numbers, it is\nrecommended that you do not hard code primary key values in tests. Using reset_sequences = True will slow down the test, since the primary\nkey reset is a relatively expensive database operation. Enforce running test classes sequentially ¶ If you have test classes that cannot be run in parallel (e.g. because they\nshare a common resource), you can use django.test.testcases.SerializeMixin to run them sequentially. This mixin uses a filesystem lockfile . For example, you can use __file__ to determine that all test classes in the\nsame file that inherit from SerializeMixin will run sequentially: import os from django.test import TestCase from django.test.testcases import SerializeMixin class ImageTestCaseMixin ( SerializeMixin ): lockfile = __file__ def setUp ( self ): self . filename = os . path . join ( temp_storage_dir , \"my_file.png\" ) self . file = create_file ( self . filename ) class RemoveImageTests ( ImageTestCaseMixin , TestCase ): def test_remove_image ( self ): os . remove ( self . filename ) self . assertFalse ( os . path . exists ( self . filename )) class ResizeImageTests ( ImageTestCaseMixin , TestCase ): def test_resize_image ( self ): resize_image ( self . file , ( 48 , 48 )) self . assertEqual ( get_image_size ( self . file ), ( 48 , 48 )) Using the Django test runner to test reusable applications ¶ If you are writing a reusable application you may want to use the Django test runner to run your own test suite\nand thus benefit from the Django testing infrastructure. A common practice is a tests directory next to the application code, with the\nfollowing structure: runtests.py\npolls/\n    __init__.py\n    models.py\n    ...\ntests/\n    __init__.py\n    models.py\n    test_settings.py\n    tests.py Let’s take a look inside a couple of those files: runtests.py ¶ #!/usr/bin/env python import os import sys import django from django.conf import settings from django.test.utils import get_runner if __name__ == \"__main__\" : os . environ [ \"DJANGO_SETTINGS_MODULE\" ] = \"tests.test_settings\" django . setup () TestRunner = get_runner ( settings ) test_runner = TestRunner () failures = test_runner . run_tests ([ \"tests\" ]) sys . exit ( bool ( failures )) This is the script that you invoke to run the test suite. It sets up the\nDjango environment, creates the test database and runs the tests. For the sake of clarity, this example contains only the bare minimum\nnecessary to use the Django test runner. You may want to add\ncommand-line options for controlling verbosity, passing in specific test\nlabels to run, etc. tests/test_settings.py ¶ SECRET_KEY = \"fake-key\" INSTALLED_APPS = [ \"tests\" , ] This file contains the Django settings required to run your app’s tests. Again, this is a minimal example; your tests may require additional\nsettings to run. Since the tests package is included in INSTALLED_APPS when\nrunning your tests, you can define test-only models in its models.py file. Using different testing frameworks ¶ Clearly, unittest is not the only Python testing framework. While Django\ndoesn’t provide explicit support for alternative frameworks, it does provide a\nway to invoke tests constructed for an alternative framework as if they were\nnormal Django tests. When you run ./manage.py test , Django looks at the TEST_RUNNER setting to determine what to do. By default, TEST_RUNNER points to 'django.test.runner.DiscoverRunner' . This class defines the default Django\ntesting behavior. This behavior involves: Performing global pre-test setup. Looking for tests in any file below the current directory whose name matches\nthe pattern test*.py . Creating the test databases. Running migrate to install models and initial data into the test\ndatabases. Running the system checks . Running the tests that were found. Destroying the test databases. Performing global post-test teardown. If you define your own test runner class and point TEST_RUNNER at\nthat class, Django will execute your test runner whenever you run ./manage.py test . In this way, it is possible to use any test framework\nthat can be executed from Python code, or to modify the Django test execution\nprocess to satisfy whatever testing requirements you may have. Defining a test runner ¶ A test runner is a class defining a run_tests() method. Django ships\nwith a DiscoverRunner class that defines the default Django testing\nbehavior. This class defines the run_tests() entry point, plus a\nselection of other methods that are used by run_tests() to set up, execute\nand tear down the test suite. class DiscoverRunner ( pattern = 'test*.py' , top_level = None , verbosity = 1 , interactive = True , failfast = False , keepdb = False , reverse = False , debug_mode = False , debug_sql = False , parallel = 0 , tags = None , exclude_tags = None , test_name_patterns = None , pdb = False , buffer = False , enable_faulthandler = True , timing = True , shuffle = False , logger = None , durations = None , ** kwargs ) [source] ¶ DiscoverRunner will search for tests in any file matching pattern . top_level can be used to specify the directory containing your\ntop-level Python modules. Usually Django can figure this out automatically,\nso it’s not necessary to specify this option. If specified, it should\ngenerally be the directory containing your manage.py file. verbosity determines the amount of notification and debug information\nthat will be printed to the console; 0 is no output, 1 is normal\noutput, and 2 is verbose output. If interactive is True , the test suite has permission to ask the\nuser for instructions when the test suite is executed. An example of this\nbehavior would be asking for permission to delete an existing test\ndatabase. If interactive is False , the test suite must be able to\nrun without any manual intervention. If failfast is True , the test suite will stop running after the\nfirst test failure is detected. If keepdb is True , the test suite will use the existing database,\nor create one if necessary. If False , a new database will be created,\nprompting the user to remove the existing one, if present. If reverse is True , test cases will be executed in the opposite\norder. This could be useful to debug tests that aren’t properly isolated\nand have side effects. Grouping by test class is\npreserved when using this option. This option can be used in conjunction\nwith --shuffle to reverse the order for a particular random seed. debug_mode specifies what the DEBUG setting should be\nset to prior to running tests. parallel specifies the number of processes.  If parallel is greater\nthan 1 , the test suite will run in parallel processes. If there are\nfewer test case classes than configured processes, Django will reduce the\nnumber of processes accordingly. Each process gets its own database. This\noption requires the third-party tblib package to display tracebacks\ncorrectly. tags can be used to specify a set of tags for filtering tests . May be combined with exclude_tags . exclude_tags can be used to specify a set of tags for excluding tests . May be combined\nwith tags . If debug_sql is True , failing test cases will output SQL queries\nlogged to the django.db.backends logger as well\nas the traceback. If verbosity is 2 , then queries in all tests are\noutput. test_name_patterns can be used to specify a set of patterns for\nfiltering test methods and classes by their names. If pdb is True , a debugger ( pdb or ipdb ) will be spawned at\neach test error or failure. If buffer is True , outputs from passing tests will be discarded. If enable_faulthandler is True , faulthandler will be\nenabled. If timing is True , test timings, including database setup and total\nrun time, will be shown. If shuffle is an integer, test cases will be shuffled in a random order\nprior to execution, using the integer as a random seed. If shuffle is None , the seed will be generated randomly. In both cases, the seed will\nbe logged and set to self.shuffle_seed prior to running tests. This\noption can be used to help detect tests that aren’t properly isolated. Grouping by test class is preserved when using this\noption. logger can be used to pass a Python Logger object .\nIf provided, the logger will be used to log messages instead of printing to\nthe console. The logger object will respect its logging level rather than\nthe verbosity . durations will show a list of the N slowest test cases. Setting this\noption to 0 will result in the duration for all tests being shown.\nRequires Python 3.12+. Django may, from time to time, extend the capabilities of the test runner\nby adding new arguments. The **kwargs declaration allows for this\nexpansion. If you subclass DiscoverRunner or write your own test\nrunner, ensure it accepts **kwargs . Your test runner may also define additional command-line options.\nCreate or override an add_arguments(cls, parser) class method and add\ncustom arguments by calling parser.add_argument() inside the method, so\nthat the test command will be able to use those arguments. New in Django 5.0: The durations argument was added. Attributes ¶ DiscoverRunner. test_suite ¶ The class used to build the test suite. By default it is set to unittest.TestSuite . This can be overridden if you wish to implement\ndifferent logic for collecting tests. DiscoverRunner. test_runner ¶ This is the class of the low-level test runner which is used to execute\nthe individual tests and format the results. By default it is set to unittest.TextTestRunner . Despite the unfortunate similarity in\nnaming conventions, this is not the same type of class as DiscoverRunner , which covers a broader set of responsibilities. You\ncan override this attribute to modify the way tests are run and reported. DiscoverRunner. test_loader ¶ This is the class that loads tests, whether from TestCases or modules or\notherwise and bundles them into test suites for the runner to execute.\nBy default it is set to unittest.defaultTestLoader . You can override\nthis attribute if your tests are going to be loaded in unusual ways. Methods ¶ DiscoverRunner. run_tests ( test_labels , ** kwargs ) [source] ¶ Run the test suite. test_labels allows you to specify which tests to run and supports\nseveral formats (see DiscoverRunner.build_suite() for a list of\nsupported formats). This method should return the number of tests that failed. classmethod DiscoverRunner. add_arguments ( parser ) [source] ¶ Override this class method to add custom arguments accepted by the test management command. See argparse.ArgumentParser.add_argument() for details about adding\narguments to a parser. DiscoverRunner. setup_test_environment ( ** kwargs ) [source] ¶ Sets up the test environment by calling setup_test_environment() and setting DEBUG to self.debug_mode (defaults to False ). DiscoverRunner. build_suite ( test_labels = None , ** kwargs ) [source] ¶ Constructs a test suite that matches the test labels provided. test_labels is a list of strings describing the tests to be run. A test\nlabel can take one of four forms: path.to.test_module.TestCase.test_method – Run a single test method\nin a test case class. path.to.test_module.TestCase – Run all the test methods in a test\ncase. path.to.module – Search for and run all tests in the named Python\npackage or module. path/to/directory – Search for and run all tests below the named\ndirectory. If test_labels has a value of None , the test runner will search for\ntests in all files below the current directory whose names match its pattern (see above). Returns a TestSuite instance ready to be run. DiscoverRunner. setup_databases ( ** kwargs ) [source] ¶ Creates the test databases by calling setup_databases() . DiscoverRunner. run_checks ( databases ) [source] ¶ Runs the system checks on the test databases . DiscoverRunner. run_suite ( suite , ** kwargs ) [source] ¶ Runs the test suite. Returns the result produced by the running the test suite. DiscoverRunner. get_test_runner_kwargs () [source] ¶ Returns the keyword arguments to instantiate the DiscoverRunner.test_runner with. DiscoverRunner. teardown_databases ( old_config , ** kwargs ) [source] ¶ Destroys the test databases, restoring pre-test conditions by calling teardown_databases() . DiscoverRunner. teardown_test_environment ( ** kwargs ) [source] ¶ Restores the pre-test environment. DiscoverRunner. suite_result ( suite , result , ** kwargs ) [source] ¶ Computes and returns a return code based on a test suite, and the result\nfrom that test suite. DiscoverRunner. log ( msg , level = None ) [source] ¶ If a logger is set, logs the message at the given integer logging level (e.g. logging.DEBUG , logging.INFO , or logging.WARNING ). Otherwise, the message is printed to the console,\nrespecting the current verbosity . For example, no message will be\nprinted if the verbosity is 0, INFO and above will be printed if\nthe verbosity is at least 1, and DEBUG will be printed if it is at\nleast 2. The level defaults to logging.INFO . Testing utilities ¶ django.test.utils ¶ To assist in the creation of your own test runner, Django provides a number of\nutility methods in the django.test.utils module. setup_test_environment ( debug = None ) [source] ¶ Performs global pre-test setup, such as installing instrumentation for the\ntemplate rendering system and setting up the dummy email outbox. If debug isn’t None , the DEBUG setting is updated to its\nvalue. teardown_test_environment () [source] ¶ Performs global post-test teardown, such as removing instrumentation from\nthe template system and restoring normal email services. setup_databases ( verbosity , interactive , * , time_keeper = None , keepdb = False , debug_sql = False , parallel = 0 , aliases = None , serialized_aliases = None , ** kwargs ) [source] ¶ Creates the test databases. Returns a data structure that provides enough detail to undo the changes\nthat have been made. This data will be provided to the teardown_databases() function at the conclusion of testing. The aliases argument determines which DATABASES aliases test\ndatabases should be set up for. If it’s not provided, it defaults to all of DATABASES aliases. The serialized_aliases argument determines what subset of aliases test databases should have their state serialized to allow usage of the serialized_rollback feature. If\nit’s not provided, it defaults to aliases . teardown_databases ( old_config , parallel = 0 , keepdb = False ) [source] ¶ Destroys the test databases, restoring pre-test conditions. old_config is a data structure defining the changes in the database\nconfiguration that need to be reversed. It’s the return value of the setup_databases() method. django.db.connection.creation ¶ The creation module of the database backend also provides some utilities that\ncan be useful during testing. create_test_db ( verbosity = 1 , autoclobber = False , serialize = True , keepdb = False ) ¶ Creates a new test database and runs migrate against it. verbosity has the same behavior as in run_tests() . autoclobber describes the behavior that will occur if a\ndatabase with the same name as the test database is discovered: If autoclobber is False , the user will be asked to\napprove destroying the existing database. sys.exit is\ncalled if the user does not approve. If autoclobber is True , the database will be destroyed\nwithout consulting the user. serialize determines if Django serializes the database into an\nin-memory JSON string before running tests (used to restore the database\nstate between tests if you don’t have transactions). You can set this to False to speed up creation time if you don’t have any test classes\nwith serialized_rollback=True . keepdb determines if the test run should use an existing\ndatabase, or create a new one. If True , the existing\ndatabase will be used, or created if not present. If False ,\na new database will be created, prompting the user to remove\nthe existing one, if present. Returns the name of the test database that it created. create_test_db() has the side effect of modifying the value of NAME in DATABASES to match the name of the test\ndatabase. destroy_test_db ( old_database_name , verbosity = 1 , keepdb = False ) ¶ Destroys the database whose name is the value of NAME in DATABASES , and sets NAME to the value of old_database_name . The verbosity argument has the same behavior as for DiscoverRunner . If the keepdb argument is True , then the connection to the\ndatabase will be closed, but the database will not be destroyed. Integration with coverage.py ¶ Code coverage describes how much source code has been tested. It shows which\nparts of your code are being exercised by tests and which are not. It’s an\nimportant part of testing applications, so it’s strongly recommended to check\nthe coverage of your tests. Django can be easily integrated with coverage.py , a tool for measuring code\ncoverage of Python programs. First, install coverage . Next, run the\nfollowing from your project folder containing manage.py : coverage run --source = '.' manage.py test myapp This runs your tests and collects coverage data of the executed files in your\nproject. You can see a report of this data by typing following command: coverage report Note that some Django code was executed while running tests, but it is not\nlisted here because of the source flag passed to the previous command. For more options like annotated HTML listings detailing missed lines, see the coverage.py docs.", "keywords": ["run_tests", "box", "rows", "feature", "pattern", "selection", "messages", "self.debug_mode", "available_apps", "activity", "#", "faulthandler", "runner", "+", "numbers", "host", "animal", "lines", "wsgirequest", "subset", "serializemixin", "tool", "suite", "asgirequest", "label", "truncation", "http", "=", "changes", "mirror", "results", "head", "engine", "message", "get_test_runner_kwargs", "inputs", "pdb", "setup", "serialized_aliases", "tables", "filesystem", "reset_sequences", "process", "debug", "assertin", "declare", "test_labels", "following", "django.db.backends.mysql", "type", "coverage.py", "custom", "kwargs", "objects", "write", "hundreds", "discoverrunner", "file", "views.py", "modules", "test_resize_image", "temp_storage_dir", "strategy", "user", "lion", "cases", "conclusion", "attribute", "/en", "removeimagetests", "tests.test_settings", "warning", "time", "inherit", "tags", "install", "otherserver", "enforce", "setting", "tracebacks", "password", "logic", "name", "parameter", "test_runner", "spades", "execution", "as_view", "home.html", "issue", "create_file", "jacob", "queries", "lockfile", "notification", "run_checks", "configurations", "override_settings", "return", "debug_sql", "reverse", "applications", "memory", "foo", "timing", "duration", "failure", "callables", "username", "aliases", "bool", "join", "url", "guarantees", "error", "conditions", "module", "code", "classmethod", "subdomains", "period", "post_migrate", "false", "behavior", "info", "access", "class", "test_other_domain", "teardown_test_environment", "returns", "names", "'", "roar", "request", "database", "flag", "output", "business", "docs.djangoproject.dev", "*", "signal", "hosts", "test", "intervention", "migrate", "types", "strings", "creation", "parser.add_argument", "suite_result", "pair", "hearts", "mixin", "usage", "sequences", "transactiontestcase", "restores", "wsgi", "configuration", "script", "setup_test_environment", "test_settings.py", "instantiation", "path.to.module", "running", "sake", "follow", "source", "sequence", "ipdb", "imagetestcasemixin", "add_arguments(cls", "environment", "diamonds", "my_file.png", "operation", "order", "test_details", "default", "alias", "option", "failfast", "classes", "tests", "environ", "get_runner", "self.shuffle_seed", "@override_settings", "domains", "template", "traceback", "way", "frameworks", "console", "formats", "checks", "servers", "party", "status_code", "integer", "session", "¶", "sound", "command", "post", "services", "get_context_data", "side", "suites", "exclude_tags", "content", "primary", "function", "views", "replication", "testing", "result", "view", "run", "django.db.connection.creation", "number", "relations", "permissions", "def", "point", "values", "failures", "durations", "jacob@", "tblib", "string", "_", "debugger", "env", "databases", "timings", "unit", "setup_databases", "homeview", "models", "exit", "version", "ways", "level", "json", "anonymoususer", "loading", "multitenancy", "listings", "labels", "autoclobber", "deprecation", "create_test_db", "parser", "minimum", "requestfactory", "django", "test_environment_set_in_context", "myapp", "n’t", "filename", "shuffle", "utilities", "entry", "set", "keepdb", "os", "resize_image", "override", "practice", "value", "modify_settings", "line", "improperlyconfigured", "data", "browser", "scope", "backend", "declaration", "path.to.test_module", "self", "master", "instance", "outputs", "effects", "buffer", "testsuite", "responsibilities", "report", "discoverrunner.test_runner", "trace", "coverage", "docs", "old_database_name", "searchformtestcase", "add_arguments", "bar/", "instances", "test_animal_pk", "structure", "checking", "installed_apps", "part", "test_empty_get", "object", "teardown_databases", "couple", "domain", "teardown", "response", "management", "sys", "instructions", "sql", "utility", "requests", "reset", "rendering", "keyword", "naming", "logger", "asyncrequestfactory", "integration", "redirect", "teststhatdependsonprimarykeysequences", "effect", "request.user", "detail", "system", "apps", "dependencies", "filtering", "top_level", "production", "discoverrunner.build_suite", "programs", "definition", "headers", "processes", "difference", "features", "forms", "’s", "example", "test_remove_image", "app", "parallel", "requirements", "list", "empties", "topics", "email", "resizeimagetests", "testcase.test_method", "read", "model", "testcases", "old_config", "templateview", "application", "bin", "django.contrib.auth.models", "attributes", "debug_mode", "testcase", "simpletest", "asgi", "dev", "seed", "testrunner", "clarity", "syntax", "http://otherserver/", "capabilities", "log", "keys", "case", "authentication", "query_params", "conjunction", "look", "html", "future", "factory", "arguments", "conventions", "time_keeper", "package", "middleware", "run_suite", "one", "multidomaintestcase", "dbreplica", "administrator", "msg", "myview", "matching", "verbosity", "secret_key", "amount", "texttestrunner", "computes", "path", "docs.djangoproject.com", "key", "my_view", "none", "problem", "specifies", "clubs", "get", "patterns", "test*.py", "infrastructure", "logging", "django.test.utils", "replica", "framework", "similarity", "test_name_patterns", "urls", "api", "sessions", "support", "projects", "outbox", "transactions", "serialized_rollback", "connection", "context", "cycle", "permission", "import", "files", "directory", "defaults", "pk", "information", "python", "django.test.runner", "methods", "options", "django.test.testcases", "exception", "resource", "client", "details", "method", "listeners", "settings", "ships", "argument", "slave", "folder", "state", "instrumentation", "expansion", "sys.exit", "project", "parts"], "type": "documentation"},
{"title": "How to create custom django-admin commands | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/custom-management-commands/", "content": "How to create custom django-admin commands ¶ Applications can register their own actions with manage.py . For example,\nyou might want to add a manage.py action for a Django app that you’re\ndistributing. In this document, we will be building a custom closepoll command for the polls application from the tutorial . To do this, add a management/commands directory to the application. Django\nwill register a manage.py command for each Python module in that directory\nwhose name doesn’t begin with an underscore. For example: polls/\n    __init__.py\n    models.py\n    management/\n        __init__.py\n        commands/\n            __init__.py\n            _private.py\n            closepoll.py\n    tests.py\n    views.py In this example, the closepoll command will be made available to any project\nthat includes the polls application in INSTALLED_APPS . The _private.py module will not be available as a management command. The closepoll.py module has only one requirement – it must define a class Command that extends BaseCommand or one of its subclasses . Standalone scripts Custom management commands are especially useful for running standalone\nscripts or for scripts that are periodically executed from the UNIX crontab\nor from Windows scheduled tasks control panel. To implement the command, edit polls/management/commands/closepoll.py to\nlook like this: from django.core.management.base import BaseCommand , CommandError from polls.models import Question as Poll class Command ( BaseCommand ): help = \"Closes the specified poll for voting\" def add_arguments ( self , parser ): parser . add_argument ( \"poll_ids\" , nargs = \"+\" , type = int ) def handle ( self , * args , ** options ): for poll_id in options [ \"poll_ids\" ]: try : poll = Poll . objects . get ( pk = poll_id ) except Poll . DoesNotExist : raise CommandError ( 'Poll \" %s \" does not exist' % poll_id ) poll . opened = False poll . save () self . stdout . write ( self . style . SUCCESS ( 'Successfully closed poll \" %s \"' % poll_id ) ) Note When you are using management commands and wish to provide console\noutput, you should write to self.stdout and self.stderr ,\ninstead of printing to stdout and stderr directly. By\nusing these proxies, it becomes much easier to test your custom\ncommand. Note also that you don’t need to end messages with a newline\ncharacter, it will be added automatically, unless you specify the ending parameter: self . stdout . write ( \"Unterminated line\" , ending = \"\" ) The new custom command can be called using python manage.py closepoll <poll_ids> . The handle() method takes one or more poll_ids and sets poll.opened to False for each one. If the user referenced any nonexistent polls, a CommandError is raised. The poll.opened attribute does not exist in\nthe tutorial and was added to polls.models.Question for this example. Accepting optional arguments ¶ The same closepoll could be easily modified to delete a given poll instead\nof closing it by accepting additional command line options. These custom\noptions can be added in the add_arguments() method like this: class Command ( BaseCommand ): def add_arguments ( self , parser ): # Positional arguments parser . add_argument ( \"poll_ids\" , nargs = \"+\" , type = int ) # Named (optional) arguments parser . add_argument ( \"--delete\" , action = \"store_true\" , help = \"Delete poll instead of closing it\" , ) def handle ( self , * args , ** options ): # ... if options [ \"delete\" ]: poll . delete () # ... The option ( delete in our example) is available in the options dict\nparameter of the handle method. See the argparse Python documentation\nfor more about add_argument usage. In addition to being able to add custom command line options, all management commands can accept some default options\nsuch as --verbosity and --traceback . Management commands and locales ¶ By default, management commands are executed with the current active locale. If, for some reason, your custom management command must run without an active\nlocale (for example, to prevent translated content from being inserted into\nthe database), deactivate translations using the @no_translations decorator on your handle() method: from django.core.management.base import BaseCommand , no_translations class Command ( BaseCommand ): ... @no_translations def handle ( self , * args , ** options ): ... Since translation deactivation requires access to configured settings, the\ndecorator can’t be used for commands that work without configured settings. Testing ¶ Information on how to test custom management commands can be found in the testing docs . Overriding commands ¶ Django registers the built-in commands and then searches for commands in INSTALLED_APPS in reverse. During the search, if a command name\nduplicates an already registered command, the newly discovered command\noverrides the first. In other words, to override a command, the new command must have the same name\nand its app must be before the overridden command’s app in INSTALLED_APPS . Management commands from third-party apps that have been unintentionally\noverridden can be made available under a new name by creating a new command in\none of your project’s apps (ordered before the third-party app in INSTALLED_APPS ) which imports the Command of the overridden\ncommand. Command objects ¶ class BaseCommand [source] ¶ The base class from which all management commands ultimately derive. Use this class if you want access to all of the mechanisms which\nparse the command-line arguments and work out what code to call in\nresponse; if you don’t need to change any of that behavior,\nconsider using one of its subclasses . Subclassing the BaseCommand class requires that you implement the handle() method. Attributes ¶ All attributes can be set in your derived class and can be used in BaseCommand ’s subclasses . BaseCommand. help ¶ A short description of the command, which will be printed in the\nhelp message when the user runs the command python manage.py help <command> . BaseCommand. missing_args_message ¶ If your command defines mandatory positional arguments, you can customize\nthe message error returned in the case of missing arguments. The default is\noutput by argparse (“too few arguments”). BaseCommand. output_transaction ¶ A boolean indicating whether the command outputs SQL statements; if True , the output will automatically be wrapped with BEGIN; and COMMIT; . Default value is False . BaseCommand. requires_migrations_checks ¶ A boolean; if True , the command prints a warning if the set of\nmigrations on disk don’t match the migrations in the database. A warning\ndoesn’t prevent the command from executing. Default value is False . BaseCommand. requires_system_checks ¶ A list or tuple of tags, e.g. [Tags.staticfiles, Tags.models] . System\nchecks registered in the chosen tags will be checked for errors prior to executing the command. The value '__all__' can be used to specify that all system checks should be\nperformed. Default value is '__all__' . BaseCommand. style ¶ An instance attribute that helps create colored output when writing to stdout or stderr . For example: self . stdout . write ( self . style . SUCCESS ( \"...\" )) See Syntax coloring to learn how to modify the color palette and to\nsee the available styles (use uppercased versions of the “roles” described\nin that section). If you pass the --no-color option when running your command, all self.style() calls will return the original string uncolored. BaseCommand. suppressed_base_arguments ¶ The default command options to suppress in the help output. This should be\na set of option names (e.g. '--verbosity' ). The default values for the\nsuppressed options are still passed. Methods ¶ BaseCommand has a few methods that can be overridden but only\nthe handle() method must be implemented. Implementing a constructor in a subclass If you implement __init__ in your subclass of BaseCommand ,\nyou must call BaseCommand ’s __init__ : class Command ( BaseCommand ): def __init__ ( self , * args , ** kwargs ): super () . __init__ ( * args , ** kwargs ) # ... BaseCommand. create_parser ( prog_name , subcommand , ** kwargs ) [source] ¶ Returns a CommandParser instance, which is an ArgumentParser subclass with a few customizations for\nDjango. You can customize the instance by overriding this method and calling super() with kwargs of ArgumentParser parameters. BaseCommand. add_arguments ( parser ) [source] ¶ Entry point to add parser arguments to handle command line arguments passed\nto the command. Custom commands should override this method to add both\npositional and optional arguments accepted by the command. Calling super() is not needed when directly subclassing BaseCommand . BaseCommand. get_version () [source] ¶ Returns the Django version, which should be correct for all built-in Django\ncommands. User-supplied commands can override this method to return their\nown version. BaseCommand. execute ( * args , ** options ) [source] ¶ Tries to execute this command, performing system checks if needed (as\ncontrolled by the requires_system_checks attribute). If the command\nraises a CommandError , it’s intercepted and printed to stderr . Calling a management command in your code execute() should not be called directly from your code to execute a\ncommand. Use call_command() instead. BaseCommand. handle ( * args , ** options ) [source] ¶ The actual logic of the command. Subclasses must implement this method. It may return a string which will be printed to stdout (wrapped\nby BEGIN; and COMMIT; if output_transaction is True ). BaseCommand. check ( app_configs = None , tags = None , display_num_errors = False , include_deployment_checks = False , fail_level = checks.ERROR , databases = None ) [source] ¶ Uses the system check framework to inspect the entire Django project for\npotential problems. Serious problems are raised as a CommandError ;\nwarnings are output to stderr ; minor notifications are output to stdout . If app_configs and tags are both None , all system checks are\nperformed except deployment and database related checks. tags can be a\nlist of check tags, like compatibility or models . You can pass include_deployment_checks=True to also perform deployment\nchecks, and list of database aliases in the databases to run database\nrelated checks against them. BaseCommand subclasses ¶ class AppCommand ¶ A management command which takes one or more installed application labels as\narguments, and does something with each of them. Rather than implementing handle() , subclasses must\nimplement handle_app_config() , which will be called once for\neach application. AppCommand. handle_app_config ( app_config , ** options ) ¶ Perform the command’s actions for app_config , which will be an AppConfig instance corresponding to an application\nlabel given on the command line. class LabelCommand ¶ A management command which takes one or more arbitrary arguments (labels) on\nthe command line, and does something with each of them. Rather than implementing handle() , subclasses must implement handle_label() , which will be called once for each label. LabelCommand. label ¶ A string describing the arbitrary arguments passed to the command. The\nstring is used in the usage text and error messages of the command.\nDefaults to 'label' . LabelCommand. handle_label ( label , ** options ) ¶ Perform the command’s actions for label , which will be the string as\ngiven on the command line. Command exceptions ¶ exception CommandError ( returncode = 1 ) [source] ¶ Exception class indicating a problem while executing a management command. If this exception is raised during the execution of a management command from a\ncommand line console, it will be caught and turned into a nicely-printed error\nmessage to the appropriate output stream (i.e., stderr ); as a result,\nraising this exception (with a sensible description of the error) is the\npreferred way to indicate that something has gone wrong in the execution of a\ncommand. It accepts the optional returncode argument to customize the exit\nstatus for the management command to exit with, using sys.exit() . If a management command is called from code through call_command() , it’s up to you to catch the\nexception when needed.", "keywords": ["question", "testing", "result", "color", "control", "commanderror", "status", "aliases", "prog_name", "messages", "error", "app_config", "module", "check", "code", "point", "values", "roles", "style", "false", "behavior", "addition", "class", "example", "@no_translations", "#", "access", "app", "windows", "_", "unix", "suppressed_base_arguments", "list", "warnings", "migrations", "returns", "names", "'", "polls.models", "palette", "databases", "create_parser", "handle_app_config", "database", "poll", "output", "action", "labelcommand", "*", "models", "commands", "exit", "version", "compatibility", "locales", "words", "subclass", "admin", "scripts", "commandparser", "application", "labels", "actions", "usage", "attributes", "label", "parser", "django", "=", "n’t", "stream", "panel", "entry", "message", "set", "notifications", "translation", "syntax", "character", "call_command", "get_version", "value", "section", "include_deployment_checks", "line", "sys.exit", "sets", "nargs", "source", "case", "boolean", "crontab", "underscore", "subcommand", "use", "base", "errors", "tuple", "arguments", "commit", "self.stdout", "type", "standalone", "init", "subclasses", "self", "coloring", "custom", "instance", "calls", "objects", "documentation", "translations", "kwargs", "app_configs", "fail_level", "handle_label", "returncode", "basecommand", "default", "mechanisms", "user", "init__.py", "argumentparser", "poll_ids", "handle", "success", "appconfig", "attribute", "args", "option", "docs", "output_transaction", "none", "deactivation", "help", "decorator", "warning", "problem", "add_arguments", "doesnotexist", "styles", "constructor", "tags", "reason", "framework", "project", "description", "polls", "proxies", "document", "deployment", "edit", "logic", "begin", "import", "name", "closepoll.py", "self.stderr", "management", "parameter", "response", "statements", "directory", "%", "sql", "defaults", "execution", "pk", "way", "locale", "console", "information", "execute", "python", "super", "checks", "methods", "versions", "customizations", "problems", "options", "optional", "exception", "poll_id", "string", "party", "method", "requires_system_checks", "settings", "argument", "¶", "command", "reverse", "self.style", "applications", "disk", "parameters", "tasks", "tutorial", "display_num_errors", "system", "int", "no_translations", "apps", "search", "appcommand", "closepoll", "text", "content", "requirement", "exceptions"], "type": "documentation"},
{"title": "Django’s cache framework | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/cache/", "content": "Django’s cache framework ¶ A fundamental trade-off in dynamic websites is, well, they’re dynamic. Each\ntime a user requests a page, the web server makes all sorts of calculations –\nfrom database queries to template rendering to business logic – to create the\npage that your site’s visitor sees. This is a lot more expensive, from a\nprocessing-overhead perspective, than your standard\nread-a-file-off-the-filesystem server arrangement. For most web applications, this overhead isn’t a big deal. Most web\napplications aren’t washingtonpost.com or slashdot.org ; they’re small-\nto medium-sized sites with so-so traffic. But for medium- to high-traffic\nsites, it’s essential to cut as much overhead as possible. That’s where caching comes in. To cache something is to save the result of an expensive calculation so that\nyou don’t have to perform the calculation next time. Here’s some pseudocode\nexplaining how this would work for a dynamically generated web page: given a URL, try finding that page in the cache\nif the page is in the cache:\n    return the cached page\nelse:\n    generate the page\n    save the generated page in the cache (for next time)\n    return the generated page Django comes with a robust cache system that lets you save dynamic pages so\nthey don’t have to be calculated for each request. For convenience, Django\noffers different levels of cache granularity: You can cache the output of\nspecific views, you can cache only the pieces that are difficult to produce,\nor you can cache your entire site. Django also works well with “downstream” caches, such as Squid and browser-based caches. These are the types\nof caches that you don’t directly control but to which you can provide hints\n(via HTTP headers) about which parts of your site should be cached, and how. See also The Cache Framework design philosophy explains a few of the design decisions of the framework. Setting up the cache ¶ The cache system requires a small amount of setup. Namely, you have to tell it\nwhere your cached data should live – whether in a database, on the filesystem\nor directly in memory. This is an important decision that affects your cache’s\nperformance; yes, some cache types are faster than others. Your cache preference goes in the CACHES setting in your\nsettings file. Here’s an explanation of all available values for CACHES . Memcached ¶ Memcached is an entirely memory-based cache server, originally developed\nto handle high loads at LiveJournal.com and subsequently open-sourced by\nDanga Interactive. It is used by sites such as Facebook and Wikipedia to\nreduce database access and dramatically increase site performance. Memcached runs as a daemon and is allotted a specified amount of RAM. All it\ndoes is provide a fast interface for adding, retrieving and deleting data in\nthe cache. All data is stored directly in memory, so there’s no overhead of\ndatabase or filesystem usage. After installing Memcached itself, you’ll need to install a Memcached\nbinding. There are several Python Memcached bindings available; the\ntwo supported by Django are pylibmc and pymemcache . To use Memcached with Django: Set BACKEND to django.core.cache.backends.memcached.PyMemcacheCache or django.core.cache.backends.memcached.PyLibMCCache (depending on your\nchosen memcached binding) Set LOCATION to ip:port values,\nwhere ip is the IP address of the Memcached daemon and port is the\nport on which Memcached is running, or to a unix:path value, where path is the path to a Memcached Unix socket file. In this example, Memcached is running on localhost (127.0.0.1) port 11211, using\nthe pymemcache binding: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.memcached.PyMemcacheCache\" , \"LOCATION\" : \"127.0.0.1:11211\" , } } In this example, Memcached is available through a local Unix socket file /tmp/memcached.sock using the pymemcache binding: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.memcached.PyMemcacheCache\" , \"LOCATION\" : \"unix:/tmp/memcached.sock\" , } } One excellent feature of Memcached is its ability to share a cache over\nmultiple servers. This means you can run Memcached daemons on multiple\nmachines, and the program will treat the group of machines as a single cache, without the need to duplicate cache values on each machine. To take\nadvantage of this feature, include all server addresses in LOCATION , either as a semicolon or comma\ndelimited string, or as a list. In this example, the cache is shared over Memcached instances running on IP\naddress 172.19.26.240 and 172.19.26.242, both on port 11211: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.memcached.PyMemcacheCache\" , \"LOCATION\" : [ \"172.19.26.240:11211\" , \"172.19.26.242:11211\" , ], } } In the following example, the cache is shared over Memcached instances running\non the IP addresses 172.19.26.240 (port 11211), 172.19.26.242 (port 11212), and\n172.19.26.244 (port 11213): CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.memcached.PyMemcacheCache\" , \"LOCATION\" : [ \"172.19.26.240:11211\" , \"172.19.26.242:11212\" , \"172.19.26.244:11213\" , ], } } By default, the PyMemcacheCache backend sets the following options (you can\noverride them in your OPTIONS ): \"OPTIONS\" : { \"allow_unicode_keys\" : True , \"default_noreply\" : False , \"serde\" : pymemcache . serde . pickle_serde , } A final point about Memcached is that memory-based caching has a\ndisadvantage: because the cached data is stored in memory, the data will be\nlost if your server crashes. Clearly, memory isn’t intended for permanent data\nstorage, so don’t rely on memory-based caching as your only data storage.\nWithout a doubt, none of the Django caching backends should be used for\npermanent storage – they’re all intended to be solutions for caching, not\nstorage – but we point this out here because memory-based caching is\nparticularly temporary. Redis ¶ Redis is an in-memory database that can be used for caching. To begin you’ll\nneed a Redis server running either locally or on a remote machine. After setting up the Redis server, you’ll need to install Python bindings for\nRedis. redis-py is the binding supported natively by Django.\nInstalling the hiredis-py package is also recommended. To use Redis as your cache backend with Django: Set BACKEND to django.core.cache.backends.redis.RedisCache . Set LOCATION to the URL pointing to your Redis\ninstance, using the appropriate scheme. See the redis-py docs for details on the available schemes . For example, if Redis is running on localhost (127.0.0.1) port 6379: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.redis.RedisCache\" , \"LOCATION\" : \"redis://127.0.0.1:6379\" , } } Often Redis servers are protected with authentication. In order to supply a\nusername and password, add them in the LOCATION along with the URL: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.redis.RedisCache\" , \"LOCATION\" : \"redis://username:password@127.0.0.1:6379\" , } } If you have multiple Redis servers set up in the replication mode, you can\nspecify the servers either as a semicolon or comma delimited string, or as a\nlist. While using multiple servers, write operations are performed on the first\nserver (leader). Read operations are performed on the other servers (replicas)\nchosen at random: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.redis.RedisCache\" , \"LOCATION\" : [ \"redis://127.0.0.1:6379\" , # leader \"redis://127.0.0.1:6378\" , # read-replica 1 \"redis://127.0.0.1:6377\" , # read-replica 2 ], } } Database caching ¶ Django can store its cached data in your database. This works best if you’ve\ngot a fast, well-indexed database server. To use a database table as your cache backend: Set BACKEND to django.core.cache.backends.db.DatabaseCache Set LOCATION to tablename , the name of the\ndatabase table. This name can be whatever you want, as long as it’s a valid\ntable name that’s not already being used in your database. In this example, the cache table’s name is my_cache_table : CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.db.DatabaseCache\" , \"LOCATION\" : \"my_cache_table\" , } } Unlike other cache backends, the database cache does not support automatic\nculling of expired entries at the database level. Instead, expired cache\nentries are culled each time add() , set() , or touch() is called. Creating the cache table ¶ Before using the database cache, you must create the cache table with this\ncommand: python manage.py createcachetable This creates a table in your database that is in the proper format that\nDjango’s database-cache system expects. The name of the table is taken from LOCATION . If you are using multiple database caches, createcachetable creates\none table for each cache. If you are using multiple databases, createcachetable observes the allow_migrate() method of your database routers (see below). Like migrate , createcachetable won’t touch an existing\ntable. It will only create missing tables. To print the SQL that would be run, rather than run it, use the createcachetable --dry-run option. Multiple databases ¶ If you use database caching with multiple databases, you’ll also need\nto set up routing instructions for your database cache table. For the\npurposes of routing, the database cache table appears as a model named CacheEntry , in an application named django_cache . This model\nwon’t appear in the models cache, but the model details can be used\nfor routing purposes. For example, the following router would direct all cache read\noperations to cache_replica , and all write operations to cache_primary . The cache table will only be synchronized onto cache_primary : class CacheRouter : \"\"\"A router to control all database cache operations\"\"\" def db_for_read ( self , model , ** hints ): \"All cache read operations go to the replica\" if model . _meta . app_label == \"django_cache\" : return \"cache_replica\" return None def db_for_write ( self , model , ** hints ): \"All cache write operations go to primary\" if model . _meta . app_label == \"django_cache\" : return \"cache_primary\" return None def allow_migrate ( self , db , app_label , model_name = None , ** hints ): \"Only install the cache model on primary\" if app_label == \"django_cache\" : return db == \"cache_primary\" return None If you don’t specify routing directions for the database cache model,\nthe cache backend will use the default database. And if you don’t use the database cache backend, you don’t need to worry about\nproviding routing instructions for the database cache model. Filesystem caching ¶ The file-based backend serializes and stores each cache value as a separate\nfile. To use this backend set BACKEND to \"django.core.cache.backends.filebased.FileBasedCache\" and LOCATION to a suitable directory. For example,\nto store cached data in /var/tmp/django_cache , use this setting: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.filebased.FileBasedCache\" , \"LOCATION\" : \"/var/tmp/django_cache\" , } } If you’re on Windows, put the drive letter at the beginning of the path,\nlike this: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.filebased.FileBasedCache\" , \"LOCATION\" : \"c:/foo/bar\" , } } The directory path should be absolute – that is, it should start at the root\nof your filesystem. It doesn’t matter whether you put a slash at the end of the\nsetting. Make sure the directory pointed-to by this setting either exists and is\nreadable and writable, or that it can be created by the system user under which\nyour web server runs. Continuing the above example, if your server runs as the\nuser apache , make sure the directory /var/tmp/django_cache exists and\nis readable and writable by the user apache , or that it can be created by\nthe user apache . Warning When the cache LOCATION is contained within MEDIA_ROOT , STATIC_ROOT , or STATICFILES_FINDERS , sensitive data may be exposed. An attacker who gains access to the cache file can not only falsify HTML\ncontent, which your site will trust, but also remotely execute arbitrary\ncode, as the data is serialized using pickle . Warning Filesystem caching may become slow when storing a large number of files. If\nyou run into this problem, consider using a different caching mechanism.\nYou can also subclass FileBasedCache and\nimprove the culling strategy. Local-memory caching ¶ This is the default cache if another is not specified in your settings file. If\nyou want the speed advantages of in-memory caching but don’t have the capability\nof running Memcached, consider the local-memory cache backend. This cache is\nper-process (see below) and thread-safe. To use it, set BACKEND to \"django.core.cache.backends.locmem.LocMemCache\" . For\nexample: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.locmem.LocMemCache\" , \"LOCATION\" : \"unique-snowflake\" , } } The cache LOCATION is used to identify individual\nmemory stores. If you only have one locmem cache, you can omit the LOCATION ; however, if you have more than one local\nmemory cache, you will need to assign a name to at least one of them in\norder to keep them separate. The cache uses a least-recently-used (LRU) culling strategy. Note that each process will have its own private cache instance, which means no\ncross-process caching is possible. This also means the local memory cache isn’t\nparticularly memory-efficient, so it’s probably not a good choice for\nproduction environments. It’s nice for development. Dummy caching (for development) ¶ Finally, Django comes with a “dummy” cache that doesn’t actually cache – it\njust implements the cache interface without doing anything. This is useful if you have a production site that uses heavy-duty caching in\nvarious places but a development/test environment where you don’t want to cache\nand don’t want to have to change your code to special-case the latter. To\nactivate dummy caching, set BACKEND like so: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.dummy.DummyCache\" , } } Using a custom cache backend ¶ While Django includes support for a number of cache backends out-of-the-box,\nsometimes you might want to use a customized cache backend. To use an external\ncache backend with Django, use the Python import path as the BACKEND of the CACHES setting, like so: CACHES = { \"default\" : { \"BACKEND\" : \"path.to.backend\" , } } If you’re building your own backend, you can use the standard cache backends\nas reference implementations. You’ll find the code in the django/core/cache/backends/ directory of the Django source. Note: Without a really compelling reason, such as a host that doesn’t support\nthem, you should stick to the cache backends included with Django. They’ve\nbeen well-tested and are well-documented. Cache arguments ¶ Each cache backend can be given additional arguments to control caching\nbehavior. These arguments are provided as additional keys in the CACHES setting. Valid arguments are as follows: TIMEOUT : The default timeout, in\nseconds, to use for the cache. This argument defaults to 300 seconds (5 minutes).\nYou can set TIMEOUT to None so that, by default, cache keys never\nexpire. A value of 0 causes keys to immediately expire (effectively\n“don’t cache”). OPTIONS : Any options that should be\npassed to the cache backend. The list of valid options will vary\nwith each backend, and cache backends backed by a third-party library\nwill pass their options directly to the underlying cache library. Cache backends that implement their own culling strategy (i.e.,\nthe locmem , filesystem and database backends) will\nhonor the following options: MAX_ENTRIES : The maximum number of entries allowed in\nthe cache before old values are deleted. This argument\ndefaults to 300 . CULL_FREQUENCY : The fraction of entries that are culled\nwhen MAX_ENTRIES is reached. The actual ratio is 1 / CULL_FREQUENCY , so set CULL_FREQUENCY to 2 to\ncull half the entries when MAX_ENTRIES is reached. This argument\nshould be an integer and defaults to 3 . A value of 0 for CULL_FREQUENCY means that the\nentire cache will be dumped when MAX_ENTRIES is reached.\nOn some backends ( database in particular) this makes culling much faster at the expense of more cache misses. The Memcached and Redis backends pass the contents of OPTIONS as keyword arguments to the client constructors, allowing\nfor more advanced control of client behavior. For example usage, see below. KEY_PREFIX : A string that will be\nautomatically included (prepended by default) to all cache keys\nused by the Django server. See the cache documentation for\nmore information. VERSION : The default version number\nfor cache keys generated by the Django server. See the cache documentation for more\ninformation. KEY_FUNCTION A string containing a dotted path to a function that defines how\nto compose a prefix, version and key into a final cache key. See the cache documentation for more information. In this example, a filesystem backend is being configured with a timeout\nof 60 seconds, and a maximum capacity of 1000 items: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.filebased.FileBasedCache\" , \"LOCATION\" : \"/var/tmp/django_cache\" , \"TIMEOUT\" : 60 , \"OPTIONS\" : { \"MAX_ENTRIES\" : 1000 }, } } Here’s an example configuration for a pylibmc based backend that enables\nthe binary protocol, SASL authentication, and the ketama behavior mode: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.memcached.PyLibMCCache\" , \"LOCATION\" : \"127.0.0.1:11211\" , \"OPTIONS\" : { \"binary\" : True , \"username\" : \"user\" , \"password\" : \"pass\" , \"behaviors\" : { \"ketama\" : True , }, }, } } Here’s an example configuration for a pymemcache based backend that enables\nclient pooling (which may improve performance by keeping clients connected),\ntreats memcache/network errors as cache misses, and sets the TCP_NODELAY flag on the connection’s socket: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.memcached.PyMemcacheCache\" , \"LOCATION\" : \"127.0.0.1:11211\" , \"OPTIONS\" : { \"no_delay\" : True , \"ignore_exc\" : True , \"max_pool_size\" : 4 , \"use_pooling\" : True , }, } } Here’s an example configuration for a redis based backend that selects\ndatabase 10 (by default Redis ships with 16 logical databases), and sets a\ncustom connection pool class ( redis.ConnectionPool is used by default): CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.redis.RedisCache\" , \"LOCATION\" : \"redis://127.0.0.1:6379\" , \"OPTIONS\" : { \"db\" : \"10\" , \"pool_class\" : \"redis.BlockingConnectionPool\" , }, } } The per-site cache ¶ Once the cache is set up, the simplest way to use caching is to cache your\nentire site. You’ll need to add 'django.middleware.cache.UpdateCacheMiddleware' and 'django.middleware.cache.FetchFromCacheMiddleware' to your MIDDLEWARE setting, as in this example: MIDDLEWARE = [ \"django.middleware.cache.UpdateCacheMiddleware\" , \"django.middleware.common.CommonMiddleware\" , \"django.middleware.cache.FetchFromCacheMiddleware\" , ] Note No, that’s not a typo: the “update” middleware must be first in the list,\nand the “fetch” middleware must be last. The details are a bit obscure, but\nsee Order of MIDDLEWARE below if you’d like the full story. Then, add the following required settings to your Django settings file: CACHE_MIDDLEWARE_ALIAS – The cache alias to use for storage. CACHE_MIDDLEWARE_SECONDS – The integer number of seconds each\npage should be cached. CACHE_MIDDLEWARE_KEY_PREFIX – If the cache is shared across\nmultiple sites using the same Django installation, set this to the name of\nthe site, or some other string that is unique to this Django instance, to\nprevent key collisions. Use an empty string if you don’t care. FetchFromCacheMiddleware caches GET and HEAD responses with status 200,\nwhere the request and response headers allow. Responses to requests for the same\nURL with different query parameters are considered to be unique pages and are\ncached separately. This middleware expects that a HEAD request is answered with\nthe same response headers as the corresponding GET request; in which case it can\nreturn a cached GET response for HEAD request. Additionally, UpdateCacheMiddleware automatically sets a few headers in\neach HttpResponse which affect downstream caches : Sets the Expires header to the current date/time plus the defined CACHE_MIDDLEWARE_SECONDS . Sets the Cache-Control header to give a max age for the page –\nagain, from the CACHE_MIDDLEWARE_SECONDS setting. See Middleware for more on middleware. If a view sets its own cache expiry time (i.e. it has a max-age section in\nits Cache-Control header) then the page will be cached until the expiry\ntime, rather than CACHE_MIDDLEWARE_SECONDS . Using the decorators in django.views.decorators.cache you can easily set a view’s expiry time\n(using the cache_control() decorator) or\ndisable caching for a view (using the never_cache() decorator). See the using other headers section for more on these decorators. If USE_I18N is set to True then the generated cache key will\ninclude the name of the active language – see also How Django discovers language preference ). This allows you to easily\ncache multilingual sites without having to create the cache key yourself. Cache keys also include the current time zone when USE_TZ is set to True . The per-view cache ¶ django.views.decorators.cache. cache_page ( timeout , * , cache = None , key_prefix = None ) ¶ A more granular way to use the caching framework is by caching the output of\nindividual views. django.views.decorators.cache defines a cache_page decorator that will automatically cache the view’s response for you: from django.views.decorators.cache import cache_page @cache_page ( 60 * 15 ) def my_view ( request ): ... cache_page takes a single argument: the cache timeout, in seconds. In the\nabove example, the result of the my_view() view will be cached for 15\nminutes. (Note that we’ve written it as 60 * 15 for the purpose of\nreadability. 60 * 15 will be evaluated to 900 – that is, 15 minutes\nmultiplied by 60 seconds per minute.) The cache timeout set by cache_page takes precedence over the max-age directive from the Cache-Control header. The per-view cache, like the per-site cache, is keyed off of the URL. If\nmultiple URLs point at the same view, each URL will be cached separately.\nContinuing the my_view example, if your URLconf looks like this: urlpatterns = [ path ( \"foo/<int:code>/\" , my_view ), ] then requests to /foo/1/ and /foo/23/ will be cached separately, as\nyou may expect. But once a particular URL (e.g., /foo/23/ ) has been\nrequested, subsequent requests to that URL will use the cache. cache_page can also take an optional keyword argument, cache ,\nwhich directs the decorator to use a specific cache (from your CACHES setting) when caching view results. By default, the default cache will be used, but you can specify any cache you\nwant: @cache_page ( 60 * 15 , cache = \"special_cache\" ) def my_view ( request ): ... You can also override the cache prefix on a per-view basis. cache_page takes an optional keyword argument, key_prefix ,\nwhich works in the same way as the CACHE_MIDDLEWARE_KEY_PREFIX setting for the middleware.  It can be used like this: @cache_page ( 60 * 15 , key_prefix = \"site1\" ) def my_view ( request ): ... The key_prefix and cache arguments may be specified together. The key_prefix argument and the KEY_PREFIX specified under CACHES will be concatenated. Additionally, cache_page automatically sets Cache-Control and Expires headers in the response which affect downstream caches . Specifying per-view cache in the URLconf ¶ The examples in the previous section have hard-coded the fact that the view is\ncached, because cache_page alters the my_view function in place. This\napproach couples your view to the cache system, which is not ideal for several\nreasons. For instance, you might want to reuse the view functions on another,\ncache-less site, or you might want to distribute the views to people who might\nwant to use them without being cached. The solution to these problems is to\nspecify the per-view cache in the URLconf rather than next to the view functions\nthemselves. You can do so by wrapping the view function with cache_page when you refer\nto it in the URLconf. Here’s the old URLconf from earlier: urlpatterns = [ path ( \"foo/<int:code>/\" , my_view ), ] Here’s the same thing, with my_view wrapped in cache_page : from django.views.decorators.cache import cache_page urlpatterns = [ path ( \"foo/<int:code>/\" , cache_page ( 60 * 15 )( my_view )), ] Template fragment caching ¶ If you’re after even more control, you can also cache template fragments using\nthe cache template tag. To give your template access to this tag, put {% load cache %} near the top of your template. The {% cache %} template tag caches the contents of the block for a given\namount of time. It takes at least two arguments: the cache timeout, in seconds,\nand the name to give the cache fragment. The fragment is cached forever if\ntimeout is None . The name will be taken as is, do not use a variable. For\nexample: {% load cache %} {% cache 500 sidebar %} .. sidebar .. {% endcache %} Sometimes you might want to cache multiple copies of a fragment depending on\nsome dynamic data that appears inside the fragment. For example, you might want a\nseparate cached copy of the sidebar used in the previous example for every user\nof your site. Do this by passing one or more additional arguments, which may be\nvariables with or without filters, to the {% cache %} template tag to\nuniquely identify the cache fragment: {% load cache %} {% cache 500 sidebar request.user.username %} .. sidebar for logged in user .. {% endcache %} If USE_I18N is set to True the per-site middleware cache will respect the active language . For the cache template\ntag you could use one of the translation-specific variables available in\ntemplates to achieve the same result: {% load i18n %} {% load cache %} {% get_current_language as LANGUAGE_CODE %} {% cache 600 welcome LANGUAGE_CODE %} {% translate \"Welcome to example.com\" %} {% endcache %} The cache timeout can be a template variable, as long as the template variable\nresolves to an integer value. For example, if the template variable my_timeout is set to the value 600 , then the following two examples are\nequivalent: {% cache 600 sidebar %} ... {% endcache %} {% cache my_timeout sidebar %} ... {% endcache %} This feature is useful in avoiding repetition in templates. You can set the\ntimeout in a variable, in one place, and reuse that value. By default, the cache tag will try to use the cache called “template_fragments”.\nIf no such cache exists, it will fall back to using the default cache. You may\nselect an alternate cache backend to use with the using keyword argument,\nwhich must be the last argument to the tag. {% cache 300 local-thing ... using = \"localcache\" %} It is considered an error to specify a cache name that is not configured. django.core.cache.utils. make_template_fragment_key ( fragment_name , vary_on = None ) ¶ If you want to obtain the cache key used for a cached fragment, you can use make_template_fragment_key . fragment_name is the same as second argument\nto the cache template tag; vary_on is a list of all additional arguments\npassed to the tag. This function can be useful for invalidating or overwriting\na cached item, for example: >>> from django.core.cache import cache >>> from django.core.cache.utils import make_template_fragment_key # cache key for {% cache 500 sidebar username %} >>> key = make_template_fragment_key ( \"sidebar\" , [ username ]) >>> cache . delete ( key ) # invalidates cached template fragment True The low-level cache API ¶ Sometimes, caching an entire rendered page doesn’t gain you very much and is,\nin fact, inconvenient overkill. Perhaps, for instance, your site includes a view whose results depend on\nseveral expensive queries, the results of which change at different intervals.\nIn this case, it would not be ideal to use the full-page caching that the\nper-site or per-view cache strategies offer, because you wouldn’t want to\ncache the entire result (since some of the data changes often), but you’d still\nwant to cache the results that rarely change. For cases like this, Django exposes a low-level cache API. You can use this API\nto store objects in the cache with any level of granularity you like.  You can\ncache any Python object that can be pickled safely: strings, dictionaries,\nlists of model objects, and so forth. (Most common Python objects can be\npickled; refer to the Python documentation for more information about\npickling.) Accessing the cache ¶ django.core.cache. caches ¶ You can access the caches configured in the CACHES setting\nthrough a dict-like object: django.core.cache.caches . Repeated\nrequests for the same alias in the same thread will return the same\nobject. >>> from django.core.cache import caches >>> cache1 = caches [ \"myalias\" ] >>> cache2 = caches [ \"myalias\" ] >>> cache1 is cache2 True If the named key does not exist, InvalidCacheBackendError will be\nraised. To provide thread-safety, a different instance of the cache backend will\nbe returned for each thread. django.core.cache. cache ¶ As a shortcut, the default cache is available as django.core.cache.cache : >>> from django.core.cache import cache This object is equivalent to caches['default'] . Basic usage ¶ The basic interface is: cache. set ( key , value , timeout = DEFAULT_TIMEOUT , version = None ) ¶ >>> cache . set ( \"my_key\" , \"hello, world!\" , 30 ) cache. get ( key , default = None , version = None ) ¶ >>> cache . get ( \"my_key\" ) 'hello, world!' key should be a str , and value can be any picklable Python object. The timeout argument is optional and defaults to the timeout argument\nof the appropriate backend in the CACHES setting (explained above).\nIt’s the number of seconds the value should be stored in the cache. Passing in None for timeout will cache the value forever. A timeout of 0 won’t cache the value. If the object doesn’t exist in the cache, cache.get() returns None : >>> # Wait 30 seconds for 'my_key' to expire... >>> cache . get ( \"my_key\" ) None If you need to determine whether the object exists in the cache and you have\nstored a literal value None , use a sentinel object as the default: >>> sentinel = object () >>> cache . get ( \"my_key\" , sentinel ) is sentinel False >>> # Wait 30 seconds for 'my_key' to expire... >>> cache . get ( \"my_key\" , sentinel ) is sentinel True cache.get() can take a default argument. This specifies which value to\nreturn if the object doesn’t exist in the cache: >>> cache . get ( \"my_key\" , \"has expired\" ) 'has expired' cache. add ( key , value , timeout = DEFAULT_TIMEOUT , version = None ) ¶ To add a key only if it doesn’t already exist, use the add() method.\nIt takes the same parameters as set() , but it will not attempt to\nupdate the cache if the key specified is already present: >>> cache . set ( \"add_key\" , \"Initial value\" ) >>> cache . add ( \"add_key\" , \"New value\" ) >>> cache . get ( \"add_key\" ) 'Initial value' If you need to know whether add() stored a value in the cache, you can\ncheck the return value. It will return True if the value was stored, False otherwise. cache. get_or_set ( key , default , timeout = DEFAULT_TIMEOUT , version = None ) ¶ If you want to get a key’s value or set a value if the key isn’t in the cache,\nthere is the get_or_set() method. It takes the same parameters as get() but the default is set as the new cache value for that key, rather than\nreturned: >>> cache . get ( \"my_new_key\" ) # returns None >>> cache . get_or_set ( \"my_new_key\" , \"my new value\" , 100 ) 'my new value' You can also pass any callable as a default value: >>> import datetime >>> cache . get_or_set ( \"some-timestamp-key\" , datetime . datetime . now ) datetime.datetime(2014, 12, 11, 0, 15, 49, 457920) cache. get_many ( keys , version = None ) ¶ There’s also a get_many() interface that only hits the cache once. get_many() returns a dictionary with all the keys you asked for that\nactually exist in the cache (and haven’t expired): >>> cache . set ( \"a\" , 1 ) >>> cache . set ( \"b\" , 2 ) >>> cache . set ( \"c\" , 3 ) >>> cache . get_many ([ \"a\" , \"b\" , \"c\" ]) {'a': 1, 'b': 2, 'c': 3} cache. set_many ( dict , timeout ) ¶ To set multiple values more efficiently, use set_many() to pass a dictionary\nof key-value pairs: >>> cache . set_many ({ \"a\" : 1 , \"b\" : 2 , \"c\" : 3 }) >>> cache . get_many ([ \"a\" , \"b\" , \"c\" ]) {'a': 1, 'b': 2, 'c': 3} Like cache.set() , set_many() takes an optional timeout parameter. On supported backends (memcached), set_many() returns a list of keys that\nfailed to be inserted. cache. delete ( key , version = None ) ¶ You can delete keys explicitly with delete() to clear the cache for a\nparticular object: >>> cache . delete ( \"a\" ) True delete() returns True if the key was successfully deleted, False otherwise. cache. delete_many ( keys , version = None ) ¶ If you want to clear a bunch of keys at once, delete_many() can take a list\nof keys to be cleared: >>> cache . delete_many ([ \"a\" , \"b\" , \"c\" ]) cache. clear () ¶ Finally, if you want to delete all the keys in the cache, use cache.clear() .  Be careful with this; clear() will remove everything from the cache, not just the keys set by your application: >>> cache . clear () cache. touch ( key , timeout = DEFAULT_TIMEOUT , version = None ) ¶ cache.touch() sets a new expiration for a key. For example, to update a key\nto expire 10 seconds from now: >>> cache . touch ( \"a\" , 10 ) True Like other methods, the timeout argument is optional and defaults to the TIMEOUT option of the appropriate backend in the CACHES setting. touch() returns True if the key was successfully touched, False otherwise. cache. incr ( key , delta = 1 , version = None ) ¶ cache. decr ( key , delta = 1 , version = None ) ¶ You can also increment or decrement a key that already exists using the incr() or decr() methods, respectively. By default, the existing cache\nvalue will be incremented or decremented by 1. Other increment/decrement values\ncan be specified by providing an argument to the increment/decrement call. A\nValueError will be raised if you attempt to increment or decrement a\nnonexistent cache key: >>> cache . set ( \"num\" , 1 ) >>> cache . incr ( \"num\" ) 2 >>> cache . incr ( \"num\" , 10 ) 12 >>> cache . decr ( \"num\" ) 11 >>> cache . decr ( \"num\" , 5 ) 6 Note incr() / decr() methods are not guaranteed to be atomic. On those\nbackends that support atomic increment/decrement (most notably, the\nmemcached backend), increment and decrement operations will be atomic.\nHowever, if the backend doesn’t natively provide an increment/decrement\noperation, it will be implemented using a two-step retrieve/update. cache. close () ¶ You can close the connection to your cache with close() if implemented by\nthe cache backend. >>> cache . close () Note For caches that don’t implement close methods it is a no-op. Note The async variants of base methods are prefixed with a , e.g. cache.aadd() or cache.adelete_many() . See Asynchronous support for more details. Cache key prefixing ¶ If you are sharing a cache instance between servers, or between your\nproduction and development environments, it’s possible for data cached\nby one server to be used by another server. If the format of cached\ndata is different between servers, this can lead to some very hard to\ndiagnose problems. To prevent this, Django provides the ability to prefix all cache keys\nused by a server. When a particular cache key is saved or retrieved,\nDjango will automatically prefix the cache key with the value of the KEY_PREFIX cache setting. By ensuring each Django instance has a different KEY_PREFIX , you can ensure that there will be no\ncollisions in cache values. Cache versioning ¶ When you change running code that uses cached values, you may need to\npurge any existing cached values. The easiest way to do this is to\nflush the entire cache, but this can lead to the loss of cache values\nthat are still valid and useful. Django provides a better way to target individual cache values.\nDjango’s cache framework has a system-wide version identifier,\nspecified using the VERSION cache setting.\nThe value of this setting is automatically combined with the cache\nprefix and the user-provided cache key to obtain the final cache key. By default, any key request will automatically include the site\ndefault cache key version. However, the primitive cache functions all\ninclude a version argument, so you can specify a particular cache\nkey version to set or get. For example: >>> # Set version 2 of a cache key >>> cache . set ( \"my_key\" , \"hello world!\" , version = 2 ) >>> # Get the default version (assuming version=1) >>> cache . get ( \"my_key\" ) None >>> # Get version 2 of the same key >>> cache . get ( \"my_key\" , version = 2 ) 'hello world!' The version of a specific key can be incremented and decremented using\nthe incr_version() and decr_version() methods. This\nenables specific keys to be bumped to a new version, leaving other\nkeys unaffected. Continuing our previous example: >>> # Increment the version of 'my_key' >>> cache . incr_version ( \"my_key\" ) >>> # The default version still isn't available >>> cache . get ( \"my_key\" ) None # Version 2 isn't available, either >>> cache . get ( \"my_key\" , version = 2 ) None >>> # But version 3 *is* available >>> cache . get ( \"my_key\" , version = 3 ) 'hello world!' Cache key transformation ¶ As described in the previous two sections, the cache key provided by a\nuser is not used verbatim – it is combined with the cache prefix and\nkey version to provide a final cache key. By default, the three parts\nare joined using colons to produce a final string: def make_key ( key , key_prefix , version ): return \" %s : %s : %s \" % ( key_prefix , version , key ) If you want to combine the parts in different ways, or apply other\nprocessing to the final key (e.g., taking a hash digest of the key\nparts), you can provide a custom key function. The KEY_FUNCTION cache setting\nspecifies a dotted-path to a function matching the prototype of make_key() above. If provided, this custom key function will\nbe used instead of the default key combining function. Cache key warnings ¶ Memcached, the most commonly-used production cache backend, does not allow\ncache keys longer than 250 characters or containing whitespace or control\ncharacters, and using such keys will cause an exception. To encourage\ncache-portable code and minimize unpleasant surprises, the other built-in cache\nbackends issue a warning ( django.core.cache.backends.base.CacheKeyWarning )\nif a key is used that would cause an error on memcached. If you are using a production backend that can accept a wider range of keys (a\ncustom backend, or one of the non-memcached built-in backends), and want to use\nthis wider range without warnings, you can silence CacheKeyWarning with\nthis code in the management module of one of your INSTALLED_APPS : import warnings from django.core.cache import CacheKeyWarning warnings . simplefilter ( \"ignore\" , CacheKeyWarning ) If you want to instead provide custom key validation logic for one of the\nbuilt-in backends, you can subclass it, override just the validate_key method, and follow the instructions for using a custom cache backend . For\ninstance, to do this for the locmem backend, put this code in a module: from django.core.cache.backends.locmem import LocMemCache class CustomLocMemCache ( LocMemCache ): def validate_key ( self , key ): \"\"\"Custom validation, raising exceptions or warnings as needed.\"\"\" ... …and use the dotted Python path to this class in the BACKEND portion of your CACHES setting. Asynchronous support ¶ Django has developing support for asynchronous cache backends, but does not\nyet support asynchronous caching. It will be coming in a future release. django.core.cache.backends.base.BaseCache has async variants of all\nbase methods . By convention, the asynchronous versions\nof all methods are prefixed with a . By default, the arguments for both\nvariants are the same: >>> await cache . aset ( \"num\" , 1 ) >>> await cache . ahas_key ( \"num\" ) True Downstream caches ¶ So far, this document has focused on caching your own data. But another type\nof caching is relevant to web development, too: caching performed by\n“downstream” caches. These are systems that cache pages for users even before\nthe request reaches your website. Here are a few examples of downstream caches: When using HTTP, your ISP may cache\ncertain pages, so if you requested a page from http://example.com/ , your\nISP would send you the page without having to access example.com directly.\nThe maintainers of example.com have no knowledge of this caching; the ISP\nsits between example.com and your web browser, handling all of the caching\ntransparently. Such caching is not possible under HTTPS as it would\nconstitute a man-in-the-middle attack. Your Django website may sit behind a proxy cache , such as Squid Web\nProxy Cache ( http://www.squid-cache.org/ ), that caches pages for\nperformance. In this case, each request first would be handled by the\nproxy, and it would be passed to your application only if needed. Your web browser caches pages, too. If a web page sends out the\nappropriate headers, your browser will use the local cached copy for\nsubsequent requests to that page, without even contacting the web page\nagain to see whether it has changed. Downstream caching is a nice efficiency boost, but there’s a danger to it:\nMany web pages’ contents differ based on authentication and a host of other\nvariables, and cache systems that blindly save pages based purely on URLs could\nexpose incorrect or sensitive data to subsequent visitors to those pages. For example, if you operate a web email system, then the contents of the\n“inbox” page depend on which user is logged in. If an ISP blindly cached your\nsite, then the first user who logged in through that ISP would have their\nuser-specific inbox page cached for subsequent visitors to the site.  That’s\nnot cool. Fortunately, HTTP provides a solution to this problem. A number of HTTP headers\nexist to instruct downstream caches to differ their cache contents depending on\ndesignated variables, and to tell caching mechanisms not to cache particular\npages. We’ll look at some of these headers in the sections that follow. Using Vary headers ¶ The Vary header defines which request headers a cache\nmechanism should take into account when building its cache key. For example, if\nthe contents of a web page depend on a user’s language preference, the page is\nsaid to “vary on language.” By default, Django’s cache system creates its cache keys using the requested\nfully-qualified URL – e.g., \"https://www.example.com/stories/2005/?order_by=author\" . This means every\nrequest to that URL will use the same cached version, regardless of user-agent\ndifferences such as cookies or language preferences. However, if this page\nproduces different content based on some difference in request headers – such\nas a cookie, or a language, or a user-agent – you’ll need to use the Vary header to tell caching mechanisms that the page output depends on those things. To do this in Django, use the convenient django.views.decorators.vary.vary_on_headers() view decorator, like so: from django.views.decorators.vary import vary_on_headers @vary_on_headers ( \"User-Agent\" ) def my_view ( request ): ... In this case, a caching mechanism (such as Django’s own cache middleware) will\ncache a separate version of the page for each unique user-agent. The advantage to using the vary_on_headers decorator rather than manually\nsetting the Vary header (using something like response.headers['Vary'] = 'user-agent' ) is that the decorator adds to the Vary header (which may\nalready exist), rather than setting it from scratch and potentially overriding\nanything that was already in there. You can pass multiple headers to vary_on_headers() : @vary_on_headers ( \"User-Agent\" , \"Cookie\" ) def my_view ( request ): ... This tells downstream caches to vary on both , which means each combination of\nuser-agent and cookie will get its own cache value. For example, a request with\nthe user-agent Mozilla and the cookie value foo=bar will be considered\ndifferent from a request with the user-agent Mozilla and the cookie value foo=ham . Because varying on cookie is so common, there’s a django.views.decorators.vary.vary_on_cookie() decorator. These two views\nare equivalent: @vary_on_cookie def my_view ( request ): ... @vary_on_headers ( \"Cookie\" ) def my_view ( request ): ... The headers you pass to vary_on_headers are not case sensitive; \"User-Agent\" is the same thing as \"user-agent\" . You can also use a helper function, django.utils.cache.patch_vary_headers() ,\ndirectly. This function sets, or adds to, the Vary header . For example: from django.shortcuts import render from django.utils.cache import patch_vary_headers def my_view ( request ): ... response = render ( request , \"template_name\" , context ) patch_vary_headers ( response , [ \"Cookie\" ]) return response patch_vary_headers takes an HttpResponse instance as\nits first argument and a list/tuple of case-insensitive header names as its\nsecond argument. For more on Vary headers, see the official Vary spec . Controlling cache: Using other headers ¶ Other problems with caching are the privacy of data and the question of where\ndata should be stored in a cascade of caches. A user usually faces two kinds of caches: their own browser cache (a private\ncache) and their provider’s cache (a public cache). A public cache is used by\nmultiple users and controlled by someone else. This poses problems with\nsensitive data–you don’t want, say, your bank account number stored in a\npublic cache. So web applications need a way to tell caches which data is\nprivate and which is public. The solution is to indicate a page’s cache should be “private.” To do this in\nDjango, use the cache_control() view\ndecorator. Example: from django.views.decorators.cache import cache_control @cache_control ( private = True ) def my_view ( request ): ... This decorator takes care of sending out the appropriate HTTP header behind the\nscenes. Note that the cache control settings “private” and “public” are mutually\nexclusive. The decorator ensures that the “public” directive is removed if\n“private” should be set (and vice versa). An example use of the two directives\nwould be a blog site that offers both private and public entries. Public\nentries may be cached on any shared cache. The following code uses patch_cache_control() , the manual way to modify the\ncache control header (it is internally called by the cache_control() decorator): from django.views.decorators.cache import patch_cache_control from django.views.decorators.vary import vary_on_cookie @vary_on_cookie def list_blog_entries_view ( request ): if request . user . is_anonymous : response = render_only_public_entries () patch_cache_control ( response , public = True ) else : response = render_private_and_public_entries ( request . user ) patch_cache_control ( response , private = True ) return response You can control downstream caches in other ways as well (see RFC 9111 for\ndetails on HTTP caching). For example, even if you don’t use Django’s\nserver-side cache framework, you can still tell clients to cache a view for a\ncertain amount of time with the max-age directive: from django.views.decorators.cache import cache_control @cache_control ( max_age = 3600 ) def my_view ( request ): ... (If you do use the caching middleware, it already sets the max-age with\nthe value of the CACHE_MIDDLEWARE_SECONDS setting. In that case,\nthe custom max_age from the cache_control() decorator will take\nprecedence, and the header values will be merged correctly.) Any valid Cache-Control response directive is valid in cache_control() .\nHere are some more examples: no_transform=True must_revalidate=True stale_while_revalidate=num_seconds no_cache=True The full list of known directives can be found in the IANA registry (note that not all of them apply to responses). If you want to use headers to disable caching altogether, never_cache() is a view decorator that\nadds headers to ensure the response won’t be cached by browsers or other\ncaches. Example: from django.views.decorators.cache import never_cache @never_cache def myview ( request ): ... Order of MIDDLEWARE ¶ If you use caching middleware, it’s important to put each half in the right\nplace within the MIDDLEWARE setting. That’s because the cache\nmiddleware needs to know which headers by which to vary the cache storage.\nMiddleware always adds something to the Vary response header when it can. UpdateCacheMiddleware runs during the response phase, where middleware is\nrun in reverse order, so an item at the top of the list runs last during the\nresponse phase. Thus, you need to make sure that UpdateCacheMiddleware appears before any other middleware that might add something to the Vary header. The following middleware modules do so: SessionMiddleware adds Cookie GZipMiddleware adds Accept-Encoding LocaleMiddleware adds Accept-Language FetchFromCacheMiddleware , on the other hand, runs during the request phase,\nwhere middleware is applied first-to-last, so an item at the top of the list\nruns first during the request phase. The FetchFromCacheMiddleware also\nneeds to run after other middleware updates the Vary header, so FetchFromCacheMiddleware must be after any item that does so.", "keywords": ["users", "ham", "box", "db_for_write", "foo/<int", "allow_migrate", "feature", "storage", "strategies", "redis://127.0.0.1:6377", "efficiency", "b", "library", "#", "touch", "django.core.cache.backends.db", "stores", "dummycache", "host", "range", "filebasedcache", "cache_primary", "cache.aadd", "httpresponse", "django_cache", "request.user.username", "cache", "doubt", "change", "https", "django.core.cache.backends.dummy", "constructors", "cacheentry", "surprises", "http", "hash", "=", "changes", "response.headers['vary", "perspective", "results", "head", "http://www.squid-cache.org/", "installation", "fact", "clients", "setup", "tables", "tag", "filesystem", "sorts", "patch_vary_headers", "password@127.0.0.1:6379", "colons", "sets", "decr", "@cache_page", "process", "places", "pool_class", "memcached", "allow_unicode_keys", "choice", "exceptions", "type", "processing", "people", "custom", "defines", "objects", "documentation", "endcache", "file", "list_blog_entries_view", "man", "modules", "gzipmiddleware", "strategy", "user", "fragment", "template_fragments", "cases", "must_revalidate", "pseudocode", "ketama", "helper", "interactive", "mechanism", "pickle", "scenes", "warning", "time", "capability", "scratch", "expiration", "basis", "date", "render", "setting", "purposes", "responses", "daemon", "account", "memcache", "app_label", "leader", "things", "preference", "livejournal.com", "password", "logic", "django.core.cache.backends.base", "ignore", "name", "http://example.com/", "trade", "django.core.cache", "parameter", "cache_middleware_key_prefix", "world", "backends", "reference", "copies", "web", "age", "problems", "versions", "key_function", "queries", "ignore_exc", "visitor", "cache2", "clear", "addresses", "behaviors", "return", "applications", "deal", "memory", "foo", "culling", "environments", "use_tz", "rediscache", "172.19.26.240:11211", "letter", "kinds", "mozilla", "blog", "question", "examples", "knowledge", "django.core.cache.utils", "commonmiddleware", "pylibmccache", "locmem", "sessionmiddleware", "dummy", "username", "status", "delete_many", "proxy", "url", "redis://127.0.0.1:6379", "error", "timeout", "get_many", "module", "code", "locmemcache", "memcached.sock", "safety", "pages", "false", "behavior", "c", "access", "class", "group", "warnings", "tcp_nodelay", "names", "sidebar", "retrieve", "diagnose", "attack", "request", "database", "flag", "output", "django.core.cache.backends.locmem", "block", "business", "*", "db_for_read", "query", "page", "test", "close", "127.0.0.1:11211", "migrate", "types", "strings", "cache_middleware_seconds", "py", "decisions", ".", "usage", "registry", "pool", "configuration", "step", "thread", "cacherouter", "validation", "@vary_on_cookie", "pointing", "section", "binding", "replicas", "source", "router", "pymemcache", "sasl", "use", "environment", "static_root", "decr_version", "explanation", "solution", "performance", "serializes", "ram", "core", "cache.get", "operation", "order", "default", "serde", "resolves", "django.middleware.cache", "alias", "connectionpool", "prefix", "option", "c:/foo", "format", "comma", "characters", "daemons", "get_or_set", "convention", "boost", "danger", "default_timeout", "browsers", "convenience", "advantage", "scheme", "django.middleware.common", "misses", "privacy", "combination", "routing", "template", "redis://127.0.0.1:6378", "header", "iana", "way", "cachekeywarning", "servers", "tmp", "@vary_on_headers", "accept", "op", "party", "integer", "¶", "command", "prototype", "/var", "parameters", "side", "set_many", "content", "primary", "lru", "function", "implementations", "protocol", "views", "replication", "result", "view", "websites", "cull_frequency", "control", "zone", "run", "validate_key", "agent", "number", "lot", "decrement", "per", "expiry", "def", "point", "values", "digest", "directions", "hiredis", "maintainers", "string", "bank", "program", "windows", "unix", "thing", "redis://username", "vary_on_cookie", "databases", "wikipedia", "timestamp", "typo", "traffic", "fraction", "hand", "location", "table", "language", "models", "copy", "downstream", "version", "basecache", "ways", "level", "contents", "machine", "cache_control", "portion", "django", "drive", "rfc", "n’t", "ip", "disable", "increment", "set", "schemes", "development", "bunch", "db", "urlpatterns", "value", "granularity", "bit", "django.shortcuts", "duty", "data", "browser", "item", "datetime", "base", "backend", "vary_on", "machines", "no_cache", "expires", "make_template_fragment_key", "add", "shortcut", "self", "need", "instance", "speed", "sentinel", "use_pooling", "/foo/23/", "levels", "interface", "capacity", "readability", "mechanisms", "ratio", "django.core.cache.cache", "localcache", "max_age", "socket", "redis", "intervals", "docs", "decorator", "directives", "cache1", "transformation", "instances", "inbox", "bindings", "story", "installed_apps", "code>/", "object", "load", "calculation", "valueerror", "snowflake", "localemiddleware", "fetch", "response", "get_current_language", "precedence", "management", "off", "incr", "sql", "instructions", "hints", "dictionary", "requests", "whitespace", "website", "pairs", "disadvantage", "keyword", "minute", "simplefilter", "repetition", "max", "cache_page", "others", "top", "variables", "decorators", "root", "cache_middleware_alias", "stale_while_revalidate", "attacker", "render_only_public_entries", "databasecache", "system", "address", "port", "never_cache", "no", "overhead", "delta", "solutions", "django.views.decorators.cache", "items", "production", "routers", "headers", "slash", "unix:/tmp", "my_key", "difference", "patch_cache_control", "site", "’s", "apache", "add_key", "lists", "example", "no_delay", "https://www.example.com/stories/2005/?order_by=author", "care", "i18n", "django.utils.cache.patch_vary_headers", "list", "pieces", "loss", "minutes", "seconds", "arrangement", "site1", "email", "phase", "read", "make_key", "model", "variable", "preferences", "my_new_key", "reasons", "sections", "place", "systems", "application", "encoding", "pooling", "dictionaries", "so", "key_prefix", "approach", "vary", "django.views.decorators.vary.vary_on_headers", "ability", "release", "differences", "isp", "localhost", "variants", "urlconf", "overkill", "philosophy", "translation", "spec", "django.core.cache.caches", "render_private_and_public_entries", "keys", "case", "authentication", "network", "html", "errors", "django.utils.cache", "default_noreply", "tuple", "server", "str", "arguments", "cache_replica", "package", "myalias", "middleware", "directive", "end", "fragment_name", "entries", "myview", "path.to.backend", "delete", "cache.clear", "amount", "decision", "bar", "path", "functions", "key", "operations", "fetchfromcachemiddleware", "update", "my_view", "no_transform", "none", "filters", "problem", "specifies", "collisions", "get", "to", "vary_on_headers", "reason", "framework", "facebook", "caches", "replica", "semicolon", "provider", "true", "caching", "urls", "api", "loads", "parts", "support", "cookies", "mode", "document", "-", "connection", "context", "runs", "files", "import", "cascade", "customlocmemcache", "calculations", "directory", "%", "defaults", ">", "call", "information", "python", "updatecachemiddleware", "methods", "options", "expense", "purpose", "exception", "client", "details", "method", "squid", "max_entries", "num", "settings", "ships", "danga", "argument", "half", "cookie", "note", "sites", "model_name", "visitors", "172.19.26.242:11211", "my_timeout", "design", "templates", "beginning", "incr_version", "advantages"], "type": "documentation"},
{"title": "Built-in template tags and filters | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/templates/builtins/", "content": "Built-in template tags and filters ¶ This document describes Django’s built-in template tags and filters. It is\nrecommended that you use the automatic documentation , if available, as this will also include\ndocumentation for any custom tags or filters installed. Built-in tag reference ¶ autoescape ¶ Controls the current auto-escaping behavior. This tag takes either on or off as an argument and that determines whether auto-escaping is in effect\ninside the block. The block is closed with an endautoescape ending tag. Sample usage: {% autoescape on %} {{ body }} {% endautoescape %} When auto-escaping is in effect, all content derived from variables has HTML\nescaping applied before placing the result into the output (but after any\nfilters are applied). This is equivalent to manually applying the escape filter to each variable. The only exceptions are variables already marked as “safe” from escaping.\nVariables could be marked as “safe” by the code which populated the variable,\nby applying the safe or escape filters, or because it’s\nthe result of a previous filter that marked the string as “safe”. Within the scope of disabled auto-escaping, chaining filters, including escape , may cause unexpected (but documented) results such as the\nfollowing: {% autoescape off %} {{ my_list | join :\", \" | escape }} {% endautoescape %} The above code will output the joined elements of my_list unescaped. This\nis because the filter chaining sequence executes first join on my_list (without applying escaping to each item since autoescape is off ), marking the result as safe. Subsequently, this safe result will be\nfed to escape filter, which does not apply a second round of\nescaping. In order to properly escape every element in a sequence, use the escapeseq filter: {% autoescape off %} {{ my_list | escapeseq | join :\", \" }} {% endautoescape %} block ¶ Defines a block that can be overridden by child templates. See Template inheritance for more information. comment ¶ Ignores everything between {% comment %} and {% endcomment %} .\nAn optional note may be inserted in the first tag. For example, this is\nuseful when commenting out code for documenting why the code was disabled. Sample usage: < p > Rendered text with {{ pub_date | date :\"c\" }} </ p > {% comment \"Optional note\" %} < p > Commented out text with {{ create_date | date :\"c\" }} </ p > {% endcomment %} comment tags cannot be nested. csrf_token ¶ This tag is used for CSRF protection, as described in the documentation for Cross Site Request Forgeries . cycle ¶ Produces one of its arguments each time this tag is encountered. The first\nargument is produced on the first encounter, the second argument on the second\nencounter, and so forth. Once all arguments are exhausted, the tag cycles to\nthe first argument and produces it again. This tag is particularly useful in a loop: {% for o in some_list %} < tr class = \" {% cycle 'row1' 'row2' %} \" > ... </ tr > {% endfor %} The first iteration produces HTML that refers to class row1 , the second to row2 , the third to row1 again, and so on for each iteration of the\nloop. You can use variables, too. For example, if you have two template variables, rowvalue1 and rowvalue2 , you can alternate between their values like\nthis: {% for o in some_list %} < tr class = \" {% cycle rowvalue1 rowvalue2 %} \" > ... </ tr > {% endfor %} Variables included in the cycle will be escaped.  You can disable auto-escaping\nwith: {% for o in some_list %} < tr class = \" {% autoescape off %}{% cycle rowvalue1 rowvalue2 %}{% endautoescape %} \" > ... </ tr > {% endfor %} You can mix variables and strings: {% for o in some_list %} < tr class = \" {% cycle 'row1' rowvalue2 'row3' %} \" > ... </ tr > {% endfor %} In some cases you might want to refer to the current value of a cycle\nwithout advancing to the next value. To do this,\ngive the {% cycle %} tag a name, using “as”, like this: {% cycle 'row1' 'row2' as rowcolors %} From then on, you can insert the current value of the cycle wherever you’d like\nin your template by referencing the cycle name as a context variable. If you\nwant to move the cycle to the next value independently of the original cycle tag, you can use another cycle tag and specify the name of the\nvariable. So, the following template: < tr > < td class = \" {% cycle 'row1' 'row2' as rowcolors %} \" > ... </ td > < td class = \" {{ rowcolors }} \" > ... </ td > </ tr > < tr > < td class = \" {% cycle rowcolors %} \" > ... </ td > < td class = \" {{ rowcolors }} \" > ... </ td > </ tr > would output: < tr > < td class = \"row1\" > ... </ td > < td class = \"row1\" > ... </ td > </ tr > < tr > < td class = \"row2\" > ... </ td > < td class = \"row2\" > ... </ td > </ tr > You can use any number of values in a cycle tag, separated by spaces.\nValues enclosed in single quotes ( ' ) or double quotes ( \" ) are treated\nas string literals, while values without quotes are treated as template\nvariables. By default, when you use the as keyword with the cycle tag, the\nusage of {% cycle %} that initiates the cycle will itself produce\nthe first value in the cycle. This could be a problem if you want to\nuse the value in a nested loop or an included template. If you only want\nto declare the cycle but not produce the first value, you can add a silent keyword as the last keyword in the tag. For example: {% for obj in some_list %} {% cycle 'row1' 'row2' as rowcolors silent %} < tr class = \" {{ rowcolors }} \" > {% include \"subtemplate.html\" %} </ tr > {% endfor %} This will output a list of <tr> elements with class alternating between row1 and row2 . The subtemplate will have\naccess to rowcolors in its context and the value will match the class\nof the <tr> that encloses it. If the silent keyword were to be\nomitted, row1 and row2 would be emitted as normal text, outside the <tr> element. When the silent keyword is used on a cycle definition, the silence\nautomatically applies to all subsequent uses of that specific cycle tag.\nThe following template would output nothing , even though the second\ncall to {% cycle %} doesn’t specify silent : {% cycle 'row1' 'row2' as rowcolors silent %} {% cycle rowcolors %} You can use the resetcycle tag to make a {% cycle %} tag restart\nfrom its first value when it’s next encountered. debug ¶ Outputs a whole load of debugging information, including the current context\nand imported modules. {% debug %} outputs nothing when the DEBUG setting is False . extends ¶ Signals that this template extends a parent template. This tag can be used in two ways: {% extends \"base.html\" %} (with quotes) uses the literal value \"base.html\" as the name of the parent template to extend. {% extends variable %} uses the value of variable . If the variable\nevaluates to a string, Django will use that string as the name of the\nparent template. If the variable evaluates to a Template object,\nDjango will use that object as the parent template. See Template inheritance for more information. Normally the template name is relative to the template loader’s root directory.\nA string argument may also be a relative path starting with ./ or ../ .\nFor example, assume the following directory structure: dir1/\n    template.html\n    base2.html\n    my/\n        base3.html\nbase1.html In template.html , the following paths would be valid: {% extends \"./base2.html\" %} {% extends \"../base1.html\" %} {% extends \"./my/base3.html\" %} filter ¶ Filters the contents of the block through one or more filters. Multiple\nfilters can be specified with pipes and filters can have arguments, just as\nin variable syntax. Note that the block includes all the text between the filter and endfilter tags. Sample usage: {% filter force_escape | lower %} This text will be HTML-escaped, and will appear in all lowercase. {% endfilter %} Note The escape and safe filters are not acceptable\narguments. Instead, use the autoescape tag to manage autoescaping\nfor blocks of template code. firstof ¶ Outputs the first argument variable that is not “false” (i.e. exists, is not\nempty, is not a false boolean value, and is not a zero numeric value). Outputs\nnothing if all the passed variables are “false”. Sample usage: {% firstof var1 var2 var3 %} This is equivalent to: {% if var1 %} {{ var1 }} {% elif var2 %} {{ var2 }} {% elif var3 %} {{ var3 }} {% endif %} You can also use a literal string as a fallback value in case all\npassed variables are False: {% firstof var1 var2 var3 \"fallback value\" %} This tag auto-escapes variable values. You can disable auto-escaping with: {% autoescape off %} {% firstof var1 var2 var3 \"<strong>fallback value</strong>\" %} {% endautoescape %} Or if only some variables should be escaped, you can use: {% firstof var1 var2 | safe var3 \"<strong>fallback value</strong>\" | safe %} You can use the syntax {% firstof var1 var2 var3 as value %} to store the\noutput inside a variable. for ¶ Loops over each item in an array, making the item available in a context\nvariable. For example, to display a list of athletes provided in athlete_list : < ul > {% for athlete in athlete_list %} < li > {{ athlete.name }} </ li > {% endfor %} </ ul > You can loop over a list in reverse by using {% for obj in list reversed %} . If you need to loop over a list of lists, you can unpack the values\nin each sublist into individual variables. For example, if your context\ncontains a list of (x,y) coordinates called points , you could use the\nfollowing to output the list of points: {% for x , y in points %} There is a point at {{ x }} , {{ y }} {% endfor %} This can also be useful if you need to access the items in a dictionary.\nFor example, if your context contained a dictionary data , the following\nwould display the keys and values of the dictionary: {% for key , value in data.items %} {{ key }} : {{ value }} {% endfor %} Keep in mind that for the dot operator, dictionary key lookup takes precedence\nover method lookup. Therefore if the data dictionary contains a key named 'items' , data.items will return data['items'] instead of data.items() . Avoid adding keys that are named like dictionary methods if\nyou want to use those methods in a template ( items , values , keys ,\netc.). Read more about the lookup order of the dot operator in the documentation of template variables . The for loop sets a number of variables available within the loop: Variable Description forloop.counter The current iteration of the loop (1-indexed) forloop.counter0 The current iteration of the loop (0-indexed) forloop.revcounter The number of iterations from the end of the\nloop (1-indexed) forloop.revcounter0 The number of iterations from the end of the\nloop (0-indexed) forloop.first True if this is the first time through the loop forloop.last True if this is the last time through the loop forloop.parentloop For nested loops, this is the loop surrounding\nthe current one for … empty ¶ The for tag can take an optional {% empty %} clause whose text is\ndisplayed if the given array is empty or could not be found: < ul > {% for athlete in athlete_list %} < li > {{ athlete.name }} </ li > {% empty %} < li > Sorry, no athletes in this list. </ li > {% endfor %} </ ul > The above is equivalent to – but shorter, cleaner, and possibly faster\nthan – the following: < ul > {% if athlete_list %} {% for athlete in athlete_list %} < li > {{ athlete.name }} </ li > {% endfor %} {% else %} < li > Sorry, no athletes in this list. </ li > {% endif %} </ ul > if ¶ The {% if %} tag evaluates a variable, and if that variable is “true” (i.e.\nexists, is not empty, and is not a false boolean value) the contents of the\nblock are output: {% if athlete_list %} Number of athletes: {{ athlete_list | length }} {% elif athlete_in_locker_room_list %} Athletes should be out of the locker room soon! {% else %} No athletes. {% endif %} In the above, if athlete_list is not empty, the number of athletes will be\ndisplayed by the {{ athlete_list|length }} variable. As you can see, the if tag may take one or several {% elif %} clauses, as well as an {% else %} clause that will be displayed if all\nprevious conditions fail. These clauses are optional. Boolean operators ¶ if tags may use and , or or not to test a number of\nvariables or to negate a given variable: {% if athlete_list and coach_list %} Both athletes and coaches are available. {% endif %} {% if not athlete_list %} There are no athletes. {% endif %} {% if athlete_list or coach_list %} There are some athletes or some coaches. {% endif %} {% if not athlete_list or coach_list %} There are no athletes or there are some coaches. {% endif %} {% if athlete_list and not coach_list %} There are some athletes and absolutely no coaches. {% endif %} Use of both and and or clauses within the same tag is allowed, with and having higher precedence than or e.g.: {% if athlete_list and coach_list or cheerleader_list %} will be interpreted like: if ( athlete_list and coach_list ) or cheerleader_list : ... Use of actual parentheses in the if tag is invalid syntax. If you need\nthem to indicate precedence, you should use nested if tags. if tags may also use the operators == , != , < , > , <= , >= , in , not in , is , and is not which work as\nfollows: == operator ¶ Equality. Example: {% if somevar == \"x\" %} This appears if variable somevar equals the string \"x\" {% endif %} != operator ¶ Inequality. Example: {% if somevar != \"x\" %} This appears if variable somevar does not equal the string \"x\",\n  or if somevar is not found in the context {% endif %} < operator ¶ Less than. Example: {% if somevar < 100 %} This appears if variable somevar is less than 100. {% endif %} > operator ¶ Greater than. Example: {% if somevar > 0 %} This appears if variable somevar is greater than 0. {% endif %} <= operator ¶ Less than or equal to. Example: {% if somevar <= 100 %} This appears if variable somevar is less than 100 or equal to 100. {% endif %} >= operator ¶ Greater than or equal to. Example: {% if somevar >= 1 %} This appears if variable somevar is greater than 1 or equal to 1. {% endif %} in operator ¶ Contained within. This operator is supported by many Python containers to test\nwhether the given value is in the container. The following are some examples\nof how x in y will be interpreted: {% if \"bc\" in \"abcdef\" %} This appears since \"bc\" is a substring of \"abcdef\" {% endif %} {% if \"hello\" in greetings %} If greetings is a list or set, one element of which is the string\n  \"hello\", this will appear. {% endif %} {% if user in users %} If users is a QuerySet, this will appear if user is an\n  instance that belongs to the QuerySet. {% endif %} not in operator ¶ Not contained within. This is the negation of the in operator. is operator ¶ Object identity. Tests if two values are the same object. Example: {% if somevar is True %} This appears if and only if somevar is True. {% endif %} {% if somevar is None %} This appears if somevar is None, or if somevar is not found in the context. {% endif %} is not operator ¶ Negated object identity. Tests if two values are not the same object. This is\nthe negation of the is operator. Example: {% if somevar is not True %} This appears if somevar is not True, or if somevar is not found in the\n  context. {% endif %} {% if somevar is not None %} This appears if and only if somevar is not None. {% endif %} Filters ¶ You can also use filters in the if expression. For example: {% if messages | length >= 100 %} You have lots of messages today! {% endif %} Complex expressions ¶ All of the above can be combined to form complex expressions. For such\nexpressions, it can be important to know how the operators are grouped when the\nexpression is evaluated - that is, the precedence rules. The precedence of the\noperators, from lowest to highest, is as follows: or and not in == , != , < , > , <= , >= (This follows Python exactly). So, for example, the following complex if tag: {% if a == b or c == d and e %} …will be interpreted as: ( a == b ) or (( c == d ) and e ) If you need different precedence, you will need to use nested if tags.\nSometimes that is better for clarity anyway, for the sake of those who do not\nknow the precedence rules. The comparison operators cannot be ‘chained’ like in Python or in mathematical\nnotation. For example, instead of using: {% if a > b > c %} (WRONG) you should use: {% if a > b and b > c %} ifchanged ¶ Check if a value has changed from the last iteration of a loop. The {% ifchanged %} block tag is used within a loop. It has two possible\nuses. Checks its own rendered contents against its previous state and only\ndisplays the content if it has changed. For example, this displays a list of\ndays, only displaying the month if it changes: < h1 > Archive for {{ year }} </ h1 > {% for date in days %} {% ifchanged %} < h3 > {{ date | date :\"F\" }} </ h3 > {% endifchanged %} < a href = \" {{ date | date :\"M/d\" | lower }} /\" > {{ date | date :\"j\" }} </ a > {% endfor %} If given one or more variables, check whether any variable has changed.\nFor example, the following shows the date every time it changes, while\nshowing the hour if either the hour or the date has changed: {% for date in days %} {% ifchanged date.date %} {{ date.date }} {% endifchanged %} {% ifchanged date.hour date.date %} {{ date.hour }} {% endifchanged %} {% endfor %} The ifchanged tag can also take an optional {% else %} clause that\nwill be displayed if the value has not changed: {% for match in matches %} < div style = \"background-color: {% ifchanged match.ballot_id %} {% cycle \"red\" \"blue\" %} {% else %} gray {% endifchanged %} \" > {{ match }} </ div > {% endfor %} include ¶ Loads a template and renders it with the current context. This is a way of\n“including” other templates within a template. The template name can either be a variable or a hard-coded (quoted) string,\nin either single or double quotes. This example includes the contents of the template \"foo/bar.html\" : {% include \"foo/bar.html\" %} Normally the template name is relative to the template loader’s root directory.\nA string argument may also be a relative path starting with ./ or ../ as described in the extends tag. This example includes the contents of the template whose name is contained in\nthe variable template_name : {% include template_name %} The variable may also be any object with a render() method that accepts a\ncontext. This allows you to reference a compiled Template in your context. Additionally, the variable may be an iterable of template names, in which case\nthe first that can be loaded will be used, as per select_template() . An included template is rendered within the context of the template that\nincludes it. This example produces the output \"Hello, John!\" : Context: variable person is set to \"John\" and variable greeting is set to \"Hello\" . Template: {% include \"name_snippet.html\" %} The name_snippet.html template: {{ greeting }} , {{ person | default :\"friend\" }} ! You can pass additional context to the template using keyword arguments: {% include \"name_snippet.html\" with person = \"Jane\" greeting = \"Hello\" %} If you want to render the context only with the variables provided (or even\nno variables at all), use the only option. No other variables are\navailable to the included template: {% include \"name_snippet.html\" with greeting = \"Hi\" only %} Note The include tag should be considered as an implementation of\n“render this subtemplate and include the HTML”, not as “parse this\nsubtemplate and include its contents as if it were part of the parent”.\nThis means that there is no shared state between included templates –\neach include is a completely independent rendering process. Blocks are evaluated before they are included. This means that a template\nthat includes blocks from another will contain blocks that have already\nbeen evaluated and rendered - not blocks that can be overridden by, for\nexample, an extending template. load ¶ Loads a custom template tag set. For example, the following template would load all the tags and filters\nregistered in somelibrary and otherlibrary located in package package : {% load somelibrary package.otherlibrary %} You can also selectively load individual filters or tags from a library, using\nthe from argument. In this example, the template tags/filters named foo and bar will be loaded from somelibrary : {% load foo bar from somelibrary %} See Custom tag and filter libraries for\nmore information. lorem ¶ Displays random “lorem ipsum” Latin text. This is useful for providing sample\ndata in templates. Usage: {% lorem [ count ] [ method ] [ random ] %} The {% lorem %} tag can be used with zero, one, two or three arguments.\nThe arguments are: Argument Description count A number (or variable) containing the number of paragraphs or\nwords to generate (default is 1). method Either w for words, p for HTML paragraphs or b for plain-text paragraph blocks (default is b ). random The word random , which if given, does not use the common\nparagraph (“Lorem ipsum dolor sit amet…”) when generating\ntext. Examples: {% lorem %} will output the common “lorem ipsum” paragraph. {% lorem 3 p %} will output the common “lorem ipsum” paragraph\nand two random paragraphs each wrapped in HTML <p> tags. {% lorem 2 w random %} will output two random Latin words. now ¶ Displays the current date and/or time, using a format according to the given\nstring. Such string can contain format specifiers characters as described\nin the date filter section. Example: It is {% now \"jS F Y H:i\" %} Note that you can backslash-escape a format string if you want to use the\n“raw” value. In this example, both “o” and “f” are backslash-escaped, because\notherwise each is a format string that displays the year and the time,\nrespectively: It is the {% now \"jS \\o\\f F\" %} This would display as “It is the 4th of September”. Note The format passed can also be one of the predefined ones DATE_FORMAT , DATETIME_FORMAT , SHORT_DATE_FORMAT or SHORT_DATETIME_FORMAT .\nThe predefined formats may vary depending on the current locale and\nif Format localization is enabled, e.g.: It is {% now \"SHORT_DATETIME_FORMAT\" %} You can also use the syntax {% now \"Y\" as current_year %} to store the\noutput (as a string) inside a variable. This is useful if you want to use {% now %} inside a template tag like blocktranslate for example: {% now \"Y\" as current_year %} {% blocktranslate %} Copyright {{ current_year }}{% endblocktranslate %} querystring ¶ New in Django 5.1. Outputs a URL-encoded formatted query string based on the provided parameters. This tag requires a QueryDict instance, which defaults to request.GET if none is provided. If the QueryDict is empty and no additional parameters\nare provided, an empty string is returned. A non-empty result includes a\nleading \"?\" . Using request.GET as default To use request.GET as the default QueryDict instance, the django.template.context_processors.request context processor should be\nenabled. If it’s not enabled, you must either explicitly pass the request object into the template context, or provide a QueryDict instance to this tag. Basic usage ¶ {% querystring %} Outputs the current query string verbatim. So if the query string is ?color=green , the output would be ?color=green . {% querystring size = \"M\" %} Outputs the current query string with the addition of the size parameter.\nFollowing the previous example, the output would be ?color=green&size=M . Custom QueryDict ¶ {% querystring my_query_dict %} You can provide a custom QueryDict to be used instead of request.GET .\nSo if my_query_dict is <QueryDict: {'color': ['blue']}> , this outputs ?color=blue . Setting items ¶ {% querystring color = \"red\" size = \"S\" %} Adds or modifies parameters in the query string. Each keyword argument will be\nadded to the query string, replacing any existing value for that key. For\ninstance, if the current query string is ?color=green , the output will be ?color=red&size=S . Removing items ¶ {% querystring color = None %} Passing None as the value removes the parameter from the query string. For\nexample, if the current query string is ?color=green&size=M , the output\nwill be ?size=M . Handling lists ¶ {% querystring color = my_list %} If my_list is [\"red\", \"blue\"] , the output will be ?color=red&color=blue , preserving the list structure in the query string. Dynamic usage ¶ A common example of using this tag is to preserve the current query string when\ndisplaying a page of results, while adding a link to the next and previous\npages of results. For example, if the paginator is currently on page 3, and the\ncurrent query string is ?color=blue&size=M&page=3 , the following code would\noutput ?color=blue&size=M&page=4 : {% querystring page = page.next_page_number %} You can also store the value in a variable. For example, if you need multiple\nlinks to the same page, define it as: {% querystring page = page.next_page_number as next_page %} regroup ¶ Regroups a list of alike objects by a common attribute. This complex tag is best illustrated by way of an example: say that cities is a list of cities represented by dictionaries containing \"name\" , \"population\" , and \"country\" keys: cities = [ { \"name\" : \"Mumbai\" , \"population\" : \"19,000,000\" , \"country\" : \"India\" }, { \"name\" : \"Calcutta\" , \"population\" : \"15,000,000\" , \"country\" : \"India\" }, { \"name\" : \"New York\" , \"population\" : \"20,000,000\" , \"country\" : \"USA\" }, { \"name\" : \"Chicago\" , \"population\" : \"7,000,000\" , \"country\" : \"USA\" }, { \"name\" : \"Tokyo\" , \"population\" : \"33,000,000\" , \"country\" : \"Japan\" }, ] …and you’d like to display a hierarchical list that is ordered by country,\nlike this: India Mumbai: 19,000,000 Calcutta: 15,000,000 USA New York: 20,000,000 Chicago: 7,000,000 Japan Tokyo: 33,000,000 You can use the {% regroup %} tag to group the list of cities by country.\nThe following snippet of template code would accomplish this: {% regroup cities by country as country_list %} < ul > {% for country in country_list %} < li > {{ country.grouper }} < ul > {% for city in country.list %} < li > {{ city.name }} : {{ city.population }} </ li > {% endfor %} </ ul > </ li > {% endfor %} </ ul > Let’s walk through this example. {% regroup %} takes three arguments: the\nlist you want to regroup, the attribute to group by, and the name of the\nresulting list. Here, we’re regrouping the cities list by the country attribute and calling the result country_list . {% regroup %} produces a list (in this case, country_list ) of group objects . Group objects are instances of namedtuple() with two fields: grouper – the item that was grouped by (e.g., the string “India” or\n“Japan”). list – a list of all items in this group (e.g., a list of all cities\nwith country=’India’). Because {% regroup %} produces namedtuple() objects,\nyou can also write the previous example as: {% regroup cities by country as country_list %} < ul > {% for country , local_cities in country_list %} < li > {{ country }} < ul > {% for city in local_cities %} < li > {{ city.name }} : {{ city.population }} </ li > {% endfor %} </ ul > </ li > {% endfor %} </ ul > Note that {% regroup %} does not order its input! Our example relies on\nthe fact that the cities list was ordered by country in the first place.\nIf the cities list did not order its members by country , the\nregrouping would naively display more than one group for a single country. For\nexample, say the cities list was set to this (note that the countries are not\ngrouped together): cities = [ { \"name\" : \"Mumbai\" , \"population\" : \"19,000,000\" , \"country\" : \"India\" }, { \"name\" : \"New York\" , \"population\" : \"20,000,000\" , \"country\" : \"USA\" }, { \"name\" : \"Calcutta\" , \"population\" : \"15,000,000\" , \"country\" : \"India\" }, { \"name\" : \"Chicago\" , \"population\" : \"7,000,000\" , \"country\" : \"USA\" }, { \"name\" : \"Tokyo\" , \"population\" : \"33,000,000\" , \"country\" : \"Japan\" }, ] With this input for cities , the example {% regroup %} template code\nabove would result in the following output: India Mumbai: 19,000,000 USA New York: 20,000,000 India Calcutta: 15,000,000 USA Chicago: 7,000,000 Japan Tokyo: 33,000,000 The easiest solution to this gotcha is to make sure in your view code that the\ndata is ordered according to how you want to display it. Another solution is to sort the data in the template using the dictsort filter, if your data is in a list of dictionaries: {% regroup cities | dictsort :\"country\" by country as country_list %} Grouping on other properties ¶ Any valid template lookup is a legal grouping attribute for the regroup\ntag, including methods, attributes, dictionary keys and list items. For\nexample, if the “country” field is a foreign key to a class with\nan attribute “description,” you could use: {% regroup cities by country.description as country_list %} Or, if country is a field with choices , it will have a get_FOO_display() method available as an\nattribute, allowing  you to group on the display string rather than the choices key: {% regroup cities by get_country_display as country_list %} {{ country.grouper }} will now display the value fields from the choices set rather than the keys. resetcycle ¶ Resets a previous cycle so that it restarts from its first item at its next\nencounter. Without arguments, {% resetcycle %} will reset the last {% cycle %} defined in the template. Example usage: {% for coach in coach_list %} < h1 > {{ coach.name }} </ h1 > {% for athlete in coach.athlete_set.all %} < p class = \" {% cycle 'odd' 'even' %} \" > {{ athlete.name }} </ p > {% endfor %} {% resetcycle %} {% endfor %} This example would return this HTML: < h1 > Gareth </ h1 > < p class = \"odd\" > Harry </ p > < p class = \"even\" > John </ p > < p class = \"odd\" > Nick </ p > < h1 > John </ h1 > < p class = \"odd\" > Andrea </ p > < p class = \"even\" > Melissa </ p > Notice how the first block ends with class=\"odd\" and the new one starts\nwith class=\"odd\" . Without the {% resetcycle %} tag, the second block\nwould start with class=\"even\" . You can also reset named cycle tags: {% for item in list %} < p class = \" {% cycle 'odd' 'even' as stripe %} {% cycle 'major' 'minor' 'minor' 'minor' 'minor' as tick %} \" > {{ item.data }} </ p > {% ifchanged item.category %} < h1 > {{ item.category }} </ h1 > {% if not forloop .first %}{% resetcycle tick %}{% endif %} {% endifchanged %} {% endfor %} In this example, we have both the alternating odd/even rows and a “major” row\nevery fifth row. Only the five-row cycle is reset when a category changes. spaceless ¶ Removes whitespace between HTML tags. This includes tab\ncharacters and newlines. Example usage: {% spaceless %} < p > < a href = \"foo/\" > Foo </ a > </ p > {% endspaceless %} This example would return this HTML: < p >< a href = \"foo/\" > Foo </ a ></ p > Only space between tags is removed – not space between tags and text. In\nthis example, the space around Hello won’t be stripped: {% spaceless %} < strong > Hello </ strong > {% endspaceless %} templatetag ¶ Outputs one of the syntax characters used to compose template tags. The template system has no concept of “escaping” individual characters.\nHowever, you can use the {% templatetag %} tag to display one of the\ntemplate tag character combinations. The argument tells which template bit to output: Argument Outputs openblock {% closeblock %} openvariable {{ closevariable }} openbrace { closebrace } opencomment {# closecomment #} Sample usage: The {% templatetag openblock %} characters open a block. See also the verbatim tag for another way of including these\ncharacters. url ¶ Returns an absolute path reference (a URL without the domain name) matching a\ngiven view and optional parameters. Any special characters in the resulting\npath will be encoded using iri_to_uri() . This is a way to output links without violating the DRY principle by having to\nhard-code URLs in your templates: {% url 'some-url-name' v1 v2 %} The first argument is a URL pattern name . It can\nbe a quoted literal or any other context variable. Additional arguments are\noptional and should be space-separated values that will be used as arguments in\nthe URL. The example above shows passing positional arguments. Alternatively\nyou may use keyword syntax: {% url 'some-url-name' arg1 = v1 arg2 = v2 %} Do not mix both positional and keyword syntax in a single call. All arguments\nrequired by the URLconf should be present. For example, suppose you have a view, app_views.client , whose URLconf\ntakes a client ID (here, client() is a method inside the views file app_views.py ). The URLconf line might look like this: path ( \"client/<int:id>/\" , app_views . client , name = \"app-views-client\" ) If this app’s URLconf is included into the project’s URLconf under a path\nsuch as this: path ( \"clients/\" , include ( \"project_name.app_name.urls\" )) …then, in a template, you can create a link to this view like this: {% url 'app-views-client' client.id %} The template tag will output the string /clients/client/123/ . Note that if the URL you’re reversing doesn’t exist, you’ll get an NoReverseMatch exception raised, which will cause your\nsite to display an error page. If you’d like to retrieve a URL without displaying it, you can use a slightly\ndifferent call: {% url 'some-url-name' arg arg2 as the_url %} < a href = \" {{ the_url }} \" > I'm linking to {{ the_url }} </ a > The scope of the variable created by the as var syntax is the {% block %} in which the {% url %} tag appears. This {% url ... as var %} syntax will not cause an error if the view is\nmissing. In practice you’ll use this to link to views that are optional: {% url 'some-url-name' as the_url %} {% if the_url %} < a href = \" {{ the_url }} \" > Link to optional stuff </ a > {% endif %} If you’d like to retrieve a namespaced URL, specify the fully qualified name: {% url 'myapp:view-name' %} This will follow the normal namespaced URL resolution strategy , including using any hints provided\nby the context as to the current application. Warning Don’t forget to put quotes around the URL pattern name , otherwise the\nvalue will be interpreted as a context variable! verbatim ¶ Stops the template engine from rendering the contents of this block tag. A common use is to allow a JavaScript template layer that collides with\nDjango’s syntax. For example: {% verbatim %} {{ if dying }} Still alive. {{ / if }} {% endverbatim %} You can also designate a specific closing tag, allowing the use of {% endverbatim %} as part of the unrendered contents: {% verbatim myblock %} Avoid template rendering via the {% verbatim %}{% endverbatim %} block. {% endverbatim myblock %} widthratio ¶ For creating bar charts and such, this tag calculates the ratio of a given\nvalue to a maximum value, and then applies that ratio to a constant. For example: < img src = \"bar.png\" alt = \"Bar\" height = \"10\" width = \" {% widthratio this_value max_value max_width %} \" > If this_value is 175, max_value is 200, and max_width is 100, the\nimage in the above example will be 88 pixels wide\n(because 175/200 = .875; .875 * 100 = 87.5 which is rounded up to 88). In some cases you might want to capture the result of widthratio in a\nvariable. It can be useful, for instance, in a blocktranslate like this: {% widthratio this_value max_value max_width as width %} {% blocktranslate %} The width is: {{ width }}{% endblocktranslate %} with ¶ Caches a complex variable under a simpler name. This is useful when accessing\nan “expensive” method (e.g., one that hits the database) multiple times. For example: {% with total = business.employees.count %} {{ total }} employee {{ total | pluralize }} {% endwith %} The populated variable (in the example above, total ) is only available\nbetween the {% with %} and {% endwith %} tags. You can assign more than one context variable: {% with alpha = 1 beta = 2 %} ... {% endwith %} Note The previous more verbose format is still supported: {% with business.employees.count as total %} Built-in filter reference ¶ add ¶ Adds the argument to the value. For example: {{ value | add :\"2\" }} If value is 4 , then the output will be 6 . This filter will first try to coerce both values to integers. If this fails,\nit’ll attempt to add the values together anyway. This will work on some data\ntypes (strings, list, etc.) and fail on others. If it fails, the result will\nbe an empty string. For example, if we have: {{ first | add : second }} and first is [1, 2, 3] and second is [4, 5, 6] , then the\noutput will be [1, 2, 3, 4, 5, 6] . Warning Strings that can be coerced to integers will be summed , not\nconcatenated, as in the first example above. addslashes ¶ Adds slashes before quotes. Useful for escaping strings in CSV, for example. For example: {{ value | addslashes }} If value is \"I'm using Django\" , the output will be \"I\\'m using Django\" . capfirst ¶ Capitalizes the first character of the value. If the first character is not\na letter, this filter has no effect. For example: {{ value | capfirst }} If value is \"django\" , the output will be \"Django\" . center ¶ Centers the value in a field of a given width. For example: \" {{ value | center :\"15\" }} \" If value is \"Django\" , the output will be \" Django \" . cut ¶ Removes all values of arg from the given string. For example: {{ value | cut :\" \" }} If value is \"String with spaces\" , the output will be \"Stringwithspaces\" . date ¶ Formats a date according to the given format. Uses a similar format to PHP’s date() function with some\ndifferences. Note These format characters are not used in Django outside of templates. They\nwere designed to be compatible with PHP to ease transitioning for designers. Available format strings: Format character Description Example output Day d Day of the month, 2 digits with\nleading zeros. '01' to '31' j Day of the month without leading\nzeros. '1' to '31' D Day of the week, textual, 3 letters. 'Fri' l Day of the week, textual, long. 'Friday' S English ordinal suffix for day of the\nmonth, 2 characters. 'st' , 'nd' , 'rd' or 'th' w Day of the week, digits without\nleading zeros. '0' (Sunday) to '6' (Saturday) z Day of the year. 1 to 366 Week W ISO-8601 week number of year, with\nweeks starting on Monday. 1 , 53 Month m Month, 2 digits with leading zeros. '01' to '12' n Month without leading zeros. '1' to '12' M Month, textual, 3 letters. 'Jan' b Month, textual, 3 letters, lowercase. 'jan' E Month, locale specific alternative\nrepresentation usually used for long\ndate representation. 'listopada' (for Polish locale, as opposed to 'Listopad' ) F Month, textual, long. 'January' N Month abbreviation in Associated Press\nstyle. Proprietary extension. 'Jan.' , 'Feb.' , 'March' , 'May' t Number of days in the given month. 28 to 31 Year y Year, 2 digits with leading zeros. '00' to '99' Y Year, 4 digits with leading zeros. '0001' , …, '1999' , …, '9999' L Boolean for whether it’s a leap year. True or False o ISO-8601 week-numbering year,\ncorresponding to the ISO-8601 week\nnumber (W) which uses leap weeks. See Y\nfor the more common year format. '1999' Time g Hour, 12-hour format without leading\nzeros. '1' to '12' G Hour, 24-hour format without leading\nzeros. '0' to '23' h Hour, 12-hour format. '01' to '12' H Hour, 24-hour format. '00' to '23' i Minutes. '00' to '59' s Seconds, 2 digits with leading zeros. '00' to '59' u Microseconds. 000000 to 999999 a 'a.m.' or 'p.m.' (Note that\nthis is slightly different than PHP’s\noutput, because this includes periods\nto match Associated Press style.) 'a.m.' A 'AM' or 'PM' . 'AM' f Time, in 12-hour hours and minutes,\nwith minutes left off if they’re zero.\nProprietary extension. '1' , '1:30' P Time, in 12-hour hours, minutes and\n‘a.m.’/’p.m.’, with minutes left off\nif they’re zero and the special-case\nstrings ‘midnight’ and ‘noon’ if\nappropriate. Proprietary extension. '1 a.m.' , '1:30 p.m.' , 'midnight' , 'noon' , '12:30 p.m.' Timezone e Timezone name. Could be in any format,\nor might return an empty string,\ndepending on the datetime. '' , 'GMT' , '-500' , 'US/Eastern' , etc. I Daylight saving time, whether it’s in\neffect or not. '1' or '0' O Difference to Greenwich time in hours. '+0200' T Time zone of this machine. 'EST' , 'MDT' Z Time zone offset in seconds. The\noffset for timezones west of UTC is\nalways negative, and for those east of\nUTC is always positive. -43200 to 43200 Date/Time c ISO 8601 format. (Note: unlike other\nformatters, such as “Z”, “O” or “r”,\nthe “c” formatter will not add timezone\noffset if value is a naive datetime\n(see datetime.tzinfo ). 2008-01-02T10:30:00.000123+02:00 ,\nor 2008-01-02T10:30:00.000123 if the datetime is naive r RFC 5322 formatted date. 'Thu, 21 Dec 2000 16:01:07 +0200' U Seconds since the Unix Epoch\n(January 1 1970 00:00:00 UTC). For example: {{ value | date :\"D d M Y\" }} If value is a datetime object (e.g., the result of datetime.datetime.now() ), the output will be the string 'Wed 09 Jan 2008' . The format passed can be one of the predefined ones DATE_FORMAT , DATETIME_FORMAT , SHORT_DATE_FORMAT or SHORT_DATETIME_FORMAT , or a custom format that uses the format\nspecifiers shown in the table above. Note that predefined formats may vary\ndepending on the current locale. Assuming that LANGUAGE_CODE is, for example, \"es\" , then for: {{ value | date :\"SHORT_DATE_FORMAT\" }} the output would be the string \"09/01/2008\" (the \"SHORT_DATE_FORMAT\" format specifier for the es locale as shipped with Django is \"d/m/Y\" ). When used without a format string, the DATE_FORMAT format specifier is\nused. Assuming the same settings as the previous example: {{ value | date }} outputs 9 de Enero de 2008 (the DATE_FORMAT format specifier for the es locale is r'j \\d\\e F \\d\\e Y' ). Both “d” and “e” are\nbackslash-escaped, because otherwise each is a format string that displays the\nday and the timezone name, respectively. You can combine date with the time filter to render a full\nrepresentation of a datetime value. E.g.: {{ value | date :\"D d M Y\" }} {{ value | time :\"H:i\" }} default ¶ If value evaluates to False , uses the given default. Otherwise, uses the\nvalue. For example: {{ value | default :\"nothing\" }} If value is \"\" (the empty string), the output will be nothing . default_if_none ¶ If (and only if) value is None , uses the given default. Otherwise, uses the\nvalue. Note that if an empty string is given, the default value will not be used.\nUse the default filter if you want to fallback for empty strings. For example: {{ value | default_if_none :\"nothing\" }} If value is None , the output will be nothing . dictsort ¶ Takes a list of dictionaries and returns that list sorted by the key given in\nthe argument. For example: {{ value | dictsort :\"name\" }} If value is: [ { \"name\" : \"zed\" , \"age\" : 19 }, { \"name\" : \"amy\" , \"age\" : 22 }, { \"name\" : \"joe\" , \"age\" : 31 }, ] then the output would be: [ { \"name\" : \"amy\" , \"age\" : 22 }, { \"name\" : \"joe\" , \"age\" : 31 }, { \"name\" : \"zed\" , \"age\" : 19 }, ] You can also do more complicated things like: {% for book in books | dictsort :\"author.age\" %} * {{ book.title }} ( {{ book.author.name }} ) {% endfor %} If books is: [ { \"title\" : \"1984\" , \"author\" : { \"name\" : \"George\" , \"age\" : 45 }}, { \"title\" : \"Timequake\" , \"author\" : { \"name\" : \"Kurt\" , \"age\" : 75 }}, { \"title\" : \"Alice\" , \"author\" : { \"name\" : \"Lewis\" , \"age\" : 33 }}, ] then the output would be: * Alice (Lewis)\n* 1984 (George)\n* Timequake (Kurt) dictsort can also order a list of lists (or any other object implementing __getitem__() ) by elements at specified index. For example: {{ value | dictsort : 0 }} If value is: [ ( \"a\" , \"42\" ), ( \"c\" , \"string\" ), ( \"b\" , \"foo\" ), ] then the output would be: [ ( \"a\" , \"42\" ), ( \"b\" , \"foo\" ), ( \"c\" , \"string\" ), ] You must pass the index as an integer rather than a string. The following\nproduce empty output: {{ values | dictsort :\"0\" }} Ordering by elements at specified index is not supported on dictionaries. dictsortreversed ¶ Takes a list of dictionaries and returns that list sorted in reverse order by\nthe key given in the argument. This works exactly the same as the above filter,\nbut the returned value will be in reverse order. divisibleby ¶ Returns True if the value is divisible by the argument. For example: {{ value | divisibleby :\"3\" }} If value is 21 , the output would be True . escape ¶ Escapes a string’s HTML. Specifically, it makes these replacements: < is converted to &lt; > is converted to &gt; ' (single quote) is converted to &#x27; \" (double quote) is converted to &quot; & is converted to &amp; Applying escape to a variable that would normally have auto-escaping\napplied to the result will only result in one round of escaping being done. So\nit is safe to use this function even in auto-escaping environments. If you want\nmultiple escaping passes to be applied, use the force_escape filter. For example, you can apply escape to fields when autoescape is off: {% autoescape off %} {{ title | escape }} {% endautoescape %} Chaining escape with other filters As mentioned in the autoescape section, when filters including escape are chained together, it can result in unexpected outcomes if\npreceding filters mark a potentially unsafe string as safe due to the lack\nof escaping caused by autoescape being off . In such cases, chaining escape would not reescape strings that have\nalready been marked as safe. This is especially important when using filters that operate on sequences,\nfor example join . If you need to escape each element in a\nsequence, use the dedicated escapeseq filter. escapejs ¶ Escapes characters for use as a whole JavaScript string literal, within single\nor double quotes, as below. This filter does not make the string safe for use\nin “JavaScript template literals” (the JavaScript backtick syntax). Any other\nuses not listed above are not supported. It is generally recommended that data\nshould be passed using HTML data- attributes, or the json_script filter, rather than in embedded JavaScript. For example: < script > let myValue = ' {{ value | escapejs }} ' escapeseq ¶ New in Django 5.0. Applies the escape filter to each element of a sequence. Useful in\nconjunction with other filters that operate on sequences, such as join . For example: {% autoescape off %} {{ my_list | escapeseq | join :\", \" }} {% endautoescape %} filesizeformat ¶ Formats the value like a ‘human-readable’ file size (i.e. '13 KB' , '4.1 MB' , '102 bytes' , etc.). For example: {{ value | filesizeformat }} If value is 123456789, the output would be 117.7 MB . File sizes and SI units Strictly speaking, filesizeformat does not conform to the International\nSystem of Units which recommends using KiB, MiB, GiB, etc. when byte sizes\nare calculated in powers of 1024 (which is the case here). Instead, Django\nuses traditional unit names (KB, MB, GB, etc.) corresponding to names that\nare more commonly used. first ¶ Returns the first item in a list. For example: {{ value | first }} If value is the list ['a', 'b', 'c'] , the output will be 'a' . floatformat ¶ When used without an argument, rounds a floating-point number to one decimal\nplace – but only if there’s a decimal part to be displayed. For example: value Template Output 34.23234 {{ value|floatformat }} 34.2 34.00000 {{ value|floatformat }} 34 34.26000 {{ value|floatformat }} 34.3 If used with a numeric integer argument, floatformat rounds a number to\nthat many decimal places. For example: value Template Output 34.23234 {{ value|floatformat:3 }} 34.232 34.00000 {{ value|floatformat:3 }} 34.000 34.26000 {{ value|floatformat:3 }} 34.260 Particularly useful is passing 0 (zero) as the argument which will round the\nfloat to the nearest integer. value Template Output 34.23234 {{ value|floatformat:\"0\" }} 34 34.00000 {{ value|floatformat:\"0\" }} 34 39.56000 {{ value|floatformat:\"0\" }} 40 If the argument passed to floatformat is negative, it will round a number\nto that many decimal places – but only if there’s a decimal part to be\ndisplayed. For example: value Template Output 34.23234 {{ value|floatformat:\"-3\" }} 34.232 34.00000 {{ value|floatformat:\"-3\" }} 34 34.26000 {{ value|floatformat:\"-3\" }} 34.260 If the argument passed to floatformat has the g suffix, it will force\ngrouping by the THOUSAND_SEPARATOR for the active locale. For\nexample, when the active locale is en (English): value Template Output 34232.34 {{ value|floatformat:\"2g\" }} 34,232.34 34232.06 {{ value|floatformat:\"g\" }} 34,232.1 34232.00 {{ value|floatformat:\"-3g\" }} 34,232 Output is always localized (independently of the {% localize off %} tag) unless the argument passed to floatformat has the u suffix, which will force disabling localization. For example, when the active\nlocale is pl (Polish): value Template Output 34.23234 {{ value|floatformat:\"3\" }} 34,232 34.23234 {{ value|floatformat:\"3u\" }} 34.232 Using floatformat with no argument is equivalent to using floatformat with an argument of -1 . force_escape ¶ Applies HTML escaping to a string (see the escape filter for\ndetails). This filter is applied immediately and returns a new, escaped\nstring. This is useful in the rare cases where you need multiple escaping or\nwant to apply other filters to the escaped results. Normally, you want to use\nthe escape filter. For example, if you want to catch the <p> HTML elements created by\nthe linebreaks filter: {% autoescape off %} {{ body | linebreaks | force_escape }} {% endautoescape %} get_digit ¶ Given a whole number, returns the requested digit, where 1 is the right-most\ndigit, 2 is the second-right-most digit, etc. Returns the original value for\ninvalid input (if input or argument is not an integer, or if argument is less\nthan 1). Otherwise, output is always an integer. For example: {{ value | get_digit :\"2\" }} If value is 123456789 , the output will be 8 . iriencode ¶ Converts an IRI (Internationalized Resource Identifier) to a string that is\nsuitable for including in a URL. This is necessary if you’re trying to use\nstrings containing non-ASCII characters in a URL. It’s safe to use this filter on a string that has already gone through the urlencode filter. For example: {{ value | iriencode }} If value is \"?test=I ♥ Django\" , the output will be \"?test=I%20%E2%99%A5%20Django\" . join ¶ Joins a list with a string, like Python’s str.join(list) For example: {{ value | join :\" // \" }} If value is the list ['a', 'b', 'c'] , the output will be the string \"a // b // c\" . json_script ¶ Safely outputs a Python object as JSON, wrapped in a <script> tag, ready\nfor use with JavaScript. Argument: The optional HTML “id” of the <script> tag. For example: {{ value | json_script :\"hello-data\" }} If value is the dictionary {'hello': 'world'} , the output will be: < script id = \"hello-data\" type = \"application/json\" >{ \"hello\" : \"world\" }</ script > The resulting data can be accessed in JavaScript like this: const value = JSON . parse ( document . getElementById ( 'hello-data' ). textContent ); XSS attacks are mitigated by escaping the characters “<”, “>” and “&”. For\nexample if value is {'hello': 'world</script>&amp;'} , the output is: < script id = \"hello-data\" type = \"application/json\" >{ \"hello\" : \"world\\\\u003C/script\\\\u003E\\\\u0026amp;\" }</ script > This is compatible with a strict Content Security Policy that prohibits in-page\nscript execution. It also maintains a clean separation between passive data and\nexecutable code. last ¶ Returns the last item in a list. For example: {{ value | last }} If value is the list ['a', 'b', 'c', 'd'] , the output will be the\nstring \"d\" . length ¶ Returns the length of the value. This works for both strings and lists. For example: {{ value | length }} If value is ['a', 'b', 'c', 'd'] or \"abcd\" , the output will be 4 . The filter returns 0 for an undefined variable. linebreaks ¶ Replaces line breaks in plain text with appropriate HTML; a single\nnewline becomes an HTML line break ( <br> ) and a new line\nfollowed by a blank line becomes a paragraph break ( </p> ). For example: {{ value | linebreaks }} If value is Joel\\nis a slug , the output will be <p>Joel<br>is a slug</p> . linebreaksbr ¶ Converts all newlines in a piece of plain text to HTML line breaks\n( <br> ). For example: {{ value | linebreaksbr }} If value is Joel\\nis a slug , the output will be Joel<br>is a slug . linenumbers ¶ Displays text with line numbers. For example: {{ value | linenumbers }} If value is: one\ntwo\nthree the output will be: 1. one\n2. two\n3. three ljust ¶ Left-aligns the value in a field of a given width. Argument: field size For example: \" {{ value | ljust :\"10\" }} \" If value is Django , the output will be \"Django \" . lower ¶ Converts a string into all lowercase. For example: {{ value | lower }} If value is Totally LOVING this Album! , the output will be totally loving this album! . make_list ¶ Returns the value turned into a list. For a string, it’s a list of characters.\nFor an integer, the argument is cast to a string before creating a list. For example: {{ value | make_list }} If value is the string \"Joel\" , the output would be the list ['J', 'o', 'e', 'l'] . If value is 123 , the output will be the\nlist ['1', '2', '3'] . phone2numeric ¶ Converts a phone number (possibly containing letters) to its numerical\nequivalent. The input doesn’t have to be a valid phone number. This will happily convert\nany string. For example: {{ value | phone2numeric }} If value is 800-COLLECT , the output will be 800-2655328 . pluralize ¶ Returns a plural suffix if the value is not 1 , '1' , or an object of\nlength 1. By default, this suffix is 's' . Example: You have {{ num_messages }} message {{ num_messages | pluralize }} . If num_messages is 1 , the output will be You have 1 message. If num_messages is 2 the output will be You have 2 messages. For words that require a suffix other than 's' , you can provide an alternate\nsuffix as a parameter to the filter. Example: You have {{ num_walruses }} walrus {{ num_walruses | pluralize :\"es\" }} . For words that don’t pluralize by simple suffix, you can specify both a\nsingular and plural suffix, separated by a comma. Example: You have {{ num_cherries }} cherr {{ num_cherries | pluralize :\"y,ies\" }} . Note Use blocktranslate to pluralize translated strings. pprint ¶ A wrapper around pprint.pprint() – for debugging, really. random ¶ Returns a random item from the given list. For example: {{ value | random }} If value is the list ['a', 'b', 'c', 'd'] , the output could be \"b\" . rjust ¶ Right-aligns the value in a field of a given width. Argument: field size For example: \" {{ value | rjust :\"10\" }} \" If value is Django , the output will be \" Django\" . safe ¶ Marks a string as not requiring further HTML escaping prior to output. When\nautoescaping is off, this filter has no effect. Note If you are chaining filters, a filter applied after safe can\nmake the contents unsafe again. For example, the following code\nprints the variable as is, unescaped: {{ var | safe | escape }} safeseq ¶ Applies the safe filter to each element of a sequence. Useful in\nconjunction with other filters that operate on sequences, such as join . For example: {{ some_list | safeseq | join :\", \" }} You couldn’t use the safe filter directly in this case, as it would\nfirst convert the variable into a string, rather than working with the\nindividual elements of the sequence. slice ¶ Returns a slice of the list. Uses the same syntax as Python’s list slicing. See the Python documentation for an\nintroduction. Example: {{ some_list | slice :\":2\" }} If some_list is ['a', 'b', 'c'] , the output will be ['a', 'b'] . slugify ¶ Converts to ASCII. Converts spaces to hyphens. Removes characters that aren’t\nalphanumerics, underscores, or hyphens. Converts to lowercase. Also strips\nleading and trailing whitespace. For example: {{ value | slugify }} If value is \"Joel is a slug\" , the output will be \"joel-is-a-slug\" . stringformat ¶ Formats the variable according to the argument, a string formatting specifier.\nThis specifier uses the printf-style String Formatting syntax, with the exception\nthat the leading “%” is dropped. For example: {{ value | stringformat :\"E\" }} If value is 10 , the output will be 1.000000E+01 . striptags ¶ Makes all possible efforts to strip all [X]HTML tags. For example: {{ value | striptags }} If value is \"<b>Joel</b> <button>is</button> a <span>slug</span>\" , the\noutput will be \"Joel is a slug\" . No safety guarantee Note that striptags doesn’t give any guarantee about its output being\nHTML safe, particularly with non valid HTML input. So NEVER apply the safe filter to a striptags output. If you are looking for something\nmore robust, consider using a third-party HTML sanitizing tool. time ¶ Formats a time according to the given format. Given format can be the predefined one TIME_FORMAT , or a custom\nformat, same as the date filter. Note that the predefined format\nis locale-dependent. For example: {{ value | time :\"H:i\" }} If value is equivalent to datetime.datetime.now() , the output will be\nthe string \"01:23\" . Note that you can backslash-escape a format string if you want to use the\n“raw” value. In this example, both “h” and “m” are backslash-escaped, because\notherwise each is a format string that displays the hour and the month,\nrespectively: {{ value | time :\"H\\h i\\m\" }} This would display as “01h 23m”. Another example: Assuming that LANGUAGE_CODE is, for example, \"de\" , then for: {{ value | time :\"TIME_FORMAT\" }} the output will be the string \"01:23\" (The \"TIME_FORMAT\" format\nspecifier for the de locale as shipped with Django is \"H:i\" ). The time filter will only accept parameters in the format string that\nrelate to the time of day, not the date. If you need to format a date value, use the date filter instead (or along with time if\nyou need to render a full datetime value). There is one exception the above rule: When passed a datetime value with\nattached timezone information (a time-zone-aware datetime instance) the time filter will\naccept the timezone-related format specifiers 'e' , 'O' , 'T' and 'Z' . When used without a format string, the TIME_FORMAT format specifier is\nused: {{ value | time }} is the same as: {{ value | time :\"TIME_FORMAT\" }} timesince ¶ Formats a date as the time since that date (e.g., “4 days, 6 hours”). Takes an optional argument that is a variable containing the date to use as\nthe comparison point (without the argument, the comparison point is now ).\nFor example, if blog_date is a date instance representing midnight on 1\nJune 2006, and comment_date is a date instance for 08:00 on 1 June 2006,\nthen the following would return “8 hours”: {{ blog_date | timesince : comment_date }} Comparing offset-naive and offset-aware datetimes will return an empty string. Minutes is the smallest unit used, and “0 minutes” will be returned for any\ndate that is in the future relative to the comparison point. timeuntil ¶ Similar to timesince , except that it measures the time from now until the\ngiven date or datetime. For example, if today is 1 June 2006 and conference_date is a date instance holding 29 June 2006, then {{ conference_date|timeuntil }} will return “4 weeks”. Takes an optional argument that is a variable containing the date to use as\nthe comparison point (instead of now ). If from_date contains 22 June\n2006, then the following will return “1 week”: {{ conference_date | timeuntil : from_date }} Comparing offset-naive and offset-aware datetimes will return an empty string. Minutes is the smallest unit used, and “0 minutes” will be returned for any\ndate that is in the past relative to the comparison point. title ¶ Converts a string into titlecase by making words start with an uppercase\ncharacter and the remaining characters lowercase. This tag makes no effort to\nkeep “trivial words” in lowercase. For example: {{ value | title }} If value is \"my FIRST post\" , the output will be \"My First Post\" . truncatechars ¶ Truncates a string if it is longer than the specified number of characters.\nTruncated strings will end with a translatable ellipsis character (”…”). Argument: Number of characters to truncate to For example: {{ value | truncatechars : 7 }} If value is \"Joel is a slug\" , the output will be \"Joel i…\" . truncatechars_html ¶ Similar to truncatechars , except that it is aware of HTML tags. Any\ntags that are opened in the string and not closed before the truncation point\nare closed immediately after the truncation. For example: {{ value | truncatechars_html : 7 }} If value is \"<p>Joel is a slug</p>\" , the output will be \"<p>Joel i…</p>\" . Newlines in the HTML content will be preserved. Size of input string Processing large, potentially malformed HTML strings can be\nresource-intensive and impact service performance. truncatechars_html limits input to the first five million characters. Changed in Django 3.2.22: In older versions, strings over five million characters were processed. truncatewords ¶ Truncates a string after a certain number of words. Argument: Number of words to truncate after For example: {{ value | truncatewords : 2 }} If value is \"Joel is a slug\" , the output will be \"Joel is …\" . Newlines within the string will be removed. truncatewords_html ¶ Similar to truncatewords , except that it is aware of HTML tags. Any\ntags that are opened in the string and not closed before the truncation point,\nare closed immediately after the truncation. This is less efficient than truncatewords , so should only be used\nwhen it is being passed HTML text. For example: {{ value | truncatewords_html : 2 }} If value is \"<p>Joel is a slug</p>\" , the output will be \"<p>Joel is …</p>\" . Newlines in the HTML content will be preserved. Size of input string Processing large, potentially malformed HTML strings can be\nresource-intensive and impact service performance. truncatewords_html limits input to the first five million characters. Changed in Django 3.2.22: In older versions, strings over five million characters were processed. unordered_list ¶ Recursively takes a self-nested list and returns an HTML unordered list –\nWITHOUT opening and closing <ul> tags. The list is assumed to be in the proper format. For example, if var contains ['States', ['Kansas', ['Lawrence', 'Topeka'], 'Illinois']] , then {{ var|unordered_list }} would return: < li > States < ul > < li > Kansas < ul > < li > Lawrence </ li > < li > Topeka </ li > </ ul > </ li > < li > Illinois </ li > </ ul > </ li > upper ¶ Converts a string into all uppercase. For example: {{ value | upper }} If value is \"Joel is a slug\" , the output will be \"JOEL IS A SLUG\" . urlencode ¶ Escapes a value for use in a URL. For example: {{ value | urlencode }} If value is \"https://www.example.org/foo?a=b&c=d\" , the output will be \"https%3A//www.example.org/foo%3Fa%3Db%26c%3Dd\" . An optional argument containing the characters which should not be escaped can\nbe provided. If not provided, the ‘/’ character is assumed safe. An empty string can be\nprovided when all characters should be escaped. For example: {{ value | urlencode :\"\" }} If value is \"https://www.example.org/\" , the output will be \"https%3A%2F%2Fwww.example.org%2F\" . urlize ¶ Converts URLs and email addresses in text into clickable links. This template tag works on links prefixed with http:// , https:// , or www. . For example, https://djangocon.eu will get converted but djangocon.eu won’t. It also supports domain-only links ending in one of the original top level\ndomains ( .com , .edu , .gov , .int , .mil , .net , and .org ). For example, djangoproject.com gets converted. Links can have trailing punctuation (periods, commas, close-parens) and leading\npunctuation (opening parens), and urlize will still do the right thing. Links generated by urlize have a rel=\"nofollow\" attribute added\nto them. For example: {{ value | urlize }} If value is \"Check out www.djangoproject.com\" , the output will be \"Check out <a href=\"http://www.djangoproject.com\" rel=\"nofollow\">www.djangoproject.com</a>\" . In addition to web links, urlize also converts email addresses into mailto: links. If value is \"Send questions to foo@example.com\" , the output will be \"Send questions to <a href=\"mailto:foo@example.com\">foo@example.com</a>\" . The urlize filter also takes an optional parameter autoescape . If autoescape is True , the link text and URLs will be escaped using\nDjango’s built-in escape filter. The default value for autoescape is True . Note If urlize is applied to text that already contains HTML markup, or to\nemail addresses that contain single quotes ( ' ), things won’t work as\nexpected. Apply this filter only to plain text. Warning Using urlize or urlizetrunc can incur a performance penalty, which\ncan become severe when applied to user controlled values such as content\nstored in a TextField . You can use truncatechars to add a limit to such inputs: {{ value | truncatechars : 500 | urlize }} urlizetrunc ¶ Converts URLs and email addresses into clickable links just like urlize , but\ntruncates URLs longer than the given character limit. Argument: Number of characters that link text should be truncated to,\nincluding the ellipsis that’s added if truncation is necessary. For example: {{ value | urlizetrunc : 15 }} If value is \"Check out www.djangoproject.com\" , the output would be 'Check out <a href=\"http://www.djangoproject.com\" rel=\"nofollow\">www.djangoproj…</a>' . As with urlize , this filter should only be applied to plain text. wordcount ¶ Returns the number of words. For example: {{ value | wordcount }} If value is \"Joel is a slug\" , the output will be 4 . wordwrap ¶ Wraps words at specified line length. Argument: number of characters at which to wrap the text For example: {{ value | wordwrap : 5 }} If value is Joel is a slug , the output would be: Joel\nis a\nslug yesno ¶ Maps values for True , False , and (optionally) None , to the strings\n“yes”, “no”, “maybe”, or a custom mapping passed as a comma-separated list, and\nreturns one of those strings according to the value: For example: {{ value | yesno :\"yeah,no,maybe\" }} Value Argument Outputs True yes True \"yeah,no,maybe\" yeah False \"yeah,no,maybe\" no None \"yeah,no,maybe\" maybe None \"yeah,no\" no (converts None to False if no mapping for None is given) Internationalization tags and filters ¶ Django provides template tags and filters to control each aspect of internationalization in templates. They allow for\ngranular control of translations, formatting, and time zone conversions. i18n ¶ This library allows specifying translatable text in templates.\nTo enable it, set USE_I18N to True , then load it with {% load i18n %} . See Internationalization: in template code . l10n ¶ This library provides control over the localization of values in templates.\nYou only need to load the library using {% load l10n %} . See Controlling localization in templates . tz ¶ This library provides control over time zone conversions in templates.\nLike l10n , you only need to load the library using {% load tz %} ,\nbut you’ll usually also set USE_TZ to True so that conversion\nto local time happens by default. See Time zone aware output in templates . Other tags and filters libraries ¶ Django comes with a couple of other template-tag libraries that you have to\nenable explicitly in your INSTALLED_APPS setting and enable in your\ntemplate with the {% load %} tag. django.contrib.humanize ¶ A set of Django template filters useful for adding a “human touch” to data. See django.contrib.humanize . static ¶ static ¶ To link to static files that are saved in STATIC_ROOT Django ships\nwith a static template tag. If the django.contrib.staticfiles app is installed, the tag will serve files using url() method of the\nstorage specified by staticfiles in STORAGES . For example: {% load static %} < img src = \" {% static 'images/hi.jpg' %} \" alt = \"Hi!\" > It is also able to consume standard context variables, e.g. assuming a user_stylesheet variable is passed to the template: {% load static %} < link rel = \"stylesheet\" href = \" {% static user_stylesheet %} \" media = \"screen\" > If you’d like to retrieve a static URL without displaying it, you can use a\nslightly different call: {% load static %} {% static \"images/hi.jpg\" as myphoto %} < img src = \" {{ myphoto }} \" alt = \"Hi!\" > Using Jinja2 templates? See Jinja2 for information on\nusing the static tag with Jinja2. get_static_prefix ¶ You should prefer the static template tag, but if you need more control\nover exactly where and how STATIC_URL is injected into the template,\nyou can use the get_static_prefix template tag: {% load static %} < img src = \" {% get_static_prefix %} images/hi.jpg\" alt = \"Hi!\" > There’s also a second form you can use to avoid extra processing if you need\nthe value multiple times: {% load static %} {% get_static_prefix as STATIC_PREFIX %} < img src = \" {{ STATIC_PREFIX }} images/hi.jpg\" alt = \"Hi!\" > < img src = \" {{ STATIC_PREFIX }} images/hi2.jpg\" alt = \"Hello!\" > get_media_prefix ¶ Similar to the get_static_prefix , get_media_prefix populates a\ntemplate variable with the media prefix MEDIA_URL , e.g.: {% load static %} < body data-media-url = \" {% get_media_prefix %} \" > By storing the value in a data attribute, we ensure it’s escaped appropriately\nif we want to use it in a JavaScript context.", "keywords": ["\\d\\e", "users", "forloop.parentloop", "rows", "employee", "-500", "amp", "verbose", "slicing", "population", "storage", "pattern", "underscores", "force_escape", "zeros", "messages", "csv", "pipes", "b", "background", "usa", "abbreviation", "json_script", "date.date", "country.list", "backtick", "lots", "local_cities", "myvalue", "library", "athlete", "calcutta", "https://djangocon.eu", "rowvalue1", "field", "#", "country=’india", "prints", "touch", "m", "♥", "total", "time_format", "above", "aspect", "divisibleby", "+", "polish", "paragraph", "joel\\nis", "blog_date", "value|floatformat:\"0", "loop", "l", "opencomment", "escapejs", "numbers", "forloop.revcounter0", "representation", "href=\"http://www.djangoproject.com", "match", "printf", "words", "tool", "+0200", "literal", "safeseq", "links", "forloop.counter", "mb", "truncation", "=", "changes", "sizes", "results", "linenumbers", "cities", "engine", "endverbatim", "pprint", "message", "inequality", "n", "charts", "es", "fact", "href", "inputs", "character", "date_format", "letters", "tag", "gb", "php", "button", "greater", "height", "process", "fallback", "dictsort", "debug", "places", "var", "john", "autoescape", "associated", "following", "press", "type", "processing", "cheerleader_list", "business.employees.count", "custom", "defines", "objects", "documentation", "weeks", "num_walruses", "mind", "file", "alice", "class=\"odd", "album", "guarantee", "work", "modules", "beta", "round", "strategy", "andrea", "user", "value|floatformat:\"g", "li", "cases", "js", "attribute", "states", "size", "warning", "conference_date|timeuntil", "striptags", "truncatewords_html", "time", "var1", "tags", "gmt", "date", "render", "joel", "num_cherries", "operators", "country.grouper", "false", "restart", "hour", "replacements", "service", "things", "x27", "may", "quote", "minor", "wordcount", "name", "parameter", "rule", "get_foo_display", "execution", "break", ".edu", "world", "closevariable", "escaping", "reference", "january", "web", "rjust", "./my", "monday", "age", "versions", "greeting", "strips", "a.m.", "my_query_dict", "specifiers", "slice", "gib", "get_static_prefix", "international", "truncatewords", "uses", "literals", "z", "piece", "addresses", "forloop.counter0", "reverse", "app_views", "operator", "static_url", "expressions", "foo", "environments", "use_tz", "parent", "rel", "widthratio", "letter", "textfield", "hi2.jpg", "commas", "examples", "django.contrib.staticfiles", "sunday", "category", "data.items", "wrapper", "abcd", "leap", "space", "join", "url", "openblock", "error", "conditions", "quot", "code", "base.html", "replaces", "safety", "newline", "forgeries", "pages", "filter", "style", "behavior", "c", "access", "class", "array", "clause", "hello", "i", "link", "york", "grouping", "display", "group", "endcomment", "namedtuple", "archive", "returns", "names", "javascript", "'", "x", "templatetag", "snippet", "u", "value|floatformat:\"-3", "make_list", "request", "formatting", "stringformat", "past", "database", "block", "output", "topeka", "input", "*", "query", "page", "test", "english", "urlencode", "count", "types", "we", "wraps", "strings", "elements", "rel=\"nofollow\">www.djangoproject.com</a", "4th", "de", "somelibrary", ".", "book.title", "usage", "./base2.html", "sequences", "-43200", "querydict", "project_name.app_name.urls", "p.m.", "script", "effort", "limit", "containers", "truncatechars", "formatters", "e", "sake", "section", "urlize", "substring", "coach.name", "suffix", "openbrace", "gareth", "converts", "sequence", "row3", "locker", "href=\"mailto", "use", "designers", "left", "./", "greenwich", "blocktranslate", "coach", "alt", "client/123/", "img", "kb", "author", "http://", "silence", "solution", "performance", "protection", "random", "x]html", "similar", "order", "j", "default", "loader", "choices", "opening", "markup", "upper", "short_datetime_format", "comment", "signals", "form", "select_template", "option", "properties", "format", "var2", "expression", "tests", "characters", "tick", "comma", "cross", "equality", "user_stylesheet", "day", "digit", "noon", "regroups", "friday", "timezone", "value</strong", "f", "mib", "truncatechars_html", "domains", "backslash", "closebrace", "breaks", "m&page=3", "truncates", "https://", "iri_to_uri", "src", "template", "ipsum", "week", "cherr", "marks", "penalty", "way", "endfor", "formats", "https%3a%2f%2fwww.example.org%2f", "populates", "uppercase", "template_name", "h3", "t", "index", "datetime.datetime.now", "titlecase", "microseconds", "concept", "foo@example.com\">foo@example.com</a", "odd", "notation", "september", "queryset", "app_views.client", "integer", "periods", "party", "midnight", "o", "¶", "bytes", "id", "internationalization", "spaces", "parameters", "post", "integers", "class=\"even", "enero", "june", "content", "stuff", "span", "function", "querystring", "views", "result", "view", "nick", "float", "color", "filesizeformat", "zone", "control", "number", "lorem", "</p", "cycles", "right", "maps", "autoescaping", "www.djangoproject.com", "verbatim", "point", "getitem", "datetimes", "tz", "values", "staticfiles", "kurt", "string", "foo/", "comment_date", "loops", "est", "athletes", "my_list", "<", "tokyo", "city", "unix", "mapping", "current_year", "thing", "get_digit", "row2", "template.html", "stringwithspaces", "auto", "jinja2", "unit", "outcomes", "libraries", "table", "phone", "phone2numeric", "blocks", "subtemplate", "ways", "level", "jane", "json", "contents", "tr", "machine", "datetime.tzinfo", "parse", "processor", "hyphens", "timeuntil", "width", "image", "escapes", "django", "foo@example.com", "myapp", "rfc", "n’t", "div", "gt", "fields", "bar.png", "parentheses", "str.join(list", "joe", "conversions", "set", "lowercase", "ies", "p", "tab", "book", "practice", "timequake", "value", "max_width", "175/200", "centers", "media", "negation", "line", "bit", "chicago", "spaceless", "policy", "data", "implementation", "scope", "item", "coaches", "my/", "container", "w", "datetime", "arg1", "room", "person", "layer", "capitalizes", "-1", "v2", "efforts", "identifier", "base3.html", "iterable", "security", "ul", "paths", "self", "outputs", "instance", "members", "pub_date", "today", "localization", "from_date", "bc", "executes", "handling", "extension", "ratio", "constant", "|", "am", "default_if_none", "closing", "client/<int", "row1", "digits", "india", "v1", ".mil", "pl", "joins", "floatformat", "abcdef", "gotcha", "instances", "get_country_display", "iso", "structure", "alphanumerics", "harry", "installed_apps", "part", "paragraphs", "mailto", "feb.", "object", "load", "h", "march", "couple", "domain", "us", "linebreaksbr", "dot", "slashes", "amy", "melissa", "iri", "precedence", "www", "alternating", "dictionary", "whitespace", "hints", "points", "endif", "locale", "rendering", "keyword", "var3", "s", "csrf", "is</button", "child", "resolution", "conversion", "matches", "rules", "variables", "greetings", "notice", "mumbai", "root", "others", "george", "obj", "hours", "debugging", "conference_date", "questions", "item.data", "effect", "system", "escapeseq", "inheritance", "bar.html", "red&size", "pluralize", "forloop.revcounter", "clauses", "blue", "si", "grouper", "walrus", "plural", "i\\'m", "id>/", "items", "somevar", "iso-8601", "otherlibrary", "coach.athlete_set.all", "storages", "escape", "definition", "center", "check", "difference", "numbering", "site", "kansas", "negated", "name_snippet.html", "saturday", "num_messages", "l10n", "addition", "lists", "example", "myblock", "resetcycle", "value|floatformat:\"3", "app", "unordered_list", "country", "month", "fri", "i18n", "…", "list", "sample", "slug</p", "stylesheet", "minutes", "seconds", "book.author.name", "athlete.name", "utc", "epoch", "linebreaks", "newlines", "displays", "first", "st", "script\\\\u003e\\\\u0026amp", "applies", "email", "myphoto", "dir1/", "sublist", "paginator", "author.age", "variable", "regrouping", "word", "wordwrap", "django.contrib.humanize", "https://www.example.org/foo?a=b&c=d", "year", "rd", "sorry", "place", "this_value", "timezones", "element", "application", "dry", "jan.", "dictionaries", "identity", "attributes", "amet", "media_url", "formatter", "illinois", "getelementbyid", "slug</span", "title", "encounter", "forloop.first", "short_date_format", "countries", "differences", "relative", "urlconf", "01h", "y", "mdt", "data['items", "const", "clarity", "syntax", "friend", "rowvalue2", "r", "closecomment", "timesince", "dolor", "value|floatformat:\"3u", "ones", "coordinates", "keys", "case", "principle", "h1", "length", "arg", "boolean", "lookup", "japan", "equivalent", "conjunction", "parens", "slug", "pprint.pprint", "br", "html", "lawrence", "screen", "datetime_format", "future", "alpha", "coach_list", "arguments", "lt", "introduction", "quotes", "city.population", "package", "static", "xss", "city.name", "one", "separation", "09/01/2008", "end", "translations", "g", "singular", "e.g.", "comparison", "endfilter", "listopada", "bar", "path", "firstof", "pm", "key", "pixels", ".net", "stops", "collect", "value|floatformat", "none", "filters", "problem", "jan", "hi.jpg", "rowcolors", "caches", "new", "true", "thu", "punctuation", "urls", "athlete_list", "loads", "arg2", "description", "country.description", "max_value", "document", "djangocon.eu", "some_list", "units", "context", "eastern", "cycle", "offset", "files", "d", "iteration", "powers", "directory", "%", ">", "iterations", "call", "lewis", "athlete_list|length", "information", "row", "thousand_separator", "python", "wrong", "images", "urlizetrunc", "copyright", ".first", "methods", "ellipsis", "base2.html", "books", "optional", "regroup", "times", "complex", "extends", "exception", "resource", "base1.html", "client", "rel=\"nofollow\">www.djangoproj", "listopad", "details", "method", "dec", "yesno", "settings", "ships", "argument", "days", "static_prefix", "internationalized", "red&color", "combinations", "note", "body", "state", "m&page=4", "east", "aligns", "attacks", "endautoescape", "controlling", "templates", "lack", "kib", "text", "project", "exceptions"], "type": "documentation"},
{"title": "The Django admin site | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/contrib/admin/", "content": "The Django admin site ¶ One of the most powerful parts of Django is the automatic admin interface. It\nreads metadata from your models to provide a quick, model-centric interface\nwhere trusted users can manage content on your site. The admin’s recommended\nuse is limited to an organization’s internal management tool. It’s not intended\nfor building your entire front end around. The admin has many hooks for customization, but beware of trying to use those\nhooks exclusively. If you need to provide a more process-centric interface\nthat abstracts away the implementation details of database tables and fields,\nthen it’s probably time to write your own views. In this document we discuss how to activate, use, and customize Django’s admin\ninterface. Overview ¶ The admin is enabled in the default project template used by startproject . If you’re not using the default project template, here are the requirements: Add 'django.contrib.admin' and its dependencies - django.contrib.auth , django.contrib.contenttypes , django.contrib.messages , and django.contrib.sessions - to your INSTALLED_APPS setting. Configure a DjangoTemplates backend in your TEMPLATES setting with django.template.context_processors.request , django.contrib.auth.context_processors.auth , and django.contrib.messages.context_processors.messages in\nthe 'context_processors' option of OPTIONS . If you’ve customized the MIDDLEWARE setting, django.contrib.sessions.middleware.SessionMiddleware , django.contrib.auth.middleware.AuthenticationMiddleware , and django.contrib.messages.middleware.MessageMiddleware must be\nincluded. Hook the admin’s URLs into your URLconf . After you’ve taken these steps, you’ll be able to use the admin site by\nvisiting the URL you hooked it into ( /admin/ , by default). If you need to create a user to login with, use the createsuperuser command. By default, logging in to the admin requires that the user has the is_staff attribute set to True . Finally, determine which of your application’s models should be editable in the\nadmin interface. For each of those models, register them with the admin as\ndescribed in ModelAdmin . Other topics ¶ Admin actions ModelAdmin List Filters The Django admin documentation generator JavaScript customizations in the admin See also For information about serving the static files (images, JavaScript, and\nCSS) associated with the admin in production, see Serving files . Having problems?  Try FAQ: The admin . ModelAdmin objects ¶ class ModelAdmin [source] ¶ The ModelAdmin class is the representation of a model in the admin\ninterface. Usually, these are stored in a file named admin.py in your\napplication. Let’s take a look at an example of the ModelAdmin : from django.contrib import admin from myapp.models import Author class AuthorAdmin ( admin . ModelAdmin ): pass admin . site . register ( Author , AuthorAdmin ) Do you need a ModelAdmin object at all? In the preceding example, the ModelAdmin class doesn’t define any\ncustom values (yet). As a result, the default admin interface will be\nprovided. If you are happy with the default admin interface, you don’t\nneed to define a ModelAdmin object at all – you can register the\nmodel class without providing a ModelAdmin description. The\npreceding example could be simplified to: from django.contrib import admin from myapp.models import Author admin . site . register ( Author ) The register decorator ¶ register ( * models , site = django.contrib.admin.sites.site ) [source] ¶ There is also a decorator for registering your ModelAdmin classes: from django.contrib import admin from .models import Author @admin . register ( Author ) class AuthorAdmin ( admin . ModelAdmin ): pass It’s given one or more model classes to register with the ModelAdmin .\nIf you’re using a custom AdminSite , pass it using the site keyword\nargument: from django.contrib import admin from .models import Author , Editor , Reader from myproject.admin_site import custom_admin_site @admin . register ( Author , Reader , Editor , site = custom_admin_site ) class PersonAdmin ( admin . ModelAdmin ): pass You can’t use this decorator if you have to reference your model admin\nclass in its __init__() method, e.g. super(PersonAdmin, self).__init__(*args, **kwargs) . You can use super().__init__(*args, **kwargs) . Discovery of admin files ¶ When you put 'django.contrib.admin' in your INSTALLED_APPS setting, Django automatically looks for an admin module in each\napplication and imports it. class apps. AdminConfig ¶ This is the default AppConfig class for the admin.\nIt calls autodiscover() when Django starts. class apps. SimpleAdminConfig ¶ This class works like AdminConfig ,\nexcept it doesn’t call autodiscover() . default_site ¶ A dotted import path to the default admin site’s class or to a callable\nthat returns a site instance. Defaults to 'django.contrib.admin.sites.AdminSite' . See Overriding the default admin site for usage. autodiscover () [source] ¶ This function attempts to import an admin module in each installed\napplication. Such modules are expected to register models with the admin. Typically you won’t need to call this function directly as AdminConfig calls it when Django starts. If you are using a custom AdminSite , it is common to import all of the ModelAdmin subclasses into your code and register them to the custom AdminSite . In that case, in order to disable auto-discovery, you should\nput 'django.contrib.admin.apps.SimpleAdminConfig' instead of 'django.contrib.admin' in your INSTALLED_APPS setting. ModelAdmin options ¶ The ModelAdmin is very flexible. It has several options for dealing with\ncustomizing the interface. All options are defined on the ModelAdmin subclass: from django.contrib import admin class AuthorAdmin ( admin . ModelAdmin ): date_hierarchy = \"pub_date\" ModelAdmin. actions ¶ A list of actions to make available on the change list page. See Admin actions for details. ModelAdmin. actions_on_top ¶ ModelAdmin. actions_on_bottom ¶ Controls where on the page the actions bar appears. By default, the admin\nchangelist displays actions at the top of the page ( actions_on_top = True; actions_on_bottom = False ). ModelAdmin. actions_selection_counter ¶ Controls whether a selection counter is displayed next to the action dropdown.\nBy default, the admin changelist will display it\n( actions_selection_counter = True ). ModelAdmin. date_hierarchy ¶ Set date_hierarchy to the name of a DateField or DateTimeField in your model, and the change list page will include a date-based drilldown\nnavigation by that field. Example: date_hierarchy = \"pub_date\" You can also specify a field on a related model using the __ lookup,\nfor example: date_hierarchy = \"author__pub_date\" This will intelligently populate itself based on available data,\ne.g. if all the dates are in one month, it’ll show the day-level\ndrill-down only. Note date_hierarchy uses QuerySet.datetimes() internally. Please refer\nto its documentation for some caveats when time zone support is\nenabled ( USE_TZ = True ). ModelAdmin. empty_value_display ¶ This attribute overrides the default display value for record’s fields that\nare empty ( None , empty string, etc.). The default value is - (a\ndash). For example: from django.contrib import admin class AuthorAdmin ( admin . ModelAdmin ): empty_value_display = \"-empty-\" You can also override empty_value_display for all admin pages with AdminSite.empty_value_display , or for specific fields like this: from django.contrib import admin class AuthorAdmin ( admin . ModelAdmin ): list_display = [ \"name\" , \"title\" , \"view_birth_date\" ] @admin . display ( empty_value = \"???\" ) def view_birth_date ( self , obj ): return obj . birth_date ModelAdmin. exclude ¶ This attribute, if given, should be a list of field names to exclude from\nthe form. For example, let’s consider the following model: from django.db import models class Author ( models . Model ): name = models . CharField ( max_length = 100 ) title = models . CharField ( max_length = 3 ) birth_date = models . DateField ( blank = True , null = True ) If you want a form for the Author model that includes only the name and title fields, you would specify fields or exclude like\nthis: from django.contrib import admin class AuthorAdmin ( admin . ModelAdmin ): fields = [ \"name\" , \"title\" ] class AuthorAdmin ( admin . ModelAdmin ): exclude = [ \"birth_date\" ] Since the Author model only has three fields, name , title , and birth_date , the forms resulting from the above declarations will\ncontain exactly the same fields. ModelAdmin. fields ¶ Use the fields option to make simple layout changes in the forms on\nthe “add” and “change” pages such as showing only a subset of available\nfields, modifying their order, or grouping them into rows. For example, you\ncould define a simpler version of the admin form for the django.contrib.flatpages.models.FlatPage model as follows: class FlatPageAdmin ( admin . ModelAdmin ): fields = [ \"url\" , \"title\" , \"content\" ] In the above example, only the fields url , title and content will be displayed, sequentially, in the form. fields can contain\nvalues defined in ModelAdmin.readonly_fields to be displayed as\nread-only. For more complex layout needs, see the fieldsets option. The fields option accepts the same types of values as list_display , except that callables and __ lookups\nfor related fields aren’t accepted. Names of model and model admin methods\nwill only be used if they’re listed in readonly_fields . To display multiple fields on the same line, wrap those fields in their own\ntuple. In this example, the url and title fields will display on the\nsame line and the content field will be displayed below them on its\nown line: class FlatPageAdmin ( admin . ModelAdmin ): fields = [( \"url\" , \"title\" ), \"content\" ] Possible confusion with the ModelAdmin.fieldsets option This fields option should not be confused with the fields dictionary key that is within the fieldsets option,\nas described in the next section. If neither fields nor fieldsets options are present,\nDjango will default to displaying each field that isn’t an AutoField and\nhas editable=True , in a single fieldset, in the same order as the fields\nare defined in the model. ModelAdmin. fieldsets ¶ Set fieldsets to control the layout of admin “add” and “change” pages. fieldsets is a list of 2-tuples, in which each 2-tuple represents a <fieldset> on the admin form page. (A <fieldset> is a “section” of\nthe form.) The 2-tuples are in the format (name, field_options) , where name is a string representing the title of the fieldset and field_options is\na dictionary of information about the fieldset, including a list of fields\nto be displayed in it. A full example, taken from the django.contrib.flatpages.models.FlatPage model: from django.contrib import admin class FlatPageAdmin ( admin . ModelAdmin ): fieldsets = [ ( None , { \"fields\" : [ \"url\" , \"title\" , \"content\" , \"sites\" ], }, ), ( \"Advanced options\" , { \"classes\" : [ \"collapse\" ], \"fields\" : [ \"registration_required\" , \"template_name\" ], }, ), ] This results in an admin page that looks like: If neither fieldsets nor fields options are present,\nDjango will default to displaying each field that isn’t an AutoField and\nhas editable=True , in a single fieldset, in the same order as the fields\nare defined in the model. The field_options dictionary can have the following keys: fields A list or tuple of field names to display in this fieldset. This key is\nrequired. Example: { \"fields\" : [ \"first_name\" , \"last_name\" , \"address\" , \"city\" , \"state\" ], } As with the fields option, to display multiple\nfields on the same line, wrap those fields in their own tuple. In this\nexample, the first_name and last_name fields will display on\nthe same line: { \"fields\" : [( \"first_name\" , \"last_name\" ), \"address\" , \"city\" , \"state\" ], } fields can contain values defined in readonly_fields to be displayed as read-only. If you add the name of a callable to fields , the same rule applies\nas with the fields option: the callable must be\nlisted in readonly_fields . classes A list or tuple containing extra CSS classes to apply to the fieldset.\nThis can include any custom CSS class defined in the project, as well\nas any of the CSS classes provided by Django. Within the default admin\nsite CSS stylesheet, two particularly useful classes are defined: collapse and wide . Example: { \"classes\" : [ \"wide\" , \"collapse\" ], } Fieldsets with the wide style will be given extra horizontal\nspace in the admin interface.\nFieldsets with a name and the collapse style will be initially\ncollapsed, using an expandable widget with a toggle for switching\ntheir visibility. Changed in Django 5.1: fieldsets using the collapse class now use <details> and <summary> elements, provided they define a name . description A string of optional extra text to be displayed at the top of each\nfieldset, under the heading of the fieldset. Note that this value is not HTML-escaped when it’s displayed in\nthe admin interface. This lets you include HTML if you so desire.\nAlternatively you can use plain text and django.utils.html.escape() to escape any HTML special\ncharacters. TabularInline has limited\nsupport for fieldsets Using fieldsets with TabularInline has limited functionality. You can specify which fields will be\ndisplayed and their order within the TabularInline layout by\ndefining fields in the field_options dictionary. All other features are not supported. This includes the use of name to define a title for a group of fields. ModelAdmin. filter_horizontal ¶ By default, a ManyToManyField is displayed in\nthe admin site with a <select multiple> . However, multiple-select boxes\ncan be difficult to use when selecting many items. Adding a ManyToManyField to this list will instead use\na nifty unobtrusive JavaScript “filter” interface that allows searching\nwithin the options. The unselected and selected options appear in two boxes\nside by side. See filter_vertical to use a vertical\ninterface. ModelAdmin. filter_vertical ¶ Same as filter_horizontal , but uses a vertical display\nof the filter interface with the box of unselected options appearing above\nthe box of selected options. ModelAdmin. form ¶ By default a ModelForm is dynamically created for your model. It is\nused to create the form presented on both the add/change pages. You can\neasily provide your own ModelForm to override any default form behavior\non the add/change pages. Alternatively, you can customize the default\nform rather than specifying an entirely new one by using the ModelAdmin.get_form() method. For an example see the section Adding custom validation to the admin . Omit the Meta.model attribute If you define the Meta.model attribute on a ModelForm , you must also define the Meta.fields attribute (or the Meta.exclude attribute). However,\nsince the admin has its own way of defining fields, the Meta.fields attribute will be ignored. If the ModelForm is only going to be used for the admin, the easiest\nsolution is to omit the Meta.model attribute, since ModelAdmin will provide the correct model to use. Alternatively, you can set fields = [] in the Meta class to satisfy the validation on the ModelForm . ModelAdmin.exclude takes precedence If your ModelForm and ModelAdmin both define an exclude option then ModelAdmin takes precedence: from django import forms from django.contrib import admin from myapp.models import Person class PersonForm ( forms . ModelForm ): class Meta : model = Person exclude = [ \"name\" ] class PersonAdmin ( admin . ModelAdmin ): exclude = [ \"age\" ] form = PersonForm In the above example, the “age” field will be excluded but the “name”\nfield will be included in the generated form. ModelAdmin. formfield_overrides ¶ This provides a quick-and-dirty way to override some of the Field options for use in the admin. formfield_overrides is a dictionary mapping a field class to a dict of\narguments to pass to the field at construction time. Since that’s a bit abstract, let’s look at a concrete example. The most\ncommon use of formfield_overrides is to add a custom widget for a\ncertain type of field. So, imagine we’ve written a RichTextEditorWidget that we’d like to use for large text fields instead of the default <textarea> . Here’s how we’d do that: from django.contrib import admin from django.db import models # Import our custom widget and our model from where they're defined from myapp.models import MyModel from myapp.widgets import RichTextEditorWidget class MyModelAdmin ( admin . ModelAdmin ): formfield_overrides = { models . TextField : { \"widget\" : RichTextEditorWidget }, } Note that the key in the dictionary is the actual field class, not a\nstring. The value is another dictionary; these arguments will be passed to\nthe form field’s __init__() method. See The Forms API for\ndetails. Warning If you want to use a custom widget with a relation field (i.e. ForeignKey or ManyToManyField ), make sure you haven’t\nincluded that field’s name in raw_id_fields , radio_fields , or autocomplete_fields . formfield_overrides won’t let you change the widget on relation\nfields that have raw_id_fields , radio_fields , or autocomplete_fields set. That’s because raw_id_fields , radio_fields , and autocomplete_fields imply custom widgets of\ntheir own. ModelAdmin. inlines ¶ See InlineModelAdmin objects below as well as ModelAdmin.get_formsets_with_inlines() . ModelAdmin. list_display ¶ Set list_display to control which fields are displayed on the change\nlist page of the admin. Example: list_display = [ \"first_name\" , \"last_name\" ] If you don’t set list_display , the admin site will display a single\ncolumn that displays the __str__() representation of each object. There are five types of values that can be used in list_display . All\nbut the simplest may use the display() decorator, which is used to customize how the field is presented: The name of a model field. For example: class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"first_name\" , \"last_name\" ] The name of a related field, using the __ notation. For example: class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"city__name\" ] A callable that accepts one argument, the model instance. For example: @admin . display ( description = \"Name\" ) def upper_case_name ( obj ): return f \" { obj . first_name } { obj . last_name } \" . upper () class PersonAdmin ( admin . ModelAdmin ): list_display = [ upper_case_name ] A string representing a ModelAdmin method that accepts one argument,\nthe model instance. For example: class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"upper_case_name\" ] @admin . display ( description = \"Name\" ) def upper_case_name ( self , obj ): return f \" { obj . first_name } { obj . last_name } \" . upper () A string representing a model attribute or method (without any required\narguments). For example: from django.contrib import admin from django.db import models class Person ( models . Model ): name = models . CharField ( max_length = 50 ) birthday = models . DateField () @admin . display ( description = \"Birth decade\" ) def decade_born_in ( self ): decade = self . birthday . year // 10 * 10 return f \" { decade } ’s\" class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"name\" , \"decade_born_in\" ] Changed in Django 5.1: Support for using __ lookups was added, when targeting related\nfields. A few special cases to note about list_display : If the field is a ForeignKey , Django will display the __str__() of the related object. ManyToManyField fields aren’t supported, because that would\nentail executing a separate SQL statement for each row in the table.\nIf you want to do this nonetheless, give your model a custom method,\nand add that method’s name to list_display . (See below for more\non custom methods in list_display .) If the field is a BooleanField , Django will display a pretty “yes”,\n“no”, or “unknown” icon instead of True , False , or None . If the string given is a method of the model, ModelAdmin or a\ncallable, Django will HTML-escape the output by default. To escape\nuser input and allow your own unescaped tags, use format_html() . Here’s a full example model: from django.contrib import admin from django.db import models from django.utils.html import format_html class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) last_name = models . CharField ( max_length = 50 ) color_code = models . CharField ( max_length = 6 ) @admin . display def colored_name ( self ): return format_html ( '<span style=\"color: # {} ;\"> {} {} </span>' , self . color_code , self . first_name , self . last_name , ) class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"first_name\" , \"last_name\" , \"colored_name\" ] As some examples have already demonstrated, when using a callable, a\nmodel method, or a ModelAdmin method, you can customize the column’s\ntitle by wrapping the callable with the display() decorator and passing the description argument. If the value of a field is None , an empty string, or an iterable\nwithout elements, Django will display - (a dash). You can override\nthis with AdminSite.empty_value_display : from django.contrib import admin admin . site . empty_value_display = \"(None)\" You can also use ModelAdmin.empty_value_display : class PersonAdmin ( admin . ModelAdmin ): empty_value_display = \"unknown\" Or on a field level: class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"name\" , \"birth_date_view\" ] @admin . display ( empty_value = \"unknown\" ) def birth_date_view ( self , obj ): return obj . birth_date If the string given is a method of the model, ModelAdmin or a\ncallable that returns True , False , or None , Django will\ndisplay a pretty “yes”, “no”, or “unknown” icon if you wrap the method\nwith the display() decorator passing the boolean argument with the value set to True : from django.contrib import admin from django.db import models class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) birthday = models . DateField () @admin . display ( boolean = True ) def born_in_fifties ( self ): return 1950 <= self . birthday . year < 1960 class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"name\" , \"born_in_fifties\" ] The __str__() method is just as valid in list_display as any\nother model method, so it’s perfectly OK to do this: list_display = [ \"__str__\" , \"some_other_field\" ] Usually, elements of list_display that aren’t actual database\nfields can’t be used in sorting (because Django does all the sorting\nat the database level). However, if an element of list_display represents a certain database\nfield, you can indicate this fact by using the display() decorator on the method, passing\nthe ordering argument: from django.contrib import admin from django.db import models from django.utils.html import format_html class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) color_code = models . CharField ( max_length = 6 ) @admin . display ( ordering = \"first_name\" ) def colored_first_name ( self ): return format_html ( '<span style=\"color: # {} ;\"> {} </span>' , self . color_code , self . first_name , ) class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"first_name\" , \"colored_first_name\" ] The above will tell Django to order by the first_name field when\ntrying to sort by colored_first_name in the admin. To indicate descending order with the ordering argument you can use a\nhyphen prefix on the field name. Using the above example, this would look\nlike: @admin . display ( ordering = \"-first_name\" ) def colored_first_name ( self ): ... The ordering argument supports query lookups to sort by values on\nrelated models. This example includes an “author first name” column in\nthe list display and allows sorting it by first name: class Blog ( models . Model ): title = models . CharField ( max_length = 255 ) author = models . ForeignKey ( Person , on_delete = models . CASCADE ) class BlogAdmin ( admin . ModelAdmin ): list_display = [ \"title\" , \"author\" , \"author_first_name\" ] @admin . display ( ordering = \"author__first_name\" ) def author_first_name ( self , obj ): return obj . author . first_name Query expressions may be used with the ordering argument: from django.db.models import Value from django.db.models.functions import Concat class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) last_name = models . CharField ( max_length = 50 ) @admin . display ( ordering = Concat ( \"first_name\" , Value ( \" \" ), \"last_name\" )) def full_name ( self ): return self . first_name + \" \" + self . last_name Elements of list_display can also be properties class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) last_name = models . CharField ( max_length = 50 ) @property @admin . display ( ordering = \"last_name\" , description = \"Full name of the person\" , boolean = False , ) def full_name ( self ): return self . first_name + \" \" + self . last_name class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"full_name\" ] Note that @property must be above @display . If you’re using the\nold way – setting the display-related attributes directly rather than\nusing the display() decorator –  be aware\nthat the property() function and not the @property decorator\nmust be used: def my_property ( self ): return self . first_name + \" \" + self . last_name my_property . short_description = \"Full name of the person\" my_property . admin_order_field = \"last_name\" my_property . boolean = False full_name = property ( my_property ) Changed in Django 5.0: Support for boolean attribute on properties was added. The field names in list_display will also appear as CSS classes in\nthe HTML output, in the form of column-<field_name> on each <th> element. This can be used to set column widths in a CSS file for example. Django will try to interpret every element of list_display in this\norder: A field of the model or from a related field. A callable. A string representing a ModelAdmin attribute. A string representing a model attribute. For example if you have first_name as a model field and\nas a ModelAdmin attribute, the model field will be used. ModelAdmin. list_display_links ¶ Use list_display_links to control if and which fields in list_display should be linked to the “change” page for an object. By default, the change list page will link the first column – the first\nfield specified in list_display – to the change page for each item.\nBut list_display_links lets you change this: Set it to None to get no links at all. Set it to a list or tuple of fields (in the same format as list_display ) whose columns you want converted to links. You can specify one or many fields. As long as the fields appear in list_display , Django doesn’t care how many (or how few) fields are\nlinked. The only requirement is that if you want to use list_display_links in this fashion, you must define list_display . In this example, the first_name and last_name fields will be\nlinked on the change list page: class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"first_name\" , \"last_name\" , \"birthday\" ] list_display_links = [ \"first_name\" , \"last_name\" ] In this example, the change list page grid will have no links: class AuditEntryAdmin ( admin . ModelAdmin ): list_display = [ \"timestamp\" , \"message\" ] list_display_links = None ModelAdmin. list_editable ¶ Set list_editable to a list of field names on the model which will\nallow editing on the change list page. That is, fields listed in list_editable will be displayed as form widgets on the change list\npage, allowing users to edit and save multiple rows at once. Note list_editable interacts with a couple of other options in\nparticular ways; you should note the following rules: Any field in list_editable must also be in list_display .\nYou can’t edit a field that’s not displayed! The same field can’t be listed in both list_editable and list_display_links – a field can’t be both a form and\na link. You’ll get a validation error if either of these rules are broken. ModelAdmin. list_filter ¶ Set list_filter to activate filters in the right sidebar of the change\nlist page of the admin. At it’s simplest list_filter takes a list or tuple of field names to\nactivate filtering upon, but several more advanced options as available.\nSee ModelAdmin List Filters for the details. ModelAdmin. list_max_show_all ¶ Set list_max_show_all to control how many items can appear on a “Show\nall” admin change list page. The admin will display a “Show all” link on the\nchange list only if the total result count is less than or equal to this\nsetting. By default, this is set to 200 . ModelAdmin. list_per_page ¶ Set list_per_page to control how many items appear on each paginated\nadmin change list page. By default, this is set to 100 . ModelAdmin. list_select_related ¶ Set list_select_related to tell Django to use select_related() in retrieving\nthe list of objects on the admin change list page. This can save you a\nbunch of database queries. The value should be either a boolean, a list or a tuple. Default is False . When value is True , select_related() will always be called. When\nvalue is set to False , Django will look at list_display and call select_related() if any ForeignKey is present. If you need more fine-grained control, use a tuple (or list) as value for list_select_related . Empty tuple will prevent Django from calling select_related at all. Any other tuple will be passed directly to select_related as parameters. For example: class ArticleAdmin ( admin . ModelAdmin ): list_select_related = [ \"author\" , \"category\" ] will call select_related('author', 'category') . If you need to specify a dynamic value based on the request, you can\nimplement a get_list_select_related() method. Note ModelAdmin ignores this attribute when select_related() was already\ncalled on the changelist’s QuerySet . ModelAdmin. ordering ¶ Set ordering to specify how lists of objects should be ordered in the\nDjango admin views. This should be a list or tuple in the same format as a\nmodel’s ordering parameter. If this isn’t provided, the Django admin will use the model’s default\nordering. If you need to specify a dynamic order (for example depending on user or\nlanguage) you can implement a get_ordering() method. Performance considerations with ordering and sorting To ensure a deterministic ordering of results, the changelist adds pk to the ordering if it can’t find a single or unique together set\nof fields that provide total ordering. For example, if the default ordering is by a non-unique name field,\nthen the changelist is sorted by name and pk . This could\nperform poorly if you have a lot of rows and don’t have an index on name and pk . ModelAdmin. paginator ¶ The paginator class to be used for pagination. By default, django.core.paginator.Paginator is used. If the custom paginator\nclass doesn’t have the same constructor interface as django.core.paginator.Paginator , you will also need to\nprovide an implementation for ModelAdmin.get_paginator() . ModelAdmin. prepopulated_fields ¶ Set prepopulated_fields to a dictionary mapping field names to the\nfields it should prepopulate from: class ArticleAdmin ( admin . ModelAdmin ): prepopulated_fields = { \"slug\" : [ \"title\" ]} When set, the given fields will use a bit of JavaScript to populate from\nthe fields assigned. The main use for this functionality is to\nautomatically generate the value for SlugField fields from one or more\nother fields. The generated value is produced by concatenating the values\nof the source fields, and then by transforming that result into a valid\nslug (e.g. substituting dashes for spaces and lowercasing ASCII letters). Prepopulated fields aren’t modified by JavaScript after a value has been\nsaved. It’s usually undesired that slugs change (which would cause an\nobject’s URL to change if the slug is used in it). prepopulated_fields doesn’t accept DateTimeField , ForeignKey , OneToOneField , and ManyToManyField fields. ModelAdmin. preserve_filters ¶ By default, applied filters are preserved on the list view after creating,\nediting, or deleting an object. You can have filters cleared by setting\nthis attribute to False . ModelAdmin. show_facets ¶ New in Django 5.0. Controls whether facet counts are displayed for filters in the admin\nchangelist. Defaults to ShowFacets.ALLOW . When displayed, facet counts update in line with currently applied filters. class ShowFacets ¶ New in Django 5.0. Enum of allowed values for ModelAdmin.show_facets . ALWAYS ¶ Always show facet counts. ALLOW ¶ Show facet counts when the _facets query string parameter is\nprovided. NEVER ¶ Never show facet counts. Set show_facets to the desired ShowFacets value. For example,\nto always show facet counts without needing to provide the query\nparameter: from django.contrib import admin class MyModelAdmin ( admin . ModelAdmin ): ... # Have facets always shown for this model admin. show_facets = admin . ShowFacets . ALWAYS Performance considerations with facets Enabling facet filters will increase the number of queries on the admin\nchangelist page in line with the number of filters. These queries may\ncause performance problems, especially for large datasets. In these\ncases it may be appropriate to set show_facets to ShowFacets.NEVER to disable faceting entirely. ModelAdmin. radio_fields ¶ By default, Django’s admin uses a select-box interface (<select>) for\nfields that are ForeignKey or have choices set. If a field is\npresent in radio_fields , Django will use a radio-button interface\ninstead. Assuming group is a ForeignKey on the Person model: class PersonAdmin ( admin . ModelAdmin ): radio_fields = { \"group\" : admin . VERTICAL } You have the choice of using HORIZONTAL or VERTICAL from the django.contrib.admin module. Don’t include a field in radio_fields unless it’s a ForeignKey or has choices set. ModelAdmin. autocomplete_fields ¶ autocomplete_fields is a list of ForeignKey and/or ManyToManyField fields you would like to change to Select2 autocomplete inputs. By default, the admin uses a select-box interface ( <select> ) for\nthose fields. Sometimes you don’t want to incur the overhead of selecting\nall the related instances to display in the dropdown. The Select2 input looks similar to the default input but comes with a\nsearch feature that loads the options asynchronously. This is faster and\nmore user-friendly if the related model has many instances. You must define search_fields on the related object’s ModelAdmin because the autocomplete search uses it. To avoid unauthorized data disclosure, users must have the view or change permission to the related object in order to use autocomplete. Ordering and pagination of the results are controlled by the related ModelAdmin ’s get_ordering() and get_paginator() methods. In the following example, ChoiceAdmin has an autocomplete field for the ForeignKey to the Question . The results are filtered by the question_text field and ordered by the date_created field: class QuestionAdmin ( admin . ModelAdmin ): ordering = [ \"date_created\" ] search_fields = [ \"question_text\" ] class ChoiceAdmin ( admin . ModelAdmin ): autocomplete_fields = [ \"question\" ] Performance considerations for large datasets Ordering using ModelAdmin.ordering may cause performance\nproblems as sorting on a large queryset will be slow. Also, if your search fields include fields that aren’t indexed by the\ndatabase, you might encounter poor performance on extremely large\ntables. For those cases, it’s a good idea to write your own ModelAdmin.get_search_results() implementation using a\nfull-text indexed search. You may also want to change the Paginator on very large tables\nas the default paginator always performs a count() query.\nFor example, you could override the default implementation of the Paginator.count property. ModelAdmin. raw_id_fields ¶ By default, Django’s admin uses a select-box interface (<select>) for\nfields that are ForeignKey . Sometimes you don’t want to incur the\noverhead of having to select all the related instances to display in the\ndrop-down. raw_id_fields is a list of fields you would like to change\ninto an Input widget for either a ForeignKey or ManyToManyField : class ArticleAdmin ( admin . ModelAdmin ): raw_id_fields = [ \"newspaper\" ] The raw_id_fields Input widget should contain a primary key if the\nfield is a ForeignKey or a comma separated list of values if the field\nis a ManyToManyField .  The raw_id_fields widget shows a magnifying\nglass button next to the field which allows users to search for and select\na value: ModelAdmin. readonly_fields ¶ By default the admin shows all fields as editable. Any fields in this\noption (which should be a list or tuple ) will display its data\nas-is and non-editable; they are also excluded from the ModelForm used for creating and editing. Note that\nwhen specifying ModelAdmin.fields or ModelAdmin.fieldsets the read-only fields must be present to be shown (they are ignored\notherwise). If readonly_fields is used without defining explicit ordering through ModelAdmin.fields or ModelAdmin.fieldsets they will be\nadded last after all editable fields. A read-only field can not only display data from a model’s field, it can\nalso display the output of a model’s method or a method of the ModelAdmin class itself. This is very similar to the way ModelAdmin.list_display behaves. This provides a way to use the\nadmin interface to provide feedback on the status of the objects being\nedited, for example: from django.contrib import admin from django.utils.html import format_html_join from django.utils.safestring import mark_safe class PersonAdmin ( admin . ModelAdmin ): readonly_fields = [ \"address_report\" ] # description functions like a model field's verbose_name @admin . display ( description = \"Address\" ) def address_report ( self , instance ): # assuming get_full_address() returns a list of strings # for each line of the address and you want to separate each # line by a linebreak return format_html_join ( mark_safe ( \"<br>\" ), \" {} \" , (( line ,) for line in instance . get_full_address ()), ) or mark_safe ( \"<span class='errors'>I can't determine this address.</span>\" ) ModelAdmin. save_as ¶ Set save_as to enable a “save as new” feature on admin change forms. Normally, objects have three save options: “Save”, “Save and continue\nediting”, and “Save and add another”. If save_as is True , “Save\nand add another” will be replaced by a “Save as new” button that creates a\nnew object (with a new ID) rather than updating the existing object. By default, save_as is set to False . ModelAdmin. save_as_continue ¶ When save_as=True , the default redirect after saving the\nnew object is to the change view for that object. If you set save_as_continue=False , the redirect will be to the changelist view. By default, save_as_continue is set to True . ModelAdmin. save_on_top ¶ Set save_on_top to add save buttons across the top of your admin change\nforms. Normally, the save buttons appear only at the bottom of the forms. If you\nset save_on_top , the buttons will appear both on the top and the\nbottom. By default, save_on_top is set to False . ModelAdmin. search_fields ¶ Set search_fields to enable a search box on the admin change list page.\nThis should be set to a list of field names that will be searched whenever\nsomebody submits a search query in that text box. These fields should be some kind of text field, such as CharField or TextField . You can also perform a related lookup on a ForeignKey or ManyToManyField with the lookup API “follow” notation: search_fields = [ \"foreign_key__related_fieldname\" ] For example, if you have a blog entry with an author, the following\ndefinition would enable searching blog entries by the email address of the\nauthor: search_fields = [ \"user__email\" ] When somebody does a search in the admin search box, Django splits the\nsearch query into words and returns all objects that contain each of the\nwords, case-insensitive (using the icontains lookup), where each\nword must be in at least one of search_fields . For example, if search_fields is set to ['first_name', 'last_name'] and a user\nsearches for john lennon , Django will do the equivalent of this SQL WHERE clause: WHERE ( first_name ILIKE '%john%' OR last_name ILIKE '%john%' ) AND ( first_name ILIKE '%lennon%' OR last_name ILIKE '%lennon%' ) The search query can contain quoted phrases with spaces. For example, if a\nuser searches for \"john winston\" or 'john winston' , Django will do\nthe equivalent of this SQL WHERE clause: WHERE ( first_name ILIKE '%john winston%' OR last_name ILIKE '%john winston%' ) If you don’t want to use icontains as the lookup, you can use any\nlookup by appending it the field. For example, you could use exact by setting search_fields to ['first_name__exact'] . Some (older) shortcuts for specifying a field lookup are also available.\nYou can prefix a field in search_fields with the following characters\nand it’s equivalent to adding __<lookup> to the field: Prefix Lookup ^ istartswith = iexact @ search None icontains If you need to customize search you can use ModelAdmin.get_search_results() to provide additional or alternate\nsearch behavior. ModelAdmin. search_help_text ¶ Set search_help_text to specify a descriptive text for the search box\nwhich will be displayed below it. ModelAdmin. show_full_result_count ¶ Set show_full_result_count to control whether the full count of objects\nshould be displayed on a filtered admin page (e.g. 99 results (103 total) ).\nIf this option is set to False , a text like 99 results (Show all) is displayed instead. The default of show_full_result_count=True generates a query to perform\na full count on the table which can be expensive if the table contains a\nlarge number of rows. ModelAdmin. sortable_by ¶ By default, the change list page allows sorting by all model fields (and\ncallables that use the ordering argument to the display() decorator or have the admin_order_field attribute) specified in list_display . If you want to disable sorting for some columns, set sortable_by to\na collection (e.g. list , tuple , or set ) of the subset of list_display that you want to be sortable. An empty collection\ndisables sorting for all columns. If you need to specify this list dynamically, implement a get_sortable_by() method instead. ModelAdmin. view_on_site ¶ Set view_on_site to control whether or not to display the “View on site” link.\nThis link should bring you to a URL where you can display the saved object. This value can be either a boolean flag or a callable. If True (the\ndefault), the object’s get_absolute_url() method will be used to generate the url. If your model has a get_absolute_url() method\nbut you don’t want the “View on site” button to appear, you only need to set view_on_site to False : from django.contrib import admin class PersonAdmin ( admin . ModelAdmin ): view_on_site = False In case it is a callable, it accepts the model instance as a parameter.\nFor example: from django.contrib import admin from django.urls import reverse class PersonAdmin ( admin . ModelAdmin ): def view_on_site ( self , obj ): url = reverse ( \"person-detail\" , kwargs = { \"slug\" : obj . slug }) return \"https://example.com\" + url Custom template options ¶ The Overriding admin templates section describes how to override or extend\nthe default admin templates.  Use the following options to override the default\ntemplates used by the ModelAdmin views: ModelAdmin. add_form_template ¶ Path to a custom template, used by add_view() . ModelAdmin. change_form_template ¶ Path to a custom template, used by change_view() . ModelAdmin. change_list_template ¶ Path to a custom template, used by changelist_view() . ModelAdmin. delete_confirmation_template ¶ Path to a custom template, used by delete_view() for displaying a\nconfirmation page when deleting one or more objects. ModelAdmin. delete_selected_confirmation_template ¶ Path to a custom template, used by the delete_selected action method\nfor displaying a confirmation page when deleting one or more objects. See\nthe actions documentation . ModelAdmin. object_history_template ¶ Path to a custom template, used by history_view() . ModelAdmin. popup_response_template ¶ Path to a custom template, used by response_add() , response_change() , and response_delete() . ModelAdmin methods ¶ Warning When overriding ModelAdmin.save_model() and ModelAdmin.delete_model() , your code must save/delete the\nobject. They aren’t meant for veto purposes, rather they allow you to\nperform extra operations. ModelAdmin. save_model ( request , obj , form , change ) [source] ¶ The save_model method is given the HttpRequest , a model instance,\na ModelForm instance, and a boolean value based on whether it is adding\nor changing the object. Overriding this method allows doing pre- or\npost-save operations. Call super().save_model() to save the object\nusing Model.save() . For example to attach request.user to the object prior to saving: from django.contrib import admin class ArticleAdmin ( admin . ModelAdmin ): def save_model ( self , request , obj , form , change ): obj . user = request . user super () . save_model ( request , obj , form , change ) ModelAdmin. delete_model ( request , obj ) [source] ¶ The delete_model method is given the HttpRequest and a model\ninstance. Overriding this method allows doing pre- or post-delete\noperations. Call super().delete_model() to delete the object using Model.delete() . ModelAdmin. delete_queryset ( request , queryset ) [source] ¶ The delete_queryset() method is given the HttpRequest and a QuerySet of objects to be deleted. Override this method to customize\nthe deletion process for the “delete selected objects” action . ModelAdmin. save_formset ( request , form , formset , change ) [source] ¶ The save_formset method is given the HttpRequest , the parent ModelForm instance and a boolean value based on whether it is adding or\nchanging the parent object. For example, to attach request.user to each changed formset\nmodel instance: class ArticleAdmin ( admin . ModelAdmin ): def save_formset ( self , request , form , formset , change ): instances = formset . save ( commit = False ) for obj in formset . deleted_objects : obj . delete () for instance in instances : instance . user = request . user instance . save () formset . save_m2m () See also Saving objects in the formset . Warning All hooks that return a ModelAdmin property return the property itself\nrather than a copy of its value. Dynamically modifying the value can lead\nto surprising results. Let’s take ModelAdmin.get_readonly_fields() as an example: class PersonAdmin ( admin . ModelAdmin ): readonly_fields = [ \"name\" ] def get_readonly_fields ( self , request , obj = None ): readonly = super () . get_readonly_fields ( request , obj ) if not request . user . is_superuser : readonly . append ( \"age\" ) # Edits the class attribute. return readonly This results in readonly_fields becoming [\"name\", \"age\", \"age\", ...] , even for a superuser, as \"age\" is added\neach time non-superuser visits the page. ModelAdmin. get_ordering ( request ) ¶ The get_ordering method takes a request as parameter and\nis expected to return a list or tuple for ordering similar\nto the ordering attribute. For example: class PersonAdmin ( admin . ModelAdmin ): def get_ordering ( self , request ): if request . user . is_superuser : return [ \"name\" , \"rank\" ] else : return [ \"name\" ] ModelAdmin. get_search_results ( request , queryset , search_term ) [source] ¶ The get_search_results method modifies the list of objects displayed\ninto those that match the provided search term. It accepts the request, a\nqueryset that applies the current filters, and the user-provided search term.\nIt returns a tuple containing a queryset modified to implement the search, and\na boolean indicating if the results may contain duplicates. The default implementation searches the fields named in ModelAdmin.search_fields . This method may be overridden with your own custom search method. For\nexample, you might wish to search by an integer field, or use an external\ntool such as Solr or Haystack . You must establish if the queryset\nchanges implemented by your search method may introduce duplicates into the\nresults, and return True in the second element of the return value. For example, to search by name and age , you could use: class PersonAdmin ( admin . ModelAdmin ): list_display = [ \"name\" , \"age\" ] search_fields = [ \"name\" ] def get_search_results ( self , request , queryset , search_term ): queryset , may_have_duplicates = super () . get_search_results ( request , queryset , search_term , ) try : search_term_as_int = int ( search_term ) except ValueError : pass else : queryset |= self . model . objects . filter ( age = search_term_as_int ) return queryset , may_have_duplicates This implementation is more efficient than search_fields = ('name', '=age') which results in a string comparison for the numeric\nfield, for example ... OR UPPER(\"polls_choice\".\"votes\"::text) = UPPER('4') on PostgreSQL. ModelAdmin. save_related ( request , form , formsets , change ) [source] ¶ The save_related method is given the HttpRequest , the parent ModelForm instance, the list of inline formsets and a boolean value\nbased on whether the parent is being added or changed. Here you can do any\npre- or post-save operations for objects related to the parent. Note\nthat at this point the parent object and its form have already been saved. ModelAdmin. get_autocomplete_fields ( request ) ¶ The get_autocomplete_fields() method is given the HttpRequest and is\nexpected to return a list or tuple of field names that will be\ndisplayed with an autocomplete widget as described above in the ModelAdmin.autocomplete_fields section. ModelAdmin. get_readonly_fields ( request , obj = None ) ¶ The get_readonly_fields method is given the HttpRequest and the obj being edited (or None on an add form) and is expected to return\na list or tuple of field names that will be displayed as read-only,\nas described above in the ModelAdmin.readonly_fields section. ModelAdmin. get_prepopulated_fields ( request , obj = None ) ¶ The get_prepopulated_fields method is given the HttpRequest and the obj being edited (or None on an add form) and is expected to return\na dictionary , as described above in the ModelAdmin.prepopulated_fields section. ModelAdmin. get_list_display ( request ) [source] ¶ The get_list_display method is given the HttpRequest and is\nexpected to return a list or tuple of field names that will be\ndisplayed on the changelist view as described above in the ModelAdmin.list_display section. ModelAdmin. get_list_display_links ( request , list_display ) [source] ¶ The get_list_display_links method is given the HttpRequest and\nthe list or tuple returned by ModelAdmin.get_list_display() .\nIt is expected to return either None or a list or tuple of field\nnames on the changelist that will be linked to the change view, as described\nin the ModelAdmin.list_display_links section. ModelAdmin. get_exclude ( request , obj = None ) ¶ The get_exclude method is given the HttpRequest and the obj being edited (or None on an add form) and is expected to return a list\nof fields, as described in ModelAdmin.exclude . ModelAdmin. get_fields ( request , obj = None ) ¶ The get_fields method is given the HttpRequest and the obj being edited (or None on an add form) and is expected to return a list\nof fields, as described above in the ModelAdmin.fields section. ModelAdmin. get_fieldsets ( request , obj = None ) ¶ The get_fieldsets method is given the HttpRequest and the obj being edited (or None on an add form) and is expected to return a list\nof 2-tuples, in which each 2-tuple represents a <fieldset> on the\nadmin form page, as described above in the ModelAdmin.fieldsets section. ModelAdmin. get_list_filter ( request ) [source] ¶ The get_list_filter method is given the HttpRequest and is expected\nto return the same kind of sequence type as for the list_filter attribute. ModelAdmin. get_list_select_related ( request ) [source] ¶ The get_list_select_related method is given the HttpRequest and\nshould return a boolean or list as ModelAdmin.list_select_related does. ModelAdmin. get_search_fields ( request ) [source] ¶ The get_search_fields method is given the HttpRequest and is expected\nto return the same kind of sequence type as for the search_fields attribute. ModelAdmin. get_sortable_by ( request ) ¶ The get_sortable_by() method is passed the HttpRequest and is\nexpected to return a collection (e.g. list , tuple , or set ) of\nfield names that will be sortable in the change list page. Its default implementation returns sortable_by if it’s set,\notherwise it defers to get_list_display() . For example, to prevent one or more columns from being sortable: class PersonAdmin ( admin . ModelAdmin ): def get_sortable_by ( self , request ): return { * self . get_list_display ( request )} - { \"rank\" } ModelAdmin. get_inline_instances ( request , obj = None ) [source] ¶ The get_inline_instances method is given the HttpRequest and the obj being edited (or None on an add form) and is expected to return\na list or tuple of InlineModelAdmin objects, as described below in the InlineModelAdmin section. For example, the following would return inlines without the default\nfiltering based on add, change, delete, and view permissions: class MyModelAdmin ( admin . ModelAdmin ): inlines = [ MyInline ] def get_inline_instances ( self , request , obj = None ): return [ inline ( self . model , self . admin_site ) for inline in self . inlines ] If you override this method, make sure that the returned inlines are\ninstances of the classes defined in inlines or you might encounter\na “Bad Request” error when adding related objects. ModelAdmin. get_inlines ( request , obj ) ¶ The get_inlines method is given the HttpRequest and the obj being edited (or None on an add form) and is expected to return\nan iterable of inlines. You can override this method to dynamically add\ninlines based on the request or model instance instead of specifying them\nin ModelAdmin.inlines . ModelAdmin. get_urls () [source] ¶ The get_urls method on a ModelAdmin returns the URLs to be used for\nthat ModelAdmin in the same way as a URLconf.  Therefore you can extend\nthem as documented in URL dispatcher , using the AdminSite.admin_view() wrapper on your views: from django.contrib import admin from django.template.response import TemplateResponse from django.urls import path class MyModelAdmin ( admin . ModelAdmin ): def get_urls ( self ): urls = super () . get_urls () my_urls = [ path ( \"my_view/\" , self . admin_site . admin_view ( self . my_view ))] return my_urls + urls def my_view ( self , request ): # ... context = dict ( # Include common variables for rendering the admin template. self . admin_site . each_context ( request ), # Anything else you want in the context... key = value , ) return TemplateResponse ( request , \"sometemplate.html\" , context ) If you want to use the admin layout, extend from admin/base_site.html : {% extends \"admin/base_site.html\" %} {% block content %} ... {% endblock %} Note Notice how the self.my_view function is wrapped in self.admin_site.admin_view . This is important, since it ensures two\nthings: Permission checks are run, ensuring only active staff users can\naccess the view. The django.views.decorators.cache.never_cache() decorator is\napplied to prevent caching, ensuring the returned information is\nup-to-date. Note Notice that the custom patterns are included before the regular admin\nURLs: the admin URL patterns are very permissive and will match nearly\nanything, so you’ll usually want to prepend your custom URLs to the\nbuilt-in ones. In this example, my_view will be accessed at /admin/myapp/mymodel/my_view/ (assuming the admin URLs are included\nat /admin/ .) If the page is cacheable, but you still want the permission check to be\nperformed, you can pass a cacheable=True argument to AdminSite.admin_view() : path ( \"my_view/\" , self . admin_site . admin_view ( self . my_view , cacheable = True )) ModelAdmin views have model_admin attributes. Other AdminSite views have admin_site attributes. ModelAdmin. get_form ( request , obj = None , ** kwargs ) [source] ¶ Returns a ModelForm class for use in the admin add\nand change views, see add_view() and change_view() . The base implementation uses modelform_factory() to subclass form , modified by attributes such as fields and exclude . So, for example, if you wanted to offer additional\nfields to superusers, you could swap in a different base form like so: class MyModelAdmin ( admin . ModelAdmin ): def get_form ( self , request , obj = None , ** kwargs ): if request . user . is_superuser : kwargs [ \"form\" ] = MySuperuserForm return super () . get_form ( request , obj , ** kwargs ) You may also return a custom ModelForm class\ndirectly. ModelAdmin. get_formsets_with_inlines ( request , obj = None ) [source] ¶ Yields ( FormSet , InlineModelAdmin ) pairs for use in admin add\nand change views. For example if you wanted to display a particular inline only in the change\nview, you could override get_formsets_with_inlines as follows: class MyModelAdmin ( admin . ModelAdmin ): inlines = [ MyInline , SomeOtherInline ] def get_formsets_with_inlines ( self , request , obj = None ): for inline in self . get_inline_instances ( request , obj ): # hide MyInline in the add view if not isinstance ( inline , MyInline ) or obj is not None : yield inline . get_formset ( request , obj ), inline ModelAdmin. formfield_for_foreignkey ( db_field , request , ** kwargs ) ¶ The formfield_for_foreignkey method on a ModelAdmin allows you to\noverride the default formfield for a foreign keys field. For example, to\nreturn a subset of objects for this foreign key field based on the user: class MyModelAdmin ( admin . ModelAdmin ): def formfield_for_foreignkey ( self , db_field , request , ** kwargs ): if db_field . name == \"car\" : kwargs [ \"queryset\" ] = Car . objects . filter ( owner = request . user ) return super () . formfield_for_foreignkey ( db_field , request , ** kwargs ) This uses the HttpRequest instance to filter the Car foreign key\nfield to only display the cars owned by the User instance. For more complex filters, you can use ModelForm.__init__() method to\nfilter based on an instance of your model (see Fields which handle relationships ). For example: class CountryAdminForm ( forms . ModelForm ): def __init__ ( self , * args , ** kwargs ): super () . __init__ ( * args , ** kwargs ) self . fields [ \"capital\" ] . queryset = self . instance . cities . all () class CountryAdmin ( admin . ModelAdmin ): form = CountryAdminForm ModelAdmin. formfield_for_manytomany ( db_field , request , ** kwargs ) ¶ Like the formfield_for_foreignkey method, the formfield_for_manytomany method can be overridden to change the\ndefault formfield for a many to many field. For example, if an owner can\nown multiple cars and cars can belong to multiple owners – a many to\nmany relationship – you could filter the Car foreign key field to\nonly display the cars owned by the User : class MyModelAdmin ( admin . ModelAdmin ): def formfield_for_manytomany ( self , db_field , request , ** kwargs ): if db_field . name == \"cars\" : kwargs [ \"queryset\" ] = Car . objects . filter ( owner = request . user ) return super () . formfield_for_manytomany ( db_field , request , ** kwargs ) ModelAdmin. formfield_for_choice_field ( db_field , request , ** kwargs ) ¶ Like the formfield_for_foreignkey and formfield_for_manytomany methods, the formfield_for_choice_field method can be overridden to\nchange the default formfield for a field that has declared choices. For\nexample, if the choices available to a superuser should be different than\nthose available to regular staff, you could proceed as follows: class MyModelAdmin ( admin . ModelAdmin ): def formfield_for_choice_field ( self , db_field , request , ** kwargs ): if db_field . name == \"status\" : kwargs [ \"choices\" ] = [ ( \"accepted\" , \"Accepted\" ), ( \"denied\" , \"Denied\" ), ] if request . user . is_superuser : kwargs [ \"choices\" ] . append (( \"ready\" , \"Ready for deployment\" )) return super () . formfield_for_choice_field ( db_field , request , ** kwargs ) choices limitations Any choices attribute set on the formfield will be limited to the\nform field only. If the corresponding field on the model has choices\nset, the choices provided to the form must be a valid subset of those\nchoices, otherwise the form submission will fail with\na ValidationError when the model itself\nis validated before saving. ModelAdmin. get_changelist ( request , ** kwargs ) [source] ¶ Returns the Changelist class to be used for listing. By default, django.contrib.admin.views.main.ChangeList is used. By inheriting this\nclass you can change the behavior of the listing. ModelAdmin. get_changelist_form ( request , ** kwargs ) [source] ¶ Returns a ModelForm class for use in the Formset on the changelist page. To use a custom form, for example: from django import forms class MyForm ( forms . ModelForm ): pass class MyModelAdmin ( admin . ModelAdmin ): def get_changelist_form ( self , request , ** kwargs ): return MyForm Omit the Meta.model attribute If you define the Meta.model attribute on a ModelForm , you must also define the Meta.fields attribute (or the Meta.exclude attribute). However, ModelAdmin ignores this value, overriding it with the ModelAdmin.list_editable attribute. The easiest solution is to\nomit the Meta.model attribute, since ModelAdmin will provide the\ncorrect model to use. ModelAdmin. get_changelist_formset ( request , ** kwargs ) [source] ¶ Returns a ModelFormSet class for use on the\nchangelist page if list_editable is used. To use a\ncustom formset, for example: from django.forms import BaseModelFormSet class MyAdminFormSet ( BaseModelFormSet ): pass class MyModelAdmin ( admin . ModelAdmin ): def get_changelist_formset ( self , request , ** kwargs ): kwargs [ \"formset\" ] = MyAdminFormSet return super () . get_changelist_formset ( request , ** kwargs ) ModelAdmin. lookup_allowed ( lookup , value , request ) ¶ The objects in the changelist page can be filtered with lookups from the\nURL’s query string. This is how list_filter works, for example. The\nlookups are similar to what’s used in QuerySet.filter() (e.g. user__email=user@example.com ). Since the lookups in the query string\ncan be manipulated by the user, they must be sanitized to prevent\nunauthorized data exposure. The lookup_allowed() method is given a lookup path from the query string\n(e.g. 'user__email' ), the corresponding value\n(e.g. 'user@example.com' ), and the request, and returns a boolean\nindicating whether filtering the changelist’s QuerySet using the\nparameters is permitted. If lookup_allowed() returns False , DisallowedModelAdminLookup (subclass of SuspiciousOperation ) is raised. By default, lookup_allowed() allows access to a model’s local fields,\nfield paths used in list_filter (but not paths from get_list_filter() ), and lookups required for limit_choices_to to function\ncorrectly in raw_id_fields . Override this method to customize the lookups permitted for your ModelAdmin subclass. Changed in Django 5.0: The request argument was added. ModelAdmin. has_view_permission ( request , obj = None ) ¶ Should return True if viewing obj is permitted, False otherwise.\nIf obj is None , should return True or False to indicate whether\nviewing of objects of this type is permitted in general (e.g., False will be interpreted as meaning that the current user is not permitted to\nview any object of this type). The default implementation returns True if the user has either the\n“change” or “view” permission. ModelAdmin. has_add_permission ( request ) ¶ Should return True if adding an object is permitted, False otherwise. ModelAdmin. has_change_permission ( request , obj = None ) ¶ Should return True if editing obj is permitted, False otherwise. If obj is None , should return True or False to\nindicate whether editing of objects of this type is permitted in general\n(e.g., False will be interpreted as meaning that the current user is\nnot permitted to edit any object of this type). ModelAdmin. has_delete_permission ( request , obj = None ) ¶ Should return True if deleting obj is permitted, False otherwise. If obj is None , should return True or False to\nindicate whether deleting objects of this type is permitted in general\n(e.g., False will be interpreted as meaning that the current user is\nnot permitted to delete any object of this type). ModelAdmin. has_module_permission ( request ) ¶ Should return True if displaying the module on the admin index page and\naccessing the module’s index page is permitted, False otherwise.\nUses User.has_module_perms() by default. Overriding\nit does not restrict access to the view, add, change, or delete views, has_view_permission() , has_add_permission() , has_change_permission() , and has_delete_permission() should be used for that. ModelAdmin. get_queryset ( request ) ¶ The get_queryset method on a ModelAdmin returns a QuerySet of all model instances that\ncan be edited by the admin site. One use case for overriding this method\nis to show objects owned by the logged-in user: class MyModelAdmin ( admin . ModelAdmin ): def get_queryset ( self , request ): qs = super () . get_queryset ( request ) if request . user . is_superuser : return qs return qs . filter ( author = request . user ) ModelAdmin. message_user ( request , message , level = messages.INFO , extra_tags = '' , fail_silently = False ) [source] ¶ Sends a message to the user using the django.contrib.messages backend.  See the custom ModelAdmin example . Keyword arguments allow you to change the message level, add extra CSS\ntags, or fail silently if the contrib.messages framework is not\ninstalled. These keyword arguments match those for django.contrib.messages.add_message() , see that function’s\ndocumentation for more details. One difference is that the level may be\npassed as a string label in addition to integer/constant. ModelAdmin. get_paginator ( request , queryset , per_page , orphans = 0 , allow_empty_first_page = True ) [source] ¶ Returns an instance of the paginator to use for this view. By default,\ninstantiates an instance of paginator . ModelAdmin. response_add ( request , obj , post_url_continue = None ) [source] ¶ Determines the HttpResponse for the add_view() stage. response_add is called after the admin form is submitted and\njust after the object and all the related instances have\nbeen created and saved. You can override it to change the default behavior\nafter the object has been created. ModelAdmin. response_change ( request , obj ) [source] ¶ Determines the HttpResponse for the change_view() stage. response_change is called after the admin form is submitted and\njust after the object and all the related instances have\nbeen saved. You can override it to change the default\nbehavior after the object has been changed. ModelAdmin. response_delete ( request , obj_display , obj_id ) [source] ¶ Determines the HttpResponse for the delete_view() stage. response_delete is called after the object has been\ndeleted. You can override it to change the default\nbehavior after the object has been deleted. obj_display is a string with the name of the deleted\nobject. obj_id is the serialized identifier used to retrieve the object to be\ndeleted. ModelAdmin. get_formset_kwargs ( request , obj , inline , prefix ) [source] ¶ A hook for customizing the keyword arguments passed to the constructor of a\nformset. For example, to pass request to formset forms: class MyModelAdmin ( admin . ModelAdmin ): def get_formset_kwargs ( self , request , obj , inline , prefix ): return { ** super () . get_formset_kwargs ( request , obj , inline , prefix ), \"form_kwargs\" : { \"request\" : request }, } You can also use it to set initial for formset forms. ModelAdmin. get_changeform_initial_data ( request ) [source] ¶ A hook for the initial data on admin change forms. By default, fields are\ngiven initial values from GET parameters. For instance, ?name=initial_value will set the name field’s initial value to be initial_value . This method should return a dictionary in the form {'fieldname': 'fieldval'} : def get_changeform_initial_data ( self , request ): return { \"name\" : \"custom_initial_value\" } ModelAdmin. get_deleted_objects ( objs , request ) [source] ¶ A hook for customizing the deletion process of the delete_view() and\nthe “delete selected” action . The objs argument is a homogeneous iterable of objects (a QuerySet or a list of model instances) to be deleted, and request is the HttpRequest . This method must return a 4-tuple of (deleted_objects, model_count, perms_needed, protected) . deleted_objects is a list of strings representing all the objects that\nwill be deleted. If there are any related objects to be deleted, the list\nis nested and includes those related objects. The list is formatted in the\ntemplate using the unordered_list filter. model_count is a dictionary mapping each model’s verbose_name_plural to the number of\nobjects that will be deleted. perms_needed is a set of verbose_name s\nof the models that the user doesn’t have permission to delete. protected is a list of strings representing of all the protected\nrelated objects that can’t be deleted. The list is displayed in the\ntemplate. Other methods ¶ ModelAdmin. add_view ( request , form_url = '' , extra_context = None ) [source] ¶ Django view for the model instance addition page. See note below. ModelAdmin. change_view ( request , object_id , form_url = '' , extra_context = None ) [source] ¶ Django view for the model instance editing page. See note below. ModelAdmin. changelist_view ( request , extra_context = None ) [source] ¶ Django view for the model instances change list/actions page. See note\nbelow. ModelAdmin. delete_view ( request , object_id , extra_context = None ) [source] ¶ Django view for the model instance(s) deletion confirmation page. See note\nbelow. ModelAdmin. history_view ( request , object_id , extra_context = None ) [source] ¶ Django view for the page that shows the modification history for a given\nmodel instance. Unlike the hook-type ModelAdmin methods detailed in the previous section,\nthese five methods are in reality designed to be invoked as Django views from\nthe admin application URL dispatching handler to render the pages that deal\nwith model instances CRUD operations. As a result, completely overriding these\nmethods will significantly change the behavior of the admin application. One common reason for overriding these methods is to augment the context data\nthat is provided to the template that renders the view. In the following\nexample, the change view is overridden so that the rendered template is\nprovided some extra mapping data that would not otherwise be available: class MyModelAdmin ( admin . ModelAdmin ): # A template for a very customized change view: change_form_template = \"admin/myapp/extras/openstreetmap_change_form.html\" def get_osm_info ( self ): # ... pass def change_view ( self , request , object_id , form_url = \"\" , extra_context = None ): extra_context = extra_context or {} extra_context [ \"osm_data\" ] = self . get_osm_info () return super () . change_view ( request , object_id , form_url , extra_context = extra_context , ) These views return TemplateResponse instances which allow you to easily customize the response data before\nrendering. For more details, see the TemplateResponse documentation . ModelAdmin asset definitions ¶ There are times where you would like add a bit of CSS and/or JavaScript to\nthe add/change views. This can be accomplished by using a Media inner class\non your ModelAdmin : class ArticleAdmin ( admin . ModelAdmin ): class Media : css = { \"all\" : [ \"my_styles.css\" ], } js = [ \"my_code.js\" ] The staticfiles app prepends STATIC_URL (or MEDIA_URL if STATIC_URL is None ) to any asset paths. The same rules apply as regular asset\ndefinitions on forms . jQuery ¶ Django admin JavaScript makes use of the jQuery library. To avoid conflicts with user-supplied scripts or libraries, Django’s jQuery\n(version 3.7.1) is namespaced as django.jQuery . If you want to use jQuery\nin your own admin JavaScript without including a second copy, you can use the django.jQuery object on changelist and add/edit views. Also, your own admin\nforms or widgets depending on django.jQuery must specify js=['admin/js/jquery.init.js', …] when declaring form media assets . Changed in Django 5.0: jQuery was upgraded from 3.6.4 to 3.7.1. The ModelAdmin class requires jQuery by default, so there is no need\nto add jQuery to your ModelAdmin ’s list of media resources unless you have\na specific need. For example, if you require the jQuery library to be in the\nglobal namespace (for example when using third-party jQuery plugins) or if you\nneed a newer version of jQuery, you will have to include your own copy. Django provides both uncompressed and ‘minified’ versions of jQuery, as jquery.js and jquery.min.js respectively. ModelAdmin and InlineModelAdmin have a media property\nthat returns a list of Media objects which store paths to the JavaScript\nfiles for the forms and/or formsets. If DEBUG is True it will\nreturn the uncompressed versions of the various JavaScript files, including jquery.js ; if not, it will return the ‘minified’ versions. Adding custom validation to the admin ¶ You can also add custom validation of data in the admin. The automatic admin\ninterface reuses django.forms , and the ModelAdmin class gives you\nthe ability to define your own form: class ArticleAdmin ( admin . ModelAdmin ): form = MyArticleAdminForm MyArticleAdminForm can be defined anywhere as long as you import where\nneeded. Now within your form you can add your own custom validation for\nany field: class MyArticleAdminForm ( forms . ModelForm ): def clean_name ( self ): # do something that validates your data return self . cleaned_data [ \"name\" ] It is important you use a ModelForm here otherwise things can break. See\nthe forms documentation on custom validation and, more specifically, the model form validation notes for more\ninformation. InlineModelAdmin objects ¶ class InlineModelAdmin ¶ class TabularInline [source] ¶ class StackedInline [source] ¶ The admin interface has the ability to edit models on the same page as a\nparent model. These are called inlines. Suppose you have these two models: from django.db import models class Author ( models . Model ): name = models . CharField ( max_length = 100 ) class Book ( models . Model ): author = models . ForeignKey ( Author , on_delete = models . CASCADE ) title = models . CharField ( max_length = 100 ) You can edit the books authored by an author on the author page. You add\ninlines to a model by specifying them in a ModelAdmin.inlines : from django.contrib import admin class BookInline ( admin . TabularInline ): model = Book class AuthorAdmin ( admin . ModelAdmin ): inlines = [ BookInline , ] Django provides two subclasses of InlineModelAdmin and they are: TabularInline StackedInline The difference between these two is merely the template used to render\nthem. InlineModelAdmin options ¶ InlineModelAdmin shares many of the same features as ModelAdmin , and\nadds some of its own (the shared features are actually defined in the BaseModelAdmin superclass). The shared features are: form fieldsets fields formfield_overrides exclude filter_horizontal filter_vertical ordering prepopulated_fields get_fieldsets() get_queryset() radio_fields readonly_fields raw_id_fields formfield_for_choice_field() formfield_for_foreignkey() formfield_for_manytomany() has_module_permission() The InlineModelAdmin class adds or customizes: InlineModelAdmin. model ¶ The model which the inline is using. This is required. InlineModelAdmin. fk_name ¶ The name of the foreign key on the model. In most cases this will be dealt\nwith automatically, but fk_name must be specified explicitly if there\nare more than one foreign key to the same parent model. InlineModelAdmin. formset ¶ This defaults to BaseInlineFormSet . Using\nyour own formset can give you many possibilities of customization. Inlines\nare built around model formsets . InlineModelAdmin. form ¶ The value for form defaults to ModelForm . This is what is passed\nthrough to inlineformset_factory() when\ncreating the formset for this inline. Warning When writing custom validation for InlineModelAdmin forms, be cautious\nof writing validation that relies on features of the parent model. If the\nparent model fails to validate, it may be left in an inconsistent state as\ndescribed in the warning in Validation on a ModelForm . InlineModelAdmin. classes ¶ A list or tuple containing extra CSS classes to apply to the fieldset that\nis rendered for the inlines. Defaults to None . As with classes\nconfigured in fieldsets , inlines with a collapse class will be initially collapsed using an expandable widget. Changed in Django 5.1: fieldsets using the collapse class now use <details> and <summary> elements, provided they define a name . InlineModelAdmin. extra ¶ This controls the number of extra forms the formset will display in\naddition to the initial forms. Defaults to 3. See the formsets documentation for more\ninformation. For users with JavaScript-enabled browsers, an “Add another” link is\nprovided to enable any number of additional inlines to be added in addition\nto those provided as a result of the extra argument. The dynamic link will not appear if the number of currently displayed forms\nexceeds max_num , or if the user does not have JavaScript enabled. InlineModelAdmin.get_extra() also allows you to customize the number\nof extra forms. InlineModelAdmin. max_num ¶ This controls the maximum number of forms to show in the inline. This\ndoesn’t directly correlate to the number of objects, but can if the value\nis small enough. See Limiting the number of editable objects for more information. InlineModelAdmin.get_max_num() also allows you to customize the\nmaximum number of extra forms. InlineModelAdmin. min_num ¶ This controls the minimum number of forms to show in the inline.\nSee modelformset_factory() for more information. InlineModelAdmin.get_min_num() also allows you to customize the\nminimum number of displayed forms. InlineModelAdmin. raw_id_fields ¶ By default, Django’s admin uses a select-box interface (<select>) for\nfields that are ForeignKey . Sometimes you don’t want to incur the\noverhead of having to select all the related instances to display in the\ndrop-down. raw_id_fields is a list of fields you would like to change into an Input widget for either a ForeignKey or ManyToManyField : class BookInline ( admin . TabularInline ): model = Book raw_id_fields = [ \"pages\" ] InlineModelAdmin. template ¶ The template used to render the inline on the page. InlineModelAdmin. verbose_name ¶ An override to the verbose_name from the\nmodel’s inner Meta class. InlineModelAdmin. verbose_name_plural ¶ An override to the verbose_name_plural from the model’s inner Meta class. If this isn’t given and the InlineModelAdmin.verbose_name is defined, Django will use InlineModelAdmin.verbose_name + 's' . InlineModelAdmin. can_delete ¶ Specifies whether or not inline objects can be deleted in the inline.\nDefaults to True . InlineModelAdmin. show_change_link ¶ Specifies whether or not inline objects that can be changed in the\nadmin have a link to the change form. Defaults to False . InlineModelAdmin. get_formset ( request , obj = None , ** kwargs ) ¶ Returns a BaseInlineFormSet class for use in\nadmin add/change views. obj is the parent object being edited or None when adding a new parent. See the example for ModelAdmin.get_formsets_with_inlines . InlineModelAdmin. get_extra ( request , obj = None , ** kwargs ) ¶ Returns the number of extra inline forms to use. By default, returns the InlineModelAdmin.extra attribute. Override this method to programmatically determine the number of extra\ninline forms. For example, this may be based on the model instance\n(passed as the keyword argument obj ): class BinaryTreeAdmin ( admin . TabularInline ): model = BinaryTree def get_extra ( self , request , obj = None , ** kwargs ): extra = 2 if obj : return extra - obj . binarytree_set . count () return extra InlineModelAdmin. get_max_num ( request , obj = None , ** kwargs ) ¶ Returns the maximum number of extra inline forms to use. By default,\nreturns the InlineModelAdmin.max_num attribute. Override this method to programmatically determine the maximum number of\ninline forms. For example, this may be based on the model instance\n(passed as the keyword argument obj ): class BinaryTreeAdmin ( admin . TabularInline ): model = BinaryTree def get_max_num ( self , request , obj = None , ** kwargs ): max_num = 10 if obj and obj . parent : return max_num - 5 return max_num InlineModelAdmin. get_min_num ( request , obj = None , ** kwargs ) ¶ Returns the minimum number of inline forms to use. By default,\nreturns the InlineModelAdmin.min_num attribute. Override this method to programmatically determine the minimum number of\ninline forms. For example, this may be based on the model instance\n(passed as the keyword argument obj ). InlineModelAdmin. has_add_permission ( request , obj ) ¶ Should return True if adding an inline object is permitted, False otherwise. obj is the parent object being edited or None when\nadding a new parent. InlineModelAdmin. has_change_permission ( request , obj = None ) ¶ Should return True if editing an inline object is permitted, False otherwise. obj is the parent object being edited. InlineModelAdmin. has_delete_permission ( request , obj = None ) ¶ Should return True if deleting an inline object is permitted, False otherwise. obj is the parent object being edited. Note The obj argument passed to InlineModelAdmin methods is the parent\nobject being edited or None when adding a new parent. Working with a model with two or more foreign keys to the same parent model ¶ It is sometimes possible to have more than one foreign key to the same model.\nTake this model for instance: from django.db import models class Friendship ( models . Model ): to_person = models . ForeignKey ( Person , on_delete = models . CASCADE , related_name = \"friends\" ) from_person = models . ForeignKey ( Person , on_delete = models . CASCADE , related_name = \"from_friends\" ) If you wanted to display an inline on the Person admin add/change pages\nyou need to explicitly define the foreign key since it is unable to do so\nautomatically: from django.contrib import admin from myapp.models import Friendship class FriendshipInline ( admin . TabularInline ): model = Friendship fk_name = \"to_person\" class PersonAdmin ( admin . ModelAdmin ): inlines = [ FriendshipInline , ] Working with many-to-many models ¶ By default, admin widgets for many-to-many relations will be displayed\non whichever model contains the actual reference to the ManyToManyField . Depending on your ModelAdmin definition, each many-to-many field in your model will be represented by a\nstandard HTML <select multiple> , a horizontal or vertical filter, or a raw_id_fields widget. However, it is also possible to replace these\nwidgets with inlines. Suppose we have the following models: from django.db import models class Person ( models . Model ): name = models . CharField ( max_length = 128 ) class Group ( models . Model ): name = models . CharField ( max_length = 128 ) members = models . ManyToManyField ( Person , related_name = \"groups\" ) If you want to display many-to-many relations using an inline, you can do\nso by defining an InlineModelAdmin object for the relationship: from django.contrib import admin class MembershipInline ( admin . TabularInline ): model = Group . members . through class PersonAdmin ( admin . ModelAdmin ): inlines = [ MembershipInline , ] class GroupAdmin ( admin . ModelAdmin ): inlines = [ MembershipInline , ] exclude = [ \"members\" ] There are two features worth noting in this example. Firstly - the MembershipInline class references Group.members.through .\nThe through attribute is a reference to the model that manages the\nmany-to-many relation. This model is automatically created by Django when you\ndefine a many-to-many field. Secondly, the GroupAdmin must manually exclude the members field.\nDjango displays an admin widget for a many-to-many field on the model that\ndefines the relation (in this case, Group ). If you want to use an inline\nmodel to represent the many-to-many relationship, you must tell Django’s admin\nto not display this widget - otherwise you will end up with two widgets on\nyour admin page for managing the relation. Note that when using this technique the m2m_changed signals aren’t triggered. This\nis because as far as the admin is concerned, through is just a model with\ntwo foreign key fields rather than a many-to-many relation. In all other respects, the InlineModelAdmin is exactly the same as any\nother. You can customize the appearance using any of the normal ModelAdmin properties. Working with many-to-many intermediary models ¶ When you specify an intermediary model using the through argument to a ManyToManyField , the admin will not display a\nwidget by default. This is because each instance of that intermediary model\nrequires more information than could be displayed in a single widget, and the\nlayout required for multiple widgets will vary depending on the intermediate\nmodel. However, we still want to be able to edit that information inline. Fortunately,\nwe can do this with inline admin models. Suppose we have the following models: from django.db import models class Person ( models . Model ): name = models . CharField ( max_length = 128 ) class Group ( models . Model ): name = models . CharField ( max_length = 128 ) members = models . ManyToManyField ( Person , through = \"Membership\" ) class Membership ( models . Model ): person = models . ForeignKey ( Person , on_delete = models . CASCADE ) group = models . ForeignKey ( Group , on_delete = models . CASCADE ) date_joined = models . DateField () invite_reason = models . CharField ( max_length = 64 ) The first step in displaying this intermediate model in the admin is to\ndefine an inline class for the Membership model: class MembershipInline ( admin . TabularInline ): model = Membership extra = 1 This example uses the default InlineModelAdmin values for the Membership model, and limits the extra add forms to one. This could be\ncustomized using any of the options available to InlineModelAdmin classes. Now create admin views for the Person and Group models: class PersonAdmin ( admin . ModelAdmin ): inlines = [ MembershipInline ] class GroupAdmin ( admin . ModelAdmin ): inlines = [ MembershipInline ] Finally, register your Person and Group models with the admin site: admin . site . register ( Person , PersonAdmin ) admin . site . register ( Group , GroupAdmin ) Now your admin site is set up to edit Membership objects inline from\neither the Person or the Group detail pages. Using generic relations as an inline ¶ It is possible to use an inline with generically related objects. Let’s say\nyou have the following models: from django.contrib.contenttypes.fields import GenericForeignKey from django.db import models class Image ( models . Model ): image = models . ImageField ( upload_to = \"images\" ) content_type = models . ForeignKey ( ContentType , on_delete = models . CASCADE ) object_id = models . PositiveIntegerField () content_object = GenericForeignKey ( \"content_type\" , \"object_id\" ) class Product ( models . Model ): name = models . CharField ( max_length = 100 ) If you want to allow editing and creating an Image instance on the Product , add/change views you can use GenericTabularInline or GenericStackedInline (both\nsubclasses of GenericInlineModelAdmin )\nprovided by admin . They implement tabular\nand stacked visual layouts for the forms representing the inline objects,\nrespectively, just like their non-generic counterparts. They behave just like\nany other inline. In your admin.py for this example app: from django.contrib import admin from django.contrib.contenttypes.admin import GenericTabularInline from myapp.models import Image , Product class ImageInline ( GenericTabularInline ): model = Image class ProductAdmin ( admin . ModelAdmin ): inlines = [ ImageInline , ] admin . site . register ( Product , ProductAdmin ) See the contenttypes documentation for more\nspecific information. Overriding admin templates ¶ You can override many of the templates which the admin module uses to generate\nthe various pages of an admin site. You can even override a few of these\ntemplates for a specific app, or a specific model. Set up your projects admin template directories ¶ The admin template files are located in the django/contrib/admin/templates/admin directory. In order to override one or more of them, first create an admin directory\nin your project’s templates directory. This can be any of the directories\nyou specified in the DIRS option of the DjangoTemplates backend in the TEMPLATES setting. If you have\ncustomized the 'loaders' option, be sure 'django.template.loaders.filesystem.Loader' appears before 'django.template.loaders.app_directories.Loader' so that your custom\ntemplates will be found by the template loading system before those that are\nincluded with django.contrib.admin . Within this admin directory, create sub-directories named after your app.\nWithin these app subdirectories create sub-directories named after your models.\nNote, that the admin app will lowercase the model name when looking for the\ndirectory, so make sure you name the directory in all lowercase if you are\ngoing to run your app on a case-sensitive filesystem. To override an admin template for a specific app, copy and edit the template\nfrom the django/contrib/admin/templates/admin directory, and save it to one\nof the directories you just created. For example, if we wanted to add a tool to the change list view for all the\nmodels in an app named my_app , we would copy contrib/admin/templates/admin/change_list.html to the templates/admin/my_app/ directory of our project, and make any necessary\nchanges. If we wanted to add a tool to the change list view for only a specific model\nnamed ‘Page’, we would copy that same file to the templates/admin/my_app/page directory of our project. Overriding vs. replacing an admin template ¶ Because of the modular design of the admin templates, it is usually neither\nnecessary nor advisable to replace an entire template. It is almost always\nbetter to override only the section of the template which you need to change. To continue the example above, we want to add a new link next to the History tool for the Page model. After looking at change_form.html we determine that we only need to override the object-tools-items block.\nTherefore here is our new change_form.html : {% extends \"admin/change_form.html\" %} {% load i18n admin_urls %} {% block object-tools-items %} < li > < a href = \" {% url opts | admin_urlname :'history' original.pk | admin_urlquote %} \" class = \"historylink\" > {% translate \"History\" %} </ a > </ li > < li > < a href = \"mylink/\" class = \"historylink\" > My Link </ a > </ li > {% if has_absolute_url %} < li > < a href = \" {% url 'admin:view_on_site' content_type_id original.pk %} \" class = \"viewsitelink\" > {% translate \"View on site\" %} </ a > </ li > {% endif %} {% endblock %} And that’s it! If we placed this file in the templates/admin/my_app directory, our link would appear on the change form for all models within\nmy_app. Templates which may be overridden per app or model ¶ Not every template in contrib/admin/templates/admin may be overridden per\napp or per model. The following can: actions.html app_index.html change_form.html change_form_object_tools.html change_list.html change_list_object_tools.html change_list_results.html date_hierarchy.html delete_confirmation.html object_history.html pagination.html popup_response.html prepopulated_fields_js.html search_form.html submit_line.html For those templates that cannot be overridden in this way, you may still\noverride them for your entire project by placing the new version in your templates/admin directory. This is particularly useful to create custom 404\nand 500 pages. Note Some of the admin templates, such as change_list_results.html are used\nto render custom inclusion tags. These may be overridden, but in such cases\nyou are probably better off creating your own version of the tag in\nquestion and giving it a different name. That way you can use it\nselectively. Root and login templates ¶ If you wish to change the index, login or logout templates, you are better off\ncreating your own AdminSite instance (see below), and changing the AdminSite.index_template , AdminSite.login_template or AdminSite.logout_template properties. Theming support ¶ The admin uses CSS variables to define colors and fonts. This allows changing\nthemes without having to override many individual CSS rules. For example, if\nyou preferred purple instead of blue you could add a admin/base.html template override to your project: {% extends 'admin/base.html' %} {% block extrastyle %}{{ block .super }} < style > html [ data-theme = \"light\" ], : root { --primary : #9774d5 ; --secondary : #785cab ; --link-fg : #7c449b ; --link-selected-fg : #8f5bb2 ; } </ style > {% endblock %} The list of CSS variables are defined at django/contrib/admin/static/admin/css/base.css . Dark mode variables, respecting the prefers-color-scheme media query, are\ndefined at django/contrib/admin/static/admin/css/dark_mode.css . This is\nlinked to the document in {% block dark-mode-vars %} . AdminSite objects ¶ class AdminSite ( name = 'admin' ) [source] ¶ A Django administrative site is represented by an instance of django.contrib.admin.sites.AdminSite ; by default, an instance of\nthis class is created as django.contrib.admin.site and you can\nregister your models and ModelAdmin instances with it. If you want to customize the default admin site, you can override it . When constructing an instance of an AdminSite , you can provide\na unique instance name using the name argument to the constructor. This\ninstance name is used to identify the instance, especially when reversing admin URLs . If no instance name is\nprovided, a default instance name of admin will be used.\nSee Customizing the AdminSite class for an example of customizing the AdminSite class. django.contrib.admin.sites. all_sites ¶ A WeakSet contains all admin site instances. AdminSite attributes ¶ Templates can override or extend base admin templates as described in Overriding admin templates . AdminSite. site_header ¶ The text to put at the top of each admin page, as a <div> (a string).\nBy default, this is “Django administration”. Changed in Django 5.0: In older versions, site_header was using an <h1> tag. AdminSite. site_title ¶ The text to put at the end of each admin page’s <title> (a string). By\ndefault, this is “Django site admin”. AdminSite. site_url ¶ The URL for the “View site” link at the top of each admin page. By default, site_url is / . Set it to None to remove the link. For sites running on a subpath, the each_context() method checks if\nthe current request has request.META['SCRIPT_NAME'] set and uses that\nvalue if site_url isn’t set to something other than / . AdminSite. index_title ¶ The text to put at the top of the admin index page (a string). By default,\nthis is “Site administration”. AdminSite. index_template ¶ Path to a custom template that will be used by the admin site main index\nview. AdminSite. app_index_template ¶ Path to a custom template that will be used by the admin site app index view. AdminSite. empty_value_display ¶ The string to use for displaying empty values in the admin site’s change\nlist. Defaults to a dash. The value can also be overridden on a per ModelAdmin basis and on a custom field within a ModelAdmin by\nsetting an empty_value_display attribute on the field. See ModelAdmin.empty_value_display for examples. AdminSite. enable_nav_sidebar ¶ A boolean value that determines whether to show the navigation sidebar\non larger screens. By default, it is set to True . AdminSite. final_catch_all_view ¶ A boolean value that determines whether to add a final catch-all view to\nthe admin that redirects unauthenticated users to the login page. By\ndefault, it is set to True . Warning Setting this to False is not recommended as the view protects\nagainst a potential model enumeration privacy issue. AdminSite. login_template ¶ Path to a custom template that will be used by the admin site login view. AdminSite. login_form ¶ Subclass of AuthenticationForm that\nwill be used by the admin site login view. AdminSite. logout_template ¶ Path to a custom template that will be used by the admin site logout view. AdminSite. password_change_template ¶ Path to a custom template that will be used by the admin site password\nchange view. AdminSite. password_change_done_template ¶ Path to a custom template that will be used by the admin site password\nchange done view. AdminSite methods ¶ AdminSite. each_context ( request ) [source] ¶ Returns a dictionary of variables to put in the template context for\nevery page in the admin site. Includes the following variables and values by default: site_header : AdminSite.site_header site_title : AdminSite.site_title site_url : AdminSite.site_url has_permission : AdminSite.has_permission() available_apps : a list of applications from the application registry available for the current user. Each entry in the\nlist is a dict representing an application with the following keys: app_label : the application label app_url : the URL of the application index in the admin has_module_perms : a boolean indicating if displaying and accessing of\nthe module’s index page is permitted for the current user models : a list of the models available in the application Each model is a dict with the following keys: model : the model class object_name : class name of the model name : plural name of the model perms : a dict tracking add , change , delete , and view permissions admin_url : admin changelist URL for the model add_url : admin URL to add a new model instance is_popup : whether the current page is displayed in a popup window is_nav_sidebar_enabled : AdminSite.enable_nav_sidebar log_entries : AdminSite.get_log_entries() AdminSite. get_app_list ( request , app_label = None ) [source] ¶ Returns a list of applications from the application registry available for the current user. You can optionally\npass an app_label argument to get details for a single app. Each entry\nin the list is a dictionary representing an application with the following\nkeys: app_label : the application label app_url : the URL of the application index in the admin has_module_perms : a boolean indicating if displaying and accessing of\nthe module’s index page is permitted for the current user models : a list of the models available in the application name : name of the application Each model is a dictionary with the following keys: model : the model class object_name : class name of the model name : plural name of the model perms : a dict tracking add , change , delete , and view permissions admin_url : admin changelist URL for the model add_url : admin URL to add a new model instance Lists of applications and models are sorted alphabetically by their names.\nYou can override this method to change the default order on the admin index\npage. AdminSite. has_permission ( request ) [source] ¶ Returns True if the user for the given HttpRequest has permission\nto view at least one page in the admin site. Defaults to requiring both User.is_active and User.is_staff to be True . AdminSite. register ( model_or_iterable , admin_class = None , ** options ) [source] ¶ Registers the given model class (or iterable of classes) with the given admin_class . admin_class defaults to ModelAdmin (the default admin options). If\nkeyword arguments are given – e.g. list_display – they’ll be applied\nas options to the admin class. Raises ImproperlyConfigured if a model is\nabstract. and django.contrib.admin.exceptions.AlreadyRegistered if a\nmodel is already registered. AdminSite. unregister ( model_or_iterable ) [source] ¶ Unregisters the given model class (or iterable of classes). Raises django.contrib.admin.exceptions.NotRegistered if a model isn’t\nalready registered. AdminSite. get_model_admin ( model ) [source] ¶ New in Django 5.0. Returns an admin class for the given model class. Raises django.contrib.admin.exceptions.NotRegistered if a model isn’t registered. AdminSite. get_log_entries ( request ) [source] ¶ New in Django 5.0. Returns a queryset for the related LogEntry instances, shown on the site\nindex page. This method can be overridden to filter the log entries by\nother criteria. Hooking AdminSite instances into your URLconf ¶ The last step in setting up the Django admin is to hook your AdminSite instance into your URLconf. Do this by pointing a given URL at the AdminSite.urls method. It is not necessary to use include() . In this example, we register the default AdminSite instance django.contrib.admin.site at the URL /admin/ # urls.py from django.contrib import admin from django.urls import path urlpatterns = [ path ( \"admin/\" , admin . site . urls ), ] Customizing the AdminSite class ¶ If you’d like to set up your own admin site with custom behavior, you’re free\nto subclass AdminSite and override or add anything you like. Then, create\nan instance of your AdminSite subclass (the same way you’d instantiate any\nother Python class) and register your models and ModelAdmin subclasses with\nit instead of with the default site. Finally, update myproject/urls.py to reference your AdminSite subclass. myapp/admin.py ¶ from django.contrib import admin from .models import MyModel class MyAdminSite ( admin . AdminSite ): site_header = \"Monty Python administration\" admin_site = MyAdminSite ( name = \"myadmin\" ) admin_site . register ( MyModel ) myproject/urls.py ¶ from django.urls import path from myapp.admin import admin_site urlpatterns = [ path ( \"myadmin/\" , admin_site . urls ), ] Note that you may not want autodiscovery of admin modules when using your\nown AdminSite instance since you will likely be importing all the per-app admin modules in your myproject.admin module. This means you need to\nput 'django.contrib.admin.apps.SimpleAdminConfig' instead of 'django.contrib.admin' in your INSTALLED_APPS setting. Overriding the default admin site ¶ You can override the default django.contrib.admin.site by setting the default_site attribute of a custom AppConfig to the dotted import path of either a AdminSite subclass or a callable that\nreturns a site instance. myproject/admin.py ¶ from django.contrib import admin class MyAdminSite ( admin . AdminSite ): ... myproject/apps.py ¶ from django.contrib.admin.apps import AdminConfig class MyAdminConfig ( AdminConfig ): default_site = \"myproject.admin.MyAdminSite\" myproject/settings.py ¶ INSTALLED_APPS = [ # ... \"myproject.apps.MyAdminConfig\" , # replaces 'django.contrib.admin' # ... ] Multiple admin sites in the same URLconf ¶ You can create multiple instances of the admin site on the same Django-powered\nwebsite. Create multiple instances of AdminSite and place each one at a\ndifferent URL. In this example, the URLs /basic-admin/ and /advanced-admin/ feature\nseparate versions of the admin site – using the AdminSite instances myproject.admin.basic_site and myproject.admin.advanced_site ,\nrespectively: # urls.py from django.urls import path from myproject.admin import advanced_site , basic_site urlpatterns = [ path ( \"basic-admin/\" , basic_site . urls ), path ( \"advanced-admin/\" , advanced_site . urls ), ] AdminSite instances take a single argument to their constructor, their\nname, which can be anything you like. This argument becomes the prefix to the\nURL names for the purposes of reversing them . This\nis only necessary if you are using more than one AdminSite . Adding views to admin sites ¶ Just like ModelAdmin , AdminSite provides a get_urls() method\nthat can be overridden to define additional views for the site. To add\na new view to your admin site, extend the base get_urls() method to include\na pattern for your new view. Note Any view you render that uses the admin templates, or extends the base\nadmin template, should set request.current_app before rendering the\ntemplate. It should be set to either self.name if your view is on an AdminSite or self.admin_site.name if your view is on a ModelAdmin . Adding a password reset feature ¶ You can add a password reset feature to the admin site by adding a few lines to\nyour URLconf. Specifically, add these four patterns: from django.contrib import admin from django.contrib.auth import views as auth_views path ( \"admin/password_reset/\" , auth_views . PasswordResetView . as_view ( extra_context = { \"site_header\" : admin . site . site_header } ), name = \"admin_password_reset\" , ), path ( \"admin/password_reset/done/\" , auth_views . PasswordResetDoneView . as_view ( extra_context = { \"site_header\" : admin . site . site_header } ), name = \"password_reset_done\" , ), path ( \"reset/<uidb64>/<token>/\" , auth_views . PasswordResetConfirmView . as_view ( extra_context = { \"site_header\" : admin . site . site_header } ), name = \"password_reset_confirm\" , ), path ( \"reset/done/\" , auth_views . PasswordResetCompleteView . as_view ( extra_context = { \"site_header\" : admin . site . site_header } ), name = \"password_reset_complete\" , ), (This assumes you’ve added the admin at admin/ and requires that you put\nthe URLs starting with ^admin/ before the line that includes the admin app\nitself). The presence of the admin_password_reset named URL will cause a “forgotten\nyour password?” link to appear on the default admin log-in page under the\npassword box. LogEntry objects ¶ class models. LogEntry ¶ The LogEntry class tracks additions, changes, and deletions of objects\ndone through the admin interface. LogEntry attributes ¶ LogEntry. action_time ¶ The date and time of the action. LogEntry. user ¶ The user (an AUTH_USER_MODEL instance) who performed the\naction. LogEntry. content_type ¶ The ContentType of the\nmodified object. LogEntry. object_id ¶ The textual representation of the modified object’s primary key. LogEntry. object_repr ¶ The object`s repr() after the modification. LogEntry. action_flag ¶ The type of action logged: ADDITION , CHANGE , DELETION . For example, to get a list of all additions done through the admin: from django.contrib.admin.models import ADDITION , LogEntry LogEntry . objects . filter ( action_flag = ADDITION ) LogEntry. change_message ¶ The detailed description of the modification. In the case of an edit, for\nexample, the message contains a list of the edited fields. The Django admin\nsite formats this content as a JSON structure, so that get_change_message() can recompose a message translated in the current\nuser language. Custom code might set this as a plain string though. You are\nadvised to use the get_change_message() method to retrieve this value\ninstead of accessing it directly. LogEntry methods ¶ LogEntry. get_edited_object () [source] ¶ A shortcut that returns the referenced object. LogEntry. get_change_message () [source] ¶ Formats and translates change_message into the current user\nlanguage. Messages created before Django 1.10 will always be displayed in\nthe language in which they were logged. Reversing admin URLs ¶ When an AdminSite is deployed, the views provided by that site are\naccessible using Django’s URL reversing system . The AdminSite provides the following named URL patterns: Page URL name Parameters Index index Login login Logout logout Password change password_change Password change done password_change_done i18n JavaScript jsi18n Application index page app_list app_label Redirect to object’s page view_on_site content_type_id , object_id Each ModelAdmin instance provides an additional set of named URLs: Page URL name Parameters Changelist {{ app_label }}_{{ model_name }}_changelist Add {{ app_label }}_{{ model_name }}_add History {{ app_label }}_{{ model_name }}_history object_id Delete {{ app_label }}_{{ model_name }}_delete object_id Change {{ app_label }}_{{ model_name }}_change object_id The UserAdmin provides a named URL: Page URL name Parameters Password change auth_user_password_change user_id These named URLs are registered with the application namespace admin , and\nwith an instance namespace corresponding to the name of the Site instance. So - if you wanted to get a reference to the Change view for a particular Choice object (from the polls application) in the default admin, you would\ncall: >>> from django.urls import reverse >>> c = Choice . objects . get ( ... ) >>> change_url = reverse ( \"admin:polls_choice_change\" , args = ( c . id ,)) This will find the first registered instance of the admin application\n(whatever the instance name), and resolve to the view for changing poll.Choice instances in that instance. If you want to find a URL in a specific admin instance, provide the name of\nthat instance as a current_app hint to the reverse call. For example,\nif you specifically wanted the admin view from the admin instance named custom , you would need to call: >>> change_url = reverse ( \"admin:polls_choice_change\" , args = ( c . id ,), current_app = \"custom\" ) For more details, see the documentation on reversing namespaced URLs . To allow easier reversing of the admin urls in templates, Django provides an admin_urlname filter which takes an action as argument: {% load admin_urls %} < a href = \" {% url opts | admin_urlname :'add' %} \" > Add user </ a > < a href = \" {% url opts | admin_urlname :'delete' user.pk %} \" > Delete this user </ a > The action in the examples above match the last part of the URL names for ModelAdmin instances described above. The opts variable can be any\nobject which has an app_label and model_name attributes and is usually\nsupplied by the admin views for the current model. The display decorator ¶ display ( * , boolean = None , ordering = None , description = None , empty_value = None ) [source] ¶ This decorator can be used for setting specific attributes on custom\ndisplay functions that can be used with list_display or readonly_fields : @admin . display ( boolean = True , ordering = \"-publish_date\" , description = \"Is Published?\" , ) def is_published ( self , obj ): return obj . publish_date is not None This is equivalent to setting some attributes (with the original, longer\nnames) on the function directly: def is_published ( self , obj ): return obj . publish_date is not None is_published . boolean = True is_published . admin_order_field = \"-publish_date\" is_published . short_description = \"Is Published?\" Also note that the empty_value decorator parameter maps to the empty_value_display attribute assigned directly to the function. It\ncannot be used in conjunction with boolean – they are mutually\nexclusive. Use of this decorator is not compulsory to make a display function, but it\ncan be useful to use it without arguments as a marker in your source to\nidentify the purpose of the function: @admin . display def published_year ( self , obj ): return obj . publish_date . year In this case it will add no attributes to the function. The staff_member_required decorator ¶ staff_member_required ( redirect_field_name = 'next' , login_url = 'admin:login' ) [source] ¶ This decorator is used on the admin views that require authorization. A\nview decorated with this function will have the following behavior: If the user is logged in, is a staff member ( User.is_staff=True ), and\nis active ( User.is_active=True ), execute the view normally. Otherwise, the request will be redirected to the URL specified by the login_url parameter, with the originally requested path in a query\nstring variable specified by redirect_field_name . For example: /admin/login/?next=/admin/polls/question/3/ . Example usage: from django.contrib.admin.views.decorators import staff_member_required @staff_member_required def my_view ( request ): ...", "keywords": ["prepopulated_fields_js.html", "users", "get_queryset", "queryset.filter", "rows", "box", "shares", "feature", "staff_member_required", "my_styles.css", "pattern", "formset", "login", "haystack", "searches", "selection", "defining", "messages", "declarations", "formsets", "available_apps", "myproject.apps", "search_fields", "django.contrib.messages.context_processors.messages", "library", "field", "#", "friends", "relation", "m", "custom_admin_site", "record", "visibility", "above", "total", "adminsite.urls", "django.forms", "get_prepopulated_fields", "metadata", "get_ordering", "inlinemodeladmin.get_max_num", "+", "obj_id", "index_template", "representation", "action", "full_name", "solr", "final_catch_all_view", "lines", "change_message", "stage", "httpresponse", "subset", "reuses", "password_change_template", "member", "datefield", "has_add_permission", "myform", "extra", "select2", "save_as", "needs", "words", "tool", "get_form", "change", "django.urls", "formfield_for_choice_field", "countryadmin", "links", "action_flag", "^", "save_on_top", "vertical", "modeladmin.prepopulated_fields", "label", "hook", "decade_born_in", "navigation", "presence", "indicating", "get_model_admin", "=", "changes", "basic_site", "tracks", "results", "get_absolute_url", "cities", "modeladmin.empty_value_display", "message", "relationship", "fact", "href", "inputs", "password_change", "letters", "search_help_text", "tables", "tag", "filesystem", "model_or_iterable", "button", "self.name", "horizontal", "genericforeignkey", "process", "save_formset", "debug", "adminsite.has_permission", "iexact", "choice", "lookup_allowed", "change_list_object_tools.html", "multiple", "collection", "staff", "yields", "administration", "john", "first_name", "possibilities", "modeladmin.get_search_results", "following", "type", "get_search_results", "change_list_results.html", "django.contrib.admin.sites", "content_type_id", "subpath", "custom", "kwargs", "get_edited_object", "generator", "documentation", "objects", "lookups", "author_first_name", "modeladmin.get_paginator", "class='errors'>i", "file", "john%", "actions_selection_counter", "myapp.widgets", "get_deleted_objects", "customization", "show_change_link", "genericinlinemodeladmin", "password_change_done", "layout", "modules", "get_changeform_initial_data", "get_change_message", "user", "site_title", "select_related('author", "contrib.messages", "li", "adminsite.get_log_entries", "cases", "delete_queryset", "lennon", "c", "js", "attribute", "args", "get_app_list", "radio", "queryset.datetimes", "object_id", "list_max_show_all", "show_facets", "choiceadmin", "warning", "my_view/", "get_changelist", "time", "django.contrib.auth.context_processors.auth", "jquery.init.js", "tags", "save", "basis", "date", "inlinemodeladmin", "jquery", "login_form", "setting", "raw_id_fields", "listing", "list_display_links", "purposes", "faq", "add_view", "modeladmin.list_select_related", "fieldset", "app_label", "advanced_site", "membership", "polls", "search_form.html", "things", ".models", "adminsite.site_header", "edit", "grid", "password", "short_description", "change_form.html", "respects", "name", "birth_date", "sortable_by", "unregisters", "parameter", "format_html_join", "django.views.decorators.cache.never_cache", "rule", "has_permission", "is_superuser", "productadmin", "save_as_continue", "reference", "django.contrib.auth", "issue", "age", "problems", "versions", "self.admin_site.admin_view", "modification", "appearance", "prefers", "queries", "min_num", "is_staff", "i", "django.contrib.admin", "adminsite.site_title", "django.contrib.admin.exceptions", "uses", "return", "behaves", "redirect_field_name", "inlinemodeladmin.extra", "django.jquery", "formfield_overrides", "deletion", "static_url", "applications", "reverse", "expressions", "format_html", "use_tz", "search", "parent", "jquery.js", "simpleadminconfig", "widths", "textfield", "fieldsets", "get_formset_kwargs", "blog", "countryadminform", "myadminsite", "myapp.admin", "modeladmin.exclude", "datetimefield", "requirement", "get_osm_info", "extrastyle", "question", "mymodel", "exposure", "get_fields", "examples", "question_text", "django.contrib.messages.add_message", "someotherinline", "callables", "objs", "store", "7c449b", "sessionmiddleware", "additions", "category", "status", "modeladmin.delete_model", "wrapper", "isinstance", "relationships", "extras", "dirs", "some_other_field", "modeladmin.get_formsets_with_inlines", "space", "model.save", "url", "error", "module", "code", "purple", "base.html", "popup_response_template", "superusers", "change_form_object_tools.html", "opts", "pages", "filter", "style", "behavior", "false", "link", "class", "display", "clause", "discovery", "construction", "rank", "access", "clean_name", "perms", "group", "show", "widget", "returns", "names", "javascript", "decade", "'", "sidebar", "extra_context", "to_person", "reality", "friendship", "my_app", "login_url", "modelform_factory", "show_full_result_count", "request", "formfield", "richtexteditorwidget", "database", "flag", "output", "get_readonly_fields", "input", "block", "*", "query", "page", "suspiciousoperation", "is", "search_term_as_int", "postgresql", "weakset", "count", "logout", "types", "strings", "empty_value", "elements", "modelformset_factory", "extra_tags", "subclass", "fieldname", "winston", "list_editable", "admin", "scripts", "admin/", ".", "login/?next=/admin", "datasets", "filter_vertical", "usage", "bottom", "registry", "faceting", "modelform.__init", "asset", "auth_user_model", "myproject.admin", "has_view_permission", "has_module_permission", "max_length", "step", "jsi18n", "istartswith", "password_reset/", "superclass", "super(personadmin", "has_absolute_url", "validation", "upload_to", "disclosure", "view_on_site", "include", "section", "group.members.through", "get_fieldsets", "append", "cleaned_data", "source", "my_app/", "sequence", "django.core.paginator", "dropdown", "css", "myinline", "use", "auth_views", "myadminformset", "drill", "editor", "city__name", "author", "default_site", "deleted_objects", "a", "solution", "autocomplete_fields", "user.has_module_perms", "subclasses", "groupadmin", "performance", "showfacets", "base_site.html", "get_formsets_with_inlines", "polls_choice_change", "enumeration", "content_object", "response_add", "pass", "adminsite.admin_view", "app_url", "product", "authoradmin", "criteria", "order", "default", "adminsite.site_url", "counter", "loader", "choices", "inclusion", "get_list_display_links", "fonts", "auth_user_password_change", "form", "shortcuts", "feedback", "prefix", "dash", "option", "properties", "format", "my_property", "classes", "characters", "comma", "modeladmin.list_display", "birthday", "day", "current_app", "layouts", "prepopulated_fields", "browsers", "get_max_num", "considerations", "booleanfield", "validationerror", "f", "scheme", "confirmation", "adminconfig", "caveats", "fk_name", "verbose_name_plural", "inlinemodeladmin.get_min_num", "get_changelist_formset", "modeladmin.fields", "createsuperuser", "privacy", "template", "admin.py", "actions_on_top", "onetoonefield", "django.contrib.admin.views.decorators", "way", "paginator.count", "useradmin", "formats", "super", "has_module_perms", "checks", "object_history_template", "monty", "|=", "boxes", "customizations", "allow_empty_first_page", "modeladmin.readonly_fields", "index", "delete_model", "color_code", "glass", "plugins", "user_id", "notation", "party", "queryset", "integer", "@admin", "¶", "command", "id", "baseinlineformset", "spaces", "sub", "parameters", "generictabularinline", "jquery.min.js", "int", "property", "side", "can_delete", "positiveintegerfield", "car", "content", "user__email", "span", "question/3/", "function", "meta.model", "views", "@property", "result", "admin_class", "view", "facet", "color", "django.contrib.sessions", "control", "zone", "enum", "modeladmin.get_form", "omit", "number", "lot", "modeladmin.fieldsets", "upper_case_name", "django.template.loaders.filesystem", "maps", "publish_date", "meta.exclude", "permissions", "relations", "modelform", "def", "fashion", "post_url_continue", "point", ".super", "values", "staticfiles", "response_change", "django.contrib", "directories", "string", "radio_fields", "_", "obj_display", "urls.py", "myadmin", "city", "sometemplate.html", "change_url", "tracking", "overview", "mapping", "model.delete", "app_list", "auto", "timestamp", "verbose_name", "published_year", "preserve_filters", "exclude", "table", "inlines", "has_change_permission", "libraries", "language", "customizes", "is_popup", "models", "dates", "copy", "history", "version", "ways", "level", "changelist_view", "json", "loading", "dashes", "--primary", "organization", "image", "drop", "owner", "namespace", "reader", "get_list_display", "django", "basemodeladmin", "django.contrib.auth.middleware", "flatpageadmin", "myapp", "form_kwargs", "django.contrib.flatpages.models", "n’t", "autodiscover", "db_field", "membershipinline", "div", "fields", "imageinline", "django.contrib.messages", "user.is_staff", "info", "entry", "get_formset", "set", "has_delete_permission", "lowercase", "context_processors", "get_search_fields", "override", "book", "get_inlines", "bunch", "colors", "osm_data", "icontains", "password_reset_complete", "value", "media", "phrases", "password_reset", "deletions", "line", "bit", "limit_choices_to", "save_model", "super().__init__(*args", "contenttype", "improperlyconfigured", "flatpage", "subdirectories", "columns", "implementation", "data", "resources", "item", "handler", "get_full_address", "messagemiddleware", "base", "person", "modeladmin.ordering", "inline", "admin_site", "self.my_view", "identifier", "add", "iterable", "list_display", "signals", "logout_template", "shortcut", "foreign_key__related_fieldname", "capital", "self", "user__email=user@example.com", "instance", "paths", "need", "reversing", "members", "newspaper", "pub_date", "djangotemplates", "see", "theme", "response_delete", "custom_initial_value", "interface", "original.pk", "constant", "|", "pagination.html", "modeladmin.search_fields", "modeladmin", "toggle", "veto", "functionality", "inlinemodeladmin.min_num", "front", "concat", "site_header", "^admin/", "decorator", "superuser", "same", "assets", "constructor", "instances", "structure", "statement", "get_paginator", "modeladmin.autocomplete_fields", "authenticationmiddleware", "from_person", "screens", "installed_apps", "part", "references", "delete_selected_confirmation_template", "object", "get_min_num", "load", "textarea", "couple", "deployment", "valueerror", "groups", "counts", "httprequest", "charfield", "instance(s", "management", "manytomanyfield", "precedence", "response", "get_extra", "loaders", "get_sortable_by", "collapse", "dictionary", "sql", "website", "bookinline", "directory", "reset", "my_code.js", "super().delete_model", "search_term", "delete_view", "register", "keyword", "s", "log_entries", "django.contrib.admin.site", "ordering", "fg", "openstreetmap_change_form.html", "logentry", "request.current_app", "get_list_filter", "notice", "top", "rules", "variables", "enable_nav_sidebar", "stackedinline", "root", "notes", "obj", "controls", "redirect", "js=['admin", "detail", "django.contrib.contenttypes", "request.user", "apps", "address", "linebreak", "system", "date_hierarchy", "password_change_done_template", "get_inline_instances", "themes", "changelist", "field_options", "overhead", "change_list_template", "formfield_for_foreignkey", "dependencies", "filtering", "blue", "3.7.1", "items", "imagefield", "production", "passwordresetview", "widgets", "change_list.html", "definition", "binarytree", "from_friends", "autofield", "born_in_fifties", "bad", "basemodelformset", "check", "difference", "passwordresetcompleteview", "site", "forms", "features", "’s", "fieldval", "list_select_related", "addition", "lists", "example", "unordered_list", "app", "hooks", "window", "month", "requirements", "cars", "column", "i18n", "list", "stylesheet", "unregister", "genericstackedinline", "dark_mode.css", "modeladmin.save_model", "birth_date_view", "filter_horizontal", "topics", "initial_value", "passwordresetconfirmview", "allow", "poll", "my_urls", "steps", "email", "icon", "first_name__exact", "app_index_template", "paginator", "delete_confirmation_template", "read", "model", "lennon%", "word", "password_reset_confirm", "variable", "year", "idea", "django.template.context_processors.request", "callable", "confusion", "element", "application", "django.db.models.functions", "inlineformset_factory", "viewsitelink", "actions", "conflicts", "attributes", "media_url", "editing", "slugfield", "title", "pagination", "ability", "colored_name", "get_log_entries", "django.contrib.admin.apps", "urlconf", "adminsite.enable_nav_sidebar", "inlinemodeladmin.get_extra", "object_name", "log", "sorting", "may_have_duplicates", "ones", "content_type", "admin_password_reset", "keys", "case", "equivalent", "boolean", "friendshipinline", "h1", "lookup", "blogadmin", "authorization", "accepted", "conjunction", "modeladmin.get_readonly_fields", "slug", "change_view", "django.contrib.admin.views.main", "technique", "look", "html", "adminsite.index_template", "@display", "tuple", "str", "submission", "arguments", "registers", "birth", "init", "static", "questionadmin", "middleware", "binarytreeadmin", "one", "personform", "end", "entries", "get_exclude", "contrib", "personadmin", "comparison", "admin_urlname", "startproject", "django.contrib.admin.models", "tuples", "model_count", "delete", "last_name", "user.is_active", "adminsite", "reset/<uidb64>/<token>/", "bar", "kind", "path", "duplicates", "contenttypes", "slugs", "key", "functions", "term", "winston%", "operations", "appconfig", "drilldown", "colored_first_name", "update", "super().save_model", "my_view", "none", "authenticationform", "filters", "style=\"color", "specifies", "meta", "get", "inlinemodeladmin.max_num", "patterns", "password_reset_done", "down", "definitions", "myarticleadminform", "address.</span", "formfield_for_manytomany", "reason", "framework", "counterparts", "new", "true", "templateresponse", "dict", "hyphen", "django.template.loaders.app_directories", "caching", "urls", "api", "actions_on_bottom", "support", "myapp.models", "description", "modeladmin.show_facets", "mode", "projects", "document", "vars", "apps.py", "max_num", "-", "repr", "hint", "context", "articleadmin", "permission", "saving", "upper(\"polls_choice\"", "files", "import", "cascade", "modeladmin.get_list_display", "d", "myproject.admin_site", "list_per_page", "modeladmin.inlines", ">", "defaults", "heading", "%", "pk", "meta.fields", "foreignkey", "history_view", "call", "owners", "information", "images", "row", "python", "self.admin_site.name", "methods", "books", "options", "times", "prepends", "empty_value_display", "purpose", "get_autocomplete_fields", "column-<field_name", "details", "method", "django.db", "readonly_fields", "get_changelist_form", "argument", "list_filter", "/admin/", "get_urls", "facets", "inlinemodeladmin.verbose_name", "endblock", "note", "sites", "state", "model_name", "marker", "auditentryadmin", "tools", "catch", "django.utils.html.escape", "orphans", "design", "templates", "buttons", "admin_order_field", "modeladmin.list_display_links", "crud", "autodiscovery", "text", "project", "tabularinline", "parts"], "type": "documentation"},
{"title": "Validators | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/validators/", "content": "Validators ¶ Writing validators ¶ A validator is a callable that takes a value and raises a ValidationError if it doesn’t meet some\ncriteria. Validators can be useful for reusing validation logic between\ndifferent types of fields. For example, here’s a validator that only allows even numbers: from django.core.exceptions import ValidationError from django.utils.translation import gettext_lazy as _ def validate_even ( value ): if value % 2 != 0 : raise ValidationError ( _ ( \" %(value)s is not an even number\" ), params = { \"value\" : value }, ) You can add this to a model field via the field’s validators argument: from django.db import models class MyModel ( models . Model ): even_field = models . IntegerField ( validators = [ validate_even ]) Because values are converted to Python before validators are run, you can even\nuse the same validator with forms: from django import forms class MyForm ( forms . Form ): even_field = forms . IntegerField ( validators = [ validate_even ]) You can also use a class with a __call__() method for more complex or\nconfigurable validators. RegexValidator , for example, uses this\ntechnique. If a class-based validator is used in the validators model field option, you should make\nsure it is serializable by the migration framework by adding deconstruct() and __eq__() methods. How validators are run ¶ See the form validation for more information on\nhow validators are run in forms, and Validating objects for how they’re run in models. Note that validators will\nnot be run automatically when you save a model, but if you are using a ModelForm , it will run your validators on any fields\nthat are included in your form. See the ModelForm documentation for information on\nhow model validation interacts with forms. Built-in validators ¶ The django.core.validators module contains a collection of callable\nvalidators for use with model and form fields. They’re used internally but\nare available for use with your own fields, too. They can be used in addition\nto, or in lieu of custom field.clean() methods. RegexValidator ¶ class RegexValidator ( regex = None , message = None , code = None , inverse_match = None , flags = 0 ) [source] ¶ Parameters : regex – If not None , overrides regex . Can be a regular\nexpression string or a pre-compiled regular expression. message – If not None , overrides message . code – If not None , overrides code . inverse_match – If not None , overrides inverse_match . flags – If not None , overrides flags . In that case, regex must be a regular expression string, or TypeError is raised. A RegexValidator searches the provided value for a given\nregular expression with re.search() . By default, raises a ValidationError with message and code if a match is not found. Its behavior can be inverted by\nsetting inverse_match to True , in which case the ValidationError is raised when a match is found. regex ¶ The regular expression pattern to search for within the provided value , using re.search() . This may be a string or a\npre-compiled regular expression created with re.compile() .\nDefaults to the empty string, which will be found in every possible value . message ¶ The error message used by ValidationError if validation fails.\nDefaults to \"Enter a valid value\" . code ¶ The error code used by ValidationError if validation fails. Defaults to \"invalid\" . inverse_match ¶ The match mode for regex . Defaults to False . flags ¶ The regex flags used when\ncompiling the regular expression string regex . If regex is a pre-compiled regular expression, and flags is overridden, TypeError is raised. Defaults to 0 . EmailValidator ¶ class EmailValidator ( message = None , code = None , allowlist = None ) [source] ¶ Parameters : message – If not None , overrides message . code – If not None , overrides code . allowlist – If not None , overrides allowlist . An EmailValidator ensures that a value looks like an email, and\nraises a ValidationError with message and code if it doesn’t. Values longer than 320\ncharacters are always considered invalid. message ¶ The error message used by ValidationError if validation fails.\nDefaults to \"Enter a valid email address\" . code ¶ The error code used by ValidationError if validation fails. Defaults to \"invalid\" . allowlist ¶ Allowlist of email domains. By default, a regular expression (the domain_regex attribute) is used to validate whatever appears after\nthe @ sign. However, if that string appears in the allowlist ,\nthis validation is bypassed. If not provided, the default allowlist is ['localhost'] . Other domains that don’t contain a dot won’t pass\nvalidation, so you’d need to add them to the allowlist as\nnecessary. DomainNameValidator ¶ New in Django 5.1. class DomainNameValidator ( accept_idna = True , message = None , code = None ) [source] ¶ A RegexValidator subclass that ensures a value looks like a domain\nname. Values longer than 255 characters are always considered invalid. IP\naddresses are not accepted as valid domain names. In addition to the optional arguments of its parent RegexValidator class, DomainNameValidator accepts an extra optional attribute: accept_idna ¶ Determines whether to accept internationalized domain names, that is,\ndomain names that contain non-ASCII characters. Defaults to True . URLValidator ¶ class URLValidator ( schemes = None , regex = None , message = None , code = None ) [source] ¶ A RegexValidator subclass that ensures a value looks like a URL,\nand raises an error code of 'invalid' if it doesn’t. Values longer than max_length characters are always considered invalid. Loopback addresses and reserved IP spaces are considered valid. Literal\nIPv6 addresses ( RFC 3986 Section 3.2.2 ) and Unicode domains are both\nsupported. In addition to the optional arguments of its parent RegexValidator class, URLValidator accepts an extra optional attribute: schemes ¶ URL/URI scheme list to validate against. If not provided, the default\nlist is ['http', 'https', 'ftp', 'ftps'] . As a reference, the IANA\nwebsite provides a full list of valid URI schemes . Warning Values starting with file:/// will not pass validation even\nwhen the file scheme is provided. Valid values must contain a\nhost. max_length ¶ The maximum length of values that could be considered valid. Defaults\nto 2048 characters. validate_email ¶ validate_email ¶ An EmailValidator instance without any customizations. validate_domain_name ¶ New in Django 5.1. validate_domain_name ¶ A DomainNameValidator instance without any customizations. validate_slug ¶ validate_slug ¶ A RegexValidator instance that ensures a value consists of only\nletters, numbers, underscores or hyphens. validate_unicode_slug ¶ validate_unicode_slug ¶ A RegexValidator instance that ensures a value consists of only\nUnicode letters, numbers, underscores, or hyphens. validate_ipv4_address ¶ validate_ipv4_address [source] ¶ A RegexValidator instance that ensures a value looks like an IPv4\naddress. validate_ipv6_address ¶ validate_ipv6_address [source] ¶ Uses django.utils.ipv6 to check the validity of an IPv6 address. validate_ipv46_address ¶ validate_ipv46_address [source] ¶ Uses both validate_ipv4_address and validate_ipv6_address to\nensure a value is either a valid IPv4 or IPv6 address. validate_comma_separated_integer_list ¶ validate_comma_separated_integer_list ¶ A RegexValidator instance that ensures a value is a\ncomma-separated list of integers. int_list_validator ¶ int_list_validator ( sep = ',' , message = None , code = 'invalid' , allow_negative = False ) [source] ¶ Returns a RegexValidator instance that ensures a string consists\nof integers separated by sep . It allows negative integers when allow_negative is True . MaxValueValidator ¶ class MaxValueValidator ( limit_value , message = None ) [source] ¶ Raises a ValidationError with a code of 'max_value' if value is greater than limit_value , which may be\na callable. MinValueValidator ¶ class MinValueValidator ( limit_value , message = None ) [source] ¶ Raises a ValidationError with a code of 'min_value' if value is less than limit_value , which may be a\ncallable. MaxLengthValidator ¶ class MaxLengthValidator ( limit_value , message = None ) [source] ¶ Raises a ValidationError with a code of 'max_length' if the length of value is greater than limit_value , which may be a callable. MinLengthValidator ¶ class MinLengthValidator ( limit_value , message = None ) [source] ¶ Raises a ValidationError with a code of 'min_length' if the length of value is less than limit_value ,\nwhich may be a callable. DecimalValidator ¶ class DecimalValidator ( max_digits , decimal_places ) [source] ¶ Raises ValidationError with the following\ncodes: 'max_digits' if the number of digits is larger than max_digits . 'max_decimal_places' if the number of decimals is larger than decimal_places . 'max_whole_digits' if the number of whole digits is larger than\nthe difference between max_digits and decimal_places . FileExtensionValidator ¶ class FileExtensionValidator ( allowed_extensions , message , code ) [source] ¶ Raises a ValidationError with a code of 'invalid_extension' if the extension of value.name ( value is\na File ) isn’t found in allowed_extensions .\nThe extension is compared case-insensitively with allowed_extensions . Warning Don’t rely on validation of the file extension to determine a file’s\ntype. Files can be renamed to have any extension no matter what data\nthey contain. validate_image_file_extension ¶ validate_image_file_extension [source] ¶ Uses Pillow to ensure that value.name ( value is a File ) has a valid image extension . ProhibitNullCharactersValidator ¶ class ProhibitNullCharactersValidator ( message = None , code = None ) [source] ¶ Raises a ValidationError if str(value) contains one or more null characters ( '\\x00' ). Parameters : message – If not None , overrides message . code – If not None , overrides code . message ¶ The error message used by ValidationError if validation fails.\nDefaults to \"Null characters are not allowed.\" . code ¶ The error code used by ValidationError if validation fails. Defaults to \"null_characters_not_allowed\" . StepValueValidator ¶ class StepValueValidator ( limit_value , message = None , offset = None ) [source] ¶ Raises a ValidationError with a code of 'step_size' if value is not an integral multiple of limit_value , which can be a float, integer or decimal value or a\ncallable. When offset is set, the validation occurs against limit_value plus offset . For example, for StepValueValidator(3, offset=1.4) valid values include 1.4 , 4.4 , 7.4 , 10.4 , and so on. Changed in Django 5.0: The offset argument was added.", "keywords": ["mymodel", "validate_comma_separated_integer_list", "float", "integerfield", "validate_ipv4_address", "pattern", "underscores", "number", "url", "modelform", "error", "module", "validate_ipv6_address", "code", "difference", "pillow", "values", "forms", "regexvalidator", "string", "behavior", "false", "addition", "_", "example", "field", "class", "migration", "validate_domain_name", "fileextensionvalidator", "validate_ipv46_address", "int_list_validator", "list", "min_value", "file:///", "sep", "names", "'", "stepvaluevalidator(3", "deconstruct", "numbers", "validate_unicode_slug", "regex", "host", "email", "value.name", "models", "match", "ipv6", "allowlist", "types", "myform", "model", "prohibitnullcharactersvalidator", "hyphens", "subclass", "callable", "value)s", "emailvalidator", "django.core.validators", "image", "django", "django.core.exceptions", "http", "=", "rfc", "re.search", "max_length", "fields", "localhost", "ip", "message", "field.clean", "schemes", "validation", "letters", "value", "domainnamevalidator", "section", "validator", "validate_email", "codes", "source", "validate_slug", "invalid_extension", "case", "length", "data", "loopback", "use", "technique", "collection", "multiple", "arguments", "even_field", "ipv4", "type", "decimalvalidator", "custom", "instance", "objects", "documentation", "invalid", "typeerror", "uri", "file", "max_whole_digits", "overrides", "max_decimal_places", "ftp", "criteria", "extension", "urlvalidator", "params", "default", "validators", "validity", "django.utils.translation", "inverse_match", "validate_image_file_extension", "unicode", "lieu", "form", "attribute", "none", "option", "expression", "characters", "comma", "sign", "gettext_lazy", "digits", "maxlengthvalidator", "minlengthvalidator", "stepvaluevalidator", "framework", "allowed_extensions", "new", "true", "limit_value", "validationerror", "re.compile", "max_value", "scheme", "mode", "domains", "decimals", "domain", "decimal_places", "logic", "import", "name", "files", "dot", "website", "%", "defaults", "flags", "iana", "minvaluevalidator", "django.utils.ipv6", "information", "reference", "allow_negative", "python", "domain_regex", "min_length", "methods", "customizations", "max_digits", "method", "integer", "django.db", "uses", "argument", "addresses", "¶", "spaces", "parameters", "address", "integers", "validate_even", "parent", "maxvaluevalidator"], "type": "documentation"},
{"title": "Model Meta options | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/options/", "content": "Model Meta options ¶ This document explains all the possible metadata options that you can give your model in its internal class Meta . Available Meta options ¶ abstract ¶ Options. abstract ¶ If abstract = True , this model will be an abstract base class . app_label ¶ Options. app_label ¶ If a model is defined outside of an application in INSTALLED_APPS , it must declare which app it belongs to: app_label = \"myapp\" If you want to represent a model with the format app_label.object_name or app_label.model_name you can use model._meta.label or model._meta.label_lower respectively. base_manager_name ¶ Options. base_manager_name ¶ The attribute name of the manager, for example, 'objects' , to use for\nthe model’s _base_manager . db_table ¶ Options. db_table ¶ The name of the database table to use for the model: db_table = \"music_album\" Table names ¶ To save you time, Django automatically derives the name of the database table\nfrom the name of your model class and the app that contains it. A model’s\ndatabase table name is constructed by joining the model’s “app label” – the\nname you used in manage.py startapp – to the model’s\nclass name, with an underscore between them. For example, if you have an app bookstore (as created by manage.py startapp bookstore ), a model defined as class Book will have\na database table named bookstore_book . To override the database table name, use the db_table parameter in class Meta . If your database table name is an SQL reserved word, or contains characters that\naren’t allowed in Python variable names – notably, the hyphen – that’s OK.\nDjango quotes column and table names behind the scenes. Use lowercase table names for MariaDB and MySQL It is strongly advised that you use lowercase table names when you override\nthe table name via db_table , particularly if you are using the MySQL\nbackend. See the MySQL notes for more details. Table name quoting for Oracle In order to meet the 30-char limitation Oracle has on table names,\nand match the usual conventions for Oracle databases, Django may shorten\ntable names and turn them all-uppercase. To prevent such transformations,\nuse a quoted name as the value for db_table : db_table = '\"name_left_in_lowercase\"' Such quoted names can also be used with Django’s other supported database\nbackends; except for Oracle, however, the quotes have no effect. See the Oracle notes for more details. db_table_comment ¶ Options. db_table_comment ¶ The comment on the database table to use for this model. It is useful for\ndocumenting database tables for individuals with direct database access who may\nnot be looking at your Django code. For example: class Answer ( models . Model ): question = models . ForeignKey ( Question , on_delete = models . CASCADE ) answer = models . TextField () class Meta : db_table_comment = \"Question answers\" db_tablespace ¶ Options. db_tablespace ¶ The name of the database tablespace to use\nfor this model. The default is the project’s DEFAULT_TABLESPACE setting, if set. If the backend doesn’t support tablespaces, this option is\nignored. default_manager_name ¶ Options. default_manager_name ¶ The name of the manager to use for the model’s _default_manager . default_related_name ¶ Options. default_related_name ¶ The name that will be used by default for the relation from a related object\nback to this one. The default is <model_name>_set . This option also sets related_query_name . As the reverse name for a field should be unique, be careful if you intend\nto subclass your model. To work around name collisions, part of the name\nshould contain '%(app_label)s' and '%(model_name)s' , which are\nreplaced respectively by the name of the application the model is in,\nand the name of the model, both lowercased. See the paragraph on related names for abstract models . get_latest_by ¶ Options. get_latest_by ¶ The name of a field or a list of field names in the model, typically DateField , DateTimeField , or IntegerField . This\nspecifies the default field(s) to use in your model Manager ’s latest() and earliest() methods. Example: # Latest by ascending order_date. get_latest_by = \"order_date\" # Latest by priority descending, order_date ascending. get_latest_by = [ \"-priority\" , \"order_date\" ] See the latest() docs for more. managed ¶ Options. managed ¶ Defaults to True , meaning Django will create the appropriate database\ntables in migrate or as part of migrations and remove them as\npart of a flush management command. That is, Django manages the database tables’ lifecycles. If False , no database table creation, modification, or deletion\noperations will be performed for this model. This is useful if the model\nrepresents an existing table or a database view that has been created by\nsome other means. This is the only difference when managed=False . All\nother aspects of model handling are exactly the same as normal. This\nincludes Adding an automatic primary key field to the model if you don’t\ndeclare it.  To avoid confusion for later code readers, it’s\nrecommended to specify all the columns from the database table you\nare modeling when using unmanaged models. If a model with managed=False contains a ManyToManyField that points to another\nunmanaged model, then the intermediate table for the many-to-many\njoin will also not be created. However, the intermediary table\nbetween one managed and one unmanaged model will be created. If you need to change this default behavior, create the intermediary\ntable as an explicit model (with managed set as needed) and use\nthe ManyToManyField.through attribute to make the relation\nuse your custom model. For tests involving models with managed=False , it’s up to you to ensure\nthe correct tables are created as part of the test setup. If you’re interested in changing the Python-level behavior of a model class,\nyou could use managed=False and create a copy of an existing model.\nHowever, there’s a better approach for that situation: Proxy models . order_with_respect_to ¶ Options. order_with_respect_to ¶ Makes this object orderable with respect to the given field, usually a ForeignKey . This can be used to make related objects orderable with\nrespect to a parent object. For example, if an Answer relates to a Question object, and a question has more than one answer, and the order\nof answers matters, you’d do this: from django.db import models class Question ( models . Model ): text = models . TextField () # ... class Answer ( models . Model ): question = models . ForeignKey ( Question , on_delete = models . CASCADE ) # ... class Meta : order_with_respect_to = \"question\" When order_with_respect_to is set, two additional methods are provided to\nretrieve and to set the order of the related objects: get_RELATED_order() and set_RELATED_order() , where RELATED is the lowercased model name. For\nexample, assuming that a Question object has multiple related Answer objects, the list returned contains the primary keys of the related Answer objects: >>> question = Question . objects . get ( id = 1 ) >>> question . get_answer_order () [1, 2, 3] The order of a Question object’s related Answer objects can be set by\npassing in a list of Answer primary keys: >>> question . set_answer_order ([ 3 , 1 , 2 ]) The related objects also get two methods, get_next_in_order() and get_previous_in_order() , which can be used to access those objects in their\nproper order. Assuming the Answer objects are ordered by id : >>> answer = Answer . objects . get ( id = 2 ) >>> answer . get_next_in_order () <Answer: 3> >>> answer . get_previous_in_order () <Answer: 1> order_with_respect_to implicitly sets the ordering option Internally, order_with_respect_to adds an additional field/database\ncolumn named _order and sets the model’s ordering option to this field. Consequently, order_with_respect_to and ordering cannot be used together, and the ordering added by order_with_respect_to will apply whenever you obtain a list of objects\nof this model. Changing order_with_respect_to Because order_with_respect_to adds a new database column, be sure to\nmake and apply the appropriate migrations if you add or change order_with_respect_to after your initial migrate . ordering ¶ Options. ordering ¶ The default ordering for the object, for use when obtaining lists of objects: ordering = [ \"-order_date\" ] This is a tuple or list of strings and/or query expressions. Each string is\na field name with an optional “-” prefix, which indicates descending order.\nFields without a leading “-” will be ordered ascending. Use the string “?”\nto order randomly. For example, to order by a pub_date field ascending, use this: ordering = [ \"pub_date\" ] To order by pub_date descending, use this: ordering = [ \"-pub_date\" ] To order by pub_date descending, then by author ascending, use this: ordering = [ \"-pub_date\" , \"author\" ] You can also use query expressions . To\norder by author ascending and make null values sort last, use this: from django.db.models import F ordering = [ F ( \"author\" ) . asc ( nulls_last = True )] Warning Ordering is not a free operation. Each field you add to the ordering\nincurs a cost to your database. Each foreign key you add will\nimplicitly include all of its default orderings as well. If a query doesn’t have an ordering specified, results are returned from\nthe database in an unspecified order. A particular ordering is guaranteed\nonly when ordering by a set of fields that uniquely identify each object in\nthe results. For example, if a name field isn’t unique, ordering by it\nwon’t guarantee objects with the same name always appear in the same order. permissions ¶ Options. permissions ¶ Extra permissions to enter into the permissions table when creating this object.\nAdd, change, delete, and view permissions are automatically created for each\nmodel. This example specifies an extra permission, can_deliver_pizzas : permissions = [( \"can_deliver_pizzas\" , \"Can deliver pizzas\" )] This is a list or tuple of 2-tuples in the format (permission_code, human_readable_permission_name) . default_permissions ¶ Options. default_permissions ¶ Defaults to ('add', 'change', 'delete', 'view') . You may customize this\nlist, for example, by setting this to an empty list if your app doesn’t\nrequire any of the default permissions. It must be specified on the model\nbefore the model is created by migrate in order to prevent any\nomitted permissions from being created. proxy ¶ Options. proxy ¶ If proxy = True , a model which subclasses another model will be treated as\na proxy model . required_db_features ¶ Options. required_db_features ¶ List of database features that the current connection should have so that\nthe model is considered during the migration phase. For example, if you set\nthis list to ['gis_enabled'] , the model will only be synchronized on\nGIS-enabled databases. It’s also useful to skip some models when testing\nwith several database backends. Avoid relations between models that may or\nmay not be created as the ORM doesn’t handle this. required_db_vendor ¶ Options. required_db_vendor ¶ Name of a supported database vendor that this model is specific to. Current\nbuilt-in vendor names are: sqlite , postgresql , mysql , oracle . If this attribute is not empty and the current connection vendor\ndoesn’t match it, the model will not be synchronized. select_on_save ¶ Options. select_on_save ¶ Determines if Django will use the pre-1.6 django.db.models.Model.save() algorithm. The old algorithm\nuses SELECT to determine if there is an existing row to be updated.\nThe new algorithm tries an UPDATE directly. In some rare cases the UPDATE of an existing row isn’t visible to Django. An example is the\nPostgreSQL ON UPDATE trigger which returns NULL . In such cases the\nnew algorithm will end up doing an INSERT even when a row exists in\nthe database. Usually there is no need to set this attribute. The default is False . See django.db.models.Model.save() for more about the old and\nnew saving algorithm. indexes ¶ Options. indexes ¶ A list of indexes that you want to define on\nthe model: from django.db import models class Customer ( models . Model ): first_name = models . CharField ( max_length = 100 ) last_name = models . CharField ( max_length = 100 ) class Meta : indexes = [ models . Index ( fields = [ \"last_name\" , \"first_name\" ]), models . Index ( fields = [ \"first_name\" ], name = \"first_name_idx\" ), ] unique_together ¶ Options. unique_together ¶ Use UniqueConstraint with the constraints option instead. UniqueConstraint provides more functionality than unique_together . unique_together may be deprecated in the\nfuture. Sets of field names that, taken together, must be unique: unique_together = [[ \"driver\" , \"restaurant\" ]] This is a list of lists that must be unique when considered together.\nIt’s used in the Django admin and is enforced at the database level (i.e., the\nappropriate UNIQUE statements are included in the CREATE TABLE statement). For convenience, unique_together can be a single list when dealing with\na single set of fields: unique_together = [ \"driver\" , \"restaurant\" ] A ManyToManyField cannot be included in unique_together . (It’s not clear what that would even mean!) If you\nneed to validate uniqueness related to a ManyToManyField , try using a signal or\nan explicit through model. The ValidationError raised during model validation when the constraint\nis violated has the unique_together error code. constraints ¶ Options. constraints ¶ A list of constraints that you want to\ndefine on the model: from django.db import models class Customer ( models . Model ): age = models . IntegerField () class Meta : constraints = [ models . CheckConstraint ( condition = models . Q ( age__gte = 18 ), name = \"age_gte_18\" ), ] verbose_name ¶ Options. verbose_name ¶ A human-readable name for the object, singular: verbose_name = \"pizza\" If this isn’t given, Django will use a munged version of the class name: CamelCase becomes camel case . verbose_name_plural ¶ Options. verbose_name_plural ¶ The plural name for the object: verbose_name_plural = \"stories\" If this isn’t given, Django will use verbose_name + \"s\" . Read-only Meta attributes ¶ label ¶ Options. label ¶ Representation of the object, returns app_label.object_name , e.g. 'polls.Question' . label_lower ¶ Options. label_lower ¶ Representation of the model, returns app_label.model_name , e.g. 'polls.question' .", "keywords": ["question", "matters", "testing", "view", "integerfield", "indexes", "first_name_idx", "proxy", "join", "permissions", "relations", "error", "difference", "code", "values", "algorithm", "asc", "false", "behavior", "string", "access", "model._meta.label", "class", "example", "_", "field", "app", "#", "i", "lists", "migration", "relation", "column", "list", "intermediary", "migrations", "age_gte_18", "names", "select_on_save", "orm", "returns", "databases", "unique_together", "label_lower", "answer", "default_related_name", "documenting", "app_label)s", "paragraph", "verbose_name", "database", "table", "representation", "signal", "models", "query", "copy", "test", "-order_date", "required_db_vendor", "postgresql", "age__gte", "version", "datefield", "migrate", "level", "phase", "strings", "determines", "model", "word", "permission_code", "change", "creation", "gis", "confusion", ".", "application", "tablespace", "set_related_order", "set_answer_order", "insert", "label", "on", "condition", "approach", "django", "=", "myapp", "base_manager_name", "n’t", "bookstore_book", "max_length", "results", "fields", "available", "set", "lowercase", "validation", "individuals", "book", "human_readable_permission_name", "setup", "required_db_features", "value", "tables", "select", "camel", "uniqueconstraint", "sets", "keys", "lifecycles", "related_query_name", "columns", "case", "polls.question", "underscore", "default_manager", "null", "related", "use", "base", "backend", "cost", "tuple", "future", "conventions", "first_name", "uniqueness", "quotes", "author", "bookstore", "driver", "one", "need", "custom", "stories", "objects", "default_manager_name", "singular", "pub_date", "answers", "sqlite", "camelcase", "tuples", "constraint", "handling", "operation", "order", "aspects", "last_name", "model_name)s", "default", "cases", "respect", "functionality", "key", "polls", "operations", "comment", "update", "attribute", "prefix", "get_answer_order", "option", "docs", "format", "scenes", "pizzas", "characters", "readers", "tests", "warning", "meta", "constraints", "collisions", "time", "checkconstraint", "pizza", "q", "pre-1.6", "startapp", "setting", "true", "statement", "app_label.object_name", "hyphen", "app_label", "convenience", "part", "validationerror", "f", "char", "db_tablespace", "object", "document", "get_latest_by", "field(s", "priority", "descending", "app_label.model_name", "get_next_in_order", "connection", "transformations", "model._meta.label_lower", "name_left_in_lowercase", "verbose_name_plural", "permission", "orderings", "saving", "import", "name", "cascade", "d", "limitation", "customer", "charfield", "parameter", "management", "manytomanyfield", "mysql", "statements", "%", "sql", "defaults", "foreignkey", "order_date", "backends", "tablespaces", "row", "python", "age", "ascending", "uppercase", "methods", "trigger", "modification", "s", "options", "music_album", "ordering", "index", "vendor", "manager", "details", "django.db", "notes", "¶", "command", "get_related_order", "get_previous_in_order", "default_permissions", "deletion", "django.db.models.model.save", "effect", "oracle", "-priority", "situation", "expressions", "restaurant", "order_with_respect_to", "parent", "means", "base_manager", "textfield", "default_tablespace", "text", "project", "datetimefield"], "type": "documentation"},
{"title": "Settings | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/settings/", "content": "Settings ¶ Core Settings Auth Messages Sessions Sites Static Files Core Settings Topical Index Warning Be careful when you override settings, especially when the default value\nis a non-empty list or dictionary, such as STATICFILES_FINDERS .\nMake sure you keep the components required by the features of Django you\nwish to use. Core Settings ¶ Here’s a list of settings available in Django core and their default values.\nSettings provided by contrib apps are listed below, followed by a topical index\nof the core settings. For introductory material, see the settings topic\nguide . ABSOLUTE_URL_OVERRIDES ¶ Default: {} (Empty dictionary) A dictionary mapping \"app_label.model_name\" strings to functions that take\na model object and return its URL. This is a way of inserting or overriding get_absolute_url() methods on a per-installation basis. Example: ABSOLUTE_URL_OVERRIDES = { \"blogs.blog\" : lambda o : \"/blogs/ %s /\" % o . slug , \"news.story\" : lambda o : \"/stories/ %s / %s /\" % ( o . pub_year , o . slug ), } The model name used in this setting should be all lowercase, regardless of the\ncase of the actual model class name. ADMINS ¶ Default: [] (Empty list) A list of all the people who get code error notifications. When DEBUG=False and AdminEmailHandler is configured in LOGGING (done by default), Django emails these\npeople the details of exceptions raised in the request/response cycle. Each item in the list should be a tuple of (Full name, email address). Example: [( \"John\" , \"john@example.com\" ), ( \"Mary\" , \"mary@example.com\" )] ALLOWED_HOSTS ¶ Default: [] (Empty list) A list of strings representing the host/domain names that this Django site can\nserve. This is a security measure to prevent HTTP Host header attacks , which are possible even under many\nseemingly-safe web server configurations. Values in this list can be fully qualified names (e.g. 'www.example.com' ),\nin which case they will be matched against the request’s Host header\nexactly (case-insensitive, not including port). A value beginning with a period\ncan be used as a subdomain wildcard: '.example.com' will match example.com , www.example.com , and any other subdomain of example.com . A value of '*' will match anything; in this case you are\nresponsible to provide your own validation of the Host header (perhaps in a\nmiddleware; if so this middleware must be listed first in MIDDLEWARE ). Django also allows the fully qualified domain name (FQDN) of any entries.\nSome browsers include a trailing dot in the Host header which Django\nstrips when performing host validation. If the Host header (or X-Forwarded-Host if USE_X_FORWARDED_HOST is enabled) does not match any value in this\nlist, the django.http.HttpRequest.get_host() method will raise SuspiciousOperation . When DEBUG is True and ALLOWED_HOSTS is empty, the host\nis validated against ['.localhost', '127.0.0.1', '[::1]'] . ALLOWED_HOSTS is also checked when running tests . This validation only applies via get_host() ;\nif your code accesses the Host header directly from request.META you\nare bypassing this security protection. APPEND_SLASH ¶ Default: True When set to True , if the request URL does not match any of the patterns\nin the URLconf and it doesn’t end in a slash, an HTTP redirect is issued to the\nsame URL with a slash appended. Note that the redirect may cause any data\nsubmitted in a POST request to be lost. The APPEND_SLASH setting is only used if CommonMiddleware is installed\n(see Middleware ). See also PREPEND_WWW . CACHES ¶ Default: { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.locmem.LocMemCache\" , } } A dictionary containing the settings for all caches to be used with\nDjango. It is a nested dictionary whose contents maps cache aliases\nto a dictionary containing the options for an individual cache. The CACHES setting must configure a default cache;\nany number of additional caches may also be specified. If you\nare using a cache backend other than the local memory cache, or\nyou need to define multiple caches, other options will be required.\nThe following cache options are available. BACKEND ¶ Default: '' (Empty string) The cache backend to use. The built-in cache backends are: 'django.core.cache.backends.db.DatabaseCache' 'django.core.cache.backends.dummy.DummyCache' 'django.core.cache.backends.filebased.FileBasedCache' 'django.core.cache.backends.locmem.LocMemCache' 'django.core.cache.backends.memcached.PyMemcacheCache' 'django.core.cache.backends.memcached.PyLibMCCache' 'django.core.cache.backends.redis.RedisCache' You can use a cache backend that doesn’t ship with Django by setting BACKEND to a fully-qualified path of a cache\nbackend class (i.e. mypackage.backends.whatever.WhateverCache ). KEY_FUNCTION ¶ A string containing a dotted path to a function (or any callable) that defines how to\ncompose a prefix, version and key into a final cache key. The default\nimplementation is equivalent to the function: def make_key ( key , key_prefix , version ): return \":\" . join ([ key_prefix , str ( version ), key ]) You may use any key function you want, as long as it has the same\nargument signature. See the cache documentation for more\ninformation. KEY_PREFIX ¶ Default: '' (Empty string) A string that will be automatically included (prepended by default) to\nall cache keys used by the Django server. See the cache documentation for more information. LOCATION ¶ Default: '' (Empty string) The location of the cache to use. This might be the directory for a\nfile system cache, a host and port for a memcache server, or an identifying\nname for a local memory cache. e.g.: CACHES = { \"default\" : { \"BACKEND\" : \"django.core.cache.backends.filebased.FileBasedCache\" , \"LOCATION\" : \"/var/tmp/django_cache\" , } } OPTIONS ¶ Default: None Extra parameters to pass to the cache backend. Available parameters\nvary depending on your cache backend. Some information on available parameters can be found in the cache arguments documentation. For more information,\nconsult your backend module’s own documentation. TIMEOUT ¶ Default: 300 The number of seconds before a cache entry is considered stale. If the value of\nthis setting is None , cache entries will not expire. A value of 0 causes keys to immediately expire (effectively “don’t cache”). VERSION ¶ Default: 1 The default version number for cache keys generated by the Django server. See the cache documentation for more information. CACHE_MIDDLEWARE_ALIAS ¶ Default: 'default' The cache connection to use for the cache middleware . CACHE_MIDDLEWARE_KEY_PREFIX ¶ Default: '' (Empty string) A string which will be prefixed to the cache keys generated by the cache\nmiddleware . This prefix is combined with the KEY_PREFIX setting; it does not replace it. See Django’s cache framework . CACHE_MIDDLEWARE_SECONDS ¶ Default: 600 The default integer number of seconds to cache a page for the cache middleware . See Django’s cache framework . CSRF_COOKIE_AGE ¶ Default: 31449600 (approximately 1 year, in seconds) The age of CSRF cookies, in seconds. The reason for setting a long-lived expiration time is to avoid problems in\nthe case of a user closing a browser or bookmarking a page and then loading\nthat page from a browser cache. Without persistent cookies, the form submission\nwould fail in this case. Some browsers (specifically Internet Explorer) can disallow the use of\npersistent cookies or can have the indexes to the cookie jar corrupted on disk,\nthereby causing CSRF protection checks to (sometimes intermittently) fail.\nChange this setting to None to use session-based CSRF cookies, which\nkeep the cookies in-memory instead of on persistent storage. CSRF_COOKIE_DOMAIN ¶ Default: None The domain to be used when setting the CSRF cookie.  This can be useful for\neasily allowing cross-subdomain requests to be excluded from the normal cross\nsite request forgery protection.  It should be set to a string such as \".example.com\" to allow a POST request from a form on one subdomain to be\naccepted by a view served from another subdomain. Please note that the presence of this setting does not imply that Django’s CSRF\nprotection is safe from cross-subdomain attacks by default - please see the CSRF limitations section. CSRF_COOKIE_HTTPONLY ¶ Default: False Whether to use HttpOnly flag on the CSRF cookie. If this is set to True , client-side JavaScript will not be able to access the CSRF cookie. Designating the CSRF cookie as HttpOnly doesn’t offer any practical\nprotection because CSRF is only to protect against cross-domain attacks. If an\nattacker can read the cookie via JavaScript, they’re already on the same domain\nas far as the browser knows, so they can do anything they like anyway. (XSS is\na much bigger hole than CSRF.) Although the setting offers little practical benefit, it’s sometimes required\nby security auditors. If you enable this and need to send the value of the CSRF token with an AJAX\nrequest, your JavaScript must pull the value from a hidden CSRF token\nform input instead of from the cookie . See SESSION_COOKIE_HTTPONLY for details on HttpOnly . CSRF_COOKIE_NAME ¶ Default: 'csrftoken' The name of the cookie to use for the CSRF authentication token. This can be\nwhatever you want (as long as it’s different from the other cookie names in\nyour application). See Cross Site Request Forgery protection . CSRF_COOKIE_PATH ¶ Default: '/' The path set on the CSRF cookie. This should either match the URL path of your\nDjango installation or be a parent of that path. This is useful if you have multiple Django instances running under the same\nhostname. They can use different cookie paths, and each instance will only see\nits own CSRF cookie. CSRF_COOKIE_SAMESITE ¶ Default: 'Lax' The value of the SameSite flag on the CSRF cookie. This flag prevents the\ncookie from being sent in cross-site requests. See SESSION_COOKIE_SAMESITE for details about SameSite . CSRF_COOKIE_SECURE ¶ Default: False Whether to use a secure cookie for the CSRF cookie. If this is set to True ,\nthe cookie will be marked as “secure”, which means browsers may ensure that the\ncookie is only sent with an HTTPS connection. CSRF_USE_SESSIONS ¶ Default: False Whether to store the CSRF token in the user’s session instead of in a cookie.\nIt requires the use of django.contrib.sessions . Storing the CSRF token in a cookie (Django’s default) is safe, but storing it\nin the session is common practice in other web frameworks and therefore\nsometimes demanded by security auditors. Since the default error views require the CSRF token, SessionMiddleware must appear in MIDDLEWARE before any middleware that may raise an exception to\ntrigger an error view (such as PermissionDenied )\nif you’re using CSRF_USE_SESSIONS . See Middleware ordering . CSRF_FAILURE_VIEW ¶ Default: 'django.views.csrf.csrf_failure' A dotted path to the view function to be used when an incoming request is\nrejected by the CSRF protection . The function should have\nthis signature: def csrf_failure ( request , reason = \"\" ): ... where reason is a short message (intended for developers or logging, not\nfor end users) indicating the reason the request was rejected. It should return\nan HttpResponseForbidden . django.views.csrf.csrf_failure() accepts an additional template_name parameter that defaults to '403_csrf.html' . If a template with that name\nexists, it will be used to render the page. CSRF_HEADER_NAME ¶ Default: 'HTTP_X_CSRFTOKEN' The name of the request header used for CSRF authentication. As with other HTTP headers in request.META , the header name received from\nthe server is normalized by converting all characters to uppercase, replacing\nany hyphens with underscores, and adding an 'HTTP_' prefix to the name.\nFor example, if your client sends a 'X-XSRF-TOKEN' header, the setting\nshould be 'HTTP_X_XSRF_TOKEN' . CSRF_TRUSTED_ORIGINS ¶ Default: [] (Empty list) A list of trusted origins for unsafe requests (e.g. POST ). For requests that include the Origin header, Django’s CSRF protection\nrequires that header match the origin present in the Host header. For a secure unsafe\nrequest that doesn’t include the Origin header, the request must have a Referer header that matches the origin present in the Host header. These checks prevent, for example, a POST request from subdomain.example.com from succeeding against api.example.com . If you\nneed cross-origin unsafe requests, continuing the example, add 'https://subdomain.example.com' to this list (and/or http://... if\nrequests originate from an insecure page). The setting also supports subdomains, so you could add 'https://*.example.com' , for example, to allow access from all subdomains\nof example.com . DATABASES ¶ Default: {} (Empty dictionary) A dictionary containing the settings for all databases to be used with\nDjango. It is a nested dictionary whose contents map a database alias\nto a dictionary containing the options for an individual database. The DATABASES setting must configure a default database;\nany number of additional databases may also be specified. The simplest possible settings file is for a single-database setup using\nSQLite. This can be configured using the following: DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.sqlite3\" , \"NAME\" : \"mydatabase\" , } } When connecting to other database backends, such as MariaDB, MySQL, Oracle, or\nPostgreSQL, additional connection parameters will be required. See\nthe ENGINE setting below on how to specify\nother database types. This example is for PostgreSQL: DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.postgresql\" , \"NAME\" : \"mydatabase\" , \"USER\" : \"mydatabaseuser\" , \"PASSWORD\" : \"mypassword\" , \"HOST\" : \"127.0.0.1\" , \"PORT\" : \"5432\" , } } The following inner options that may be required for more complex\nconfigurations are available: ATOMIC_REQUESTS ¶ Default: False Set this to True to wrap each view in a transaction on this database. See Tying transactions to HTTP requests . AUTOCOMMIT ¶ Default: True Set this to False if you want to disable Django’s transaction\nmanagement and implement your own. ENGINE ¶ Default: '' (Empty string) The database backend to use. The built-in database backends are: 'django.db.backends.postgresql' 'django.db.backends.mysql' 'django.db.backends.sqlite3' 'django.db.backends.oracle' You can use a database backend that doesn’t ship with Django by setting ENGINE to a fully-qualified path (i.e. mypackage.backends.whatever ). HOST ¶ Default: '' (Empty string) Which host to use when connecting to the database. An empty string means\nlocalhost. Not used with SQLite. If this value starts with a forward slash ( '/' ) and you’re using MySQL,\nMySQL will connect via a Unix socket to the specified socket. For example: \"HOST\" : \"/var/run/mysql\" If you’re using MySQL and this value doesn’t start with a forward slash, then\nthis value is assumed to be the host. If you’re using PostgreSQL, by default (empty HOST ), the connection\nto the database is done through UNIX domain sockets (‘local’ lines in pg_hba.conf ). If your UNIX domain socket is not in the standard location,\nuse the same value of unix_socket_directory from postgresql.conf .\nIf you want to connect through TCP sockets, set HOST to ‘localhost’\nor ‘127.0.0.1’ (‘host’ lines in pg_hba.conf ).\nOn Windows, you should always define HOST , as UNIX domain sockets\nare not available. NAME ¶ Default: '' (Empty string) The name of the database to use. For SQLite, it’s the full path to the database\nfile. When specifying the path, always use forward slashes, even on Windows\n(e.g. C:/homes/user/mysite/sqlite3.db ). CONN_MAX_AGE ¶ Default: 0 The lifetime of a database connection, as an integer of seconds. Use 0 to\nclose database connections at the end of each request — Django’s historical\nbehavior — and None for unlimited persistent database connections . CONN_HEALTH_CHECKS ¶ Default: False If set to True , existing persistent database connections will be health checked before they are\nreused in each request performing database access. If the health check fails,\nthe connection will be reestablished without failing the request when the\nconnection is no longer usable but the database server is ready to accept and\nserve new connections (e.g. after database server restart closing existing\nconnections). OPTIONS ¶ Default: {} (Empty dictionary) Extra parameters to use when connecting to the database. Available parameters\nvary depending on your database backend. Some information on available parameters can be found in the Database Backends documentation. For more information,\nconsult your backend module’s own documentation. PASSWORD ¶ Default: '' (Empty string) The password to use when connecting to the database. Not used with SQLite. PORT ¶ Default: '' (Empty string) The port to use when connecting to the database. An empty string means the\ndefault port. Not used with SQLite. TIME_ZONE ¶ Default: None A string representing the time zone for this database connection or None .\nThis inner option of the DATABASES setting accepts the same values\nas the general TIME_ZONE setting. When USE_TZ is True , reading datetimes from the database\nreturns aware datetimes with the timezone set to this option’s value if not None , or to UTC otherwise. When USE_TZ is False , it is an error to set this option. If the database backend doesn’t support time zones (e.g. SQLite, MySQL,\nOracle), Django reads and writes datetimes in local time according to this\noption if it is set and in UTC if it isn’t. Changing the connection time zone changes how datetimes are read from and\nwritten to the database. If Django manages the database and you don’t have a strong reason to do\notherwise, you should leave this option unset. It’s best to store datetimes\nin UTC because it avoids ambiguous or nonexistent datetimes during daylight\nsaving time changes. Also, receiving datetimes in UTC keeps datetime\narithmetic simple — there’s no need to consider potential offset changes\nover a DST transition. If you’re connecting to a third-party database that stores datetimes in a\nlocal time rather than UTC, then you must set this option to the\nappropriate time zone. Likewise, if Django manages the database but\nthird-party systems connect to the same database and expect to find\ndatetimes in local time, then you must set this option. If the database backend supports time zones (e.g., PostgreSQL), then the\ndatabase connection’s time zone is set to this value. Although setting the TIME_ZONE option is very rarely needed, there are\nsituations where it becomes necessary. Specifically, it’s recommended to\nmatch the general TIME_ZONE setting when dealing with raw queries\ninvolving date/time functions like PostgreSQL’s date_trunc() or generate_series() , especially when generating time-based series that\ntransition daylight savings. This value can be changed at any time, the database will handle the\nconversion of datetimes to the configured time zone. However, this has a downside: receiving all datetimes in local time makes\ndatetime arithmetic more tricky — you must account for possible offset\nchanges over DST transitions. Consider converting to local time explicitly with AT TIME ZONE in raw SQL\nqueries instead of setting the TIME_ZONE option. DISABLE_SERVER_SIDE_CURSORS ¶ Default: False Set this to True if you want to disable the use of server-side cursors with QuerySet.iterator() . Transaction pooling and server-side cursors describes the use case. This is a PostgreSQL-specific setting. USER ¶ Default: '' (Empty string) The username to use when connecting to the database. Not used with SQLite. TEST ¶ Default: {} (Empty dictionary) A dictionary of settings for test databases; for more details about the\ncreation and use of test databases, see The test database . Here’s an example with a test database configuration: DATABASES = { \"default\" : { \"ENGINE\" : \"django.db.backends.postgresql\" , \"USER\" : \"mydatabaseuser\" , \"NAME\" : \"mydatabase\" , \"TEST\" : { \"NAME\" : \"mytestdatabase\" , }, }, } The following keys in the TEST dictionary are available: CHARSET ¶ Default: None The character set encoding used to create the test database. The value of this\nstring is passed directly through to the database, so its format is\nbackend-specific. Supported by the PostgreSQL ( postgresql ) and MySQL ( mysql ) backends. COLLATION ¶ Default: None The collation order to use when creating the test database. This value is\npassed directly to the backend, so its format is backend-specific. Only supported for the mysql backend (see the MySQL manual for details). DEPENDENCIES ¶ Default: ['default'] , for all databases other than default ,\nwhich has no dependencies. The creation-order dependencies of the database. See the documentation\non controlling the creation order of test databases for details. MIGRATE ¶ Default: True When set to False , migrations won’t run when creating the test database.\nThis is similar to setting None as a value in MIGRATION_MODULES ,\nbut for all apps. MIRROR ¶ Default: None The alias of the database that this database should mirror during\ntesting. It depends on transactions and therefore must be used within TransactionTestCase instead of TestCase . This setting exists to allow for testing of primary/replica\n(referred to as master/slave by some databases)\nconfigurations of multiple databases. See the documentation on testing primary/replica configurations for details. NAME ¶ Default: None The name of database to use when running the test suite. If the default value ( None ) is used with the SQLite database engine, the\ntests will use a memory resident database. For all other database engines the\ntest database will use the name 'test_' + DATABASE_NAME . See The test database . TEMPLATE ¶ This is a PostgreSQL-specific setting. The name of a template (e.g. 'template0' ) from which to create the test\ndatabase. CREATE_DB ¶ Default: True This is an Oracle-specific setting. If it is set to False , the test tablespaces won’t be automatically created\nat the beginning of the tests or dropped at the end. CREATE_USER ¶ Default: True This is an Oracle-specific setting. If it is set to False , the test user won’t be automatically created at the\nbeginning of the tests and dropped at the end. USER ¶ Default: None This is an Oracle-specific setting. The username to use when connecting to the Oracle database that will be used\nwhen running tests. If not provided, Django will use 'test_' + USER . PASSWORD ¶ Default: None This is an Oracle-specific setting. The password to use when connecting to the Oracle database that will be used\nwhen running tests. If not provided, Django will generate a random password. ORACLE_MANAGED_FILES ¶ Default: False This is an Oracle-specific setting. If set to True , Oracle Managed Files (OMF) tablespaces will be used. DATAFILE and DATAFILE_TMP will be ignored. TBLSPACE ¶ Default: None This is an Oracle-specific setting. The name of the tablespace that will be used when running tests. If not\nprovided, Django will use 'test_' + USER . TBLSPACE_TMP ¶ Default: None This is an Oracle-specific setting. The name of the temporary tablespace that will be used when running tests. If\nnot provided, Django will use 'test_' + USER + '_temp' . DATAFILE ¶ Default: None This is an Oracle-specific setting. The name of the datafile to use for the TBLSPACE. If not provided, Django will\nuse TBLSPACE + '.dbf' . DATAFILE_TMP ¶ Default: None This is an Oracle-specific setting. The name of the datafile to use for the TBLSPACE_TMP. If not provided, Django\nwill use TBLSPACE_TMP + '.dbf' . DATAFILE_MAXSIZE ¶ Default: '500M' This is an Oracle-specific setting. The maximum size that the DATAFILE is allowed to grow to. DATAFILE_TMP_MAXSIZE ¶ Default: '500M' This is an Oracle-specific setting. The maximum size that the DATAFILE_TMP is allowed to grow to. DATAFILE_SIZE ¶ Default: '50M' This is an Oracle-specific setting. The initial size of the DATAFILE. DATAFILE_TMP_SIZE ¶ Default: '50M' This is an Oracle-specific setting. The initial size of the DATAFILE_TMP. DATAFILE_EXTSIZE ¶ Default: '25M' This is an Oracle-specific setting. The amount by which the DATAFILE is extended when more space is required. DATAFILE_TMP_EXTSIZE ¶ Default: '25M' This is an Oracle-specific setting. The amount by which the DATAFILE_TMP is extended when more space is required. DATA_UPLOAD_MAX_MEMORY_SIZE ¶ Default: 2621440 (i.e. 2.5 MB). The maximum size in bytes that a request body may be before a SuspiciousOperation ( RequestDataTooBig ) is\nraised. The check is done when accessing request.body or request.POST and is calculated against the total request size excluding any file upload\ndata. You can set this to None to disable the check. Applications that are\nexpected to receive unusually large form posts should tune this setting. The amount of request data is correlated to the amount of memory needed to\nprocess the request and populate the GET and POST dictionaries. Large requests\ncould be used as a denial-of-service attack vector if left unchecked. Since web\nservers don’t typically perform deep request inspection, it’s not possible to\nperform a similar check at that level. See also FILE_UPLOAD_MAX_MEMORY_SIZE . DATA_UPLOAD_MAX_NUMBER_FIELDS ¶ Default: 1000 The maximum number of parameters that may be received via GET or POST before a SuspiciousOperation ( TooManyFields ) is\nraised. You can set this to None to disable the check. Applications that\nare expected to receive an unusually large number of form fields should tune\nthis setting. The number of request parameters is correlated to the amount of time needed to\nprocess the request and populate the GET and POST dictionaries. Large requests\ncould be used as a denial-of-service attack vector if left unchecked. Since web\nservers don’t typically perform deep request inspection, it’s not possible to\nperform a similar check at that level. DATA_UPLOAD_MAX_NUMBER_FILES ¶ Default: 100 The maximum number of files that may be received via POST in a multipart/form-data encoded request before a SuspiciousOperation ( TooManyFiles ) is\nraised. You can set this to None to disable the check. Applications that\nare expected to receive an unusually large number of file fields should tune\nthis setting. The number of accepted files is correlated to the amount of time and memory\nneeded to process the request. Large requests could be used as a\ndenial-of-service attack vector if left unchecked. Since web servers don’t\ntypically perform deep request inspection, it’s not possible to perform a\nsimilar check at that level. DATABASE_ROUTERS ¶ Default: [] (Empty list) The list of routers that will be used to determine which database\nto use when performing a database query. See the documentation on automatic database routing in multi\ndatabase configurations . DATE_FORMAT ¶ Default: 'N j, Y' (e.g. Feb. 4, 2003 ) The default formatting to use for displaying date fields in any part of the\nsystem. Note that the locale-dictated format has higher precedence and will be\napplied instead. See allowed date format strings . See also DATETIME_FORMAT , TIME_FORMAT and SHORT_DATE_FORMAT . DATE_INPUT_FORMATS ¶ Default: [ \"%Y-%m- %d \" , # '2006-10-25' \"%m/ %d /%Y\" , # '10/25/2006' \"%m/ %d /%y\" , # '10/25/06' \"%b %d %Y\" , # 'Oct 25 2006' \"%b %d , %Y\" , # 'Oct 25, 2006' \" %d %b %Y\" , # '25 Oct 2006' \" %d %b, %Y\" , # '25 Oct, 2006' \"%B %d %Y\" , # 'October 25 2006' \"%B %d , %Y\" , # 'October 25, 2006' \" %d %B %Y\" , # '25 October 2006' \" %d %B, %Y\" , # '25 October, 2006' ] A list of formats that will be accepted when inputting data on a date field.\nFormats will be tried in order, using the first valid one. Note that these\nformat strings use Python’s datetime module syntax , not the format strings from the date template filter. The locale-dictated format has higher precedence and will be applied instead. See also DATETIME_INPUT_FORMATS and TIME_INPUT_FORMATS . DATETIME_FORMAT ¶ Default: 'N j, Y, P' (e.g. Feb. 4, 2003, 4 p.m. ) The default formatting to use for displaying datetime fields in any part of the\nsystem. Note that the locale-dictated format has higher precedence and will be\napplied instead. See allowed date format strings . See also DATE_FORMAT , TIME_FORMAT and SHORT_DATETIME_FORMAT . DATETIME_INPUT_FORMATS ¶ Default: [ \"%Y-%m- %d %H:%M:%S\" , # '2006-10-25 14:30:59' \"%Y-%m- %d %H:%M:%S. %f \" , # '2006-10-25 14:30:59.000200' \"%Y-%m- %d %H:%M\" , # '2006-10-25 14:30' \"%m/ %d /%Y %H:%M:%S\" , # '10/25/2006 14:30:59' \"%m/ %d /%Y %H:%M:%S. %f \" , # '10/25/2006 14:30:59.000200' \"%m/ %d /%Y %H:%M\" , # '10/25/2006 14:30' \"%m/ %d /%y %H:%M:%S\" , # '10/25/06 14:30:59' \"%m/ %d /%y %H:%M:%S. %f \" , # '10/25/06 14:30:59.000200' \"%m/ %d /%y %H:%M\" , # '10/25/06 14:30' ] A list of formats that will be accepted when inputting data on a datetime\nfield. Formats will be tried in order, using the first valid one. Note that\nthese format strings use Python’s datetime module syntax , not the format strings from the date template filter. Date-only formats are not included as datetime fields will\nautomatically try DATE_INPUT_FORMATS in last resort. The locale-dictated format has higher precedence and will be applied instead. See also DATE_INPUT_FORMATS and TIME_INPUT_FORMATS . DEBUG ¶ Default: False A boolean that turns on/off debug mode. Never deploy a site into production with DEBUG turned on. One of the main features of debug mode is the display of detailed error pages.\nIf your app raises an exception when DEBUG is True , Django will\ndisplay a detailed traceback, including a lot of metadata about your\nenvironment, such as all the currently defined Django settings (from settings.py ). As a security measure, Django will not include settings that might be\nsensitive, such as SECRET_KEY . Specifically, it will exclude any\nsetting whose name includes any of the following: 'API' 'KEY' 'PASS' 'SECRET' 'SIGNATURE' 'TOKEN' Note that these are partial matches. 'PASS' will also match PASSWORD,\njust as 'TOKEN' will also match TOKENIZED and so on. Still, note that there are always going to be sections of your debug output\nthat are inappropriate for public consumption. File paths, configuration\noptions and the like all give attackers extra information about your server. It is also important to remember that when running with DEBUG turned on, Django will remember every SQL query it executes. This is useful\nwhen you’re debugging, but it’ll rapidly consume memory on a production server. Finally, if DEBUG is False , you also need to properly set\nthe ALLOWED_HOSTS setting. Failing to do so will result in all\nrequests being returned as “Bad Request (400)”. Note The default settings.py file created by django-admin startproject sets DEBUG = True for convenience. DEBUG_PROPAGATE_EXCEPTIONS ¶ Default: False If set to True , Django’s exception handling of view functions\n( handler500 , or the debug view if DEBUG is True ) and logging of 500 responses ( django.request ) is\nskipped and exceptions propagate upward. This can be useful for some test setups. It shouldn’t be used on a live site\nunless you want your web server (instead of Django) to generate “Internal\nServer Error” responses. In that case, make sure your server doesn’t show the\nstack trace or other sensitive information in the response. DECIMAL_SEPARATOR ¶ Default: '.' (Dot) Default decimal separator used when formatting decimal numbers. Note that the locale-dictated format has higher precedence and will be applied\ninstead. See also NUMBER_GROUPING , THOUSAND_SEPARATOR and USE_THOUSAND_SEPARATOR . DEFAULT_AUTO_FIELD ¶ Default: ' django.db.models.AutoField ' Default primary key field type to use for models that don’t have a field with primary_key=True . Migrating auto-created through tables The value of DEFAULT_AUTO_FIELD will be respected when creating new\nauto-created through tables for many-to-many relationships. Unfortunately, the primary keys of existing auto-created through tables\ncannot currently be updated by the migrations framework. This means that if you switch the value of DEFAULT_AUTO_FIELD and then\ngenerate migrations, the primary keys of the related models will be\nupdated, as will the foreign keys from the through table, but the primary\nkey of the auto-created through table will not be migrated. In order to address this, you should add a RunSQL operation to your\nmigrations to perform the required ALTER TABLE step. You can check the\nexisting table name through sqlmigrate , dbshell , or with the\nfield’s remote_field.through._meta.db_table property. Explicitly defined through models are already handled by the migrations\nsystem. Allowing automatic migrations for the primary key of existing auto-created\nthrough tables may be implemented at a later date . DEFAULT_CHARSET ¶ Default: 'utf-8' Default charset to use for all HttpResponse objects, if a MIME type isn’t\nmanually specified. Used when constructing the Content-Type header. DEFAULT_EXCEPTION_REPORTER ¶ Default: ' django.views.debug.ExceptionReporter ' Default exception reporter class to be used if none has been assigned to the HttpRequest instance yet. See Custom error reports . DEFAULT_EXCEPTION_REPORTER_FILTER ¶ Default: ' django.views.debug.SafeExceptionReporterFilter ' Default exception reporter filter class to be used if none has been assigned to\nthe HttpRequest instance yet.\nSee Filtering error reports . DEFAULT_FROM_EMAIL ¶ Default: 'webmaster@localhost' Default email address for automated correspondence from the site manager(s).\nThis address is used in the From: header of outgoing emails and can take\nany format valid in the chosen email sending protocol. This doesn’t affect error messages sent to ADMINS and MANAGERS . See SERVER_EMAIL for that. DEFAULT_INDEX_TABLESPACE ¶ Default: '' (Empty string) Default tablespace to use for indexes on fields that don’t specify\none, if the backend supports it (see Tablespaces ). DEFAULT_TABLESPACE ¶ Default: '' (Empty string) Default tablespace to use for models that don’t specify one, if the\nbackend supports it (see Tablespaces ). DISALLOWED_USER_AGENTS ¶ Default: [] (Empty list) List of compiled regular expression objects representing User-Agent strings\nthat are not allowed to visit any page, systemwide. Use this for bots/crawlers.\nThis is only used if CommonMiddleware is installed (see Middleware ). EMAIL_BACKEND ¶ Default: ' django.core.mail.backends.smtp.EmailBackend ' The backend to use for sending emails. For the list of available backends see Email backends . EMAIL_FILE_PATH ¶ Default: Not defined The directory used by the file email backend to store output files. EMAIL_HOST ¶ Default: 'localhost' The host to use for sending email. See also EMAIL_PORT . EMAIL_HOST_PASSWORD ¶ Default: '' (Empty string) Password to use for the SMTP server defined in EMAIL_HOST . This\nsetting is used in conjunction with EMAIL_HOST_USER when\nauthenticating to the SMTP server. If either of these settings is empty,\nDjango won’t attempt authentication. See also EMAIL_HOST_USER . EMAIL_HOST_USER ¶ Default: '' (Empty string) Username to use for the SMTP server defined in EMAIL_HOST .\nIf empty, Django won’t attempt authentication. See also EMAIL_HOST_PASSWORD . EMAIL_PORT ¶ Default: 25 Port to use for the SMTP server defined in EMAIL_HOST . EMAIL_SUBJECT_PREFIX ¶ Default: '[Django] ' Subject-line prefix for email messages sent with django.core.mail.mail_admins or django.core.mail.mail_managers . You’ll probably want to include the\ntrailing space. EMAIL_USE_LOCALTIME ¶ Default: False Whether to send the SMTP Date header of email messages in the local time\nzone ( True ) or in UTC ( False ). EMAIL_USE_TLS ¶ Default: False Whether to use a TLS (secure) connection when talking to the SMTP server.\nThis is used for explicit TLS connections, generally on port 587. If you are\nexperiencing hanging connections, see the implicit TLS setting EMAIL_USE_SSL . EMAIL_USE_SSL ¶ Default: False Whether to use an implicit TLS (secure) connection when talking to the SMTP\nserver. In most email documentation this type of TLS connection is referred\nto as SSL. It is generally used on port 465. If you are experiencing problems,\nsee the explicit TLS setting EMAIL_USE_TLS . Note that EMAIL_USE_TLS / EMAIL_USE_SSL are mutually\nexclusive, so only set one of those settings to True . EMAIL_SSL_CERTFILE ¶ Default: None If EMAIL_USE_SSL or EMAIL_USE_TLS is True , you can\noptionally specify the path to a PEM-formatted certificate chain file to use\nfor the SSL connection. EMAIL_SSL_KEYFILE ¶ Default: None If EMAIL_USE_SSL or EMAIL_USE_TLS is True , you can\noptionally specify the path to a PEM-formatted private key file to use for the\nSSL connection. Note that setting EMAIL_SSL_CERTFILE and EMAIL_SSL_KEYFILE doesn’t result in any certificate checking. They’re passed to the underlying SSL\nconnection. Please refer to the documentation of Python’s ssl.SSLContext.wrap_socket() function for details on how the\ncertificate chain file and private key file are handled. EMAIL_TIMEOUT ¶ Default: None Specifies a timeout in seconds for blocking operations like the connection\nattempt. FILE_UPLOAD_HANDLERS ¶ Default: [ \"django.core.files.uploadhandler.MemoryFileUploadHandler\" , \"django.core.files.uploadhandler.TemporaryFileUploadHandler\" , ] A list of handlers to use for uploading. Changing this setting allows complete\ncustomization – even replacement – of Django’s upload process. See Managing files for details. FILE_UPLOAD_MAX_MEMORY_SIZE ¶ Default: 2621440 (i.e. 2.5 MB). The maximum size (in bytes) that an upload will be before it gets streamed to\nthe file system. See Managing files for details. See also DATA_UPLOAD_MAX_MEMORY_SIZE . FILE_UPLOAD_DIRECTORY_PERMISSIONS ¶ Default: None The numeric mode to apply to directories created in the process of uploading\nfiles. This setting also determines the default permissions for collected static\ndirectories when using the collectstatic management command. See collectstatic for details on overriding it. This value mirrors the functionality and caveats of the FILE_UPLOAD_PERMISSIONS setting. FILE_UPLOAD_PERMISSIONS ¶ Default: 0o644 The numeric mode (i.e. 0o644 ) to set newly uploaded files to. For\nmore information about what these modes mean, see the documentation for os.chmod() . If None , you’ll get operating-system dependent behavior. On most platforms,\ntemporary files will have a mode of 0o600 , and files saved from memory will\nbe saved using the system’s standard umask. For security reasons, these permissions aren’t applied to the temporary files\nthat are stored in FILE_UPLOAD_TEMP_DIR . This setting also determines the default permissions for collected static files\nwhen using the collectstatic management command. See collectstatic for details on overriding it. Warning Always prefix the mode with 0o . If you’re not familiar with file modes, please note that the 0o prefix\nis very important: it indicates an octal number, which is the way that\nmodes must be specified. If you try to use 644 , you’ll get totally\nincorrect behavior. FILE_UPLOAD_TEMP_DIR ¶ Default: None The directory to store data to (typically files larger than FILE_UPLOAD_MAX_MEMORY_SIZE ) temporarily while uploading files.\nIf None , Django will use the standard temporary directory for the operating\nsystem. For example, this will default to /tmp on *nix-style operating\nsystems. See Managing files for details. FIRST_DAY_OF_WEEK ¶ Default: 0 (Sunday) A number representing the first day of the week. This is especially useful\nwhen displaying a calendar. This value is only used when not using\nformat internationalization, or when a format cannot be found for the\ncurrent locale. The value must be an integer from 0 to 6, where 0 means Sunday, 1 means\nMonday and so on. FIXTURE_DIRS ¶ Default: [] (Empty list) List of directories searched for fixture files,\nin addition to the fixtures directory of each application, in search order. Note that these paths should use Unix-style forward slashes, even on Windows. See Provide data with fixtures and Fixture loading . FORCE_SCRIPT_NAME ¶ Default: None If not None , this will be used as the value of the SCRIPT_NAME environment variable in any HTTP request. This setting can be used to override\nthe server-provided value of SCRIPT_NAME , which may be a rewritten version\nof the preferred value or not supplied at all. It is also used by django.setup() to set the URL resolver script prefix outside of the\nrequest/response cycle (e.g. in management commands and standalone scripts) to\ngenerate correct URLs when FORCE_SCRIPT_NAME is provided. FORM_RENDERER ¶ Default: ' django.forms.renderers.DjangoTemplates ' The class that renders forms and form widgets. It must implement the low-level render API . Included form\nrenderers are: ' django.forms.renderers.DjangoTemplates ' ' django.forms.renderers.Jinja2 ' ' django.forms.renderers.TemplatesSetting ' FORMS_URLFIELD_ASSUME_HTTPS ¶ New in Django 5.0. Deprecated since version 5.0. Default: False Set this transitional setting to True to opt into using \"https\" as the\nnew default value of URLField.assume_scheme during the Django 5.x release cycle. FORMAT_MODULE_PATH ¶ Default: None A full Python path to a Python package that contains custom format definitions\nfor project locales. If not None , Django will check for a formats.py file, under the directory named as the current locale, and will use the\nformats defined in this file. The name of the directory containing the format definitions is expected to be\nnamed using locale name notation, for example de , pt_BR , en_US , etc. For example, if FORMAT_MODULE_PATH is set to mysite.formats ,\nand current language is en (English), Django will expect a directory tree\nlike: mysite/\n    formats/\n        __init__.py\n        en/\n            __init__.py\n            formats.py You can also set this setting to a list of Python paths, for example: FORMAT_MODULE_PATH = [ \"mysite.formats\" , \"some_app.formats\" , ] When Django searches for a certain format, it will go through all given Python\npaths until it finds a module that actually defines the given format. This\nmeans that formats defined in packages farther up in the list will take\nprecedence over the same formats in packages farther down. Available formats are: DATE_FORMAT DATE_INPUT_FORMATS DATETIME_FORMAT , DATETIME_INPUT_FORMATS DECIMAL_SEPARATOR FIRST_DAY_OF_WEEK MONTH_DAY_FORMAT NUMBER_GROUPING SHORT_DATE_FORMAT SHORT_DATETIME_FORMAT THOUSAND_SEPARATOR TIME_FORMAT TIME_INPUT_FORMATS YEAR_MONTH_FORMAT IGNORABLE_404_URLS ¶ Default: [] (Empty list) List of compiled regular expression objects describing URLs that should be\nignored when reporting HTTP 404 errors via email (see How to manage error reporting ). Regular expressions are matched against request's full paths (including\nquery string, if any). Use this if your site does not provide a commonly\nrequested file such as favicon.ico or robots.txt . This is only used if BrokenLinkEmailsMiddleware is enabled (see Middleware ). INSTALLED_APPS ¶ Default: [] (Empty list) A list of strings designating all applications that are enabled in this\nDjango installation. Each string should be a dotted Python path to: an application configuration class (preferred), or a package containing an application. Learn more about application configurations . Use the application registry for introspection Your code should never access INSTALLED_APPS directly. Use django.apps.apps instead. Application names and labels must be unique in INSTALLED_APPS Application names — the dotted Python\npath to the application package — must be unique. There is no way to\ninclude the same application twice, short of duplicating its code under\nanother name. Application labels — by default the\nfinal part of the name — must be unique too. For example, you can’t\ninclude both django.contrib.auth and myproject.auth . However, you\ncan relabel an application with a custom configuration that defines a\ndifferent label . These rules apply regardless of whether INSTALLED_APPS references application configuration classes or application packages. When several applications provide different versions of the same resource\n(template, static file, management command, translation), the application\nlisted first in INSTALLED_APPS has precedence. INTERNAL_IPS ¶ Default: [] (Empty list) A list of IP addresses, as strings, that: Allow the debug() context processor\nto add some variables to the template context. Can use the admindocs bookmarklets even if\nnot logged in as a staff user. Are marked as “internal” (as opposed to “EXTERNAL”) in AdminEmailHandler emails. LANGUAGE_CODE ¶ Default: 'en-us' A string representing the language code for this installation. This should be in\nstandard language ID format . For example, U.S. English\nis \"en-us\" . See also the list of language identifiers and Internationalization and localization . It serves three purposes: If the locale middleware isn’t in use, it decides which translation is served\nto all users. If the locale middleware is active, it provides a fallback language in case the\nuser’s preferred language can’t be determined or is not supported by the\nwebsite. It also provides the fallback translation when a translation for a\ngiven literal doesn’t exist for the user’s preferred language. If localization is explicitly disabled via the unlocalize filter\nor the {% localize off %} tag, it provides fallback\nlocalization formats which will be applied instead. See controlling localization in templates for\ndetails. See How Django discovers language preference for more details. LANGUAGE_COOKIE_AGE ¶ Default: None (expires at browser close) The age of the language cookie, in seconds. LANGUAGE_COOKIE_DOMAIN ¶ Default: None The domain to use for the language cookie. Set this to a string such as \"example.com\" for cross-domain cookies, or use None for a standard\ndomain cookie. Be cautious when updating this setting on a production site. If you update\nthis setting to enable cross-domain cookies on a site that previously used\nstandard domain cookies, existing user cookies that have the old domain\nwill not be updated. This will result in site users being unable to switch\nthe language as long as these cookies persist. The only safe and reliable\noption to perform the switch is to change the language cookie name\npermanently (via the LANGUAGE_COOKIE_NAME setting) and to add\na middleware that copies the value from the old cookie to a new one and then\ndeletes the old one. LANGUAGE_COOKIE_HTTPONLY ¶ Default: False Whether to use HttpOnly flag on the language cookie. If this is set to True , client-side JavaScript will not be able to access the language\ncookie. See SESSION_COOKIE_HTTPONLY for details on HttpOnly . LANGUAGE_COOKIE_NAME ¶ Default: 'django_language' The name of the cookie to use for the language cookie. This can be whatever\nyou want (as long as it’s different from the other cookie names in your\napplication). See Internationalization and localization . LANGUAGE_COOKIE_PATH ¶ Default: '/' The path set on the language cookie. This should either match the URL path of your\nDjango installation or be a parent of that path. This is useful if you have multiple Django instances running under the same\nhostname. They can use different cookie paths and each instance will only see\nits own language cookie. Be cautious when updating this setting on a production site. If you update this\nsetting to use a deeper path than it previously used, existing user cookies that\nhave the old path will not be updated. This will result in site users being\nunable to switch the language as long as these cookies persist. The only safe\nand reliable option to perform the switch is to change the language cookie name\npermanently (via the LANGUAGE_COOKIE_NAME setting), and to add\na middleware that copies the value from the old cookie to a new one and then\ndeletes the one. LANGUAGE_COOKIE_SAMESITE ¶ Default: None The value of the SameSite flag on the language cookie. This flag prevents the\ncookie from being sent in cross-site requests. See SESSION_COOKIE_SAMESITE for details about SameSite . LANGUAGE_COOKIE_SECURE ¶ Default: False Whether to use a secure cookie for the language cookie. If this is set to True , the cookie will be marked as “secure”, which means browsers may\nensure that the cookie is only sent under an HTTPS connection. LANGUAGES ¶ Default: A list of all available languages. This list is continually growing\nand including a copy here would inevitably become rapidly out of date. You can\nsee the current list of translated languages by looking in django/conf/global_settings.py . The list is a list of 2-tuples in the format\n( language code , language name ) – for example, ('ja', 'Japanese') .\nThis specifies which languages are available for language selection. See Internationalization and localization . Generally, the default value should suffice. Only set this setting if you want\nto restrict language selection to a subset of the Django-provided languages. If you define a custom LANGUAGES setting, you can mark the\nlanguage names as translation strings using the gettext_lazy() function. Here’s a sample settings file: from django.utils.translation import gettext_lazy as _ LANGUAGES = [ ( \"de\" , _ ( \"German\" )), ( \"en\" , _ ( \"English\" )), ] LANGUAGES_BIDI ¶ Default: A list of all language codes that are written right-to-left. You can\nsee the current list of these languages by looking in django/conf/global_settings.py . The list contains language codes for languages that are\nwritten right-to-left. Generally, the default value should suffice. Only set this setting if you want\nto restrict language selection to a subset of the Django-provided languages.\nIf you define a custom LANGUAGES setting, the list of bidirectional\nlanguages may contain language codes which are not enabled on a given site. LOCALE_PATHS ¶ Default: [] (Empty list) A list of directories where Django looks for translation files.\nSee How Django discovers translations . Example: LOCALE_PATHS = [ \"/home/www/project/common_files/locale\" , \"/var/local/translations/locale\" , ] Django will look within each of these paths for the <locale_code>/LC_MESSAGES directories containing the actual translation files. LOGGING ¶ Default: A logging configuration dictionary. A data structure containing configuration information. When not-empty, the\ncontents of this data structure will be passed as the argument to the\nconfiguration method described in LOGGING_CONFIG . Among other things, the default logging configuration passes HTTP 500 server\nerrors to an email log handler when DEBUG is False . See also Configuring logging . You can see the default logging configuration by looking in django/utils/log.py . LOGGING_CONFIG ¶ Default: 'logging.config.dictConfig' A path to a callable that will be used to configure logging in the\nDjango project. Points at an instance of Python’s dictConfig configuration method by default. If you set LOGGING_CONFIG to None , the logging\nconfiguration process will be skipped. MANAGERS ¶ Default: [] (Empty list) A list in the same format as ADMINS that specifies who should get\nbroken link notifications when BrokenLinkEmailsMiddleware is enabled. MEDIA_ROOT ¶ Default: '' (Empty string) Absolute filesystem path to the directory that will hold user-uploaded\nfiles . Example: \"/var/www/example.com/media/\" See also MEDIA_URL . Warning MEDIA_ROOT and STATIC_ROOT must have different\nvalues. Before STATIC_ROOT was introduced, it was common to\nrely or fallback on MEDIA_ROOT to also serve static files;\nhowever, since this can have serious security implications, there is a\nvalidation check to prevent it. MEDIA_URL ¶ Default: '' (Empty string) URL that handles the media served from MEDIA_ROOT , used\nfor managing stored files . It must end in a slash if set\nto a non-empty value. You will need to configure these files to be served in both development and production\nenvironments. If you want to use {{ MEDIA_URL }} in your templates, add 'django.template.context_processors.media' in the 'context_processors' option of TEMPLATES . Example: \"https://media.example.com/\" Warning There are security risks if you are accepting uploaded content from\nuntrusted users! See the security guide’s topic on User-uploaded content for mitigation details. Warning MEDIA_URL and STATIC_URL must have different\nvalues. See MEDIA_ROOT for more details. Note If MEDIA_URL is a relative path, then it will be prefixed by the\nserver-provided value of SCRIPT_NAME (or / if not set). This makes\nit easier to serve a Django application in a subpath without adding an\nextra configuration to the settings. MIDDLEWARE ¶ Default: None A list of middleware to use. See Middleware . MIGRATION_MODULES ¶ Default: {} (Empty dictionary) A dictionary specifying the package where migration modules can be found on a\nper-app basis. The default value of this setting is an empty dictionary, but\nthe default package name for migration modules is migrations . Example: { \"blog\" : \"blog.db_migrations\" } In this case, migrations pertaining to the blog app will be contained in\nthe blog.db_migrations package. If you provide the app_label argument, makemigrations will\nautomatically create the package if it doesn’t already exist. When you supply None as a value for an app, Django will consider the app as\nan app without migrations regardless of an existing migrations submodule.\nThis can be used, for example, in a test settings file to skip migrations while\ntesting (tables will still be created for the apps’ models). To disable\nmigrations for all apps during tests, you can set the MIGRATE to False instead. If MIGRATION_MODULES is used in your general project settings, remember to use\nthe migrate --run-syncdb option if you want to create tables for the\napp. MONTH_DAY_FORMAT ¶ Default: 'F j' The default formatting to use for date fields on Django admin change-list\npages – and, possibly, by other parts of the system – in cases when only the\nmonth and day are displayed. For example, when a Django admin change-list page is being filtered by a date\ndrilldown, the header for a given day displays the day and month. Different\nlocales have different formats. For example, U.S. English would say\n“January 1,” whereas Spanish might say “1 Enero.” Note that the corresponding locale-dictated format has higher precedence and\nwill be applied instead. See allowed date format strings . See also DATE_FORMAT , DATETIME_FORMAT , TIME_FORMAT and YEAR_MONTH_FORMAT . NUMBER_GROUPING ¶ Default: 0 Number of digits grouped together on the integer part of a number. Common use is to display a thousand separator. If this setting is 0 , then\nno grouping will be applied to the number. If this setting is greater than 0 , then THOUSAND_SEPARATOR will be used as the separator between\nthose groups. Some locales use non-uniform digit grouping, e.g. 10,00,00,000 in en_IN . For this case, you can provide a sequence with the number of digit\ngroup sizes to be applied. The first number defines the size of the group\npreceding the decimal delimiter, and each number that follows defines the size\nof preceding groups. If the sequence is terminated with -1 , no further\ngrouping is performed. If the sequence terminates with a 0 , the last group\nsize is used for the remainder of the number. Example tuple for en_IN : NUMBER_GROUPING = ( 3 , 2 , 0 ) Note that the locale-dictated format has higher precedence and will be applied\ninstead. See also DECIMAL_SEPARATOR , THOUSAND_SEPARATOR and USE_THOUSAND_SEPARATOR . PREPEND_WWW ¶ Default: False Whether to prepend the “www.” subdomain to URLs that don’t have it. This is only\nused if CommonMiddleware is installed\n(see Middleware ). See also APPEND_SLASH . ROOT_URLCONF ¶ Default: Not defined A string representing the full Python import path to your root URLconf, for\nexample \"mydjangoapps.urls\" . Can be overridden on a per-request basis by\nsetting the attribute urlconf on the incoming HttpRequest object. See How Django processes a request for details. SECRET_KEY ¶ Default: '' (Empty string) A secret key for a particular Django installation. This is used to provide cryptographic signing , and should be set to a unique,\nunpredictable value. django-admin startproject automatically adds a\nrandomly-generated SECRET_KEY to each new project. Uses of the key shouldn’t assume that it’s text or bytes. Every use should go\nthrough force_str() or force_bytes() to convert it to the desired type. Django will refuse to start if SECRET_KEY is not set. Warning Keep this value secret. Running Django with a known SECRET_KEY defeats many of Django’s\nsecurity protections, and can lead to privilege escalation and remote code\nexecution vulnerabilities. The secret key is used for: All sessions if you are using\nany other session backend than django.contrib.sessions.backends.cache ,\nor are using the default get_session_auth_hash() . All messages if you are using CookieStorage or FallbackStorage . All PasswordResetView tokens. Any usage of cryptographic signing , unless a\ndifferent key is provided. When a secret key is no longer set as SECRET_KEY or contained within SECRET_KEY_FALLBACKS all of the above will be invalidated. When\nrotating your secret key, you should move the old key to SECRET_KEY_FALLBACKS temporarily. Secret keys are not used for\npasswords of users and key rotation will not affect them. Note The default settings.py file created by django-admin startproject creates a unique SECRET_KEY for\nconvenience. SECRET_KEY_FALLBACKS ¶ Default: [] A list of fallback secret keys for a particular Django installation. These are\nused to allow rotation of the SECRET_KEY . In order to rotate your secret keys, set a new SECRET_KEY and move the\nprevious value to the beginning of SECRET_KEY_FALLBACKS . Then remove the\nold values from the end of the SECRET_KEY_FALLBACKS when you are ready to\nexpire the sessions, password reset tokens, and so on, that make use of them. Note Signing operations are computationally expensive. Having multiple old key\nvalues in SECRET_KEY_FALLBACKS adds additional overhead to all checks\nthat don’t match an earlier key. As such, fallback values should be removed after an appropriate period,\nallowing for key rotation. Uses of the secret key values shouldn’t assume that they are text or bytes.\nEvery use should go through force_str() or force_bytes() to convert it to the desired type. SECURE_CONTENT_TYPE_NOSNIFF ¶ Default: True If True , the SecurityMiddleware sets the X-Content-Type-Options: nosniff header on all responses that do not\nalready have it. SECURE_CROSS_ORIGIN_OPENER_POLICY ¶ Default: 'same-origin' Unless set to None , the SecurityMiddleware sets the Cross-Origin Opener Policy header on all responses that do not already\nhave it to the value provided. SECURE_HSTS_INCLUDE_SUBDOMAINS ¶ Default: False If True , the SecurityMiddleware adds\nthe includeSubDomains directive to the HTTP Strict Transport Security header. It has no effect unless SECURE_HSTS_SECONDS is set to a\nnon-zero value. Warning Setting this incorrectly can irreversibly (for the value of SECURE_HSTS_SECONDS ) break your site. Read the HTTP Strict Transport Security documentation first. SECURE_HSTS_PRELOAD ¶ Default: False If True , the SecurityMiddleware adds\nthe preload directive to the HTTP Strict Transport Security header. It has no effect unless SECURE_HSTS_SECONDS is set to a\nnon-zero value. SECURE_HSTS_SECONDS ¶ Default: 0 If set to a non-zero integer value, the SecurityMiddleware sets the HTTP Strict Transport Security header on all responses that do not\nalready have it. Warning Setting this incorrectly can irreversibly (for some time) break your site.\nRead the HTTP Strict Transport Security documentation first. SECURE_PROXY_SSL_HEADER ¶ Default: None A tuple representing an HTTP header/value combination that signifies a request\nis secure. This controls the behavior of the request object’s is_secure() method. By default, is_secure() determines if a request is secure by confirming\nthat a requested URL uses https:// . This method is important for Django’s\nCSRF protection, and it may be used by your own code or third-party apps. If your Django app is behind a proxy, though, the proxy may be “swallowing”\nwhether the original request uses HTTPS or not. If there is a non-HTTPS\nconnection between the proxy and Django then is_secure() would always\nreturn False – even for requests that were made via HTTPS by the end user.\nIn contrast, if there is an HTTPS connection between the proxy and Django then is_secure() would always return True – even for requests that were\nmade originally via HTTP. In this situation, configure your proxy to set a custom HTTP header that tells\nDjango whether the request came in via HTTPS, and set SECURE_PROXY_SSL_HEADER so that Django knows what header to look for. Set a tuple with two elements – the name of the header to look for and the\nrequired value. For example: SECURE_PROXY_SSL_HEADER = ( \"HTTP_X_FORWARDED_PROTO\" , \"https\" ) This tells Django to trust the X-Forwarded-Proto header that comes from our\nproxy and that the request is guaranteed to be secure (i.e., it originally came\nin via HTTPS) when: the header value is 'https' , or its initial, leftmost value is 'https' in the case of a comma-separated\nlist of protocols (e.g. 'https,http,http' ). You should only set this setting if you control your proxy or have some other\nguarantee that it sets/strips this header appropriately. Note that the header needs to be in the format as used by request.META –\nall caps and likely starting with HTTP_ . (Remember, Django automatically\nadds 'HTTP_' to the start of x-header names before making the header\navailable in request.META .) Warning Modifying this setting can compromise your site’s security. Ensure you\nfully understand your setup before changing it. Make sure ALL of the following are true before setting this (assuming the\nvalues from the example above): Your Django app is behind a proxy. Your proxy strips the X-Forwarded-Proto header from all incoming\nrequests, even when it contains a comma-separated list of protocols. In\nother words, if end users include that header in their requests, the\nproxy will discard it. Your proxy sets the X-Forwarded-Proto header and sends it to Django,\nbut only for requests that originally come in via HTTPS. If any of those are not true, you should keep this setting set to None and find another way of determining HTTPS, perhaps via custom middleware. SECURE_REDIRECT_EXEMPT ¶ Default: [] (Empty list) If a URL path matches a regular expression in this list, the request will not be\nredirected to HTTPS. The SecurityMiddleware strips leading slashes\nfrom URL paths, so patterns shouldn’t include them, e.g. SECURE_REDIRECT_EXEMPT = [r'^no-ssl/$', …] . If SECURE_SSL_REDIRECT is False , this setting has no effect. SECURE_REFERRER_POLICY ¶ Default: 'same-origin' If configured, the SecurityMiddleware sets\nthe Referrer Policy header on all responses that do not already have it\nto the value provided. SECURE_SSL_HOST ¶ Default: None If a string (e.g. secure.example.com ), all SSL redirects will be directed\nto this host rather than the originally-requested host\n(e.g. www.example.com ). If SECURE_SSL_REDIRECT is False , this\nsetting has no effect. SECURE_SSL_REDIRECT ¶ Default: False If True , the SecurityMiddleware redirects all non-HTTPS requests to HTTPS (except for\nthose URLs matching a regular expression listed in SECURE_REDIRECT_EXEMPT ). Note If turning this to True causes infinite redirects, it probably means\nyour site is running behind a proxy and can’t tell which requests are secure\nand which are not. Your proxy likely sets a header to indicate secure\nrequests; you can correct the problem by finding out what that header is and\nconfiguring the SECURE_PROXY_SSL_HEADER setting accordingly. SERIALIZATION_MODULES ¶ Default: Not defined A dictionary of modules containing serializer definitions (provided as\nstrings), keyed by a string identifier for that serialization type. For\nexample, to define a YAML serializer, use: SERIALIZATION_MODULES = { \"yaml\" : \"path.to.yaml_serializer\" } SERVER_EMAIL ¶ Default: 'root@localhost' The email address that error messages come from, such as those sent to ADMINS and MANAGERS . This address is used in the From: header and can take any format valid in the chosen email sending\nprotocol. Why are my emails sent from a different address? This address is used only for error messages. It is not the address that\nregular email messages sent with send_mail() come from; for that, see DEFAULT_FROM_EMAIL . SHORT_DATE_FORMAT ¶ Default: 'm/d/Y' (e.g. 12/31/2003 ) An available formatting that can be used for displaying date fields on\ntemplates. Note that the corresponding locale-dictated format has higher\nprecedence and will be applied instead. See allowed date format strings . See also DATE_FORMAT and SHORT_DATETIME_FORMAT . SHORT_DATETIME_FORMAT ¶ Default: 'm/d/Y P' (e.g. 12/31/2003 4 p.m. ) An available formatting that can be used for displaying datetime fields on\ntemplates. Note that the corresponding locale-dictated format has higher\nprecedence and will be applied instead. See allowed date format strings . See also DATE_FORMAT and SHORT_DATE_FORMAT . SIGNING_BACKEND ¶ Default: 'django.core.signing.TimestampSigner' The backend used for signing cookies and other data. See also the Cryptographic signing documentation. SILENCED_SYSTEM_CHECKS ¶ Default: [] (Empty list) A list of identifiers of messages generated by the system check framework\n(i.e. [\"models.W001\"] ) that you wish to permanently acknowledge and ignore.\nSilenced checks will not be output to the console. See also the System check framework documentation. STORAGES ¶ Default: { \"default\" : { \"BACKEND\" : \"django.core.files.storage.FileSystemStorage\" , }, \"staticfiles\" : { \"BACKEND\" : \"django.contrib.staticfiles.storage.StaticFilesStorage\" , }, } A dictionary containing the settings for all storages to be used with Django.\nIt is a nested dictionary whose contents map a storage alias to a dictionary\ncontaining the options for an individual storage. Storages can have any alias you choose. However, there are two aliases with\nspecial significance: default for managing files . ' django.core.files.storage.FileSystemStorage ' is the\ndefault storage engine. staticfiles for managing static files . ' django.contrib.staticfiles.storage.StaticFilesStorage ' is\nthe default storage engine. The following is an example settings.py snippet defining a custom file\nstorage called example : STORAGES = { # ... \"example\" : { \"BACKEND\" : \"django.core.files.storage.FileSystemStorage\" , \"OPTIONS\" : { \"location\" : \"/example\" , \"base_url\" : \"/example/\" , }, }, } OPTIONS are passed to the BACKEND on initialization in **kwargs . A ready-to-use instance of the storage backends can be retrieved from django.core.files.storage.storages . Use a key corresponding to the\nbackend definition in STORAGES . Is my value merged with the default value? Defining this setting overrides the default value and is not merged with\nit. TEMPLATES ¶ Default: [] (Empty list) A list containing the settings for all template engines to be used with\nDjango. Each item of the list is a dictionary containing the options for an\nindividual engine. Here’s a setup that tells the Django template engine to load templates from the templates subdirectory inside each installed application: TEMPLATES = [ { \"BACKEND\" : \"django.template.backends.django.DjangoTemplates\" , \"APP_DIRS\" : True , }, ] The following options are available for all backends. BACKEND ¶ Default: Not defined The template backend to use. The built-in template backends are: 'django.template.backends.django.DjangoTemplates' 'django.template.backends.jinja2.Jinja2' You can use a template backend that doesn’t ship with Django by setting BACKEND to a fully-qualified path (i.e. 'mypackage.whatever.Backend' ). NAME ¶ Default: see below The alias for this particular template engine. It’s an identifier that allows\nselecting an engine for rendering. Aliases must be unique across all\nconfigured template engines. It defaults to the name of the module defining the engine class, i.e. the\nnext to last piece of BACKEND , when it isn’t\nprovided. For example if the backend is 'mypackage.whatever.Backend' then\nits default name is 'whatever' . DIRS ¶ Default: [] (Empty list) Directories where the engine should look for template source files, in search\norder. APP_DIRS ¶ Default: False Whether the engine should look for template source files inside installed\napplications. Note The default settings.py file created by django-admin startproject sets 'APP_DIRS': True . OPTIONS ¶ Default: {} (Empty dict) Extra parameters to pass to the template backend. Available parameters vary\ndepending on the template backend. See DjangoTemplates and Jinja2 for the options of the\nbuilt-in backends. TEST_RUNNER ¶ Default: 'django.test.runner.DiscoverRunner' The name of the class to use for starting the test suite. See Using different testing frameworks . TEST_NON_SERIALIZED_APPS ¶ Default: [] (Empty list) In order to restore the database state between tests for TransactionTestCase s and database backends without transactions, Django\nwill serialize the contents of all apps when it starts the test run so it can then reload from that copy before running\ntests that need it. This slows down the startup time of the test runner; if you have apps that\nyou know don’t need this feature, you can add their full names in here (e.g. 'django.contrib.contenttypes' ) to exclude them from this serialization\nprocess. THOUSAND_SEPARATOR ¶ Default: ',' (Comma) Default thousand separator used when formatting numbers. This setting is\nused only when USE_THOUSAND_SEPARATOR is True and NUMBER_GROUPING is greater than 0 . Note that the locale-dictated format has higher precedence and will be applied\ninstead. See also NUMBER_GROUPING , DECIMAL_SEPARATOR and USE_THOUSAND_SEPARATOR . TIME_FORMAT ¶ Default: 'P' (e.g. 4 p.m. ) The default formatting to use for displaying time fields in any part of the\nsystem. Note that the locale-dictated format has higher precedence and will be\napplied instead. See allowed date format strings . See also DATE_FORMAT and DATETIME_FORMAT . TIME_INPUT_FORMATS ¶ Default: [ \"%H:%M:%S\" , # '14:30:59' \"%H:%M:%S. %f \" , # '14:30:59.000200' \"%H:%M\" , # '14:30' ] A list of formats that will be accepted when inputting data on a time field.\nFormats will be tried in order, using the first valid one. Note that these\nformat strings use Python’s datetime module syntax , not the format strings from the date template filter. The locale-dictated format has higher precedence and will be applied instead. See also DATE_INPUT_FORMATS and DATETIME_INPUT_FORMATS . TIME_ZONE ¶ Default: 'America/Chicago' A string representing the time zone for this installation. See the list of\ntime zones . Note Since Django was first released with the TIME_ZONE set to 'America/Chicago' , the global setting (used if nothing is defined in\nyour project’s settings.py ) remains 'America/Chicago' for backwards\ncompatibility. New project templates default to 'UTC' . Note that this isn’t necessarily the time zone of the server. For example, one\nserver may serve multiple Django-powered sites, each with a separate time zone\nsetting. When USE_TZ is False , this is the time zone in which Django\nwill store all datetimes. When USE_TZ is True , this is the\ndefault time zone that Django will use to display datetimes in templates and\nto interpret datetimes entered in forms. On Unix environments (where time.tzset() is implemented), Django sets the os.environ['TZ'] variable to the time zone you specify in the TIME_ZONE setting. Thus, all your views and models will\nautomatically operate in this time zone. However, Django won’t set the TZ environment variable if you’re using the manual configuration option as\ndescribed in manually configuring settings . If Django doesn’t set the TZ environment variable, it’s up to you to ensure your processes are running in\nthe correct environment. Note Django cannot reliably use alternate time zones in a Windows environment.\nIf you’re running Django on Windows, TIME_ZONE must be set to\nmatch the system time zone. USE_I18N ¶ Default: True A boolean that specifies whether Django’s translation system should be enabled.\nThis provides a way to turn it off, for performance. If this is set to False , Django will make some optimizations so as not to load the\ntranslation machinery. See also LANGUAGE_CODE and USE_TZ . Note The default settings.py file created by django-admin startproject includes USE_I18N = True for convenience. USE_THOUSAND_SEPARATOR ¶ Default: False A boolean that specifies whether to display numbers using a thousand separator.\nWhen set to True , Django will format numbers using the NUMBER_GROUPING and THOUSAND_SEPARATOR settings. The\nlatter two settings may also be dictated by the locale, which takes precedence. See also DECIMAL_SEPARATOR , NUMBER_GROUPING and THOUSAND_SEPARATOR . USE_TZ ¶ Default: True A boolean that specifies if datetimes will be timezone-aware by default or not.\nIf this is set to True , Django will use timezone-aware datetimes internally. When USE_TZ is False, Django will use naive datetimes in local time, except\nwhen parsing ISO 8601 formatted strings, where timezone information will always\nbe retained if present. See also TIME_ZONE and USE_I18N . Changed in Django 5.0: In older versions, the default value is False . USE_X_FORWARDED_HOST ¶ Default: False A boolean that specifies whether to use the X-Forwarded-Host header in\npreference to the Host header. This should only be enabled if a proxy\nwhich sets this header is in use. This setting takes priority over USE_X_FORWARDED_PORT . Per RFC 7239 Section 5.3 , the X-Forwarded-Host header can include the port\nnumber, in which case you shouldn’t use USE_X_FORWARDED_PORT . USE_X_FORWARDED_PORT ¶ Default: False A boolean that specifies whether to use the X-Forwarded-Port header in\npreference to the SERVER_PORT META variable. This should only be\nenabled if a proxy which sets this header is in use. USE_X_FORWARDED_HOST takes priority over this setting. WSGI_APPLICATION ¶ Default: None The full Python path of the WSGI application object that Django’s built-in\nservers (e.g. runserver ) will use. The django-admin startproject management command will create a standard wsgi.py file with an application callable in it, and point this setting\nto that application . If not set, the return value of django.core.wsgi.get_wsgi_application() will be used. In this case, the behavior of runserver will be\nidentical to previous Django versions. YEAR_MONTH_FORMAT ¶ Default: 'F Y' The default formatting to use for date fields on Django admin change-list\npages – and, possibly, by other parts of the system – in cases when only the\nyear and month are displayed. For example, when a Django admin change-list page is being filtered by a date\ndrilldown, the header for a given month displays the month and the year.\nDifferent locales have different formats. For example, U.S. English would say\n“January 2006,” whereas another locale might say “2006/January.” Note that the corresponding locale-dictated format has higher precedence and\nwill be applied instead. See allowed date format strings . See also DATE_FORMAT , DATETIME_FORMAT , TIME_FORMAT and MONTH_DAY_FORMAT . X_FRAME_OPTIONS ¶ Default: 'DENY' The default value for the X-Frame-Options header used by XFrameOptionsMiddleware . See the clickjacking protection documentation. Auth ¶ Settings for django.contrib.auth . AUTHENTICATION_BACKENDS ¶ Default: ['django.contrib.auth.backends.ModelBackend'] A list of authentication backend classes (as strings) to use when attempting to\nauthenticate a user. See the authentication backends documentation for details. AUTH_USER_MODEL ¶ Default: 'auth.User' The model to use to represent a User. See Substituting a custom User model . Warning You cannot change the AUTH_USER_MODEL setting during the lifetime of\na project (i.e. once you have made and migrated models that depend on it)\nwithout serious effort. It is intended to be set at the project start,\nand the model it refers to must be available in the first migration of\nthe app that it lives in.\nSee Substituting a custom User model for more details. LOGIN_REDIRECT_URL ¶ Default: '/accounts/profile/' The URL or named URL pattern where requests are\nredirected after login when the LoginView doesn’t get a next GET parameter. LOGIN_URL ¶ Default: '/accounts/login/' The URL or named URL pattern where requests are\nredirected for login when using the login_required() decorator, LoginRequiredMixin , AccessMixin , or when LoginRequiredMiddleware is installed. LOGOUT_REDIRECT_URL ¶ Default: None The URL or named URL pattern where requests are\nredirected after logout if LogoutView doesn’t have a next_page attribute. If None , no redirect will be performed and the logout view will be\nrendered. PASSWORD_RESET_TIMEOUT ¶ Default: 259200 (3 days, in seconds) The number of seconds a password reset link is valid for. Used by the PasswordResetConfirmView . Note Reducing the value of this timeout doesn’t make any difference to the\nability of an attacker to brute-force a password reset token. Tokens are\ndesigned to be safe from brute-forcing without any timeout. This timeout exists to protect against some unlikely attack scenarios, such\nas someone gaining access to email archives that may contain old, unused\npassword reset tokens. PASSWORD_HASHERS ¶ See How Django stores passwords . Default: [ \"django.contrib.auth.hashers.PBKDF2PasswordHasher\" , \"django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher\" , \"django.contrib.auth.hashers.Argon2PasswordHasher\" , \"django.contrib.auth.hashers.BCryptSHA256PasswordHasher\" , \"django.contrib.auth.hashers.ScryptPasswordHasher\" , ] AUTH_PASSWORD_VALIDATORS ¶ Default: [] (Empty list) The list of validators that are used to check the strength of user’s passwords.\nSee Password validation for more details. By default, no validation is\nperformed and all passwords are accepted. Messages ¶ Settings for django.contrib.messages . MESSAGE_LEVEL ¶ Default: messages.INFO Sets the minimum message level that will be recorded by the messages\nframework. See message levels for more details. Avoiding circular imports If you override MESSAGE_LEVEL in your settings file and rely on any of\nthe built-in constants, you must import the constants module directly to\navoid the potential for circular imports, e.g.: from django.contrib.messages import constants as message_constants MESSAGE_LEVEL = message_constants . DEBUG If desired, you may specify the numeric values for the constants directly\naccording to the values in the above constants table . MESSAGE_STORAGE ¶ Default: 'django.contrib.messages.storage.fallback.FallbackStorage' Controls where Django stores message data. Valid values are: 'django.contrib.messages.storage.fallback.FallbackStorage' 'django.contrib.messages.storage.session.SessionStorage' 'django.contrib.messages.storage.cookie.CookieStorage' See message storage backends for more details. The backends that use cookies – CookieStorage and FallbackStorage –\nuse the value of SESSION_COOKIE_DOMAIN , SESSION_COOKIE_SECURE and SESSION_COOKIE_HTTPONLY when setting their cookies. MESSAGE_TAGS ¶ Default: { messages . DEBUG : \"debug\" , messages . INFO : \"info\" , messages . SUCCESS : \"success\" , messages . WARNING : \"warning\" , messages . ERROR : \"error\" , } This sets the mapping of message level to message tag, which is typically\nrendered as a CSS class in HTML. If you specify a value, it will extend\nthe default. This means you only have to specify those values which you need\nto override. See Displaying messages above for more details. Avoiding circular imports If you override MESSAGE_TAGS in your settings file and rely on any of\nthe built-in constants, you must import the constants module directly to\navoid the potential for circular imports, e.g.: from django.contrib.messages import constants as message_constants MESSAGE_TAGS = { message_constants . INFO : \"\" } If desired, you may specify the numeric values for the constants directly\naccording to the values in the above constants table . Sessions ¶ Settings for django.contrib.sessions . SESSION_CACHE_ALIAS ¶ Default: 'default' If you’re using cache-based session storage ,\nthis selects the cache to use. SESSION_COOKIE_AGE ¶ Default: 1209600 (2 weeks, in seconds) The age of session cookies, in seconds. SESSION_COOKIE_DOMAIN ¶ Default: None The domain to use for session cookies. Set this to a string such as \"example.com\" for cross-domain cookies, or use None for a standard\ndomain cookie. To use cross-domain cookies with CSRF_USE_SESSIONS , you must include\na leading dot (e.g. \".example.com\" ) to accommodate the CSRF middleware’s\nreferer checking. Be cautious when updating this setting on a production site. If you update\nthis setting to enable cross-domain cookies on a site that previously used\nstandard domain cookies, existing user cookies will be set to the old\ndomain. This may result in them being unable to log in as long as these cookies\npersist. This setting also affects cookies set by django.contrib.messages . SESSION_COOKIE_HTTPONLY ¶ Default: True Whether to use HttpOnly flag on the session cookie. If this is set to True , client-side JavaScript will not be able to access the session\ncookie. HttpOnly is a flag included in a Set-Cookie HTTP response header. It’s part of\nthe RFC 6265 Section 4.1.2.6 standard for cookies and can be a useful way to\nmitigate the risk of a client-side script accessing the protected cookie data. This makes it less trivial for an attacker to escalate a cross-site scripting\nvulnerability into full hijacking of a user’s session. There aren’t many good\nreasons for turning this off. Your code shouldn’t read session cookies from\nJavaScript. SESSION_COOKIE_NAME ¶ Default: 'sessionid' The name of the cookie to use for sessions. This can be whatever you want\n(as long as it’s different from the other cookie names in your application). SESSION_COOKIE_PATH ¶ Default: '/' The path set on the session cookie. This should either match the URL path of your\nDjango installation or be parent of that path. This is useful if you have multiple Django instances running under the same\nhostname. They can use different cookie paths, and each instance will only see\nits own session cookie. SESSION_COOKIE_SAMESITE ¶ Default: 'Lax' The value of the SameSite flag on the session cookie. This flag prevents the\ncookie from being sent in cross-site requests thus preventing CSRF attacks and\nmaking some methods of stealing session cookie impossible. Possible values for the setting are: 'Strict' : prevents the cookie from being sent by the browser to the\ntarget site in all cross-site browsing context, even when following a regular\nlink. For example, for a GitHub-like website this would mean that if a logged-in\nuser follows a link to a private GitHub project posted on a corporate\ndiscussion forum or email, GitHub will not receive the session cookie and the\nuser won’t be able to access the project. A bank website, however, most\nlikely doesn’t want to allow any transactional pages to be linked from\nexternal sites so the 'Strict' flag would be appropriate. 'Lax' (default): provides a balance between security and usability for\nwebsites that want to maintain user’s logged-in session after the user\narrives from an external link. In the GitHub scenario, the session cookie would be allowed when following a\nregular link from an external website and be blocked in CSRF-prone request\nmethods (e.g. POST ). 'None' (string): the session cookie will be sent with all same-site and\ncross-site requests. False : disables the flag. Note Modern browsers provide a more secure default policy for the SameSite flag and will assume Lax for cookies without an explicit value set. SESSION_COOKIE_SECURE ¶ Default: False Whether to use a secure cookie for the session cookie. If this is set to True , the cookie will be marked as “secure”, which means browsers may\nensure that the cookie is only sent under an HTTPS connection. Leaving this setting off isn’t a good idea because an attacker could capture an\nunencrypted session cookie with a packet sniffer and use the cookie to hijack\nthe user’s session. SESSION_ENGINE ¶ Default: 'django.contrib.sessions.backends.db' Controls where Django stores session data. Included engines are: 'django.contrib.sessions.backends.db' 'django.contrib.sessions.backends.file' 'django.contrib.sessions.backends.cache' 'django.contrib.sessions.backends.cached_db' 'django.contrib.sessions.backends.signed_cookies' See Configuring the session engine for more details. SESSION_EXPIRE_AT_BROWSER_CLOSE ¶ Default: False Whether to expire the session when the user closes their browser. See Browser-length sessions vs. persistent sessions . SESSION_FILE_PATH ¶ Default: None If you’re using file-based session storage, this sets the directory in\nwhich Django will store session data. When the default value ( None ) is\nused, Django will use the standard temporary directory for the system. SESSION_SAVE_EVERY_REQUEST ¶ Default: False Whether to save the session data on every request. If this is False (default), then the session data will only be saved if it has been modified –\nthat is, if any of its dictionary values have been assigned or deleted. Empty\nsessions won’t be created, even if this setting is active. SESSION_SERIALIZER ¶ Default: 'django.contrib.sessions.serializers.JSONSerializer' Full import path of a serializer class to use for serializing session data.\nIncluded serializer is: 'django.contrib.sessions.serializers.JSONSerializer' See Session serialization for details. Sites ¶ Settings for django.contrib.sites . SITE_ID ¶ Default: Not defined The ID, as an integer, of the current site in the django_site database\ntable. This is used so that application data can hook into specific sites\nand a single database can manage content for multiple sites. Static Files ¶ Settings for django.contrib.staticfiles . STATIC_ROOT ¶ Default: None The absolute path to the directory where collectstatic will collect\nstatic files for deployment. Example: \"/var/www/example.com/static/\" If the staticfiles contrib app is enabled\n(as in the default project template), the collectstatic management\ncommand will collect static files into this directory. See the how-to on managing static files for more details about\nusage. Warning This should be an initially empty destination directory for collecting\nyour static files from their permanent locations into one directory for\nease of deployment; it is not a place to store your static files\npermanently. You should do that in directories that will be found by staticfiles ’s finders , which by default, are 'static/' app sub-directories and any directories you include in STATICFILES_DIRS ). STATIC_URL ¶ Default: None URL to use when referring to static files located in STATIC_ROOT . Example: \"static/\" or \"https://static.example.com/\" If not None , this will be used as the base path for asset definitions (the Media class) and the staticfiles app . It must end in a slash if set to a non-empty value. You may need to configure these files to be served in development and will definitely need to do so in production . Note If STATIC_URL is a relative path, then it will be prefixed by\nthe server-provided value of SCRIPT_NAME (or / if not set). This\nmakes it easier to serve a Django application in a subpath without adding\nan extra configuration to the settings. STATICFILES_DIRS ¶ Default: [] (Empty list) This setting defines the additional locations the staticfiles app will traverse\nif the FileSystemFinder finder is enabled, e.g. if you use the collectstatic or findstatic management command or use the\nstatic file serving view. This should be set to a list of strings that contain full paths to\nyour additional files directory(ies) e.g.: STATICFILES_DIRS = [ \"/home/special.polls.com/polls/static\" , \"/home/polls.com/polls/static\" , \"/opt/webfiles/common\" , ] Note that these paths should use Unix-style forward slashes, even on Windows\n(e.g. \"C:/Users/user/mysite/extra_static_content\" ). Prefixes (optional) ¶ In case you want to refer to files in one of the locations with an additional\nnamespace, you can optionally provide a prefix as (prefix, path) tuples, e.g.: STATICFILES_DIRS = [ # ... ( \"downloads\" , \"/opt/webfiles/stats\" ), ] For example, assuming you have STATIC_URL set to 'static/' , the collectstatic management command would collect the “stats” files\nin a 'downloads' subdirectory of STATIC_ROOT . This would allow you to refer to the local file '/opt/webfiles/stats/polls_20101022.tar.gz' with '/static/downloads/polls_20101022.tar.gz' in your templates, e.g.: < a href = \" {% static 'downloads/polls_20101022.tar.gz' %} \" > STATICFILES_FINDERS ¶ Default: [ \"django.contrib.staticfiles.finders.FileSystemFinder\" , \"django.contrib.staticfiles.finders.AppDirectoriesFinder\" , ] The list of finder backends that know how to find static files in\nvarious locations. The default will find files stored in the STATICFILES_DIRS setting\n(using django.contrib.staticfiles.finders.FileSystemFinder ) and in a static subdirectory of each app (using django.contrib.staticfiles.finders.AppDirectoriesFinder ). If multiple\nfiles with the same name are present, the first file that is found will be\nused. One finder is disabled by default: django.contrib.staticfiles.finders.DefaultStorageFinder . If added to\nyour STATICFILES_FINDERS setting, it will look for static files in\nthe default file storage as defined by the default key in the STORAGES setting. Note When using the AppDirectoriesFinder finder, make sure your apps\ncan be found by staticfiles by adding the app to the INSTALLED_APPS setting of your site. Static file finders are currently considered a private interface, and this\ninterface is thus undocumented. Core Settings Topical Index ¶ Cache ¶ CACHES CACHE_MIDDLEWARE_ALIAS CACHE_MIDDLEWARE_KEY_PREFIX CACHE_MIDDLEWARE_SECONDS Database ¶ DATABASES DATABASE_ROUTERS DEFAULT_INDEX_TABLESPACE DEFAULT_TABLESPACE Debugging ¶ DEBUG DEBUG_PROPAGATE_EXCEPTIONS Email ¶ ADMINS DEFAULT_CHARSET DEFAULT_FROM_EMAIL EMAIL_BACKEND EMAIL_FILE_PATH EMAIL_HOST EMAIL_HOST_PASSWORD EMAIL_HOST_USER EMAIL_PORT EMAIL_SSL_CERTFILE EMAIL_SSL_KEYFILE EMAIL_SUBJECT_PREFIX EMAIL_TIMEOUT EMAIL_USE_LOCALTIME EMAIL_USE_TLS MANAGERS SERVER_EMAIL Error reporting ¶ DEFAULT_EXCEPTION_REPORTER DEFAULT_EXCEPTION_REPORTER_FILTER IGNORABLE_404_URLS MANAGERS SILENCED_SYSTEM_CHECKS File uploads ¶ FILE_UPLOAD_HANDLERS FILE_UPLOAD_MAX_MEMORY_SIZE FILE_UPLOAD_PERMISSIONS FILE_UPLOAD_TEMP_DIR MEDIA_ROOT MEDIA_URL STORAGES Forms ¶ FORM_RENDERER FORMS_URLFIELD_ASSUME_HTTPS Globalization ( i18n / l10n ) ¶ Internationalization ( i18n ) ¶ FIRST_DAY_OF_WEEK FORMAT_MODULE_PATH LANGUAGE_COOKIE_AGE LANGUAGE_COOKIE_DOMAIN LANGUAGE_COOKIE_HTTPONLY LANGUAGE_COOKIE_NAME LANGUAGE_COOKIE_PATH LANGUAGE_COOKIE_SAMESITE LANGUAGE_COOKIE_SECURE LANGUAGES LANGUAGES_BIDI LOCALE_PATHS TIME_ZONE USE_I18N USE_TZ Localization ( l10n ) ¶ DATE_FORMAT DATE_INPUT_FORMATS DATETIME_FORMAT DATETIME_INPUT_FORMATS DECIMAL_SEPARATOR LANGUAGE_CODE MONTH_DAY_FORMAT NUMBER_GROUPING SHORT_DATE_FORMAT SHORT_DATETIME_FORMAT THOUSAND_SEPARATOR TIME_FORMAT TIME_INPUT_FORMATS USE_THOUSAND_SEPARATOR YEAR_MONTH_FORMAT HTTP ¶ DATA_UPLOAD_MAX_MEMORY_SIZE DATA_UPLOAD_MAX_NUMBER_FIELDS DATA_UPLOAD_MAX_NUMBER_FILES DEFAULT_CHARSET DISALLOWED_USER_AGENTS FORCE_SCRIPT_NAME INTERNAL_IPS MIDDLEWARE Security SECURE_CONTENT_TYPE_NOSNIFF SECURE_CROSS_ORIGIN_OPENER_POLICY SECURE_HSTS_INCLUDE_SUBDOMAINS SECURE_HSTS_PRELOAD SECURE_HSTS_SECONDS SECURE_PROXY_SSL_HEADER SECURE_REDIRECT_EXEMPT SECURE_REFERRER_POLICY SECURE_SSL_HOST SECURE_SSL_REDIRECT SIGNING_BACKEND USE_X_FORWARDED_HOST USE_X_FORWARDED_PORT WSGI_APPLICATION Logging ¶ LOGGING LOGGING_CONFIG Models ¶ ABSOLUTE_URL_OVERRIDES FIXTURE_DIRS INSTALLED_APPS Security ¶ Cross Site Request Forgery Protection CSRF_COOKIE_DOMAIN CSRF_COOKIE_NAME CSRF_COOKIE_PATH CSRF_COOKIE_SAMESITE CSRF_COOKIE_SECURE CSRF_FAILURE_VIEW CSRF_HEADER_NAME CSRF_TRUSTED_ORIGINS CSRF_USE_SESSIONS SECRET_KEY SECRET_KEY_FALLBACKS X_FRAME_OPTIONS Serialization ¶ DEFAULT_CHARSET SERIALIZATION_MODULES Templates ¶ TEMPLATES Testing ¶ Database: TEST TEST_NON_SERIALIZED_APPS TEST_RUNNER URLs ¶ APPEND_SLASH PREPEND_WWW ROOT_URLCONF", "keywords": ["users", "django.core.files.storage", "language_cookie_domain", "django.contrib.sessions.backends.cached_db", "feature", "storage", "auditors", "underscores", "create_user", "pattern", "login", "10/25/06", "datafile_size", "selection", "messages", "b", "logoutview", "platforms", "default_charset", "renderers", "default_auto_field", "django.core.mail.backends.smtp", "django.contrib.auth.backends", "resident", "force_bytes", "field", "www.example.com", "#", "m", "time_format", "serialization", "runner", "above", "migrations", "metadata", "inspection", "django.core.cache.backends.db", "brokenlinkemailsmiddleware", "logging.config.dictconfig", "numbers", "setups", "brute", "dummycache", "emails", "host", "fqdn", "lambda", "filebasedcache", "lines", "django.db.models", "httpresponse", "django_cache", "calendar", "subset", "cache", "compatibility", "transport", "words", "template0", "csrf_cookie_httponly", "change", "https", "session_file_path", "ignorable_404_urls", "suite", "datafile_tmp_size", "django.core.wsgi.get_wsgi_application", "django.contrib.sessions.backends.db", "django.core.cache.backends.dummy", "label", "mb", "use_x_forwarded_host", "presence", "destination", "http", "secure_redirect_exempt", "=", "changes", "mirror", "sizes", "default_index_tablespace", "john@example.com", "get_absolute_url", "sqlmigrate", "engine", "message", "installation", "permissiondenied", "sockets", "https://static.example.com/", "href", "path.to.yaml_serializer", "character", "date_format", "prepend_www", "setup", "tables", "tag", "filesystem", "escalation", "jsonserializer", "zones", "sets", "savings", "hole", "process", "separator", "fallback", "debug", "httpresponseforbidden", "session_cookie_domain", "topic", "log.py", "nosniff", "staff", "john", "charset", "django.db.backends.mysql", "data_upload_max_memory_size", "following", "type", "pg_hba.conf", "delimiter", "people", "custom", "subpath", "defines", "objects", "documentation", "kwargs", "usability", "weeks", "myproject.auth", "discoverrunner", "file", "y-%m-", "server_port", "implications", "customization", "guarantee", "email_timeout", "authenticating", "modules", "email_use_tls", "httprequest.get_host", "user", "date_trunc", "default_exception_reporter", "django.utils.translation", "os.chmod", "language_cookie_path", "cases", "machinery", "login_redirect_url", "nix", "attribute", "csrf_cookie_age", "resort", "warning", "developers", "size", "packages", "time", "login/", ".example.com", "basis", "expiration", "date", "render", "risk", "setting", "mydatabaseuser", "filesystemfinder", "purposes", "jar", "responses", "components", "memcache", "app_label", "restart", "crawlers", "language_cookie_name", "polls", "service", "h:%m:%s.", "file_upload_temp_dir", "things", "django.contrib.staticfiles.finders", "preference", "password", "csrf_cookie_secure", "name", "makemigrations", "parameter", "execution", "cache_middleware_key_prefix", "reporter", "backends", "get_host", "web", "django.contrib.auth", "january", "age", "monday", "problems", "versions", "key_function", "accessmixin", "daylight", "queries", "configurations", "dst", "corresponding", "github", "secure_ssl_redirect", "datafile_tmp", "common_files", "blog.db_migrations", "uses", "addresses", "piece", "return", "handlers", "applications", "static_url", "use_x_forwarded_port", "memory", "expressions", "transitions", "situation", "cursors", "use_tz", "environments", "parent", "rediscache", "search", "/home", "blog", "csrf_failure", "django.contrib.staticfiles", "/tmp", "commonmiddleware", "pylibmccache", "sessionmiddleware", "smtp", "sunday", "mary", "username", "aliases", "relationships", "dirs", "tree", "temp", "space", "proxy", "url", "error", "timeout", "module", "h:%m:%s", "code", "collectstatic", "subdomains", "locmemcache", "blogs.blog", "period", "httponly", "auth", "secret", "pages", "filter", "false", "behavior", "style", "access", "class", "display", "link", "migration", "grouping", "-1", "modes", "staticfiles_finders", "tcp", "group", "ssl", "app_dirs", "default_exception_reporter_filter", "returns", "names", "'", "javascript", "x", "snippet", "login_url", "attack", "session_cookie_samesite", "request", "formatting", "secure_hsts_include_subdomains", "database", "flag", "inserting", "django.core.cache.backends.locmem", "input", "output", "mysite.formats", "*", "suspiciousoperation", "page", "test", "query", "postgresql", "toomanyfiles", "commands", "english", "mypackage.backends.whatever", "migrate", "types", "logout", "strings", "locales", "cache_middleware_seconds", "elements", "extra_static_content", "wsgi_application", "admin", "creation", "scripts", "silenced_system_checks", ".", "usage", "registry", "transactiontestcase", "wsgi", "asset", "configuration", "auth_user_model", "p.m.", "step", "script", "effort", "downloads", "/opt", "conn_health_checks", "django.contrib.sites", "ease", "validation", "notifications", "django.core.mail.mail_admins", "limitations", "http_x_csrftoken", "decimal_separator", "section", "uploading", "language_cookie_age", "source", "datafile", "send_mail", "django.core.files.storage.storages", "django.setup", "discussion", "sequence", "spanish", "octal", "css", "csrf_cookie_name", "use", "django.forms.renderers", "dbshell", "replacement", "django.core.mail.mail_managers", "mytestdatabase", "environment", "topical", "email_use_ssl", "balance", "forms_urlfield_assume_https", "origin", "static_root", "adminemailhandler", "some_app.formats", "a", "http://", "cookiestorage", "engines", "imports", "performance", "protection", "time_input_formats", "leftmost", "secure_content_type_nosniff", "django.contrib.sessions.backends.signed_cookies", "file_upload_max_memory_size", "core", "bots", "/blogs/", "operation", "order", "j", "signature", "date_input_formats", "default", "https://media.example.com/", "attackers", "identifiers", "email_use_localtime", "alias", "short_datetime_format", "submodule", "form", "samesite", "django.core.cache.backends.redis", "prefix", "consumption", "option", "file_upload_directory_permissions", "format", "forum", "expression", "tests", "characters", "postgresql.conf", "classes", "comma", "csrf_trusted_origins", "cross", "django.contrib.sessions.backends.cache", "america", "day", "digit", "http_x_forwarded_proto", "correspondence", "downside", "csrf_cookie_samesite", "django.contrib.messages.storage.session", "browsers", "fixture", "timezone", "datafile_tmp_maxsize", "datafile_tmp_extsize", "convenience", "month_day_format", "data_upload_max_number_files", "f", "material", "attempt", "chain", "omf", "caveats", "https://", "combination", "generate_series", "template", "week", "header", "mysite", "csrf_use_sessions", "traceback", "locale_code>/lc_messages", "way", "session_expire_at_browser_close", "internet", "frameworks", "data_upload_max_number_fields", "tablespaces", "formats", "utf-8", "exceptionreporter", "checks", "tmp", "http_x_xsrf_token", "servers", "protections", "strict", "special.polls.com", "template_name", "origins", "optimizations", "index", "directory(ies", "remainder", "party", "notation", "integer", "session", "reports", "¶", "bytes", "command", "django.template.backends.jinja2.jinja2", "id", "internationalization", "django.db.backends.postgresql", "sub", "post", "/var", "parameters", "disk", "october", "format_module_path", "admindocs", "enero", "property", "side", "en_in", "queryset.iterator", "content", "primary", "function", "mypackage.whatever", "manager(s", "protocol", "views", "testing", "view", "polls_20101022.tar.gz", "websites", "django.contrib.sessions", "zone", "run", "simple", "potential", "indexes", "agent", "number", "lot", "fixture_dirs", "managed", "measure", "right", "permissions", "def", "tz", "datetimes", "secure_hsts_seconds", "c:/users", "values", "staticfiles", "secret_key_fallbacks", "manual", "django.db.backends.oracle", "directories", "privilege", "/example/", "string", "session_cookie_age", "preload", "bank", "_", "health", "windows", "base_url", "introspection", "unix", "mapping", "token", "is_secure", "auto", "databases", "connections", "jinja2", "mime", "managers", "staticfiles_dirs", "resolver", "django.core.files.uploadhandler", "subdomain", "location", "table", "from", "subject", "m/", "language", "models", "language_cookie_httponly", "copy", "sqlite3.db", "referrer", "scripting", "csrf_cookie_path", "version", "scenario", "level", "yaml", "umask", "prefixes", "contents", "loading", "appdirectoriesfinder", "auth_password_validators", "hyphens", "processor", "handler500", "hostname", "labels", "tablespace", "namespace", "transition", "u.s.", "django", "series", "session_cookie_httponly", "csrf_header_name", "django.template.context_processors.media", "vulnerability", "rfc", "n’t", "securitymiddleware", "secure.example.com", "fields", "modelbackend", "django.contrib.messages", "ip", "info", "entry", "en/", "global_settings.py", "languages", "set", "development", "lowercase", "context_processors", "p", "csrf_failure_view", "operating", "mitigation", "practice", "value", "media", "get_session_auth_hash", "line", "mydjangoapps.urls", "codes", "chicago", "policy", "form_renderer", "data", "implementation", "browser", "wildcard", "tokenized", "item", "handler", "lifetime", "base", "backend", "guide", "switch", "append_slash", "runsql", "identifier", "globalization", "loginrequiredmiddleware", "disallowed_user_agents", "security", "file_upload_permissions", "includesubdomains", "paths", "need", "instance", "master", "create_db", "reporting", "localization", "djangotemplates", "initialization", "see", "primary_key", "handling", "timestampsigner", "levels", "constants", "interface", "alter", "toomanyfields", "validators", "database_routers", "console", "forgery", "trace", "functionality", "socket", "5.x", "start", "whatevercache", "decorator", "gettext_lazy", "digits", "/%y", "allowed_hosts", "iso", "structure", "language_cookie_samesite", "installed_apps", "part", "fixtures", "filesystemstorage", "references", "feb.", "object", "sslcontext.wrap_socket", "deployment", "domain", "request.body", "groups", "us", "absolute_url_overrides", "httprequest", "dot", "slashes", "forcing", "message_constants", "response", "management", "unix_socket_directory", "precedence", "email_host_user", "www", "website", "risks", "dictionary", "sql", "syncdb", "django.contrib.auth.hashers", "requests", "points", "django.contrib.messages.storage.cookie", "reset", "locale", "tokens", "situations", "contrast", "s", "csrf", "file_upload_handlers", "conversion", "opener", "csrf_cookie_domain", "matches", "rules", "variables", "https://*.example.com", "force", "root", "redirect", "cache_middleware_alias", "attacker", "controls", "debugging", "databasecache", "effect", "conn_max_age", "internal", "system", "apps", "address", "port", "403_csrf.html", "tls", "0o", "django.contrib.staticfiles.storage", "django.contrib.contenttypes", "password_reset_timeout", "pem", "overhead", "default_tablespace", "conf", "dependencies", "filtering", "signing", "archives", "production", "external", "widgets", "news.story", "routers", "storages", "serializer", "definition", "session_cookie_path", "headers", "c:/homes", "caps", "autofield", "slash", "tblspace_tmp", "processes", "check", "difference", "django.contrib.messages.storage.fallback", "target", "features", "site", "forms", "absolute", "protocols", "webfiles", "ssl/$", "l10n", "referer", "explorer", "denial", "example", "addition", "app", "month", "i18n", "locations", "hijacking", "sniffer", "list", "sample", "collation", "pub_year", "locale_paths", "seconds", "oct", "time.tzset", "utc", "finders", "runserver", "secure_proxy_ssl_header", "session_save_every_request", "utils", "passwordresetconfirmview", "displays", "xsrf", "language_cookie_secure", "strength", "email", "stack", "vector", "make_key", "model", "variable", "use_thousand_separator", "year", "sections", "reasons", "force_str", "idea", "callable", "systems", "place", "emailbackend", "application", "encoding", "datafile_extsize", "login_required", "key_prefix", "media_url", "loginrequiredmixin", "testcase", "lax", "insecure", "release", "short_date_format", "ability", "redirects", "localhost", "finder", "urlconf", "y", "translation", "syntax", "secure_ssl_host", "subdirectory", "oracle_managed_files", "log", "email_host_password", "number_grouping", "requestdatatoobig", "internal_ips", "benefit", "keys", "case", "boolean", "length", "authentication", "django.contrib.sessions.serializers", "conjunction", "certificate", "slug", "defaultstoragefinder", "tying", "errors", "fallbackstorage", "html", "datetime_format", "tuple", "server", "str", "submission", "arguments", "significance", "upload", "session_cache_alias", "passwords", "static", "package", "subdomain.example.com", "middleware", "xss", "one", "directive", "end", "translations", "entries", "en_us", "contrib", "sqlite", "mypassword", "startproject", "tuples", "secret_key", "amount", "standard", "server_email", "loginview", "path", "proto", "stats", "functions", "key", "tblspace", "operations", "mydatabase", "drilldown", "success", "none", "bookmarklets", "problem", "rotation", "specifies", "bcryptsha256passwordhasher", "meta", "get", "default_from_email", "patterns", "definitions", "session_cookie_secure", "to", "logging", "reason", "framework", "caches", "replica", "email_ssl_certfile", "new", "year_month_format", "secure_hsts_preload", "true", "urls", "posts", "api", "sessions", "parts", "4.1.2.6", "cookies", "mode", "priority", "transactions", "os.environ['tz", "connection", "app_label.model_name", "-", "sessionstorage", "staticfilesstorage", "datetime_input_formats", "context", "cycle", "offset", "files", "import", "d", "admins", "urlfield.assume_scheme", "mysql", "directory", "%", "at", "information", "x_frame_options", "python", "django.core.signing", "django.test.runner", "methods", "options", "optional", "exception", "resource", "client", "force_script_name", "details", "method", "debug_propagate_exceptions", "django.db.backends.sqlite3", "settings", "transaction", "argument", "r'^no", "slave", "days", "cookie", "note", "sites", "body", "email_ssl_keyfile", "state", "oracle", "attacks", "vulnerabilities", "scenarios", "controlling", "templates", "beginning", "templatessetting", "text", "project", "exceptions"], "type": "documentation"},
{"title": "Database Functions | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/database-functions/", "content": "Database Functions ¶ The classes documented below provide a way for users to use functions provided\nby the underlying database as annotations, aggregations, or filters in Django.\nFunctions are also expressions , so they can be used and\ncombined with other expressions like aggregate functions . We’ll be using the following model in examples of each function: class Author ( models . Model ): name = models . CharField ( max_length = 50 ) age = models . PositiveIntegerField ( null = True , blank = True ) alias = models . CharField ( max_length = 50 , null = True , blank = True ) goes_by = models . CharField ( max_length = 50 , null = True , blank = True ) We don’t usually recommend allowing null=True for CharField since this\nallows the field to have two “empty values”, but it’s important for the Coalesce example below. Comparison and conversion functions ¶ Cast ¶ class Cast ( expression , output_field ) [source] ¶ Forces the result type of expression to be the one from output_field . Usage example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Cast >>> Author . objects . create ( age = 25 , name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( ... age_as_float = Cast ( \"age\" , output_field = FloatField ()), ... ) . get () >>> print ( author . age_as_float ) 25.0 Coalesce ¶ class Coalesce ( * expressions , ** extra ) [source] ¶ Accepts a list of at least two field names or expressions and returns the\nfirst non-null value (note that an empty string is not considered a null\nvalue). Each argument must be of a similar type, so mixing text and numbers\nwill result in a database error. Usage examples: >>> # Get a screen name from least to most public >>> from django.db.models import Sum >>> from django.db.models.functions import Coalesce >>> Author . objects . create ( name = \"Margaret Smith\" , goes_by = \"Maggie\" ) >>> author = Author . objects . annotate ( screen_name = Coalesce ( \"alias\" , \"goes_by\" , \"name\" )) . get () >>> print ( author . screen_name ) Maggie >>> # Prevent an aggregate Sum() from returning None >>> # The aggregate default argument uses Coalesce() under the hood. >>> aggregated = Author . objects . aggregate ( ... combined_age = Sum ( \"age\" ), ... combined_age_default = Sum ( \"age\" , default = 0 ), ... combined_age_coalesce = Coalesce ( Sum ( \"age\" ), 0 ), ... ) >>> print ( aggregated [ \"combined_age\" ]) None >>> print ( aggregated [ \"combined_age_default\" ]) 0 >>> print ( aggregated [ \"combined_age_coalesce\" ]) 0 Warning A Python value passed to Coalesce on MySQL may be converted to an\nincorrect type unless explicitly cast to the correct database type: >>> from django.db.models import DateTimeField >>> from django.db.models.functions import Cast , Coalesce >>> from django.utils import timezone >>> now = timezone . now () >>> Coalesce ( \"updated\" , Cast ( now , DateTimeField ())) Collate ¶ class Collate ( expression , collation ) [source] ¶ Takes an expression and a collation name to query against. For example, to filter case-insensitively in SQLite: >>> Author . objects . filter ( name = Collate ( Value ( \"john\" ), \"nocase\" )) <QuerySet [<Author: John>, <Author: john>]> It can also be used when ordering, for example with PostgreSQL: >>> Author . objects . order_by ( Collate ( \"name\" , \"et-x-icu\" )) <QuerySet [<Author: Ursula>, <Author: Veronika>, <Author: Ülle>]> Greatest ¶ class Greatest ( * expressions , ** extra ) [source] ¶ Accepts a list of at least two field names or expressions and returns the\ngreatest value. Each argument must be of a similar type, so mixing text and\nnumbers will result in a database error. Usage example: class Blog ( models . Model ): body = models . TextField () modified = models . DateTimeField ( auto_now = True ) class Comment ( models . Model ): body = models . TextField () modified = models . DateTimeField ( auto_now = True ) blog = models . ForeignKey ( Blog , on_delete = models . CASCADE ) >>> from django.db.models.functions import Greatest >>> blog = Blog . objects . create ( body = \"Greatest is the best.\" ) >>> comment = Comment . objects . create ( body = \"No, Least is better.\" , blog = blog ) >>> comments = Comment . objects . annotate ( last_updated = Greatest ( \"modified\" , \"blog__modified\" )) >>> annotated_comment = comments . get () annotated_comment.last_updated will be the most recent of blog.modified and comment.modified . Warning The behavior of Greatest when one or more expression may be null varies between databases: PostgreSQL: Greatest will return the largest non-null expression,\nor null if all expressions are null . SQLite, Oracle, and MySQL: If any expression is null , Greatest will return null . The PostgreSQL behavior can be emulated using Coalesce if you know\na sensible minimum value to provide as a default. JSONObject ¶ class JSONObject ( ** fields ) [source] ¶ Takes a list of key-value pairs and returns a JSON object containing those\npairs. Usage example: >>> from django.db.models import F >>> from django.db.models.functions import JSONObject , Lower >>> Author . objects . create ( name = \"Margaret Smith\" , alias = \"msmith\" , age = 25 ) >>> author = Author . objects . annotate ( ... json_object = JSONObject ( ... name = Lower ( \"name\" ), ... alias = \"alias\" , ... age = F ( \"age\" ) * 2 , ... ) ... ) . get () >>> author . json_object {'name': 'margaret smith', 'alias': 'msmith', 'age': 50} Least ¶ class Least ( * expressions , ** extra ) [source] ¶ Accepts a list of at least two field names or expressions and returns the\nleast value. Each argument must be of a similar type, so mixing text and numbers\nwill result in a database error. Warning The behavior of Least when one or more expression may be null varies between databases: PostgreSQL: Least will return the smallest non-null expression,\nor null if all expressions are null . SQLite, Oracle, and MySQL: If any expression is null , Least will return null . The PostgreSQL behavior can be emulated using Coalesce if you know\na sensible maximum value to provide as a default. NullIf ¶ class NullIf ( expression1 , expression2 ) [source] ¶ Accepts two expressions and returns None if they are equal, otherwise\nreturns expression1 . Caveats on Oracle Due to an Oracle convention , this\nfunction returns the empty string instead of None when the expressions\nare of type CharField . Passing Value(None) to expression1 is prohibited on Oracle since\nOracle doesn’t accept NULL as the first argument. Date functions ¶ We’ll be using the following model in examples of each function: class Experiment ( models . Model ): start_datetime = models . DateTimeField () start_date = models . DateField ( null = True , blank = True ) start_time = models . TimeField ( null = True , blank = True ) end_datetime = models . DateTimeField ( null = True , blank = True ) end_date = models . DateField ( null = True , blank = True ) end_time = models . TimeField ( null = True , blank = True ) Extract ¶ class Extract ( expression , lookup_name = None , tzinfo = None , ** extra ) [source] ¶ Extracts a component of a date as a number. Takes an expression representing a DateField , DateTimeField , TimeField , or DurationField and a lookup_name , and returns the part\nof the date referenced by lookup_name as an IntegerField .\nDjango usually uses the databases’ extract function, so you may use any lookup_name that your database supports. A tzinfo subclass, usually\nprovided by zoneinfo , can be passed to extract a value in a specific\ntimezone. Given the datetime 2015-06-15 23:30:01.000321+00:00 , the built-in lookup_name s return: “year”: 2015 “iso_year”: 2015 “quarter”: 2 “month”: 6 “day”: 15 “week”: 25 “week_day”: 2 “iso_week_day”: 1 “hour”: 23 “minute”: 30 “second”: 1 If a different timezone like Australia/Melbourne is active in Django, then\nthe datetime is converted to the timezone before the value is extracted. The\ntimezone offset for Melbourne in the example date above is +10:00. The values\nreturned when this timezone is active will be the same as above except for: “day”: 16 “week_day”: 3 “iso_week_day”: 2 “hour”: 9 week_day values The week_day lookup_type is calculated differently from most\ndatabases and from Python’s standard functions. This function will return 1 for Sunday, 2 for Monday, through 7 for Saturday. The equivalent calculation in Python is: >>> from datetime import datetime >>> dt = datetime ( 2015 , 6 , 15 ) >>> ( dt . isoweekday () % 7 ) + 1 2 week values The week lookup_type is calculated based on ISO-8601 , i.e.,\na week starts on a Monday. The first week of a year is the one that\ncontains the year’s first Thursday, i.e. the first week has the majority\n(four or more) of its days in the year. The value returned is in the range\n1 to 52 or 53. Each lookup_name above has a corresponding Extract subclass (listed\nbelow) that should typically be used instead of the more verbose equivalent,\ne.g. use ExtractYear(...) rather than Extract(..., lookup_name='year') . Usage example: >>> from datetime import datetime >>> from django.db.models.functions import Extract >>> start = datetime ( 2015 , 6 , 15 ) >>> end = datetime ( 2015 , 7 , 2 ) >>> Experiment . objects . create ( ... start_datetime = start , start_date = start . date (), end_datetime = end , end_date = end . date () ... ) >>> # Add the experiment start year as a field in the QuerySet. >>> experiment = Experiment . objects . annotate ( ... start_year = Extract ( \"start_datetime\" , \"year\" ) ... ) . get () >>> experiment . start_year 2015 >>> # How many experiments completed in the same year in which they started? >>> Experiment . objects . filter ( start_datetime__year = Extract ( \"end_datetime\" , \"year\" )) . count () 1 DateField extracts ¶ class ExtractYear ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'year' class ExtractIsoYear ( expression , tzinfo = None , ** extra ) [source] ¶ Returns the ISO-8601 week-numbering year. lookup_name = 'iso_year' class ExtractMonth ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'month' class ExtractDay ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'day' class ExtractWeekDay ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'week_day' class ExtractIsoWeekDay ( expression , tzinfo = None , ** extra ) [source] ¶ Returns the ISO-8601 week day with day 1 being Monday and day 7 being\nSunday. lookup_name = 'iso_week_day' class ExtractWeek ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'week' class ExtractQuarter ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'quarter' These are logically equivalent to Extract('date_field', lookup_name) . Each\nclass is also a Transform registered on DateField and DateTimeField as __(lookup_name) , e.g. __year . Since DateField s don’t have a time component, only Extract subclasses\nthat deal with date-parts can be used with DateField : >>> from datetime import datetime , timezone >>> from django.db.models.functions import ( ... ExtractDay , ... ExtractMonth , ... ExtractQuarter , ... ExtractWeek , ... ExtractIsoWeekDay , ... ExtractWeekDay , ... ExtractIsoYear , ... ExtractYear , ... ) >>> start_2015 = datetime ( 2015 , 6 , 15 , 23 , 30 , 1 , tzinfo = timezone . utc ) >>> end_2015 = datetime ( 2015 , 6 , 16 , 13 , 11 , 27 , tzinfo = timezone . utc ) >>> Experiment . objects . create ( ... start_datetime = start_2015 , ... start_date = start_2015 . date (), ... end_datetime = end_2015 , ... end_date = end_2015 . date (), ... ) >>> Experiment . objects . annotate ( ... year = ExtractYear ( \"start_date\" ), ... isoyear = ExtractIsoYear ( \"start_date\" ), ... quarter = ExtractQuarter ( \"start_date\" ), ... month = ExtractMonth ( \"start_date\" ), ... week = ExtractWeek ( \"start_date\" ), ... day = ExtractDay ( \"start_date\" ), ... weekday = ExtractWeekDay ( \"start_date\" ), ... isoweekday = ExtractIsoWeekDay ( \"start_date\" ), ... ) . values ( ... \"year\" , ... \"isoyear\" , ... \"quarter\" , ... \"month\" , ... \"week\" , ... \"day\" , ... \"weekday\" , ... \"isoweekday\" , ... ) . get ( ... end_date__year = ExtractYear ( \"start_date\" ) ... ) {'year': 2015, 'isoyear': 2015, 'quarter': 2, 'month': 6, 'week': 25, 'day': 15, 'weekday': 2, 'isoweekday': 1} DateTimeField extracts ¶ In addition to the following, all extracts for DateField listed above may\nalso be used on DateTimeField s . class ExtractHour ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'hour' class ExtractMinute ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'minute' class ExtractSecond ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'second' These are logically equivalent to Extract('datetime_field', lookup_name) .\nEach class is also a Transform registered on DateTimeField as __(lookup_name) , e.g. __minute . DateTimeField examples: >>> from datetime import datetime , timezone >>> from django.db.models.functions import ( ... ExtractDay , ... ExtractHour , ... ExtractMinute , ... ExtractMonth , ... ExtractQuarter , ... ExtractSecond , ... ExtractWeek , ... ExtractIsoWeekDay , ... ExtractWeekDay , ... ExtractIsoYear , ... ExtractYear , ... ) >>> start_2015 = datetime ( 2015 , 6 , 15 , 23 , 30 , 1 , tzinfo = timezone . utc ) >>> end_2015 = datetime ( 2015 , 6 , 16 , 13 , 11 , 27 , tzinfo = timezone . utc ) >>> Experiment . objects . create ( ... start_datetime = start_2015 , ... start_date = start_2015 . date (), ... end_datetime = end_2015 , ... end_date = end_2015 . date (), ... ) >>> Experiment . objects . annotate ( ... year = ExtractYear ( \"start_datetime\" ), ... isoyear = ExtractIsoYear ( \"start_datetime\" ), ... quarter = ExtractQuarter ( \"start_datetime\" ), ... month = ExtractMonth ( \"start_datetime\" ), ... week = ExtractWeek ( \"start_datetime\" ), ... day = ExtractDay ( \"start_datetime\" ), ... weekday = ExtractWeekDay ( \"start_datetime\" ), ... isoweekday = ExtractIsoWeekDay ( \"start_datetime\" ), ... hour = ExtractHour ( \"start_datetime\" ), ... minute = ExtractMinute ( \"start_datetime\" ), ... second = ExtractSecond ( \"start_datetime\" ), ... ) . values ( ... \"year\" , ... \"isoyear\" , ... \"month\" , ... \"week\" , ... \"day\" , ... \"weekday\" , ... \"isoweekday\" , ... \"hour\" , ... \"minute\" , ... \"second\" , ... ) . get ( ... end_datetime__year = ExtractYear ( \"start_datetime\" ) ... ) {'year': 2015, 'isoyear': 2015, 'quarter': 2, 'month': 6, 'week': 25, 'day': 15, 'weekday': 2, 'isoweekday': 1, 'hour': 23, 'minute': 30, 'second': 1} When USE_TZ is True then datetimes are stored in the database\nin UTC. If a different timezone is active in Django, the datetime is converted\nto that timezone before the value is extracted. The example below converts to\nthe Melbourne timezone (UTC +10:00), which changes the day, weekday, and hour\nvalues that are returned: >>> from django.utils import timezone >>> import zoneinfo >>> melb = zoneinfo . ZoneInfo ( \"Australia/Melbourne\" ) # UTC+10:00 >>> with timezone . override ( melb ): ... Experiment . objects . annotate ( ... day = ExtractDay ( \"start_datetime\" ), ... weekday = ExtractWeekDay ( \"start_datetime\" ), ... isoweekday = ExtractIsoWeekDay ( \"start_datetime\" ), ... hour = ExtractHour ( \"start_datetime\" ), ... ) . values ( \"day\" , \"weekday\" , \"isoweekday\" , \"hour\" ) . get ( ... end_datetime__year = ExtractYear ( \"start_datetime\" ), ... ) ... {'day': 16, 'weekday': 3, 'isoweekday': 2, 'hour': 9} Explicitly passing the timezone to the Extract function behaves in the same\nway, and takes priority over an active timezone: >>> import zoneinfo >>> melb = zoneinfo . ZoneInfo ( \"Australia/Melbourne\" ) >>> Experiment . objects . annotate ( ... day = ExtractDay ( \"start_datetime\" , tzinfo = melb ), ... weekday = ExtractWeekDay ( \"start_datetime\" , tzinfo = melb ), ... isoweekday = ExtractIsoWeekDay ( \"start_datetime\" , tzinfo = melb ), ... hour = ExtractHour ( \"start_datetime\" , tzinfo = melb ), ... ) . values ( \"day\" , \"weekday\" , \"isoweekday\" , \"hour\" ) . get ( ... end_datetime__year = ExtractYear ( \"start_datetime\" ), ... ) {'day': 16, 'weekday': 3, 'isoweekday': 2, 'hour': 9} Now ¶ class Now [source] ¶ Returns the database server’s current date and time when the query is executed,\ntypically using the SQL CURRENT_TIMESTAMP . Usage example: >>> from django.db.models.functions import Now >>> Article . objects . filter ( published__lte = Now ()) <QuerySet [<Article: How to Django>]> PostgreSQL considerations On PostgreSQL, the SQL CURRENT_TIMESTAMP returns the time that the\ncurrent transaction started. Therefore for cross-database compatibility, Now() uses STATEMENT_TIMESTAMP instead. If you need the transaction\ntimestamp, use django.contrib.postgres.functions.TransactionNow . Oracle On Oracle, the SQL LOCALTIMESTAMP is used to avoid issues with casting CURRENT_TIMESTAMP to DateTimeField . Changed in Django 5.0: In older versions, the SQL CURRENT_TIMESTAMP was used on Oracle instead\nof LOCALTIMESTAMP . Trunc ¶ class Trunc ( expression , kind , output_field = None , tzinfo = None , ** extra ) [source] ¶ Truncates a date up to a significant component. When you only care if something happened in a particular year, hour, or day,\nbut not the exact second, then Trunc (and its subclasses) can be useful to\nfilter or aggregate your data. For example, you can use Trunc to calculate\nthe number of sales per day. Trunc takes a single expression , representing a DateField , TimeField , or DateTimeField , a kind representing a date or time\npart, and an output_field that’s either DateTimeField() , TimeField() , or DateField() . It returns a datetime, date, or time\ndepending on output_field , with fields up to kind set to their minimum\nvalue. If output_field is omitted, it will default to the output_field of expression . A tzinfo subclass, usually provided by zoneinfo ,\ncan be passed to truncate a value in a specific timezone. Given the datetime 2015-06-15 14:30:50.000321+00:00 , the built-in kind s\nreturn: “year”: 2015-01-01 00:00:00+00:00 “quarter”: 2015-04-01 00:00:00+00:00 “month”: 2015-06-01 00:00:00+00:00 “week”: 2015-06-15 00:00:00+00:00 “day”: 2015-06-15 00:00:00+00:00 “hour”: 2015-06-15 14:00:00+00:00 “minute”: 2015-06-15 14:30:00+00:00 “second”: 2015-06-15 14:30:50+00:00 If a different timezone like Australia/Melbourne is active in Django, then\nthe datetime is converted to the new timezone before the value is truncated.\nThe timezone offset for Melbourne in the example date above is +10:00. The\nvalues returned when this timezone is active will be: “year”: 2015-01-01 00:00:00+11:00 “quarter”: 2015-04-01 00:00:00+10:00 “month”: 2015-06-01 00:00:00+10:00 “week”: 2015-06-16 00:00:00+10:00 “day”: 2015-06-16 00:00:00+10:00 “hour”: 2015-06-16 00:00:00+10:00 “minute”: 2015-06-16 00:30:00+10:00 “second”: 2015-06-16 00:30:50+10:00 The year has an offset of +11:00 because the result transitioned into daylight\nsaving time. Each kind above has a corresponding Trunc subclass (listed below) that\nshould typically be used instead of the more verbose equivalent,\ne.g. use TruncYear(...) rather than Trunc(..., kind='year') . The subclasses are all defined as transforms, but they aren’t registered with\nany fields, because the lookup names are already reserved by the Extract subclasses. Usage example: >>> from datetime import datetime >>> from django.db.models import Count , DateTimeField >>> from django.db.models.functions import Trunc >>> Experiment . objects . create ( start_datetime = datetime ( 2015 , 6 , 15 , 14 , 30 , 50 , 321 )) >>> Experiment . objects . create ( start_datetime = datetime ( 2015 , 6 , 15 , 14 , 40 , 2 , 123 )) >>> Experiment . objects . create ( start_datetime = datetime ( 2015 , 12 , 25 , 10 , 5 , 27 , 999 )) >>> experiments_per_day = ( ... Experiment . objects . annotate ( ... start_day = Trunc ( \"start_datetime\" , \"day\" , output_field = DateTimeField ()) ... ) ... . values ( \"start_day\" ) ... . annotate ( experiments = Count ( \"id\" )) ... ) >>> for exp in experiments_per_day : ... print ( exp [ \"start_day\" ], exp [ \"experiments\" ]) ... 2015-06-15 00:00:00 2 2015-12-25 00:00:00 1 >>> experiments = Experiment . objects . annotate ( ... start_day = Trunc ( \"start_datetime\" , \"day\" , output_field = DateTimeField ()) ... ) . filter ( start_day = datetime ( 2015 , 6 , 15 )) >>> for exp in experiments : ... print ( exp . start_datetime ) ... 2015-06-15 14:30:50.000321 2015-06-15 14:40:02.000123 DateField truncation ¶ class TruncYear ( expression , output_field = None , tzinfo = None , ** extra ) [source] ¶ kind = 'year' class TruncMonth ( expression , output_field = None , tzinfo = None , ** extra ) [source] ¶ kind = 'month' class TruncWeek ( expression , output_field = None , tzinfo = None , ** extra ) [source] ¶ Truncates to midnight on the Monday of the week. kind = 'week' class TruncQuarter ( expression , output_field = None , tzinfo = None , ** extra ) [source] ¶ kind = 'quarter' These are logically equivalent to Trunc('date_field', kind) . They truncate\nall parts of the date up to kind which allows grouping or filtering dates\nwith less precision. expression can have an output_field of either DateField or DateTimeField . Since DateField s don’t have a time component, only Trunc subclasses\nthat deal with date-parts can be used with DateField : >>> from datetime import datetime , timezone >>> from django.db.models import Count >>> from django.db.models.functions import TruncMonth , TruncYear >>> start1 = datetime ( 2014 , 6 , 15 , 14 , 30 , 50 , 321 , tzinfo = timezone . utc ) >>> start2 = datetime ( 2015 , 6 , 15 , 14 , 40 , 2 , 123 , tzinfo = timezone . utc ) >>> start3 = datetime ( 2015 , 12 , 31 , 17 , 5 , 27 , 999 , tzinfo = timezone . utc ) >>> Experiment . objects . create ( start_datetime = start1 , start_date = start1 . date ()) >>> Experiment . objects . create ( start_datetime = start2 , start_date = start2 . date ()) >>> Experiment . objects . create ( start_datetime = start3 , start_date = start3 . date ()) >>> experiments_per_year = ( ... Experiment . objects . annotate ( year = TruncYear ( \"start_date\" )) ... . values ( \"year\" ) ... . annotate ( experiments = Count ( \"id\" )) ... ) >>> for exp in experiments_per_year : ... print ( exp [ \"year\" ], exp [ \"experiments\" ]) ... 2014-01-01 1 2015-01-01 2 >>> import zoneinfo >>> melb = zoneinfo . ZoneInfo ( \"Australia/Melbourne\" ) >>> experiments_per_month = ( ... Experiment . objects . annotate ( month = TruncMonth ( \"start_datetime\" , tzinfo = melb )) ... . values ( \"month\" ) ... . annotate ( experiments = Count ( \"id\" )) ... ) >>> for exp in experiments_per_month : ... print ( exp [ \"month\" ], exp [ \"experiments\" ]) ... 2015-06-01 00:00:00+10:00 1 2016-01-01 00:00:00+11:00 1 2014-06-01 00:00:00+10:00 1 DateTimeField truncation ¶ class TruncDate ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'date' output_field = DateField() TruncDate casts expression to a date rather than using the built-in SQL\ntruncate function. It’s also registered as a transform on DateTimeField as __date . class TruncTime ( expression , tzinfo = None , ** extra ) [source] ¶ lookup_name = 'time' output_field = TimeField() TruncTime casts expression to a time rather than using the built-in SQL\ntruncate function. It’s also registered as a transform on DateTimeField as __time . class TruncDay ( expression , output_field = None , tzinfo = None , ** extra ) [source] ¶ kind = 'day' class TruncHour ( expression , output_field = None , tzinfo = None , ** extra ) [source] ¶ kind = 'hour' class TruncMinute ( expression , output_field = None , tzinfo = None , ** extra ) [source] ¶ kind = 'minute' class TruncSecond ( expression , output_field = None , tzinfo = None , ** extra ) [source] ¶ kind = 'second' These are logically equivalent to Trunc('datetime_field', kind) . They\ntruncate all parts of the date up to kind and allow grouping or filtering\ndatetimes with less precision. expression must have an output_field of DateTimeField . Usage example: >>> from datetime import date , datetime , timezone >>> from django.db.models import Count >>> from django.db.models.functions import ( ... TruncDate , ... TruncDay , ... TruncHour , ... TruncMinute , ... TruncSecond , ... ) >>> import zoneinfo >>> start1 = datetime ( 2014 , 6 , 15 , 14 , 30 , 50 , 321 , tzinfo = timezone . utc ) >>> Experiment . objects . create ( start_datetime = start1 , start_date = start1 . date ()) >>> melb = zoneinfo . ZoneInfo ( \"Australia/Melbourne\" ) >>> Experiment . objects . annotate ( ... date = TruncDate ( \"start_datetime\" ), ... day = TruncDay ( \"start_datetime\" , tzinfo = melb ), ... hour = TruncHour ( \"start_datetime\" , tzinfo = melb ), ... minute = TruncMinute ( \"start_datetime\" ), ... second = TruncSecond ( \"start_datetime\" ), ... ) . values ( \"date\" , \"day\" , \"hour\" , \"minute\" , \"second\" ) . get () {'date': datetime.date(2014, 6, 15), 'day': datetime.datetime(2014, 6, 16, 0, 0, tzinfo=zoneinfo.ZoneInfo('Australia/Melbourne')), 'hour': datetime.datetime(2014, 6, 16, 0, 0, tzinfo=zoneinfo.ZoneInfo('Australia/Melbourne')), 'minute': 'minute': datetime.datetime(2014, 6, 15, 14, 30, tzinfo=timezone.utc), 'second': datetime.datetime(2014, 6, 15, 14, 30, 50, tzinfo=timezone.utc) } TimeField truncation ¶ class TruncHour ( expression , output_field = None , tzinfo = None , ** extra ) [source] kind = 'hour' class TruncMinute ( expression , output_field = None , tzinfo = None , ** extra ) [source] kind = 'minute' class TruncSecond ( expression , output_field = None , tzinfo = None , ** extra ) [source] kind = 'second' These are logically equivalent to Trunc('time_field', kind) . They truncate\nall parts of the time up to kind which allows grouping or filtering times\nwith less precision. expression can have an output_field of either TimeField or DateTimeField . Since TimeField s don’t have a date component, only Trunc subclasses\nthat deal with time-parts can be used with TimeField : >>> from datetime import datetime , timezone >>> from django.db.models import Count , TimeField >>> from django.db.models.functions import TruncHour >>> start1 = datetime ( 2014 , 6 , 15 , 14 , 30 , 50 , 321 , tzinfo = timezone . utc ) >>> start2 = datetime ( 2014 , 6 , 15 , 14 , 40 , 2 , 123 , tzinfo = timezone . utc ) >>> start3 = datetime ( 2015 , 12 , 31 , 17 , 5 , 27 , 999 , tzinfo = timezone . utc ) >>> Experiment . objects . create ( start_datetime = start1 , start_time = start1 . time ()) >>> Experiment . objects . create ( start_datetime = start2 , start_time = start2 . time ()) >>> Experiment . objects . create ( start_datetime = start3 , start_time = start3 . time ()) >>> experiments_per_hour = ( ... Experiment . objects . annotate ( ... hour = TruncHour ( \"start_datetime\" , output_field = TimeField ()), ... ) ... . values ( \"hour\" ) ... . annotate ( experiments = Count ( \"id\" )) ... ) >>> for exp in experiments_per_hour : ... print ( exp [ \"hour\" ], exp [ \"experiments\" ]) ... 14:00:00 2 17:00:00 1 >>> import zoneinfo >>> melb = zoneinfo . ZoneInfo ( \"Australia/Melbourne\" ) >>> experiments_per_hour = ( ... Experiment . objects . annotate ( ... hour = TruncHour ( \"start_datetime\" , tzinfo = melb ), ... ) ... . values ( \"hour\" ) ... . annotate ( experiments = Count ( \"id\" )) ... ) >>> for exp in experiments_per_hour : ... print ( exp [ \"hour\" ], exp [ \"experiments\" ]) ... 2014-06-16 00:00:00+10:00 2 2016-01-01 04:00:00+11:00 1 Math Functions ¶ We’ll be using the following model in math function examples: class Vector ( models . Model ): x = models . FloatField () y = models . FloatField () Abs ¶ class Abs ( expression , ** extra ) [source] ¶ Returns the absolute value of a numeric field or expression. Usage example: >>> from django.db.models.functions import Abs >>> Vector . objects . create ( x =- 0.5 , y = 1.1 ) >>> vector = Vector . objects . annotate ( x_abs = Abs ( \"x\" ), y_abs = Abs ( \"y\" )) . get () >>> vector . x_abs , vector . y_abs (0.5, 1.1) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Abs >>> FloatField . register_lookup ( Abs ) >>> # Get vectors inside the unit cube >>> vectors = Vector . objects . filter ( x__abs__lt = 1 , y__abs__lt = 1 ) ACos ¶ class ACos ( expression , ** extra ) [source] ¶ Returns the arccosine of a numeric field or expression. The expression value\nmust be within the range -1 to 1. Usage example: >>> from django.db.models.functions import ACos >>> Vector . objects . create ( x = 0.5 , y =- 0.9 ) >>> vector = Vector . objects . annotate ( x_acos = ACos ( \"x\" ), y_acos = ACos ( \"y\" )) . get () >>> vector . x_acos , vector . y_acos (1.0471975511965979, 2.6905658417935308) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import ACos >>> FloatField . register_lookup ( ACos ) >>> # Get vectors whose arccosine is less than 1 >>> vectors = Vector . objects . filter ( x__acos__lt = 1 , y__acos__lt = 1 ) ASin ¶ class ASin ( expression , ** extra ) [source] ¶ Returns the arcsine of a numeric field or expression. The expression value must\nbe in the range -1 to 1. Usage example: >>> from django.db.models.functions import ASin >>> Vector . objects . create ( x = 0 , y = 1 ) >>> vector = Vector . objects . annotate ( x_asin = ASin ( \"x\" ), y_asin = ASin ( \"y\" )) . get () >>> vector . x_asin , vector . y_asin (0.0, 1.5707963267948966) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import ASin >>> FloatField . register_lookup ( ASin ) >>> # Get vectors whose arcsine is less than 1 >>> vectors = Vector . objects . filter ( x__asin__lt = 1 , y__asin__lt = 1 ) ATan ¶ class ATan ( expression , ** extra ) [source] ¶ Returns the arctangent of a numeric field or expression. Usage example: >>> from django.db.models.functions import ATan >>> Vector . objects . create ( x = 3.12 , y = 6.987 ) >>> vector = Vector . objects . annotate ( x_atan = ATan ( \"x\" ), y_atan = ATan ( \"y\" )) . get () >>> vector . x_atan , vector . y_atan (1.2606282660069106, 1.428638798133829) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import ATan >>> FloatField . register_lookup ( ATan ) >>> # Get vectors whose arctangent is less than 2 >>> vectors = Vector . objects . filter ( x__atan__lt = 2 , y__atan__lt = 2 ) ATan2 ¶ class ATan2 ( expression1 , expression2 , ** extra ) [source] ¶ Returns the arctangent of expression1 / expression2 . Usage example: >>> from django.db.models.functions import ATan2 >>> Vector . objects . create ( x = 2.5 , y = 1.9 ) >>> vector = Vector . objects . annotate ( atan2 = ATan2 ( \"x\" , \"y\" )) . get () >>> vector . atan2 0.9209258773829491 Ceil ¶ class Ceil ( expression , ** extra ) [source] ¶ Returns the smallest integer greater than or equal to a numeric field or\nexpression. Usage example: >>> from django.db.models.functions import Ceil >>> Vector . objects . create ( x = 3.12 , y = 7.0 ) >>> vector = Vector . objects . annotate ( x_ceil = Ceil ( \"x\" ), y_ceil = Ceil ( \"y\" )) . get () >>> vector . x_ceil , vector . y_ceil (4.0, 7.0) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Ceil >>> FloatField . register_lookup ( Ceil ) >>> # Get vectors whose ceil is less than 10 >>> vectors = Vector . objects . filter ( x__ceil__lt = 10 , y__ceil__lt = 10 ) Cos ¶ class Cos ( expression , ** extra ) [source] ¶ Returns the cosine  of a numeric field or expression. Usage example: >>> from django.db.models.functions import Cos >>> Vector . objects . create ( x =- 8.0 , y = 3.1415926 ) >>> vector = Vector . objects . annotate ( x_cos = Cos ( \"x\" ), y_cos = Cos ( \"y\" )) . get () >>> vector . x_cos , vector . y_cos (-0.14550003380861354, -0.9999999999999986) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Cos >>> FloatField . register_lookup ( Cos ) >>> # Get vectors whose cosine is less than 0.5 >>> vectors = Vector . objects . filter ( x__cos__lt = 0.5 , y__cos__lt = 0.5 ) Cot ¶ class Cot ( expression , ** extra ) [source] ¶ Returns the cotangent of a numeric field or expression. Usage example: >>> from django.db.models.functions import Cot >>> Vector . objects . create ( x = 12.0 , y = 1.0 ) >>> vector = Vector . objects . annotate ( x_cot = Cot ( \"x\" ), y_cot = Cot ( \"y\" )) . get () >>> vector . x_cot , vector . y_cot (-1.5726734063976826, 0.642092615934331) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Cot >>> FloatField . register_lookup ( Cot ) >>> # Get vectors whose cotangent is less than 1 >>> vectors = Vector . objects . filter ( x__cot__lt = 1 , y__cot__lt = 1 ) Degrees ¶ class Degrees ( expression , ** extra ) [source] ¶ Converts a numeric field or expression from radians to degrees. Usage example: >>> from django.db.models.functions import Degrees >>> Vector . objects . create ( x =- 1.57 , y = 3.14 ) >>> vector = Vector . objects . annotate ( x_d = Degrees ( \"x\" ), y_d = Degrees ( \"y\" )) . get () >>> vector . x_d , vector . y_d (-89.95437383553924, 179.9087476710785) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Degrees >>> FloatField . register_lookup ( Degrees ) >>> # Get vectors whose degrees are less than 360 >>> vectors = Vector . objects . filter ( x__degrees__lt = 360 , y__degrees__lt = 360 ) Exp ¶ class Exp ( expression , ** extra ) [source] ¶ Returns the value of e (the natural logarithm base) raised to the power of\na numeric field or expression. Usage example: >>> from django.db.models.functions import Exp >>> Vector . objects . create ( x = 5.4 , y =- 2.0 ) >>> vector = Vector . objects . annotate ( x_exp = Exp ( \"x\" ), y_exp = Exp ( \"y\" )) . get () >>> vector . x_exp , vector . y_exp (221.40641620418717, 0.1353352832366127) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Exp >>> FloatField . register_lookup ( Exp ) >>> # Get vectors whose exp() is greater than 10 >>> vectors = Vector . objects . filter ( x__exp__gt = 10 , y__exp__gt = 10 ) Floor ¶ class Floor ( expression , ** extra ) [source] ¶ Returns the largest integer value not greater than a numeric field or\nexpression. Usage example: >>> from django.db.models.functions import Floor >>> Vector . objects . create ( x = 5.4 , y =- 2.3 ) >>> vector = Vector . objects . annotate ( x_floor = Floor ( \"x\" ), y_floor = Floor ( \"y\" )) . get () >>> vector . x_floor , vector . y_floor (5.0, -3.0) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Floor >>> FloatField . register_lookup ( Floor ) >>> # Get vectors whose floor() is greater than 10 >>> vectors = Vector . objects . filter ( x__floor__gt = 10 , y__floor__gt = 10 ) Ln ¶ class Ln ( expression , ** extra ) [source] ¶ Returns the natural logarithm a numeric field or expression. Usage example: >>> from django.db.models.functions import Ln >>> Vector . objects . create ( x = 5.4 , y = 233.0 ) >>> vector = Vector . objects . annotate ( x_ln = Ln ( \"x\" ), y_ln = Ln ( \"y\" )) . get () >>> vector . x_ln , vector . y_ln (1.6863989535702288, 5.4510384535657) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Ln >>> FloatField . register_lookup ( Ln ) >>> # Get vectors whose value greater than e >>> vectors = Vector . objects . filter ( x__ln__gt = 1 , y__ln__gt = 1 ) Log ¶ class Log ( expression1 , expression2 , ** extra ) [source] ¶ Accepts two numeric fields or expressions and returns the logarithm of\nthe second to base of the first. Usage example: >>> from django.db.models.functions import Log >>> Vector . objects . create ( x = 2.0 , y = 4.0 ) >>> vector = Vector . objects . annotate ( log = Log ( \"x\" , \"y\" )) . get () >>> vector . log 2.0 Mod ¶ class Mod ( expression1 , expression2 , ** extra ) [source] ¶ Accepts two numeric fields or expressions and returns the remainder of\nthe first divided by the second (modulo operation). Usage example: >>> from django.db.models.functions import Mod >>> Vector . objects . create ( x = 5.4 , y = 2.3 ) >>> vector = Vector . objects . annotate ( mod = Mod ( \"x\" , \"y\" )) . get () >>> vector . mod 0.8 Pi ¶ class Pi ( ** extra ) [source] ¶ Returns the value of the mathematical constant π . Power ¶ class Power ( expression1 , expression2 , ** extra ) [source] ¶ Accepts two numeric fields or expressions and returns the value of the first\nraised to the power of the second. Usage example: >>> from django.db.models.functions import Power >>> Vector . objects . create ( x = 2 , y =- 2 ) >>> vector = Vector . objects . annotate ( power = Power ( \"x\" , \"y\" )) . get () >>> vector . power 0.25 Radians ¶ class Radians ( expression , ** extra ) [source] ¶ Converts a numeric field or expression from degrees to radians. Usage example: >>> from django.db.models.functions import Radians >>> Vector . objects . create ( x =- 90 , y = 180 ) >>> vector = Vector . objects . annotate ( x_r = Radians ( \"x\" ), y_r = Radians ( \"y\" )) . get () >>> vector . x_r , vector . y_r (-1.5707963267948966, 3.141592653589793) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Radians >>> FloatField . register_lookup ( Radians ) >>> # Get vectors whose radians are less than 1 >>> vectors = Vector . objects . filter ( x__radians__lt = 1 , y__radians__lt = 1 ) Random ¶ class Random ( ** extra ) [source] ¶ Returns a random value in the range 0.0 ≤ x < 1.0 . Round ¶ class Round ( expression , precision = 0 , ** extra ) [source] ¶ Rounds a numeric field or expression to precision (must be an integer)\ndecimal places. By default, it rounds to the nearest integer. Whether half\nvalues are rounded up or down depends on the database. Usage example: >>> from django.db.models.functions import Round >>> Vector . objects . create ( x = 5.4 , y =- 2.37 ) >>> vector = Vector . objects . annotate ( x_r = Round ( \"x\" ), y_r = Round ( \"y\" , precision = 1 )) . get () >>> vector . x_r , vector . y_r (5.0, -2.4) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Round >>> FloatField . register_lookup ( Round ) >>> # Get vectors whose round() is less than 20 >>> vectors = Vector . objects . filter ( x__round__lt = 20 , y__round__lt = 20 ) Sign ¶ class Sign ( expression , ** extra ) [source] ¶ Returns the sign (-1, 0, 1) of a numeric field or expression. Usage example: >>> from django.db.models.functions import Sign >>> Vector . objects . create ( x = 5.4 , y =- 2.3 ) >>> vector = Vector . objects . annotate ( x_sign = Sign ( \"x\" ), y_sign = Sign ( \"y\" )) . get () >>> vector . x_sign , vector . y_sign (1, -1) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Sign >>> FloatField . register_lookup ( Sign ) >>> # Get vectors whose signs of components are less than 0. >>> vectors = Vector . objects . filter ( x__sign__lt = 0 , y__sign__lt = 0 ) Sin ¶ class Sin ( expression , ** extra ) [source] ¶ Returns the sine of a numeric field or expression. Usage example: >>> from django.db.models.functions import Sin >>> Vector . objects . create ( x = 5.4 , y =- 2.3 ) >>> vector = Vector . objects . annotate ( x_sin = Sin ( \"x\" ), y_sin = Sin ( \"y\" )) . get () >>> vector . x_sin , vector . y_sin (-0.7727644875559871, -0.7457052121767203) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Sin >>> FloatField . register_lookup ( Sin ) >>> # Get vectors whose sin() is less than 0 >>> vectors = Vector . objects . filter ( x__sin__lt = 0 , y__sin__lt = 0 ) Sqrt ¶ class Sqrt ( expression , ** extra ) [source] ¶ Returns the square root of a nonnegative numeric field or expression. Usage example: >>> from django.db.models.functions import Sqrt >>> Vector . objects . create ( x = 4.0 , y = 12.0 ) >>> vector = Vector . objects . annotate ( x_sqrt = Sqrt ( \"x\" ), y_sqrt = Sqrt ( \"y\" )) . get () >>> vector . x_sqrt , vector . y_sqrt (2.0, 3.46410) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Sqrt >>> FloatField . register_lookup ( Sqrt ) >>> # Get vectors whose sqrt() is less than 5 >>> vectors = Vector . objects . filter ( x__sqrt__lt = 5 , y__sqrt__lt = 5 ) Tan ¶ class Tan ( expression , ** extra ) [source] ¶ Returns the tangent of a numeric field or expression. Usage example: >>> from django.db.models.functions import Tan >>> Vector . objects . create ( x = 0 , y = 12 ) >>> vector = Vector . objects . annotate ( x_tan = Tan ( \"x\" ), y_tan = Tan ( \"y\" )) . get () >>> vector . x_tan , vector . y_tan (0.0, -0.6358599286615808) It can also be registered as a transform. For example: >>> from django.db.models import FloatField >>> from django.db.models.functions import Tan >>> FloatField . register_lookup ( Tan ) >>> # Get vectors whose tangent is less than 0 >>> vectors = Vector . objects . filter ( x__tan__lt = 0 , y__tan__lt = 0 ) Text functions ¶ Chr ¶ class Chr ( expression , ** extra ) [source] ¶ Accepts a numeric field or expression and returns the text representation of\nthe expression as a single character. It works the same as Python’s chr() function. Like Length , it can be registered as a transform on IntegerField .\nThe default lookup name is chr . Usage example: >>> from django.db.models.functions import Chr >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . filter ( name__startswith = Chr ( ord ( \"M\" ))) . get () >>> print ( author . name ) Margaret Smith Concat ¶ class Concat ( * expressions , ** extra ) [source] ¶ Accepts a list of at least two text fields or expressions and returns the\nconcatenated text. Each argument must be of a text or char type. If you want\nto concatenate a TextField() with a CharField() , then be sure to tell\nDjango that the output_field should be a TextField() . Specifying an output_field is also required when concatenating a Value as in the\nexample below. This function will never have a null result. On backends where a null argument\nresults in the entire expression being null, Django will ensure that each null\npart is converted to an empty string first. Usage example: >>> # Get the display name as \"name (goes_by)\" >>> from django.db.models import CharField , Value as V >>> from django.db.models.functions import Concat >>> Author . objects . create ( name = \"Margaret Smith\" , goes_by = \"Maggie\" ) >>> author = Author . objects . annotate ( ... screen_name = Concat ( \"name\" , V ( \" (\" ), \"goes_by\" , V ( \")\" ), output_field = CharField ()) ... ) . get () >>> print ( author . screen_name ) Margaret Smith (Maggie) Left ¶ class Left ( expression , length , ** extra ) [source] ¶ Returns the first length characters of the given text field or expression. Usage example: >>> from django.db.models.functions import Left >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( first_initial = Left ( \"name\" , 1 )) . get () >>> print ( author . first_initial ) M Length ¶ class Length ( expression , ** extra ) [source] ¶ Accepts a single text field or expression and returns the number of characters\nthe value has. If the expression is null, then the length will also be null. Usage example: >>> # Get the length of the name and goes_by fields >>> from django.db.models.functions import Length >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( ... name_length = Length ( \"name\" ), goes_by_length = Length ( \"goes_by\" ) ... ) . get () >>> print ( author . name_length , author . goes_by_length ) (14, None) It can also be registered as a transform. For example: >>> from django.db.models import CharField >>> from django.db.models.functions import Length >>> CharField . register_lookup ( Length ) >>> # Get authors whose name is longer than 7 characters >>> authors = Author . objects . filter ( name__length__gt = 7 ) Lower ¶ class Lower ( expression , ** extra ) [source] ¶ Accepts a single text field or expression and returns the lowercase\nrepresentation. It can also be registered as a transform as described in Length . Usage example: >>> from django.db.models.functions import Lower >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( name_lower = Lower ( \"name\" )) . get () >>> print ( author . name_lower ) margaret smith LPad ¶ class LPad ( expression , length , fill_text = Value(' ') , ** extra ) [source] ¶ Returns the value of the given text field or expression padded on the left side\nwith fill_text so that the resulting value is length characters long.\nThe default fill_text is a space. Usage example: >>> from django.db.models import Value >>> from django.db.models.functions import LPad >>> Author . objects . create ( name = \"John\" , alias = \"j\" ) >>> Author . objects . update ( name = LPad ( \"name\" , 8 , Value ( \"abc\" ))) 1 >>> print ( Author . objects . get ( alias = \"j\" ) . name ) abcaJohn LTrim ¶ class LTrim ( expression , ** extra ) [source] ¶ Similar to Trim , but removes only leading\nspaces. MD5 ¶ class MD5 ( expression , ** extra ) [source] ¶ Accepts a single text field or expression and returns the MD5 hash of the\nstring. It can also be registered as a transform as described in Length . Usage example: >>> from django.db.models.functions import MD5 >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( name_md5 = MD5 ( \"name\" )) . get () >>> print ( author . name_md5 ) 749fb689816b2db85f5b169c2055b247 Ord ¶ class Ord ( expression , ** extra ) [source] ¶ Accepts a single text field or expression and returns the Unicode code point\nvalue for the first character of that expression. It works similar to Python’s ord() function, but an exception isn’t raised if the expression is more\nthan one character long. It can also be registered as a transform as described in Length .\nThe default lookup name is ord . Usage example: >>> from django.db.models.functions import Ord >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( name_code_point = Ord ( \"name\" )) . get () >>> print ( author . name_code_point ) 77 Repeat ¶ class Repeat ( expression , number , ** extra ) [source] ¶ Returns the value of the given text field or expression repeated number times. Usage example: >>> from django.db.models.functions import Repeat >>> Author . objects . create ( name = \"John\" , alias = \"j\" ) >>> Author . objects . update ( name = Repeat ( \"name\" , 3 )) 1 >>> print ( Author . objects . get ( alias = \"j\" ) . name ) JohnJohnJohn Replace ¶ class Replace ( expression , text , replacement = Value('') , ** extra ) [source] ¶ Replaces all occurrences of text with replacement in expression .\nThe default replacement text is the empty string. The arguments to the function\nare case-sensitive. Usage example: >>> from django.db.models import Value >>> from django.db.models.functions import Replace >>> Author . objects . create ( name = \"Margaret Johnson\" ) >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> Author . objects . update ( name = Replace ( \"name\" , Value ( \"Margaret\" ), Value ( \"Margareth\" ))) 2 >>> Author . objects . values ( \"name\" ) <QuerySet [{'name': 'Margareth Johnson'}, {'name': 'Margareth Smith'}]> Reverse ¶ class Reverse ( expression , ** extra ) [source] ¶ Accepts a single text field or expression and returns the characters of that\nexpression in reverse order. It can also be registered as a transform as described in Length . The\ndefault lookup name is reverse . Usage example: >>> from django.db.models.functions import Reverse >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( backward = Reverse ( \"name\" )) . get () >>> print ( author . backward ) htimS teragraM Right ¶ class Right ( expression , length , ** extra ) [source] ¶ Returns the last length characters of the given text field or expression. Usage example: >>> from django.db.models.functions import Right >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( last_letter = Right ( \"name\" , 1 )) . get () >>> print ( author . last_letter ) h RPad ¶ class RPad ( expression , length , fill_text = Value(' ') , ** extra ) [source] ¶ Similar to LPad , but pads on the right\nside. RTrim ¶ class RTrim ( expression , ** extra ) [source] ¶ Similar to Trim , but removes only trailing\nspaces. SHA1 , SHA224 , SHA256 , SHA384 , and SHA512 ¶ class SHA1 ( expression , ** extra ) [source] ¶ class SHA224 ( expression , ** extra ) [source] ¶ class SHA256 ( expression , ** extra ) [source] ¶ class SHA384 ( expression , ** extra ) [source] ¶ class SHA512 ( expression , ** extra ) [source] ¶ Accepts a single text field or expression and returns the particular hash of\nthe string. They can also be registered as transforms as described in Length . Usage example: >>> from django.db.models.functions import SHA1 >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( name_sha1 = SHA1 ( \"name\" )) . get () >>> print ( author . name_sha1 ) b87efd8a6c991c390be5a68e8a7945a7851c7e5c PostgreSQL The pgcrypto extension must be installed. You can use the CryptoExtension migration\noperation to install it. Oracle Oracle doesn’t support the SHA224 function. StrIndex ¶ class StrIndex ( string , substring , ** extra ) [source] ¶ Returns a positive integer corresponding to the 1-indexed position of the first\noccurrence of substring inside string , or 0 if substring is not\nfound. Usage example: >>> from django.db.models import Value as V >>> from django.db.models.functions import StrIndex >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> Author . objects . create ( name = \"Smith, Margaret\" ) >>> Author . objects . create ( name = \"Margaret Jackson\" ) >>> Author . objects . filter ( name = \"Margaret Jackson\" ) . annotate ( ... smith_index = StrIndex ( \"name\" , V ( \"Smith\" )) ... ) . get () . smith_index 0 >>> authors = Author . objects . annotate ( smith_index = StrIndex ( \"name\" , V ( \"Smith\" ))) . filter ( ... smith_index__gt = 0 ... ) <QuerySet [<Author: Margaret Smith>, <Author: Smith, Margaret>]> Warning In MySQL, a database table’s collation determines\nwhether string comparisons (such as the expression and substring of\nthis function) are case-sensitive. Comparisons are case-insensitive by\ndefault. Substr ¶ class Substr ( expression , pos , length = None , ** extra ) [source] ¶ Returns a substring of length length from the field or expression starting\nat position pos . The position is 1-indexed, so the position must be greater\nthan 0. If length is None , then the rest of the string will be returned. Usage example: >>> # Set the alias to the first 5 characters of the name as lowercase >>> from django.db.models.functions import Lower , Substr >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> Author . objects . update ( alias = Lower ( Substr ( \"name\" , 1 , 5 ))) 1 >>> print ( Author . objects . get ( name = \"Margaret Smith\" ) . alias ) marga Trim ¶ class Trim ( expression , ** extra ) [source] ¶ Returns the value of the given text field or expression with leading and\ntrailing spaces removed. Usage example: >>> from django.db.models.functions import Trim >>> Author . objects . create ( name = \"  John  \" , alias = \"j\" ) >>> Author . objects . update ( name = Trim ( \"name\" )) 1 >>> print ( Author . objects . get ( alias = \"j\" ) . name ) John Upper ¶ class Upper ( expression , ** extra ) [source] ¶ Accepts a single text field or expression and returns the uppercase\nrepresentation. It can also be registered as a transform as described in Length . Usage example: >>> from django.db.models.functions import Upper >>> Author . objects . create ( name = \"Margaret Smith\" ) >>> author = Author . objects . annotate ( name_upper = Upper ( \"name\" )) . get () >>> print ( author . name_upper ) MARGARET SMITH Window functions ¶ There are a number of functions to use in a Window expression for computing the rank\nof elements or the Ntile of some rows. CumeDist ¶ class CumeDist ( * expressions , ** extra ) [source] ¶ Calculates the cumulative distribution of a value within a window or partition.\nThe cumulative distribution is defined as the number of rows preceding or\npeered with the current row divided by the total number of rows in the frame. DenseRank ¶ class DenseRank ( * expressions , ** extra ) [source] ¶ Equivalent to Rank but does not have gaps. FirstValue ¶ class FirstValue ( expression , ** extra ) [source] ¶ Returns the value evaluated at the row that’s the first row of the window\nframe, or None if no such value exists. Lag ¶ class Lag ( expression , offset = 1 , default = None , ** extra ) [source] ¶ Calculates the value offset by offset , and if no row exists there, returns default . default must have the same type as the expression , however, this is\nonly validated by the database and not in Python. MariaDB and default MariaDB doesn’t support the default parameter. LastValue ¶ class LastValue ( expression , ** extra ) [source] ¶ Comparable to FirstValue , it calculates the last value in a given\nframe clause. Lead ¶ class Lead ( expression , offset = 1 , default = None , ** extra ) [source] ¶ Calculates the leading value in a given frame . Both offset and default are evaluated with respect to the current row. default must have the same type as the expression , however, this is\nonly validated by the database and not in Python. MariaDB and default MariaDB doesn’t support the default parameter. NthValue ¶ class NthValue ( expression , nth = 1 , ** extra ) [source] ¶ Computes the row relative to the offset nth (must be a positive value)\nwithin the window. Returns None if no row exists. Some databases may handle a nonexistent nth-value differently. For example,\nOracle returns an empty string rather than None for character-based\nexpressions. Django doesn’t do any conversions in these cases. Ntile ¶ class Ntile ( num_buckets = 1 , ** extra ) [source] ¶ Calculates a partition for each of the rows in the frame clause, distributing\nnumbers as evenly as possible between 1 and num_buckets . If the rows don’t\ndivide evenly into a number of buckets, one or more buckets will be represented\nmore frequently. PercentRank ¶ class PercentRank ( * expressions , ** extra ) [source] ¶ Computes the relative rank of the rows in the frame clause. This computation is\nequivalent to evaluating: (rank - 1) / (total rows - 1) The following table explains the calculation for the relative rank of a row: Row # Value Rank Calculation Relative Rank 1 15 1 (1-1)/(7-1) 0.0000 2 20 2 (2-1)/(7-1) 0.1666 3 20 2 (2-1)/(7-1) 0.1666 4 20 2 (2-1)/(7-1) 0.1666 5 30 5 (5-1)/(7-1) 0.6666 6 30 5 (5-1)/(7-1) 0.6666 7 40 7 (7-1)/(7-1) 1.0000 Rank ¶ class Rank ( * expressions , ** extra ) [source] ¶ Comparable to RowNumber , this function ranks rows in the window. The\ncomputed rank contains gaps. Use DenseRank to compute rank without\ngaps. RowNumber ¶ class RowNumber ( * expressions , ** extra ) [source] ¶ Computes the row number according to the ordering of either the frame clause\nor the ordering of the whole query if there is no partitioning of the window frame .", "keywords": ["aggregations", "users", "rows", "combined_age", "start_2015", "integerfield", "verbose", "extractday", "vectors", "field", "#", "x__abs__lt", "m", "total", "screen_name", "extractisoweekday", "cot", "abc", "abs", "+", "truncyear", "numbers", "tan", "representation", "extractweek", "range", "extractisoyear", "transforms", "trim", "backward", "datefield", "compatibility", "sha1", "y__ln__gt", "msmith", "denserank", "name_lower", "pi", "y_atan", "iso_week_day", "x__asin__lt", "x__exp__gt", "truncation", "-3.0", "hash", "=", "mod", "results", "y__round__lt", "x_ln", "lpad", "nthvalue", "character", "places", "extractweekday", "least", "floor", "substr", "john", "following", "type", "-89.95437383553924", "et", "objects", "partition", "round", "cos", "cases", "start2", "annotations", "warning", "sqrt", "y__ceil__lt", "time", "x__ln__gt", "date", "x_cos", "experiments", "components", "x__tan__lt", "hour", "y__sin__lt", "transform", "x__ceil__lt", "jsonobject", "experiment", "veronika", "auto_now", "extracthour", "name", "signs", "logarithm", "hood", "x__cos__lt", "parameter", "lookup_name='year", "trunc('datetime_field", "smith_index__gt", "backends", "179.9087476710785", "pos", "exp", "age", "monday", "start_datetime__year", "maggie", "versions", "daylight", "+10:00", "truncquarter", "majority", "first_initial", "return", "behaves", "reverse", "computation", "expressions", "x_abs", "value(none", "use_tz", "textfield", "blog", "datetimefield", "examples", "sunday", "y_abs", "age_as_float", "percentrank", "position", "-0.9999999999999986", "x_sign", "abcajohn", "space", "error", "+11:00", "code", "lead", "replaces", "filter", "behavior", "rank", "i", "class", "grouping", "display", "migration", "clause", "combined_age_default", "-0.6358599286615808", "returns", "names", "'", "x", "ceil", "start_datetime", "database", "strindex", "lower", "utc+10:00", "*", "query", "margareth", "x_tan", "postgresql", "jackson", "count", "floatfield", "end_datetime__year", "tangent", "register_lookup", "elements", "subclass", "localtimestamp", "arcsine", "usage", "truncsecond", "max_length", "frame", "rpad", "pgcrypto", "start_date", "e", "collate", "substring", "cast", "source", "converts", "x_acos", "component", "greatest", "b87efd8a6c991c390be5a68e8a7945a7851c7e5c", "truncate", "x__sqrt__lt", "end_time", "use", "left", "replacement", "sum", "author", "subclasses", "arccosine", "random", "y__tan__lt", "similar", "operation", "trunc('time_field", "j", "order", "default", "occurrences", "alias", "upper", "comment", "classes", "expression", "characters", "quarter", "lastvalue", "day", "django.contrib.postgres.functions", "convention", "teragram", "annotate", "considerations", "timezone", "f", "melbourne", "ülle", "y_sqrt", "ord", "x_sin", "caveats", "truncates", "isoyear", "week", "truncweek", "rtrim", "zoneinfo('australia", "way", "x_cot", "johnjohnjohn", "experiments_per_year", "uppercase", "comments", "end_date", "remainder", "transactionnow", "queryset", "start1", "integer", "repeat", "midnight", "expression2", "¶", "rownumber", "spaces", "melb", "precision", "trunchour", "side", "johnson", "function", "math", "goes_by_length", "y_sin", "result", "json_object", "number", "published__lte", "y__floor__gt", "right", "y_cos", "point", "datetimes", "x__radians__lt", "values", "ursula", "string", "y_ceil", "_", "order_by", "goes_by", "databases", "timestamp", "degrees", "extracts", "unit", "smith_index", "extractsecond", "table", "x_asin", "models", "dates", "nth", "sin", "y_exp", "json", "week_day", "cosine", "article", "start3", "x__sin__lt", "django", "sales", "n’t", "fields", "print", "truncdate", "coalesce", "conversions", "acos", "power", "lowercase", "override", "value", "truncminute", "name_length", "data", "isoweekday", "datetime", "base", "x_exp", "sha256", "trunctime", "cryptoextension", "output_field", "trunc", "extension", "calculates", "749fb689816b2db85f5b169c2055b247", "-0.14550003380861354", "sha224", "atan", "unicode", "respect", "y__radians__lt", "thursday", "start", "concat", "issues", "name__length__gt", "arctangent", "y__cot__lt", "experiments_per_hour", "fill_text", "tzinfo", "part", "object", "h", "icu", "calculation", "charfield", "partitioning", "lookup_name", "sql", "-0.7457052121767203", "truncmonth", "≤", "authors", "y_tan", "name_sha1", "pairs", "x__atan__lt", "minute", "replace", "s", "extractyear", "y__abs__lt", "ordering", "conversion", "y_ln", "root", "name_code_point", "rest", "v", "-2.4", "varies", "y__cos__lt", "filtering", "ln", "second", "iso-8601", "lookup_type", "comparisons", "truncday", "sine", "zoneinfo", "numbering", "y__exp__gt", "saturday", "radians", "addition", "example", "window", "month", "sha512", "list", "collation", "asin", "chr", "utc", "extractquarter", "x__cot__lt", "cube", "x__round__lt", "x__degrees__lt", "extractminute", "vector", "md5", "model", "name_md5", "year", "django.db.models.functions", "lag", "relative", "start_day", "timefield", "y", "occurrence", "log", "y_asin", "case", "equivalent", "length", "lookup", "null", "screen", "server", "modulo", "arguments", "one", "end", "experiments_per_day", "sqlite", "comparison", "expression1", "nullif", "gaps", "ltrim", "extract", "kind", "functions", "extractmonth", "update", "firstvalue", "none", "filters", "x__acos__lt", "sha384", "distribution", "sign", "mariadb", "durationfield", "y__sign__lt", "margaret", "trunc('date_field", "combined_age_coalesce", "experiments_per_month", "end_datetime", "char", "priority", "-", "django.utils", "offset", "saving", "import", "d", "y__atan__lt", "buckets", "mysql", ">", "%", "pads", "π", "foreignkey", "ntile", "row", "in", "python", "start_time", "times", "exception", "atan2", "forces", "transaction", "argument", "days", "x__floor__gt", "body", "oracle", "smith", "num_buckets", "weekday", "cumedist", "text", "australia", "cotangent", "parts"], "type": "documentation"},
{"title": "Using the Django authentication system | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/auth/default/", "content": "Using the Django authentication system ¶ This document explains the usage of Django’s authentication system in its\ndefault configuration. This configuration has evolved to serve the most common\nproject needs, handling a reasonably wide range of tasks, and has a careful\nimplementation of passwords and permissions. For projects where authentication\nneeds differ from the default, Django supports extensive extension and\ncustomization of authentication. Django authentication provides both authentication and authorization together\nand is generally referred to as the authentication system, as these features\nare somewhat coupled. User objects ¶ User objects are the core of the\nauthentication system. They typically represent the people interacting with\nyour site and are used to enable things like restricting access, registering\nuser profiles, associating content with creators etc. Only one class of user\nexists in Django’s authentication framework, i.e., 'superusers' or admin 'staff' users are just user objects with\nspecial attributes set, not different classes of user objects. The primary attributes of the default user are: username password email first_name last_name See the full API documentation for\nfull reference, the documentation that follows is more task oriented. Creating users ¶ The most direct way to create users is to use the included create_user() helper function: >>> from django.contrib.auth.models import User >>> user = User . objects . create_user ( \"john\" , \"lennon@thebeatles.com\" , \"johnpassword\" ) # At this point, user is a User object that has already been saved # to the database. You can continue to change its attributes # if you want to change other fields. >>> user . last_name = \"Lennon\" >>> user . save () If you have the Django admin installed, you can also create users\ninteractively . Creating superusers ¶ Create superusers using the createsuperuser command: /  $ python manage.py createsuperuser --username = joe --email = joe@example.com ...\\> py manage.py createsuperuser --username=joe --email=joe@example.com You will be prompted for a password. After you enter one, the user will be\ncreated immediately. If you leave off the --username or --email options, it will\nprompt you for those values. Changing passwords ¶ Django does not store raw (clear text) passwords on the user model, but only\na hash (see documentation of how passwords are managed for full details). Because of this, do not attempt to\nmanipulate the password attribute of the user directly. This is why a helper\nfunction is used when creating a user. To change a user’s password, you have several options: manage.py changepassword *username* offers a method\nof changing a user’s password from the command line. It prompts you to\nchange the password of a given user which you must enter twice. If\nthey both match, the new password will be changed immediately. If you\ndo not supply a user, the command will attempt to change the password\nwhose username matches the current system user. You can also change a password programmatically, using set_password() : >>> from django.contrib.auth.models import User >>> u = User . objects . get ( username = \"john\" ) >>> u . set_password ( \"new password\" ) >>> u . save () If you have the Django admin installed, you can also change user’s passwords\non the authentication system’s admin pages . Django also provides views and forms that may be used to allow users to change their own\npasswords. Changing a user’s password will log out all their sessions. See Session invalidation on password change for details. Authenticating users ¶ authenticate ( request = None , ** credentials ) [source] ¶ aauthenticate ( request = None , ** credentials ) ¶ Asynchronous version : aauthenticate() Use authenticate() to verify a set of\ncredentials. It takes credentials as keyword arguments, username and password for the default case, checks them against each authentication backend , and returns a User object if the credentials are\nvalid for a backend. If the credentials aren’t valid for any backend or if\na backend raises PermissionDenied , it\nreturns None . For example: from django.contrib.auth import authenticate user = authenticate ( username = \"john\" , password = \"secret\" ) if user is not None : # A backend authenticated the credentials ... else : # No backend authenticated the credentials ... request is an optional HttpRequest which is\npassed on the authenticate() method of the authentication backends. Note This is a low level way to authenticate a set of credentials; for\nexample, it’s used by the RemoteUserMiddleware . Unless\nyou are writing your own authentication system, you probably won’t use\nthis. Rather if you’re looking for a way to login a user, use the LoginView . Changed in Django 5.0: aauthenticate() function was added. Permissions and Authorization ¶ Django comes with a built-in permissions system. It provides a way to assign\npermissions to specific users and groups of users. It’s used by the Django admin site, but you’re welcome to use it in your own\ncode. The Django admin site uses permissions as follows: Access to view objects is limited to users with the “view” or “change”\npermission for that type of object. Access to view the “add” form and add an object is limited to users with\nthe “add” permission for that type of object. Access to view the change list, view the “change” form and change an\nobject is limited to users with the “change” permission for that type of\nobject. Access to delete an object is limited to users with the “delete”\npermission for that type of object. Permissions can be set not only per type of object, but also per specific\nobject instance. By using the has_view_permission() , has_add_permission() , has_change_permission() and has_delete_permission() methods provided\nby the ModelAdmin class, it is possible to\ncustomize permissions for different object instances of the same type. User objects have two many-to-many\nfields: groups and user_permissions . User objects can access their related\nobjects in the same way as any other Django model : myuser . groups . set ([ group_list ]) myuser . groups . add ( group , group , ... ) myuser . groups . remove ( group , group , ... ) myuser . groups . clear () myuser . user_permissions . set ([ permission_list ]) myuser . user_permissions . add ( permission , permission , ... ) myuser . user_permissions . remove ( permission , permission , ... ) myuser . user_permissions . clear () Default permissions ¶ When django.contrib.auth is listed in your INSTALLED_APPS setting, it will ensure that four default permissions – add, change, delete,\nand view – are created for each Django model defined in one of your installed\napplications. These permissions will be created when you run manage.py migrate ; the first time you run migrate after adding django.contrib.auth to INSTALLED_APPS , the default permissions\nwill be created for all previously-installed models, as well as for any new\nmodels being installed at that time. Afterward, it will create default\npermissions for new models each time you run manage.py migrate (the function that creates permissions is connected to the post_migrate signal). Assuming you have an application with an app_label foo and a model named Bar ,\nto test for basic permissions you should use: add: user.has_perm('foo.add_bar') change: user.has_perm('foo.change_bar') delete: user.has_perm('foo.delete_bar') view: user.has_perm('foo.view_bar') The Permission model is rarely accessed\ndirectly. Groups ¶ django.contrib.auth.models.Group models are a generic way of\ncategorizing users so you can apply permissions, or some other label, to those\nusers. A user can belong to any number of groups. A user in a group automatically has the permissions granted to that group. For\nexample, if the group Site editors has the permission can_edit_home_page , any user in that group will have that permission. Beyond permissions, groups are a convenient way to categorize users to give\nthem some label, or extended functionality. For example, you could create a\ngroup 'Special users' , and you could write code that could, say, give them\naccess to a members-only portion of your site, or send them members-only email\nmessages. Programmatically creating permissions ¶ While custom permissions can be defined within\na model’s Meta class, you can also create permissions directly. For\nexample, you can create the can_publish permission for a BlogPost model\nin myapp : from myapp.models import BlogPost from django.contrib.auth.models import Permission from django.contrib.contenttypes.models import ContentType content_type = ContentType . objects . get_for_model ( BlogPost ) permission = Permission . objects . create ( codename = \"can_publish\" , name = \"Can Publish Posts\" , content_type = content_type , ) The permission can then be assigned to a User via its user_permissions attribute or to a Group via its permissions attribute. Proxy models need their own content type If you want to create permissions for a proxy model , pass for_concrete_model=False to ContentTypeManager.get_for_model() to get the appropriate ContentType : content_type = ContentType . objects . get_for_model ( BlogPostProxy , for_concrete_model = False ) Permission caching ¶ The ModelBackend caches permissions on\nthe user object after the first time they need to be fetched for a permissions\ncheck. This is typically fine for the request-response cycle since permissions\naren’t typically checked immediately after they are added (in the admin, for\nexample). If you are adding permissions and checking them immediately\nafterward, in a test or view for example, the easiest solution is to re-fetch\nthe user from the database. For example: from django.contrib.auth.models import Permission , User from django.contrib.contenttypes.models import ContentType from django.shortcuts import get_object_or_404 from myapp.models import BlogPost def user_gains_perms ( request , user_id ): user = get_object_or_404 ( User , pk = user_id ) # any permission check will cache the current set of permissions user . has_perm ( \"myapp.change_blogpost\" ) content_type = ContentType . objects . get_for_model ( BlogPost ) permission = Permission . objects . get ( codename = \"change_blogpost\" , content_type = content_type , ) user . user_permissions . add ( permission ) # Checking the cached permission set user . has_perm ( \"myapp.change_blogpost\" ) # False # Request new instance of User # Be aware that user.refresh_from_db() won't clear the cache. user = get_object_or_404 ( User , pk = user_id ) # Permission cache is repopulated from the database user . has_perm ( \"myapp.change_blogpost\" ) # True ... Proxy models ¶ Proxy models work exactly the same way as concrete models. Permissions are\ncreated using the own content type of the proxy model. Proxy models don’t\ninherit the permissions of the concrete model they subclass: class Person ( models . Model ): class Meta : permissions = [( \"can_eat_pizzas\" , \"Can eat pizzas\" )] class Student ( Person ): class Meta : proxy = True permissions = [( \"can_deliver_pizzas\" , \"Can deliver pizzas\" )] >>> # Fetch the content type for the proxy model. >>> content_type = ContentType . objects . get_for_model ( Student , for_concrete_model = False ) >>> student_permissions = Permission . objects . filter ( content_type = content_type ) >>> [ p . codename for p in student_permissions ] ['add_student', 'change_student', 'delete_student', 'view_student', 'can_deliver_pizzas'] >>> for permission in student_permissions : ... user . user_permissions . add ( permission ) ... >>> user . has_perm ( \"app.add_person\" ) False >>> user . has_perm ( \"app.can_eat_pizzas\" ) False >>> user . has_perms (( \"app.add_student\" , \"app.can_deliver_pizzas\" )) True Authentication in web requests ¶ Django uses sessions and middleware to hook the\nauthentication system into request objects . These provide a request.user attribute\nand a request.auser async method\non every request which represents the current user. If the current user has not\nlogged in, this attribute will be set to an instance\nof AnonymousUser , otherwise it will be an\ninstance of User . You can tell them apart with is_authenticated , like so: if request . user . is_authenticated : # Do something for authenticated users. ... else : # Do something for anonymous users. ... Or in an asynchronous view: user = await request . auser () if user . is_authenticated : # Do something for authenticated users. ... else : # Do something for anonymous users. ... Changed in Django 5.0: The HttpRequest.auser() method was added. How to log a user in ¶ If you have an authenticated user you want to attach to the current session\n- this is done with a login() function. login ( request , user , backend = None ) [source] ¶ alogin ( request , user , backend = None ) ¶ Asynchronous version : alogin() To log a user in, from a view, use login() . It\ntakes an HttpRequest object and a User object. login() saves the user’s ID in the session,\nusing Django’s session framework. Note that any data set during the anonymous session is retained in the\nsession after a user logs in. This example shows how you might use both authenticate() and login() : from django.contrib.auth import authenticate , login def my_view ( request ): username = request . POST [ \"username\" ] password = request . POST [ \"password\" ] user = authenticate ( request , username = username , password = password ) if user is not None : login ( request , user ) # Redirect to a success page. ... else : # Return an 'invalid login' error message. ... Changed in Django 5.0: alogin() function was added. Selecting the authentication backend ¶ When a user logs in, the user’s ID and the backend that was used for\nauthentication are saved in the user’s session. This allows the same authentication backend to fetch the user’s\ndetails on a future request. The authentication backend to save in the session\nis selected as follows: Use the value of the optional backend argument, if provided. Use the value of the user.backend attribute, if present. This allows\npairing authenticate() and login() : authenticate() sets the user.backend attribute on the user object it returns. Use the backend in AUTHENTICATION_BACKENDS , if there is only\none. Otherwise, raise an exception. In cases 1 and 2, the value of the backend argument or the user.backend attribute should be a dotted import path string (like that found in AUTHENTICATION_BACKENDS ), not the actual backend class. How to log a user out ¶ logout ( request ) [source] ¶ alogout ( request ) ¶ Asynchronous version : alogout() To log out a user who has been logged in via django.contrib.auth.login() , use django.contrib.auth.logout() within your view. It takes an HttpRequest object and has no return value.\nExample: from django.contrib.auth import logout def logout_view ( request ): logout ( request ) # Redirect to a success page. Note that logout() doesn’t throw any errors if\nthe user wasn’t logged in. When you call logout() , the session data for\nthe current request is completely cleaned out. All existing data is\nremoved. This is to prevent another person from using the same web browser\nto log in and have access to the previous user’s session data. If you want\nto put anything into the session that will be available to the user\nimmediately after logging out, do that after calling django.contrib.auth.logout() . Changed in Django 5.0: alogout() function was added. Limiting access to logged-in users ¶ The raw way ¶ The raw way to limit access to pages is to check request.user.is_authenticated and either redirect to a\nlogin page: from django.conf import settings from django.shortcuts import redirect def my_view ( request ): if not request . user . is_authenticated : return redirect ( f \" { settings . LOGIN_URL } ?next= { request . path } \" ) # ... …or display an error message: from django.shortcuts import render def my_view ( request ): if not request . user . is_authenticated : return render ( request , \"myapp/login_error.html\" ) # ... The login_required decorator ¶ login_required ( redirect_field_name = 'next' , login_url = None ) [source] ¶ As a shortcut, you can use the convenient login_required() decorator: from django.contrib.auth.decorators import login_required @login_required def my_view ( request ): ... login_required() does the following: If the user isn’t logged in, redirect to settings.LOGIN_URL , passing the current absolute\npath in the query string. Example: /accounts/login/?next=/polls/3/ . If the user is logged in, execute the view normally. The view code is\nfree to assume the user is logged in. By default, the path that the user should be redirected to upon\nsuccessful authentication is stored in a query string parameter called \"next\" . If you would prefer to use a different name for this parameter, login_required() takes an\noptional redirect_field_name parameter: from django.contrib.auth.decorators import login_required @login_required ( redirect_field_name = \"my_redirect_field\" ) def my_view ( request ): ... Note that if you provide a value to redirect_field_name , you will most\nlikely need to customize your login template as well, since the template\ncontext variable which stores the redirect path will use the value of redirect_field_name as its key rather than \"next\" (the default). login_required() also takes an\noptional login_url parameter. Example: from django.contrib.auth.decorators import login_required @login_required ( login_url = \"/accounts/login/\" ) def my_view ( request ): ... Note that if you don’t specify the login_url parameter, you’ll need to\nensure that the settings.LOGIN_URL and your login\nview are properly associated. For example, using the defaults, add the\nfollowing lines to your URLconf: from django.contrib.auth import views as auth_views path ( \"accounts/login/\" , auth_views . LoginView . as_view ()), The settings.LOGIN_URL also accepts view function\nnames and named URL patterns . This allows you\nto freely remap your login view within your URLconf without having to\nupdate the setting. Note The login_required decorator does NOT check the is_active flag on a\nuser, but the default AUTHENTICATION_BACKENDS reject inactive\nusers. See also If you are writing custom views for Django’s admin (or need the same\nauthorization check that the built-in views use), you may find the django.contrib.admin.views.decorators.staff_member_required() decorator a useful alternative to login_required() . Changed in Django 5.1: Support for wrapping asynchronous view functions was added. The LoginRequiredMixin mixin ¶ When using class-based views , you can\nachieve the same behavior as with login_required by using the LoginRequiredMixin . This mixin should be at the leftmost position in the\ninheritance list. class LoginRequiredMixin [source] ¶ If a view is using this mixin, all requests by non-authenticated users will\nbe redirected to the login page or shown an HTTP 403 Forbidden error,\ndepending on the raise_exception parameter. You can set any of the parameters of AccessMixin to customize the handling\nof unauthorized users: from django.contrib.auth.mixins import LoginRequiredMixin class MyView ( LoginRequiredMixin , View ): login_url = \"/login/\" redirect_field_name = \"redirect_to\" Note Just as the login_required decorator, this mixin does NOT check the is_active flag on a user, but the default AUTHENTICATION_BACKENDS reject inactive users. The login_not_required decorator ¶ New in Django 5.1. When LoginRequiredMiddleware is\ninstalled, all views require authentication by default. Some views, such as the\nlogin view, may need to disable this behavior. login_not_required () [source] ¶ Allows unauthenticated requests to this view when LoginRequiredMiddleware is\ninstalled. Limiting access to logged-in users that pass a test ¶ To limit access based on certain permissions or some other test, you’d do\nessentially the same thing as described in the previous section. You can run your test on request.user in\nthe view directly. For example, this view checks to make sure the user has an\nemail in the desired domain and if not, redirects to the login page: from django.shortcuts import redirect def my_view ( request ): if not request . user . email . endswith ( \"@example.com\" ): return redirect ( \"/login/?next= %s \" % request . path ) # ... user_passes_test ( test_func , login_url = None , redirect_field_name = 'next' ) [source] ¶ As a shortcut, you can use the convenient user_passes_test decorator\nwhich performs a redirect when the callable returns False : from django.contrib.auth.decorators import user_passes_test def email_check ( user ): return user . email . endswith ( \"@example.com\" ) @user_passes_test ( email_check ) def my_view ( request ): ... user_passes_test() takes a required\nargument: a callable that takes a User object and returns True if\nthe user is allowed to view the page. Note that user_passes_test() does not\nautomatically check that the User is\nnot anonymous. user_passes_test() takes two\noptional arguments: login_url Lets you specify the URL that users who don’t pass the test will be\nredirected to. It may be a login page and defaults to settings.LOGIN_URL if you don’t specify one. redirect_field_name Same as for login_required() .\nSetting it to None removes it from the URL, which you may want to do\nif you are redirecting users that don’t pass the test to a non-login\npage where there’s no “next page”. For example: @user_passes_test ( email_check , login_url = \"/login/\" ) def my_view ( request ): ... Changed in Django 5.1: Support for wrapping asynchronous view functions and using asynchronous\ntest callables was added. class UserPassesTestMixin [source] ¶ When using class-based views , you\ncan use the UserPassesTestMixin to do this. test_func () [source] ¶ You have to override the test_func() method of the class to\nprovide the test that is performed. Furthermore, you can set any of the\nparameters of AccessMixin to\ncustomize the handling of unauthorized users: from django.contrib.auth.mixins import UserPassesTestMixin class MyView ( UserPassesTestMixin , View ): def test_func ( self ): return self . request . user . email . endswith ( \"@example.com\" ) get_test_func () [source] ¶ You can also override the get_test_func() method to have the mixin\nuse a differently named function for its checks (instead of test_func() ). Stacking UserPassesTestMixin Due to the way UserPassesTestMixin is implemented, you cannot stack\nthem in your inheritance list. The following does NOT work: class TestMixin1 ( UserPassesTestMixin ): def test_func ( self ): return self . request . user . email . endswith ( \"@example.com\" ) class TestMixin2 ( UserPassesTestMixin ): def test_func ( self ): return self . request . user . username . startswith ( \"django\" ) class MyView ( TestMixin1 , TestMixin2 , View ): ... If TestMixin1 would call super() and take that result into\naccount, TestMixin1 wouldn’t work standalone anymore. The permission_required decorator ¶ permission_required ( perm , login_url = None , raise_exception = False ) [source] ¶ It’s a relatively common task to check whether a user has a particular\npermission. For that reason, Django provides a shortcut for that case: the permission_required() decorator: from django.contrib.auth.decorators import permission_required @permission_required ( \"polls.add_choice\" ) def my_view ( request ): ... Just like the has_perm() method,\npermission names take the form \"<app label>.<permission codename>\" (i.e. polls.add_choice for a permission on a model in the polls application). The decorator may also take an iterable of permissions, in which case the\nuser must have all of the permissions in order to access the view. Note that permission_required() also takes an optional login_url parameter: from django.contrib.auth.decorators import permission_required @permission_required ( \"polls.add_choice\" , login_url = \"/loginpage/\" ) def my_view ( request ): ... As in the login_required() decorator, login_url defaults to settings.LOGIN_URL . If the raise_exception parameter is given, the decorator will raise PermissionDenied , prompting the 403\n(HTTP Forbidden) view instead of redirecting to the\nlogin page. If you want to use raise_exception but also give your users a chance to\nlogin first, you can add the login_required() decorator: from django.contrib.auth.decorators import login_required , permission_required @login_required @permission_required ( \"polls.add_choice\" , raise_exception = True ) def my_view ( request ): ... This also avoids a redirect loop when LoginView ’s redirect_authenticated_user=True and the logged-in user doesn’t have\nall of the required permissions. Changed in Django 5.1: Support for wrapping asynchronous view functions was added. The PermissionRequiredMixin mixin ¶ To apply permission checks to class-based views , you can use the PermissionRequiredMixin : class PermissionRequiredMixin [source] ¶ This mixin, just like the permission_required decorator, checks whether the user accessing a view has all given\npermissions. You should specify the permission (or an iterable of\npermissions) using the permission_required parameter: from django.contrib.auth.mixins import PermissionRequiredMixin class MyView ( PermissionRequiredMixin , View ): permission_required = \"polls.add_choice\" # Or multiple of permissions: permission_required = [ \"polls.view_choice\" , \"polls.change_choice\" ] You can set any of the parameters of AccessMixin to customize the handling\nof unauthorized users. You may also override these methods: get_permission_required () [source] ¶ Returns an iterable of permission names used by the mixin. Defaults to\nthe permission_required attribute, converted to a tuple if\nnecessary. has_permission () [source] ¶ Returns a boolean denoting whether the current user has permission to\nexecute the decorated view. By default, this returns the result of\ncalling has_perms() with the\nlist of permissions returned by get_permission_required() . Redirecting unauthorized requests in class-based views ¶ To ease the handling of access restrictions in class-based views , the AccessMixin can be used to configure\nthe behavior of a view when access is denied. Authenticated users are denied\naccess with an HTTP 403 Forbidden response. Anonymous users are redirected to\nthe login page or shown an HTTP 403 Forbidden response, depending on the raise_exception attribute. class AccessMixin [source] ¶ login_url ¶ Default return value for get_login_url() .  Defaults to None in which case get_login_url() falls back to settings.LOGIN_URL . permission_denied_message ¶ Default return value for get_permission_denied_message() .\nDefaults to an empty string. redirect_field_name ¶ Default return value for get_redirect_field_name() . Defaults to \"next\" . raise_exception ¶ If this attribute is set to True , a PermissionDenied exception is raised\nwhen the conditions are not met.  When False (the default),\nanonymous users are redirected to the login page. get_login_url () [source] ¶ Returns the URL that users who don’t pass the test will be redirected\nto. Returns login_url if set, or settings.LOGIN_URL otherwise. get_permission_denied_message () [source] ¶ When raise_exception is True , this method can be used to\ncontrol the error message passed to the error handler for display to\nthe user. Returns the permission_denied_message attribute by\ndefault. get_redirect_field_name () [source] ¶ Returns the name of the query parameter that will contain the URL the\nuser should be redirected to after a successful login. If you set this\nto None , a query parameter won’t be added. Returns the redirect_field_name attribute by default. handle_no_permission () [source] ¶ Depending on the value of raise_exception , the method either raises\na PermissionDenied exception or\nredirects the user to the login_url , optionally including the redirect_field_name if it is set. Session invalidation on password change ¶ If your AUTH_USER_MODEL inherits from AbstractBaseUser or implements its own get_session_auth_hash() method, authenticated sessions will include the hash returned by this function.\nIn the AbstractBaseUser case, this is an\nHMAC of the password field. Django verifies that the hash in the session for\neach request matches the one that’s computed during the request. This allows a\nuser to log out all of their sessions by changing their password. The default password change views included with Django, PasswordChangeView and the user_change_password view in the django.contrib.auth admin, update\nthe session with the new password hash so that a user changing their own\npassword won’t log themselves out. If you have a custom password change view\nand wish to have similar behavior, use the update_session_auth_hash() function. update_session_auth_hash ( request , user ) [source] ¶ aupdate_session_auth_hash ( request , user ) ¶ Asynchronous version : aupdate_session_auth_hash() This function takes the current request and the updated user object from\nwhich the new session hash will be derived and updates the session hash\nappropriately. It also rotates the session key so that a stolen session\ncookie will be invalidated. Example usage: from django.contrib.auth import update_session_auth_hash def password_change ( request ): if request . method == \"POST\" : form = PasswordChangeForm ( user = request . user , data = request . POST ) if form . is_valid (): form . save () update_session_auth_hash ( request , form . user ) else : ... Changed in Django 5.0: aupdate_session_auth_hash() function was added. Note Since get_session_auth_hash() is based on SECRET_KEY , secret key values must be\nrotated to avoid invalidating existing sessions when updating your site to\nuse a new secret. See SECRET_KEY_FALLBACKS for details. Authentication Views ¶ Django provides several views that you can use for handling login, logout, and\npassword management. These make use of the stock auth forms but you can pass in your own forms as well. Django provides no default template for the authentication views. You should\ncreate your own templates for the views you want to use. The template context\nis documented in each view, see All authentication views . Using the views ¶ There are different methods to implement these views in your project. The\neasiest way is to include the provided URLconf in django.contrib.auth.urls in your own URLconf, for example: urlpatterns = [ path ( \"accounts/\" , include ( \"django.contrib.auth.urls\" )), ] This will include the following URL patterns: accounts/login/ [name='login']\naccounts/logout/ [name='logout']\naccounts/password_change/ [name='password_change']\naccounts/password_change/done/ [name='password_change_done']\naccounts/password_reset/ [name='password_reset']\naccounts/password_reset/done/ [name='password_reset_done']\naccounts/reset/<uidb64>/<token>/ [name='password_reset_confirm']\naccounts/reset/done/ [name='password_reset_complete'] The views provide a URL name for easier reference. See the URL\ndocumentation for details on using named URL patterns. If you want more control over your URLs, you can reference a specific view in\nyour URLconf: from django.contrib.auth import views as auth_views urlpatterns = [ path ( \"change-password/\" , auth_views . PasswordChangeView . as_view ()), ] The views have optional arguments you can use to alter the behavior of the\nview. For example, if you want to change the template name a view uses, you can\nprovide the template_name argument. A way to do this is to provide keyword\narguments in the URLconf, these will be passed on to the view. For example: urlpatterns = [ path ( \"change-password/\" , auth_views . PasswordChangeView . as_view ( template_name = \"change-password.html\" ), ), ] All views are class-based , which allows\nyou to easily customize them by subclassing. All authentication views ¶ This is a list with all the views django.contrib.auth provides. For\nimplementation details see Using the views . class LoginView [source] ¶ URL name: login See the URL documentation for details on using\nnamed URL patterns. Methods and Attributes template_name ¶ The name of a template to display for the view used to log the user in.\nDefaults to registration/login.html . next_page ¶ The URL to redirect to after login. Defaults to LOGIN_REDIRECT_URL . redirect_field_name ¶ The name of a GET field containing the URL to redirect to after\nlogin. Defaults to next . Overrides the get_default_redirect_url() URL if the given GET parameter is\npassed. authentication_form ¶ A callable (typically a form class) to use for authentication. Defaults\nto AuthenticationForm . extra_context ¶ A dictionary of context data that will be added to the default context\ndata passed to the template. redirect_authenticated_user ¶ A boolean that controls whether or not authenticated users accessing\nthe login page will be redirected as if they had just successfully\nlogged in. Defaults to False . Warning If you enable redirect_authenticated_user , other websites will\nbe able to determine if their visitors are authenticated on your\nsite by requesting redirect URLs to image files on your website. To\navoid this “ social media fingerprinting ” information\nleakage, host all images and your favicon on a separate domain. Enabling redirect_authenticated_user can also result in a\nredirect loop when using the permission_required() decorator\nunless the raise_exception parameter is used. success_url_allowed_hosts ¶ A set of hosts, in addition to request.get_host() , that are safe for redirecting\nafter login. Defaults to an empty set . get_default_redirect_url () [source] ¶ Returns the URL to redirect to after login. The default implementation\nresolves and returns next_page if set, or LOGIN_REDIRECT_URL otherwise. Here’s what LoginView does: If called via GET , it displays a login form that POSTs to the\nsame URL. More on this in a bit. If called via POST with user submitted credentials, it tries to log\nthe user in. If login is successful, the view redirects to the URL\nspecified in next . If next isn’t provided, it redirects to settings.LOGIN_REDIRECT_URL (which\ndefaults to /accounts/profile/ ). If login isn’t successful, it\nredisplays the login form. It’s your responsibility to provide the html for the login template\n, called registration/login.html by default. This template gets passed\nfour template context variables: form : A Form object representing the AuthenticationForm . next : The URL to redirect to after successful login. This may\ncontain a query string, too. site : The current Site ,\naccording to the SITE_ID setting. If you don’t have the\nsite framework installed, this will be set to an instance of RequestSite , which derives the\nsite name and domain from the current HttpRequest . site_name : An alias for site.name . If you don’t have the site\nframework installed, this will be set to the value of request.META['SERVER_NAME'] .\nFor more on sites, see The “sites” framework . If you’d prefer not to call the template registration/login.html ,\nyou can pass the template_name parameter via the extra arguments to\nthe as_view method in your URLconf. For example, this URLconf line would\nuse myapp/login.html instead: path ( \"accounts/login/\" , auth_views . LoginView . as_view ( template_name = \"myapp/login.html\" )), You can also specify the name of the GET field which contains the URL\nto redirect to after login using redirect_field_name . By default, the\nfield is called next . Here’s a sample registration/login.html template you can use as a\nstarting point. It assumes you have a base.html template that\ndefines a content block: {% extends \"base.html\" %} {% block content %} {% if form.errors %} < p > Your username and password didn't match. Please try again. </ p > {% endif %} {% if next %} {% if user.is_authenticated %} < p > Your account doesn't have access to this page. To proceed,\n    please login with an account that has access. </ p > {% else %} < p > Please login to see this page. </ p > {% endif %} {% endif %} < form method = \"post\" action = \" {% url 'login' %} \" > {% csrf_token %} < table > < tr > < td > {{ form.username.label_tag }} </ td > < td > {{ form.username }} </ td > </ tr > < tr > < td > {{ form.password.label_tag }} </ td > < td > {{ form.password }} </ td > </ tr > </ table > < input type = \"submit\" value = \"login\" > < input type = \"hidden\" name = \"next\" value = \" {{ next }} \" > </ form > {# Assumes you set up the password_reset view in your URLconf #} < p >< a href = \" {% url 'password_reset' %} \" > Lost password? </ a ></ p > {% endblock %} If you have customized authentication (see Customizing Authentication ) you can use a custom authentication form by\nsetting the authentication_form attribute. This form must accept a request keyword argument in its __init__() method and provide a get_user() method which returns the authenticated user object (this\nmethod is only ever called after successful form validation). class LogoutView [source] ¶ Logs a user out on POST requests. URL name: logout Attributes: next_page ¶ The URL to redirect to after logout. Defaults to LOGOUT_REDIRECT_URL . template_name ¶ The full name of a template to display after logging the user out.\nDefaults to registration/logged_out.html . redirect_field_name ¶ The name of a GET field containing the URL to redirect to after log\nout. Defaults to 'next' . Overrides the next_page URL if the given GET parameter is\npassed. extra_context ¶ A dictionary of context data that will be added to the default context\ndata passed to the template. success_url_allowed_hosts ¶ A set of hosts, in addition to request.get_host() , that are safe for redirecting\nafter logout. Defaults to an empty set . Template context: title : The string “Logged out”, localized. site : The current Site ,\naccording to the SITE_ID setting. If you don’t have the\nsite framework installed, this will be set to an instance of RequestSite , which derives the\nsite name and domain from the current HttpRequest . site_name : An alias for site.name . If you don’t have the site\nframework installed, this will be set to the value of request.META['SERVER_NAME'] .\nFor more on sites, see The “sites” framework . logout_then_login ( request , login_url = None ) [source] ¶ Logs a user out on POST requests, then redirects to the login page. URL name: No default URL provided Optional arguments: login_url : The URL of the login page to redirect to.\nDefaults to settings.LOGIN_URL if not supplied. class PasswordChangeView [source] ¶ URL name: password_change Allows a user to change their password. Attributes: template_name ¶ The full name of a template to use for displaying the password change\nform. Defaults to registration/password_change_form.html if not\nsupplied. success_url ¶ The URL to redirect to after a successful password change. Defaults to 'password_change_done' . form_class ¶ A custom “change password” form which must accept a user keyword\nargument. The form is responsible for actually changing the user’s\npassword. Defaults to PasswordChangeForm . extra_context ¶ A dictionary of context data that will be added to the default context\ndata passed to the template. Template context: form : The password change form (see form_class above). class PasswordChangeDoneView [source] ¶ URL name: password_change_done The page shown after a user has changed their password. Attributes: template_name ¶ The full name of a template to use. Defaults to registration/password_change_done.html if not supplied. extra_context ¶ A dictionary of context data that will be added to the default context\ndata passed to the template. class PasswordResetView [source] ¶ URL name: password_reset Allows a user to reset their password by generating a one-time use link\nthat can be used to reset the password, and sending that link to the\nuser’s registered email address. This view will send an email if the following conditions are met: The email address provided exists in the system. The requested user is active ( User.is_active is True ). The requested user has a usable password. Users flagged with an unusable\npassword (see set_unusable_password() ) aren’t\nallowed to request a password reset to prevent misuse when using an\nexternal authentication source like LDAP. If any of these conditions are not met, no email will be sent, but the\nuser won’t receive any error message either. This prevents information\nleaking to potential attackers. If you want to provide an error message in\nthis case, you can subclass PasswordResetForm and use the form_class attribute. Note Be aware that sending an email costs extra time, hence you may be\nvulnerable to an email address enumeration timing attack due to a\ndifference between the duration of a reset request for an existing\nemail address and the duration of a reset request for a nonexistent\nemail address. To reduce the overhead, you can use a 3rd party package\nthat allows to send emails asynchronously, e.g. django-mailer . Attributes: template_name ¶ The full name of a template to use for displaying the password reset\nform. Defaults to registration/password_reset_form.html if not\nsupplied. form_class ¶ Form that will be used to get the email of the user to reset the\npassword for. Defaults to PasswordResetForm . email_template_name ¶ The full name of a template to use for generating the email with the\nreset password link. Defaults to registration/password_reset_email.html if not supplied. subject_template_name ¶ The full name of a template to use for the subject of the email with\nthe reset password link. Defaults to registration/password_reset_subject.txt if not supplied. token_generator ¶ Instance of the class to check the one time link. This will default to default_token_generator , it’s an instance of django.contrib.auth.tokens.PasswordResetTokenGenerator . success_url ¶ The URL to redirect to after a successful password reset request.\nDefaults to 'password_reset_done' . from_email ¶ A valid email address. By default Django uses the DEFAULT_FROM_EMAIL . extra_context ¶ A dictionary of context data that will be added to the default context\ndata passed to the template. html_email_template_name ¶ The full name of a template to use for generating a text/html multipart email with the password reset link. By\ndefault, HTML email is not sent. extra_email_context ¶ A dictionary of context data that will be available in the email\ntemplate. It can be used to override default template context values\nlisted below e.g. domain . Template context: form : The form (see form_class above) for resetting the user’s\npassword. Email template context: email : An alias for user.email user : The current User ,\naccording to the email form field. Only active users are able to\nreset their passwords ( User.is_active is True ). site_name : An alias for site.name . If you don’t have the site\nframework installed, this will be set to the value of request.META['SERVER_NAME'] .\nFor more on sites, see The “sites” framework . domain : An alias for site.domain . If you don’t have the site\nframework installed, this will be set to the value of request.get_host() . protocol : http or https uid : The user’s primary key encoded in base 64. token : Token to check that the reset link is valid. Sample registration/password_reset_email.html (email body template): Someone asked for password reset for email {{ email }} . Follow the link below: {{ protocol }} :// {{ domain }}{% url 'password_reset_confirm' uidb64 = uid token = token %} The same template context is used for subject template. Subject must be\nsingle line plain text string. class PasswordResetDoneView [source] ¶ URL name: password_reset_done The page shown after a user has been emailed a link to reset their\npassword. This view is called by default if the PasswordResetView doesn’t have an explicit success_url URL set. Note If the email address provided does not exist in the system, the user is\ninactive, or has an unusable password, the user will still be\nredirected to this view but no email will be sent. Attributes: template_name ¶ The full name of a template to use. Defaults to registration/password_reset_done.html if not supplied. extra_context ¶ A dictionary of context data that will be added to the default context\ndata passed to the template. class PasswordResetConfirmView [source] ¶ URL name: password_reset_confirm Presents a form for entering a new password. Keyword arguments from the URL: uidb64 : The user’s id encoded in base 64. token : Token to check that the password is valid. Attributes: template_name ¶ The full name of a template to display the confirm password view.\nDefault value is registration/password_reset_confirm.html . token_generator ¶ Instance of the class to check the password. This will default to default_token_generator , it’s an instance of django.contrib.auth.tokens.PasswordResetTokenGenerator . post_reset_login ¶ A boolean indicating if the user should be automatically authenticated\nafter a successful password reset. Defaults to False . post_reset_login_backend ¶ A dotted path to the authentication backend to use when authenticating\na user if post_reset_login is True . Required only if you have\nmultiple AUTHENTICATION_BACKENDS configured. Defaults to None . form_class ¶ Form that will be used to set the password. Defaults to SetPasswordForm . success_url ¶ URL to redirect after the password reset done. Defaults to 'password_reset_complete' . extra_context ¶ A dictionary of context data that will be added to the default context\ndata passed to the template. reset_url_token ¶ Token parameter displayed as a component of password reset URLs.\nDefaults to 'set-password' . Template context: form : The form (see form_class above) for setting the new user’s\npassword. validlink : Boolean, True if the link (combination of uidb64 and token ) is valid or unused yet. class PasswordResetCompleteView [source] ¶ URL name: password_reset_complete Presents a view which informs the user that the password has been\nsuccessfully changed. Attributes: template_name ¶ The full name of a template to display the view. Defaults to registration/password_reset_complete.html . extra_context ¶ A dictionary of context data that will be added to the default context\ndata passed to the template. Helper functions ¶ redirect_to_login ( next , login_url = None , redirect_field_name = 'next' ) [source] ¶ Redirects to the login page, and then back to another URL after a\nsuccessful login. Required arguments: next : The URL to redirect to after a successful login. Optional arguments: login_url : The URL of the login page to redirect to.\nDefaults to settings.LOGIN_URL if not supplied. redirect_field_name : The name of a GET field containing the\nURL to redirect to after login. Overrides next if the given GET parameter is passed. Built-in forms ¶ If you don’t want to use the built-in views, but want the convenience of not\nhaving to write forms for this functionality, the authentication system\nprovides several built-in forms located in django.contrib.auth.forms : Note The built-in authentication forms make certain assumptions about the user\nmodel that they are working with. If you’re using a custom user model , it may be necessary to define your own forms for the\nauthentication system. For more information, refer to the documentation\nabout using the built-in authentication forms with custom user models . class AdminPasswordChangeForm [source] ¶ A form used in the admin interface to change a user’s password, including\nthe ability to set an unusable password , which blocks the\nuser from logging in with password-based authentication. Takes the user as the first positional argument. Changed in Django 5.1: Option to disable (or reenable) password-based authentication was\nadded. class AdminUserCreationForm [source] ¶ New in Django 5.1.1. A form used in the admin interface to create a new user. Inherits from UserCreationForm . It includes an additional usable_password field, enabled by default. If usable_password is enabled, it verifies that password1 and password2 are non empty and match, validates the password using validate_password() , and\nsets the user’s password using set_password() .\nIf usable_password is disabled, no password validation is done, and\npassword-based authentication is disabled for the user by calling set_unusable_password() . class AuthenticationForm [source] ¶ A form for logging a user in. Takes request as its first positional argument, which is stored on the\nform instance for use by sub-classes. confirm_login_allowed ( user ) [source] ¶ By default, AuthenticationForm rejects users whose is_active flag is set to False . You may override this behavior with a custom\npolicy to determine which users can log in. Do this with a custom form\nthat subclasses AuthenticationForm and overrides the confirm_login_allowed() method. This method should raise a ValidationError if the given user may\nnot log in. For example, to allow all users to log in regardless of “active”\nstatus: from django.contrib.auth.forms import AuthenticationForm class AuthenticationFormWithInactiveUsersOkay ( AuthenticationForm ): def confirm_login_allowed ( self , user ): pass (In this case, you’ll also need to use an authentication backend that\nallows inactive users, such as AllowAllUsersModelBackend .) Or to allow only some active users to log in: class PickyAuthenticationForm ( AuthenticationForm ): def confirm_login_allowed ( self , user ): if not user . is_active : raise ValidationError ( _ ( \"This account is inactive.\" ), code = \"inactive\" , ) if user . username . startswith ( \"b\" ): raise ValidationError ( _ ( \"Sorry, accounts starting with 'b' aren't welcome here.\" ), code = \"no_b_users\" , ) class BaseUserCreationForm [source] ¶ A ModelForm for creating a new user. This is the\nrecommended base class if you need to customize the user creation form. It has three fields: username (from the user model), password1 ,\nand password2 . It verifies that password1 and password2 match,\nvalidates the password using validate_password() , and\nsets the user’s password using set_password() . class PasswordChangeForm [source] ¶ A form for allowing a user to change their password. class PasswordResetForm [source] ¶ A form for generating and emailing a one-time use link to reset a\nuser’s password. send_mail ( subject_template_name , email_template_name , context , from_email , to_email , html_email_template_name = None ) [source] ¶ Uses the arguments to send an EmailMultiAlternatives .\nCan be overridden to customize how the email is sent to the user. If\nyou choose to override this method, be mindful of handling potential\nexceptions raised due to email sending failures. Parameters : subject_template_name – the template for the subject. email_template_name – the template for the email body. context – context passed to the subject_template , email_template , and html_email_template (if it is not None ). from_email – the sender’s email. to_email – the email of the requester. html_email_template_name – the template for the HTML body;\ndefaults to None , in which case a plain text email is sent. By default, save() populates the context with the\nsame variables that PasswordResetView passes to its\nemail context. class SetPasswordForm [source] ¶ A form that lets a user change their password without entering the old\npassword. class UserChangeForm [source] ¶ A form used in the admin interface to change a user’s information and\npermissions. class UserCreationForm [source] ¶ Inherits from BaseUserCreationForm . To help prevent confusion with\nsimilar usernames, the form doesn’t allow usernames that differ only in\ncase. Authentication data in templates ¶ The currently logged-in user and their permissions are made available in the template context when you use RequestContext . Technicality Technically, these variables are only made available in the template\ncontext if you use RequestContext and the 'django.contrib.auth.context_processors.auth' context processor is\nenabled. It is in the default generated settings file. For more, see the RequestContext docs . Users ¶ When rendering a template RequestContext , the\ncurrently logged-in user, either a User instance or an AnonymousUser instance, is\nstored in the template variable {{ user }} : {% if user.is_authenticated %} < p > Welcome, {{ user.username }} . Thanks for logging in. </ p > {% else %} < p > Welcome, new user. Please log in. </ p > {% endif %} This template context variable is not available if a RequestContext is not\nbeing used. Permissions ¶ The currently logged-in user’s permissions are stored in the template variable {{ perms }} . This is an instance of django.contrib.auth.context_processors.PermWrapper , which is a\ntemplate-friendly proxy of permissions. Evaluating a single-attribute lookup of {{ perms }} as a boolean is a proxy\nto User.has_module_perms() . For example, to check if\nthe logged-in user has any permissions in the foo app: {% if perms.foo %} Evaluating a two-level-attribute lookup as a boolean is a proxy to User.has_perm() . For example,\nto check if the logged-in user has the permission foo.add_vote : {% if perms.foo.add_vote %} Here’s a more complete example of checking permissions in a template: {% if perms.foo %} < p > You have permission to do something in the foo app. </ p > {% if perms.foo.add_vote %} < p > You can vote! </ p > {% endif %} {% if perms.foo.add_driving %} < p > You can drive! </ p > {% endif %} {% else %} < p > You don't have permission to do anything in the foo app. </ p > {% endif %} It is possible to also look permissions up by {% if in %} statements.\nFor example: {% if 'foo' in perms %} {% if 'foo.add_vote' in perms %} < p > In lookup works, too. </ p > {% endif %} {% endif %} Managing users in the admin ¶ When you have both django.contrib.admin and django.contrib.auth installed, the admin provides a convenient way to view and manage users,\ngroups, and permissions. Users can be created and deleted like any Django\nmodel. Groups can be created, and permissions can be assigned to users or\ngroups. A log of user edits to models made within the admin is also stored and\ndisplayed. Creating users ¶ You should see a link to “Users” in the “Auth”\nsection of the main admin index page. The “Add user” admin page is different\nthan standard admin pages in that it requires you to choose a username and\npassword before allowing you to edit the rest of the user’s fields.\nAlternatively, on this page, you can choose a username and disable\npassword-based authentication for the user. Also note: if you want a user account to be able to create users using the\nDjango admin site, you’ll need to give them permission to add users and change users (i.e., the “Add user” and “Change user” permissions). If an\naccount has permission to add users but not to change them, that account won’t\nbe able to add users. Why? Because if you have permission to add users, you\nhave the power to create superusers, which can then, in turn, change other\nusers. So Django requires add and change permissions as a slight security\nmeasure. Be thoughtful about how you allow users to manage permissions. If you give a\nnon-superuser the ability to edit users, this is ultimately the same as giving\nthem superuser status because they will be able to elevate permissions of\nusers including themselves! Changing passwords ¶ User passwords are not displayed in the admin (nor stored in the database), but\nthe password storage details are displayed.\nIncluded in the display of this information is a link to\na password change form that allows admins to change or unset user passwords.", "keywords": ["users", "accounts", "request.get_host", "student", "storage", "create_user", "ldap", "password_reset_form.html", "login", "messages", "/login/", "b", "@example.com", "assumes", "logoutview", "user_permissions", "--email=joe@example.com", "field", "#", "sender", "passwordchangeview", "authenticationformwithinactiveusersokay", "loop", "emails", "user_change_password", "action", "range", "get_permission_denied_message", "lines", "match", "contenttypemanager.get_for_model", "cache", "has_add_permission", "set_unusable_password", "needs", "non", "change", "https", "is_authenticated", "label", "hash", "http", "=", "django.contrib.contenttypes.models", "indicating", "user.backend", "message", "logs", "redirect_to_login", "permissiondenied", "html_email_template", "href", "subject_template", "password_change", "authentication_form", "django.contrib.auth.decorators", "django.contrib.auth.context_processors", "user.has_perm", "authentication_backends", "login_error.html", "multiple", "codename", "form.password", "technically", "staff", "john", "first_name", "following", "type", "passwordchangeform", "logged_out.html", "validate_password", "people", "custom", "objects", "documentation", "file", "password_change_done", "customization", "publish", "user", "cases", "login_redirect_url", "lennon", "permission_required", "helper", "attribute", "userpassestestmixin", "handle_no_permission", "token_generator", "time", "endswith", "login/", "django.contrib.auth.context_processors.auth", "save", "thanks", "render", "lennon@thebeatles.com", "setting", "account", "app_label", "polls", "things", "password", "password_reset_done.html", "passwordresetform", "name", "from_email", "parameter", "has_permission", "as_view", "backends", "reference", "web", "django.contrib.auth", "joe@example.com", "accessmixin", "foo.add_vote", "django.contrib.admin", "baseusercreationform", "passwordresettokengenerator", "return", "confirm_login_allowed", "redirect_field_name", "applications", "foo", "timing", "duration", "name='password_reset_complete", "django.contrib.auth.urls", "costs", "get_object_or_404", "callables", "username", "position", "status", "proxy", "site.domain", "url", "error", "django.contrib.auth.mixins", "conditions", "adminpasswordchangeform", "code", "base.html", "html_email_template_name", "secret", "auth", "superusers", "invalidation", "pages", "filter", "false", "behavior", "access", "class", "manage.py", "display", "link", "i", "perms", "group", "customizing", "returns", "names", "u", "login_url", "attack", "request", "auser", "database", "flag", "block", "input", "usable_password", "signal", "*", "change_student", "query", "page", "test", "hosts", "stock", "migrate", "logout", "post_reset_login", "py", "httprequest.auser", "admin", "creation", ".", "usage", "mixin", "password_reset_email.html", "forbidden", "configuration", "auth_user_model", "email_check", "user.refresh_from_db", "has_view_permission", "django.contrib.auth.login", "aauthenticate", "validation", "next_page", "section", "login.html", "my_redirect_field", "/", "to_email", "source", "get_login_url", "component", "user.username", "use", "auth_views", "credentials", "get_user", "solution", "user.has_module_perms", "leftmost", "td", "enumeration", "django.contrib.auth.logout", "core", "overrides", "pass", "name='password_change", "order", "default", "allowallusersmodelbackend", "resolves", "app.can_eat_pizzas", "attackers", "userchangeform", "requestsite", "alias", "reset_url_token", "form", "option", "classes", "inherits", "view_student", "set_password", "test_func", "--username", "login/?next=/polls/3/", "form.errors", "convenience", "validationerror", "extra_email_context", "get_for_model", "perm", "user.email", "createsuperuser", "testmixin1", "combination", "adminusercreationform", "template", "form.password.label_tag", "way", "super", "checks", "template_name", "index", "user_id", "party", "raise_exception", "session", "¶", "command", "id", "sub", "post", "parameters", "polls.view_choice", "emailmultialternatives", "site_name", "get_redirect_field_name", "content", "function", "protocol", "views", "result", "view", "websites", "control", "number", "measure", "permissions", "modelform", "def", "passwordchangedoneview", "point", "values", "secret_key_fallbacks", "failures", "string", "email_template_name", "user_passes_test", "_", "password_reset_complete.html", "get_test_func", "user.has_perm('foo.add_bar", "token", "thing", "password_reset_confirm.html", "table", "has_change_permission", "subject", "models", "version", "level", "anonymoususer", "name='password_reset", "/accounts", "processor", "portion", "django", "myapp", "redirect_authenticated_user", "n’t", "fields", "modelbackend", "joe", "set", "has_delete_permission", "editors", "power", "p", "aupdate_session_auth_hash", "urlpatterns", "password_reset_complete", "value", "media", "password_reset", "get_session_auth_hash", "line", "bit", "django.shortcuts", "contenttype", "policy", "implementation", "data", "browser", "handler", "testmixin2", "login_not_required", "base", "backend", "task", "person", "has_perms", "app.can_deliver_pizzas", "redirect_to", "add", "iterable", "loginrequiredmiddleware", "change-password.html", "security", "shortcut", "user.has_perm('foo.delete_bar", "self", "instance", "members", "permissionrequiredmixin", "extension", "handling", "interface", "user.has_perm('foo.change_bar", "remoteusermiddleware", "modeladmin", "functionality", "form_class", "docs", "myuser", "logout_redirect_url", "decorator", "polls.change_choice", "polls.add_choice", "superuser", "can_edit_home_page", "creators", "/loginpage/", "assumptions", "instances", "blogpost", "installed_apps", "object", "get_default_redirect_url", "domain", "authenticate", "groups", "technicality", "httprequest", "response", "management", "website", "dictionary", "requests", "reset", "alogout", "chance", "keyword", "abstractbaseuser", "password_reset_subject.txt", "registration", "variables", "rest", "responsibility", "redirect", "turn", "request.user", "system", "address", "inheritance", "edits", "fingerprinting", "overhead", "async", "change_blogpost", "restrictions", "welcome", "pickyauthenticationform", "permission_denied_message", "update_session_auth_hash", "passwordresetview", "can_eat_pizzas", "password_change_done.html", "permwrapper", "usernames", "check", "difference", "passwordresetcompleteview", "features", "site", "forms", "addition", "example", "subject_template_name", "no_b_users", "app", "list", "sample", "uidb64", "mailer", "usercreationform", "has_perm", "passwordresetconfirmview", "user_gains_perms", "email", "starting", "model", "variable", "password_reset_confirm", "callable", "confusion", "application", "login_required", "django.contrib.auth.models", "attributes", "loginrequiredmixin", "title", "ability", "redirects", "urlconf", "favicon", "log", "requester", "content_type", "startswith", "case", "boolean", "authentication", "lookup", "authorization", "errors", "html", "tuple", "permission_list", "arguments", "passwords", "init", "package", "site.name", "name='login", "middleware", "hmac", "one", "django.contrib.auth.tokens", "myview", "delete", "last_name", "user.is_active", "misuse", "secret_key", "reset/<uidb64>/<token>/", "bar", "app.add_person", "loginview", "path", "is_valid", "functions", "key", "success", "django.contrib.auth.forms", "setpasswordform", "my_view", "pizzas", "none", "authenticationform", "meta", "):", "get", "password_reset_done", "patterns", "reason", "framework", "leakage", "new", "changepassword", "true", "\\", "urls", "posts", "api", "sessions", "support", "myapp.models", "user.has_perm('foo.view_bar", "projects", "document", "for_concrete_model", "-", "password2", "context", "cycle", "permission", "alternative", "import", "files", "success_url", "d", "confirm", "admins", "statements", ">", "defaults", "%", "name='password_reset_done", "pk", "site_id", "--email", "information", "images", "python", "requestcontext", "methods", "options", "app.add_student", "optional", "exception", "details", "password1", "method", "settings", "argument", "endblock", "cookie", "note", "sites", "body", "tasks", "visitors", "templates", "profiles", "text", "project", "exceptions"], "type": "documentation"},
{"title": "QuerySet API reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/querysets/", "content": "QuerySet API reference ¶ This document describes the details of the QuerySet API. It builds on the\nmaterial presented in the model and database\nquery guides, so you’ll probably want to read and\nunderstand those documents before reading this one. Throughout this reference we’ll use the example blog models presented in the database query guide . When QuerySet s are evaluated ¶ Internally, a QuerySet can be constructed, filtered, sliced, and generally\npassed around without actually hitting the database. No database activity\nactually occurs until you do something to evaluate the queryset. You can evaluate a QuerySet in the following ways: Iteration. A QuerySet is iterable, and it executes its database\nquery the first time you iterate over it. For example, this will print\nthe headline of all entries in the database: for e in Entry . objects . all (): print ( e . headline ) Note: Don’t use this if all you want to do is determine if at least one\nresult exists. It’s more efficient to use exists() . Asynchronous iteration. A QuerySet can also be iterated over using async for : async for e in Entry . objects . all (): results . append ( e ) Both synchronous and asynchronous iterators of QuerySets share the same\nunderlying cache. Slicing. As explained in Limiting QuerySets , a QuerySet can\nbe sliced, using Python’s array-slicing syntax. Slicing an unevaluated QuerySet usually returns another unevaluated QuerySet , but Django\nwill execute the database query if you use the “step” parameter of slice\nsyntax, and will return a list. Slicing a QuerySet that has been\nevaluated also returns a list. Also note that even though slicing an unevaluated QuerySet returns\nanother unevaluated QuerySet , modifying it further (e.g., adding\nmore filters, or modifying ordering) is not allowed, since that does not\ntranslate well into SQL and it would not have a clear meaning either. Pickling/Caching. See the following section for details of what\nis involved when pickling QuerySets . The important thing for the\npurposes of this section is that the results are read from the database. repr(). A QuerySet is evaluated when you call repr() on it.\nThis is for convenience in the Python interactive interpreter, so you can\nimmediately see your results when using the API interactively. len(). A QuerySet is evaluated when you call len() on it.\nThis, as you might expect, returns the length of the result list. Note: If you only need to determine the number of records in the set (and\ndon’t need the actual objects), it’s much more efficient to handle a count\nat the database level using SQL’s SELECT COUNT(*) . Django provides a count() method for precisely this reason. list(). Force evaluation of a QuerySet by calling list() on\nit. For example: entry_list = list ( Entry . objects . all ()) bool(). Testing a QuerySet in a boolean context, such as using bool() , or , and or an if statement, will cause the query\nto be executed. If there is at least one result, the QuerySet is True , otherwise False . For example: if Entry . objects . filter ( headline = \"Test\" ): print ( \"There is at least one Entry with the headline Test\" ) Note: If you only want to determine if at least one result exists (and don’t\nneed the actual objects), it’s more efficient to use exists() . Pickling QuerySet s ¶ If you pickle a QuerySet , this will force all the results to be loaded\ninto memory prior to pickling. Pickling is usually used as a precursor to\ncaching and when the cached queryset is reloaded, you want the results to\nalready be present and ready for use (reading from the database can take some\ntime, defeating the purpose of caching). This means that when you unpickle a QuerySet , it contains the results at the moment it was pickled, rather\nthan the results that are currently in the database. If you only want to pickle the necessary information to recreate the QuerySet from the database at a later time, pickle the query attribute\nof the QuerySet . You can then recreate the original QuerySet (without\nany results loaded) using some code like this: >>> import pickle >>> query = pickle . loads ( s ) # Assuming 's' is the pickled string. >>> qs = MyModel . objects . all () >>> qs . query = query # Restore the original 'query'. The query attribute is an opaque object. It represents the internals of\nthe query construction and is not part of the public API. However, it is safe\n(and fully supported) to pickle and unpickle the attribute’s contents as\ndescribed here. Restrictions on QuerySet.values_list() If you recreate QuerySet.values_list() using the pickled query attribute, it will be converted to QuerySet.values() : >>> import pickle >>> qs = Blog . objects . values_list ( \"id\" , \"name\" ) >>> qs <QuerySet [(1, 'Beatles Blog')]> >>> reloaded_qs = Blog . objects . all () >>> reloaded_qs . query = pickle . loads ( pickle . dumps ( qs . query )) >>> reloaded_qs <QuerySet [{'id': 1, 'name': 'Beatles Blog'}]> You can’t share pickles between versions Pickles of QuerySets are only valid for the version of Django that\nwas used to generate them. If you generate a pickle using Django\nversion N, there is no guarantee that pickle will be readable with\nDjango version N+1. Pickles should not be used as part of a long-term\narchival strategy. Since pickle compatibility errors can be difficult to diagnose, such as\nsilently corrupted objects, a RuntimeWarning is raised when you try to\nunpickle a queryset in a Django version that is different than the one in\nwhich it was pickled. QuerySet API ¶ Here’s the formal declaration of a QuerySet : class QuerySet ( model = None , query = None , using = None , hints = None ) [source] ¶ Usually when you’ll interact with a QuerySet you’ll use it by chaining filters . To make this work, most QuerySet methods return new querysets. These methods are covered in\ndetail later in this section. The QuerySet class has the following public attributes you can use for\nintrospection: ordered [source] ¶ True if the QuerySet is ordered — i.e. has an order_by() clause or a default ordering on the model. False otherwise. db [source] ¶ The database that will be used if this query is executed now. Note The query parameter to QuerySet exists so that specialized\nquery subclasses can reconstruct internal query state. The value of the\nparameter is an opaque representation of that query state and is not\npart of a public API. Methods that return new QuerySet s ¶ Django provides a range of QuerySet refinement methods that modify either\nthe types of results returned by the QuerySet or the way its SQL query is\nexecuted. Note These methods do not run database queries, therefore they are safe to run in asynchronous code , and do not have separate asynchronous\nversions. filter() ¶ filter ( * args , ** kwargs ) ¶ Returns a new QuerySet containing objects that match the given lookup\nparameters. The lookup parameters ( **kwargs ) should be in the format described in Field lookups below. Multiple parameters are joined via AND in the\nunderlying SQL statement. If you need to execute more complex queries (for example, queries with OR statements),\nyou can use Q objects ( *args ). exclude() ¶ exclude ( * args , ** kwargs ) ¶ Returns a new QuerySet containing objects that do not match the given\nlookup parameters. The lookup parameters ( **kwargs ) should be in the format described in Field lookups below. Multiple parameters are joined via AND in the\nunderlying SQL statement, and the whole thing is enclosed in a NOT() . This example excludes all entries whose pub_date is later than 2005-1-3\nAND whose headline is “Hello”: Entry . objects . exclude ( pub_date__gt = datetime . date ( 2005 , 1 , 3 ), headline = \"Hello\" ) In SQL terms, that evaluates to: SELECT ... WHERE NOT ( pub_date > '2005-1-3' AND headline = 'Hello' ) This example excludes all entries whose pub_date is later than 2005-1-3\nOR whose headline is “Hello”: Entry . objects . exclude ( pub_date__gt = datetime . date ( 2005 , 1 , 3 )) . exclude ( headline = \"Hello\" ) In SQL terms, that evaluates to: SELECT ... WHERE NOT pub_date > '2005-1-3' AND NOT headline = 'Hello' Note the second example is more restrictive. If you need to execute more complex queries (for example, queries with OR statements),\nyou can use Q objects ( *args ). annotate() ¶ annotate ( * args , ** kwargs ) ¶ Annotates each object in the QuerySet with the provided list of query\nexpressions . An expression may be a simple value, a\nreference to a field on the model (or any related models), or an aggregate\nexpression (averages, sums, etc.) that has been computed over the objects that\nare related to the objects in the QuerySet . Each argument to annotate() is an annotation that will be added\nto each object in the QuerySet that is returned. The aggregation functions that are provided by Django are described\nin Aggregation Functions below. Annotations specified using keyword arguments will use the keyword as\nthe alias for the annotation. Anonymous arguments will have an alias\ngenerated for them based upon the name of the aggregate function and\nthe model field that is being aggregated. Only aggregate expressions\nthat reference a single field can be anonymous arguments. Everything\nelse must be a keyword argument. For example, if you were manipulating a list of blogs, you may want\nto determine how many entries have been made in each blog: >>> from django.db.models import Count >>> q = Blog . objects . annotate ( Count ( \"entry\" )) # The name of the first blog >>> q [ 0 ] . name 'Blogasaurus' # The number of entries on the first blog >>> q [ 0 ] . entry__count 42 The Blog model doesn’t define an entry__count attribute by itself,\nbut by using a keyword argument to specify the aggregate function, you can\ncontrol the name of the annotation: >>> q = Blog . objects . annotate ( number_of_entries = Count ( \"entry\" )) # The number of entries on the first blog, using the name provided >>> q [ 0 ] . number_of_entries 42 For an in-depth discussion of aggregation, see the topic guide on\nAggregation . alias() ¶ alias ( * args , ** kwargs ) ¶ Same as annotate() , but instead of annotating objects in the QuerySet , saves the expression for later reuse with other QuerySet methods. This is useful when the result of the expression itself is not needed\nbut it is used for filtering, ordering, or as a part of a complex expression.\nNot selecting the unused value removes redundant work from the database which\nshould result in better performance. For example, if you want to find blogs with more than 5 entries, but are not\ninterested in the exact number of entries, you could do this: >>> from django.db.models import Count >>> blogs = Blog . objects . alias ( entries = Count ( \"entry\" )) . filter ( entries__gt = 5 ) alias() can be used in conjunction with annotate() , exclude() , filter() , order_by() , and update() . To use aliased expression\nwith other methods (e.g. aggregate() ), you must promote it to an\nannotation: Blog . objects . alias ( entries = Count ( \"entry\" )) . annotate ( entries = F ( \"entries\" ), ) . aggregate ( Sum ( \"entries\" )) filter() and order_by() can take expressions directly, but\nexpression construction and usage often does not happen in the same place (for\nexample, QuerySet method creates expressions, for later use in views). alias() allows building complex expressions incrementally, possibly\nspanning multiple methods and modules, refer to the expression parts by their\naliases and only use annotate() for the final result. order_by() ¶ order_by ( * fields ) ¶ By default, results returned by a QuerySet are ordered by the ordering\ntuple given by the ordering option in the model’s Meta . You can\noverride this on a per- QuerySet basis by using the order_by method. Example: Entry . objects . filter ( pub_date__year = 2005 ) . order_by ( \"-pub_date\" , \"headline\" ) The result above will be ordered by pub_date descending, then by headline ascending. The negative sign in front of \"-pub_date\" indicates descending order. Ascending order is implied. To order randomly, use \"?\" ,\nlike so: Entry . objects . order_by ( \"?\" ) Note: order_by('?') queries may be expensive and slow, depending on the\ndatabase backend you’re using. To order by a field in a different model, use the same syntax as when you are\nquerying across model relations. That is, the name of the field, followed by a\ndouble underscore ( __ ), followed by the name of the field in the new model,\nand so on for as many models as you want to join. For example: Entry . objects . order_by ( \"blog__name\" , \"headline\" ) If you try to order by a field that is a relation to another model, Django will\nuse the default ordering on the related model, or order by the related model’s\nprimary key if there is no Meta.ordering specified. For example, since the Blog model has no default ordering specified: Entry . objects . order_by ( \"blog\" ) …is identical to: Entry . objects . order_by ( \"blog__id\" ) If Blog had ordering = ['name'] , then the first queryset would be\nidentical to: Entry . objects . order_by ( \"blog__name\" ) You can also order by query expressions by\ncalling asc() or desc() on the\nexpression: Entry . objects . order_by ( Coalesce ( \"summary\" , \"headline\" ) . desc ()) asc() and desc() have arguments\n( nulls_first and nulls_last ) that control how null values are sorted. Be cautious when ordering by fields in related models if you are also using distinct() . See the note in distinct() for an explanation of how\nrelated model ordering can change the expected results. Note It is permissible to specify a multi-valued field to order the results by\n(for example, a ManyToManyField field, or the\nreverse relation of a ForeignKey field). Consider this case: class Event ( Model ): parent = models . ForeignKey ( \"self\" , on_delete = models . CASCADE , related_name = \"children\" , ) date = models . DateField () Event . objects . order_by ( \"children__date\" ) Here, there could potentially be multiple ordering data for each Event ;\neach Event with multiple children will be returned multiple times\ninto the new QuerySet that order_by() creates. In other words,\nusing order_by() on the QuerySet could return more items than you\nwere working on to begin with - which is probably neither expected nor\nuseful. Thus, take care when using multi-valued field to order the results. If you can be sure that there will only be one ordering piece of data for each\nof the items you’re ordering, this approach should not present problems. If\nnot, make sure the results are what you expect. There’s no way to specify whether ordering should be case sensitive. With\nrespect to case-sensitivity, Django will order results however your database\nbackend normally orders them. You can order by a field converted to lowercase with Lower which will achieve case-consistent\nordering: Entry . objects . order_by ( Lower ( \"headline\" ) . desc ()) If you don’t want any ordering to be applied to a query, not even the default\nordering, call order_by() with no parameters. You can tell if a query is ordered or not by checking the QuerySet.ordered attribute, which will be True if the QuerySet has been ordered in any way. Each order_by() call will clear any previous ordering. For example, this\nquery will be ordered by pub_date and not headline : Entry . objects . order_by ( \"headline\" ) . order_by ( \"pub_date\" ) Warning Ordering is not a free operation. Each field you add to the ordering\nincurs a cost to your database. Each foreign key you add will\nimplicitly include all of its default orderings as well. If a query doesn’t have an ordering specified, results are returned from\nthe database in an unspecified order. A particular ordering is guaranteed\nonly when ordering by a set of fields that uniquely identify each object in\nthe results. For example, if a name field isn’t unique, ordering by it\nwon’t guarantee objects with the same name always appear in the same order. reverse() ¶ reverse () ¶ Use the reverse() method to reverse the order in which a queryset’s\nelements are returned. Calling reverse() a second time restores the\nordering back to the normal direction. To retrieve the “last” five items in a queryset, you could do this: my_queryset . reverse ()[: 5 ] Note that this is not quite the same as slicing from the end of a sequence in\nPython. The above example will return the last item first, then the\npenultimate item and so on. If we had a Python sequence and looked at seq[-5:] , we would see the fifth-last item first. Django doesn’t support\nthat mode of access (slicing from the end), because it’s not possible to do it\nefficiently in SQL. Also, note that reverse() should generally only be called on a QuerySet which has a defined ordering (e.g., when querying against a model which defines\na default ordering, or when using order_by() ). If no such ordering is\ndefined for a given QuerySet , calling reverse() on it has no real\neffect (the ordering was undefined prior to calling reverse() , and will\nremain undefined afterward). distinct() ¶ distinct ( * fields ) ¶ Returns a new QuerySet that uses SELECT DISTINCT in its SQL query. This\neliminates duplicate rows from the query results. By default, a QuerySet will not eliminate duplicate rows. In practice, this\nis rarely a problem, because simple queries such as Blog.objects.all() don’t introduce the possibility of duplicate result rows. However, if your\nquery spans multiple tables, it’s possible to get duplicate results when a QuerySet is evaluated. That’s when you’d use distinct() . Note Any fields used in an order_by() call are included in the SQL SELECT columns. This can sometimes lead to unexpected results when used\nin conjunction with distinct() . If you order by fields from a related\nmodel, those fields will be added to the selected columns and they may make\notherwise duplicate rows appear to be distinct. Since the extra columns\ndon’t appear in the returned results (they are only there to support\nordering), it sometimes looks like non-distinct results are being returned. Similarly, if you use a values() query to restrict the columns\nselected, the columns used in any order_by() (or default model\nordering) will still be involved and may affect uniqueness of the results. The moral here is that if you are using distinct() be careful about\nordering by related models. Similarly, when using distinct() and values() together, be careful when ordering by fields not in the values() call. On PostgreSQL only, you can pass positional arguments ( *fields ) in order to\nspecify the names of fields to which the DISTINCT should apply. This\ntranslates to a SELECT DISTINCT ON SQL query. Here’s the difference. For a\nnormal distinct() call, the database compares each field in each row when\ndetermining which rows are distinct. For a distinct() call with specified\nfield names, the database will only compare the specified field names. Note When you specify field names, you must provide an order_by() in the QuerySet , and the fields in order_by() must start with the fields in distinct() , in the same order. For example, SELECT DISTINCT ON (a) gives you the first row for each\nvalue in column a . If you don’t specify an order, you’ll get some\narbitrary row. Examples (those after the first will only work on PostgreSQL): >>> Author . objects . distinct () [...] >>> Entry . objects . order_by ( \"pub_date\" ) . distinct ( \"pub_date\" ) [...] >>> Entry . objects . order_by ( \"blog\" ) . distinct ( \"blog\" ) [...] >>> Entry . objects . order_by ( \"author\" , \"pub_date\" ) . distinct ( \"author\" , \"pub_date\" ) [...] >>> Entry . objects . order_by ( \"blog__name\" , \"mod_date\" ) . distinct ( \"blog__name\" , \"mod_date\" ) [...] >>> Entry . objects . order_by ( \"author\" , \"pub_date\" ) . distinct ( \"author\" ) [...] Note Keep in mind that order_by() uses any default related model ordering\nthat has been defined. You might have to explicitly order by the relation _id or referenced field to make sure the DISTINCT ON expressions\nmatch those at the beginning of the ORDER BY clause. For example, if\nthe Blog model defined an ordering by name : Entry . objects . order_by ( \"blog\" ) . distinct ( \"blog\" ) …wouldn’t work because the query would be ordered by blog__name thus\nmismatching the DISTINCT ON expression. You’d have to explicitly order\nby the relation _id field ( blog_id in this case) or the referenced\none ( blog__pk ) to make sure both expressions match. values() ¶ values ( * fields , ** expressions ) ¶ Returns a QuerySet that returns dictionaries, rather than model instances,\nwhen used as an iterable. Each of those dictionaries represents an object, with the keys corresponding to\nthe attribute names of model objects. This example compares the dictionaries of values() with the normal model\nobjects: # This list contains a Blog object. >>> Blog . objects . filter ( name__startswith = \"Beatles\" ) <QuerySet [<Blog: Beatles Blog>]> # This list contains a dictionary. >>> Blog . objects . filter ( name__startswith = \"Beatles\" ) . values () <QuerySet [{'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'}]> The values() method takes optional positional arguments, *fields , which\nspecify field names to which the SELECT should be limited. If you specify\nthe fields, each dictionary will contain only the field keys/values for the\nfields you specify. If you don’t specify the fields, each dictionary will\ncontain a key and value for every field in the database table. Example: >>> Blog . objects . values () <QuerySet [{'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'}]> >>> Blog . objects . values ( \"id\" , \"name\" ) <QuerySet [{'id': 1, 'name': 'Beatles Blog'}]> The values() method also takes optional keyword arguments, **expressions , which are passed through to annotate() : >>> from django.db.models.functions import Lower >>> Blog . objects . values ( lower_name = Lower ( \"name\" )) <QuerySet [{'lower_name': 'beatles blog'}]> You can use built-in and custom lookups in\nordering. For example: >>> from django.db.models import CharField >>> from django.db.models.functions import Lower >>> CharField . register_lookup ( Lower ) >>> Blog . objects . values ( \"name__lower\" ) <QuerySet [{'name__lower': 'beatles blog'}]> An aggregate within a values() clause is applied before other arguments\nwithin the same values() clause. If you need to group by another value,\nadd it to an earlier values() clause instead. For example: >>> from django.db.models import Count >>> Blog . objects . values ( \"entry__authors\" , entries = Count ( \"entry\" )) <QuerySet [{'entry__authors': 1, 'entries': 20}, {'entry__authors': 1, 'entries': 13}]> >>> Blog . objects . values ( \"entry__authors\" ) . annotate ( entries = Count ( \"entry\" )) <QuerySet [{'entry__authors': 1, 'entries': 33}]> A few subtleties that are worth mentioning: If you have a field called foo that is a ForeignKey , the default values() call\nwill return a dictionary key called foo_id , since this is the name\nof the hidden model attribute that stores the actual value (the foo attribute refers to the related model). When you are calling values() and passing in field names, you can pass in either foo or foo_id and you will get back the same thing (the dictionary key\nwill match the field name you passed in). For example: >>> Entry . objects . values () <QuerySet [{'blog_id': 1, 'headline': 'First Entry', ...}, ...]> >>> Entry . objects . values ( \"blog\" ) <QuerySet [{'blog': 1}, ...]> >>> Entry . objects . values ( \"blog_id\" ) <QuerySet [{'blog_id': 1}, ...]> When using values() together with distinct() , be aware that\nordering can affect the results. See the note in distinct() for\ndetails. If you use a values() clause after an extra() call,\nany fields defined by a select argument in the extra() must\nbe explicitly included in the values() call. Any extra() call\nmade after a values() call will have its extra selected fields\nignored. Calling only() and defer() after values() doesn’t make\nsense, so doing so will raise a TypeError . Combining transforms and aggregates requires the use of two annotate() calls, either explicitly or as keyword arguments to values() . As above,\nif the transform has been registered on the relevant field type the first annotate() can be omitted, thus the following examples are equivalent: >>> from django.db.models import CharField , Count >>> from django.db.models.functions import Lower >>> CharField . register_lookup ( Lower ) >>> Blog . objects . values ( \"entry__authors__name__lower\" ) . annotate ( entries = Count ( \"entry\" )) <QuerySet [{'entry__authors__name__lower': 'test author', 'entries': 33}]> >>> Blog . objects . values ( entry__authors__name__lower = Lower ( \"entry__authors__name\" )) . annotate ( ... entries = Count ( \"entry\" ) ... ) <QuerySet [{'entry__authors__name__lower': 'test author', 'entries': 33}]> >>> Blog . objects . annotate ( entry__authors__name__lower = Lower ( \"entry__authors__name\" )) . values ( ... \"entry__authors__name__lower\" ... ) . annotate ( entries = Count ( \"entry\" )) <QuerySet [{'entry__authors__name__lower': 'test author', 'entries': 33}]> It is useful when you know you’re only going to need values from a small number\nof the available fields and you won’t need the functionality of a model\ninstance object. It’s more efficient to select only the fields you need to use. Finally, note that you can call filter() , order_by() , etc. after the values() call, that means that these two calls are identical: Blog . objects . values () . order_by ( \"id\" ) Blog . objects . order_by ( \"id\" ) . values () The people who made Django prefer to put all the SQL-affecting methods first,\nfollowed (optionally) by any output-affecting methods (such as values() ),\nbut it doesn’t really matter. This is your chance to really flaunt your\nindividualism. You can also refer to fields on related models with reverse relations through OneToOneField , ForeignKey and ManyToManyField attributes: >>> Blog . objects . values ( \"name\" , \"entry__headline\" ) <QuerySet [{'name': 'My blog', 'entry__headline': 'An entry'}, {'name': 'My blog', 'entry__headline': 'Another entry'}, ...]> Warning Because ManyToManyField attributes and reverse\nrelations can have multiple related rows, including these can have a\nmultiplier effect on the size of your result set. This will be especially\npronounced if you include multiple such fields in your values() query,\nin which case all possible combinations will be returned. Special values for JSONField on SQLite Due to the way the JSON_EXTRACT and JSON_TYPE SQL functions are\nimplemented on SQLite, and lack of the BOOLEAN data type, values() will return True , False , and None instead of \"true\" , \"false\" , and \"null\" strings for JSONField key transforms. values_list() ¶ values_list ( * fields , flat = False , named = False ) ¶ This is similar to values() except that instead of returning dictionaries,\nit returns tuples when iterated over. Each tuple contains the value from the\nrespective field or expression passed into the values_list() call — so the\nfirst item is the first field, etc. For example: >>> Entry . objects . values_list ( \"id\" , \"headline\" ) <QuerySet [(1, 'First entry'), ...]> >>> from django.db.models.functions import Lower >>> Entry . objects . values_list ( \"id\" , Lower ( \"headline\" )) <QuerySet [(1, 'first entry'), ...]> If you only pass in a single field, you can also pass in the flat parameter. If True , this will mean the returned results are single values,\nrather than 1-tuples. An example should make the difference clearer: >>> Entry . objects . values_list ( \"id\" ) . order_by ( \"id\" ) <QuerySet[(1,), (2,), (3,), ...]> >>> Entry . objects . values_list ( \"id\" , flat = True ) . order_by ( \"id\" ) <QuerySet [1, 2, 3, ...]> It is an error to pass in flat when there is more than one field. You can pass named=True to get results as a namedtuple() : >>> Entry . objects . values_list ( \"id\" , \"headline\" , named = True ) <QuerySet [Row(id=1, headline='First entry'), ...]> Using a named tuple may make use of the results more readable, at the expense\nof a small performance penalty for transforming the results into a named tuple. If you don’t pass any values to values_list() , it will return all the\nfields in the model, in the order they were declared. A common need is to get a specific field value of a certain model instance. To\nachieve that, use values_list() followed by a get() call: >>> Entry . objects . values_list ( \"headline\" , flat = True ) . get ( pk = 1 ) 'First entry' values() and values_list() are both intended as optimizations for a\nspecific use case: retrieving a subset of data without the overhead of creating\na model instance. This metaphor falls apart when dealing with many-to-many and\nother multivalued relations (such as the one-to-many relation of a reverse\nforeign key) because the “one row, one object” assumption doesn’t hold. For example, notice the behavior when querying across a ManyToManyField : >>> Author . objects . values_list ( \"name\" , \"entry__headline\" ) <QuerySet [('Noam Chomsky', 'Impressions of Gaza'), ('George Orwell', 'Why Socialists Do Not Believe in Fun'), ('George Orwell', 'In Defence of English Cooking'), ('Don Quixote', None)]> Authors with multiple entries appear multiple times and authors without any\nentries have None for the entry headline. Similarly, when querying a reverse foreign key, None appears for entries\nnot having any author: >>> Entry . objects . values_list ( \"authors\" ) <QuerySet [('Noam Chomsky',), ('George Orwell',), (None,)]> Special values for JSONField on SQLite Due to the way the JSON_EXTRACT and JSON_TYPE SQL functions are\nimplemented on SQLite, and lack of the BOOLEAN data type, values_list() will return True , False , and None instead of \"true\" , \"false\" , and \"null\" strings for JSONField key transforms. dates() ¶ dates ( field , kind , order = 'ASC' ) ¶ Returns a QuerySet that evaluates to a list of datetime.date objects representing all available dates of a particular kind within the\ncontents of the QuerySet . field should be the name of a DateField of your model. kind should be either \"year\" , \"month\" , \"week\" , or \"day\" .\nEach datetime.date object in the result list is “truncated” to the\ngiven type . \"year\" returns a list of all distinct year values for the field. \"month\" returns a list of all distinct year/month values for the\nfield. \"week\" returns a list of all distinct year/week values for the field. All\ndates will be a Monday. \"day\" returns a list of all distinct year/month/day values for the\nfield. order , which defaults to 'ASC' , should be either 'ASC' or 'DESC' . This specifies how to order the results. Examples: >>> Entry . objects . dates ( \"pub_date\" , \"year\" ) [datetime.date(2005, 1, 1)] >>> Entry . objects . dates ( \"pub_date\" , \"month\" ) [datetime.date(2005, 2, 1), datetime.date(2005, 3, 1)] >>> Entry . objects . dates ( \"pub_date\" , \"week\" ) [datetime.date(2005, 2, 14), datetime.date(2005, 3, 14)] >>> Entry . objects . dates ( \"pub_date\" , \"day\" ) [datetime.date(2005, 2, 20), datetime.date(2005, 3, 20)] >>> Entry . objects . dates ( \"pub_date\" , \"day\" , order = \"DESC\" ) [datetime.date(2005, 3, 20), datetime.date(2005, 2, 20)] >>> Entry . objects . filter ( headline__contains = \"Lennon\" ) . dates ( \"pub_date\" , \"day\" ) [datetime.date(2005, 3, 20)] datetimes() ¶ datetimes ( field_name , kind , order = 'ASC' , tzinfo = None ) ¶ Returns a QuerySet that evaluates to a list of datetime.datetime objects representing all available dates of a particular kind within the\ncontents of the QuerySet . field_name should be the name of a DateTimeField of your model. kind should be either \"year\" , \"month\" , \"week\" , \"day\" , \"hour\" , \"minute\" , or \"second\" . Each datetime.datetime object in the result list is “truncated” to the given type . order , which defaults to 'ASC' , should be either 'ASC' or 'DESC' . This specifies how to order the results. tzinfo defines the time zone to which datetimes are converted prior to\ntruncation. Indeed, a given datetime has different representations depending\non the time zone in use. This parameter must be a datetime.tzinfo object. If it’s None , Django uses the current time zone . It has no effect when USE_TZ is False . Note This function performs time zone conversions directly in the database.\nAs a consequence, your database must be able to interpret the value of tzinfo.tzname(None) . This translates into the following requirements: SQLite: no requirements. Conversions are performed in Python. PostgreSQL: no requirements (see Time Zones ). Oracle: no requirements (see Choosing a Time Zone File ). MySQL: load the time zone tables with mysql_tzinfo_to_sql . none() ¶ none () ¶ Calling none() will create a queryset that never returns any objects and no\nquery will be executed when accessing the results. A qs.none() queryset\nis an instance of EmptyQuerySet . Examples: >>> Entry . objects . none () <QuerySet []> >>> from django.db.models.query import EmptyQuerySet >>> isinstance ( Entry . objects . none (), EmptyQuerySet ) True all() ¶ all () ¶ Returns a copy of the current QuerySet (or QuerySet subclass).  This\ncan be useful in situations where you might want to pass in either a model\nmanager or a QuerySet and do further filtering on the result. After calling all() on either object, you’ll definitely have a QuerySet to work with. When a QuerySet is evaluated , it\ntypically caches its results. If the data in the database might have changed\nsince a QuerySet was evaluated, you can get updated results for the same\nquery by calling all() on a previously evaluated QuerySet . union() ¶ union ( * other_qs , all = False ) ¶ Uses SQL’s UNION operator to combine the results of two or more QuerySet s. For example: >>> qs1 . union ( qs2 , qs3 ) The UNION operator selects only distinct values by default. To allow\nduplicate values, use the all=True argument. union() , intersection() , and difference() return model instances\nof the type of the first QuerySet even if the arguments are QuerySet s\nof other models. Passing different models works as long as the SELECT list\nis the same in all QuerySet s (at least the types, the names don’t matter\nas long as the types are in the same order). In such cases, you must use the\ncolumn names from the first QuerySet in QuerySet methods applied to the\nresulting QuerySet . For example: >>> qs1 = Author . objects . values_list ( \"name\" ) >>> qs2 = Entry . objects . values_list ( \"headline\" ) >>> qs1 . union ( qs2 ) . order_by ( \"name\" ) In addition, only LIMIT , OFFSET , COUNT(*) , ORDER BY , and\nspecifying columns (i.e. slicing, count() , exists() , order_by() , and values() / values_list() ) are allowed\non the resulting QuerySet . Further, databases place restrictions on\nwhat operations are allowed in the combined queries. For example, most\ndatabases don’t allow LIMIT or OFFSET in the combined queries. intersection() ¶ intersection ( * other_qs ) ¶ Uses SQL’s INTERSECT operator to return the shared elements of two or more QuerySet s. For example: >>> qs1 . intersection ( qs2 , qs3 ) See union() for some restrictions. difference() ¶ difference ( * other_qs ) ¶ Uses SQL’s EXCEPT operator to keep only elements present in the QuerySet but not in some other QuerySet s. For example: >>> qs1 . difference ( qs2 , qs3 ) See union() for some restrictions. select_related() ¶ select_related ( * fields ) ¶ Returns a QuerySet that will “follow” foreign-key relationships, selecting\nadditional related-object data when it executes its query. This is a\nperformance booster which results in a single more complex query but means\nlater use of foreign-key relationships won’t require database queries. The following examples illustrate the difference between plain lookups and select_related() lookups. Here’s standard lookup: # Hits the database. e = Entry . objects . get ( id = 5 ) # Hits the database again to get the related Blog object. b = e . blog And here’s select_related lookup: # Hits the database. e = Entry . objects . select_related ( \"blog\" ) . get ( id = 5 ) # Doesn't hit the database, because e.blog has been prepopulated # in the previous query. b = e . blog You can use select_related() with any queryset of objects: from django.utils import timezone # Find all the blogs with entries scheduled to be published in the future. blogs = set () for e in Entry . objects . filter ( pub_date__gt = timezone . now ()) . select_related ( \"blog\" ): # Without select_related(), this would make a database query for each # loop iteration in order to fetch the related blog for each entry. blogs . add ( e . blog ) The order of filter() and select_related() chaining isn’t important.\nThese querysets are equivalent: Entry . objects . filter ( pub_date__gt = timezone . now ()) . select_related ( \"blog\" ) Entry . objects . select_related ( \"blog\" ) . filter ( pub_date__gt = timezone . now ()) You can follow foreign keys in a similar way to querying them. If you have the\nfollowing models: from django.db import models class City ( models . Model ): # ... pass class Person ( models . Model ): # ... hometown = models . ForeignKey ( City , on_delete = models . SET_NULL , blank = True , null = True , ) class Book ( models . Model ): # ... author = models . ForeignKey ( Person , on_delete = models . CASCADE ) … then a call to Book.objects.select_related('author__hometown').get(id=4) will cache the related Person and the related City : # Hits the database with joins to the author and hometown tables. b = Book . objects . select_related ( \"author__hometown\" ) . get ( id = 4 ) p = b . author # Doesn't hit the database. c = p . hometown # Doesn't hit the database. # Without select_related()... b = Book . objects . get ( id = 4 ) # Hits the database. p = b . author # Hits the database. c = p . hometown # Hits the database. You can refer to any ForeignKey or OneToOneField relation in the list of fields\npassed to select_related() . You can also refer to the reverse direction of a OneToOneField in the list of fields passed to select_related — that is, you can traverse a OneToOneField back to the object on which the field\nis defined. Instead of specifying the field name, use the related_name for the field on the related object. There may be some situations where you wish to call select_related() with a\nlot of related objects, or where you don’t know all of the relations. In these\ncases it is possible to call select_related() with no arguments. This will\nfollow all non-null foreign keys it can find - nullable foreign keys must be\nspecified. This is not recommended in most cases as it is likely to make the\nunderlying query more complex, and return more data, than is actually needed. If you need to clear the list of related fields added by past calls of select_related on a QuerySet , you can pass None as a parameter: >>> without_relations = queryset . select_related ( None ) Chaining select_related calls works in a similar way to other methods -\nthat is that select_related('foo', 'bar') is equivalent to select_related('foo').select_related('bar') . prefetch_related() ¶ prefetch_related ( * lookups ) ¶ Returns a QuerySet that will automatically retrieve, in a single batch,\nrelated objects for each of the specified lookups. This has a similar purpose to select_related , in that both are designed to\nstop the deluge of database queries that is caused by accessing related objects,\nbut the strategy is quite different. select_related works by creating an SQL join and including the fields of the\nrelated object in the SELECT statement. For this reason, select_related gets the related objects in the same database query. However, to avoid the much\nlarger result set that would result from joining across a ‘many’ relationship, select_related is limited to single-valued relationships - foreign key and\none-to-one. prefetch_related , on the other hand, does a separate lookup for each\nrelationship, and does the ‘joining’ in Python. This allows it to prefetch\nmany-to-many, many-to-one, and GenericRelation objects which\ncannot be done using select_related , in addition to the foreign key and\none-to-one relationships that are supported by select_related . It also\nsupports prefetching of GenericForeignKey , however, the\nqueryset for each ContentType must be provided in the querysets parameter of GenericPrefetch . Changed in Django 5.0: Support for prefetching GenericForeignKey with\nnon-homogeneous set of results was added. For example, suppose you have these models: from django.db import models class Topping ( models . Model ): name = models . CharField ( max_length = 30 ) class Pizza ( models . Model ): name = models . CharField ( max_length = 50 ) toppings = models . ManyToManyField ( Topping ) def __str__ ( self ): return \" %s ( %s )\" % ( self . name , \", \" . join ( topping . name for topping in self . toppings . all ()), ) and run: >>> Pizza . objects . all () [\"Hawaiian (ham, pineapple)\", \"Seafood (prawns, smoked salmon)\"... The problem with this is that every time Pizza.__str__() asks for self.toppings.all() it has to query the database, so Pizza.objects.all() will run a query on the Toppings table for every item in the Pizza QuerySet . We can reduce to just two queries using prefetch_related : >>> Pizza . objects . prefetch_related ( \"toppings\" ) This implies a self.toppings.all() for each Pizza ; now each time self.toppings.all() is called, instead of having to go to the database for\nthe items, it will find them in a prefetched QuerySet cache that was\npopulated in a single query. That is, all the relevant toppings will have been fetched in a single query,\nand used to make QuerySets that have a pre-filled cache of the relevant\nresults; these QuerySets are then used in the self.toppings.all() calls. The additional queries in prefetch_related() are executed after the QuerySet has begun to be evaluated and the primary query has been executed. Note that there is no mechanism to prevent another database query from altering\nthe items in between the execution of the primary query and the additional\nqueries, which could produce an inconsistent result. For example, if a Pizza is deleted after the primary query has executed, its toppings will\nnot be returned in the additional query, and it will seem like the pizza has no\ntoppings: >>> Pizza . objects . prefetch_related ( \"toppings\" ) #  \"Hawaiian\" Pizza was deleted in another shell. <QuerySet [<Pizza: Hawaiian ()>, <Pizza: Seafood (prawns, smoked salmon)>]> If you have an iterable of model instances, you can prefetch related attributes\non those instances using the prefetch_related_objects() function. Note that the result cache of the primary QuerySet and all specified related\nobjects will then be fully loaded into memory. This changes the typical\nbehavior of QuerySets , which normally try to avoid loading all objects into\nmemory before they are needed, even after a query has been executed in the\ndatabase. Note Remember that, as always with QuerySets , any subsequent chained methods\nwhich imply a different database query will ignore previously cached\nresults, and retrieve data using a fresh database query. So, if you write\nthe following: >>> pizzas = Pizza . objects . prefetch_related ( \"toppings\" ) >>> [ list ( pizza . toppings . filter ( spicy = True )) for pizza in pizzas ] …then the fact that pizza.toppings.all() has been prefetched will not\nhelp you. The prefetch_related('toppings') implied pizza.toppings.all() , but pizza.toppings.filter() is a new and\ndifferent query. The prefetched cache can’t help here; in fact it hurts\nperformance, since you have done a database query that you haven’t used. So\nuse this feature with caution! Also, if you call the database-altering methods add() , create() , remove() , clear() or set() , on related managers ,\nany prefetched cache for the relation will be cleared. You can also use the normal join syntax to do related fields of related\nfields. Suppose we have an additional model to the example above: class Restaurant ( models . Model ): pizzas = models . ManyToManyField ( Pizza , related_name = \"restaurants\" ) best_pizza = models . ForeignKey ( Pizza , related_name = \"championed_by\" , on_delete = models . CASCADE ) The following are all legal: >>> Restaurant . objects . prefetch_related ( \"pizzas__toppings\" ) This will prefetch all pizzas belonging to restaurants, and all toppings\nbelonging to those pizzas. This will result in a total of 3 database queries -\none for the restaurants, one for the pizzas, and one for the toppings. >>> Restaurant . objects . prefetch_related ( \"best_pizza__toppings\" ) This will fetch the best pizza and all the toppings for the best pizza for each\nrestaurant. This will be done in 3 database queries - one for the restaurants,\none for the ‘best pizzas’, and one for the toppings. The best_pizza relationship could also be fetched using select_related to reduce the query count to 2: >>> Restaurant . objects . select_related ( \"best_pizza\" ) . prefetch_related ( \"best_pizza__toppings\" ) Since the prefetch is executed after the main query (which includes the joins\nneeded by select_related ), it is able to detect that the best_pizza objects have already been fetched, and it will skip fetching them again. Chaining prefetch_related calls will accumulate the lookups that are\nprefetched. To clear any prefetch_related behavior, pass None as a\nparameter: >>> non_prefetched = qs . prefetch_related ( None ) One difference to note when using prefetch_related is that objects created\nby a query can be shared between the different objects that they are related to\ni.e. a single Python model instance can appear at more than one point in the\ntree of objects that are returned. This will normally happen with foreign key\nrelationships. Typically this behavior will not be a problem, and will in fact\nsave both memory and CPU time. While prefetch_related supports prefetching GenericForeignKey relationships, the number of queries will depend on the data. Since a GenericForeignKey can reference data in multiple tables, one query per table\nreferenced is needed, rather than one query for all the items. There could be\nadditional queries on the ContentType table if the relevant rows have not\nalready been fetched. prefetch_related in most cases will be implemented using an SQL query that\nuses the ‘IN’ operator. This means that for a large QuerySet a large ‘IN’ clause\ncould be generated, which, depending on the database, might have performance\nproblems of its own when it comes to parsing or executing the SQL query. Always\nprofile for your use case! If you use iterator() to run the query, prefetch_related() calls will\nonly be observed if a value for chunk_size is provided. You can use the Prefetch object to further control\nthe prefetch operation. In its simplest form Prefetch is equivalent to the traditional string based\nlookups: >>> from django.db.models import Prefetch >>> Restaurant . objects . prefetch_related ( Prefetch ( \"pizzas__toppings\" )) You can provide a custom queryset with the optional queryset argument.\nThis can be used to change the default ordering of the queryset: >>> Restaurant . objects . prefetch_related ( ... Prefetch ( \"pizzas__toppings\" , queryset = Toppings . objects . order_by ( \"name\" )) ... ) Or to call select_related() when\napplicable to reduce the number of queries even further: >>> Pizza . objects . prefetch_related ( ... Prefetch ( \"restaurants\" , queryset = Restaurant . objects . select_related ( \"best_pizza\" )) ... ) You can also assign the prefetched result to a custom attribute with the optional to_attr argument. The result will be stored directly in a list. This allows prefetching the same relation multiple times with a different QuerySet ; for instance: >>> vegetarian_pizzas = Pizza . objects . filter ( vegetarian = True ) >>> Restaurant . objects . prefetch_related ( ... Prefetch ( \"pizzas\" , to_attr = \"menu\" ), ... Prefetch ( \"pizzas\" , queryset = vegetarian_pizzas , to_attr = \"vegetarian_menu\" ), ... ) Lookups created with custom to_attr can still be traversed as usual by other\nlookups: >>> vegetarian_pizzas = Pizza . objects . filter ( vegetarian = True ) >>> Restaurant . objects . prefetch_related ( ... Prefetch ( \"pizzas\" , queryset = vegetarian_pizzas , to_attr = \"vegetarian_menu\" ), ... \"vegetarian_menu__toppings\" , ... ) Using to_attr is recommended when filtering down the prefetch result as it is\nless ambiguous than storing a filtered result in the related manager’s cache: >>> queryset = Pizza . objects . filter ( vegetarian = True ) >>> >>> # Recommended: >>> restaurants = Restaurant . objects . prefetch_related ( ... Prefetch ( \"pizzas\" , queryset = queryset , to_attr = \"vegetarian_pizzas\" ) ... ) >>> vegetarian_pizzas = restaurants [ 0 ] . vegetarian_pizzas >>> >>> # Not recommended: >>> restaurants = Restaurant . objects . prefetch_related ( ... Prefetch ( \"pizzas\" , queryset = queryset ), ... ) >>> vegetarian_pizzas = restaurants [ 0 ] . pizzas . all () Custom prefetching also works with single related relations like\nforward ForeignKey or OneToOneField . Generally you’ll want to use select_related() for these relations, but there are a number of cases\nwhere prefetching with a custom QuerySet is useful: You want to use a QuerySet that performs further prefetching\non related models. You want to prefetch only a subset of the related objects. You want to use performance optimization techniques like deferred fields : >>> queryset = Pizza . objects . only ( \"name\" ) >>> >>> restaurants = Restaurant . objects . prefetch_related ( ... Prefetch ( \"best_pizza\" , queryset = queryset ) ... ) When using multiple databases, Prefetch will respect your choice of\ndatabase. If the inner query does not specify a database, it will use the\ndatabase selected by the outer query. All of the following are valid: >>> # Both inner and outer queries will use the 'replica' database >>> Restaurant . objects . prefetch_related ( \"pizzas__toppings\" ) . using ( \"replica\" ) >>> Restaurant . objects . prefetch_related ( ... Prefetch ( \"pizzas__toppings\" ), ... ) . using ( \"replica\" ) >>> >>> # Inner will use the 'replica' database; outer will use 'default' database >>> Restaurant . objects . prefetch_related ( ... Prefetch ( \"pizzas__toppings\" , queryset = Toppings . objects . using ( \"replica\" )), ... ) >>> >>> # Inner will use 'replica' database; outer will use 'cold-storage' database >>> Restaurant . objects . prefetch_related ( ... Prefetch ( \"pizzas__toppings\" , queryset = Toppings . objects . using ( \"replica\" )), ... ) . using ( \"cold-storage\" ) Note The ordering of lookups matters. Take the following examples: >>> prefetch_related ( \"pizzas__toppings\" , \"pizzas\" ) This works even though it’s unordered because 'pizzas__toppings' already contains all the needed information, therefore the second argument 'pizzas' is actually redundant. >>> prefetch_related ( \"pizzas__toppings\" , Prefetch ( \"pizzas\" , queryset = Pizza . objects . all ())) This will raise a ValueError because of the attempt to redefine the\nqueryset of a previously seen lookup. Note that an implicit queryset was\ncreated to traverse 'pizzas' as part of the 'pizzas__toppings' lookup. >>> prefetch_related ( \"pizza_list__toppings\" , Prefetch ( \"pizzas\" , to_attr = \"pizza_list\" )) This will trigger an AttributeError because 'pizza_list' doesn’t exist yet\nwhen 'pizza_list__toppings' is being processed. This consideration is not limited to the use of Prefetch objects. Some\nadvanced techniques may require that the lookups be performed in a\nspecific order to avoid creating extra queries; therefore it’s recommended\nto always carefully order prefetch_related arguments. extra() ¶ extra ( select = None , where = None , params = None , tables = None , order_by = None , select_params = None ) ¶ Sometimes, the Django query syntax by itself can’t easily express a complex WHERE clause. For these edge cases, Django provides the extra() QuerySet modifier — a hook for injecting specific clauses into the SQL\ngenerated by a QuerySet . Use this method as a last resort This is an old API that we aim to deprecate at some point in the future.\nUse it only if you cannot express your query using other queryset methods.\nIf you do need to use it, please file a ticket using the QuerySet.extra\nkeyword with your use case (please check the list of existing tickets first) so\nthat we can enhance the QuerySet API to allow removing extra() . We are\nno longer improving or fixing bugs for this method. For example, this use of extra() : >>> qs . extra ( ... select = { \"val\" : \"select col from sometable where othercol = %s \" }, ... select_params = ( someparam ,), ... ) is equivalent to: >>> qs . annotate ( val = RawSQL ( \"select col from sometable where othercol = %s \" , ( someparam ,))) The main benefit of using RawSQL is\nthat you can set output_field if needed. The main downside is that if\nyou refer to some table alias of the queryset in the raw SQL, then it is\npossible that Django might change that alias (for example, when the\nqueryset is used as a subquery in yet another query). Warning You should be very careful whenever you use extra() . Every time you use\nit, you should escape any parameters that the user can control by using params in order to protect against SQL injection attacks. You also must not quote placeholders in the SQL string. This example is\nvulnerable to SQL injection because of the quotes around %s : SELECT col FROM sometable WHERE othercol = '%s' # unsafe ! You can read more about how Django’s SQL injection protection works. By definition, these extra lookups may not be portable to different database\nengines (because you’re explicitly writing SQL code) and violate the DRY\nprinciple, so you should avoid them if possible. Specify one or more of params , select , where or tables . None\nof the arguments is required, but you should use at least one of them. select The select argument lets you put extra fields in the SELECT clause.  It should be a dictionary mapping attribute names to SQL\nclauses to use to calculate that attribute. Example: Entry . objects . extra ( select = { \"is_recent\" : \"pub_date > '2006-01-01'\" }) As a result, each Entry object will have an extra attribute, is_recent , a boolean representing whether the entry’s pub_date is greater than Jan. 1, 2006. Django inserts the given SQL snippet directly into the SELECT statement, so the resulting SQL of the above example would be something like: SELECT blog_entry . * , ( pub_date > '2006-01-01' ) AS is_recent FROM blog_entry ; The next example is more advanced; it does a subquery to give each\nresulting Blog object an entry_count attribute, an integer count\nof associated Entry objects: Blog . objects . extra ( select = { \"entry_count\" : \"SELECT COUNT(*) FROM blog_entry WHERE blog_entry.blog_id = blog_blog.id\" }, ) In this particular case, we’re exploiting the fact that the query will\nalready contain the blog_blog table in its FROM clause. The resulting SQL of the above example would be: SELECT blog_blog . * , ( SELECT COUNT ( * ) FROM blog_entry WHERE blog_entry . blog_id = blog_blog . id ) AS entry_count FROM blog_blog ; Note that the parentheses required by most database engines around\nsubqueries are not required in Django’s select clauses. In some rare cases, you might wish to pass parameters to the SQL\nfragments in extra(select=...) . For this purpose, use the select_params parameter. This will work, for example: Blog . objects . extra ( select = { \"a\" : \" %s \" , \"b\" : \" %s \" }, select_params = ( \"one\" , \"two\" ), ) If you need to use a literal %s inside your select string, use\nthe sequence %%s . where / tables You can define explicit SQL WHERE clauses — perhaps to perform\nnon-explicit joins — by using where . You can manually add tables to\nthe SQL FROM clause by using tables . where and tables both take a list of strings. All where parameters are “AND”ed to any other search criteria. Example: Entry . objects . extra ( where = [ \"foo='a' OR bar = 'a'\" , \"baz = 'a'\" ]) …translates (roughly) into the following SQL: SELECT * FROM blog_entry WHERE ( foo = 'a' OR bar = 'a' ) AND ( baz = 'a' ) Be careful when using the tables parameter if you’re specifying\ntables that are already used in the query. When you add extra tables\nvia the tables parameter, Django assumes you want that table\nincluded an extra time, if it is already included. That creates a\nproblem, since the table name will then be given an alias. If a table\nappears multiple times in an SQL statement, the second and subsequent\noccurrences must use aliases so the database can tell them apart. If\nyou’re referring to the extra table you added in the extra where parameter this is going to cause errors. Normally you’ll only be adding extra tables that don’t already appear\nin the query. However, if the case outlined above does occur, there are\na few solutions. First, see if you can get by without including the\nextra table and use the one already in the query. If that isn’t\npossible, put your extra() call at the front of the queryset\nconstruction so that your table is the first use of that table.\nFinally, if all else fails, look at the query produced and rewrite your where addition to use the alias given to your extra table. The\nalias will be the same each time you construct the queryset in the same\nway, so you can rely upon the alias name to not change. order_by If you need to order the resulting queryset using some of the new\nfields or tables you have included via extra() use the order_by parameter to extra() and pass in a sequence of strings. These\nstrings should either be model fields (as in the normal order_by() method on querysets), of the form table_name.column_name or an alias for a column that you specified\nin the select parameter to extra() . For example: q = Entry . objects . extra ( select = { \"is_recent\" : \"pub_date > '2006-01-01'\" }) q = q . extra ( order_by = [ \"-is_recent\" ]) This would sort all the items for which is_recent is true to the\nfront of the result set ( True sorts before False in a\ndescending ordering). This shows, by the way, that you can make multiple calls to extra() and it will behave as you expect (adding new constraints each time). params The where parameter described above may use standard Python\ndatabase string placeholders — '%s' to indicate parameters the\ndatabase engine should automatically quote. The params argument is\na list of any extra parameters to be substituted. Example: Entry . objects . extra ( where = [ \"headline= %s \" ], params = [ \"Lennon\" ]) Always use params instead of embedding values directly into where because params will ensure values are quoted correctly\naccording to your particular backend. For example, quotes will be\nescaped correctly. Bad: Entry . objects . extra ( where = [ \"headline='Lennon'\" ]) Good: Entry . objects . extra ( where = [ \"headline= %s \" ], params = [ \"Lennon\" ]) Warning If you are performing queries on MySQL, note that MySQL’s silent type coercion\nmay cause unexpected results when mixing types. If you query on a string\ntype column, but with an integer value, MySQL will coerce the types of all values\nin the table to an integer before performing the comparison. For example, if your\ntable contains the values 'abc' , 'def' and you query for WHERE mycolumn=0 ,\nboth rows will match. To prevent this, perform the correct typecasting\nbefore using the value in a query. defer() ¶ defer ( * fields ) ¶ In some complex data-modeling situations, your models might contain a lot of\nfields, some of which could contain a lot of data (for example, text fields),\nor require expensive processing to convert them to Python objects. If you are\nusing the results of a queryset in some situation where you don’t know\nif you need those particular fields when you initially fetch the data, you can\ntell Django not to retrieve them from the database. This is done by passing the names of the fields to not load to defer() : Entry . objects . defer ( \"headline\" , \"body\" ) A queryset that has deferred fields will still return model instances. Each\ndeferred field will be retrieved from the database if you access that field\n(one at a time, not all the deferred fields at once). Note Deferred fields will not lazy-load like this from asynchronous code.\nInstead, you will get a SynchronousOnlyOperation exception. If you are\nwriting asynchronous code, you should not try to access any fields that you defer() . You can make multiple calls to defer() . Each call adds new fields to the\ndeferred set: # Defers both the body and headline fields. Entry . objects . defer ( \"body\" ) . filter ( rating = 5 ) . defer ( \"headline\" ) The order in which fields are added to the deferred set does not matter.\nCalling defer() with a field name that has already been deferred is\nharmless (the field will still be deferred). You can defer loading of fields in related models (if the related models are\nloading via select_related() ) by using the standard double-underscore\nnotation to separate related fields: Blog . objects . select_related () . defer ( \"entry__headline\" , \"entry__body\" ) If you want to clear the set of deferred fields, pass None as a parameter\nto defer() : # Load all fields immediately. my_queryset . defer ( None ) Some fields in a model won’t be deferred, even if you ask for them. You can\nnever defer the loading of the primary key. If you are using select_related() to retrieve related models, you shouldn’t defer the\nloading of the field that connects from the primary model to the related\none, doing so will result in an error. Similarly, calling defer() (or its counterpart only() ) including an\nargument from an aggregation (e.g. using the result of annotate() )\ndoesn’t make sense: doing so will raise an exception. The aggregated values\nwill always be fetched into the resulting queryset. Note The defer() method (and its cousin, only() , below) are only for\nadvanced use-cases. They provide an optimization for when you have analyzed\nyour queries closely and understand exactly what information you need and\nhave measured that the difference between returning the fields you need and\nthe full set of fields for the model will be significant. Even if you think you are in the advanced use-case situation, only use defer() when you cannot, at queryset load time, determine if you will\nneed the extra fields or not . If you are frequently loading and using a\nparticular subset of your data, the best choice you can make is to\nnormalize your models and put the non-loaded data into a separate model\n(and database table). If the columns must stay in the one table for some\nreason, create a model with Meta.managed = False (see the managed attribute documentation)\ncontaining just the fields you normally need to load and use that where you\nmight otherwise call defer() . This makes your code more explicit to the\nreader, is slightly faster and consumes a little less memory in the Python\nprocess. For example, both of these models use the same underlying database table: class CommonlyUsedModel ( models . Model ): f1 = models . CharField ( max_length = 10 ) class Meta : managed = False db_table = \"app_largetable\" class ManagedModel ( models . Model ): f1 = models . CharField ( max_length = 10 ) f2 = models . CharField ( max_length = 10 ) class Meta : db_table = \"app_largetable\" # Two equivalent QuerySets: CommonlyUsedModel . objects . all () ManagedModel . objects . defer ( \"f2\" ) If many fields need to be duplicated in the unmanaged model, it may be best\nto create an abstract model with the shared fields and then have the\nunmanaged and managed models inherit from the abstract model. Note When calling save() for instances with\ndeferred fields, only the loaded fields will be saved. See save() for more details. only() ¶ only ( * fields ) ¶ The only() method is essentially the opposite of defer() . Only the\nfields passed into this method and that are not already specified as deferred\nare loaded immediately when the queryset is evaluated. If you have a model where almost all the fields need to be deferred, using only() to specify the complementary set of fields can result in simpler\ncode. Suppose you have a model with fields name , age and biography . The\nfollowing two querysets are the same, in terms of deferred fields: Person . objects . defer ( \"age\" , \"biography\" ) Person . objects . only ( \"name\" ) Whenever you call only() it replaces the set of fields to load\nimmediately. The method’s name is mnemonic: only those fields are loaded\nimmediately; the remainder are deferred. Thus, successive calls to only() result in only the final fields being considered: # This will defer all fields except the headline. Entry . objects . only ( \"body\" , \"rating\" ) . only ( \"headline\" ) Since defer() acts incrementally (adding fields to the deferred list), you\ncan combine calls to only() and defer() and things will behave\nlogically: # Final result is that everything except \"headline\" is deferred. Entry . objects . only ( \"headline\" , \"body\" ) . defer ( \"body\" ) # Final result loads headline immediately. Entry . objects . defer ( \"body\" ) . only ( \"headline\" , \"body\" ) All of the cautions in the note for the defer() documentation apply to only() as well. Use it cautiously and only after exhausting your other\noptions. Using only() and omitting a field requested using select_related() is\nan error as well. On the other hand, invoking only() without any arguments,\nwill return every field (including annotations) fetched by the queryset. As with defer() , you cannot access the non-loaded fields from asynchronous\ncode and expect them to load. Instead, you will get a SynchronousOnlyOperation exception. Ensure that all fields you might access\nare in your only() call. Note When calling save() for instances with\ndeferred fields, only the loaded fields will be saved. See save() for more details. Note When using defer() after only() the fields in defer() will\noverride only() for fields that are listed in both. using() ¶ using ( alias ) ¶ This method is for controlling which database the QuerySet will be\nevaluated against if you are using more than one database.  The only argument\nthis method takes is the alias of a database, as defined in DATABASES . For example: # queries the database with the 'default' alias. >>> Entry . objects . all () # queries the database with the 'backup' alias >>> Entry . objects . using ( \"backup\" ) select_for_update() ¶ select_for_update ( nowait = False , skip_locked = False , of = () , no_key = False ) ¶ Returns a queryset that will lock rows until the end of the transaction,\ngenerating a SELECT ... FOR UPDATE SQL statement on supported databases. For example: from django.db import transaction entries = Entry . objects . select_for_update () . filter ( author = request . user ) with transaction . atomic (): for entry in entries : ... When the queryset is evaluated ( for entry in entries in this case), all\nmatched entries will be locked until the end of the transaction block, meaning\nthat other transactions will be prevented from changing or acquiring locks on\nthem. Usually, if another transaction has already acquired a lock on one of the\nselected rows, the query will block until the lock is released. If this is\nnot the behavior you want, call select_for_update(nowait=True) . This will\nmake the call non-blocking. If a conflicting lock is already acquired by\nanother transaction, DatabaseError will be raised when the\nqueryset is evaluated. You can also ignore locked rows by using select_for_update(skip_locked=True) instead. The nowait and skip_locked are mutually exclusive and attempts to call select_for_update() with both options enabled will result in a ValueError . By default, select_for_update() locks all rows that are selected by the\nquery. For example, rows of related objects specified in select_related() are locked in addition to rows of the queryset’s model. If this isn’t desired,\nspecify the related objects you want to lock in select_for_update(of=(...)) using the same fields syntax as select_related() . Use the value 'self' to refer to the queryset’s model. Lock parents models in select_for_update(of=(...)) If you want to lock parents models when using multi-table inheritance , you must specify parent link fields (by default <parent_model_name>_ptr ) in the of argument. For example: Restaurant . objects . select_for_update ( of = ( \"self\" , \"place_ptr\" )) Using select_for_update(of=(...)) with specified fields If you want to lock models and specify selected fields, e.g. using values() , you must select at least one field from each model in the of argument. Models without selected fields will not be locked. On PostgreSQL only, you can pass no_key=True in order to acquire a weaker\nlock, that still allows creating rows that merely reference locked rows\n(through a foreign key, for example) while the lock is in place. The\nPostgreSQL documentation has more details about row-level lock modes . You can’t use select_for_update() on nullable relations: >>> Person . objects . select_related ( \"hometown\" ) . select_for_update () Traceback (most recent call last): ... django.db.utils.NotSupportedError : FOR UPDATE cannot be applied to the nullable side of an outer join To avoid that restriction, you can exclude null objects if you don’t care about\nthem: >>> Person . objects . select_related ( \"hometown\" ) . select_for_update () . exclude ( hometown = None ) <QuerySet [<Person: ...)>, ...]> The postgresql , oracle , and mysql database backends support select_for_update() . However, MariaDB only supports the nowait argument, MariaDB 10.6+ also supports the skip_locked argument, and MySQL\nsupports the nowait , skip_locked , and of arguments. The no_key argument is only supported on PostgreSQL. Passing nowait=True , skip_locked=True , no_key=True , or of to select_for_update() using database backends that do not support these\noptions, such as MySQL, raises a NotSupportedError . This\nprevents code from unexpectedly blocking. Evaluating a queryset with select_for_update() in autocommit mode on\nbackends which support SELECT ... FOR UPDATE is a TransactionManagementError error because the\nrows are not locked in that case. If allowed, this would facilitate data\ncorruption and could easily be caused by calling code that expects to be run in\na transaction outside of one. Using select_for_update() on backends which do not support SELECT ... FOR UPDATE (such as SQLite) will have no effect. SELECT ... FOR UPDATE will not be added to the query, and an error isn’t\nraised if select_for_update() is used in autocommit mode. Warning Although select_for_update() normally fails in autocommit mode, since TestCase automatically wraps each test in a\ntransaction, calling select_for_update() in a TestCase even outside\nan atomic() block will (perhaps unexpectedly)\npass without raising a TransactionManagementError . To properly test select_for_update() you should use TransactionTestCase . Certain expressions may not be supported PostgreSQL doesn’t support select_for_update() with Window expressions. raw() ¶ raw ( raw_query , params = () , translations = None , using = None ) ¶ Takes a raw SQL query, executes it, and returns a django.db.models.query.RawQuerySet instance. This RawQuerySet instance\ncan be iterated over just like a normal QuerySet to provide object\ninstances. See the Performing raw SQL queries for more information. Warning raw() always triggers a new query and doesn’t account for previous\nfiltering. As such, it should generally be called from the Manager or\nfrom a fresh QuerySet instance. Operators that return new QuerySet s ¶ Combined querysets must use the same model. AND ( & ) ¶ Combines two QuerySet s using the SQL AND operator in a manner similar\nto chaining filters. The following are equivalent: Model . objects . filter ( x = 1 ) & Model . objects . filter ( y = 2 ) Model . objects . filter ( x = 1 ) . filter ( y = 2 ) SQL equivalent: SELECT ... WHERE x = 1 AND y = 2 OR ( | ) ¶ Combines two QuerySet s using the SQL OR operator. The following are equivalent: Model . objects . filter ( x = 1 ) | Model . objects . filter ( y = 2 ) from django.db.models import Q Model . objects . filter ( Q ( x = 1 ) | Q ( y = 2 )) SQL equivalent: SELECT ... WHERE x = 1 OR y = 2 | is not a commutative operation, as different (though equivalent) queries\nmay be generated. XOR ( ^ ) ¶ Combines two QuerySet s using the SQL XOR operator. A XOR expression matches rows that are matched by an odd number of operands. The following are equivalent: Model . objects . filter ( x = 1 ) ^ Model . objects . filter ( y = 2 ) from django.db.models import Q Model . objects . filter ( Q ( x = 1 ) ^ Q ( y = 2 )) SQL equivalent: SELECT ... WHERE x = 1 XOR y = 2 Note XOR is natively supported on MariaDB and MySQL. On other databases, x ^ y ^ ... ^ z is converted to an equivalent: ( x OR y OR ... OR z ) AND 1 = MOD ( ( CASE WHEN x THEN 1 ELSE 0 END ) + ( CASE WHEN y THEN 1 ELSE 0 END ) + ... ( CASE WHEN z THEN 1 ELSE 0 END ), 2 ) Changed in Django 5.0: In older versions, on databases without native support for the SQL XOR operator, XOR returned rows that were matched by exactly\none operand. The previous behavior was not consistent with MySQL,\nMariaDB, and Python behavior. Methods that do not return QuerySet s ¶ The following QuerySet methods evaluate the QuerySet and return\nsomething other than a QuerySet . These methods do not use a cache (see Caching and QuerySets ). Rather,\nthey query the database each time they’re called. Because these methods evaluate the QuerySet, they are blocking calls, and so\ntheir main (synchronous) versions cannot be called from asynchronous code. For\nthis reason, each has a corresponding asynchronous version with an a prefix\n- for example, rather than get(…) you can await aget(…) . There is usually no difference in behavior apart from their asynchronous\nnature, but any differences are noted below next to each method. get() ¶ get ( * args , ** kwargs ) ¶ aget ( * args , ** kwargs ) ¶ Asynchronous version : aget() Returns the object matching the given lookup parameters, which should be in\nthe format described in Field lookups . You should use lookups that are\nguaranteed unique, such as the primary key or fields in a unique constraint.\nFor example: Entry . objects . get ( id = 1 ) Entry . objects . get ( Q ( blog = blog ) & Q ( entry_number = 1 )) If you expect a queryset to already return one row, you can use get() without any arguments to return the object for that row: Entry . objects . filter ( pk = 1 ) . get () If get() doesn’t find any object, it raises a Model.DoesNotExist exception: Entry . objects . get ( id =- 999 ) # raises Entry.DoesNotExist If get() finds more than one object, it raises a Model.MultipleObjectsReturned exception: Entry . objects . get ( name = \"A Duplicated Name\" ) # raises Entry.MultipleObjectsReturned Both these exception classes are attributes of the model class, and specific to\nthat model. If you want to handle such exceptions from several get() calls\nfor different models, you can use their generic base classes. For example, you\ncan use django.core.exceptions.ObjectDoesNotExist to handle DoesNotExist exceptions from multiple models: from django.core.exceptions import ObjectDoesNotExist try : blog = Blog . objects . get ( id = 1 ) entry = Entry . objects . get ( blog = blog , entry_number = 1 ) except ObjectDoesNotExist : print ( \"Either the blog or entry doesn't exist.\" ) create() ¶ create ( ** kwargs ) ¶ acreate ( ** kwargs ) ¶ Asynchronous version : acreate() A convenience method for creating an object and saving it all in one step.  Thus: p = Person . objects . create ( first_name = \"Bruce\" , last_name = \"Springsteen\" ) and: p = Person ( first_name = \"Bruce\" , last_name = \"Springsteen\" ) p . save ( force_insert = True ) are equivalent. The force_insert parameter is documented\nelsewhere, but all it means is that a new object will always be created.\nNormally you won’t need to worry about this. However, if your model contains a\nmanual primary key value that you set and if that value already exists in the\ndatabase, a call to create() will fail with an IntegrityError since primary keys must be unique. Be\nprepared to handle the exception if you are using manual primary keys. get_or_create() ¶ get_or_create ( defaults = None , ** kwargs ) ¶ aget_or_create ( defaults = None , ** kwargs ) ¶ Asynchronous version : aget_or_create() A convenience method for looking up an object with the given kwargs (may be\nempty if your model has defaults for all fields), creating one if necessary. Returns a tuple of (object, created) , where object is the retrieved or\ncreated object and created is a boolean specifying whether a new object was\ncreated. This is meant to prevent duplicate objects from being created when requests are\nmade in parallel, and as a shortcut to boilerplatish code. For example: try : obj = Person . objects . get ( first_name = \"John\" , last_name = \"Lennon\" ) except Person . DoesNotExist : obj = Person ( first_name = \"John\" , last_name = \"Lennon\" , birthday = date ( 1940 , 10 , 9 )) obj . save () Here, with concurrent requests, multiple attempts to save a Person with\nthe same parameters may be made. To avoid this race condition, the above\nexample can be rewritten using get_or_create() like so: obj , created = Person . objects . get_or_create ( first_name = \"John\" , last_name = \"Lennon\" , defaults = { \"birthday\" : date ( 1940 , 10 , 9 )}, ) Any keyword arguments passed to get_or_create() — except an optional one\ncalled defaults — will be used in a get() call. If an object is\nfound, get_or_create() returns a tuple of that object and False . Warning This method is atomic assuming that the database enforces uniqueness of the\nkeyword arguments (see unique or unique_together ). If the fields used in the\nkeyword arguments do not have a uniqueness constraint, concurrent calls to\nthis method may result in multiple rows with the same parameters being\ninserted. You can specify more complex conditions for the retrieved object by chaining get_or_create() with filter() and using Q objects . For example, to retrieve Robert or Bob Marley if either\nexists, and create the latter otherwise: from django.db.models import Q obj , created = Person . objects . filter ( Q ( first_name = \"Bob\" ) | Q ( first_name = \"Robert\" ), ) . get_or_create ( last_name = \"Marley\" , defaults = { \"first_name\" : \"Bob\" }) If multiple objects are found, get_or_create() raises MultipleObjectsReturned . If an object is not found, get_or_create() will instantiate and save a new object, returning a\ntuple of the new object and True . The new object will be created roughly\naccording to this algorithm: params = { k : v for k , v in kwargs . items () if \"__\" not in k } params . update ({ k : v () if callable ( v ) else v for k , v in defaults . items ()}) obj = self . model ( ** params ) obj . save () In English, that means start with any non- 'defaults' keyword argument that\ndoesn’t contain a double underscore (which would indicate a non-exact lookup).\nThen add the contents of defaults , overriding any keys if necessary, and\nuse the result as the keyword arguments to the model class. If there are any\ncallables in defaults , evaluate them. As hinted at above, this is a\nsimplification of the algorithm that is used, but it contains all the pertinent\ndetails. The internal implementation has some more error-checking than this and\nhandles some extra edge-conditions; if you’re interested, read the code. If you have a field named defaults and want to use it as an exact lookup in get_or_create() , use 'defaults__exact' , like so: Foo . objects . get_or_create ( defaults__exact = \"bar\" , defaults = { \"defaults\" : \"baz\" }) The get_or_create() method has similar error behavior to create() when you’re using manually specified primary keys. If an object needs to be\ncreated and the key already exists in the database, an IntegrityError will be raised. Finally, a word on using get_or_create() in Django views. Please make sure\nto use it only in POST requests unless you have a good reason not to. GET requests shouldn’t have any effect on data. Instead, use POST whenever a request to a page has a side effect on your data. For more, see Safe methods in the HTTP spec. Warning You can use get_or_create() through ManyToManyField attributes and reverse relations. In that case you will restrict the queries\ninside the context of that relation. That could lead you to some integrity\nproblems if you don’t use it consistently. Being the following models: class Chapter ( models . Model ): title = models . CharField ( max_length = 255 , unique = True ) class Book ( models . Model ): title = models . CharField ( max_length = 256 ) chapters = models . ManyToManyField ( Chapter ) You can use get_or_create() through Book’s chapters field, but it only\nfetches inside the context of that book: >>> book = Book . objects . create ( title = \"Ulysses\" ) >>> book . chapters . get_or_create ( title = \"Telemachus\" ) (<Chapter: Telemachus>, True) >>> book . chapters . get_or_create ( title = \"Telemachus\" ) (<Chapter: Telemachus>, False) >>> Chapter . objects . create ( title = \"Chapter 1\" ) <Chapter: Chapter 1> >>> book . chapters . get_or_create ( title = \"Chapter 1\" ) # Raises IntegrityError This is happening because it’s trying to get or create “Chapter 1” through the\nbook “Ulysses”, but it can’t do any of them: the relation can’t fetch that\nchapter because it isn’t related to that book, but it can’t create it either\nbecause title field should be unique. update_or_create() ¶ update_or_create ( defaults = None , create_defaults = None , ** kwargs ) ¶ aupdate_or_create ( defaults = None , create_defaults = None , ** kwargs ) ¶ Asynchronous version : aupdate_or_create() A convenience method for updating an object with the given kwargs , creating\na new one if necessary. Both create_defaults and defaults are\ndictionaries of (field, value) pairs. The values in both create_defaults and defaults can be callables. defaults is used to update the object\nwhile create_defaults are used for the create operation. If create_defaults is not supplied, defaults will be used for the create\noperation. Returns a tuple of (object, created) , where object is the created or\nupdated object and created is a boolean specifying whether a new object was\ncreated. The update_or_create method tries to fetch an object from database based on\nthe given kwargs . If a match is found, it updates the fields passed in the defaults dictionary. This is meant as a shortcut to boilerplatish code. For example: defaults = { \"first_name\" : \"Bob\" } create_defaults = { \"first_name\" : \"Bob\" , \"birthday\" : date ( 1940 , 10 , 9 )} try : obj = Person . objects . get ( first_name = \"John\" , last_name = \"Lennon\" ) for key , value in defaults . items (): setattr ( obj , key , value ) obj . save () except Person . DoesNotExist : new_values = { \"first_name\" : \"John\" , \"last_name\" : \"Lennon\" } new_values . update ( create_defaults ) obj = Person ( ** new_values ) obj . save () This pattern gets quite unwieldy as the number of fields in a model goes up.\nThe above example can be rewritten using update_or_create() like so: obj , created = Person . objects . update_or_create ( first_name = \"John\" , last_name = \"Lennon\" , defaults = { \"first_name\" : \"Bob\" }, create_defaults = { \"first_name\" : \"Bob\" , \"birthday\" : date ( 1940 , 10 , 9 )}, ) For a detailed description of how names passed in kwargs are resolved, see get_or_create() . As described above in get_or_create() , this method is prone to a\nrace-condition which can result in multiple rows being inserted simultaneously\nif uniqueness is not enforced at the database level. Like get_or_create() and create() , if you’re using manually\nspecified primary keys and an object needs to be created but the key already\nexists in the database, an IntegrityError is raised. Changed in Django 5.0: The create_defaults argument was added. bulk_create() ¶ bulk_create ( objs , batch_size = None , ignore_conflicts = False , update_conflicts = False , update_fields = None , unique_fields = None ) ¶ abulk_create ( objs , batch_size = None , ignore_conflicts = False , update_conflicts = False , update_fields = None , unique_fields = None ) ¶ Asynchronous version : abulk_create() This method inserts the provided list of objects into the database in an\nefficient manner (generally only 1 query, no matter how many objects there\nare), and returns created objects as a list, in the same order as provided: >>> objs = Entry . objects . bulk_create ( ... [ ... Entry ( headline = \"This is a test\" ), ... Entry ( headline = \"This is only a test\" ), ... ] ... ) This has a number of caveats though: The model’s save() method will not be called, and the pre_save and post_save signals will not be sent. It does not work with child models in a multi-table inheritance scenario. If the model’s primary key is an AutoField and ignore_conflicts is False, the primary key attribute can only be\nretrieved on certain databases (currently PostgreSQL, MariaDB, and SQLite\n3.35+). On other databases, it will not be set. It does not work with many-to-many relationships. It casts objs to a list, which fully evaluates objs if it’s a\ngenerator. The cast allows inspecting all objects so that any objects with a\nmanually set primary key can be inserted first. If you want to insert objects\nin batches without evaluating the entire generator at once, you can use this\ntechnique as long as the objects don’t have any manually set primary keys: from itertools import islice batch_size = 100 objs = ( Entry ( headline = \"Test %s \" % i ) for i in range ( 1000 )) while True : batch = list ( islice ( objs , batch_size )) if not batch : break Entry . objects . bulk_create ( batch , batch_size ) The batch_size parameter controls how many objects are created in a single\nquery. The default is to create all objects in one batch, except for SQLite\nwhere the default is such that at most 999 variables per query are used. On databases that support it (all but Oracle), setting the ignore_conflicts parameter to True tells the database to ignore failure to insert any rows\nthat fail constraints such as duplicate unique values. On databases that support it (all except Oracle), setting the update_conflicts parameter to True , tells the database to update update_fields when a row insertion fails on conflicts. On PostgreSQL and\nSQLite, in addition to update_fields , a list of unique_fields that may\nbe in conflict must be provided. Enabling the ignore_conflicts parameter disables setting the primary key on\neach model instance (if the database normally supports it). Changed in Django 5.0: In older versions, enabling the update_conflicts parameter prevented\nsetting the primary key on each model instance. Warning On MySQL and MariaDB, setting the ignore_conflicts parameter to True turns certain types of errors, other than duplicate key, into\nwarnings. Even with Strict Mode. For example: invalid values or\nnon-nullable violations. See the MySQL documentation and MariaDB documentation for more details. bulk_update() ¶ bulk_update ( objs , fields , batch_size = None ) ¶ abulk_update ( objs , fields , batch_size = None ) ¶ Asynchronous version : abulk_update() This method efficiently updates the given fields on the provided model\ninstances, generally with one query, and returns the number of objects\nupdated: >>> objs = [ ... Entry . objects . create ( headline = \"Entry 1\" ), ... Entry . objects . create ( headline = \"Entry 2\" ), ... ] >>> objs [ 0 ] . headline = \"This is entry 1\" >>> objs [ 1 ] . headline = \"This is entry 2\" >>> Entry . objects . bulk_update ( objs , [ \"headline\" ]) 2 QuerySet.update() is used to save the changes, so this is more efficient\nthan iterating through the list of models and calling save() on each of\nthem, but it has a few caveats: You cannot update the model’s primary key. Each model’s save() method isn’t called, and the pre_save and post_save signals aren’t sent. If updating a large number of columns in a large number of rows, the SQL\ngenerated can be very large. Avoid this by specifying a suitable batch_size . Updating fields defined on multi-table inheritance ancestors will incur an\nextra query per ancestor. When an individual batch contains duplicates, only the first instance in that\nbatch will result in an update. The number of objects updated returned by the function may be fewer than the\nnumber of objects passed in. This can be due to duplicate objects passed in\nwhich are updated in the same batch or race conditions such that objects are\nno longer present in the database. The batch_size parameter controls how many objects are saved in a single\nquery. The default is to update all objects in one batch, except for SQLite\nand Oracle which have restrictions on the number of variables used in a query. count() ¶ count () ¶ acount () ¶ Asynchronous version : acount() Returns an integer representing the number of objects in the database matching\nthe QuerySet . Example: # Returns the total number of entries in the database. Entry . objects . count () # Returns the number of entries whose headline contains 'Lennon' Entry . objects . filter ( headline__contains = \"Lennon\" ) . count () A count() call performs a SELECT COUNT(*) behind the scenes, so you\nshould always use count() rather than loading all of the record into Python\nobjects and calling len() on the result (unless you need to load the\nobjects into memory anyway, in which case len() will be faster). Note that if you want the number of items in a QuerySet and are also\nretrieving model instances from it (for example, by iterating over it), it’s\nprobably more efficient to use len(queryset) which won’t cause an extra\ndatabase query like count() would. If the queryset has already been fully retrieved, count() will use that\nlength rather than perform an extra database query. in_bulk() ¶ in_bulk ( id_list = None , * , field_name = 'pk' ) ¶ ain_bulk ( id_list = None , * , field_name = 'pk' ) ¶ Asynchronous version : ain_bulk() Takes a list of field values ( id_list ) and the field_name for those\nvalues, and returns a dictionary mapping each value to an instance of the\nobject with the given field value. No django.core.exceptions.ObjectDoesNotExist exceptions will ever be raised\nby in_bulk ; that is, any id_list value not matching any instance will\nsimply be ignored. If id_list isn’t provided, all objects\nin the queryset are returned. field_name must be a unique field or a\ndistinct field (if there’s only one field specified in distinct() ). field_name defaults to the primary key. Example: >>> Blog . objects . in_bulk ([ 1 ]) {1: <Blog: Beatles Blog>} >>> Blog . objects . in_bulk ([ 1 , 2 ]) {1: <Blog: Beatles Blog>, 2: <Blog: Cheddar Talk>} >>> Blog . objects . in_bulk ([]) {} >>> Blog . objects . in_bulk () {1: <Blog: Beatles Blog>, 2: <Blog: Cheddar Talk>, 3: <Blog: Django Weblog>} >>> Blog . objects . in_bulk ([ \"beatles_blog\" ], field_name = \"slug\" ) {'beatles_blog': <Blog: Beatles Blog>} >>> Blog . objects . distinct ( \"name\" ) . in_bulk ( field_name = \"name\" ) {'Beatles Blog': <Blog: Beatles Blog>, 'Cheddar Talk': <Blog: Cheddar Talk>, 'Django Weblog': <Blog: Django Weblog>} If you pass in_bulk() an empty list, you’ll get an empty dictionary. iterator() ¶ iterator ( chunk_size = None ) ¶ aiterator ( chunk_size = None ) ¶ Asynchronous version : aiterator() Evaluates the QuerySet (by performing the query) and returns an iterator\n(see PEP 234 ) over the results, or an asynchronous iterator (see PEP 492 )\nif you call its asynchronous version aiterator . A QuerySet typically caches its results internally so that repeated\nevaluations do not result in additional queries. In contrast, iterator() will read results directly, without doing any caching at the QuerySet level\n(internally, the default iterator calls iterator() and caches the return\nvalue). For a QuerySet which returns a large number of objects that you\nonly need to access once, this can result in better performance and a\nsignificant reduction in memory. Note that using iterator() on a QuerySet which has already been\nevaluated will force it to evaluate again, repeating the query. iterator() is compatible with previous calls to prefetch_related() as\nlong as chunk_size is given. Larger values will necessitate fewer queries\nto accomplish the prefetching at the cost of greater memory usage. Changed in Django 5.0: Support for aiterator() with previous calls to prefetch_related() was added. On some databases (e.g. Oracle, SQLite ), the maximum number\nof terms in an SQL IN clause might be limited. Hence values below this\nlimit should be used. (In particular, when prefetching across two or more\nrelations, a chunk_size should be small enough that the anticipated number\nof results for each prefetched relation still falls below the limit.) So long as the QuerySet does not prefetch any related objects, providing no\nvalue for chunk_size will result in Django using an implicit default of\n2000. Depending on the database backend, query results will either be loaded all at\nonce or streamed from the database using server-side cursors. With server-side cursors ¶ Oracle and PostgreSQL use server-side\ncursors to stream results from the database without loading the entire result\nset into memory. The Oracle database driver always uses server-side cursors. With server-side cursors, the chunk_size parameter specifies the number of\nresults to cache at the database driver level. Fetching bigger chunks\ndiminishes the number of round trips between the database driver and the\ndatabase, at the expense of memory. On PostgreSQL, server-side cursors will only be used when the DISABLE_SERVER_SIDE_CURSORS setting is False . Read Transaction pooling and server-side cursors if\nyou’re using a connection pooler configured in transaction pooling mode. When\nserver-side cursors are disabled, the behavior is the same as databases that\ndon’t support server-side cursors. Without server-side cursors ¶ MySQL doesn’t support streaming results, hence the Python database driver loads\nthe entire result set into memory. The result set is then transformed into\nPython row objects by the database adapter using the fetchmany() method\ndefined in PEP 249 . SQLite can fetch results in batches using fetchmany() , but since SQLite\ndoesn’t provide isolation between queries within a connection, be careful when\nwriting to the table being iterated over. See Isolation when using QuerySet.iterator() for\nmore information. The chunk_size parameter controls the size of batches Django retrieves from\nthe database driver. Larger batches decrease the overhead of communicating with\nthe database driver at the expense of a slight increase in memory consumption. So long as the QuerySet does not prefetch any related objects, providing no\nvalue for chunk_size will result in Django using an implicit default of\n2000, a value derived from a calculation on the psycopg mailing list : Assuming rows of 10-20 columns with a mix of textual and numeric data, 2000\nis going to fetch less than 100KB of data, which seems a good compromise\nbetween the number of rows transferred and the data discarded if the loop\nis exited early. latest() ¶ latest ( * fields ) ¶ alatest ( * fields ) ¶ Asynchronous version : alatest() Returns the latest object in the table based on the given field(s). This example returns the latest Entry in the table, according to the pub_date field: Entry . objects . latest ( \"pub_date\" ) You can also choose the latest based on several fields. For example, to select\nthe Entry with the earliest expire_date when two entries have the same pub_date : Entry . objects . latest ( \"pub_date\" , \"-expire_date\" ) The negative sign in '-expire_date' means to sort expire_date in descending order. Since latest() gets the last result, the Entry with\nthe earliest expire_date is selected. If your model’s Meta specifies get_latest_by , you can omit any arguments to earliest() or latest() . The fields specified in get_latest_by will be used by default. Like get() , earliest() and latest() raise DoesNotExist if there is no object with the\ngiven parameters. Note that earliest() and latest() exist purely for convenience and\nreadability. earliest() and latest() may return instances with null dates. Since ordering is delegated to the database, results on fields that allow\nnull values may be ordered differently if you use different databases. For\nexample, PostgreSQL and MySQL sort null values as if they are higher than\nnon-null values, while SQLite does the opposite. You may want to filter out null values: Entry . objects . filter ( pub_date__isnull = False ) . latest ( \"pub_date\" ) earliest() ¶ earliest ( * fields ) ¶ aearliest ( * fields ) ¶ Asynchronous version : aearliest() Works otherwise like latest() except\nthe direction is changed. first() ¶ first () ¶ afirst () ¶ Asynchronous version : afirst() Returns the first object matched by the queryset, or None if there\nis no matching object. If the QuerySet has no ordering defined, then the\nqueryset is automatically ordered by the primary key. This can affect\naggregation results as described in Interaction with order_by() . Example: p = Article . objects . order_by ( \"title\" , \"pub_date\" ) . first () Note that first() is a convenience method, the following code sample is\nequivalent to the above example: try : p = Article . objects . order_by ( \"title\" , \"pub_date\" )[ 0 ] except IndexError : p = None last() ¶ last () ¶ alast () ¶ Asynchronous version : alast() Works like first() , but returns the last object in the queryset. aggregate() ¶ aggregate ( * args , ** kwargs ) ¶ aaggregate ( * args , ** kwargs ) ¶ Asynchronous version : aaggregate() Returns a dictionary of aggregate values (averages, sums, etc.) calculated over\nthe QuerySet . Each argument to aggregate() specifies a value that will\nbe included in the dictionary that is returned. The aggregation functions that are provided by Django are described in Aggregation Functions below. Since aggregates are also query\nexpressions , you may combine aggregates with other\naggregates or values to create complex aggregates. Aggregates specified using keyword arguments will use the keyword as the name\nfor the annotation. Anonymous arguments will have a name generated for them\nbased upon the name of the aggregate function and the model field that is being\naggregated. Complex aggregates cannot use anonymous arguments and must specify\na keyword argument as an alias. For example, when you are working with blog entries, you may want to know the\nnumber of authors that have contributed blog entries: >>> from django.db.models import Count >>> Blog . objects . aggregate ( Count ( \"entry\" )) {'entry__count': 16} By using a keyword argument to specify the aggregate function, you can\ncontrol the name of the aggregation value that is returned: >>> Blog . objects . aggregate ( number_of_entries = Count ( \"entry\" )) {'number_of_entries': 16} For an in-depth discussion of aggregation, see the topic guide on\nAggregation . exists() ¶ exists () ¶ aexists () ¶ Asynchronous version : aexists() Returns True if the QuerySet contains any results, and False if not. This tries to perform the query in the simplest and fastest way\npossible, but it does execute nearly the same query as a normal QuerySet query. exists() is useful for searches relating to the existence of\nany objects in a QuerySet , particularly in the context of a large QuerySet . To find whether a queryset contains any items: if some_queryset . exists (): print ( \"There is at least one object in some_queryset\" ) Which will be faster than: if some_queryset : print ( \"There is at least one object in some_queryset\" ) … but not by a large degree (hence needing a large queryset for efficiency\ngains). Additionally, if a some_queryset has not yet been evaluated, but you know\nthat it will be at some point, then using some_queryset.exists() will do\nmore overall work (one query for the existence check plus an extra one to later\nretrieve the results) than using bool(some_queryset) , which retrieves the\nresults and then checks if any were returned. contains() ¶ contains ( obj ) ¶ acontains ( obj ) ¶ Asynchronous version : acontains() Returns True if the QuerySet contains obj , and False if\nnot. This tries to perform the query in the simplest and fastest way possible. contains() is useful for checking an object membership in a QuerySet , particularly in the context of a large QuerySet . To check whether a queryset contains a specific item: if some_queryset . contains ( obj ): print ( \"Entry contained in queryset\" ) This will be faster than the following which requires evaluating and iterating\nthrough the entire queryset: if obj in some_queryset : print ( \"Entry contained in queryset\" ) Like exists() , if some_queryset has not yet been evaluated, but you\nknow that it will be at some point, then using some_queryset.contains(obj) will make an additional database query, generally resulting in slower overall\nperformance. update() ¶ update ( ** kwargs ) ¶ aupdate ( ** kwargs ) ¶ Asynchronous version : aupdate() Performs an SQL update query for the specified fields, and returns\nthe number of rows matched (which may not be equal to the number of rows\nupdated if some rows already have the new value). For example, to turn comments off for all blog entries published in 2010,\nyou could do this: >>> Entry . objects . filter ( pub_date__year = 2010 ) . update ( comments_on = False ) (This assumes your Entry model has fields pub_date and comments_on .) You can update multiple fields — there’s no limit on how many. For example,\nhere we update the comments_on and headline fields: >>> Entry . objects . filter ( pub_date__year = 2010 ) . update ( ... comments_on = False , headline = \"This is old\" ... ) The update() method is applied instantly, and the only restriction on the QuerySet that is updated is that it can only update columns in the\nmodel’s main table, not on related models. You can’t do this, for example: >>> Entry . objects . update ( blog__name = \"foo\" ) # Won't work! Filtering based on related fields is still possible, though: >>> Entry . objects . filter ( blog__id = 1 ) . update ( comments_on = True ) You cannot call update() on a QuerySet that has had a slice taken\nor can otherwise no longer be filtered. The update() method returns the number of affected rows: >>> Entry . objects . filter ( id = 64 ) . update ( comments_on = True ) 1 >>> Entry . objects . filter ( slug = \"nonexistent-slug\" ) . update ( comments_on = True ) 0 >>> Entry . objects . filter ( pub_date__year = 2010 ) . update ( comments_on = False ) 132 If you’re just updating a record and don’t need to do anything with the model\nobject, the most efficient approach is to call update() , rather than\nloading the model object into memory. For example, instead of doing this: e = Entry . objects . get ( id = 10 ) e . comments_on = False e . save () …do this: Entry . objects . filter ( id = 10 ) . update ( comments_on = False ) Using update() also prevents a race condition wherein something might\nchange in your database in the short period of time between loading the object\nand calling save() . Finally, realize that update() does an update at the SQL level and, thus,\ndoes not call any save() methods on your models, nor does it emit the pre_save or post_save signals (which are a consequence of\ncalling Model.save() ). If you want to\nupdate a bunch of records for a model that has a custom save() method, loop over them and call save() , like this: for e in Entry . objects . filter ( pub_date__year = 2010 ): e . comments_on = False e . save () Ordered queryset ¶ Chaining order_by() with update() is supported only on MariaDB and\nMySQL, and is ignored for different databases. This is useful for updating a\nunique field in the order that is specified without conflicts. For example: Entry . objects . order_by ( \"-number\" ) . update ( number = F ( \"number\" ) + 1 ) Note order_by() clause will be ignored if it contains annotations, inherited\nfields, or lookups spanning relations. delete() ¶ delete () ¶ adelete () ¶ Asynchronous version : adelete() Performs an SQL delete query on all rows in the QuerySet and\nreturns the number of objects deleted and a dictionary with the number of\ndeletions per object type. The delete() is applied instantly. You cannot call delete() on a QuerySet that has had a slice taken or can otherwise no longer be\nfiltered. For example, to delete all the entries in a particular blog: >>> b = Blog . objects . get ( pk = 1 ) # Delete all the entries belonging to this Blog. >>> Entry . objects . filter ( blog = b ) . delete () (4, {'blog.Entry': 2, 'blog.Entry_authors': 2}) By default, Django’s ForeignKey emulates the SQL\nconstraint ON DELETE CASCADE — in other words, any objects with foreign\nkeys pointing at the objects to be deleted will be deleted along with them.\nFor example: >>> blogs = Blog . objects . all () # This will delete all Blogs and all of their Entry objects. >>> blogs . delete () (5, {'blog.Blog': 1, 'blog.Entry': 2, 'blog.Entry_authors': 2}) This cascade behavior is customizable via the on_delete argument to the ForeignKey . The delete() method does a bulk delete and does not call any delete() methods on your models. It does, however, emit the pre_delete and post_delete signals for all deleted objects\n(including cascaded deletions). Django needs to fetch objects into memory to send signals and handle cascades.\nHowever, if there are no cascades and no signals, then Django may take a\nfast-path and delete objects without fetching into memory. For large\ndeletes this can result in significantly reduced memory usage. The amount of\nexecuted queries can be reduced, too. ForeignKeys which are set to on_delete DO_NOTHING do not prevent taking the fast-path in deletion. Note that the queries generated in object deletion is an implementation\ndetail subject to change. as_manager() ¶ classmethod as_manager () ¶ Class method that returns an instance of Manager with a copy of the QuerySet ’s methods. See Creating a manager with QuerySet methods for more details. Note that unlike the other entries in this section, this does not have an\nasynchronous variant as it does not execute a query. explain() ¶ explain ( format = None , ** options ) ¶ aexplain ( format = None , ** options ) ¶ Asynchronous version : aexplain() Returns a string of the QuerySet ’s execution plan, which details how the\ndatabase would execute the query, including any indexes or joins that would be\nused. Knowing these details may help you improve the performance of slow\nqueries. For example, when using PostgreSQL: >>> print ( Blog . objects . filter ( title = \"My Blog\" ) . explain ()) Seq Scan on blog  (cost=0.00..35.50 rows=10 width=12) Filter: (title = 'My Blog'::bpchar) The output differs significantly between databases. explain() is supported by all built-in database backends except Oracle\nbecause an implementation there isn’t straightforward. The format parameter changes the output format from the databases’s\ndefault, which is usually text-based. PostgreSQL supports 'TEXT' , 'JSON' , 'YAML' , and 'XML' formats. MariaDB and MySQL support 'TEXT' (also called 'TRADITIONAL' ) and 'JSON' formats. MySQL\n8.0.16+ also supports an improved 'TREE' format, which is similar to\nPostgreSQL’s 'TEXT' output and is used by default, if supported. Some databases accept flags that can return more information about the query.\nPass these flags as keyword arguments. For example, when using PostgreSQL: >>> print ( Blog . objects . filter ( title = \"My Blog\" ) . explain ( verbose = True , analyze = True )) Seq Scan on public.blog  (cost=0.00..35.50 rows=10 width=12) (actual time=0.004..0.004 rows=10 loops=1) Output: id, title Filter: (blog.title = 'My Blog'::bpchar) Planning time: 0.064 ms Execution time: 0.058 ms On some databases, flags may cause the query to be executed which could have\nadverse effects on your database. For example, the ANALYZE flag supported\nby MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if\nthere are triggers or if a function is called, even for a SELECT query. Changed in Django 5.1: Support for the generic_plan option on PostgreSQL 16+ was added. Field lookups ¶ Field lookups are how you specify the meat of an SQL WHERE clause. They’re\nspecified as keyword arguments to the QuerySet methods filter() , exclude() and get() . For an introduction, see models and database queries documentation . Django’s built-in lookups are listed below. It is also possible to write custom lookups for model fields. As a convenience when no lookup type is provided (like in Entry.objects.get(id=14) ) the lookup type is assumed to be exact . exact ¶ Exact match. If the value provided for comparison is None , it will be\ninterpreted as an SQL NULL (see isnull for more details). Examples: Entry . objects . get ( id__exact = 14 ) Entry . objects . get ( id__exact = None ) SQL equivalents: SELECT ... WHERE id = 14 ; SELECT ... WHERE id IS NULL ; MySQL comparisons In MySQL, a database table’s “collation” setting determines whether exact comparisons are case-sensitive. This is a database setting, not a Django setting. It’s possible to configure your MySQL tables to use\ncase-sensitive comparisons, but some trade-offs are involved. For more\ninformation about this, see the collation section in the databases documentation. iexact ¶ Case-insensitive exact match. If the value provided for comparison is None ,\nit will be interpreted as an SQL NULL (see isnull for more\ndetails). Example: Blog . objects . get ( name__iexact = \"beatles blog\" ) Blog . objects . get ( name__iexact = None ) SQL equivalents: SELECT ... WHERE name ILIKE 'beatles blog' ; SELECT ... WHERE name IS NULL ; Note the first query will match 'Beatles Blog' , 'beatles blog' , 'BeAtLes BLoG' , etc. SQLite users When using the SQLite backend and non-ASCII strings, bear in mind the database note about string comparisons.\nSQLite does not do case-insensitive matching for non-ASCII strings. contains ¶ Case-sensitive containment test. Example: Entry . objects . get ( headline__contains = \"Lennon\" ) SQL equivalent: SELECT ... WHERE headline LIKE '%Lennon%' ; Note this will match the headline 'Lennon honored today' but not 'lennon honored today' . SQLite users SQLite doesn’t support case-sensitive LIKE statements; contains acts like icontains for SQLite. See the database note for more information. icontains ¶ Case-insensitive containment test. Example: Entry . objects . get ( headline__icontains = \"Lennon\" ) SQL equivalent: SELECT ... WHERE headline ILIKE '%Lennon%' ; SQLite users When using the SQLite backend and non-ASCII strings, bear in mind the database note about string comparisons. in ¶ In a given iterable; often a list, tuple, or queryset. It’s not a common use\ncase, but strings (being iterables) are accepted. Examples: Entry . objects . filter ( id__in = [ 1 , 3 , 4 ]) Entry . objects . filter ( headline__in = \"abc\" ) SQL equivalents: SELECT ... WHERE id IN ( 1 , 3 , 4 ); SELECT ... WHERE headline IN ( 'a' , 'b' , 'c' ); You can also use a queryset to dynamically evaluate the list of values\ninstead of providing a list of literal values: inner_qs = Blog . objects . filter ( name__contains = \"Cheddar\" ) entries = Entry . objects . filter ( blog__in = inner_qs ) This queryset will be evaluated as subselect statement: SELECT ... WHERE blog . id IN ( SELECT id FROM ... WHERE NAME LIKE '%Cheddar%' ) If you pass in a QuerySet resulting from values() or values_list() as the value to an __in lookup, you need to ensure you are only extracting\none field in the result. For example, this will work (filtering on the blog\nnames): inner_qs = Blog . objects . filter ( name__contains = \"Ch\" ) . values ( \"name\" ) entries = Entry . objects . filter ( blog__name__in = inner_qs ) This example will raise an exception, since the inner query is trying to\nextract two field values, where only one is expected: # Bad code! Will raise a TypeError. inner_qs = Blog . objects . filter ( name__contains = \"Ch\" ) . values ( \"name\" , \"id\" ) entries = Entry . objects . filter ( blog__name__in = inner_qs ) Performance considerations Be cautious about using nested queries and understand your database\nserver’s performance characteristics (if in doubt, benchmark!). Some\ndatabase backends, most notably MySQL, don’t optimize nested queries very\nwell. It is more efficient, in those cases, to extract a list of values\nand then pass that into the second query. That is, execute two queries\ninstead of one: values = Blog . objects . filter ( name__contains = \"Cheddar\" ) . values_list ( \"pk\" , flat = True ) entries = Entry . objects . filter ( blog__in = list ( values )) Note the list() call around the Blog QuerySet to force execution of\nthe first query. Without it, a nested query would be executed, because QuerySets are lazy . gt ¶ Greater than. Example: Entry . objects . filter ( id__gt = 4 ) SQL equivalent: SELECT ... WHERE id > 4 ; gte ¶ Greater than or equal to. lt ¶ Less than. lte ¶ Less than or equal to. startswith ¶ Case-sensitive starts-with. Example: Entry . objects . filter ( headline__startswith = \"Lennon\" ) SQL equivalent: SELECT ... WHERE headline LIKE 'Lennon%' ; SQLite doesn’t support case-sensitive LIKE statements; startswith acts\nlike istartswith for SQLite. istartswith ¶ Case-insensitive starts-with. Example: Entry . objects . filter ( headline__istartswith = \"Lennon\" ) SQL equivalent: SELECT ... WHERE headline ILIKE 'Lennon%' ; SQLite users When using the SQLite backend and non-ASCII strings, bear in mind the database note about string comparisons. endswith ¶ Case-sensitive ends-with. Example: Entry . objects . filter ( headline__endswith = \"Lennon\" ) SQL equivalent: SELECT ... WHERE headline LIKE '%Lennon' ; SQLite users SQLite doesn’t support case-sensitive LIKE statements; endswith acts like iendswith for SQLite. Refer to the database note documentation for more. iendswith ¶ Case-insensitive ends-with. Example: Entry . objects . filter ( headline__iendswith = \"Lennon\" ) SQL equivalent: SELECT ... WHERE headline ILIKE '%Lennon' SQLite users When using the SQLite backend and non-ASCII strings, bear in mind the database note about string comparisons. range ¶ Range test (inclusive). Example: import datetime start_date = datetime . date ( 2005 , 1 , 1 ) end_date = datetime . date ( 2005 , 3 , 31 ) Entry . objects . filter ( pub_date__range = ( start_date , end_date )) SQL equivalent: SELECT ... WHERE pub_date BETWEEN '2005-01-01' and '2005-03-31' ; You can use range anywhere you can use BETWEEN in SQL — for dates,\nnumbers and even characters. Warning Filtering a DateTimeField with dates won’t include items on the last\nday, because the bounds are interpreted as “0am on the given date”. If pub_date was a DateTimeField , the above expression would be turned\ninto this SQL: SELECT ... WHERE pub_date BETWEEN '2005-01-01 00:00:00' and '2005-03-31 00:00:00' ; Generally speaking, you can’t mix dates and datetimes. date ¶ For datetime fields, casts the value as date. Allows chaining additional field\nlookups. Takes a date value. Example: Entry . objects . filter ( pub_date__date = datetime . date ( 2005 , 1 , 1 )) Entry . objects . filter ( pub_date__date__gt = datetime . date ( 2005 , 1 , 1 )) (No equivalent SQL code fragment is included for this lookup because\nimplementation of the relevant query varies among different database engines.) When USE_TZ is True , fields are converted to the current time\nzone before filtering. This requires time zone definitions in the\ndatabase . year ¶ For date and datetime fields, an exact year match. Allows chaining additional\nfield lookups. Takes an integer year. Example: Entry . objects . filter ( pub_date__year = 2005 ) Entry . objects . filter ( pub_date__year__gte = 2005 ) SQL equivalent: SELECT ... WHERE pub_date BETWEEN '2005-01-01' AND '2005-12-31' ; SELECT ... WHERE pub_date >= '2005-01-01' ; (The exact SQL syntax varies for each database engine.) When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . iso_year ¶ For date and datetime fields, an exact ISO 8601 week-numbering year match.\nAllows chaining additional field lookups. Takes an integer year. Example: Entry . objects . filter ( pub_date__iso_year = 2005 ) Entry . objects . filter ( pub_date__iso_year__gte = 2005 ) (The exact SQL syntax varies for each database engine.) When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . month ¶ For date and datetime fields, an exact month match. Allows chaining additional\nfield lookups. Takes an integer 1 (January) through 12 (December). Example: Entry . objects . filter ( pub_date__month = 12 ) Entry . objects . filter ( pub_date__month__gte = 6 ) SQL equivalent: SELECT ... WHERE EXTRACT ( 'month' FROM pub_date ) = '12' ; SELECT ... WHERE EXTRACT ( 'month' FROM pub_date ) >= '6' ; (The exact SQL syntax varies for each database engine.) When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . day ¶ For date and datetime fields, an exact day match. Allows chaining additional\nfield lookups. Takes an integer day. Example: Entry . objects . filter ( pub_date__day = 3 ) Entry . objects . filter ( pub_date__day__gte = 3 ) SQL equivalent: SELECT ... WHERE EXTRACT ( 'day' FROM pub_date ) = '3' ; SELECT ... WHERE EXTRACT ( 'day' FROM pub_date ) >= '3' ; (The exact SQL syntax varies for each database engine.) Note this will match any record with a pub_date on the third day of the month,\nsuch as January 3, July 3, etc. When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . week ¶ For date and datetime fields, return the week number (1-52 or 53) according\nto ISO-8601 , i.e., weeks start\non a Monday and the first week contains the year’s first Thursday. Example: Entry . objects . filter ( pub_date__week = 52 ) Entry . objects . filter ( pub_date__week__gte = 32 , pub_date__week__lte = 38 ) (No equivalent SQL code fragment is included for this lookup because\nimplementation of the relevant query varies among different database engines.) When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . week_day ¶ For date and datetime fields, a ‘day of the week’ match. Allows chaining\nadditional field lookups. Takes an integer value representing the day of week from 1 (Sunday) to 7\n(Saturday). Example: Entry . objects . filter ( pub_date__week_day = 2 ) Entry . objects . filter ( pub_date__week_day__gte = 2 ) (No equivalent SQL code fragment is included for this lookup because\nimplementation of the relevant query varies among different database engines.) Note this will match any record with a pub_date that falls on a Monday (day\n2 of the week), regardless of the month or year in which it occurs. Week days\nare indexed with day 1 being Sunday and day 7 being Saturday. When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . iso_week_day ¶ For date and datetime fields, an exact ISO 8601 day of the week match. Allows\nchaining additional field lookups. Takes an integer value representing the day of the week from 1 (Monday) to 7\n(Sunday). Example: Entry . objects . filter ( pub_date__iso_week_day = 1 ) Entry . objects . filter ( pub_date__iso_week_day__gte = 1 ) (No equivalent SQL code fragment is included for this lookup because\nimplementation of the relevant query varies among different database engines.) Note this will match any record with a pub_date that falls on a Monday (day\n1 of the week), regardless of the month or year in which it occurs. Week days\nare indexed with day 1 being Monday and day 7 being Sunday. When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . quarter ¶ For date and datetime fields, a ‘quarter of the year’ match. Allows chaining\nadditional field lookups. Takes an integer value between 1 and 4 representing\nthe quarter of the year. Example to retrieve entries in the second quarter (April 1 to June 30): Entry . objects . filter ( pub_date__quarter = 2 ) (No equivalent SQL code fragment is included for this lookup because\nimplementation of the relevant query varies among different database engines.) When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . time ¶ For datetime fields, casts the value as time. Allows chaining additional field\nlookups. Takes a datetime.time value. Example: Entry . objects . filter ( pub_date__time = datetime . time ( 14 , 30 )) Entry . objects . filter ( pub_date__time__range = ( datetime . time ( 8 ), datetime . time ( 17 ))) (No equivalent SQL code fragment is included for this lookup because\nimplementation of the relevant query varies among different database engines.) When USE_TZ is True , fields are converted to the current time\nzone before filtering. This requires time zone definitions in the\ndatabase . hour ¶ For datetime and time fields, an exact hour match. Allows chaining additional\nfield lookups. Takes an integer between 0 and 23. Example: Event . objects . filter ( timestamp__hour = 23 ) Event . objects . filter ( time__hour = 5 ) Event . objects . filter ( timestamp__hour__gte = 12 ) SQL equivalent: SELECT ... WHERE EXTRACT ( 'hour' FROM timestamp ) = '23' ; SELECT ... WHERE EXTRACT ( 'hour' FROM time ) = '5' ; SELECT ... WHERE EXTRACT ( 'hour' FROM timestamp ) >= '12' ; (The exact SQL syntax varies for each database engine.) When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . minute ¶ For datetime and time fields, an exact minute match. Allows chaining additional\nfield lookups. Takes an integer between 0 and 59. Example: Event . objects . filter ( timestamp__minute = 29 ) Event . objects . filter ( time__minute = 46 ) Event . objects . filter ( timestamp__minute__gte = 29 ) SQL equivalent: SELECT ... WHERE EXTRACT ( 'minute' FROM timestamp ) = '29' ; SELECT ... WHERE EXTRACT ( 'minute' FROM time ) = '46' ; SELECT ... WHERE EXTRACT ( 'minute' FROM timestamp ) >= '29' ; (The exact SQL syntax varies for each database engine.) When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . second ¶ For datetime and time fields, an exact second match. Allows chaining additional\nfield lookups. Takes an integer between 0 and 59. Example: Event . objects . filter ( timestamp__second = 31 ) Event . objects . filter ( time__second = 2 ) Event . objects . filter ( timestamp__second__gte = 31 ) SQL equivalent: SELECT ... WHERE EXTRACT ( 'second' FROM timestamp ) = '31' ; SELECT ... WHERE EXTRACT ( 'second' FROM time ) = '2' ; SELECT ... WHERE EXTRACT ( 'second' FROM timestamp ) >= '31' ; (The exact SQL syntax varies for each database engine.) When USE_TZ is True , datetime fields are converted to the\ncurrent time zone before filtering. This requires time zone definitions\nin the database . isnull ¶ Takes either True or False , which correspond to SQL queries of IS NULL and IS NOT NULL , respectively. Example: Entry . objects . filter ( pub_date__isnull = True ) SQL equivalent: SELECT ... WHERE pub_date IS NULL ; regex ¶ Case-sensitive regular expression match. The regular expression syntax is that of the database backend in use.\nIn the case of SQLite, which has no built in regular expression support,\nthis feature is provided by a (Python) user-defined REGEXP function, and\nthe regular expression syntax is therefore that of Python’s re module. Example: Entry . objects . get ( title__regex = r \"^(An?|The) +\" ) SQL equivalents: SELECT ... WHERE title REGEXP BINARY '^(An?|The) +' ; -- MySQL SELECT ... WHERE REGEXP_LIKE ( title , '^(An?|The) +' , 'c' ); -- Oracle SELECT ... WHERE title ~ '^(An?|The) +' ; -- PostgreSQL SELECT ... WHERE title REGEXP '^(An?|The) +' ; -- SQLite Using raw strings (e.g., r'foo' instead of 'foo' ) for passing in the\nregular expression syntax is recommended. iregex ¶ Case-insensitive regular expression match. Example: Entry . objects . get ( title__iregex = r \"^(an?|the) +\" ) SQL equivalents: SELECT ... WHERE title REGEXP '^(an?|the) +' ; -- MySQL SELECT ... WHERE REGEXP_LIKE ( title , '^(an?|the) +' , 'i' ); -- Oracle SELECT ... WHERE title ~* '^(an?|the) +' ; -- PostgreSQL SELECT ... WHERE title REGEXP '(?i)^(an?|the) +' ; -- SQLite Aggregation functions ¶ Django provides the following aggregation functions in the django.db.models module. For details on how to use these\naggregate functions, see the topic guide on aggregation . See the Aggregate documentation to learn how to create your aggregates. Warning SQLite can’t handle aggregation on date/time fields out of the box.\nThis is because there are no native date/time fields in SQLite and Django\ncurrently emulates these features using a text field. Attempts to use\naggregation on date/time fields in SQLite will raise NotSupportedError . Empty querysets or groups Aggregation functions return None when used with an empty QuerySet or group. For example, the Sum aggregation function returns None instead of 0 if the QuerySet contains no entries or for any empty\ngroup in a non-empty QuerySet . To return another value instead, define\nthe default argument. Count is an exception to this behavior; it\nreturns 0 if the QuerySet is empty since Count does not support\nthe default argument. All aggregates have the following parameters in common: expressions ¶ Strings that reference fields on the model, transforms of the field, or query expressions . output_field ¶ An optional argument that represents the model field of the return value Note When combining multiple field types, Django can only determine the output_field if all fields are of the same type. Otherwise, you\nmust provide the output_field yourself. filter ¶ An optional Q object that’s used to filter the\nrows that are aggregated. See Conditional aggregation and Filtering on annotations for\nexample usage. default ¶ An optional argument that allows specifying a value to use as a default value\nwhen the queryset (or grouping) contains no entries. **extra ¶ Keyword arguments that can provide extra context for the SQL generated\nby the aggregate. Avg ¶ class Avg ( expression , output_field = None , distinct = False , filter = None , default = None , ** extra ) [source] ¶ Returns the mean value of the given expression, which must be numeric\nunless you specify a different output_field . Default alias: <field>__avg Return type: float if input is int , otherwise same as input\nfield, or output_field if supplied. If the queryset or grouping is\nempty, default is returned. distinct ¶ Optional. If distinct=True , Avg returns the mean value of\nunique values. This is the SQL equivalent of AVG(DISTINCT <field>) .\nThe default value is False . Count ¶ class Count ( expression , distinct = False , filter = None , ** extra ) [source] ¶ Returns the number of objects that are related through the provided\nexpression. Count('*') is equivalent to the SQL COUNT(*) expression. Default alias: <field>__count Return type: int distinct ¶ Optional. If distinct=True , the count will only include unique\ninstances. This is the SQL equivalent of COUNT(DISTINCT <field>) .\nThe default value is False . Note The default argument is not supported. Max ¶ class Max ( expression , output_field = None , filter = None , default = None , ** extra ) [source] ¶ Returns the maximum value of the given expression. Default alias: <field>__max Return type: same as input field, or output_field if supplied. If the\nqueryset or grouping is empty, default is returned. Min ¶ class Min ( expression , output_field = None , filter = None , default = None , ** extra ) [source] ¶ Returns the minimum value of the given expression. Default alias: <field>__min Return type: same as input field, or output_field if supplied. If the\nqueryset or grouping is empty, default is returned. StdDev ¶ class StdDev ( expression , output_field = None , sample = False , filter = None , default = None , ** extra ) [source] ¶ Returns the standard deviation of the data in the provided expression. Default alias: <field>__stddev Return type: float if input is int , otherwise same as input\nfield, or output_field if supplied. If the queryset or grouping is\nempty, default is returned. sample ¶ Optional. By default, StdDev returns the population standard\ndeviation. However, if sample=True , the return value will be the\nsample standard deviation. Sum ¶ class Sum ( expression , output_field = None , distinct = False , filter = None , default = None , ** extra ) [source] ¶ Computes the sum of all values of the given expression. Default alias: <field>__sum Return type: same as input field, or output_field if supplied. If the\nqueryset or grouping is empty, default is returned. distinct ¶ Optional. If distinct=True , Sum returns the sum of unique\nvalues. This is the SQL equivalent of SUM(DISTINCT <field>) . The\ndefault value is False . Variance ¶ class Variance ( expression , output_field = None , sample = False , filter = None , default = None , ** extra ) [source] ¶ Returns the variance of the data in the provided expression. Default alias: <field>__variance Return type: float if input is int , otherwise same as input\nfield, or output_field if supplied. If the queryset or grouping is\nempty, default is returned. sample ¶ Optional. By default, Variance returns the population variance.\nHowever, if sample=True , the return value will be the sample\nvariance. Query-related tools ¶ This section provides reference material for query-related tools not documented\nelsewhere. Q() objects ¶ class Q [source] ¶ A Q() object represents an SQL condition that can be used in\ndatabase-related operations. It’s similar to how an F() object represents the value of a model field\nor annotation. They make it possible to define and reuse conditions. These can\nbe negated using the ~ ( NOT ) operator, and combined using operators\nsuch as | ( OR ), & ( AND ), and ^ ( XOR ). See Complex lookups with Q objects . Prefetch() objects ¶ class Prefetch ( lookup , queryset = None , to_attr = None ) [source] ¶ The Prefetch() object can be used to control the operation of prefetch_related() . The lookup argument describes the relations to follow and works the same\nas the string based lookups passed to prefetch_related() . For example: >>> from django.db.models import Prefetch >>> Question . objects . prefetch_related ( Prefetch ( \"choice_set\" )) . get () . choice_set . all () <QuerySet [<Choice: Not much>, <Choice: The sky>, <Choice: Just hacking again>]> # This will only execute two queries regardless of the number of Question # and Choice objects. >>> Question . objects . prefetch_related ( Prefetch ( \"choice_set\" )) <QuerySet [<Question: What's up?>]> The queryset argument supplies a base QuerySet for the given lookup.\nThis is useful to further filter down the prefetch operation, or to call select_related() from the prefetched\nrelation, hence reducing the number of queries even further: >>> voted_choices = Choice . objects . filter ( votes__gt = 0 ) >>> voted_choices <QuerySet [<Choice: The sky>]> >>> prefetch = Prefetch ( \"choice_set\" , queryset = voted_choices ) >>> Question . objects . prefetch_related ( prefetch ) . get () . choice_set . all () <QuerySet [<Choice: The sky>]> The to_attr argument sets the result of the prefetch operation to a custom\nattribute: >>> prefetch = Prefetch ( \"choice_set\" , queryset = voted_choices , to_attr = \"voted_choices\" ) >>> Question . objects . prefetch_related ( prefetch ) . get () . voted_choices [<Choice: The sky>] >>> Question . objects . prefetch_related ( prefetch ) . get () . choice_set . all () <QuerySet [<Choice: Not much>, <Choice: The sky>, <Choice: Just hacking again>]> Note When using to_attr the prefetched result is stored in a list. This can\nprovide a significant speed improvement over traditional prefetch_related calls which store the cached result within a QuerySet instance. prefetch_related_objects() ¶ prefetch_related_objects ( model_instances , * related_lookups ) [source] ¶ aprefetch_related_objects ( model_instances , * related_lookups ) ¶ Asynchronous version : aprefetch_related_objects() Prefetches the given lookups on an iterable of model instances. This is useful\nin code that receives a list of model instances as opposed to a QuerySet ;\nfor example, when fetching models from a cache or instantiating them manually. Pass an iterable of model instances (must all be of the same class) and the\nlookups or Prefetch objects you want to prefetch for. For example: >>> from django.db.models import prefetch_related_objects >>> restaurants = fetch_top_restaurants_from_cache () # A list of Restaurants >>> prefetch_related_objects ( restaurants , \"pizzas__toppings\" ) When using multiple databases with prefetch_related_objects , the prefetch\nquery will use the database associated with the model instance. This can be\noverridden by using a custom queryset in a related lookup. Changed in Django 5.0: aprefetch_related_objects() function was added. FilteredRelation() objects ¶ class FilteredRelation ( relation_name , * , condition = Q() ) [source] ¶ relation_name ¶ The name of the field on which you’d like to filter the relation. condition ¶ A Q object to control the filtering. FilteredRelation is used with annotate() to create an ON clause when a JOIN is performed. It doesn’t act on the default\nrelationship but on the annotation name ( pizzas_vegetarian in example\nbelow). For example, to find restaurants that have vegetarian pizzas with 'mozzarella' in the name: >>> from django.db.models import FilteredRelation , Q >>> Restaurant . objects . annotate ( ... pizzas_vegetarian = FilteredRelation ( ... \"pizzas\" , ... condition = Q ( pizzas__vegetarian = True ), ... ), ... ) . filter ( pizzas_vegetarian__name__icontains = \"mozzarella\" ) If there are a large number of pizzas, this queryset performs better than: >>> Restaurant . objects . filter ( ... pizzas__vegetarian = True , ... pizzas__name__icontains = \"mozzarella\" , ... ) because the filtering in the WHERE clause of the first queryset will only\noperate on vegetarian pizzas. FilteredRelation doesn’t support: QuerySet.only() and prefetch_related() . A GenericForeignKey inherited from a parent model.", "keywords": ["users", "ham", "rows", "box", "feature", "slicing", "verbose", "storage", "population", "pattern", "best_pizza", "f1", "searches", "iterables", "efficiency", "b", "chapter", "afirst", "activity", "seafood", "corruption", "foreignkeys", "field", "#", "allows", "timestamp__minute__gte", "relation", "total", "averages", "record", "orwell", "non-", "abc", "unique_together", "blog__name__in", "field>__count", "+", "alatest", "backup", "loop", "batch_size", "lte", "numbers", "meaning", "opposite", "blog_entry", "headline__icontains", "representation", "variance", "range", "transforms", "len(queryset", "match", "penultimate", "subset", "cache", "compatibility", "datefield", "pub_date__date__gt", "extra", "doubt", "parents", "transactionmanagementerror", "words", "change", "blog.title", "annotation", "othercol", "iso_week_day", "bounds", "^", "hook", "truncation", "cpu", "django.core.exceptions", "=", "http", "create_defaults", "hometown", "mod", "changes", "public.blog", "blog_id", "results", "loops=1", "engine", "pub_date__time", "degree", "deletes", "min", "relationship", "subquery", "n", "headline='first", "fact", "shell", "entry_authors", "force_insert", "toppings", "tables", "sorts", "raw", "like", "zones", "annotates", "n+1", "greater", "batch", "id_list", "genericforeignkey", "someparam", "timestamp__second", "pizzas__toppings", "process", "evaluations", "reuse", "datetime.datetime", "acontains", "iexact", "choice", "topic", "cost", "exceptions", "menu", "first_name", "uniqueness", "john", "comments_on", "following", "type", "processing", "json_extract", "no_key", "iterators", "talk", "calls", "custom", "kwargs", "people", "objects", "optimization", "qs2", "lookups", "prefetch", "documentation", "generator", "mind", "file", "weeks", "headline__contains", "^(an?|the", "prefetch_related", "constraint", "guarantee", "work", "genericprefetch", "modules", "bulk_create", "cost=0.00", "improvement", "strategy", "good", "user", "fragment", "cases", "final", "lennon", "place_ptr", "autocommit", "name__contains", "violations", "annotations", "attribute", "args", "mechanism", "pickle", "scenes", "fetchmany", "resort", "warning", "size", "runtimewarning", "constraints", "expire_date", "name__iexact", "time", "spicy", "doesnotexist", "endswith", "field>__stddev", "eliminates", "sums", "basis", "date", "save", "setting", "purposes", "operators", "hour", "modifier", "membership", "itertools", "transform", "things", "self.toppings.all", "in_bulk", "pineapple", "iterator", "orderings", "name", "trade", "booster", "interpreter", "parameter", "execution", "flags", "seq", "blog_entry.blog_id", "reference", "prawns", "backends", "january", "monday", "age", "problems", "versions", "pub_date__gt", "queries", "meat", "foo='a", "slice", "ch", "manager", "select_for_update", "uses", "children", "piece", "qs1", "return", "z", "bool(some_queryset", "reverse", "deletion", "operator", "memory", "guides", "expressions", "foo", "consideration", "situation", "cursors", "use_tz", "parent", "blog__pk", "search", "isolation", "december", "means", "edge", "[:", "blog", "metaphor", "exact", "startswith", "is_recent", "datetime.date", "datetimefield", "meta.ordering", "mymodel", "cousin", "question", "examples", "failure", "inclusive", "update_or_create", "callables", "objs", "sunday", "binary", "acts", "title__regex", "aliases", "isinstance", "relationships", "pub_date__year__gte", "filteredrelation", "bool", "tree", "chapters", "qs.none", "join", "nature", "model.save", "error", "conditions", "plan", "time__minute", "code", "classmethod", "module", "algorithm", "period", "triggers", "pub_date__iso_year__gte", "asc", "robert", "filter", "false", "behavior", "array", "i", "class", "access", "clause", "c", "construction", "exists", "pizza.toppings.filter", "placeholders", "link", "modes", "group", "pizzas_vegetarian", "warnings", "namedtuple", "sum(distinct", "returns", "names", "'", "desc", "snippet", "request", "notsupportederror", "database", "block", "output", "flag", "field>__avg", "trips", "children__date", "lower", "input", "*", "query", "page", "test", "english", "postgresql", "sometable", "defaults__exact", "conflict", "qs3", "count", "entry_count", "types", "strings", "elements", "entry__authors__name__lower", "chaining", "register_lookup", "fetch_top_restaurants_from_cache", "subclass", "mycolumn=0", "adelete", ".", "entry__count", "direction", "k", "usage", "ulysses", "adapter", "mix", "transactiontestcase", "xml", "limit", "step", "e.blog", "max_length", "blog_blog.id", "istartswith", "pub_date__quarter", "datetime.date(2005", "grouping", "genericrelation", "create", "synchronousonlyoperation", "e", "with", "section", "blog'::bpchar", "deluge", "cast", "source", "discussion", "ignore_conflicts", "representations", "sequence", "r'foo", "inner_qs", "my_queryset", "headline__iendswith", "relation_name", "underscore", "django.db.models.query", "evaluation", "operand", "aget", "use", "sum", "timestamp__hour__gte", "telemachus", "kb", "model_instances", "author", "a", "baz", "engines", "explanation", "id__gt", "subclasses", "blogs", "select_for_update(of=", "performance", "protection", "select_for_update(nowait", "voted_choices", "pizza.toppings.all", "aupdate", "criteria", "operation", "order", "indexerror", "params", "default", "occurrences", "championed_by", "post_delete", "pub_date__month__gte", "containment", "aprefetch_related_objects", "alias", "entry__body", "form", "typecasting", "signals", "prefix", "consumption", "option", "format", "weblog", "expression", "classes", "characters", "quarter", "birthday", "other_qs", "tickets", "day", "equivalents", "reduction", "downside", "entry_list", "annotate", "unique_fields", "considerations", "timezone", "headline__istartswith", "queryset.extra", "convenience", "f", "archival", "material", "supports", "f2", "django.db.utils", "get_latest_by", "attempt", "bruce", "starts", "caveats", "race", "len", "aget_or_create", "springsteen", "existence", "pub_date__time__range", "entry_number", "mailing", "week", "field>__variance", "aggregates", "penalty", "onetoonefield", "traceback", "interaction", "way", "formats", "gte", "strict", "get_or_create", "ms", "pub_date__day", "biography", "optimizations", "comments", "end_date", "remainder", "possibility", "avg", "avg(distinct", "notation", "queryset", "integer", "marley", "timestamp__minute", "¶", "calling", "news", "offs", "inner", "parameters", "blog__name", "cooking", "post", "val", "headline", "int", "atomic", "june", "prefetch_related('toppings", "side", "queryset.iterator", "deviation", "pizzas_vegetarian__name__icontains", "function", "ends", "views", "pub_date__iso_week_day", "result", "queryset[(1", "select_related('foo').select_related('bar", "integrity", "pre_save", "entry.objects.get(id=14", "float", "pub_date__range", "vegetarian_menu", "zone", "impressions", "indexes", "number", "lot", "jsonfield", "relations", "def", "point", "datetimes", "pub_date__week", "values", "string", "managedmodel", "_", "order_by", "introspection", "city", "aggregate", "scan", "defer", "mapping", "thing", "time__second", "extra(select=", "some_queryset", "databaseerror", "databases", "alast", "timestamp", "ilike", "pizza_list__toppings", "managers", "event", "hand", "modeling", "exclude", "table", "coercion", "as_manager", "related_lookups", "querysets", "models", "dates", "copy", "version", "scenario", "ways", "level", "json", "commonlyusedmodel", "yaml", "contents", "loading", "gaza", "datetime.tzinfo", "queryset.values", "time__hour", "counterpart", "article", "reader", "condition", "on", "prefetching", "refinement", "django", "sort", "aearliest", "profile", "n’t", "gt", "fields", "print", "parentheses", "pizza.objects.all", "summary", "entry", "coalesce", "conversions", "set", "pickling", "p", "book", "bunch", "practice", "row(id=1", "not", "icontains", "count(distinct", "value", "topping", "simplification", "deletions", "rating", "precursor", "book.objects.select_related('author__hometown').get(id=4", "fetches", "contenttype", "pub_date__week_day__gte", "or", "columns", "data", "implementation", "pep", "april", "item", "dumps", "datetime", "socialists", "ain_bulk", "abulk_create", "base", "backend", "guide", "person", "subqueries", "pub_date__year", "insertion", "queryset.update", "setattr", "declaration", "iterable", "field>__max", "shortcut", "defers", "locks", "self", "need", "instance", "objectdoesnotexist", "acreate", "typeerror", "effects", "xor", "set_null", "pub_date", "today", "pizzas__name__icontains", "speed", "aggregation", "output_field", "aexists", "benchmark", "consequence", "readability", "planning", "beatles", "nulls_first", "blog_blog", "select_params", "|", "respect", "functionality", "front", "entry__authors", "gains", "thursday", "bugs", "related_name", "noam", "same", "choice_set", "joins", "pizza", "traditional", "parent_model_name>_ptr", "instances", "iso", "statement", "checking", "tzinfo", "part", "object", "load", "combines", "calculation", "field(s", "restaurants", "valueerror", "ticket", "groups", "charfield", "manytomanyfield", "internals", "blog__in", "sql", "dictionary", "hints", "requests", "authors", "update_fields", "rows=10", "terms", "situations", "individualism", "aupdate_or_create", "pairs", "contrast", "chance", "pub_date__iso_week_day__gte", "keyword", "headline__in", "minute", "s", "ordering", "child", "max", "force", "matches", "boilerplatish", "variables", "george", "v", "qs", "integrityerror", "obj", "beatles_blog", "quixote", "cheddar", "intersection", "effect", "detail", "inheritance", "restaurant", "manner", "compromise", "overhead", "clauses", "solutions", "filtering", "async", "values_list", "restrictions", "matters", "optional", "chomsky", "iso-8601", "items", "s.", "lower_name", "bob", "comparisons", "tagline", "definition", "autofield", "check", "difference", "pub_date__week_day", "features", "ancestor", "psycopg", "july", "saturday", "cascades", "addition", "example", "care", "window", "entry__authors__name", "best_pizza__toppings", "month", "requirements", "parallel", "column", "list", "sample", "collation", "fun", "first", "fragments", "nowait", "acount", "re", "pub_date__day__gte", "read", "model", "pooler", "word", "lennon%", "year", "techniques", "place", "django.db.models.functions", "headline__endswith", "dry", "select_related('foo", "dictionaries", "jan.", "do_nothing", "entries__gt", "attributes", "conflicts", "isnull", "approach", "field>__min", "testcase", "title", "timestamp__second__gte", "differences", "sky", "name__lower", "id__in", "queryset.ordered", "y", "analyze", "sense", "queryset.values_list", "syntax", "bulk_update", "blog__id", "restriction", "select", "spec", "prefetch_related_objects", "islice", "chunk_size", "pub_date__date", "benefit", "new_values", "works", "keys", "defence", "case", "attributeerror", "boolean", "length", "principle", "equivalent", "lookup", "subtleties", "..", "conjunction", "null", "slug", "ancestors", "technique", "iendswith", "errors", "tuple", "reloaded_qs", "future", "str", "server", "explain", "arguments", "introduction", "quotes", "lock", "driver", "one", "rawsql", "end", "translations", "salmon", "entries", "disable_server_side_cursors", "increase", "records", "sqlite", "comparison", "matching", "tuples", "delete", "rawqueryset", "hawaiian", "last_name", "abulk_update", "timestamp__hour", "amount", "standard", "bar", "foo_id", "extract", "kind", "depth", "duplicates", "path", "iregex", "functions", "key", "term", "operations", "update", "except", "none", "pizzas", "filters", "problem", "sign", "specifies", "meta", "col", "):", "get", "don", "mariadb", "pickles", "injection", "definitions", "reason", "q", "cautions", "replica", "true", "caching", "to_attr", "api", "loads", "blog.objects.all", "blogasaurus", "support", "description", "characteristics", "descending", "mode", "headline__startswith", "document", "assumption", "transactions", "pub_date__week__lte", "-", "connection", "field_name", "enforces", "django.utils", "context", "aiterator", "stddev", "offset", "documents", "import", "cascade", "d", "sensitivity", "iteration", "headline='lennon", "pub_date__iso_year", "statements", "mysql", "union", "%", ">", "call", "vegetarian_menu__toppings", "pk", "foreignkey", "defaults", "pub_date__week__gte", "attempts", "chunks", "information", "distinct", "row", "python", "in", "ascending", "translates", "methods", "caution", "traverse", "expense", "times", "options", "regexp", "purpose", "number_of_entries", "mysql_tzinfo_to_sql", "exception", "some_queryset.exists", "details", "method", "django.db", "transaction", "argument", "days", "aexplain", "combinations", "note", "body", "state", "operands", "oracle", "attacks", "cheddar%", "tools", "table_name.column_name", "variant", "batches", "beginning", "lack", "moment", "text", "vegetarian_pizzas", "parts"], "type": "documentation"},
{"title": "Related objects reference | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/models/relations/", "content": "Related objects reference ¶ class RelatedManager ¶ A “related manager” is a manager used in a one-to-many or many-to-many\nrelated context. This happens in two cases: The “other side” of a ForeignKey relation.\nThat is: from django.db import models class Blog ( models . Model ): # ... pass class Entry ( models . Model ): blog = models . ForeignKey ( Blog , on_delete = models . CASCADE , null = True ) In the above example, the methods below will be available on\nthe manager blog.entry_set . Both sides of a ManyToManyField relation class Topping ( models . Model ): # ... pass class Pizza ( models . Model ): toppings = models . ManyToManyField ( Topping ) In this example, the methods below will be available both on topping.pizza_set and on pizza.toppings . add ( * objs , bulk = True , through_defaults = None ) ¶ aadd ( * objs , bulk = True , through_defaults = None ) ¶ Asynchronous version : aadd Adds the specified model objects to the related object set. Example: >>> b = Blog . objects . get ( id = 1 ) >>> e = Entry . objects . get ( id = 234 ) >>> b . entry_set . add ( e ) # Associates Entry e with Blog b. In the example above, in the case of a ForeignKey relationship, QuerySet.update() is used to perform the update. This requires the objects to already be\nsaved. You can use the bulk=False argument to instead have the related\nmanager perform the update by calling e.save() . Using add() with a many-to-many relationship, however, will not\ncall any save() methods (the bulk argument doesn’t exist), but\nrather create the relationships using QuerySet.bulk_create() . If you need to execute\nsome custom logic when a relationship is created, listen to the m2m_changed signal, which will\ntrigger pre_add and post_add actions. Using add() on a relation that already exists won’t duplicate the\nrelation, but it will still trigger signals. For many-to-many relationships add() accepts either model instances\nor field values, normally primary keys, as the *objs argument. Use the through_defaults argument to specify values for the new intermediate model instance(s), if\nneeded. You can use callables as values in the through_defaults dictionary and they will be evaluated once before creating any\nintermediate instance(s). create ( through_defaults = None , ** kwargs ) ¶ acreate ( through_defaults = None , ** kwargs ) ¶ Asynchronous version : acreate Creates a new object, saves it and puts it in the related object set.\nReturns the newly created object: >>> b = Blog . objects . get ( id = 1 ) >>> e = b . entry_set . create ( ... headline = \"Hello\" , body_text = \"Hi\" , pub_date = datetime . date ( 2005 , 1 , 1 ) ... ) # No need to call e.save() at this point -- it's already been saved. This is equivalent to (but simpler than): >>> b = Blog . objects . get ( id = 1 ) >>> e = Entry ( blog = b , headline = \"Hello\" , body_text = \"Hi\" , pub_date = datetime . date ( 2005 , 1 , 1 )) >>> e . save ( force_insert = True ) Note that there’s no need to specify the keyword argument of the model\nthat defines the relationship. In the above example, we don’t pass the\nparameter blog to create() . Django figures out that the new Entry object’s blog field should be set to b . Use the through_defaults argument to specify values for the new intermediate model instance, if\nneeded. You can use callables as values in the through_defaults dictionary. remove ( * objs , bulk = True ) ¶ aremove ( * objs , bulk = True ) ¶ Asynchronous version : aremove Removes the specified model objects from the related object set: >>> b = Blog . objects . get ( id = 1 ) >>> e = Entry . objects . get ( id = 234 ) >>> b . entry_set . remove ( e ) # Disassociates Entry e from Blog b. Similar to add() , e.save() is called in the example above\nto perform the update. Using remove() with a many-to-many\nrelationship, however, will delete the relationships using QuerySet.delete() which\nmeans no model save() methods are called; listen to the m2m_changed signal if you wish to\nexecute custom code when a relationship is deleted. For many-to-many relationships remove() accepts either model\ninstances or field values, normally primary keys, as the *objs argument. For ForeignKey objects, this method only\nexists if null=True . If the related field can’t be set to None ( NULL ), then an object can’t be removed from a relation without\nbeing added to another. In the above example, removing e from b.entry_set() is equivalent to doing e.blog = None , and because\nthe blog ForeignKey doesn’t have null=True , this is invalid. For ForeignKey objects, this method accepts\na bulk argument to control how to perform the operation.\nIf True (the default), QuerySet.update() is used.\nIf bulk=False , the save() method of each individual model\ninstance is called instead. This triggers the pre_save and post_save signals and comes at the\nexpense of performance. For many-to-many relationships, the bulk keyword argument doesn’t\nexist. clear ( bulk = True ) ¶ aclear ( bulk = True ) ¶ Asynchronous version : aclear Removes all objects from the related object set: >>> b = Blog . objects . get ( id = 1 ) >>> b . entry_set . clear () Note this doesn’t delete the related objects – it just disassociates\nthem. Just like remove() , clear() is only available on ForeignKey s where null=True and it also\naccepts the bulk keyword argument. For many-to-many relationships, the bulk keyword argument doesn’t\nexist. set ( objs , bulk = True , clear = False , through_defaults = None ) ¶ aset ( objs , bulk = True , clear = False , through_defaults = None ) ¶ Asynchronous version : aset Replace the set of related objects: >>> new_list = [ obj1 , obj2 , obj3 ] >>> e . related_set . set ( new_list ) This method accepts a clear argument to control how to perform the\noperation. If False (the default), the elements missing from the\nnew set are removed using remove() and only the new ones are added.\nIf clear=True , the clear() method is called instead and the\nwhole set is added at once. For ForeignKey objects, the bulk argument is passed on to add() and remove() . For many-to-many relationships, the bulk keyword argument doesn’t\nexist. Note that since set() is a compound operation, it is subject to\nrace conditions. For instance, new objects may be added to the database\nin between the call to clear() and the call to add() . For many-to-many relationships set() accepts a list of either model\ninstances or field values, normally primary keys, as the objs argument. Use the through_defaults argument to specify values for the new intermediate model instance(s), if\nneeded. You can use callables as values in the through_defaults dictionary and they will be evaluated once before creating any\nintermediate instance(s). Note Note that add() , aadd() , create() , acreate() , remove() , aremove() , clear() , aclear() , set() , and aset() all apply database changes immediately for all types of\nrelated fields. In other words, there is no need to call save() / asave() on either end of the relationship. If you use prefetch_related() ,\nthe add() , aadd() , remove() , aremove() , clear() , aclear() , set() , and aset() methods clear the prefetched\ncache.", "keywords": ["pre_save", "objs", "callables", "through_defaults", "relationships", "pizza.toppings", "conditions", "b", "point", "code", "values", "compound", "bulk", "false", "queryset.bulk_create", "i", "class", "example", "field", "#", "relation", "list", "returns", "new_list", "database", "signal", "*", "models", "version", "cache", "types", "b.entry_set", "aclear", "elements", "model", "words", "e.save", "actions", "obj3", "disassociates", "django", "=", "changes", "n’t", "e.blog", "aset", "fields", "aremove", "entry", "set", "relationship", "toppings", "e", "topping", "ones", "keys", "case", "datetime", "null", "pre_add", "queryset.update", "queryset.delete", "add", "need", "custom", "kwargs", "acreate", "objects", "instance", "removes", "performance", "end", "pub_date", "prefetch_related", "similar", "operation", "default", "cases", "topping.pizza_set", "associates", "sides", "update", "signals", "none", "pizza", "save", "date", "relatedmanager", "instances", "object", "race", "context", "blog.entry_set", "logic", "import", "d", "instance(s", "manytomanyfield", "parameter", "b.", "dictionary", "call", "foreignkey", "reference", "methods", "keyword", "s", "expense", "manager", "method", "django.db", "clear", "argument", "¶", "aadd", "note", "remove", "headline", "side", "blog", "related_set", "obj2"], "type": "documentation"},
{"title": "How to write a custom storage class | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/howto/custom-file-storage/", "content": "How to write a custom storage class ¶ If you need to provide custom file storage – a common example is storing files\non some remote system – you can do so by defining a custom storage class.\nYou’ll need to follow these steps: Your custom storage system must be a subclass of django.core.files.storage.Storage : from django.core.files.storage import Storage class MyStorage ( Storage ): ... Django must be able to instantiate your storage system without any arguments.\nThis means that any settings should be taken from django.conf.settings : from django.conf import settings from django.core.files.storage import Storage class MyStorage ( Storage ): def __init__ ( self , option = None ): if not option : option = settings . CUSTOM_STORAGE_OPTIONS ... Your storage class must implement the _open() and _save() methods, along with any other methods appropriate to your storage class. See\nbelow for more on these methods. In addition, if your class provides local file storage, it must override\nthe path() method. Your storage class must be deconstructible so it can be serialized when it’s used on a field in a migration. As long\nas your field has arguments that are themselves serializable , you can use the django.utils.deconstruct.deconstructible class decorator for this\n(that’s what Django uses on FileSystemStorage). By default, the following methods raise NotImplementedError and will\ntypically have to be overridden: Storage.delete() Storage.exists() Storage.listdir() Storage.size() Storage.url() Note however that not all these methods are required and may be deliberately\nomitted. As it happens, it is possible to leave each method unimplemented and\nstill have a working Storage. By way of example, if listing the contents of certain storage backends turns\nout to be expensive, you might decide not to implement Storage.listdir() . Another example would be a backend that only handles writing to files. In this\ncase, you would not need to implement any of the above methods. Ultimately, which of these methods are implemented is up to you. Leaving some\nmethods unimplemented will result in a partial (possibly broken) interface. You’ll also usually want to use hooks specifically designed for custom storage\nobjects. These are: _open ( name , mode = 'rb' ) ¶ Required . Called by Storage.open() , this is the actual mechanism the storage class\nuses to open the file. This must return a File object, though in most cases,\nyou’ll want to return some subclass here that implements logic specific to the\nbackend storage system. The FileNotFoundError exception should be raised\nwhen a file doesn’t exist. _save ( name , content ) ¶ Called by Storage.save() . The name will already have gone through get_valid_name() and get_available_name() , and the content will be a File object itself. Should return the actual name of the file saved (usually the name passed\nin, but if the storage needs to change the file name return the new name\ninstead). get_valid_name ( name ) ¶ Returns a filename suitable for use with the underlying storage system. The name argument passed to this method is either the original filename sent to\nthe server or, if upload_to is a callable, the filename returned by that\nmethod after any path information is removed. Override this to customize how\nnon-standard characters are converted to safe filenames. The code provided on Storage retains only alpha-numeric characters, periods\nand underscores from the original filename, removing everything else. get_alternative_name ( file_root , file_ext ) ¶ Returns an alternative filename based on the file_root and file_ext parameters. By default, an underscore plus a random 7 character alphanumeric\nstring is appended to the filename before the extension. get_available_name ( name , max_length = None ) ¶ Returns a filename that is available in the storage mechanism, possibly taking\nthe provided filename into account. The name argument passed to this method\nwill have already cleaned to a filename valid for the storage system, according\nto the get_valid_name() method described above. The length of the filename will not exceed max_length , if provided. If a\nfree unique filename cannot be found, a SuspiciousFileOperation exception is raised. If a file with name already exists, get_alternative_name() is called to\nobtain an alternative name. Use your custom storage engine ¶ The first step to using your custom storage with Django is to tell Django about\nthe file storage backend you’ll be using. This is done using the STORAGES setting. This setting maps storage aliases, which are a way\nto refer to a specific storage throughout Django, to a dictionary of settings\nfor that specific storage backend. The settings in the inner dictionaries are\ndescribed fully in the STORAGES documentation. Storages are then accessed by alias from the django.core.files.storage.storages dictionary: from django.core.files.storage import storages example_storage = storages [ \"example\" ]", "keywords": ["django.core.files.storage", "open", "storages", "storage", "underscores", "aliases", "maps", "def", "code", "string", "addition", "class", "example", "_", "field", "migration", "hooks", "handles", "returns", "storage.url", "steps", "storage.exists", "custom_storage_options", "filenotfounderror", "contents", "subclass", "get_valid_name", "filenames", "dictionaries", "django", "=", "step", "filename", "mystorage", "max_length", "engine", "get_alternative_name", "character", "django.core.files.storage.storages", "case", "length", "underscore", "example_storage", "use", "backend", "get_available_name", "notimplementederror", "server", "alpha", "arguments", "storage.listdir", "init", "required", "self", "django.conf.settings", "custom", "objects", "documentation", "storage.size", "file", "extension", "interface", "default", "path", "cases", "alias", "none", "option", "mechanism", "characters", "decorator", "suspiciousfileoperation", "save", "account", "filesystemstorage", "mode", "object", "logic", "files", "import", "name", "storage.delete", "dictionary", "way", "backends", "information", "methods", "rb", "exception", "method", "periods", "settings", "argument", "¶", "storage.open", "parameters", "alphanumeric", "file_ext", "system", "storage.save", "content"], "type": "documentation"},
{"title": "Managers | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/topics/db/managers/", "content": "Managers ¶ class Manager [source] ¶ A Manager is the interface through which database query operations are\nprovided to Django models. At least one Manager exists for every model in\na Django application. The way Manager classes work is documented in Making queries ;\nthis document specifically touches on model options that customize Manager behavior. Manager names ¶ By default, Django adds a Manager with the name objects to every Django\nmodel class. However, if you want to use objects as a field name, or if you\nwant to use a name other than objects for the Manager , you can rename\nit on a per-model basis. To rename the Manager for a given class, define a\nclass attribute of type models.Manager() on that model. For example: from django.db import models class Person ( models . Model ): # ... people = models . Manager () Using this example model, Person.objects will generate an AttributeError exception, but Person.people.all() will provide a list\nof all Person objects. Custom managers ¶ You can use a custom Manager in a particular model by extending the base Manager class and instantiating your custom Manager in your model. There are two reasons you might want to customize a Manager : to add extra Manager methods, and/or to modify the initial QuerySet the Manager returns. Adding extra manager methods ¶ Adding extra Manager methods is the preferred way to add “table-level”\nfunctionality to your models. (For “row-level” functionality – i.e., functions\nthat act on a single instance of a model object – use Model methods , not custom Manager methods.) For example, this custom Manager adds a method with_counts() : from django.db import models from django.db.models.functions import Coalesce class PollManager ( models . Manager ): def with_counts ( self ): return self . annotate ( num_responses = Coalesce ( models . Count ( \"response\" ), 0 )) class OpinionPoll ( models . Model ): question = models . CharField ( max_length = 200 ) objects = PollManager () class Response ( models . Model ): poll = models . ForeignKey ( OpinionPoll , on_delete = models . CASCADE ) # ... With this example, you’d use OpinionPoll.objects.with_counts() to get a QuerySet of OpinionPoll objects with the extra num_responses attribute attached. A custom Manager method can return anything you want. It doesn’t have to\nreturn a QuerySet . Another thing to note is that Manager methods can access self.model to\nget the model class to which they’re attached. Modifying a manager’s initial QuerySet ¶ A Manager ’s base QuerySet returns all objects in the system. For\nexample, using this model: from django.db import models class Book ( models . Model ): title = models . CharField ( max_length = 100 ) author = models . CharField ( max_length = 50 ) …the statement Book.objects.all() will return all books in the database. You can override a Manager ’s base QuerySet by overriding the Manager.get_queryset() method. get_queryset() should return a QuerySet with the properties you require. For example, the following model has two Manager s – one that returns\nall objects, and one that returns only the books by Roald Dahl: # First, define the Manager subclass. class DahlBookManager ( models . Manager ): def get_queryset ( self ): return super () . get_queryset () . filter ( author = \"Roald Dahl\" ) # Then hook it into the Book model explicitly. class Book ( models . Model ): title = models . CharField ( max_length = 100 ) author = models . CharField ( max_length = 50 ) objects = models . Manager () # The default manager. dahl_objects = DahlBookManager () # The Dahl-specific manager. With this sample model, Book.objects.all() will return all books in the\ndatabase, but Book.dahl_objects.all() will only return the ones written by\nRoald Dahl. Because get_queryset() returns a QuerySet object, you can use filter() , exclude() and all the other QuerySet methods on it. So\nthese statements are all legal: Book . dahl_objects . all () Book . dahl_objects . filter ( title = \"Matilda\" ) Book . dahl_objects . count () This example also pointed out another interesting technique: using multiple\nmanagers on the same model. You can attach as many Manager() instances to\na model as you’d like. This is a non-repetitive way to define common “filters”\nfor your models. For example: class AuthorManager ( models . Manager ): def get_queryset ( self ): return super () . get_queryset () . filter ( role = \"A\" ) class EditorManager ( models . Manager ): def get_queryset ( self ): return super () . get_queryset () . filter ( role = \"E\" ) class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) last_name = models . CharField ( max_length = 50 ) role = models . CharField ( max_length = 1 , choices = { \"A\" : _ ( \"Author\" ), \"E\" : _ ( \"Editor\" )}) people = models . Manager () authors = AuthorManager () editors = EditorManager () This example allows you to request Person.authors.all() , Person.editors.all() ,\nand Person.people.all() , yielding predictable results. Default managers ¶ Model. _default_manager ¶ If you use custom Manager objects, take note that the first Manager Django encounters (in the order in which they’re defined in the model) has a\nspecial status. Django interprets the first Manager defined in a class as\nthe “default” Manager , and several parts of Django (including dumpdata ) will use that Manager exclusively for that model. As a\nresult, it’s a good idea to be careful in your choice of default manager in\norder to avoid a situation where overriding get_queryset() results in an\ninability to retrieve objects you’d like to work with. You can specify a custom default manager using Meta.default_manager_name . If you’re writing some code that must handle an unknown model, for example, in\na third-party app that implements a generic view, use this manager (or _base_manager ) rather than assuming the model has an objects manager. Base managers ¶ Model. _base_manager ¶ Using managers for related object access ¶ By default, Django uses an instance of the Model._base_manager manager\nclass when accessing related objects (i.e. choice.question ), not the _default_manager on the related object. This is because Django needs to be\nable to retrieve the related object, even if it would otherwise be filtered out\n(and hence be inaccessible) by the default manager. If the normal base manager class ( django.db.models.Manager ) isn’t\nappropriate for your circumstances, you can tell Django which class to use by\nsetting Meta.base_manager_name . Base managers aren’t used when querying on related models, or when accessing a one-to-many or many-to-many relationship . For example, if the Question model from the tutorial had a deleted field and a base\nmanager that filters out instances with deleted=True , a queryset like Choice.objects.filter(question__name__startswith='What') would include\nchoices related to deleted questions. Don’t filter away any results in this type of manager subclass ¶ This manager is used to access objects that are related to from some other\nmodel. In those situations, Django has to be able to see all the objects for\nthe model it is fetching, so that anything which is referred to can be\nretrieved. Therefore, you should not override get_queryset() to filter out any rows.\nIf you do so, Django will return incomplete results. Calling custom QuerySet methods from the manager ¶ While most methods from the standard QuerySet are accessible directly from\nthe Manager , this is only the case for the extra methods defined on a\ncustom QuerySet if you also implement them on the Manager : class PersonQuerySet ( models . QuerySet ): def authors ( self ): return self . filter ( role = \"A\" ) def editors ( self ): return self . filter ( role = \"E\" ) class PersonManager ( models . Manager ): def get_queryset ( self ): return PersonQuerySet ( self . model , using = self . _db ) def authors ( self ): return self . get_queryset () . authors () def editors ( self ): return self . get_queryset () . editors () class Person ( models . Model ): first_name = models . CharField ( max_length = 50 ) last_name = models . CharField ( max_length = 50 ) role = models . CharField ( max_length = 1 , choices = { \"A\" : _ ( \"Author\" ), \"E\" : _ ( \"Editor\" )}) people = PersonManager () This example allows you to call both authors() and editors() directly from\nthe manager Person.people . Creating a manager with QuerySet methods ¶ In lieu of the above approach which requires duplicating methods on both the QuerySet and the Manager , QuerySet.as_manager() can be used to create an instance\nof Manager with a copy of a custom QuerySet ’s methods: class Person ( models . Model ): ... people = PersonQuerySet . as_manager () The Manager instance created by QuerySet.as_manager() will be virtually\nidentical to the PersonManager from the previous example. Not every QuerySet method makes sense at the Manager level; for\ninstance we intentionally prevent the QuerySet.delete() method from being copied onto\nthe Manager class. Methods are copied according to the following rules: Public methods are copied by default. Private methods (starting with an underscore) are not copied by default. Methods with a queryset_only attribute set to False are always copied. Methods with a queryset_only attribute set to True are never copied. For example: class CustomQuerySet ( models . QuerySet ): # Available on both Manager and QuerySet. def public_method ( self ): return # Available only on QuerySet. def _private_method ( self ): return # Available only on QuerySet. def opted_out_public_method ( self ): return opted_out_public_method . queryset_only = True # Available on both Manager and QuerySet. def _opted_in_private_method ( self ): return _opted_in_private_method . queryset_only = False from_queryset() ¶ classmethod from_queryset ( queryset_class ) ¶ For advanced usage you might want both a custom Manager and a custom QuerySet . You can do that by calling Manager.from_queryset() which\nreturns a subclass of your base Manager with a copy of the custom QuerySet methods: class CustomManager ( models . Manager ): def manager_only_method ( self ): return class CustomQuerySet ( models . QuerySet ): def manager_and_queryset_method ( self ): return class MyModel ( models . Model ): objects = CustomManager . from_queryset ( CustomQuerySet )() You may also store the generated class into a variable: MyManager = CustomManager . from_queryset ( CustomQuerySet ) class MyModel ( models . Model ): objects = MyManager () Custom managers and model inheritance ¶ Here’s how Django handles custom managers and model inheritance : Managers from base classes are always inherited by the child class,\nusing Python’s normal name resolution order (names on the child\nclass override all others; then come names on the first parent class,\nand so on). If no managers are declared on a model and/or its parents, Django\nautomatically creates the objects manager. The default manager on a class is either the one chosen with Meta.default_manager_name , or the first manager\ndeclared on the model, or the default manager of the first parent model. These rules provide the necessary flexibility if you want to install a\ncollection of custom managers on a group of models, via an abstract base\nclass, but still customize the default manager. For example, suppose you have\nthis base class: class AbstractBase ( models . Model ): # ... objects = CustomManager () class Meta : abstract = True If you use this directly in a child class, objects will be the default\nmanager if you declare no managers in the child class: class ChildA ( AbstractBase ): # ... # This class has CustomManager as the default manager. pass If you want to inherit from AbstractBase , but provide a different default\nmanager, you can provide the default manager on the child class: class ChildB ( AbstractBase ): # ... # An explicit default manager. default_manager = OtherManager () Here, default_manager is the default. The objects manager is\nstill available, since it’s inherited, but isn’t used as the default. Finally for this example, suppose you want to add extra managers to the child\nclass, but still use the default from AbstractBase . You can’t add the new\nmanager directly in the child class, as that would override the default and you would\nhave to also explicitly include all the managers from the abstract base class.\nThe solution is to put the extra managers in another base class and introduce\nit into the inheritance hierarchy after the defaults: class ExtraManager ( models . Model ): extra_manager = OtherManager () class Meta : abstract = True class ChildC ( AbstractBase , ExtraManager ): # ... # Default manager is CustomManager, but OtherManager is # also available via the \"extra_manager\" attribute. pass Note that while you can define a custom manager on the abstract model, you\ncan’t invoke any methods using the abstract model. That is: ClassA . objects . do_something () is legal, but: AbstractBase . objects . do_something () will raise an exception. This is because managers are intended to encapsulate\nlogic for managing collections of objects. Since you can’t have a collection of\nabstract objects, it doesn’t make sense to be managing them. If you have\nfunctionality that applies to the abstract model, you should put that functionality\nin a staticmethod or classmethod on the abstract model. Implementation concerns ¶ Whatever features you add to your custom Manager , it must be\npossible to make a shallow copy of a Manager instance; i.e., the\nfollowing code must work: >>> import copy >>> manager = MyManager () >>> my_copy = copy . copy ( manager ) Django makes shallow copies of manager objects during certain queries;\nif your Manager cannot be copied, those queries will fail. This won’t be an issue for most custom managers. If you are just\nadding simple methods to your Manager , it is unlikely that you\nwill inadvertently make instances of your Manager uncopyable.\nHowever, if you’re overriding __getattr__ or some other private\nmethod of your Manager object that controls object state, you\nshould ensure that you don’t affect the ability of your Manager to\nbe copied.", "keywords": ["question", "mymodel", "get_queryset", "result", "rows", "view", "num_responses", "extra_manager", "status", "collections", "manager_and_queryset_method", "def", "code", "public_method", "classmethod", "person.people", "filter", "false", "behavior", "access", "self.model", "class", "field", "example", "#", "app", "_", "group", "list", "sample", "thing", "returns", "names", "dahl_objects", "customqueryset", "managers", "database", "poll", "authormanager", "table", "models", "query", "django.db.models", "meta.base_manager_name", "copy", "opted_in_private_method", "count", "level", "parents", "model", "variable", "choice.question", "personqueryset", "roald", "subclass", "manager.get_queryset", "reasons", "idea", "django.db.models.functions", "application", "extramanager", "usage", "approach", "django", "=", "title", "editormanager", "ability", "n’t", "max_length", "results", "choice.objects.filter(question__name__startswith='what", "coalesce", "dumpdata", "person.objects", "role", "relationship", "editors", "sense", "override", "book", "flexibility", "db", "othermanager", "dahl", "e", "circumstances", "manager_only_method", "ones", "source", "case", "attributeerror", "hierarchy", "implementation", "opted_out_public_method", "manager.from_queryset", "underscore", "base", "technique", "choice", "person", "personmanager", "collection", "matilda", "pollmanager", "editor", "first_name", "queryset.delete", "type", "author", "a", "solution", "self", "people", "custom", "instance", "one", "objects", "mymanager", "classa", "meta.default_manager_name", "work", "last_name", "order", "interface", "default", "model._base_manager", "dahlbookmanager", "choices", "functionality", "functions", "operations", "lieu", "attribute", "with_counts", "properties", "filters", "classes", "opinionpoll.objects.with_counts", "meta", "basis", "instances", "true", "annotate", "statement", "inability", "object", "document", "logic", "import", "name", "custommanager", "charfield", "response", "abstractbase", "statements", "defaults", "staticmethod", "opinionpoll", "foreignkey", "way", "authors", "copies", "row", "situations", "python", "issue", "person.editors.all", "queryset.as_manager", "methods", "books", "options", "queries", "person.people.all", "exception", "book.objects.all", "child", "private_method", "resolution", "manager", "party", "method", "queryset", "rules", "others", "django.db", "¶", "return", "questions", "note", "state", "tutorial", "situation", "system", "inheritance", "parent", "base_manager", "childa", "person.authors.all", "parts"], "type": "documentation"},
{"title": "Form fields | Django documentation | Django", "url": "https://docs.djangoproject.com/en/5.1/ref/forms/fields/", "content": "Form fields ¶ class Field [source] ¶ When you create a Form class, the most important part is defining the\nfields of the form. Each field has custom validation logic, along with a few\nother hooks. Field. clean ( value ) [source] ¶ Although the primary way you’ll use Field classes is in Form classes,\nyou can also instantiate them and use them directly to get a better idea of\nhow they work. Each Field instance has a clean() method, which takes\na single argument and either raises a django.core.exceptions.ValidationError exception or returns the clean\nvalue: >>> from django import forms >>> f = forms . EmailField () >>> f . clean ( \"foo@example.com\" ) 'foo@example.com' >>> f . clean ( \"invalid email address\" ) Traceback (most recent call last): ... ValidationError : ['Enter a valid email address.'] Core field arguments ¶ Each Field class constructor takes at least these arguments. Some Field classes take additional, field-specific arguments, but the following\nshould always be accepted: required ¶ Field. required ¶ By default, each Field class assumes the value is required, so if you pass\nan empty value – either None or the empty string ( \"\" ) – then clean() will raise a ValidationError exception: >>> from django import forms >>> f = forms . CharField () >>> f . clean ( \"foo\" ) 'foo' >>> f . clean ( \"\" ) Traceback (most recent call last): ... ValidationError : ['This field is required.'] >>> f . clean ( None ) Traceback (most recent call last): ... ValidationError : ['This field is required.'] >>> f . clean ( 0 ) '0' >>> f . clean ( True ) 'True' >>> f . clean ( False ) 'False' To specify that a field is not required, pass required=False to the Field constructor: >>> f = forms . CharField ( required = False ) >>> f . clean ( \"foo\" ) 'foo' >>> f . clean ( \"\" ) '' >>> f . clean ( None ) '' >>> f . clean ( 0 ) '0' >>> f . clean ( True ) 'True' >>> f . clean ( False ) 'False' If a Field has required=False and you pass clean() an empty value,\nthen clean() will return a normalized empty value rather than raising ValidationError . For CharField , this will return empty_value which defaults to an empty string. For other Field classes, it might be None . (This varies from field to field.) Widgets of required form fields have the required HTML attribute. Set the Form.use_required_attribute attribute to False to disable it. The required attribute isn’t included on forms of formsets because the browser\nvalidation may not be correct when adding and deleting formsets. label ¶ Field. label ¶ The label argument lets you specify the “human-friendly” label for this\nfield. This is used when the Field is displayed in a Form . As explained in Outputting forms as HTML , the default label for a Field is generated from the field name by converting all underscores to\nspaces and upper-casing the first letter. Specify label if that default\nbehavior doesn’t result in an adequate label. Here’s a full example Form that implements label for two of its fields.\nWe’ve specified auto_id=False to simplify the output: >>> from django import forms >>> class CommentForm ( forms . Form ): ... name = forms . CharField ( label = \"Your name\" ) ... url = forms . URLField ( label = \"Your website\" , required = False ) ... comment = forms . CharField () ... >>> f = CommentForm ( auto_id = False ) >>> print ( f ) <div>Your name:<input type=\"text\" name=\"name\" required></div> <div>Your website:<input type=\"url\" name=\"url\"></div> <div>Comment:<input type=\"text\" name=\"comment\" required></div> label_suffix ¶ Field. label_suffix ¶ The label_suffix argument lets you override the form’s label_suffix on a per-field basis: >>> class ContactForm ( forms . Form ): ... age = forms . IntegerField () ... nationality = forms . CharField () ... captcha_answer = forms . IntegerField ( label = \"2 + 2\" , label_suffix = \" =\" ) ... >>> f = ContactForm ( label_suffix = \"?\" ) >>> print ( f ) <div><label for=\"id_age\">Age?</label><input type=\"number\" name=\"age\" required id=\"id_age\"></div> <div><label for=\"id_nationality\">Nationality?</label><input type=\"text\" name=\"nationality\" required id=\"id_nationality\"></div> <div><label for=\"id_captcha_answer\">2 + 2 =</label><input type=\"number\" name=\"captcha_answer\" required id=\"id_captcha_answer\"></div> initial ¶ Field. initial ¶ The initial argument lets you specify the initial value to use when\nrendering this Field in an unbound Form . To specify dynamic initial data, see the Form.initial parameter. The use-case for this is when you want to display an “empty” form in which a\nfield is initialized to a particular value. For example: >>> from django import forms >>> class CommentForm ( forms . Form ): ... name = forms . CharField ( initial = \"Your name\" ) ... url = forms . URLField ( initial = \"https://\" ) ... comment = forms . CharField () ... >>> f = CommentForm ( auto_id = False ) >>> print ( f ) <div>Name:<input type=\"text\" name=\"name\" value=\"Your name\" required></div> <div>Url:<input type=\"url\" name=\"url\" value=\"https://\" required></div> <div>Comment:<input type=\"text\" name=\"comment\" required></div> You may be thinking, why not just pass a dictionary of the initial values as\ndata when displaying the form? Well, if you do that, you’ll trigger validation,\nand the HTML output will include any validation errors: >>> class CommentForm ( forms . Form ): ... name = forms . CharField () ... url = forms . URLField () ... comment = forms . CharField () ... >>> default_data = { \"name\" : \"Your name\" , \"url\" : \"https://\" } >>> f = CommentForm ( default_data , auto_id = False ) >>> print ( f ) <div>Name: <input type=\"text\" name=\"name\" value=\"Your name\" required> </div> <div>Url: <ul class=\"errorlist\"><li>Enter a valid URL.</li></ul> <input type=\"url\" name=\"url\" value=\"https://\" required aria-invalid=\"true\"> </div> <div>Comment: <ul class=\"errorlist\"><li>This field is required.</li></ul> <input type=\"text\" name=\"comment\" required aria-invalid=\"true\"> </div> This is why initial values are only displayed for unbound forms. For bound\nforms, the HTML output will use the bound data. Also note that initial values are not used as “fallback” data in\nvalidation if a particular field’s value is not given. initial values are only intended for initial form display: >>> class CommentForm ( forms . Form ): ... name = forms . CharField ( initial = \"Your name\" ) ... url = forms . URLField ( initial = \"https://\" ) ... comment = forms . CharField () ... >>> data = { \"name\" : \"\" , \"url\" : \"\" , \"comment\" : \"Foo\" } >>> f = CommentForm ( data ) >>> f . is_valid () False # The form does *not* fallback to using the initial values. >>> f . errors {'url': ['This field is required.'], 'name': ['This field is required.']} Instead of a constant, you can also pass any callable: >>> import datetime >>> class DateForm ( forms . Form ): ... day = forms . DateField ( initial = datetime . date . today ) ... >>> print ( DateForm ()) <div><label for=\"id_day\">Day:</label><input type=\"text\" name=\"day\" value=\"2023-02-11\" required id=\"id_day\"></div> The callable will be evaluated only when the unbound form is displayed, not when it is defined. widget ¶ Field. widget ¶ The widget argument lets you specify a Widget class to use when\nrendering this Field . See Widgets for more information. help_text ¶ Field. help_text ¶ The help_text argument lets you specify descriptive text for this Field . If you provide help_text , it will be displayed next to the Field when the Field is rendered by one of the convenience Form methods (e.g., as_ul() ). Like the model field’s help_text , this value\nisn’t HTML-escaped in automatically-generated forms. Here’s a full example Form that implements help_text for two of its\nfields. We’ve specified auto_id=False to simplify the output: >>> from django import forms >>> class HelpTextContactForm ( forms . Form ): ... subject = forms . CharField ( max_length = 100 , help_text = \"100 characters max.\" ) ... message = forms . CharField () ... sender = forms . EmailField ( help_text = \"A valid email address, please.\" ) ... cc_myself = forms . BooleanField ( required = False ) ... >>> f = HelpTextContactForm ( auto_id = False ) >>> print ( f ) <div>Subject:<div class=\"helptext\">100 characters max.</div><input type=\"text\" name=\"subject\" maxlength=\"100\" required></div> <div>Message:<input type=\"text\" name=\"message\" required></div> <div>Sender:<div class=\"helptext\">A valid email address, please.</div><input type=\"email\" name=\"sender\" required></div> <div>Cc myself:<input type=\"checkbox\" name=\"cc_myself\"></div> When a field has help text it is associated with its input using the aria-describedby HTML attribute. If the widget is rendered in a <fieldset> then aria-describedby is added to this element, otherwise it\nis added to the widget’s <input> : >>> from django import forms >>> class UserForm ( forms . Form ): ... username = forms . CharField ( max_length = 255 , help_text = \"e.g., user@example.com\" ) ... >>> f = UserForm () >>> print ( f ) <div> <label for=\"id_username\">Username:</label> <div class=\"helptext\" id=\"id_username_helptext\">e.g., user@example.com</div> <input type=\"text\" name=\"username\" maxlength=\"255\" required aria-describedby=\"id_username_helptext\" id=\"id_username\"> </div> When adding a custom aria-describedby attribute, make sure to also include\nthe id of the help_text element (if used) in the desired order. For\nscreen reader users, descriptions will be read in their order of appearance\ninside aria-describedby : >>> class UserForm ( forms . Form ): ... username = forms . CharField ( ... max_length = 255 , ... help_text = \"e.g., user@example.com\" , ... widget = forms . TextInput ( ... attrs = { \"aria-describedby\" : \"custom-description id_username_helptext\" }, ... ), ... ) ... >>> f = UserForm () >>> print ( f [ \"username\" ]) <input type=\"text\" name=\"username\" aria-describedby=\"custom-description id_username_helptext\" maxlength=\"255\" id=\"id_username\" required> Changed in Django 5.0: aria-describedby was added to associate help_text with its input. Changed in Django 5.1: aria-describedby support was added for <fieldset> . error_messages ¶ Field. error_messages ¶ The error_messages argument lets you override the default messages that the\nfield will raise. Pass in a dictionary with keys matching the error messages you\nwant to override. For example, here is the default error message: >>> from django import forms >>> generic = forms . CharField () >>> generic . clean ( \"\" ) Traceback (most recent call last): ... ValidationError : ['This field is required.'] And here is a custom error message: >>> name = forms . CharField ( error_messages = { \"required\" : \"Please enter your name\" }) >>> name . clean ( \"\" ) Traceback (most recent call last): ... ValidationError : ['Please enter your name'] In the built-in Field classes section below, each Field defines the\nerror message keys it uses. validators ¶ Field. validators ¶ The validators argument lets you provide a list of validation functions\nfor this field. See the validators documentation for more information. localize ¶ Field. localize ¶ The localize argument enables the localization of form data input, as well\nas the rendered output. See the format localization documentation for\nmore information. disabled ¶ Field. disabled ¶ The disabled boolean argument, when set to True , disables a form field\nusing the disabled HTML attribute so that it won’t be editable by users.\nEven if a user tampers with the field’s value submitted to the server, it will\nbe ignored in favor of the value from the form’s initial data. template_name ¶ Field. template_name ¶ New in Django 5.0. The template_name argument allows a custom template to be used when the\nfield is rendered with as_field_group() . By\ndefault this value is set to \"django/forms/field.html\" . Can be changed per\nfield by overriding this attribute or more generally by overriding the default\ntemplate, see also Overriding built-in field templates . Checking if the field data has changed ¶ has_changed() ¶ Field. has_changed () [source] ¶ The has_changed() method is used to determine if the field value has changed\nfrom the initial value. Returns True or False . See the Form.has_changed() documentation for more information. Built-in Field classes ¶ Naturally, the forms library comes with a set of Field classes that\nrepresent common validation needs. This section documents each built-in field. For each field, we describe the default widget used if you don’t specify widget . We also specify the value returned when you provide an empty value\n(see the section on required above to understand what that means). BooleanField ¶ class BooleanField ( ** kwargs ) [source] ¶ Default widget: CheckboxInput Empty value: False Normalizes to: A Python True or False value. Validates that the value is True (e.g. the check box is checked) if\nthe field has required=True . Error message keys: required Note Since all Field subclasses have required=True by default, the\nvalidation condition here is important. If you want to include a boolean\nin your form that can be either True or False (e.g. a checked or\nunchecked checkbox), you must remember to pass in required=False when\ncreating the BooleanField . CharField ¶ class CharField ( ** kwargs ) [source] ¶ Default widget: TextInput Empty value: Whatever you’ve given as empty_value . Normalizes to: A string. Uses MaxLengthValidator and MinLengthValidator if max_length and min_length are provided. Otherwise, all inputs are valid. Error message keys: required , max_length , min_length Has the following optional arguments for validation: max_length ¶ min_length ¶ If provided, these arguments ensure that the string is at most or at\nleast the given length. strip ¶ If True (default), the value will be stripped of leading and\ntrailing whitespace. empty_value ¶ The value to use to represent “empty”. Defaults to an empty string. ChoiceField ¶ class ChoiceField ( ** kwargs ) [source] ¶ Default widget: Select Empty value: '' (an empty string) Normalizes to: A string. Validates that the given value exists in the list of choices. Error message keys: required , invalid_choice The invalid_choice error message may contain %(value)s , which will be\nreplaced with the selected choice. Takes one extra argument: choices [source] ¶ Either an iterable of 2-tuples to use as choices for this\nfield, enumeration type , or a\ncallable that returns such an iterable. This argument accepts the same\nformats as the choices argument to a model field. See the model field reference documentation on choices for more details. If the argument is a callable, it is evaluated each\ntime the field’s form is initialized, in addition to during rendering.\nDefaults to an empty list. Choice type This field normalizes choices to strings, so if choices are required in\nother data types, such as integers or booleans, consider using TypedChoiceField instead. Changed in Django 5.0: Support for mappings and using enumeration types directly in choices was added. DateField ¶ class DateField ( ** kwargs ) [source] ¶ Default widget: DateInput Empty value: None Normalizes to: A Python datetime.date object. Validates that the given value is either a datetime.date , datetime.datetime or string formatted in a particular date format. Error message keys: required , invalid Takes one optional argument: input_formats ¶ An iterable of formats used to attempt to convert a string to a valid datetime.date object. If no input_formats argument is provided, the default input formats are\ntaken from the active locale format DATE_INPUT_FORMATS key, or from DATE_INPUT_FORMATS if localization is disabled. See also format localization . DateTimeField ¶ class DateTimeField ( ** kwargs ) [source] ¶ Default widget: DateTimeInput Empty value: None Normalizes to: A Python datetime.datetime object. Validates that the given value is either a datetime.datetime , datetime.date or string formatted in a particular datetime format. Error message keys: required , invalid Takes one optional argument: input_formats ¶ An iterable of formats used to attempt to convert a string to a valid datetime.datetime object, in addition to ISO 8601 formats. The field always accepts strings in ISO 8601 formatted dates or similar\nrecognized by parse_datetime() . Some examples\nare: '2006-10-25 14:30:59' '2006-10-25T14:30:59' '2006-10-25 14:30' '2006-10-25T14:30' '2006-10-25T14:30Z' '2006-10-25T14:30+02:00' '2006-10-25' If no input_formats argument is provided, the default input formats are\ntaken from the active locale format DATETIME_INPUT_FORMATS and DATE_INPUT_FORMATS keys, or from DATETIME_INPUT_FORMATS and DATE_INPUT_FORMATS if localization is disabled. See also format localization . DecimalField ¶ class DecimalField ( ** kwargs ) [source] ¶ Default widget: NumberInput when Field.localize is False , else TextInput . Empty value: None Normalizes to: A Python decimal . Validates that the given value is a decimal. Uses MaxValueValidator and MinValueValidator if max_value and min_value are provided. Uses StepValueValidator if step_size is\nprovided. Leading and trailing whitespace is ignored. Error message keys: required , invalid , max_value , min_value , max_digits , max_decimal_places , max_whole_digits , step_size . The max_value and min_value error messages may contain %(limit_value)s , which will be substituted by the appropriate limit.\nSimilarly, the max_digits , max_decimal_places and max_whole_digits error messages may contain %(max)s . Takes five optional arguments: max_value ¶ min_value ¶ These control the range of values permitted in the field, and should be\ngiven as decimal.Decimal values. max_digits ¶ The maximum number of digits (those before the decimal point plus those\nafter the decimal point, with leading zeros stripped) permitted in the\nvalue. decimal_places ¶ The maximum number of decimal places permitted. step_size ¶ Limit valid inputs to an integral multiple of step_size . If min_value is also provided, it’s added as an offset to determine if\nthe step size matches. DurationField ¶ class DurationField ( ** kwargs ) [source] ¶ Default widget: TextInput Empty value: None Normalizes to: A Python timedelta . Validates that the given value is a string which can be converted into a timedelta . The value must be between datetime.timedelta.min and datetime.timedelta.max . Error message keys: required , invalid , overflow . Accepts any format understood by parse_duration() . EmailField ¶ class EmailField ( ** kwargs ) [source] ¶ Default widget: EmailInput Empty value: Whatever you’ve given as empty_value . Normalizes to: A string. Uses EmailValidator to validate that\nthe given value is a valid email address, using a moderately complex\nregular expression. Error message keys: required , invalid Has the optional arguments max_length , min_length , and empty_value which work just as they do for CharField . The max_length argument defaults to 320 (see RFC 3696 Section 3 ). FileField ¶ class FileField ( ** kwargs ) [source] ¶ Default widget: ClearableFileInput Empty value: None Normalizes to: An UploadedFile object that wraps the file content\nand file name into a single object. Can validate that non-empty file data has been bound to the form. Error message keys: required , invalid , missing , empty , max_length Has the optional arguments for validation: max_length and allow_empty_file . If provided, these ensure that the file name is at\nmost the given length, and that validation will succeed even if the file\ncontent is empty. To learn more about the UploadedFile object, see the file uploads\ndocumentation . When you use a FileField in a form, you must also remember to bind the file data to the form . The max_length error refers to the length of the filename. In the error\nmessage for that key, %(max)d will be replaced with the maximum filename\nlength and %(length)d will be replaced with the current filename length. FilePathField ¶ class FilePathField ( ** kwargs ) [source] ¶ Default widget: Select Empty value: '' (an empty string) Normalizes to: A string. Validates that the selected choice exists in the list of choices. Error message keys: required , invalid_choice The field allows choosing from files inside a certain directory. It takes five\nextra arguments; only path is required: path ¶ The absolute path to the directory whose contents you want listed. This\ndirectory must exist. recursive ¶ If False (the default) only the direct contents of path will be\noffered as choices. If True , the directory will be descended into\nrecursively and all descendants will be listed as choices. match ¶ A regular expression pattern; only files with names matching this expression\nwill be allowed as choices. allow_files ¶ Optional.  Either True or False .  Default is True .  Specifies\nwhether files in the specified location should be included.  Either this or allow_folders must be True . allow_folders ¶ Optional.  Either True or False .  Default is False .  Specifies\nwhether folders in the specified location should be included.  Either this or allow_files must be True . FloatField ¶ class FloatField ( ** kwargs ) [source] ¶ Default widget: NumberInput when Field.localize is False , else TextInput . Empty value: None Normalizes to: A Python float. Validates that the given value is a float. Uses MaxValueValidator and MinValueValidator if max_value and min_value are provided. Uses StepValueValidator if step_size is\nprovided. Leading and trailing whitespace is allowed, as in Python’s float() function. Error message keys: required , invalid , max_value , min_value , step_size . Takes three optional arguments: max_value ¶ min_value ¶ These control the range of values permitted in the field. step_size ¶ Limit valid inputs to an integral multiple of step_size . If min_value is also provided, it’s added as an offset to determine if\nthe step size matches. GenericIPAddressField ¶ class GenericIPAddressField ( ** kwargs ) [source] ¶ A field containing either an IPv4 or an IPv6 address. Default widget: TextInput Empty value: '' (an empty string) Normalizes to: A string. IPv6 addresses are normalized as described below. Validates that the given value is a valid IP address. Error message keys: required , invalid The IPv6 address normalization follows RFC 4291 Section 2.2 section 2.2,\nincluding using the IPv4 format suggested in paragraph 3 of that section, like ::ffff:192.0.2.0 . For example, 2001:0::0:01 would be normalized to 2001::1 , and ::ffff:0a0a:0a0a to ::ffff:10.10.10.10 . All characters\nare converted to lowercase. Takes two optional arguments: protocol ¶ Limits valid inputs to the specified protocol.\nAccepted values are both (default), IPv4 or IPv6 . Matching is case insensitive. unpack_ipv4 ¶ Unpacks IPv4 mapped addresses like ::ffff:192.0.2.1 .\nIf this option is enabled that address would be unpacked to 192.0.2.1 . Default is disabled. Can only be used\nwhen protocol is set to 'both' . ImageField ¶ class ImageField ( ** kwargs ) [source] ¶ Default widget: ClearableFileInput Empty value: None Normalizes to: An UploadedFile object that wraps the file content\nand file name into a single object. Validates that file data has been bound to the form. Also uses FileExtensionValidator to validate that\nthe file extension is supported by Pillow. Error message keys: required , invalid , missing , empty , invalid_image Using an ImageField requires that pillow is installed with\nsupport for the image formats you use. If you encounter a corrupt image error when you upload an image, it usually means that Pillow doesn’t\nunderstand its format. To fix this, install the appropriate library and\nreinstall Pillow. When you use an ImageField on a form, you must also remember to bind the file data to the form . After the field has been cleaned and validated, the UploadedFile object will have an additional image attribute containing the Pillow Image instance used to check if the file was a valid image. Pillow\ncloses the underlying file descriptor after verifying an image, so while\nnon-image data attributes, such as format , height , and width ,\nare available, methods that access the underlying image data, such as getdata() or getpixel() , cannot be used without reopening the file.\nFor example: >>> from PIL import Image >>> from django import forms >>> from django.core.files.uploadedfile import SimpleUploadedFile >>> class ImageForm ( forms . Form ): ... img = forms . ImageField () ... >>> file_data = { \"img\" : SimpleUploadedFile ( \"test.png\" , b \"file data\" )} >>> form = ImageForm ({}, file_data ) # Pillow closes the underlying file descriptor. >>> form . is_valid () True >>> image_field = form . cleaned_data [ \"img\" ] >>> image_field . image <PIL.PngImagePlugin.PngImageFile image mode=RGBA size=191x287 at 0x7F5985045C18> >>> image_field . image . width 191 >>> image_field . image . height 287 >>> image_field . image . format 'PNG' >>> image_field . image . getdata () # Raises AttributeError: 'NoneType' object has no attribute 'seek'. >>> image = Image . open ( image_field ) >>> image . getdata () <ImagingCore object at 0x7f5984f874b0> Additionally, UploadedFile.content_type will be updated with the\nimage’s content type if Pillow can determine it, otherwise it will be set\nto None . IntegerField ¶ class IntegerField ( ** kwargs ) [source] ¶ Default widget: NumberInput when Field.localize is False , else TextInput . Empty value: None Normalizes to: A Python integer. Validates that the given value is an integer. Uses MaxValueValidator and MinValueValidator if max_value and min_value are provided. Uses StepValueValidator if step_size is\nprovided. Leading and trailing whitespace is allowed, as in Python’s int() function. Error message keys: required , invalid , max_value , min_value , step_size The max_value , min_value and step_size error messages may\ncontain %(limit_value)s , which will be substituted by the appropriate\nlimit. Takes three optional arguments for validation: max_value ¶ min_value ¶ These control the range of values permitted in the field. step_size ¶ Limit valid inputs to an integral multiple of step_size . If min_value is also provided, it’s added as an offset to determine if\nthe step size matches. JSONField ¶ class JSONField ( encoder = None , decoder = None , ** kwargs ) [source] ¶ A field which accepts JSON encoded data for a JSONField . Default widget: Textarea Empty value: None Normalizes to: A Python representation of the JSON value (usually as a dict , list , or None ), depending on JSONField.decoder . Validates that the given value is a valid JSON. Error message keys: required , invalid Takes two optional arguments: encoder ¶ A json.JSONEncoder subclass to serialize data types not\nsupported by the standard JSON serializer (e.g. datetime.datetime or UUID ). For example, you can use the DjangoJSONEncoder class. Defaults to json.JSONEncoder . decoder ¶ A json.JSONDecoder subclass to deserialize the input. Your\ndeserialization may need to account for the fact that you can’t be\ncertain of the input type. For example, you run the risk of returning a datetime that was actually a string that just happened to be in the\nsame format chosen for datetime s. The decoder can be used to validate the input. If json.JSONDecodeError is raised during the deserialization,\na ValidationError will be raised. Defaults to json.JSONDecoder . Note If you use a ModelForm , the encoder and decoder from JSONField will be used. User friendly forms JSONField is not particularly user friendly in most cases. However,\nit is a useful way to format data from a client-side widget for\nsubmission to the server. MultipleChoiceField ¶ class MultipleChoiceField ( ** kwargs ) [source] ¶ Default widget: SelectMultiple Empty value: [] (an empty list) Normalizes to: A list of strings. Validates that every value in the given list of values exists in the list\nof choices. Error message keys: required , invalid_choice , invalid_list The invalid_choice error message may contain %(value)s , which will be\nreplaced with the selected choice. Takes one extra required argument, choices , as for ChoiceField . NullBooleanField ¶ class NullBooleanField ( ** kwargs ) [source] ¶ Default widget: NullBooleanSelect Empty value: None Normalizes to: A Python True , False or None value. Validates nothing (i.e., it never raises a ValidationError ). NullBooleanField may be used with widgets such as Select or RadioSelect by providing the widget choices : NullBooleanField ( widget = Select ( choices = [ ( \"\" , \"Unknown\" ), ( True , \"Yes\" ), ( False , \"No\" ), ] ) ) RegexField ¶ class RegexField ( ** kwargs ) [source] ¶ Default widget: TextInput Empty value: Whatever you’ve given as empty_value . Normalizes to: A string. Uses RegexValidator to validate that\nthe given value matches a certain regular expression. Error message keys: required , invalid Takes one required argument: regex ¶ A regular expression specified either as a string or a compiled regular\nexpression object. Also takes max_length , min_length , strip , and empty_value which work just as they do for CharField . strip ¶ Defaults to False . If enabled, stripping will be applied before the\nregex validation. SlugField ¶ class SlugField ( ** kwargs ) [source] ¶ Default widget: TextInput Empty value: Whatever you’ve given as empty_value . Normalizes to: A string. Uses validate_slug or validate_unicode_slug to validate that\nthe given value contains only letters, numbers, underscores, and hyphens. Error messages: required , invalid This field is intended for use in representing a model SlugField in forms. Takes two optional parameters: allow_unicode ¶ A boolean instructing the field to accept Unicode letters in addition\nto ASCII letters. Defaults to False . empty_value ¶ The value to use to represent “empty”. Defaults to an empty string. TimeField ¶ class TimeField ( ** kwargs ) [source] ¶ Default widget: TimeInput Empty value: None Normalizes to: A Python datetime.time object. Validates that the given value is either a datetime.time or string\nformatted in a particular time format. Error message keys: required , invalid Takes one optional argument: input_formats ¶ An iterable of formats used to attempt to convert a string to a valid datetime.time object. If no input_formats argument is provided, the default input formats are\ntaken from the active locale format TIME_INPUT_FORMATS key, or from TIME_INPUT_FORMATS if localization is disabled. See also format localization . TypedChoiceField ¶ class TypedChoiceField ( ** kwargs ) [source] ¶ Just like a ChoiceField , except TypedChoiceField takes two\nextra arguments, coerce and empty_value . Default widget: Select Empty value: Whatever you’ve given as empty_value . Normalizes to: A value of the type provided by the coerce argument. Validates that the given value exists in the list of choices and can be\ncoerced. Error message keys: required , invalid_choice Takes extra arguments: coerce ¶ A function that takes one argument and returns a coerced value. Examples\ninclude the built-in int , float , bool and other types. Defaults\nto an identity function. Note that coercion happens after input\nvalidation, so it is possible to coerce to a value not present in choices . empty_value ¶ The value to use to represent “empty.” Defaults to the empty string; None is another common choice here. Note that this value will not be\ncoerced by the function given in the coerce argument, so choose it\naccordingly. TypedMultipleChoiceField ¶ class TypedMultipleChoiceField ( ** kwargs ) [source] ¶ Just like a MultipleChoiceField , except TypedMultipleChoiceField takes two extra arguments, coerce and empty_value . Default widget: SelectMultiple Empty value: Whatever you’ve given as empty_value Normalizes to: A list of values of the type provided by the coerce argument. Validates that the given values exists in the list of choices and can be\ncoerced. Error message keys: required , invalid_choice The invalid_choice error message may contain %(value)s , which will be\nreplaced with the selected choice. Takes two extra arguments, coerce and empty_value , as for TypedChoiceField . URLField ¶ class URLField ( ** kwargs ) [source] ¶ Default widget: URLInput Empty value: Whatever you’ve given as empty_value . Normalizes to: A string. Uses URLValidator to validate that the\ngiven value is a valid URL. Error message keys: required , invalid Has the optional arguments max_length , min_length , empty_value which work just as they do for CharField , and one more argument: assume_scheme ¶ New in Django 5.0. The scheme assumed for URLs provided without one. Defaults to \"http\" . For example, if assume_scheme is \"https\" and the\nprovided value is \"example.com\" , the normalized value will be \"https://example.com\" . Deprecated since version 5.0: The default value for assume_scheme will change from \"http\" to \"https\" in Django 6.0. Set FORMS_URLFIELD_ASSUME_HTTPS transitional setting to True to opt into using \"https\" during\nthe Django 5.x release cycle. UUIDField ¶ class UUIDField ( ** kwargs ) [source] ¶ Default widget: TextInput Empty value: None Normalizes to: A UUID object. Error message keys: required , invalid This field will accept any string format accepted as the hex argument\nto the UUID constructor. Slightly complex built-in Field classes ¶ ComboField ¶ class ComboField ( ** kwargs ) [source] ¶ Default widget: TextInput Empty value: '' (an empty string) Normalizes to: A string. Validates the given value against each of the fields specified\nas an argument to the ComboField . Error message keys: required , invalid Takes one extra required argument: fields ¶ The list of fields that should be used to validate the field’s value (in\nthe order in which they are provided). >>> from django.forms import ComboField >>> f = ComboField ( fields = [ CharField ( max_length = 20 ), EmailField ()]) >>> f . clean ( \"test@example.com\" ) 'test@example.com' >>> f . clean ( \"longemailaddress@example.com\" ) Traceback (most recent call last): ... ValidationError : ['Ensure this value has at most 20 characters (it has 28).'] MultiValueField ¶ class MultiValueField ( fields = () , ** kwargs ) [source] ¶ Default widget: TextInput Empty value: '' (an empty string) Normalizes to: the type returned by the compress method of the subclass. Validates the given value against each of the fields specified\nas an argument to the MultiValueField . Error message keys: required , invalid , incomplete Aggregates the logic of multiple fields that together produce a single\nvalue. This field is abstract and must be subclassed. In contrast with the\nsingle-value fields, subclasses of MultiValueField must not\nimplement clean() but instead - implement compress() . Takes one extra required argument: fields ¶ A tuple of fields whose values are cleaned and subsequently combined\ninto a single value.  Each value of the field is cleaned by the\ncorresponding field in fields – the first value is cleaned by the\nfirst field, the second value is cleaned by the second field, etc.\nOnce all fields are cleaned, the list of clean values is combined into\na single value by compress() . Also takes some optional arguments: require_all_fields ¶ Defaults to True , in which case a required validation error\nwill be raised if no value is supplied for any field. When set to False , the Field.required attribute can be set\nto False for individual fields to make them optional. If no value\nis supplied for a required field, an incomplete validation error\nwill be raised. A default incomplete error message can be defined on the MultiValueField subclass, or different messages can be defined\non each individual field. For example: from django.core.validators import RegexValidator class PhoneField ( MultiValueField ): def __init__ ( self , ** kwargs ): # Define one message for all fields. error_messages = { \"incomplete\" : \"Enter a country calling code and a phone number.\" , } # Or define a different message for each field. fields = ( CharField ( error_messages = { \"incomplete\" : \"Enter a country calling code.\" }, validators = [ RegexValidator ( r \"^[0-9]+$\" , \"Enter a valid country calling code.\" ), ], ), CharField ( error_messages = { \"incomplete\" : \"Enter a phone number.\" }, validators = [ RegexValidator ( r \"^[0-9]+$\" , \"Enter a valid phone number.\" )], ), CharField ( validators = [ RegexValidator ( r \"^[0-9]+$\" , \"Enter a valid extension.\" )], required = False , ), ) super () . __init__ ( error_messages = error_messages , fields = fields , require_all_fields = False , ** kwargs ) widget ¶ Must be a subclass of django.forms.MultiWidget .\nDefault value is TextInput , which\nprobably is not very useful in this case. compress ( data_list ) [source] ¶ Takes a list of valid values and returns  a “compressed” version of\nthose values – in a single value. For example, SplitDateTimeField is a subclass which combines a time field\nand a date field into a datetime object. This method must be implemented in the subclasses. SplitDateTimeField ¶ class SplitDateTimeField ( ** kwargs ) [source] ¶ Default widget: SplitDateTimeWidget Empty value: None Normalizes to: A Python datetime.datetime object. Validates that the given value is a datetime.datetime or string\nformatted in a particular datetime format. Error message keys: required , invalid , invalid_date , invalid_time Takes two optional arguments: input_date_formats ¶ A list of formats used to attempt to convert a string to a valid datetime.date object. If no input_date_formats argument is provided, the default input formats\nfor DateField are used. input_time_formats ¶ A list of formats used to attempt to convert a string to a valid datetime.time object. If no input_time_formats argument is provided, the default input formats\nfor TimeField are used. Fields which handle relationships ¶ Two fields are available for representing relationships between\nmodels: ModelChoiceField and ModelMultipleChoiceField .  Both of these fields require a\nsingle queryset parameter that is used to create the choices for\nthe field.  Upon form validation, these fields will place either one\nmodel object (in the case of ModelChoiceField ) or multiple model\nobjects (in the case of ModelMultipleChoiceField ) into the cleaned_data dictionary of the form. For more complex uses, you can specify queryset=None when declaring the\nform field and then populate the queryset in the form’s __init__() method: class FooMultipleChoiceForm ( forms . Form ): foo_select = forms . ModelMultipleChoiceField ( queryset = None ) def __init__ ( self , * args , ** kwargs ): super () . __init__ ( * args , ** kwargs ) self . fields [ \"foo_select\" ] . queryset = ... Both ModelChoiceField and ModelMultipleChoiceField have an iterator attribute which specifies the class used to iterate over the queryset when\ngenerating choices. See Iterating relationship choices for details. ModelChoiceField ¶ class ModelChoiceField ( ** kwargs ) [source] ¶ Default widget: Select Empty value: None Normalizes to: A model instance. Validates that the given id exists in the queryset. Error message keys: required , invalid_choice The invalid_choice error message may contain %(value)s , which will\nbe replaced with the selected choice. Allows the selection of a single model object, suitable for representing a\nforeign key. Note that the default widget for ModelChoiceField becomes\nimpractical when the number of entries increases. You should avoid using it\nfor more than 100 items. A single argument is required: queryset ¶ A QuerySet of model objects from which the choices for the field\nare derived and which is used to validate the user’s selection. It’s\nevaluated when the form is rendered. ModelChoiceField also takes several optional arguments: empty_label ¶ By default the <select> widget used by ModelChoiceField will have an\nempty choice at the top of the list. You can change the text of this\nlabel (which is \"---------\" by default) with the empty_label attribute, or you can disable the empty label entirely by setting empty_label to None : # A custom empty label field1 = forms . ModelChoiceField ( queryset =... , empty_label = \"(Nothing)\" ) # No empty label field2 = forms . ModelChoiceField ( queryset =... , empty_label = None ) Note that no empty choice is created (regardless of the value of empty_label ) if a ModelChoiceField is required and has a\ndefault initial value, or a widget is set to RadioSelect and the blank argument is False . to_field_name ¶ This optional argument is used to specify the field to use as the value\nof the choices in the field’s widget. Be sure it’s a unique field for\nthe model, otherwise the selected value could match more than one\nobject. By default it is set to None , in which case the primary key\nof each object will be used. For example: # No custom to_field_name field1 = forms . ModelChoiceField ( queryset =... ) would yield: < select id = \"id_field1\" name = \"field1\" > < option value = \"obj1.pk\" > Object1 </ option > < option value = \"obj2.pk\" > Object2 </ option > ... </ select > and: # to_field_name provided field2 = forms . ModelChoiceField ( queryset =... , to_field_name = \"name\" ) would yield: < select id = \"id_field2\" name = \"field2\" > < option value = \"obj1.name\" > Object1 </ option > < option value = \"obj2.name\" > Object2 </ option > ... </ select > blank ¶ When using the RadioSelect widget, this optional\nboolean argument determines whether an empty choice is created. By\ndefault, blank is False , in which case no empty choice is\ncreated. ModelChoiceField also has the attribute: iterator ¶ The iterator class used to generate field choices from queryset . By\ndefault, ModelChoiceIterator . The __str__() method of the model will be called to generate string\nrepresentations of the objects for use in the field’s choices. To provide\ncustomized representations, subclass ModelChoiceField and override label_from_instance . This method will receive a model object and should\nreturn a string suitable for representing it. For example: from django.forms import ModelChoiceField class MyModelChoiceField ( ModelChoiceField ): def label_from_instance ( self , obj ): return \"My Object # %i \" % obj . id ModelMultipleChoiceField ¶ class ModelMultipleChoiceField ( ** kwargs ) [source] ¶ Default widget: SelectMultiple Empty value: An empty QuerySet ( self.queryset.none() ) Normalizes to: A QuerySet of model instances. Validates that every id in the given list of values exists in the\nqueryset. Error message keys: required , invalid_list , invalid_choice , invalid_pk_value The invalid_choice message may contain %(value)s and the invalid_pk_value message may contain %(pk)s , which will be\nsubstituted by the appropriate values. Allows the selection of one or more model objects, suitable for\nrepresenting a many-to-many relation. As with ModelChoiceField ,\nyou can use label_from_instance to customize the object\nrepresentations. A single argument is required: queryset ¶ Same as ModelChoiceField.queryset . Takes one optional argument: to_field_name ¶ Same as ModelChoiceField.to_field_name . ModelMultipleChoiceField also has the attribute: iterator ¶ Same as ModelChoiceField.iterator . Iterating relationship choices ¶ By default, ModelChoiceField and ModelMultipleChoiceField use ModelChoiceIterator to generate their field choices . When iterated, ModelChoiceIterator yields 2-tuple choices containing ModelChoiceIteratorValue instances as the first value element in\neach choice. ModelChoiceIteratorValue wraps the choice value while\nmaintaining a reference to the source model instance that can be used in custom\nwidget implementations, for example, to add data-* attributes to <option> elements. For example, consider the following models: from django.db import models class Topping ( models . Model ): name = models . CharField ( max_length = 100 ) price = models . DecimalField ( decimal_places = 2 , max_digits = 6 ) def __str__ ( self ): return self . name class Pizza ( models . Model ): topping = models . ForeignKey ( Topping , on_delete = models . CASCADE ) You can use a Select widget subclass to include\nthe value of Topping.price as the HTML attribute data-price for each <option> element: from django import forms class ToppingSelect ( forms . Select ): def create_option ( self , name , value , label , selected , index , subindex = None , attrs = None ): option = super () . create_option ( name , value , label , selected , index , subindex , attrs ) if value : option [ \"attrs\" ][ \"data-price\" ] = value . instance . price return option class PizzaForm ( forms . ModelForm ): class Meta : model = Pizza fields = [ \"topping\" ] widgets = { \"topping\" : ToppingSelect } This will render the Pizza.topping select as: < select id = \"id_topping\" name = \"topping\" required > < option value = \"\" selected > --------- </ option > < option value = \"1\" data-price = \"1.50\" > mushrooms </ option > < option value = \"2\" data-price = \"1.25\" > onions </ option > < option value = \"3\" data-price = \"1.75\" > peppers </ option > < option value = \"4\" data-price = \"2.00\" > pineapple </ option > </ select > For more advanced usage you may subclass ModelChoiceIterator in order to\ncustomize the yielded 2-tuple choices. ModelChoiceIterator ¶ class ModelChoiceIterator ( field ) [source] ¶ The default class assigned to the iterator attribute of ModelChoiceField and ModelMultipleChoiceField . An\niterable that yields 2-tuple choices from the queryset. A single argument is required: field ¶ The instance of ModelChoiceField or ModelMultipleChoiceField to\niterate and yield choices. ModelChoiceIterator has the following method: __iter__ () [source] ¶ Yields 2-tuple choices, in the (value, label) format used by ChoiceField.choices . The first value element is a ModelChoiceIteratorValue instance. ModelChoiceIteratorValue ¶ class ModelChoiceIteratorValue ( value , instance ) [source] ¶ Two arguments are required: value ¶ The value of the choice. This value is used to render the value attribute of an HTML <option> element. instance ¶ The model instance from the queryset. The instance can be accessed in\ncustom ChoiceWidget.create_option() implementations to adjust the\nrendered HTML. ModelChoiceIteratorValue has the following method: __str__ () [source] ¶ Return value as a string to be rendered in HTML. Creating custom fields ¶ If the built-in Field classes don’t meet your needs, you can create custom Field classes. To do this, create a subclass of django.forms.Field . Its\nonly requirements are that it implement a clean() method and that its __init__() method accept the core arguments mentioned above ( required , label , initial , widget , help_text ). You can also customize how a field will be accessed by overriding get_bound_field() .", "keywords": ["users", "box", "price", "integerfield", "uuidfield", "underscores", "pattern", "nationality", "emailfield", "zeros", "messages", "selection", "getdata", "pillow", "formsets", "class=\"helptext\">100", "value=\"your", "get_bound_field", "type=\"checkbox", "library", "for=\"id_username\">username:</label", "sender", "field", "#", "relation", "choicewidget.create_option", "min_value", "django.forms", "rgba", "ffff:192.0.2.1", "paragraph", "coerce", "numbers", "validate_unicode_slug", "regex", "subject:<div", "representation", "range", "datefield", "modelmultiplechoicefield", "needs", "type=\"text", "longemailaddress@example.com", "https", "emailvalidator", "decoder", "label", "name=\"nationality", "for=\"id_nationality\">nationality?</label><input", "django.core.exceptions", "http", "=", "foomultiplechoiceform", "describedby=\"id_username_helptext", "pizzaform", "message", "relationship", "fact", "inputs", "allow_empty_file", "letters", "unpack_ipv4", "cc", "height", "fallback", "places", "^[0", "datetime.datetime", "nonetype", "name=\"day", "choice", "multiple", "yields", "class=\"helptext\">a", "name=\"url\"></div", "ipv4", "type", "error_messages", "filefield", "for=\"id_day\">day:</label><input", "custom", "kwargs", "objects", "documentation", "id=\"id_captcha_answer\"></div", "input_formats", "file", "phonefield", "urlvalidator", "user", "unpacks", "cases", "to_field_name", "attribute", "typedmultiplechoicefield", "yield", "args", "name=\"captcha_answer", "size", "splitdatetimefield", "time", "max)d", "website:<input", "basis", "risk", "date", "create_option", "input_date_formats", "setting", "step_size", "iterator", "pineapple", "logic", "name", "parameter", "has_changed", "reference", "min_length", "age", "appearance", "djangojsonencoder", "helptextcontactform", "please.</div><input", "uses", "addresses", "return", "foo", "define", "parse_datetime", "ffff:0a0a:0a0a", "letter", "type=\"number", "datetimefield", "datetime.date", "peppers", "examples", "invalid_pk_value", "25t14:30:59", "field.html", "name=\"age", "username", "relationships", "bool", "url", "error", "commentform", "code", "toppingselect", "decimalfield", "regexvalidator", "localize", "false", "behavior", "i", "class", "display", "fileextensionvalidator", "contactform", "test@example.com", "widget", "returns", "names", "reinstall", "output", "input", "*", "dateform", "types", "strings", "empty_value", "floatfield", "elements", "subclass", "mushrooms", ".", "usage", "help_text", "div><label", "limit", "step", "2001:0::0:01", "max_length", "modelchoiceiterator", "form.use_required_attribute", "modelchoicefield.queryset", "validation", "label_from_instance", "as_field_group", "section", "user@example.com</div", "filepathfield", "cleaned_data", "source", "jsonfield.decoder", "allow_unicode", "representations", "obj2.name", "modelchoiceiteratorvalue", "use", "imageform", "default_data", "aria", "img", "modelchoicefield.to_field_name", "subclasses", "invalid_image", "normalizes", "time_input_formats", "genericipaddressfield", "value=\"https://", "enumeration", "max_whole_digits", "describedby=\"custom", "core", "url.</li></ul", "assume_scheme", "onions", "jsondecoder", "order", "date_input_formats", "id=\"id_age\"></div", "default", "value=\"2023", "choices", "comment", "form", "option", "format", "classes", "characters", "help", "expression", "maxlengthvalidator", "day", "booleanfield", "validationerror", "convenience", "f", "scheme", "name=\"message", "nullbooleanfield", "https://", "9]+$", "template", "name=\"comment", "aggregates", "mappings", "combofield", "choicefield.choices", "traceback", "way", "formats", "super", "booleans", "template_name", "index", "queryset", "foo_select", "integer", "limit_value)s", "¶", "urlinput", "pil", "spaces", "parameters", "modelchoicefield", "sender:<div", "file_data", "int", "integers", "allow_files", "encoder", "side", "name=\"username", "content", "maxvaluevalidator", "function", "multiplechoicefield", "protocol", "implementations", "float", "uuid", "number", "jsonfield", "modelform", "def", "point", "descendants", "values", "auto_id", "message:<input", "deserialization", "generic", "pk)s", "string", "max.</div><input", "id=\"id_day\"></div", "favor", "iterating", "allow_folders", "name=\"sender", "location", "subject", "coercion", "phone", "dates", "models", "ipv6", "url:<input", "invalid_list", "jsondecodeerror", "version", "json", "contents", "hyphens", "modelchoicefield.iterator", "image", "reader", "condition", "django", "regexfield", "rfc", "overflow", "n’t", "div", "id=\"id_username", "filename", "fields", "print", "ip", "set", "value", "topping", "compress", "as_ul", "length)d", "validate_slug", "invalid_choice", "data", "browser", "image_field", "describedby", "multivaluefield", "datetime", "strip", "iterable", "maxlength=\"100", "comment:<input", "self", "instance", "today", "subindex", "localization", "max_decimal_places", "extension", "captcha_answer", "topping.price", "self.queryset.none", "validators", "descriptions", "constant", "require_all_fields", "empty_label", "multiwidget", "unicode", "maxlength=\"255", "5.x", "timedelta", "png", "digits", "same", "minlengthvalidator", "constructor", "pizza", "descriptor", "instances", "iso", "type=\"email", "part", "object", "textarea", "dateinput", "choicefield", "numberinput", "charfield", "invalid_date", "website", "dictionary", "whitespace", "contrast", "max_digits", "max", "attrs", "matches", "top", "parse_duration", "address", "mymodelchoicefield", "jsonencoder", "datetime.timedelta.min", "items", "imagefield", "s.", "widgets", "serializer", "name:<input", "myself:<input", "check", "forms", "uploads", "addition", "example", "hooks", "getpixel", "country", "object2", "requirements", "list", "simpleuploadedfile", "email", "model", "timeinput", "idea", "callable", "value)s", "element", "django.core.validators", "urlfield", "identity", "attributes", "increases", "datetime.timedelta.max", "slugfield", "hex", "release", "max)s", "timefield", "field.localize", "r", "select", "textinput", "input_time_formats", "keys", "case", "attributeerror", "boolean", "length", "folders", "size=191x287", "clean", "blank", "html", "errors", "screen", "tuple", "server", "str", "submission", "arguments", "normalization", "class=\"helptext", "init", "userform", "pizza.topping", "emailinput", "entries", "uploadedfile.content_type", "matching", "tuples", "name=\"url", "selectmultiple", "path", "is_valid", "functions", "key", "none", "imagingcore", "specifies", "meta", "name=\"name", "stepvaluevalidator", "type=\"url", "name=\"cc_myself\"></div", "durationfield", "id=\"id_username_helptext\">e.g", "new", "true", "urls", "support", "description", "max_value", "mode", "decimal_places", "datetime_input_formats", "cycle", "offset", "limits", "import", "files", "d", "directory", "%", ">", "defaults", "call", "minvaluevalidator", "checkbox", "foreignkey", "information", "python", "methods", "optional", "exception", "client", "details", "uploadedfile", "method", "django.db", "field1", "argument", "data-", "field2", "radioselect", "note", "templates", "label_suffix", "text", "typedchoicefield", "datetime.time"], "type": "documentation"}
]